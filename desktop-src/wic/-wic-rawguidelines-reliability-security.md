---
description: Zuverlässigkeit und Sicherheit
ms.assetid: 1cbfabce-3d56-4e23-b9a7-02369c67e392
title: Zuverlässigkeit und Sicherheit
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8a0f0e4a244de2c1463cdadb76162c18b041812b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "106349595"
---
# <a name="reliability-and-security"></a><span data-ttu-id="d84bb-103">Zuverlässigkeit und Sicherheit</span><span class="sxs-lookup"><span data-stu-id="d84bb-103">Reliability and Security</span></span>

<span data-ttu-id="d84bb-104">Da in der Windows-Shell und der Fotogalerie Windows Imaging Component (WIC)-Codecs aufgerufen werden, sollten Codec-Autoren alle Anstrengungen Unternehmen, um ein hohes Maß an Zuverlässigkeit und Sicherheit in ihren WIC-Codecs sicherzustellen.</span><span class="sxs-lookup"><span data-stu-id="d84bb-104">Because Windows Imaging Component (WIC) codecs will be invoked from within the Windows shell and Photo Gallery, codec authors should make every effort to ensure a high level of reliability and security in their WIC codecs.</span></span>

<span data-ttu-id="d84bb-105">Das Schreiben von zuverlässigem Code hängt größtenteils von guten Codierungs Methoden, effektiven Code Überprüfungen und umfassenden Komponententests und Szenariotests ab.</span><span class="sxs-lookup"><span data-stu-id="d84bb-105">Writing reliable code largely depends on good coding practices, effective code reviews, and thorough unit testing and scenario testing.</span></span> <span data-ttu-id="d84bb-106">Außerdem wird anhand der folgenden Richtlinien sichergestellt, dass der Codec den Windows Vista-Richtlinien bezüglich der Zuverlässigkeit entspricht.</span><span class="sxs-lookup"><span data-stu-id="d84bb-106">In addition, the following guidelines will help ensure that the codec complies with Windows Vista policies regarding reliability.</span></span>

-   <span data-ttu-id="d84bb-107">E/a-Abbruch aktivieren.</span><span class="sxs-lookup"><span data-stu-id="d84bb-107">Enable I/O cancellation.</span></span>

    <span data-ttu-id="d84bb-108">Die Codec-Autoren sollten eine Möglichkeit für den Endbenutzer bieten, einen Vorgang mit langer Laufzeit abzubrechen.</span><span class="sxs-lookup"><span data-stu-id="d84bb-108">Codec authors should provide a way for the end user to cancel any long-running operation.</span></span> <span data-ttu-id="d84bb-109">WIC-Codecs unterstützen dies durch Implementieren von iwicbitmapprogressnotification.</span><span class="sxs-lookup"><span data-stu-id="d84bb-109">WIC codecs support this by implementing IWICBitmapProgressNotification.</span></span> <span data-ttu-id="d84bb-110">Dadurch kann eine aufrufende Anwendung eine Rückruffunktion angeben, die der Codec in angegebenen Intervallen aufruft, um den Aufrufer über den Fortschritt des aktuellen Vorgangs zu benachrichtigen.</span><span class="sxs-lookup"><span data-stu-id="d84bb-110">This allows a calling application to specify a callback function for the codec to call at specified intervals to notify the caller of the progress of the current operation.</span></span> <span data-ttu-id="d84bb-111">Wenn eine Anwendung einen Fehler zurückgibt \_ , der von der Rückruffunktion abgebrochen wurde, muss der Codec den Vorgang abbrechen, der ausgeführt wird, und das HRESULT an den Aufrufer zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="d84bb-111">When an application returns ERROR\_CANCELLED from the callback function, the codec must cancel whatever operation is in progress and propagate the HRESULT back to the caller.</span></span> <span data-ttu-id="d84bb-112">Dies ist insbesondere bei unformatierten Codecs wichtig, da es einige Sekunden dauern kann, bis ein rohimage in voller Größe decodiert wird, und Anwendungen benötigen eine Möglichkeit, diese Verarbeitung abzubrechen.</span><span class="sxs-lookup"><span data-stu-id="d84bb-112">This is especially important for RAW codecs, because it might take several seconds to decode a full-size RAW image and applications need a way to abort this processing.</span></span>

-   <span data-ttu-id="d84bb-113">Stellen Sie sicher, dass der Code im kleinsten Bereich ausgeführt wird, der für die Ausführung seiner Funktion erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="d84bb-113">Make sure that code runs in the smallest scope that is required to perform its function.</span></span>

    <span data-ttu-id="d84bb-114">Die Codec-Autoren müssen sicherstellen, dass der Codec nicht mehr Ressourcen als notwendig beansprucht oder einen größeren Bereich hat, als erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="d84bb-114">Codec authors must ensure that the codec does not consume more resources than necessary or have a greater scope than is required.</span></span> <span data-ttu-id="d84bb-115">Der Bereich eines Codecs in WIC ist eine einzelne Bilddatei. der Codec wird erstellt, wenn eine Bilddatei geladen wird, und der Codec wird freigegeben, wenn das Bild geschlossen wird.</span><span class="sxs-lookup"><span data-stu-id="d84bb-115">The scope of a codec in WIC is a single image file; the codec is created when an image file is loaded, and the codec is released when the image is closed.</span></span> <span data-ttu-id="d84bb-116">Da WIC eine erweiterbare komponentenbasierte Plattform ist, haben WIC-Codecs überlappende Lasten und entladen und werden alle innerhalb desselben Prozesses gestartet und beendet.</span><span class="sxs-lookup"><span data-stu-id="d84bb-116">Because WIC is an extensible component-based platform, WIC codecs will have overlapping loads and unloads, and starts and stops, all within the same process.</span></span> <span data-ttu-id="d84bb-117">Wenn die zugrunde liegende Infrastruktur eines Codecs Start-und Stoppvorgänge in einem Bereich erfordert, der größer als ein einzelnes Image ist, wird die Zuverlässigkeit beeinträchtigt.</span><span class="sxs-lookup"><span data-stu-id="d84bb-117">If the underlying infrastructure of a codec requires start and stop operations at a scope larger than a single image, reliability will be impacted.</span></span> <span data-ttu-id="d84bb-118">WIC-fähige Codecs werden sowohl vom Windows-Explorer als auch von anderen Anwendungen verwendet.</span><span class="sxs-lookup"><span data-stu-id="d84bb-118">WIC-enabled codecs will be used by the Windows Explorer, as well as other applications.</span></span> <span data-ttu-id="d84bb-119">Wenn ein Codec für die Lebensdauer des Prozesses geladen wird, wird der Arbeitsspeicher daher nicht effizient freigegeben, und ein Fehler des Codecs könnte den Windows-Explorer beeinträchtigen und möglicherweise erfordern, dass der Computer neu gestartet wird.</span><span class="sxs-lookup"><span data-stu-id="d84bb-119">Therefore, if a codec remains loaded for the lifetime of the process, memory will not be released efficiently and a failure of the codec could hang Windows Explorer and potentially require the machine to be rebooted.</span></span> <span data-ttu-id="d84bb-120">(Beachten Sie, dass der Codec jedes Mal aufgerufen wird, wenn ein Bild zum ersten Mal in Windows-Explorer als Fingerabdruck verwendet wird: Es ist von entscheidender Bedeutung, dass es sich hierbei um einen leichten Vorgang handelt.)</span><span class="sxs-lookup"><span data-stu-id="d84bb-120">(Consider that the codec will be invoked every time an image is thumbnailed for the first time in Windows Explorer: it is essential that this be a lightweight operation.)</span></span>

-   <span data-ttu-id="d84bb-121">Verwenden Sie statische und dynamische Code Analysetools.</span><span class="sxs-lookup"><span data-stu-id="d84bb-121">Use static and dynamic code analysis tools.</span></span>

    -   <span data-ttu-id="d84bb-122">Statische Analysetools:</span><span class="sxs-lookup"><span data-stu-id="d84bb-122">Static analysis tools:</span></span>

        <span data-ttu-id="d84bb-123">Präfix: zum Erkennen von Fehlern zum Zeitpunkt der Kompilierung.</span><span class="sxs-lookup"><span data-stu-id="d84bb-123">PREfix - for detecting errors at compile time.</span></span>

        <span data-ttu-id="d84bb-124">Vorfast: für die Analyse von Code auf Fehler.</span><span class="sxs-lookup"><span data-stu-id="d84bb-124">PREfast - for analyzing code for bugs.</span></span>

    -   <span data-ttu-id="d84bb-125">Dynamische Analysetools:</span><span class="sxs-lookup"><span data-stu-id="d84bb-125">Dynamic analysis tools:</span></span>

        <span data-ttu-id="d84bb-126">AppVerifier: Dadurch können Anwendungen stabiler werden, da häufige Probleme mit der realen Software simuliert werden.</span><span class="sxs-lookup"><span data-stu-id="d84bb-126">AppVerifier - which helps make applications more resilient by simulating common real-world software issues.</span></span>

-   <span data-ttu-id="d84bb-127">Überprüfen Sie alle Eingaben in Code Reviews.</span><span class="sxs-lookup"><span data-stu-id="d84bb-127">Verify all inputs in code reviews.</span></span>

    <span data-ttu-id="d84bb-128">Alle Parameter für exportierte Methoden und alle Datei Daten müssen sorgfältig überprüft werden, wenn Sie fehlerhaft sind, um Sie vor Pufferüberläufen und unter Läufen, arithmetischen Überläufen und unter Läufen, arithmetischen Überläufen und Unterläufen und unerwarteten Typen zu schützen.</span><span class="sxs-lookup"><span data-stu-id="d84bb-128">All parameters for exported methods and all file data must be carefully verified for validity and robustly rejected if faulty, in order to protect against buffer overruns and underruns, arithmetic overflows and underflows, and unexpected types.</span></span>

-   <span data-ttu-id="d84bb-129">Verwenden Sie Datei-fuzzingtechniken, um mögliche Abstürze und Abstürze zu erkennen.</span><span class="sxs-lookup"><span data-stu-id="d84bb-129">Use file fuzzing techniques to discover potential crashes and hangs.</span></span>

    <span data-ttu-id="d84bb-130">Beim Durchlaufen von Dateien wird der Codec mit zufällig permusigen Eingaben getestet.</span><span class="sxs-lookup"><span data-stu-id="d84bb-130">File fuzzing is the process of testing the codec with randomly permuted inputs.</span></span>

    <span data-ttu-id="d84bb-131">Es gibt zwei Arten von Datei fuzzingverfahren: ungesteuerte (zufällige) fuzzingaktionen und gesteuerte fuzzingaktionen.</span><span class="sxs-lookup"><span data-stu-id="d84bb-131">There are two forms of file fuzzing: undirected (random) fuzzing and directed fuzzing.</span></span> <span data-ttu-id="d84bb-132">Bei einem ungerichteten fuzzingvorgang wird ein zufälliges biflipping durchgeführt, um festzustellen, ob die zufällige Eingabe den Codec abstürzen</span><span class="sxs-lookup"><span data-stu-id="d84bb-132">Undirected fuzzing does some random bit flipping to see if random input can crash the codec.</span></span> <span data-ttu-id="d84bb-133">Ein gerichteter fuzzingvorgang führt dazu, dass die Eingabe basierend auf einigen Kenntnissen des Datei Formats durchgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="d84bb-133">Directed fuzzing permutes the input based on some knowledge of the file format.</span></span> <span data-ttu-id="d84bb-134">Wenn z. b. eine Cycle redundant Check (CRC) bei Byte Offset 32 vorhanden ist, wird das Ändern von Bytes ohne die Aktualisierung des CRC wahrscheinlich nicht die meisten Codepath-Methoden ausführen.</span><span class="sxs-lookup"><span data-stu-id="d84bb-134">For example, if there is a cycle redundancy check (CRC) at byte offset 32, then changing any bytes without updating the CRC will likely not exercise most of the codepaths.</span></span> <span data-ttu-id="d84bb-135">In diesem Beispiel sollte ein gerichteter Fuzzer den CRC beheben, wenn alle Bytes geändert werden.</span><span class="sxs-lookup"><span data-stu-id="d84bb-135">In this example, a directed fuzzer should fix the CRC when any bytes are modified.</span></span>

    <span data-ttu-id="d84bb-136">Der Eingabe Satz von Bildern für das Datei-fuzzingverfahren sollte so erstellt werden, dass jede vom Decoder unterstützte Parameter Kombination getestet wird.</span><span class="sxs-lookup"><span data-stu-id="d84bb-136">The input set of images for file fuzzing should be created so that each parameter combination that the decoder supports is tested.</span></span> <span data-ttu-id="d84bb-137">Wenn der Decoder beispielsweise Little-und Big-Endian-Dateien und drei Komprimierungs Einstellungen unterstützt, sollte der Eingabe Satz von Image aus Little-Endian-Dateien jeder Komprimierungs Einstellung und Big-Endian-Dateien für jede Komprimierungs Einstellung bestehen.</span><span class="sxs-lookup"><span data-stu-id="d84bb-137">For example, if the decoder supports little- and big-endian files and three compression settings, then the input set of image should consist of little-endian files of each compression setting and big-endian files for each compression setting.</span></span> <span data-ttu-id="d84bb-138">Diese Vorgehensweise führt zu einem großen, aber sehr robusten Satz von Eingabe Bildern, die getestet werden sollen.</span><span class="sxs-lookup"><span data-stu-id="d84bb-138">This approach will yield a large, but very robust set of input images to be tested.</span></span> <span data-ttu-id="d84bb-139">Auch wenn keine Kamera die einzelnen Kombinationen erzeugt, aber der Decoder diese theoretischen Kombinationen unterstützt, sollten die Codec-Autoren diese Eingaben übermitteln.</span><span class="sxs-lookup"><span data-stu-id="d84bb-139">Even if no camera produces each of the combinations but the decoder supports these theoretical combinations, codec authors should fuzz these inputs.</span></span>

    <span data-ttu-id="d84bb-140">Die Sicherheit kann durch regelmäßiges Testen von Bilddateien während der Codec-Entwicklung erheblich verbessert werden.</span><span class="sxs-lookup"><span data-stu-id="d84bb-140">Security can be greatly enhanced by regularly performing fuzz testing of image files during codec development.</span></span> <span data-ttu-id="d84bb-141">Codecs sollten immer in der Lage sein, Bilddatei Beschädigungen zu erkennen und bei falsch formatierten Anforderungen oder falsch formatierten Daten ordnungsgemäß fehlschlagen zu lassen.</span><span class="sxs-lookup"><span data-stu-id="d84bb-141">Codecs should always be able to detect image file corruption and fail gracefully in the case of a malformed request or of malformed data.</span></span>

-   <span data-ttu-id="d84bb-142">Belastungs Code.</span><span class="sxs-lookup"><span data-stu-id="d84bb-142">Stress the code.</span></span>

    <span data-ttu-id="d84bb-143">Belastung: Testen Sie den Codec, indem Sie ihn kontinuierlich in mehreren gleichzeitigen Prozessen ausführen und alle unterstützten Vorgänge in allen möglichen Sequenzen auf Abbildern unterschiedlicher Größe (einschließlich sehr großer Bilder) von jeder unterstützten Kamera ausführen.</span><span class="sxs-lookup"><span data-stu-id="d84bb-143">Stress-test the codec by running it continually in multiple simultaneous processes, performing all supported operations in all possible sequences, on images of varying sizes (including very large images) from every supported camera.</span></span>

-   <span data-ttu-id="d84bb-144">Thread Sicherheit.</span><span class="sxs-lookup"><span data-stu-id="d84bb-144">Thread safety.</span></span>

    <span data-ttu-id="d84bb-145">Ab Windows 7 erfordert WIC, dass unformatierte Codecs den com-Apartment-Typ "beide" aufweisen.</span><span class="sxs-lookup"><span data-stu-id="d84bb-145">As of Windows 7, WIC requires that RAW CODECs be of COM apartment type "Both".</span></span> <span data-ttu-id="d84bb-146">Dies bedeutet, dass Sie die entsprechende Sperre durchführen müssen, um Apartment übergreifende Aufrufer und Aufrufer in Szenarios mit mehreren Threads zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="d84bb-146">This means that you must do the appropriate locking to handle cross-apartment callers and callers in multi-threaded scenarios.</span></span> <span data-ttu-id="d84bb-147">Objekte innerhalb eines Multithread-Apartment (MTA) können gleichzeitig durch eine beliebige Anzahl von Threads innerhalb des MTA aufgerufen werden, was eine bessere Leistung für Multikernsysteme und bestimmte Server Szenarien ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="d84bb-147">Objects within an Multi Threaded Apartment (MTA) may be called concurrently by any number of threads within the MTA, allowing for better performance on multi-core systems and certain server scenarios.</span></span> <span data-ttu-id="d84bb-148">Darüber hinaus können WIC-Codecs, die innerhalb eines MTA Leben, andere Objekte aufrufen, die innerhalb des MTA Leben, ohne die Marshallingkosten im Zusammenhang mit dem Aufruf zwischen Threads, die in unterschiedlichen STA-Wohnungen leben.</span><span class="sxs-lookup"><span data-stu-id="d84bb-148">In addition, WIC CODECs that live within an MTA can call other objects that live within the MTA without the marshalling cost associated of calling between threads that live in different STA apartments.</span></span> <span data-ttu-id="d84bb-149">In Windows 7 wurden alle in-Box-WIC-Codecs aktualisiert, um MTAs zu unterstützen, einschließlich JPEG, TIFF, PNG, GIF, ICO und BMP.</span><span class="sxs-lookup"><span data-stu-id="d84bb-149">In Windows 7, all in-box WIC CODECs have been updated to support MTAs, including JPEG, TIFF, PNG, GIF, ICO, and BMP.</span></span> <span data-ttu-id="d84bb-150">Drittanbieter-Codecs, die MTAs nicht unterstützen, führen aufgrund von Marshalling zu erheblichen Leistungseinbußen in Multithreadanwendungen.</span><span class="sxs-lookup"><span data-stu-id="d84bb-150">3rd-party CODECs that do not to support MTAs will cause significant performance costs in multithreaded applications due to marshaling.</span></span> <span data-ttu-id="d84bb-151">Zum Aktivieren der MTA-Unterstützung muss die ordnungsgemäße Synchronisierung im Drittanbieter-Codec implementiert werden.</span><span class="sxs-lookup"><span data-stu-id="d84bb-151">Enabling MTA support requires proper synchronization to be implemented in the 3rd-party CODEC.</span></span> <span data-ttu-id="d84bb-152">Die genaue Implementierung dieser Synchronisierungs Verfahren geht über den Rahmen dieses Artikels hinaus.</span><span class="sxs-lookup"><span data-stu-id="d84bb-152">Exact implementation of these synchronization techniques is beyond the scope of this paper.</span></span> <span data-ttu-id="d84bb-153">Eine allgemeine Referenz zum Synchronisieren von COM-Objekten finden Sie unten.</span><span class="sxs-lookup"><span data-stu-id="d84bb-153">A general reference for synchronizing COM objects is provided below.</span></span>

    https://msdn.microsoft.com/library/ms809971.aspx

## <a name="related-topics"></a><span data-ttu-id="d84bb-154">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="d84bb-154">Related topics</span></span>

<dl> <dt>

<span data-ttu-id="d84bb-155">**Licher**</span><span class="sxs-lookup"><span data-stu-id="d84bb-155">**Conceptual**</span></span>
</dt> <dt>

[<span data-ttu-id="d84bb-156">Übersicht über die Windows Imaging-Komponente</span><span class="sxs-lookup"><span data-stu-id="d84bb-156">Windows Imaging Component Overview</span></span>](-wic-about-windows-imaging-codec.md)
</dt> <dt>

[<span data-ttu-id="d84bb-157">WIC-Richtlinien für Kamera Rohbild Formate</span><span class="sxs-lookup"><span data-stu-id="d84bb-157">WIC Guidelines for Camera RAW Image Formats</span></span>](-wic-rawguidelines.md)
</dt> <dt>

[<span data-ttu-id="d84bb-158">Schreiben eines WIC-Enabled Codecs</span><span class="sxs-lookup"><span data-stu-id="d84bb-158">How to Write a WIC-Enabled CODEC</span></span>](-wic-howtowriteacodec.md)
</dt> </dl>

 

 



