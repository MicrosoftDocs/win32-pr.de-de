---
title: Verwenden der Remotedesktopverbindung Broker-Client-API
description: Die Remotedesktopverbindung Broker-Client-API ermöglicht es Protokoll Anbietern von Drittanbietern, den Verbindungs Broker zu nutzen, um die Handhabung von Verbindungen zu beschleunigen, die das Protokoll für die Verbindung mit virtuellen Computern oder Remotedesktop Servern in einer Farm verwenden.
ms.assetid: 05C2D6CA-C9C5-4783-B196-6A02918046EF
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c931245870cfb72aed54e5aaff24e12d03ddf9e7
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/20/2020
ms.locfileid: "104316185"
---
# <a name="how-to-use-the-remote-desktop-connection-broker-client-api"></a><span data-ttu-id="ea14b-103">Verwenden der Remotedesktopverbindung Broker-Client-API</span><span class="sxs-lookup"><span data-stu-id="ea14b-103">How to use the Remote Desktop Connection Broker client API</span></span>

<span data-ttu-id="ea14b-104">Die Remotedesktopverbindung Broker-Client-API ermöglicht es Protokoll Anbietern von Drittanbietern, den Verbindungs Broker zu nutzen, um die Handhabung von Verbindungen zu beschleunigen, die das Protokoll für die Verbindung mit virtuellen Computern oder Remotedesktop Servern in einer Farm verwenden.</span><span class="sxs-lookup"><span data-stu-id="ea14b-104">The Remote Desktop Connection Broker client API allows third party protocol vendors to leverage the Connection Broker to expedite the handling of connections that use their protocol to connect to virtual machines or Remote Desktop servers in a farm.</span></span>

## <a name="instructions"></a><span data-ttu-id="ea14b-105">Anweisungen</span><span class="sxs-lookup"><span data-stu-id="ea14b-105">Instructions</span></span>

### <a name="step-1-obtain-the-iconnectionbrokerclient-interface"></a><span data-ttu-id="ea14b-106">Schritt 1: Abrufen der iconnectionbrokerclient-Schnittstelle</span><span class="sxs-lookup"><span data-stu-id="ea14b-106">Step 1: Obtain the IConnectionBrokerClient interface</span></span>

<span data-ttu-id="ea14b-107">Führen Sie die folgenden Schritte aus, wenn Ihre Anwendung oder Ihr Protokoll Anbieter initialisiert ist.</span><span class="sxs-lookup"><span data-stu-id="ea14b-107">When your application or protocol provider is initialized, perform the following steps.</span></span>

1.  <span data-ttu-id="ea14b-108">Rufen Sie die [**cbkreateclientinstance**](cbcreateclientinstance.md) -Funktion auf, um die [**iconnectionbrokerclient**](iconnectionbrokerclient.md) -Schnittstelle abzurufen.</span><span class="sxs-lookup"><span data-stu-id="ea14b-108">Call the [**CBCreateClientInstance**](cbcreateclientinstance.md) function to obtain the [**IConnectionBrokerClient**](iconnectionbrokerclient.md) interface.</span></span>
2.  <span data-ttu-id="ea14b-109">Behalten Sie die Schnittstelle [**iconnectionbrokerclient**](iconnectionbrokerclient.md) bei, solange Sie Sie benötigen.</span><span class="sxs-lookup"><span data-stu-id="ea14b-109">Keep the [**IConnectionBrokerClient**](iconnectionbrokerclient.md) interface as long as you need it.</span></span>
3.  <span data-ttu-id="ea14b-110">Wenn die Schnittstelle [**iconnectionbrokerclient**](iconnectionbrokerclient.md) nicht mehr benötigt wird, können Sie die [**releasemethode**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-release) aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="ea14b-110">When the [**IConnectionBrokerClient**](iconnectionbrokerclient.md) interface is no longer needed, call the [**Release**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-release) method.</span></span>

### <a name="step-2-request-the-target-information"></a><span data-ttu-id="ea14b-111">Schritt 2: Anfordern der Ziel Informationen</span><span class="sxs-lookup"><span data-stu-id="ea14b-111">Step 2: Request the target information</span></span>

<span data-ttu-id="ea14b-112">Wenn Ihr Protokoll Anbieter eine eingehende Verbindungsanforderung empfängt, führen Sie die folgenden Schritte aus, um die [**iconnectionbrokerclient:: gettargetinfo**](iconnectionbrokerclient-gettargetinfo.md) -Methode aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="ea14b-112">When your protocol provider receives an incoming connection request, perform the following steps to call the [**IConnectionBrokerClient::GetTargetInfo**](iconnectionbrokerclient-gettargetinfo.md) method.</span></span> <span data-ttu-id="ea14b-113">Diese Methode ruft aus dem Verbindungs Broker den entsprechenden Server ab, um die Verbindung zu umzuleiten.</span><span class="sxs-lookup"><span data-stu-id="ea14b-113">This method obtains, from the Connection Broker, the appropriate server to redirect the connection to.</span></span>

1.  <span data-ttu-id="ea14b-114">Erstellen Sie ein Ereignis, das mithilfe der Funktion " [**kreateevent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa)" oder einer ähnlichen Funktion signalisiert werden kann, um Sie für den *hstatus usevent* -Parameter zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="ea14b-114">Create an event that can be signaled using the [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa), or similar function, to use for the *hStatusEvent* parameter.</span></span>
2.  <span data-ttu-id="ea14b-115">Zuweisen von Arbeitsspeicher für die Parameter *ptargetinfo* und *pResult* .</span><span class="sxs-lookup"><span data-stu-id="ea14b-115">Allocate memory for the *pTargetInfo* and *pResult* parameters.</span></span> <span data-ttu-id="ea14b-116">Diese Speicherblöcke müssen beibehalten werden, bis die gesamte Sequenz vollständig ist.</span><span class="sxs-lookup"><span data-stu-id="ea14b-116">These memory blocks must remain in place until after this entire sequence is complete.</span></span>
3.  <span data-ttu-id="ea14b-117">Füllen Sie eine [**CB \_ - \_ Verbindungs**](cb-connection-info.md) Informationsstruktur aus, die alle Informationen über die eingehende Verbindung enthält.</span><span class="sxs-lookup"><span data-stu-id="ea14b-117">Fill out a [**CB\_CONNECTION\_INFO**](cb-connection-info.md) structure that contains all of the information about the incoming connection.</span></span>
4.  <span data-ttu-id="ea14b-118">Nennen Sie die [**gettargetinfo**](iconnectionbrokerclient-gettargetinfo.md) -Methode, und übergeben Sie alle erforderlichen Parameter.</span><span class="sxs-lookup"><span data-stu-id="ea14b-118">Call the [**GetTargetInfo**](iconnectionbrokerclient-gettargetinfo.md) method, passing all of the required parameters.</span></span> <span data-ttu-id="ea14b-119">Dabei handelt es sich um eine asynchrone Methode, die eine Instanz der [**iconnectionbrokerrequest**](iconnectionbrokerrequest.md) -Schnittstelle zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="ea14b-119">This is an asynchronous method that will return an instance of the [**IConnectionBrokerRequest**](iconnectionbrokerrequest.md) interface.</span></span>
5.  <span data-ttu-id="ea14b-120">Warten Sie, bis das *hstatus usevent* -Ereignis festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="ea14b-120">Wait for the *hStatusEvent* event to become set.</span></span>
6.  <span data-ttu-id="ea14b-121">Wenn das *hstatusevent* -Ereignis festgelegt ist, müssen Sie die [**iconnectionbrokerrequest:: CheckStatus**](iconnectionbrokerrequest-checkstatus.md) -Methode aufrufen, um den Status der Anforderung zu bestimmen.</span><span class="sxs-lookup"><span data-stu-id="ea14b-121">Whenever the *hStatusEvent* event is set, call the [**IConnectionBrokerRequest::CheckStatus**](iconnectionbrokerrequest-checkstatus.md) method to determine the status of the request.</span></span>
7.  <span data-ttu-id="ea14b-122">Wenn von [**CheckStatus**](iconnectionbrokerrequest-checkstatus.md) die **\_ Status \_ Anforderung \_ "CB**" zurückgegeben wird, enthalten die Parameter *ptargetinfo* und *pResult* Ihre Informationen.</span><span class="sxs-lookup"><span data-stu-id="ea14b-122">When [**CheckStatus**](iconnectionbrokerrequest-checkstatus.md) returns **CB\_STATUS\_REQUEST\_COMPLETED**, the *pTargetInfo* and *pResult* parameters will contain their information.</span></span> <span data-ttu-id="ea14b-123">Sie können die Warteschleife abbrechen, da der *hstatus usevent* -Parameter nicht mehr verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="ea14b-123">You can break out of the wait loop because the *hStatusEvent* parameter will no longer be used.</span></span>
8.  <span data-ttu-id="ea14b-124">Verwenden Sie die Informationen in der [**CB- \_ Ziel \_**](cb-target-info.md) Informationsstruktur, die vom *ptargetinfo* -Parameter dargestellt wird, um zu bestimmen, wohin die eingehende Verbindung umgeleitet werden soll.</span><span class="sxs-lookup"><span data-stu-id="ea14b-124">Use the information in the [**CB\_TARGET\_INFO**](cb-target-info.md) structure represented by the *pTargetInfo* parameter to determine where to redirect the incoming connection to.</span></span>
9.  <span data-ttu-id="ea14b-125">Geben Sie die [**iconnectionbrokerrequest**](iconnectionbrokerrequest.md) -Schnittstelle frei.</span><span class="sxs-lookup"><span data-stu-id="ea14b-125">Release the [**IConnectionBrokerRequest**](iconnectionbrokerrequest.md) interface.</span></span>
10. <span data-ttu-id="ea14b-126">Schließen Sie das *hstatus usevent* -Ereignis handle, oder können Sie es für nachfolgende Verbindungsanforderungen wieder verwenden.</span><span class="sxs-lookup"><span data-stu-id="ea14b-126">Close the *hStatusEvent* event handle, or you can reuse it for subsequent connection requests.</span></span>

 

 