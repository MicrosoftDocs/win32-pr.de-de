---
title: Schannel
description: Das Sicherheitspaket Secure Channel (SChannel), dessen Authentifizierungsdienst Bezeichner RPC \_ C \_ authn \_ GSS \_ SChannel ist, unterstützt die folgenden öffentlichen Schlüssel basierten Protokolle SSL (Secure Sockets Layer), Version 2,0 und 3,0, Transport Layer Security (TLS) 1,0 und private Kommunikationstechnologie (PCT) 1,0. TLS 1,0 ist eine standardisierte, leicht geänderte Version von SSL 3,0, die von der Internet Engineering Task Force (IETF) im Januar 1999 im Dokument RFC 2246 ausgegeben wurde. Da TLS standardisiert ist, wird empfohlen, TLS anstelle von SSL zu verwenden. PCT ist nur aus Gründen der Abwärtskompatibilität enthalten und sollte nicht für die neue Entwicklung verwendet werden. Wenn das SChannel-Sicherheitspaket verwendet wird, aushandt DCOM automatisch das beste Protokoll, abhängig von den Client-und Serverfunktionen.
ms.assetid: 03a5f987-f668-4f19-9b58-d62711f58734
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: eccc9f82a05d1542e7585426128f10cdf452d31d
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/21/2020
ms.locfileid: "104316569"
---
# <a name="schannel"></a><span data-ttu-id="65ccd-107">Schannel</span><span class="sxs-lookup"><span data-stu-id="65ccd-107">Schannel</span></span>

<span data-ttu-id="65ccd-108">Das Sicherheitspaket Secure Channel (SChannel), dessen Authentifizierungsdienst Bezeichner RPC \_ C \_ authn \_ GSS \_ SChannel ist, unterstützt die folgenden öffentlichen Schlüssel basierten Protokolle: SSL (Secure Sockets Layer) Version 2,0 und 3,0, Transport Layer Security (TLS) 1,0 und private Kommunikationstechnologie (PCT) 1,0.</span><span class="sxs-lookup"><span data-stu-id="65ccd-108">The Secure Channel (Schannel) security package, whose authentication service identifier is RPC\_C\_AUTHN\_GSS\_SCHANNEL, supports the following public-key based protocols: SSL (Secure Sockets Layer) versions 2.0 and 3.0, Transport Layer Security (TLS) 1.0, and Private Communication Technology (PCT) 1.0.</span></span> <span data-ttu-id="65ccd-109">TLS 1,0 ist eine standardisierte, leicht geänderte Version von SSL 3,0, die von der Internet Engineering Task Force (IETF) im Januar 1999 im Dokument [RFC 2246](https://www.ietf.org/rfc/rfc2246.txt)ausgegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="65ccd-109">TLS 1.0 is a standardized, slightly modified version of SSL 3.0 that was issued by the Internet Engineering Task Force (IETF) in January 1999, in document [RFC 2246](https://www.ietf.org/rfc/rfc2246.txt).</span></span> <span data-ttu-id="65ccd-110">Da TLS standardisiert ist, wird empfohlen, TLS anstelle von SSL zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="65ccd-110">Because TLS has been standardized, developers are encouraged to use TLS rather than SSL.</span></span> <span data-ttu-id="65ccd-111">PCT ist nur aus Gründen der Abwärtskompatibilität enthalten und sollte nicht für die neue Entwicklung verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="65ccd-111">PCT is included for backward compatibility only and should not be used for new development.</span></span> <span data-ttu-id="65ccd-112">Wenn das SChannel-Sicherheitspaket verwendet wird, aushandt DCOM automatisch das beste Protokoll, abhängig von den Client-und Serverfunktionen.</span><span class="sxs-lookup"><span data-stu-id="65ccd-112">When the Schannel security package is used, DCOM automatically negotiates the best protocol, depending on the client and server capabilities.</span></span>

<span data-ttu-id="65ccd-113">In den folgenden Themen wird das TLS-Protokoll kurz beschrieben und erläutert, wie es mit DCOM funktioniert.</span><span class="sxs-lookup"><span data-stu-id="65ccd-113">The following topics briefly describe the TLS protocol and how it works with DCOM.</span></span>

-   [<span data-ttu-id="65ccd-114">Verwendung von TLS</span><span class="sxs-lookup"><span data-stu-id="65ccd-114">When to Use TLS</span></span>](#when-to-use-tls)
-   [<span data-ttu-id="65ccd-115">Kurze Übersicht über die Funktionsweise von TLS</span><span class="sxs-lookup"><span data-stu-id="65ccd-115">Brief Overview of How TLS Works</span></span>](#brief-overview-of-how-tls-works)
-   [<span data-ttu-id="65ccd-116">X. 509-Zertifikate</span><span class="sxs-lookup"><span data-stu-id="65ccd-116">X.509 Certificates</span></span>](#x509-certificates)
    -   [<span data-ttu-id="65ccd-117">Clientzertifikate</span><span class="sxs-lookup"><span data-stu-id="65ccd-117">Client Certificates</span></span>](#client-certificates)
-   [<span data-ttu-id="65ccd-118">Verwenden von TLS in com</span><span class="sxs-lookup"><span data-stu-id="65ccd-118">Using TLS in COM</span></span>](#using-tls-in-com)
    -   [<span data-ttu-id="65ccd-119">Festlegen der Sicherheits Pauschale durch einen Server</span><span class="sxs-lookup"><span data-stu-id="65ccd-119">How a Server Sets the Security Blanket</span></span>](#how-a-server-sets-the-security-blanket)
    -   [<span data-ttu-id="65ccd-120">Festlegen der Sicherheits Pauschale durch einen Client</span><span class="sxs-lookup"><span data-stu-id="65ccd-120">How a Client Sets the Security Blanket</span></span>](#how-a-client-sets-the-security-blanket)
    -   [<span data-ttu-id="65ccd-121">Ändern der Sicherheits Pauschale durch einen Client</span><span class="sxs-lookup"><span data-stu-id="65ccd-121">How a Client Changes the Security Blanket</span></span>](#how-a-client-changes-the-security-blanket)
    -   [<span data-ttu-id="65ccd-122">Beispiel: Client ändert die Sicherheits Pauschale</span><span class="sxs-lookup"><span data-stu-id="65ccd-122">Example: Client Changes the Security Blanket</span></span>](#example-client-changes-the-security-blanket)
-   [<span data-ttu-id="65ccd-123">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="65ccd-123">Related topics</span></span>](#related-topics)

> [!Note]  
> <span data-ttu-id="65ccd-124">Alle Informationen über das TLS-Protokoll in diesen Abschnitten gelten auch für die Protokolle SSL und PCT.</span><span class="sxs-lookup"><span data-stu-id="65ccd-124">All the information about the TLS protocol in these sections also applies to the SSL and PCT protocols.</span></span>

 

## <a name="when-to-use-tls"></a><span data-ttu-id="65ccd-125">Verwendung von TLS</span><span class="sxs-lookup"><span data-stu-id="65ccd-125">When to Use TLS</span></span>

<span data-ttu-id="65ccd-126">TLS ist die einzige Sicherheitsoption, die verfügbar ist, wenn Server Ihre Identität anonymen Clients nachweisen müssen.</span><span class="sxs-lookup"><span data-stu-id="65ccd-126">TLS is the only security option available when servers need to prove their identity to anonymous clients.</span></span> <span data-ttu-id="65ccd-127">Dies ist besonders wichtig für Websites, die an e-Commerce teilnehmen möchten, da Sie dabei helfen, die Übertragung vertraulicher Informationen, wie Kreditkartennummern, zu schützen.</span><span class="sxs-lookup"><span data-stu-id="65ccd-127">This is particularly important for websites that want to participate in e-commerce because it helps protect the transmission of sensitive information such as credit card numbers.</span></span> <span data-ttu-id="65ccd-128">TLS stellt sicher, dass die e-Commerce-Kunden sicher sein können, mit wem Sie Geschäfte betreiben, weil Sie einen Nachweis für die Identität des Servers erhalten.</span><span class="sxs-lookup"><span data-stu-id="65ccd-128">TLS assures that the e-commerce customers can be certain of whom they are doing business with because they are given proof of the server's identity.</span></span> <span data-ttu-id="65ccd-129">Außerdem ist der e-Commerce-Server der Effizienz, dass er sich nicht mit der Authentifizierung der Identität seiner Kunden befassen muss.</span><span class="sxs-lookup"><span data-stu-id="65ccd-129">It also gives the e-commerce server the efficiency of not having to concern itself with authenticating the identity of each of its customers.</span></span>

<span data-ttu-id="65ccd-130">TLS erfordert, dass alle Server deren Identität für Clients nachweisen.</span><span class="sxs-lookup"><span data-stu-id="65ccd-130">TLS requires that all servers prove their identity to clients.</span></span> <span data-ttu-id="65ccd-131">Außerdem bietet TLS die Möglichkeit, Clients die Identität der Server nachzuweisen.</span><span class="sxs-lookup"><span data-stu-id="65ccd-131">Additionally, TLS provides the option of having clients prove their identity to servers.</span></span> <span data-ttu-id="65ccd-132">Diese gegenseitige Authentifizierung kann nützlich sein, um den Zugriff auf bestimmte Webseiten in einem großen Unternehmens Intranet einzuschränken.</span><span class="sxs-lookup"><span data-stu-id="65ccd-132">This mutual authentication can be useful in restricting the access of certain webpages in a large corporate intranet.</span></span>

<span data-ttu-id="65ccd-133">TLS unterstützt die stärksten Authentifizierungs Ebenen und bietet eine offene Architektur, mit der sich die Verschlüsselungsstärke im Laufe der Zeit erhöhen lässt, um technologische Innovationen aufrechtzuerhalten.</span><span class="sxs-lookup"><span data-stu-id="65ccd-133">TLS supports the strongest authentication levels and offers an open architecture that permits encryption strength to increase over time to keep up with technological innovation.</span></span> <span data-ttu-id="65ccd-134">TLS ist die beste Wahl für Umgebungen, in denen das höchste Maß an Sicherheit für die Daten während der Übertragung gewünscht ist.</span><span class="sxs-lookup"><span data-stu-id="65ccd-134">TLS is the best choice for environments where the highest level of security is desired for the data in transit.</span></span>

## <a name="brief-overview-of-how-tls-works"></a><span data-ttu-id="65ccd-135">Kurze Übersicht über die Funktionsweise von TLS</span><span class="sxs-lookup"><span data-stu-id="65ccd-135">Brief Overview of How TLS Works</span></span>

<span data-ttu-id="65ccd-136">TLS basiert auf einer Public Key-Infrastruktur (PKI), die öffentliche/private Schlüsselpaare zum Aktivieren der Datenverschlüsselung und zum Einrichten der Datenintegrität verwendet und X. 509-Zertifikate für die Authentifizierung verwendet.</span><span class="sxs-lookup"><span data-stu-id="65ccd-136">TLS is built upon a public key infrastructure (PKI), which uses public/private key pairs for enabling data encryption and establishing data integrity, and uses X.509 certificates for authentication.</span></span>

<span data-ttu-id="65ccd-137">Viele Sicherheitsprotokolle, z. b. das Kerberos V5-Protokoll, sind von einem einzigen Schlüssel zum Verschlüsseln und Entschlüsseln von Daten abhängig.</span><span class="sxs-lookup"><span data-stu-id="65ccd-137">Many security protocols, such as the Kerberos v5 protocol, depend on a single key to both encrypt and decrypt data.</span></span> <span data-ttu-id="65ccd-138">Solche Protokolle hängen daher vom sicheren Austausch der Verschlüsselungsschlüssel ab. im Kerberos-Protokoll erfolgt dies über Tickets, die aus dem Schlüsselverteilungscenter (KDC) abgerufen wurden.</span><span class="sxs-lookup"><span data-stu-id="65ccd-138">Such protocols therefore depend on the secure exchange of encryption keys; in the Kerberos protocol, this is done through tickets obtained from the Key Distribution Center (KDC).</span></span> <span data-ttu-id="65ccd-139">Dies erfordert, dass jeder, der das Kerberos-Protokoll verwendet, beim KDC registriert wird. Dies wäre eine unpraktische Einschränkung für einen e-Commerce-Webserver, der Millionen von Kunden aus der ganzen Welt gewinnen soll.</span><span class="sxs-lookup"><span data-stu-id="65ccd-139">This requires that everyone using the Kerberos protocol be registered with the KDC, which would be an impractical limitation for an e-commerce web server that is intended to attract millions of customers from around the world.</span></span> <span data-ttu-id="65ccd-140">TLS basiert daher auf einer PKI, die zwei Schlüssel für die Datenverschlüsselung verwendet: Wenn ein Schlüssel des Paars die Daten verschlüsselt, kann er nur vom anderen Schlüssel des Paars entschlüsselt werden.</span><span class="sxs-lookup"><span data-stu-id="65ccd-140">TLS therefore relies upon a PKI, which uses two keys for data encryptionâ€”when one key of the pair encrypts the data, only the other key of the pair can decrypt it.</span></span> <span data-ttu-id="65ccd-141">Der Grund Vorteil dieses Entwurfs ist, dass die Verschlüsselung ohne den sicheren Austausch von Verschlüsselungsschlüsseln ausgeführt werden kann.</span><span class="sxs-lookup"><span data-stu-id="65ccd-141">The principle benefit of this design is that encryption can be performed without requiring the secure exchange of encryption keys.</span></span>

<span data-ttu-id="65ccd-142">Eine PKI verwendet eine Technik, bei der einer der Schlüssel privat gehalten wird und nur für den Prinzipal verfügbar ist, für den er registriert ist, während der andere Schlüssel für jeden zugänglich gemacht wird.</span><span class="sxs-lookup"><span data-stu-id="65ccd-142">A PKI uses a technique where one of the keys is kept private and is available only to the principal to whom it is registered, while the other key is made public for anyone to access.</span></span> <span data-ttu-id="65ccd-143">Wenn jemand eine private Nachricht an den Besitzer eines Schlüssel Paars senden möchte, kann die Nachricht mit dem öffentlichen Schlüssel verschlüsselt werden, und nur der private Schlüssel kann zum Entschlüsseln der Nachricht verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="65ccd-143">If someone wants to send a private message to the owner of a key pair, the message can be encrypted with the public key and only the private key can be used to decrypt the message.</span></span>

<span data-ttu-id="65ccd-144">Schlüsselpaare werden auch verwendet, um die Integrität der Daten zu überprüfen, die gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="65ccd-144">Key pairs are also used to verify the integrity of the data being sent.</span></span> <span data-ttu-id="65ccd-145">Zu diesem Zweck kann der Besitzer des Schlüssel Paars eine digitale Signatur an die Daten anfügen, bevor Sie gesendet wird.</span><span class="sxs-lookup"><span data-stu-id="65ccd-145">To do this, the owner of the key pair can attach a digital signature to the data before sending it.</span></span> <span data-ttu-id="65ccd-146">Das Erstellen einer digitalen Signatur umfasst das Berechnen eines Hash der Daten und das Verschlüsseln des Hashs mit dem privaten Schlüssel.</span><span class="sxs-lookup"><span data-stu-id="65ccd-146">Creating a digital signature involves calculating a hash of the data and encrypting the hash with the private key.</span></span> <span data-ttu-id="65ccd-147">Jeder Benutzer, der den öffentlichen Schlüssel verwendet, um die digitale Signatur zu entschlüsseln, ist sicher, dass die digitale Signatur nur von der Person stammen muss, die den privaten Schlüssel besitzt.</span><span class="sxs-lookup"><span data-stu-id="65ccd-147">Anyone who uses the public key to decrypt the digital signature is assured that the digital signature must have come only from the person who owns the private key.</span></span> <span data-ttu-id="65ccd-148">Außerdem kann der Empfänger einen Hash der Daten mit dem gleichen Algorithmus wie der Absender berechnen, und wenn der berechnete Hash mit dem Wert übereinstimmt, der in der digitalen Signatur gesendet wurde, kann der Empfänger sicher sein, dass die Daten nicht geändert wurden, nachdem Sie digital signiert wurden.</span><span class="sxs-lookup"><span data-stu-id="65ccd-148">Additionally, the recipient can calculate a hash of the data using the same algorithm as the sender, and if the calculated hash matches the one sent in the digital signature, the recipient can be certain that the data was not modified after it was digitally signed.</span></span>

<span data-ttu-id="65ccd-149">Ein Nachteil bei der Verwendung einer PKI für die Verschlüsselung großer Datenmengen ist die relativ langsame Leistung.</span><span class="sxs-lookup"><span data-stu-id="65ccd-149">One disadvantage of using a PKI for high-volume data encryption is its relatively slow performance.</span></span> <span data-ttu-id="65ccd-150">Aufgrund der intensiven Mathematik kann die Verschlüsselung und Entschlüsselung von Daten mithilfe einer asymmetrischen Chiffre, die von einem Schlüsselpaar abhängt, bis zu 1.000 mal langsamer sein als die Verschlüsselung und Entschlüsselung mithilfe einer symmetrischen Chiffre, die nur von einem einzelnen Schlüssel abhängt.</span><span class="sxs-lookup"><span data-stu-id="65ccd-150">Because of the intensive mathematics involved, encryption and decryption of data using an asymmetric cipher that depends on a key pair can be up to 1,000 times slower than encryption and decryption using a symmetric cipher that depends only on a single key.</span></span> <span data-ttu-id="65ccd-151">TLS verwendet daher eine PKI nur zum Erstellen digitaler Signaturen und zum Aushandeln des Sitzungs spezifischen Single Key, der sowohl vom Client als auch vom Server für die Verschlüsselung und Entschlüsselung von Massendaten verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="65ccd-151">TLS therefore uses a PKI only for generating digital signatures and for negotiating the session-specific single key that will be used by both the client and the server for bulk data encryption and decryption.</span></span> <span data-ttu-id="65ccd-152">TLS unterstützt eine Vielzahl von symmetrischen symmetrischen Chiffren mit einem einzelnen Schlüssel, und in Zukunft können weitere Chiffren hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="65ccd-152">TLS supports a wide variety of single-key symmetric ciphers, and additional ciphers may be added in the future.</span></span>

<span data-ttu-id="65ccd-153">Weitere Informationen zum TLS-Handshake-Protokoll finden Sie unter [TLS-Handshake-Protokoll](/windows/desktop/SecAuthN/tls-handshake-protocol).</span><span class="sxs-lookup"><span data-stu-id="65ccd-153">For more information about the TLS handshake protocol, see [TLS Handshake Protocol](/windows/desktop/SecAuthN/tls-handshake-protocol).</span></span>

<span data-ttu-id="65ccd-154">Weitere Informationen zur Kryptografie hinter dem TLS-Protokoll finden Sie unter [Kryptografie Essentials](/windows/desktop/SecCrypto/cryptography-essentials).</span><span class="sxs-lookup"><span data-stu-id="65ccd-154">For more details regarding the cryptography behind the TLS protocol, see [Cryptography Essentials](/windows/desktop/SecCrypto/cryptography-essentials).</span></span>

## <a name="x509-certificates"></a><span data-ttu-id="65ccd-155">X.509-Zertifikate</span><span class="sxs-lookup"><span data-stu-id="65ccd-155">X.509 Certificates</span></span>

<span data-ttu-id="65ccd-156">Ein wichtiges Problem, das von einer PKI behandelt werden muss, ist die Fähigkeit, der Authentizität des verwendeten öffentlichen Schlüssels zu vertrauen.</span><span class="sxs-lookup"><span data-stu-id="65ccd-156">A critical issue that must be handled by a PKI is the ability to trust the authenticity of the public key that is being used.</span></span> <span data-ttu-id="65ccd-157">Wenn Sie einen öffentlichen Schlüssel verwenden, der für ein Unternehmen ausgestellt wurde, mit dem Sie Geschäfte ausführen möchten, sollten Sie sicher sein, dass der Schlüssel eigentlich zum Unternehmen gehört und nicht zu einem Dieb, der Ihre Kreditkartennummer ermitteln möchte.</span><span class="sxs-lookup"><span data-stu-id="65ccd-157">When you use a public key issued to a company that you want to do business with, you want to be certain that the key actually belongs to the company rather than to a thief who wants to discover your credit card number.</span></span>

<span data-ttu-id="65ccd-158">Um die Identität eines Prinzipals zu gewährleisten, der ein Schlüsselpaar enthält, wird dem Prinzipal ein X. 509-Zertifikat von einer Zertifizierungsstelle (Certification Authority, ca) ausgestellt.</span><span class="sxs-lookup"><span data-stu-id="65ccd-158">To guarantee the identity of a principal holding a key pair, the principal is issued an X.509 certificate by a certification authority (CA).</span></span> <span data-ttu-id="65ccd-159">Dieses Zertifikat enthält Informationen, mit denen der Prinzipal identifiziert wird, der öffentliche Schlüssel des Prinzipals enthält und von der Zertifizierungsstelle digital signiert wurde.</span><span class="sxs-lookup"><span data-stu-id="65ccd-159">This certificate contains information that identifies the principal, contains the principal's public key, and is digitally signed by the CA.</span></span> <span data-ttu-id="65ccd-160">Diese digitale Signatur gibt an, dass die Zertifizierungsstelle der Ansicht ist, dass der im Zertifikat enthaltene öffentliche Schlüssel wirklich dem Prinzipal angehört, der durch das Zertifikat identifiziert wird.</span><span class="sxs-lookup"><span data-stu-id="65ccd-160">This digital signature indicates that the CA believes that the public key contained in the certificate truly belongs to the principal identified by the certificate.</span></span>

<span data-ttu-id="65ccd-161">Und wie Vertrauen Sie der Zertifizierungsstelle?</span><span class="sxs-lookup"><span data-stu-id="65ccd-161">And how do you trust the CA?</span></span> <span data-ttu-id="65ccd-162">Da die Zertifizierungsstelle selbst ein X. 509-Zertifikat enthält, das von einer Zertifizierungsstelle höherer Ebene signiert wurde.</span><span class="sxs-lookup"><span data-stu-id="65ccd-162">Because the CA itself holds an X.509 certificate that has been signed by a higher-level CA.</span></span> <span data-ttu-id="65ccd-163">Diese Kette von Zertifikat Signaturen wird so lange fortgesetzt, bis eine Stamm Zertifizierungsstelle erreicht wird. Dies ist eine Zertifizierungsstelle, die eigene Zertifikate signiert</span><span class="sxs-lookup"><span data-stu-id="65ccd-163">This chain of certificate signatures continues until it reaches a root CA, which is a CA that signs its own certificates.</span></span> <span data-ttu-id="65ccd-164">Wenn Sie der Integrität der Stamm Zertifizierungsstelle eines Zertifikats vertrauen, sollten Sie die Echtheit des Zertifikats als vertrauenswürdig einstufen.</span><span class="sxs-lookup"><span data-stu-id="65ccd-164">If you trust the integrity of the root CA of a certificate, you should be able to trust the authenticity of the certificate itself.</span></span> <span data-ttu-id="65ccd-165">Daher ist die Auswahl von Stamm Zertifizierungsstellen, denen Sie vertrauen möchten, eine wichtige Aufgabe für einen Systemadministrator.</span><span class="sxs-lookup"><span data-stu-id="65ccd-165">Therefore, picking root CAs that you are willing to trust is an important duty for a system administrator.</span></span>

### <a name="client-certificates"></a><span data-ttu-id="65ccd-166">Clientzertifikate</span><span class="sxs-lookup"><span data-stu-id="65ccd-166">Client Certificates</span></span>

<span data-ttu-id="65ccd-167">Als erster Grund für das Übertragen von Sicherheitsprotokollen war es, sicherzustellen, dass ein Client eine Verbindung mit einem authentischen Server hergestellt und den Datenschutz während der Übertragung schützt.</span><span class="sxs-lookup"><span data-stu-id="65ccd-167">When security transport-layer protocols first emerged, their primary purpose was to guarantee that a client was connecting to an authentic server and help protect the privacy of data while in transit.</span></span> <span data-ttu-id="65ccd-168">SSL 3,0 und TLS 1,0 enthalten jedoch auch Unterstützung für die Übertragung eines Client Zertifikats während des Protokoll Handshakes.</span><span class="sxs-lookup"><span data-stu-id="65ccd-168">However, SSL 3.0 and TLS 1.0 also include support for the transmission of a client's certificate during the protocol's handshake.</span></span> <span data-ttu-id="65ccd-169">Diese optionale Funktion ermöglicht die gegenseitige Authentifizierung des Clients und des Servers.</span><span class="sxs-lookup"><span data-stu-id="65ccd-169">This optional feature enables the mutual authentication of the client and server.</span></span>

<span data-ttu-id="65ccd-170">Die Entscheidung, ob ein Client Zertifikat verwendet werden soll, sollte im Kontext der Anwendung vorgenommen werden.</span><span class="sxs-lookup"><span data-stu-id="65ccd-170">The decision of whether to use a client certificate should be made in the context of the application.</span></span> <span data-ttu-id="65ccd-171">Client Zertifikate sind nicht erforderlich, wenn der Server von der primären Anforderung authentifiziert wird.</span><span class="sxs-lookup"><span data-stu-id="65ccd-171">Client certificates are unnecessary if the primary requirement is authenticating the server.</span></span> <span data-ttu-id="65ccd-172">Wenn die Client Authentifizierung jedoch unverzichtbar ist, kann das Zertifikat eines Clients verwendet werden, anstatt sich auf die benutzerdefinierte Authentifizierung innerhalb der Anwendung zu verlassen.</span><span class="sxs-lookup"><span data-stu-id="65ccd-172">However, if client authentication is essential, a client's certificate can be used rather than relying on custom authentication within the application.</span></span> <span data-ttu-id="65ccd-173">Die Verwendung von Client Zertifikaten ist besser als die benutzerdefinierte Authentifizierung, da Sie Benutzern ein Single Sign-on Szenario bietet.</span><span class="sxs-lookup"><span data-stu-id="65ccd-173">Using client certificates is preferable over custom authentication because it gives users a single sign-on scenario.</span></span>

## <a name="using-tls-in-com"></a><span data-ttu-id="65ccd-174">Verwenden von TLS in com</span><span class="sxs-lookup"><span data-stu-id="65ccd-174">Using TLS in COM</span></span>

<span data-ttu-id="65ccd-175">TLS unterstützt nur die Identitätswechsel Ebene des Identitäts Wechsels (RPC- \_ C- \_ IMP- \_ Ebene \_ ).</span><span class="sxs-lookup"><span data-stu-id="65ccd-175">TLS supports only the impersonate (RPC\_C\_IMP\_LEVEL\_IMPERSONATE) level of impersonation.</span></span> <span data-ttu-id="65ccd-176">Wenn com TLS als Authentifizierungsdienst auf einem Proxy aushandt, wird die Identitätswechsel Ebene von com unabhängig von der ProzessStandard Einstellung so festgelegt, dass der Identitätswechsel durchgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="65ccd-176">If COM negotiates TLS as the authentication service on a proxy, COM will set the impersonation level to impersonate regardless of the process default.</span></span> <span data-ttu-id="65ccd-177">Damit der Identitätswechsel in TLS ordnungsgemäß funktioniert, muss der Client ein X. 509-Zertifikat für den Server bereitstellen, und der Server muss über dieses Zertifikat verfügen, das einem bestimmten Benutzerkonto auf dem Server zugeordnet ist.</span><span class="sxs-lookup"><span data-stu-id="65ccd-177">For impersonation to work properly in TLS, the client must provide an X.509 certificate to the server and the server must have that certificate mapped to a particular user account on the server.</span></span> <span data-ttu-id="65ccd-178">Weitere Informationen finden [Sie in der Schritt-für-Schritt-Anleitung zum Mapping von Zertifikaten zu Benutzerkonten](https://www.microsoft.com/isapi/redir.dll?prd=windows2000&sbp=technicallibrary&ar=security&sba=mappingcertificates).</span><span class="sxs-lookup"><span data-stu-id="65ccd-178">For more information, see the [Step-by-Step Guide to Mapping Certificates to User Accounts](https://www.microsoft.com/isapi/redir.dll?prd=windows2000&sbp=technicallibrary&ar=security&sba=mappingcertificates).</span></span>

<span data-ttu-id="65ccd-179">TLS unterstützt keine [Cloaking](cloaking.md).</span><span class="sxs-lookup"><span data-stu-id="65ccd-179">TLS does not support [cloaking](cloaking.md).</span></span> <span data-ttu-id="65ccd-180">Wenn ein Cloaking-Flag und TLS in einem [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) -oder einem [**IClientSecurity:: setblanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket) -Befehl angegeben werden, \_ wird E invalidArg zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="65ccd-180">If a cloaking flag and TLS are specified in a [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) or a [**IClientSecurity::SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket) call, E\_INVALIDARG will be returned.</span></span>

<span data-ttu-id="65ccd-181">TLS funktioniert nicht, wenn die Authentifizierungs Ebene auf None festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="65ccd-181">TLS does not work with the authentication level set to None.</span></span> <span data-ttu-id="65ccd-182">Der Handshake zwischen Client und Server überprüft die von jedem festgelegte Authentifizierungs Ebene und wählt die höhere Sicherheitseinstellung für die Verbindung aus.</span><span class="sxs-lookup"><span data-stu-id="65ccd-182">The handshake between the client and server examines the authentication level set by each and chooses the higher security setting for the connection.</span></span>

<span data-ttu-id="65ccd-183">Die Sicherheitsparameter für TLS können durch Aufrufen von [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) und [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket)festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="65ccd-183">The security parameters for TLS can be set by calling [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) and [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket).</span></span> <span data-ttu-id="65ccd-184">In den folgenden Abschnitten werden die für diese Aufrufe beteiligten Aspekte beschrieben.</span><span class="sxs-lookup"><span data-stu-id="65ccd-184">The following sections describe the nuances involved in making those calls.</span></span>

### <a name="how-a-server-sets-the-security-blanket"></a><span data-ttu-id="65ccd-185">Festlegen der Sicherheits Pauschale durch einen Server</span><span class="sxs-lookup"><span data-stu-id="65ccd-185">How a Server Sets the Security Blanket</span></span>

<span data-ttu-id="65ccd-186">Wenn ein Server TLS verwenden möchte, muss er Schannel (RPC \_ C \_ authn \_ GSS \_ SChannel) als Authentifizierungsdienst im *asAuthSvc* -Parameter von [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity)angeben.</span><span class="sxs-lookup"><span data-stu-id="65ccd-186">If a server wants to use TLS, it must specify Schannel (RPC\_C\_AUTHN\_GSS\_SCHANNEL) as an authentication service in the *asAuthSvc* parameter of [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity).</span></span> <span data-ttu-id="65ccd-187">Um zu verhindern, dass Clients mithilfe eines weniger sicheren Authentifizierungs Dienstanbieter eine Verbindung mit dem Server herstellen, sollte der Server nur SChannel als Authentifizierungsdienst angeben, wenn **CoInitializeSecurity** aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="65ccd-187">To prevent clients from connecting to the server by using a less secure authentication service, the server should specify only Schannel as an authentication service when it calls **CoInitializeSecurity**.</span></span> <span data-ttu-id="65ccd-188">Der Server kann die Sicherheits Pauschale nicht ändern, nachdem **CoInitializeSecurity** aufgerufen wurde.</span><span class="sxs-lookup"><span data-stu-id="65ccd-188">The server cannot change the security blanket after it has called **CoInitializeSecurity**.</span></span>

<span data-ttu-id="65ccd-189">Um TLS zu verwenden, sollten die folgenden Parameter angegeben werden, wenn ein Server [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity)aufruft:</span><span class="sxs-lookup"><span data-stu-id="65ccd-189">To use TLS, the following parameters should be specified when a server calls [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity):</span></span>

-   <span data-ttu-id="65ccd-190">*pVoid* muss entweder ein Zeiger auf ein [**IAccessControl**](/windows/desktop/api/IAccess/nn-iaccess-iaccesscontrol) -Objekt oder ein Zeiger auf eine [**Sicherheits \_ Beschreibung**](/windows/desktop/api/winnt/ns-winnt-security_descriptor)sein.</span><span class="sxs-lookup"><span data-stu-id="65ccd-190">*pVoid* should be either a pointer to an [**IAccessControl**](/windows/desktop/api/IAccess/nn-iaccess-iaccesscontrol) object or a pointer to a [**SECURITY\_DESCRIPTOR**](/windows/desktop/api/winnt/ns-winnt-security_descriptor).</span></span> <span data-ttu-id="65ccd-191">Er darf nicht **null** oder ein Zeiger auf eine AppID sein.</span><span class="sxs-lookup"><span data-stu-id="65ccd-191">It should not be **NULL** or a pointer to an AppID.</span></span>
-   <span data-ttu-id="65ccd-192">*cauthsvc* darf nicht 0 oder-1 sein.</span><span class="sxs-lookup"><span data-stu-id="65ccd-192">*cAuthSvc* cannot be 0 or -1.</span></span> <span data-ttu-id="65ccd-193">Wenn *cauthsvc* den Wert-1 hat, wählt der com-Server SChannel nie aus.</span><span class="sxs-lookup"><span data-stu-id="65ccd-193">COM servers never chooses Schannel when *cAuthSvc* is -1.</span></span>
-   <span data-ttu-id="65ccd-194">*asAuthSvc* muss SChannel als möglichen Authentifizierungsdienst angeben.</span><span class="sxs-lookup"><span data-stu-id="65ccd-194">*asAuthSvc* must specify Schannel as a possible authentication service.</span></span> <span data-ttu-id="65ccd-195">Dies erfolgt durch Festlegen der folgenden [**einzigen \_ Authentifizierungs \_ Dienst**](/windows/win32/api/objidlbase/ns-objidlbase-sole_authentication_service) Parameter für das SChannel-Mitglied der [**einzigen \_ Authentifizierungs \_ Liste**](/windows/win32/api/objidlbase/ns-objidlbase-sole_authentication_list):</span><span class="sxs-lookup"><span data-stu-id="65ccd-195">This is done by setting the following [**SOLE\_AUTHENTICATION\_SERVICE**](/windows/win32/api/objidlbase/ns-objidlbase-sole_authentication_service) parameters for the Schannel member of the [**SOLE\_AUTHENTICATION\_LIST**](/windows/win32/api/objidlbase/ns-objidlbase-sole_authentication_list):</span></span>
    -   <span data-ttu-id="65ccd-196">*dwauthnsvc* muss RPC \_ C \_ authn \_ GSS \_ SChannel sein.</span><span class="sxs-lookup"><span data-stu-id="65ccd-196">*dwAuthnSvc* must be RPC\_C\_AUTHN\_GSS\_SCHANNEL.</span></span>
    -   <span data-ttu-id="65ccd-197">*dwauthzsvc* sollte RPC \_ C \_ Authz \_ None lauten.</span><span class="sxs-lookup"><span data-stu-id="65ccd-197">*dwAuthzSvc* should be RPC\_C\_AUTHZ\_NONE.</span></span> <span data-ttu-id="65ccd-198">Derzeit wird Sie ignoriert.</span><span class="sxs-lookup"><span data-stu-id="65ccd-198">Currently, it is ignored.</span></span>
    -   <span data-ttu-id="65ccd-199">*pprincipalname* muss ein Zeiger auf einen [**CERT- \_ Kontext**](/windows/desktop/api/wincrypt/ns-wincrypt-cert_context)sein, der als Zeiger auf OLECHAR umgewandelt wird, der das X. 509-Zertifikat des Servers darstellt.</span><span class="sxs-lookup"><span data-stu-id="65ccd-199">*pPrincipalName* must be a pointer to a [**CERT\_CONTEXT**](/windows/desktop/api/wincrypt/ns-wincrypt-cert_context), cast as a pointer to OLECHAR, which represents the server's X.509 certificate.</span></span>
-   <span data-ttu-id="65ccd-200">*dwauthnlevel* gibt die minimale Authentifizierungs Ebene an, die von Clients für eine erfolgreiche Verbindung akzeptiert wird.</span><span class="sxs-lookup"><span data-stu-id="65ccd-200">*dwAuthnLevel* indicates the minimum authentication level that will be accepted from clients for a successful connection.</span></span> <span data-ttu-id="65ccd-201">Es kann keine RPC- \_ C- \_ authn-Ebene " \_ \_ None" sein</span><span class="sxs-lookup"><span data-stu-id="65ccd-201">It cannot be RPC\_C\_AUTHN\_LEVEL\_NONE.</span></span>
-   <span data-ttu-id="65ccd-202">für *DW-Funktionen* sollte das eoac- \_ AppID-Flag nicht festgelegt sein.</span><span class="sxs-lookup"><span data-stu-id="65ccd-202">*dwCapabilities* should not have the EOAC\_APPID flag set.</span></span> <span data-ttu-id="65ccd-203">Das eoac \_ - \_ Flag für die Zugriffs Steuerung sollte festgelegt werden, wenn *pVoid* auf ein [**IAccessControl**](/windows/desktop/api/IAccess/nn-iaccess-iaccesscontrol) -Objekt verweist. es sollte nicht festgelegt werden, wenn *pVoid* auf eine Sicherheits \_ Beschreibung verweist.</span><span class="sxs-lookup"><span data-stu-id="65ccd-203">The EOAC\_ACCESS\_CONTROL flag should be set if *pVoid* points to an [**IAccessControl**](/windows/desktop/api/IAccess/nn-iaccess-iaccesscontrol) object; it should not be set if *pVoid* points to a SECURITY\_DESCRIPTOR.</span></span> <span data-ttu-id="65ccd-204">Weitere Flags, die festgelegt werden können, finden Sie unter [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity).</span><span class="sxs-lookup"><span data-stu-id="65ccd-204">For other flags that may be set, see [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity).</span></span>

<span data-ttu-id="65ccd-205">Weitere Informationen zur Verwendung von [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity)finden Sie unter [Festlegen der Processwide-Sicherheit mit CoInitializeSecurity](setting-processwide-security-with-coinitializesecurity.md).</span><span class="sxs-lookup"><span data-stu-id="65ccd-205">For more information about using [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), see [Setting Processwide Security with CoInitializeSecurity](setting-processwide-security-with-coinitializesecurity.md).</span></span>

### <a name="how-a-client-sets-the-security-blanket"></a><span data-ttu-id="65ccd-206">Festlegen der Sicherheits Pauschale durch einen Client</span><span class="sxs-lookup"><span data-stu-id="65ccd-206">How a Client Sets the Security Blanket</span></span>

<span data-ttu-id="65ccd-207">Wenn ein Client TLS verwenden möchte, muss er Schannel (RPC \_ C \_ authn \_ GSS \_ SChannel) in der Liste der Authentifizierungsdienste im *pauthlist* -Parameter von [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity)angeben.</span><span class="sxs-lookup"><span data-stu-id="65ccd-207">If a client wants to use TLS, it must specify Schannel (RPC\_C\_AUTHN\_GSS\_SCHANNEL) in its list of authentication services in the *pAuthList* parameter of [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity).</span></span> <span data-ttu-id="65ccd-208">Wenn SChannel nicht als möglicher Authentifizierungsdienst angegeben wird, wenn **CoInitializeSecurity** aufgerufen wird, schlägt ein späterer Aufruf von [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket) (oder [**IClientSecurity:: setblanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket)) fehl, wenn versucht wird, SChannel als Authentifizierungsdienst anzugeben.</span><span class="sxs-lookup"><span data-stu-id="65ccd-208">If Schannel is not specified as a possible authentication service when **CoInitializeSecurity** is called, a later call to [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket) (or [**IClientSecurity::SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket)) will fail if it tries to specify Schannel as the authentication service.</span></span>

<span data-ttu-id="65ccd-209">Die folgenden Parameter müssen angegeben werden, wenn ein Client [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity)aufruft:</span><span class="sxs-lookup"><span data-stu-id="65ccd-209">The following parameters should be specified when a client calls [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity):</span></span>

-   <span data-ttu-id="65ccd-210">*dwauthnlevel* gibt die Standard Authentifizierungs Ebene an, die vom Client verwendet werden soll.</span><span class="sxs-lookup"><span data-stu-id="65ccd-210">*dwAuthnLevel* specifies the default authentication level that the client wants to use.</span></span> <span data-ttu-id="65ccd-211">Es kann keine RPC- \_ C- \_ authn-Ebene " \_ \_ None" sein</span><span class="sxs-lookup"><span data-stu-id="65ccd-211">It cannot be RPC\_C\_AUTHN\_LEVEL\_NONE.</span></span>
-   <span data-ttu-id="65ccd-212">*dwimplevel* muss ein RPC- \_ C- \_ IMP-Stufen Identitätswechsel sein \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="65ccd-212">*dwImpLevel* must be RPC\_C\_IMP\_LEVEL\_IMPERSONATE.</span></span>
-   <span data-ttu-id="65ccd-213">*pauthlist* muss die folgenden [**einzigen \_ Authentifizierungs \_ Informations**](/windows/win32/api/objidlbase/ns-objidlbase-sole_authentication_info) Parameter als Mitglied der Liste aufweisen:</span><span class="sxs-lookup"><span data-stu-id="65ccd-213">*pAuthList* must have the following [**SOLE\_AUTHENTICATION\_INFO**](/windows/win32/api/objidlbase/ns-objidlbase-sole_authentication_info) parameters as a member of the list:</span></span>
    -   <span data-ttu-id="65ccd-214">*dwauthnsvc* muss RPC \_ C \_ authn \_ GSS \_ SChannel sein.</span><span class="sxs-lookup"><span data-stu-id="65ccd-214">*dwAuthnSvc* must be RPC\_C\_AUTHN\_GSS\_SCHANNEL.</span></span>
    -   <span data-ttu-id="65ccd-215">*dwauthzsvc* muss RPC \_ C \_ Authz \_ None lauten.</span><span class="sxs-lookup"><span data-stu-id="65ccd-215">*dwAuthzSvc* must be RPC\_C\_AUTHZ\_NONE.</span></span>
    -   <span data-ttu-id="65ccd-216">*pAuthInfo* ist ein Zeiger auf einen [**CERT- \_ Kontext**](/windows/desktop/api/wincrypt/ns-wincrypt-cert_context), der als Zeiger auf "void" umgewandelt wird, der das X. 509-Zertifikat des Clients darstellt.</span><span class="sxs-lookup"><span data-stu-id="65ccd-216">*pAuthInfo* is a pointer to a [**CERT\_CONTEXT**](/windows/desktop/api/wincrypt/ns-wincrypt-cert_context), cast as a pointer to void, which represents the client's X.509 certificate.</span></span> <span data-ttu-id="65ccd-217">Wenn der Client kein Zertifikat hat oder das Zertifikat nicht auf dem Server präsentieren möchte, muss *pAuthInfo* **null** sein, und es wird eine anonyme Verbindung mit dem Server hergestellt.</span><span class="sxs-lookup"><span data-stu-id="65ccd-217">If the client does not have a certificate or does not wish to present its certificate to the server, *pAuthInfo* must be **NULL** and an anonymous connection will be attempted with the server.</span></span>
-   <span data-ttu-id="65ccd-218">*DW-Funktionen* sind ein Satz von Flags, die zusätzliche Client Funktionen angeben.</span><span class="sxs-lookup"><span data-stu-id="65ccd-218">*dwCapabilities* is a set of flags that indicate additional client capabilities.</span></span> <span data-ttu-id="65ccd-219">Informationen dazu, welche Flags festgelegt werden sollten, finden Sie unter [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) .</span><span class="sxs-lookup"><span data-stu-id="65ccd-219">See [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) for information about which flags should be set.</span></span>

<span data-ttu-id="65ccd-220">Weitere Informationen zur Verwendung von [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity)finden Sie unter [Festlegen der Processwide-Sicherheit mit CoInitializeSecurity](setting-processwide-security-with-coinitializesecurity.md).</span><span class="sxs-lookup"><span data-stu-id="65ccd-220">For more information about using [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), see [Setting Processwide Security with CoInitializeSecurity](setting-processwide-security-with-coinitializesecurity.md).</span></span>

### <a name="how-a-client-changes-the-security-blanket"></a><span data-ttu-id="65ccd-221">Ändern der Sicherheits Pauschale durch einen Client</span><span class="sxs-lookup"><span data-stu-id="65ccd-221">How a Client Changes the Security Blanket</span></span>

<span data-ttu-id="65ccd-222">Wenn ein Client TLS verwenden und die Sicherheitsdecke nach dem Aufrufen von [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity)ändern möchte, muss er entweder [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket) oder [**IClientSecurity:: setblanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket) mit Parametern aufrufen, die mit den im Aufruf von **CoInitializeSecurity** verwendeten Parametern vergleichbar sind, mit den folgenden unterschieden:</span><span class="sxs-lookup"><span data-stu-id="65ccd-222">If a client wants to use TLS but change the security blanket after calling [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), it must call either [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket) or [**IClientSecurity::SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket) with parameters similar to those used in the call to **CoInitializeSecurity**, with the following differences:</span></span>

-   <span data-ttu-id="65ccd-223">*pserverprincname* gibt den Prinzipal Namen des Servers im msstd-oder fullsic-Format an.</span><span class="sxs-lookup"><span data-stu-id="65ccd-223">*pServerPrincName* indicates the principal name of the server, in either msstd or fullsic format.</span></span> <span data-ttu-id="65ccd-224">Weitere Informationen zu diesen Formaten finden Sie unter [Prinzipal Namen](/windows/desktop/Rpc/principal-names).</span><span class="sxs-lookup"><span data-stu-id="65ccd-224">For information on these formats, see [Principal Names](/windows/desktop/Rpc/principal-names).</span></span> <span data-ttu-id="65ccd-225">Wenn der Client über das X. 509-Zertifikat des Servers verfügt, kann der Prinzipal Name durch Aufrufen von [**rpccertgenerateprincipalname**](/windows/desktop/api/rpcssl/nf-rpcssl-rpccertgenerateprincipalname)gefunden werden.</span><span class="sxs-lookup"><span data-stu-id="65ccd-225">If the client has the server's X.509 certificate, it can find the principal name by calling [**RpcCertGeneratePrincipalName**](/windows/desktop/api/rpcssl/nf-rpcssl-rpccertgenerateprincipalname).</span></span>
-   <span data-ttu-id="65ccd-226">*pAuthInfo* ist ein Zeiger auf einen [**CERT- \_ Kontext**](/windows/desktop/api/wincrypt/ns-wincrypt-cert_context), der als Zeiger auf \_ das RPC-Authentifizierungs Identitäts handle umgewandelt wird \_ \_ , das das X. 509-Zertifikat des Clients darstellt.</span><span class="sxs-lookup"><span data-stu-id="65ccd-226">*pAuthInfo* is a pointer to a [**CERT\_CONTEXT**](/windows/desktop/api/wincrypt/ns-wincrypt-cert_context), cast as a pointer to RPC\_AUTH\_IDENTITY\_HANDLE, which represents the client's X.509 certificate.</span></span> <span data-ttu-id="65ccd-227">Wenn der Client kein Zertifikat hat oder das Zertifikat nicht auf dem Server präsentieren möchte, muss *pAuthInfo* **null** sein, und es wird eine anonyme Verbindung mit dem Server hergestellt.</span><span class="sxs-lookup"><span data-stu-id="65ccd-227">If the client does not have a certificate or does not wish to present its certificate to the server, *pAuthInfo* must be **NULL** and an anonymous connection will be attempted with the server.</span></span>
-   <span data-ttu-id="65ccd-228">*DW-Funktionen* bestehen aus Flags, die zusätzliche Client Funktionen angeben.</span><span class="sxs-lookup"><span data-stu-id="65ccd-228">*dwCapabilities* consists of flags that indicate additional client capabilities.</span></span> <span data-ttu-id="65ccd-229">Es können nur vier Flags verwendet werden, um sicherheitspauseeinstellungen zu ändern: eoac \_ Default, eoac \_ gegenseitige Authentifizierung \_ , eoac \_ Any \_ Authority (dieses Flag ist veraltet) und eoac \_ machen \_ fullsic.</span><span class="sxs-lookup"><span data-stu-id="65ccd-229">Only four flags can be used to change security blanket settings: EOAC\_DEFAULT, EOAC\_MUTUAL\_AUTH, EOAC\_ANY\_AUTHORITY (this flag is deprecated), and EOAC\_MAKE\_FULLSIC.</span></span> <span data-ttu-id="65ccd-230">Weitere Informationen finden Sie unter [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket).</span><span class="sxs-lookup"><span data-stu-id="65ccd-230">For more information, see [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket).</span></span>

<span data-ttu-id="65ccd-231">Weitere Informationen zur Verwendung von [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket)finden Sie unter [Festlegen der Sicherheit auf der Ebene der Schnittstellen Proxys](setting-security-at-the-interface-proxy-level.md).</span><span class="sxs-lookup"><span data-stu-id="65ccd-231">For more information about using [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket), see [Setting Security at the Interface Proxy Level](setting-security-at-the-interface-proxy-level.md).</span></span>

### <a name="example-client-changes-the-security-blanket"></a><span data-ttu-id="65ccd-232">Beispiel: Client ändert die Sicherheits Pauschale</span><span class="sxs-lookup"><span data-stu-id="65ccd-232">Example: Client Changes the Security Blanket</span></span>

<span data-ttu-id="65ccd-233">Im folgenden Beispiel wird veranschaulicht, wie ein Client die Sicherheits Pauschale ändern kann, um eine Anforderung vom Server für die Bereitstellung des X. 509-Zertifikats durch den Client zu erfüllen.</span><span class="sxs-lookup"><span data-stu-id="65ccd-233">The following example demonstrates how a client can change the security blanket to accommodate a request from the server for the client to provide its X.509 certificate.</span></span> <span data-ttu-id="65ccd-234">Der Fehler Behandlungs Code wird aus Gründen der Kürze ausgelassen.</span><span class="sxs-lookup"><span data-stu-id="65ccd-234">Error handling code is omitted for brevity.</span></span>


```C++
void ClientChangesSecurity ()
{
  HCRYPTPROV                   provider           = 0;
  HCERTSTORE                   cert_store         = NULL;
  PCCERT_CONTEXT               client_cert        = NULL;
  PCCERT_CONTEXT               server_cert        = NULL;
  WCHAR                        *server_princ_name = NULL;
  ISecret                      *pSecret           = NULL;
  MULTI_QI                     server_instance;
  COSERVERINFO                 server_machine;
  SOLE_AUTHENTICATION_LIST     auth_list;
  SOLE_AUTHENTICATION_INFO     auth_info[1];



  // Specify all the authentication info. 
  // The client is willing to connect using SChannel,
  //   with no client certificate.
  auth_list.cAuthInfo     = 1;
  auth_list.aAuthInfo     = auth_info;
  auth_info[0].dwAuthnSvc = RPC_C_AUTHN_GSS_SCHANNEL;
  auth_info[0].dwAuthzSvc = RPC_C_AUTHZ_NONE;
  auth_info[0].pAuthInfo  = NULL;  // No certificate

  // Initialize client security with no client certificate.
  CoInitializeSecurity( NULL, -1, NULL, NULL,
                        RPC_C_AUTHN_LEVEL_PKT,
                        RPC_C_IMP_LEVEL_IMPERSONATE, &auth_list,
                        EOAC_NONE, NULL );
  
  // Specify info for the proxy.
  server_instance = {&IID_ISecret, NULL, S_OK};
  server_machine  = {0, L"ServerMachineName", NULL, 0};
  
  // Create a proxy.
  CoCreateInstanceEx( CLSID_Secret, NULL, CLSCTX_REMOTE_SERVER, 
                      &server_machine, 1, &server_instance);
  pSecret = (ISecret *) server_instance.pItf;

  //** The client obtained the server's certificate during the handshake.
  //** The server requests a certificate from the client.

  // Get the default certificate provider.
  CryptAcquireContext( &provider, NULL, NULL, PROV_RSA_SCHANNEL, 0 );

  // Open the certificate store.
  cert_store = CertOpenSystemStore( provider, L"my" );

  // Find the client's certificate.
  client_cert = 
    CertFindCertificateInStore( cert_store,
                                X509_ASN_ENCODING | PKCS_7_ASN_ENCODING,
                                0,
                                CERT_FIND_SUBJECT_STR,
                                L"ClientName",  // Use the principal name
                                NULL );

  // Find the fullsic principal name of the server.
  RpcCertGeneratePrincipalName( server_cert, RPC_C_FULL_CERT_CHAIN, 
                                &server_princ_name );

  // Change the client's security: 
  // Increase the authentication level and attach a certificate.
  CoSetProxyBlanket( pSecret, RPC_C_AUTHN_GSS_SCHANNEL,
                     RPC_C_AUTHZ_NONE,
                     server_princ_name, RPC_C_AUTHN_LEVEL_PKT_PRIVACY,
                     RPC_C_IMP_LEVEL_IMPERSONATE, 
                     (RPC_AUTH_IDENTITY_HANDLE *) client_cert,
                     EOAC_NONE );

  cleanup:
  if (server_princ_name != NULL)
    RpcStringFree( &server_princ_name );
  if (client_cert != NULL)
    CertFreeCertificateContext(client_cert);
  if (server_cert != NULL)
    CertFreeCertificateContext(server_cert);
  if (cert_store != NULL)
    CertCloseStore( cert_store, CERT_CLOSE_STORE_CHECK_FLAG );
  if (provider != 0 )
    CryptReleaseContext( provider, 0 );
  if (pSecret != NULL)
    pSecret->Release();
  CoUninitialize();
}
```



## <a name="related-topics"></a><span data-ttu-id="65ccd-235">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="65ccd-235">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="65ccd-236">COM-und Sicherheitspakete</span><span class="sxs-lookup"><span data-stu-id="65ccd-236">COM and Security Packages</span></span>](com-and-security-packages.md)
</dt> </dl>

 

 