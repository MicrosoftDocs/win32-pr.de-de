---
title: Implementieren und Aktivieren eines Handlers ohne zusätzliche Server Daten
description: Implementieren und Aktivieren eines Handlers ohne zusätzliche Server Daten
ms.assetid: 9d91260a-4cec-4a10-bb57-d02999efae47
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6866b40e1257a865aa5068ffd46611c411498877
ms.sourcegitcommit: d39e82e232f6510f843fdb8d55d25b4e9e02e880
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 02/03/2021
ms.locfileid: "103961043"
---
# <a name="implementing-and-activating-a-handler-with-no-extra-server-data"></a><span data-ttu-id="c3993-103">Implementieren und Aktivieren eines Handlers ohne zusätzliche Server Daten</span><span class="sxs-lookup"><span data-stu-id="c3993-103">Implementing and Activating a Handler with No Extra Server Data</span></span>

<span data-ttu-id="c3993-104">Wenn Sie eine Instanz Ihres Handlers erstellen möchten, die keine zusätzlichen Serverdaten erhält, muss der Server [**istdmarshalinfo**](/windows/win32/api/objidlbase/nn-objidlbase-istdmarshalinfo) implementieren, aber nicht " [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal)".</span><span class="sxs-lookup"><span data-stu-id="c3993-104">To create an instance of your handler, if it is one that gets no extra server data, the server must implement [**IStdMarshalInfo**](/windows/win32/api/objidlbase/nn-objidlbase-istdmarshalinfo) but not [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal).</span></span> <span data-ttu-id="c3993-105">**Istdmarshalinfo** verfügt über eine Methode, [**getclassforhandler**](/windows/win32/api/objidlbase/nf-objidlbase-istdmarshalinfo-getclassforhandler), die die CLSID des Objekt Handlers abruft, der im Ziel Prozess verwendet werden soll.</span><span class="sxs-lookup"><span data-stu-id="c3993-105">**IStdMarshalInfo** has one method, [**GetClassForHandler**](/windows/win32/api/objidlbase/nf-objidlbase-istdmarshalinfo-getclassforhandler), which retrieves the CLSID of the object handler to be used in the destination process.</span></span> <span data-ttu-id="c3993-106">COM ruft diese Methode auf, wenn Sie [**comarshalinterface**](/windows/desktop/api/combaseapi/nf-combaseapi-comarshalinterface) für Sie aufruft und den Handler auf der Clientseite aktiviert.</span><span class="sxs-lookup"><span data-stu-id="c3993-106">COM calls this when it calls [**CoMarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-comarshalinterface) for you and activates the handler on the client side.</span></span>

<span data-ttu-id="c3993-107">Als nächstes müssen sowohl die Server-als auch die Handlerimplementierungen die [**cogetstdmarshalex**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex) -Funktion aufrufen.</span><span class="sxs-lookup"><span data-stu-id="c3993-107">Next, both the server and handler implementations must call the [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex) function.</span></span> <span data-ttu-id="c3993-108">Diese Funktion erstellt auf jeder Seite einen Standard-Mars Haller (als Proxy-Manager auf der Clientseite und als Stub-Manager auf der Serverseite bezeichnet).</span><span class="sxs-lookup"><span data-stu-id="c3993-108">This function creates a standard marshaler on each side (called a proxy manager on the client side and a stub manager on the server side).</span></span>

<span data-ttu-id="c3993-109">Der Server ruft [**cogetstdmarshalex**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex)auf und übergibt dabei das Flag "smexf \_ Server".</span><span class="sxs-lookup"><span data-stu-id="c3993-109">The server calls [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), passing in the flag SMEXF\_SERVER.</span></span> <span data-ttu-id="c3993-110">Dadurch wird ein serverseitiger Standard-Mars Haller (Stub-Manager) erstellt.</span><span class="sxs-lookup"><span data-stu-id="c3993-110">This creates a server-side standard marshaler (stub manager).</span></span> <span data-ttu-id="c3993-111">Die serverseitige Struktur ist in der folgenden Abbildung dargestellt:</span><span class="sxs-lookup"><span data-stu-id="c3993-111">The server-side structure is shown in the following illustration:</span></span>

![Diagramm, das die serverseitige Struktur anzeigt.](images/b47b3bc0-3e7d-4be4-9767-7ae436bd1b21.png)

## <a name="server-side-structure"></a><span data-ttu-id="c3993-113">Server-Side Struktur</span><span class="sxs-lookup"><span data-stu-id="c3993-113">Server-Side Structure</span></span>

<span data-ttu-id="c3993-114">Der Handler ruft " [**cogetstdmarshalex**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex)" auf und übergibt dabei den Flag-"smexf"- \_ Handler.</span><span class="sxs-lookup"><span data-stu-id="c3993-114">The handler calls [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), passing in the flag SMEXF\_HANDLER.</span></span> <span data-ttu-id="c3993-115">Dadurch wird ein Client seitiger Standard-Mars Haller (Proxy-Manager) erstellt und mit dem-Handler auf der Clientseite aggregiert.</span><span class="sxs-lookup"><span data-stu-id="c3993-115">This creates a client-side standard marshaler (proxy manager) and aggregates it with the handler on the client side.</span></span> <span data-ttu-id="c3993-116">Die Lebensdauer von beidem wird vom Steuerungsobjekt verwaltet, das vom [**System implementiert wird**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown), wenn der Handler **cogetstdmarshalex** aufruft.</span><span class="sxs-lookup"><span data-stu-id="c3993-116">The lifetime of both are managed by the controlling identity object (implementing [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown)) that the system implements when the handler calls **CoGetStdMarshalEx**.</span></span> <span data-ttu-id="c3993-117">Die Client seitige Struktur ist in der folgenden Abbildung dargestellt.</span><span class="sxs-lookup"><span data-stu-id="c3993-117">The client-side structure is shown in the following illustration.</span></span>

![Diagramm, das die Client seitige Struktur anzeigt.](images/24ae70ef-dfa8-4784-90ac-dc6cfb043ee5.png)

## <a name="client-side-structure"></a><span data-ttu-id="c3993-119">Client-Side Struktur</span><span class="sxs-lookup"><span data-stu-id="c3993-119">Client-Side Structure</span></span>

<span data-ttu-id="c3993-120">Wie in der obigen Abbildung gezeigt, wird der Handler tatsächlich zwischen dem Proxy-Manager und dem Identitäts-/kontrollierenden unbekannten eingebettet.</span><span class="sxs-lookup"><span data-stu-id="c3993-120">As shown in the preceding illustration, the handler is actually sandwiched between the proxy manager and the identity/controlling unknown.</span></span> <span data-ttu-id="c3993-121">Dadurch erhält das System die Kontrolle über die Lebensdauer des Objekts, während das handlersteuerelement über die verfügbar gemachten Schnittstellen verfügt.</span><span class="sxs-lookup"><span data-stu-id="c3993-121">This gives the system control over the lifetime of the object while giving the handler control over the exposed interfaces.</span></span> <span data-ttu-id="c3993-122">Die gestrichelte Linie zwischen der Identität und dem Proxy-Manager gibt an, dass die beiden die enge Integration über interne private Schnittstellen gemeinsam verwenden.</span><span class="sxs-lookup"><span data-stu-id="c3993-122">The dashed line between the Identity and Proxy Manager indicates that the two share tight integration through internal private interfaces.</span></span>

<span data-ttu-id="c3993-123">Wenn com für den Client die Methode " [**dinmarshalinterface**](/windows/desktop/api/combaseapi/nf-combaseapi-counmarshalinterface) " aufruft, wird die Handlerinstanz erstellt und mit der Identität aggregierte.</span><span class="sxs-lookup"><span data-stu-id="c3993-123">When COM calls [**CoUnmarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-counmarshalinterface) for the client, it creates the handler instance, aggregating it with the Identity.</span></span> <span data-ttu-id="c3993-124">Der Handler erstellt den Standard-Mars Haller (durch Aufrufen von [**cogetstdmarshalex**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex)und übergibt dabei den Steuerungs unbekannten, den er bei seiner Erstellung empfangen hat).</span><span class="sxs-lookup"><span data-stu-id="c3993-124">The handler will create the standard marshaler (through the call to [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), passing in the controlling unknown it received when it was created).</span></span> <span data-ttu-id="c3993-125">Der Handler implementiert " [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) " nicht, sondern gibt nur " **IMarshal** " aus dem Standard-Marshaler zurück.</span><span class="sxs-lookup"><span data-stu-id="c3993-125">The handler does not implement [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) but just returns **IMarshal** from the standard marshaler.</span></span> <span data-ttu-id="c3993-126">Auch wenn der Handler " **IMarshal**" implementiert, wird er während eines unmars Hall nicht aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="c3993-126">Even if the handler does implement **IMarshal**, it will not get called during an unmarshal.</span></span>

<span data-ttu-id="c3993-127">Wenn zwei Threads gleichzeitig das gleiche Objekt zum ersten Mal entsperren, kann es vorkommen, dass zwei Handler vorübergehend erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="c3993-127">If two threads simultaneously unmarshal the same object for the first time, it is possible for two handlers to get created temporarily.</span></span> <span data-ttu-id="c3993-128">Anschließend wird eine solche veröffentlicht.</span><span class="sxs-lookup"><span data-stu-id="c3993-128">One will subsequently be released.</span></span>

## <a name="related-topics"></a><span data-ttu-id="c3993-129">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="c3993-129">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="c3993-130">Der Lightweight Client-Side-Handler</span><span class="sxs-lookup"><span data-stu-id="c3993-130">The Lightweight Client-Side Handler</span></span>](the-lightweight-client-side-handler.md)
</dt> </dl>

 

 