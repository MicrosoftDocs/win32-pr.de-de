---
title: Lizenzierung und IClassFactory2
description: Lizenzierung und IClassFactory2
ms.assetid: 2bead555-8c62-4f48-a4c6-6f0942ec75f8
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9376d5187588ba14da434161309409bf1d189a8f
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/21/2020
ms.locfileid: "104391070"
---
# <a name="licensing-and-iclassfactory2"></a><span data-ttu-id="4d96a-103">Lizenzierung und IClassFactory2</span><span class="sxs-lookup"><span data-stu-id="4d96a-103">Licensing and IClassFactory2</span></span>

<span data-ttu-id="4d96a-104">Die [**IClassFactory**](/windows/win32/api/unknwn/nn-unknwn-iclassfactory) -Schnittstelle für ein Class-Objekt stellt den grundlegenden Objekt Erstellungs Mechanismus von com bereit.</span><span class="sxs-lookup"><span data-stu-id="4d96a-104">The [**IClassFactory**](/windows/win32/api/unknwn/nn-unknwn-iclassfactory) interface on a class object provides the basic object creation mechanism of COM.</span></span> <span data-ttu-id="4d96a-105">Mithilfe von **IClassFactory** kann ein Server die Objekt Erstellung auf einem Computer steuern.</span><span class="sxs-lookup"><span data-stu-id="4d96a-105">Using **IClassFactory**, a server can control object creation on a machine basis.</span></span> <span data-ttu-id="4d96a-106">Die Implementierung der [**IClassFactory:: | ateinstance**](/windows/desktop/api/Unknwn/nf-unknwn-iclassfactory-createinstance) -Methode kann die Objekt Erstellung basierend auf dem vorhanden sein einer Computer Lizenz zulassen oder nicht zulassen.</span><span class="sxs-lookup"><span data-stu-id="4d96a-106">The implementation of the [**IClassFactory::CreateInstance**](/windows/desktop/api/Unknwn/nf-unknwn-iclassfactory-createinstance) method can allow or disallow object creation based on the existence of a machine license.</span></span> <span data-ttu-id="4d96a-107">Eine Computer Lizenz ist ein Teil der Informationen, die von der auf einem Computer vorhandenen Anwendung getrennt sind, um anzugeben, dass die Software aus einer gültigen Quelle, z. b. den Installations Datenträgern des Anbieters, installiert wurde.</span><span class="sxs-lookup"><span data-stu-id="4d96a-107">A machine license is a piece of information separate from the application that exists on a machine to indicate that the software was installed from a valid source, such as the vendor's installation disks.</span></span> <span data-ttu-id="4d96a-108">Wenn die Computer Lizenz nicht vorhanden ist, kann der Server die Objekt Erstellung nicht zulassen.</span><span class="sxs-lookup"><span data-stu-id="4d96a-108">If the machine license does not exist, the server can disallow object creation.</span></span> <span data-ttu-id="4d96a-109">Die Computer Lizenzierung verhindert die Piraterie in Fällen, in denen ein Benutzer versucht, die Software von einem Computer auf einen anderen zu kopieren, da die Lizenzinformationen nicht mit der Software kopiert werden und der Computer, der die Kopie empfängt, nicht lizenziert ist.</span><span class="sxs-lookup"><span data-stu-id="4d96a-109">Machine licensing prevents piracy in cases where a user attempts to copy the software from one machine to another, because the license information is not copied with the software and the machine that receives the copy is not licensed.</span></span>

<span data-ttu-id="4d96a-110">In einer Softwarebranche für Komponenten benötigen die Anbieter jedoch eine präzisere Kontrolle über die Lizenzierung.</span><span class="sxs-lookup"><span data-stu-id="4d96a-110">However, in a component software industry, vendors need a finer level of control over licensing.</span></span> <span data-ttu-id="4d96a-111">Zusätzlich zur Computer Lizenzkontrolle muss ein Hersteller es einigen Clients gestatten, ein Komponenten Objekt zu erstellen, während anderen Clients dieselbe Funktion verweigert wird.</span><span class="sxs-lookup"><span data-stu-id="4d96a-111">In addition to machine license control, a vendor needs to allow some clients to create a component object while denying other clients the same capability.</span></span> <span data-ttu-id="4d96a-112">Hierfür ist es erforderlich, dass die Client Anwendung einen Lizenzschlüssel von der Komponente erhält, während sich die Client Anwendung noch in der Entwicklungsphase befindet.</span><span class="sxs-lookup"><span data-stu-id="4d96a-112">This requires that the client application obtain a license key from the component while the client application is still under development.</span></span> <span data-ttu-id="4d96a-113">Die Client Anwendung verwendet den Lizenzschlüssel zur Laufzeit, um Objekte auf einem nicht lizenzierten Computer zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="4d96a-113">The client application uses the license key at run time to create objects on an unlicensed machine.</span></span>

<span data-ttu-id="4d96a-114">Wenn ein Anbieter z. b. eine Bibliothek von Steuerelementen für Entwickler bereitstellt, verfügt der Entwickler, der die Bibliothek erwirbt, über eine vollständige Computer Lizenz, sodass die Objekte auf dem Entwicklungs Computer erstellt werden können.</span><span class="sxs-lookup"><span data-stu-id="4d96a-114">For example, if a vendor provides a library of controls to developers, the developer who purchases the library will have a full machine license, allowing the objects to be created on the development machine.</span></span> <span data-ttu-id="4d96a-115">Der Entwickler kann dann auf dem lizenzierten Computer eine Client Anwendung erstellen, die ein oder mehrere der Steuerelemente enthält.</span><span class="sxs-lookup"><span data-stu-id="4d96a-115">The developer can then build a client application on the licensed machine incorporating one or more of the controls.</span></span> <span data-ttu-id="4d96a-116">Wenn die resultierende Client Anwendung auf einem anderen Computer ausgeführt wird, müssen die in der Client Anwendung verwendeten Steuerelemente auch auf dem anderen Computer erstellt werden, auch wenn dieser Computer nicht über eine Computer Lizenz für die Steuerelemente des ursprünglichen Herstellers verfügt.</span><span class="sxs-lookup"><span data-stu-id="4d96a-116">When the resulting client application is run on another machine, the controls used in the client application must be created on the other machine even if that machine does not possess a machine license for the controls from the original vendor.</span></span>

<span data-ttu-id="4d96a-117">Die [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2) -Schnittstelle stellt diese Steuerungsebene bereit.</span><span class="sxs-lookup"><span data-stu-id="4d96a-117">The [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2) interface provides this level of control.</span></span> <span data-ttu-id="4d96a-118">Um die Schlüssel basierte Lizenzierung für eine bestimmte Komponente zuzulassen, implementieren Sie **IClassFactory2** für das klassenfactoryobjekt für diese Komponente.</span><span class="sxs-lookup"><span data-stu-id="4d96a-118">To allow key-based licensing for any given component, you implement **IClassFactory2** on the class factory object for that component.</span></span> <span data-ttu-id="4d96a-119">**IClassFactory2** wird von [**IClassFactory**](/windows/win32/api/unknwn/nn-unknwn-iclassfactory)abgeleitet, d. h. durch die Implementierung von **IClassFactory2** erfüllt das klassenfactoryobjekt die grundlegenden com-Anforderungen.</span><span class="sxs-lookup"><span data-stu-id="4d96a-119">**IClassFactory2** is derived from [**IClassFactory**](/windows/win32/api/unknwn/nn-unknwn-iclassfactory), so by implementing **IClassFactory2**, the class factory object fulfills the basic COM requirements.</span></span>

<span data-ttu-id="4d96a-120">Verwenden Sie die folgenden Methoden in [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2), um eine lizenzierte Komponente in die Client Anwendung zu integrieren:</span><span class="sxs-lookup"><span data-stu-id="4d96a-120">To incorporate a licensed component into your client application, use the following methods in [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2):</span></span>

-   <span data-ttu-id="4d96a-121">Die [**GetLicInfo**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-getlicinfo) -Methode füllt eine [**LICINFO**](/windows/win32/api/ocidl/ns-ocidl-licinfo) -Struktur mit Informationen auf, die das Lizenzierungs Verhalten der Klassenfactory beschreiben.</span><span class="sxs-lookup"><span data-stu-id="4d96a-121">The [**GetLicInfo**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-getlicinfo) method fills a [**LICINFO**](/windows/win32/api/ocidl/ns-ocidl-licinfo) structure with information describing the licensing behavior of the class factory.</span></span> <span data-ttu-id="4d96a-122">So kann z. b. die Klassenfactory Lizenzschlüssel für die Lauf Zeit Lizenzierung bereitstellen, wenn das **fruntimekey-** Member **true** ist.</span><span class="sxs-lookup"><span data-stu-id="4d96a-122">For example, the class factory can provide license keys for run-time licensing if the **fRunTimeKeyAvail** member is **TRUE**.</span></span>
-   <span data-ttu-id="4d96a-123">Die [**RequestLicKey**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-requestlickey) -Methode stellt einen Lizenzschlüssel für die Komponente bereit.</span><span class="sxs-lookup"><span data-stu-id="4d96a-123">The [**RequestLicKey**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-requestlickey) method provides a license key for the component.</span></span> <span data-ttu-id="4d96a-124">Eine Computer Lizenz muss verfügbar sein, wenn der Client diese Methode aufruft.</span><span class="sxs-lookup"><span data-stu-id="4d96a-124">A machine license must be available when the client calls this method.</span></span>
-   <span data-ttu-id="4d96a-125">Die Methode " [**kreateinstancelic**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-createinstancelic) " erstellt eine Instanz der lizenzierten Komponente, wenn der Parameter für den Lizenzschlüssel (bstrankey) gültig ist.</span><span class="sxs-lookup"><span data-stu-id="4d96a-125">The [**CreateInstanceLic**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-createinstancelic) method creates an instance of the licensed component if the license key parameter (BSTRÂ bstrKey) is valid.</span></span>

> [!Note]  
> <span data-ttu-id="4d96a-126">In den Typinformationen verwendet eine Komponente das lizenzierte Attribut, um die Co-Klasse zu markieren, die die Lizenzierung über [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2)unterstützt.</span><span class="sxs-lookup"><span data-stu-id="4d96a-126">In its type information, a component uses the attribute licensed to mark the coclass that supports licensing through [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2).</span></span>

 

<span data-ttu-id="4d96a-127">Zunächst benötigen Sie ein separates Entwicklungs Tool, bei dem es sich auch um einen Client der lizenzierten Komponente handelt.</span><span class="sxs-lookup"><span data-stu-id="4d96a-127">First, you need a separate development tool that is also a client of the licensed component.</span></span> <span data-ttu-id="4d96a-128">Der Zweck dieses Tools ist, den Laufzeitlizenz Schlüssel abzurufen und in der Client Anwendung zu speichern.</span><span class="sxs-lookup"><span data-stu-id="4d96a-128">The purpose of this tool is to obtain the run-time license key and save it in your client application.</span></span> <span data-ttu-id="4d96a-129">Dieses Tool wird nur auf einem Computer ausgeführt, der über eine Computer Lizenz für die Komponente verfügt.</span><span class="sxs-lookup"><span data-stu-id="4d96a-129">This tool runs only on a machine that possesses a machine license for the component.</span></span> <span data-ttu-id="4d96a-130">Das Tool Ruft die Methoden [**GetLicInfo**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-getlicinfo) und [**RequestLicKey**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-requestlickey) zum Abrufen des Laufzeitlizenz Schlüssels auf und speichert dann den Lizenzschlüssel in der Client Anwendung.</span><span class="sxs-lookup"><span data-stu-id="4d96a-130">The tool calls the [**GetLicInfo**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-getlicinfo) and [**RequestLicKey**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-requestlickey) methods to obtain the run-time license key and then saves the license key in your client application.</span></span> <span data-ttu-id="4d96a-131">Das Entwicklungs Tool könnte z. b. eine Header Datei (. h) mit dem BSTR-Lizenzschlüssel erstellen und diese h-Datei in die Client Anwendung einschließen.</span><span class="sxs-lookup"><span data-stu-id="4d96a-131">For example, the development tool could create a header (.h) file containing the BSTR license key, and then you would include that .h file in your client application.</span></span>

<span data-ttu-id="4d96a-132">Um die Komponente in der Client Anwendung zu instanziieren, versuchen Sie zunächst, das Objekt direkt mit " [**IClassFactory::**](/windows/desktop/api/Unknwn/nf-unknwn-iclassfactory-createinstance)" zu instanziieren.</span><span class="sxs-lookup"><span data-stu-id="4d96a-132">To instantiate the component within your client application, first try to instantiate the object directly with [**IClassFactory::CreateInstance**](/windows/desktop/api/Unknwn/nf-unknwn-iclassfactory-createinstance).</span></span> <span data-ttu-id="4d96a-133">Wenn " **destance** " erfolgreich ist, wird der zweite Computer für die Komponente lizenziert, und die Objekte können bei der Erstellung erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="4d96a-133">If **CreateInstance** succeeds, the second machine is licensed for the component and objects can be created at will.</span></span> <span data-ttu-id="4d96a-134">Wenn " **destance**" mit der Rückgabecode Klasse " \_ E \_ notlizenzierte" ausfällt, besteht die einzige Möglichkeit zum Erstellen des Objekts darin, den Lauf Zeit Schlüssel an die Methode " [**kreateinstancelic**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-createinstancelic) " zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="4d96a-134">If **CreateInstance** fails with the return code CLASS\_E\_NOTLICENSED, the only way to create the object is to pass the run-time key to the [**CreateInstanceLic**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-createinstancelic) method.</span></span> <span data-ttu-id="4d96a-135">" **Kreateinstancelic** " überprüft den Schlüssel und erstellt das Objekt, wenn der Schlüssel gültig ist.</span><span class="sxs-lookup"><span data-stu-id="4d96a-135">**CreateInstanceLic** verifies the key and creates the object if the key is valid.</span></span>

<span data-ttu-id="4d96a-136">Auf diese Weise kann eine Anwendung, die mit Komponenten (z. b. Steuerelemente) erstellt wurde, auf einem Computer ausgeführt werden, der keine andere Lizenz hat – nur die Client Anwendung, die die Laufzeitlizenz enthält, darf die fraglichen Komponenten Objekte erstellen.</span><span class="sxs-lookup"><span data-stu-id="4d96a-136">In this way, an application built with components (such as controls) can run on a machine that has no other license—only the client application containing the run-time license is allowed to create the component objects in question.</span></span>

<span data-ttu-id="4d96a-137">Die [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2) -Schnittstelle unterstützt Flexibilität in Lizenzierungs Schemas.</span><span class="sxs-lookup"><span data-stu-id="4d96a-137">The [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2) interface supports flexibility in licensing schemes.</span></span> <span data-ttu-id="4d96a-138">Der Server implemenor kann z. b. die Lizenzschlüssel in der Komponente verschlüsseln, um die Sicherheit zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="4d96a-138">For example, the server implementor can encrypt license keys in the component for added security.</span></span> <span data-ttu-id="4d96a-139">Server Implementierungen können auch Funktionsebenen in ihren Objekten aktivieren bzw. deaktivieren, indem Sie unterschiedliche Lizenzschlüssel für verschiedene Funktionen bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="4d96a-139">Server implementers can also enable or disable levels of functionality in their objects by providing different license keys for different functions.</span></span> <span data-ttu-id="4d96a-140">Beispielsweise kann ein Schlüssel eine grundlegende Funktionsebene ermöglichen, während eine andere grundlegende und erweiterte Funktionalität ermöglicht usw.</span><span class="sxs-lookup"><span data-stu-id="4d96a-140">For example, one key might allow a base level of functionality while another allows basic and advanced functionality, and so on.</span></span>

## <a name="related-topics"></a><span data-ttu-id="4d96a-141">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="4d96a-141">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="4d96a-142">Zuständigkeiten von com-Servern</span><span class="sxs-lookup"><span data-stu-id="4d96a-142">COM Server Responsibilities</span></span>](com-server-responsibilities.md)
</dt> </dl>

 

 