---
title: Implementieren und Aktivieren eines Handlers mit zusätzlichen Daten, die vom Server bereitgestellt werden
description: Implementieren und Aktivieren eines Handlers mit zusätzlichen Daten, die vom Server bereitgestellt werden
ms.assetid: 5bbf81bd-430d-4008-b1cc-9ea91bb3b1e7
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: db78a3e39c85c37c52dfa3f09ef41f0a71b5f431
ms.sourcegitcommit: d39e82e232f6510f843fdb8d55d25b4e9e02e880
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 02/03/2021
ms.locfileid: "104350868"
---
# <a name="implementing-and-activating-a-handler-with-extra-data-supplied-by-server"></a><span data-ttu-id="af12e-103">Implementieren und Aktivieren eines Handlers mit zusätzlichen Daten, die vom Server bereitgestellt werden</span><span class="sxs-lookup"><span data-stu-id="af12e-103">Implementing and Activating a Handler with Extra Data Supplied by Server</span></span>

<span data-ttu-id="af12e-104">Wenn der Server zusätzliche Daten in das Paket aufnehmen möchte, die der Handler verwenden soll, muss der Server sowohl die [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) -als auch die [**istdmarshalinfo**](/windows/win32/api/objidlbase/nn-objidlbase-istdmarshalinfo) -Schnittstelle implementieren.</span><span class="sxs-lookup"><span data-stu-id="af12e-104">If the server wants to include some extra data in the packet for the handler to use, the server must implement both the [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) and the [**IStdMarshalInfo**](/windows/win32/api/objidlbase/nn-objidlbase-istdmarshalinfo) interfaces.</span></span> <span data-ttu-id="af12e-105">Der Server muss den standardmarshaler aggregieren und den ersten Teil des Marshalling an den aggregierten Standard-Mars Haller, einschließlich [**IMarshal:: GetUnmarshalClass**](/windows/desktop/api/ObjIdl/nf-objidl-imarshal-getunmarshalclass), delegieren und seine eigene Datengröße der Größe hinzufügen, die vom standardmäßigen Mars Haller [**:: GetMarshalSizeMax**](/windows/desktop/api/ObjIdl/nf-objidl-imarshal-getmarshalsizemax)zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="af12e-105">The server must aggregate the standard marshaler and must delegate the first part of the marshaling to the aggregated standard marshaler, including [**IMarshal::GetUnmarshalClass**](/windows/desktop/api/ObjIdl/nf-objidl-imarshal-getunmarshalclass), and must add its own data size to the size returned by the standard marshaler's [**IMarshal::GetMarshalSizeMax**](/windows/desktop/api/ObjIdl/nf-objidl-imarshal-getmarshalsizemax).</span></span> <span data-ttu-id="af12e-106">Der Standard-Mars Haller ruft [**istdmarshalinfo:: getclassforhandler**](/windows/win32/api/objidlbase/nf-objidlbase-istdmarshalinfo-getclassforhandler) auf, um die CLSID des zu erstellenden Handlers zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="af12e-106">The standard marshaler calls [**IStdMarshalInfo::GetClassForHandler**](/windows/win32/api/objidlbase/nf-objidlbase-istdmarshalinfo-getclassforhandler) to get the CLSID of the handler to be created.</span></span> <span data-ttu-id="af12e-107">Nachdem der Standard-Mars Haller das Marshalling abgeschlossen hat, schreibt der Server seine eigenen zusätzlichen Daten in den Stream.</span><span class="sxs-lookup"><span data-stu-id="af12e-107">After the standard marshaler has done its marshaling, the server then writes its own extra data into the stream.</span></span> <span data-ttu-id="af12e-108">Die resultierenden Strukturen mit zusätzlichen Daten im Stream werden in der folgenden Abbildung dargestellt:</span><span class="sxs-lookup"><span data-stu-id="af12e-108">The resulting structures, with extra data in the stream, are shown in the following illustration:</span></span>

![Diagramm, das Strukturen mit zusätzlichen Daten im Stream anzeigt.](images/4cff306b-bb82-4c05-8e64-7ca73731f265.png)

## <a name="server-side-structures-with-extra-data-in-stream"></a><span data-ttu-id="af12e-110">Server-Side Strukturen mit zusätzlichen Daten im Stream</span><span class="sxs-lookup"><span data-stu-id="af12e-110">Server-Side Structures with Extra Data in Stream</span></span>

<span data-ttu-id="af12e-111">Dies ermöglicht es dem com- [**ansichtinterface**](/windows/desktop/api/combaseapi/nf-combaseapi-counmarshalinterface) , auf der Clientseite alle ungelesenen Daten zu überspringen und den Stream nach allen gemarshallten Schnittstellen Daten an der entsprechenden Position zu belassen, wenn der Handler nicht erstellt werden kann.</span><span class="sxs-lookup"><span data-stu-id="af12e-111">This allows the call from COM to [**CoUnmarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-counmarshalinterface) on the client side the ability to skip over any unread data and leave the stream in the appropriate position following all the marshaled interface data if the handler cannot be created.</span></span>

## <a name="client-side-structures-with-extra-data-in-stream"></a><span data-ttu-id="af12e-112">Client-Side Strukturen mit zusätzlichen Daten im Stream</span><span class="sxs-lookup"><span data-stu-id="af12e-112">Client-Side Structures with Extra Data in Stream</span></span>

<span data-ttu-id="af12e-113">Wie in dem Fall, in dem keine zusätzlichen Serverdaten im Stream vorhanden sind, erstellt der Client seitige com-Befehl von " [**zählmarshalinterface**](/windows/desktop/api/combaseapi/nf-combaseapi-counmarshalinterface) " die Identität und den Handler.</span><span class="sxs-lookup"><span data-stu-id="af12e-113">As in the case where there is no extra server data in the stream, the client-side COM call to [**CoUnmarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-counmarshalinterface) will create the identity and handler.</span></span> <span data-ttu-id="af12e-114">Der Handler muss die Methode " [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) " implementieren und die **IMarshal** -Aufrufe zuerst an den aggregierten Standard-Mars Haller delegieren und dann alle zusätzlichen Daten, die der Server bereitgestellt hat, Mars Hallen bzw. aus dem Mars Hallen.</span><span class="sxs-lookup"><span data-stu-id="af12e-114">The handler must implement [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) and must delegate the **IMarshal** calls to the aggregated standard marshaler first and then marshal or unmarshal any extra data that the server provided.</span></span> <span data-ttu-id="af12e-115">Die [**UnmarshalInterface**](/windows/win32/api/objidlbase/nf-objidlbase-imarshal-unmarshalinterface) -Methode des Handlers wird für jedes unmars Hall aufgerufen, unabhängig davon, ob die Schnittstelle vor oder nach dem Marshalling von ihr gemarshallt wurde.</span><span class="sxs-lookup"><span data-stu-id="af12e-115">The handler's [**UnmarshalInterface**](/windows/win32/api/objidlbase/nf-objidlbase-imarshal-unmarshalinterface) will be called for every unmarshal, regardless of whether it has unmarshaled the interface before or not.</span></span> <span data-ttu-id="af12e-116">In diesem Fall ruft der Server nicht [**cogetstdmarshalex**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex) auf, aber der Handler muss.</span><span class="sxs-lookup"><span data-stu-id="af12e-116">In this case, the server does not call [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex) but the handler must.</span></span> <span data-ttu-id="af12e-117">Die resultierende Client seitige Struktur wird in der folgenden Abbildung dargestellt.</span><span class="sxs-lookup"><span data-stu-id="af12e-117">The resulting client-side structure is shown in the following illustration.</span></span>

![Diagramm, das die Client seitige Struktur anzeigt.](images/053411c7-9d54-4ae5-bcb6-778454b1d86f.png)

## <a name="related-topics"></a><span data-ttu-id="af12e-119">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="af12e-119">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="af12e-120">Der Lightweight Client-Side-Handler</span><span class="sxs-lookup"><span data-stu-id="af12e-120">The Lightweight Client-Side Handler</span></span>](the-lightweight-client-side-handler.md)
</dt> </dl>

 

 