---
title: Prozesse, Threads und Apartments
description: Bei einem Prozess handelt es sich um eine Sammlung von virtuellem Speicherbereich, Code, Daten und Systemressourcen.
ms.assetid: cb62412a-d079-40f9-89dc-cce0bf3889af
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d598fc9d7dd39ab070b58aa7ba45a6e2fcae90db
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/21/2020
ms.locfileid: "104391050"
---
# <a name="processes-threads-and-apartments"></a><span data-ttu-id="16dfa-103">Prozesse, Threads und Apartments</span><span class="sxs-lookup"><span data-stu-id="16dfa-103">Processes, Threads, and Apartments</span></span>

<span data-ttu-id="16dfa-104">Bei einem *Prozess* handelt es sich um eine Sammlung von virtuellem Speicherbereich, Code, Daten und Systemressourcen.</span><span class="sxs-lookup"><span data-stu-id="16dfa-104">A *process* is a collection of virtual memory space, code, data, and system resources.</span></span> <span data-ttu-id="16dfa-105">Ein *Thread* ist ein Code, der in einem Prozess seriell ausgeführt werden soll.</span><span class="sxs-lookup"><span data-stu-id="16dfa-105">A *thread* is code that is to be serially executed within a process.</span></span> <span data-ttu-id="16dfa-106">Ein Prozessor führt Threads und keine Prozesse aus, sodass jede Anwendung mindestens einen Prozess aufweist und ein Prozess immer mindestens einen Ausführungs Thread aufweist, der als primärer Thread bezeichnet wird.</span><span class="sxs-lookup"><span data-stu-id="16dfa-106">A processor executes threads, not processes, so each application has at least one process, and a process always has at least one thread of execution, known as the primary thread.</span></span> <span data-ttu-id="16dfa-107">Ein Prozess kann neben dem primären Thread mehrere Threads aufweisen.</span><span class="sxs-lookup"><span data-stu-id="16dfa-107">A process can have multiple threads in addition to the primary thread.</span></span>

<span data-ttu-id="16dfa-108">Prozesse kommunizieren über Nachrichten miteinander und verwenden die RPC-Technologie (Remote Procedure Aufruf) von Microsoft, um Informationen an einander zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="16dfa-108">Processes communicate with one another through messages, using Microsoft's Remote Procedure Call (RPC) technology to pass information to one another.</span></span> <span data-ttu-id="16dfa-109">Es gibt keinen Unterschied zwischen einem Aufruf von einem Prozess auf einem Remote Computer und einem Aufruf von einem anderen Prozess auf demselben Computer.</span><span class="sxs-lookup"><span data-stu-id="16dfa-109">There is no difference to the caller between a call coming from a process on a remote machine and a call coming from another process on the same machine.</span></span>

<span data-ttu-id="16dfa-110">Wenn ein Thread gestartet wird, wird er so lange fortgesetzt, bis er abgebrochen wird, oder bis er von einem Thread mit höherer Priorität (durch eine Benutzeraktion oder den Thread Planer des Kernels) unterbrochen wird.</span><span class="sxs-lookup"><span data-stu-id="16dfa-110">When a thread begins to execute, it continues until it is killed or until it is interrupted by a thread with higher priority (by a user action or the kernel's thread scheduler).</span></span> <span data-ttu-id="16dfa-111">Jeder Thread kann separate Code Abschnitte ausführen, oder mehrere Threads können denselben Code Abschnitt ausführen.</span><span class="sxs-lookup"><span data-stu-id="16dfa-111">Each thread can run separate sections of code, or multiple threads can execute the same section of code.</span></span> <span data-ttu-id="16dfa-112">Threads, die denselben Codeblock ausführen, behalten separate Stapel.</span><span class="sxs-lookup"><span data-stu-id="16dfa-112">Threads executing the same block of code maintain separate stacks.</span></span> <span data-ttu-id="16dfa-113">Jeder Thread in einem Prozess teilt die globalen Variablen und Ressourcen dieses Prozesses.</span><span class="sxs-lookup"><span data-stu-id="16dfa-113">Each thread in a process shares that process's global variables and resources.</span></span>

<span data-ttu-id="16dfa-114">Der Thread Planer legt fest, wann und wie oft ein Thread ausgeführt werden soll. Dies entspricht einer Kombination des Prioritäts Klassen Attributs des Prozesses und der Basis Priorität des Threads.</span><span class="sxs-lookup"><span data-stu-id="16dfa-114">The thread scheduler determines when and how often to execute a thread, according to a combination of the process's priority class attribute and the thread's base priority.</span></span> <span data-ttu-id="16dfa-115">Sie legen das Prioritäts Klassen Attribut eines Prozesses fest, indem Sie die [**setpriorityclass**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-setpriorityclass) -Funktion aufrufen, und Sie legen die Basis Priorität eines Threads mit einem Aufruf von [**SetThreadPriority**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-setthreadpriority)fest.</span><span class="sxs-lookup"><span data-stu-id="16dfa-115">You set a process's priority class attribute by calling the [**SetPriorityClass**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-setpriorityclass) function , and you set a thread's base priority with a call to [**SetThreadPriority**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-setthreadpriority).</span></span>

<span data-ttu-id="16dfa-116">Multithreadanwendungen müssen zwei Threading Probleme vermeiden: *Deadlocks* und *Races*.</span><span class="sxs-lookup"><span data-stu-id="16dfa-116">Multithreaded applications must avoid two threading problems: *deadlocks* and *races*.</span></span> <span data-ttu-id="16dfa-117">Ein Deadlock tritt auf, wenn jeder Thread darauf wartet, etwas auszuführen.</span><span class="sxs-lookup"><span data-stu-id="16dfa-117">A deadlock occurs when each thread is waiting for the other to do something.</span></span> <span data-ttu-id="16dfa-118">Das com-Aufruf Steuerelement hilft dabei, Deadlocks in Aufrufen zwischen Objekten zu verhindern.</span><span class="sxs-lookup"><span data-stu-id="16dfa-118">The COM call control helps prevent deadlocks in calls between objects.</span></span> <span data-ttu-id="16dfa-119">Eine Racebedingung tritt auf, wenn ein Thread vor einem anderen beendet wird, von dem er abhängt, sodass der erste einen nicht initialisierten Wert verwendet, da letztere noch keinen gültigen Wert bereitgestellt hat.</span><span class="sxs-lookup"><span data-stu-id="16dfa-119">A race condition occurs when one thread finishes before another on which it depends, causing the former to use an uninitialized value because the latter has not yet supplied a valid one.</span></span> <span data-ttu-id="16dfa-120">COM bietet einige Funktionen, die speziell entwickelt wurden, um Racebedingungen in Prozess externen Servern zu vermeiden.</span><span class="sxs-lookup"><span data-stu-id="16dfa-120">COM supplies some functions specifically designed to help avoid race conditions in out-of-process servers.</span></span> <span data-ttu-id="16dfa-121">(Siehe [Implementierungs Hilfen für Out-of-Process-Server](out-of-process-server-implementation-helpers.md).)</span><span class="sxs-lookup"><span data-stu-id="16dfa-121">(See [Out-of-Process Server Implementation Helpers](out-of-process-server-implementation-helpers.md).)</span></span>

## <a name="the-apartment-and-the-com-threading-architecture"></a><span data-ttu-id="16dfa-122">Das Apartment und die COM-Threading Architektur</span><span class="sxs-lookup"><span data-stu-id="16dfa-122">The Apartment and the COM Threading Architecture</span></span>

<span data-ttu-id="16dfa-123">COM unterstützt das Modell mit einem Thread pro Prozess, das vor der Einführung mehrerer Ausführungs Threads weit verbreitet ist, aber Sie können Code schreiben, um mehrere Threads zu nutzen, was zu effizienteren Anwendungen führt, indem ein Thread ausgeführt werden kann, während ein anderer Thread auf den Abschluss eines zeitaufwändigen Vorgangs wartet.</span><span class="sxs-lookup"><span data-stu-id="16dfa-123">While COM supports the single-thread-per-process model prevalent before the introduction of multiple threads of execution, you can write code to take advantage of multiple threads, resulting in more efficient applications, by allowing one thread to be executed while another thread waits for some time-consuming operation to complete.</span></span>

> [!Note]  
> <span data-ttu-id="16dfa-124">Die Verwendung mehrerer Threads ist keine Garantie für eine bessere Leistung.</span><span class="sxs-lookup"><span data-stu-id="16dfa-124">Using multiple threads is not a guarantee of better performance.</span></span> <span data-ttu-id="16dfa-125">Tatsächlich verursacht die Verwendung mehrerer Threads häufig Leistungsprobleme, da die Thread Factoring ein schwieriges Problem ist.</span><span class="sxs-lookup"><span data-stu-id="16dfa-125">In fact, because thread factoring is a difficult problem, using multiple threads often causes performance problems.</span></span> <span data-ttu-id="16dfa-126">Der Schlüssel besteht darin, mehrere Threads nur zu verwenden, wenn Sie sich sehr sicher sind, was Sie tun.</span><span class="sxs-lookup"><span data-stu-id="16dfa-126">The key is to use multiple threads only if you are very sure of what you are doing.</span></span>

 

<span data-ttu-id="16dfa-127">Im Allgemeinen besteht die einfachste Möglichkeit zum Anzeigen der com-Threading Architektur darin, alle COM-Objekte im Prozess als unterteilt in Gruppen, die als " *Apartments*" bezeichnet werden, zu betrachten.</span><span class="sxs-lookup"><span data-stu-id="16dfa-127">In general, the simplest way to view the COM threading architecture is to think of all the COM objects in the process as divided into groups called *apartments*.</span></span> <span data-ttu-id="16dfa-128">Ein COM-Objekt befindet sich in genau einem Apartment, in dem Sinne, dass seine Methoden rechtmäßig direkt von einem Thread aufgerufen werden können, der zu diesem Apartment gehört.</span><span class="sxs-lookup"><span data-stu-id="16dfa-128">A COM object lives in exactly one apartment, in the sense that its methods can legally be directly called only by a thread that belongs to that apartment.</span></span> <span data-ttu-id="16dfa-129">Jeder andere Thread, der das-Objekt aufrufen möchte, muss über einen Proxy verfügen.</span><span class="sxs-lookup"><span data-stu-id="16dfa-129">Any other thread that wants to call the object must go through a proxy.</span></span>

<span data-ttu-id="16dfa-130">Es gibt zwei Arten von Apartments: [Single Thread-Apartments](single-threaded-apartments.md)und [Multithread-Apartments](multithreaded-apartments.md).</span><span class="sxs-lookup"><span data-stu-id="16dfa-130">There are two types of apartments: [single-threaded apartments](single-threaded-apartments.md), and [multithreaded apartments](multithreaded-apartments.md).</span></span>

-   <span data-ttu-id="16dfa-131">Single Thread-Apartments bestehen aus genau einem Thread, sodass alle COM-Objekte, die in einem Single Thread-Apartment Leben, nur Methodenaufrufe von einem Thread empfangen können, der zu diesem Apartment gehört.</span><span class="sxs-lookup"><span data-stu-id="16dfa-131">Single-threaded apartments consist of exactly one thread, so all COM objects that live in a single-threaded apartment can receive method calls only from the one thread that belongs to that apartment.</span></span> <span data-ttu-id="16dfa-132">Alle Methodenaufrufe an ein COM-Objekt in einem Single Thread-Apartment werden mit der Windows-Nachrichten Warteschlange für den Thread des Single Thread-Apartment synchronisiert.</span><span class="sxs-lookup"><span data-stu-id="16dfa-132">All method calls to a COM object in a single-threaded apartment are synchronized with the windows message queue for the single-threaded apartment's thread.</span></span> <span data-ttu-id="16dfa-133">Ein Prozess mit einem einzigen Ausführungs Thread ist einfach ein Sonderfall dieses Modells.</span><span class="sxs-lookup"><span data-stu-id="16dfa-133">A process with a single thread of execution is simply a special case of this model.</span></span>
-   <span data-ttu-id="16dfa-134">Multithreadwohnungen bestehen aus mindestens einem Thread, sodass alle COM-Objekte, die sich in einem Multithreadapartment befinden, Methodenaufrufe direkt von jedem Thread empfangen können, der zum Multithreadapartment gehört.</span><span class="sxs-lookup"><span data-stu-id="16dfa-134">Multithreaded apartments consist of one or more threads, so all COM objects that live in an multithreaded apartment can receive method calls directly from any of the threads that belong to the multithreaded apartment.</span></span> <span data-ttu-id="16dfa-135">Für Threads in einem Multithreadapartment wird ein Modell namens " *Free-Threading*" verwendet.</span><span class="sxs-lookup"><span data-stu-id="16dfa-135">Threads in a multithreaded apartment use a model called *free-threading*.</span></span> <span data-ttu-id="16dfa-136">Aufrufe von COM-Objekten in einem Multithread-Apartment werden von den Objekten selbst synchronisiert.</span><span class="sxs-lookup"><span data-stu-id="16dfa-136">Calls to COM objects in a multithreaded apartment are synchronized by the objects themselves.</span></span>

> [!Note]  
> <span data-ttu-id="16dfa-137">Eine Beschreibung der Kommunikation zwischen Single Thread-Apartments und Multithread-Apartments innerhalb desselben Prozesses finden Sie unter [Single Thread-und Multithread-Kommunikation](single-threaded-and-multithreaded-communication.md).</span><span class="sxs-lookup"><span data-stu-id="16dfa-137">For a description of communication between single-threaded apartments and multithreaded apartments within the same process, see [Single-Threaded and Multithreaded Communication](single-threaded-and-multithreaded-communication.md).</span></span>

 

<span data-ttu-id="16dfa-138">Ein Prozess kann über NULL oder mehr Single Thread-Apartments und NULL oder ein Multithread-Apartment verfügen.</span><span class="sxs-lookup"><span data-stu-id="16dfa-138">A process can have zero or more single-threaded apartments and zero or one multithreaded apartment.</span></span>

<span data-ttu-id="16dfa-139">In einem Prozess ist das Haupt Apartment das erste, das initialisiert werden soll.</span><span class="sxs-lookup"><span data-stu-id="16dfa-139">In a process, the main apartment is the first to be initialized.</span></span> <span data-ttu-id="16dfa-140">In einem Single Thread-Prozess ist dies das einzige Apartment.</span><span class="sxs-lookup"><span data-stu-id="16dfa-140">In a single-threaded process, this is the only apartment.</span></span> <span data-ttu-id="16dfa-141">Die Rückruf Parameter werden zwischen den Apartments gemarshallt, und com behandelt die Synchronisierung über Messaging.</span><span class="sxs-lookup"><span data-stu-id="16dfa-141">Call parameters are marshaled between apartments, and COM handles the synchronization through messaging.</span></span> <span data-ttu-id="16dfa-142">Wenn Sie mehrere Threads in einem Prozess als frei Thread festgelegt haben, befinden sich alle freien Threads in einem einzelnen Apartment, und die Parameter werden direkt an jeden Thread im Apartment übermittelt, und Sie müssen die gesamte Synchronisierung verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="16dfa-142">If you designate multiple threads in a process to be free-threaded, all free threads reside in a single apartment, parameters are passed directly to any thread in the apartment, and you must handle all synchronization.</span></span> <span data-ttu-id="16dfa-143">In einem Prozess, der sowohl das kostenlose Threading als auch das Apartment Threading hat, befinden sich alle freien Threads in einem einzigen Apartment, und alle anderen Apartments sind Single Thread-Apartments.</span><span class="sxs-lookup"><span data-stu-id="16dfa-143">In a process with both free-threading and apartment threading, all free threads reside in a single apartment and all other apartments are single-threaded apartments.</span></span> <span data-ttu-id="16dfa-144">Ein Prozess, bei dem com funktioniert, ist eine Sammlung von Apartments, bei denen höchstens ein Multithread-Apartment, aber eine beliebige Anzahl von Single Thread-Apartments vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="16dfa-144">A process that does COM work is a collection of apartments with, at most, one multithreaded apartment but any number of single-threaded apartments.</span></span>

<span data-ttu-id="16dfa-145">Die Threading Modelle in com bieten den Mechanismus für Clients und Server, die verschiedene Threading Architekturen für die Zusammenarbeit verwenden.</span><span class="sxs-lookup"><span data-stu-id="16dfa-145">The threading models in COM provide the mechanism for clients and servers that use different threading architectures to work together.</span></span> <span data-ttu-id="16dfa-146">Aufrufe zwischen Objekten mit unterschiedlichen Threading Modellen in verschiedenen Prozessen werden natürlich unterstützt.</span><span class="sxs-lookup"><span data-stu-id="16dfa-146">Calls among objects with different threading models in different processes are naturally supported.</span></span> <span data-ttu-id="16dfa-147">Aus der Perspektive des aufrufenden Objekts Verhalten sich alle Aufrufe von Objekten außerhalb eines Prozesses identisch, unabhängig davon, wie das Objekt, das aufgerufen wird, Thread Weise ist.</span><span class="sxs-lookup"><span data-stu-id="16dfa-147">From the perspective of the calling object, all calls to objects outside a process behave identically, no matter how the object being called is threaded.</span></span> <span data-ttu-id="16dfa-148">Ebenso verhalten sich eintreffende Aufrufe aus der Perspektive des aufgerufenen Objekts identisch, unabhängig vom Threading Modell des Aufrufers.</span><span class="sxs-lookup"><span data-stu-id="16dfa-148">Likewise, from the perspective of the object being called, arriving calls behave identically, regardless of the threading model of the caller.</span></span>

<span data-ttu-id="16dfa-149">Die Interaktion zwischen einem Client und einem Out-of-Process-Objekt ist einfach, auch wenn es verschiedene Threading Modelle verwendet, da sich der Client und das Objekt in verschiedenen Prozessen befinden.</span><span class="sxs-lookup"><span data-stu-id="16dfa-149">Interaction between a client and an out-of-process object is straightforward, even when they use different threading models because the client and object are in different processes.</span></span> <span data-ttu-id="16dfa-150">COM, das zwischen dem Client und dem Server interagiert, kann den Code für die Zusammenarbeit der Threading Modelle bereitstellen, indem Standard-Marshalling und RPC verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="16dfa-150">COM, interposed between the client and the server, can provide the code for the threading models to interoperate, using standard marshaling and RPC.</span></span> <span data-ttu-id="16dfa-151">Wenn z. b. ein Single Thread-Objekt gleichzeitig von mehreren frei Thread Clients aufgerufen wird, werden die Aufrufe durch com synchronisiert, indem entsprechende Fenster Meldungen in der Nachrichten Warteschlange des Servers platziert werden.</span><span class="sxs-lookup"><span data-stu-id="16dfa-151">For example, if a single-threaded object is called simultaneously by multiple free-threaded clients, the calls will be synchronized by COM by placing corresponding window messages in the server's message queue.</span></span> <span data-ttu-id="16dfa-152">Das Apartment des Objekts erhält jedes Mal einen Aufruf, wenn Nachrichten abgerufen und gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="16dfa-152">The object's apartment will receive one call each time it retrieves and dispatches messages.</span></span> <span data-ttu-id="16dfa-153">Es muss jedoch ein gewisses Vorsicht geboten werden, um sicherzustellen, dass Prozess interne Server ordnungsgemäß mit ihren Clients interagieren.</span><span class="sxs-lookup"><span data-stu-id="16dfa-153">However, some care must be taken to ensure that in-process servers interact properly with their clients.</span></span> <span data-ttu-id="16dfa-154">(Siehe [Threading Probleme in Process Server](in-process-server-threading-issues.md).)</span><span class="sxs-lookup"><span data-stu-id="16dfa-154">(See [In-Process Server Threading Issues](in-process-server-threading-issues.md).)</span></span>

<span data-ttu-id="16dfa-155">Das wichtigste Problem bei der Programmierung mit einem multithreadmodell besteht darin, den Code Thread sicher zu machen, sodass Nachrichten, die für einen bestimmten Thread vorgesehen sind, nur an diesen Thread gesendet werden und der Zugriff auf Threads geschützt ist.</span><span class="sxs-lookup"><span data-stu-id="16dfa-155">The most important issue in programming with a multithreaded model is to make your code thread-safe so that messages intended for a particular thread go only to that thread and access to threads is protected.</span></span>

<span data-ttu-id="16dfa-156">Weitere Informationen finden Sie unter den folgenden Themen:</span><span class="sxs-lookup"><span data-stu-id="16dfa-156">For more information, see the following topics:</span></span>

-   [<span data-ttu-id="16dfa-157">Auswählen des Threading Modells</span><span class="sxs-lookup"><span data-stu-id="16dfa-157">Choosing the Threading Model</span></span>](choosing-the-threading-model.md)
-   [<span data-ttu-id="16dfa-158">Single Thread-Apartments</span><span class="sxs-lookup"><span data-stu-id="16dfa-158">Single-Threaded Apartments</span></span>](single-threaded-apartments.md)
-   [<span data-ttu-id="16dfa-159">Multithread-Apartments</span><span class="sxs-lookup"><span data-stu-id="16dfa-159">Multithreaded Apartments</span></span>](multithreaded-apartments.md)
-   [<span data-ttu-id="16dfa-160">Single Thread-und Multithread-Kommunikation</span><span class="sxs-lookup"><span data-stu-id="16dfa-160">Single-Threaded and Multithreaded Communication</span></span>](single-threaded-and-multithreaded-communication.md)
-   [<span data-ttu-id="16dfa-161">Threading Probleme im Prozess internen Server</span><span class="sxs-lookup"><span data-stu-id="16dfa-161">In-Process Server Threading Issues</span></span>](in-process-server-threading-issues.md)
-   [<span data-ttu-id="16dfa-162">Zugreifen auf Schnittstellen über mehrere Apartments</span><span class="sxs-lookup"><span data-stu-id="16dfa-162">Accessing Interfaces Across Apartments</span></span>](accessing-interfaces-across-apartments.md)

 

 