---
title: Cloaking (com)
description: Das Cloaking ist eine com-Sicherheitsfunktion, die bestimmt, welche Identität der Client während des Identitäts Wechsels auf den Server projiziert.
ms.assetid: 5b97d9d6-8fa9-4da2-8351-64772227d9a2
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 588651cfa37def4e174ef0f2fdba9b79b0c60ca8
ms.sourcegitcommit: d39e82e232f6510f843fdb8d55d25b4e9e02e880
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 02/03/2021
ms.locfileid: "103869316"
---
# <a name="cloaking-com"></a><span data-ttu-id="f0f31-103">Cloaking (com)</span><span class="sxs-lookup"><span data-stu-id="f0f31-103">Cloaking (COM)</span></span>

<span data-ttu-id="f0f31-104">Das Cloaking ist eine com-Sicherheitsfunktion, die bestimmt, welche Identität der Client während des Identitäts Wechsels auf den Server projiziert.</span><span class="sxs-lookup"><span data-stu-id="f0f31-104">Cloaking is a COM security capability that determines what identity the client projects toward the server during impersonation.</span></span> <span data-ttu-id="f0f31-105">Wenn das Cloaking festgelegt ist, maskiert der zwischen Server seine eigene Identität und stellt die Identität des Clients für den Server dar, den er im Auftrag des Clients aufruft.</span><span class="sxs-lookup"><span data-stu-id="f0f31-105">When cloaking is set, the intermediate server masks its own identity and presents the client's identity to the server that it calls on the client's behalf.</span></span> <span data-ttu-id="f0f31-106">Allem die Client Identität, die vom Server erkannt wird, ist die Identität, die dem Proxy zugeordnet ist.</span><span class="sxs-lookup"><span data-stu-id="f0f31-106">Basically; the client identity that is seen by the server is the identity associated with the proxy.</span></span> <span data-ttu-id="f0f31-107">Die Identität des Proxys wird durch verschiedene Faktoren bestimmt. eine davon ist der Typ der festgelegten Art von Verstopfungen (sofern vorhanden).</span><span class="sxs-lookup"><span data-stu-id="f0f31-107">The proxy's identity is determined by several factors, one of which is the type of cloaking that is set (if any).</span></span> <span data-ttu-id="f0f31-108">Das clonel wird vom SChannel-Sicherheitsanbieter nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="f0f31-108">Cloaking is not supported by the Schannel security provider.</span></span>

<span data-ttu-id="f0f31-109">Die folgenden Themen enthalten weitere Informationen zum Verlust:</span><span class="sxs-lookup"><span data-stu-id="f0f31-109">The following topics provide more information about cloaking:</span></span>

-   [<span data-ttu-id="f0f31-110">Arten von Verstopfungen</span><span class="sxs-lookup"><span data-stu-id="f0f31-110">Types of Cloaking</span></span>](#types-of-cloaking)
-   [<span data-ttu-id="f0f31-111">Auswirkungen der Cloaking auf die Client Identität</span><span class="sxs-lookup"><span data-stu-id="f0f31-111">How Cloaking Affects Client Identity</span></span>](#how-cloaking-affects-client-identity)
-   [<span data-ttu-id="f0f31-112">Festlegen des Cloaking</span><span class="sxs-lookup"><span data-stu-id="f0f31-112">Setting Cloaking</span></span>](#setting-cloaking)
-   [<span data-ttu-id="f0f31-113">Verstopfungen und Identitätswechsel Ebenen</span><span class="sxs-lookup"><span data-stu-id="f0f31-113">Cloaking and Impersonation Levels</span></span>](#cloaking-and-impersonation-levels)
-   [<span data-ttu-id="f0f31-114">Cloaking-Szenarien</span><span class="sxs-lookup"><span data-stu-id="f0f31-114">Cloaking Scenarios</span></span>](#cloaking-scenarios)
-   [<span data-ttu-id="f0f31-115">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="f0f31-115">Related topics</span></span>](#related-topics)

## <a name="types-of-cloaking"></a><span data-ttu-id="f0f31-116">Arten von Verstopfungen</span><span class="sxs-lookup"><span data-stu-id="f0f31-116">Types of Cloaking</span></span>

<span data-ttu-id="f0f31-117">Es gibt zwei Arten von Verstopfungen: *statischer* und *dynamischer* Cloaking:</span><span class="sxs-lookup"><span data-stu-id="f0f31-117">There are two types of cloaking: *static* cloaking and *dynamic* cloaking:</span></span>

-   <span data-ttu-id="f0f31-118">Bei statischem Cloaking (eoac \_ static \_ Cloaking) sieht der Server das Thread Token vom ersten-Client an den Server.</span><span class="sxs-lookup"><span data-stu-id="f0f31-118">With static cloaking (EOAC\_STATIC\_CLOAKING), the server sees the thread token from the first call from a client to the server.</span></span> <span data-ttu-id="f0f31-119">Für den ersten-Befehl wird die Proxy Identität verwendet, wenn die Proxy Identität zuvor während eines Aufrufes von [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket)festgelegt wurde.</span><span class="sxs-lookup"><span data-stu-id="f0f31-119">For the first call, if the proxy identity was previously set during a call to [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket), that proxy identity is used.</span></span> <span data-ttu-id="f0f31-120">Wenn die Proxy Identität jedoch nicht zuvor festgelegt wurde, wird das Thread Token verwendet.</span><span class="sxs-lookup"><span data-stu-id="f0f31-120">However, if the proxy identity was not previously set, the thread token is used.</span></span> <span data-ttu-id="f0f31-121">Wenn kein Thread Token vorhanden ist, wird das Prozess Token verwendet.</span><span class="sxs-lookup"><span data-stu-id="f0f31-121">If no thread token is present, the process token is used.</span></span> <span data-ttu-id="f0f31-122">Bei allen zukünftigen aufrufen wird die für den ersten Aufruf festgelegte Identität verwendet.</span><span class="sxs-lookup"><span data-stu-id="f0f31-122">For all future calls, the identity set on the first call is used.</span></span>
-   <span data-ttu-id="f0f31-123">Mit dynamischem Cloaking (eoac \_ Dynamic \_ Cloaking) wird bei jedem-Rückruf das aktuelle Thread Token (wenn ein Thread Token vorhanden ist) verwendet, um die Identität des Clients zu bestimmen.</span><span class="sxs-lookup"><span data-stu-id="f0f31-123">With dynamic cloaking (EOAC\_DYNAMIC\_CLOAKING), on each call the current thread token (if there is a thread token) is used to determine the client's identity.</span></span> <span data-ttu-id="f0f31-124">Wenn kein Thread Token vorhanden ist, wird das Prozess Token verwendet.</span><span class="sxs-lookup"><span data-stu-id="f0f31-124">If there is no thread token, the process token is used.</span></span> <span data-ttu-id="f0f31-125">Dies bedeutet, dass bei Servern, die im Auftrag des Clients während des Identitäts Wechsels aufgerufen werden, die Identität des com-Clients angezeigt wird, von dem der Aufruf stammt, was im Allgemeinen das gewünschte Verhalten ist.</span><span class="sxs-lookup"><span data-stu-id="f0f31-125">This means that servers called on the client's behalf during impersonation see the identity of the COM client that originated the call, which is generally the desired behavior.</span></span> <span data-ttu-id="f0f31-126">(Um einen Identitätswechsel erfolgreich durchführen zu können, muss der Client die Server Autorität zum Annehmen der Identität durch Festlegen einer entsprechenden Identitätswechsel Ebene erhalten.</span><span class="sxs-lookup"><span data-stu-id="f0f31-126">(Of course, for impersonation to succeed, the client must have given the server authority to impersonate by setting an appropriate impersonation level.</span></span> <span data-ttu-id="f0f31-127">Weitere Informationen finden Sie unter Identitätswechsel [Ebenen](impersonation-levels.md).) Diese Art des Cloaking ist aufwendig.</span><span class="sxs-lookup"><span data-stu-id="f0f31-127">For more information, see [Impersonation Levels](impersonation-levels.md).) This type of cloaking is expensive.</span></span>

## <a name="how-cloaking-affects-client-identity"></a><span data-ttu-id="f0f31-128">Auswirkungen der Cloaking auf die Client Identität</span><span class="sxs-lookup"><span data-stu-id="f0f31-128">How Cloaking Affects Client Identity</span></span>

<span data-ttu-id="f0f31-129">Wenn ein verschlüsselter-Vorgang ausgeführt wird und der Server die Identität des Clients anfordert, wird die Identität, die an den Proxy gebunden ist, in der Regel abgerufen.</span><span class="sxs-lookup"><span data-stu-id="f0f31-129">When an encrypted call is made and the server asks the client for its identity, it usually gets the identity tied to the proxy.</span></span> <span data-ttu-id="f0f31-130">(Manchmal führt der Authentifizierungsdienst eine Übersetzung von der tatsächlichen Identität aus, aber im Allgemeinen ist die Proxy Identität die Identität, die der Server sieht.) Der Proxy stellt eine Identität für den Server dar, die vom Typ der festgelegten Knoten und anderen Faktoren abhängig ist.</span><span class="sxs-lookup"><span data-stu-id="f0f31-130">(Sometimes the authentication service performs a translation from the real identity, but generally the proxy identity is the identity the server sees.) The proxy presents an identity to the server that depends on the type of cloaking that is set and other factors.</span></span>

<span data-ttu-id="f0f31-131">Zusammenfassend gilt: die Identität des Clients ist eine Funktion des festgelegten Cloaking-Flags, des Prozess Tokens, des Vorhandenseins oder Fehlens eines Thread Tokens und der Angabe, ob die Proxy Identität zuvor festgelegt wurde.</span><span class="sxs-lookup"><span data-stu-id="f0f31-131">To summarize, the identity of the client is a function of the cloaking flag set, the process token, the presence or absence of a thread token, and whether the proxy identity has been previously set.</span></span> <span data-ttu-id="f0f31-132">In der folgenden Tabelle wird die resultierende Proxy Identität (Client Identität) angezeigt, wenn diese Faktoren variieren.</span><span class="sxs-lookup"><span data-stu-id="f0f31-132">The following table shows the resulting proxy identity (client identity) when these factors vary.</span></span>



| <span data-ttu-id="f0f31-133">Cloaking von Flags</span><span class="sxs-lookup"><span data-stu-id="f0f31-133">Cloaking Flags</span></span>                     | <span data-ttu-id="f0f31-134">Thread-tokenpräsenz</span><span class="sxs-lookup"><span data-stu-id="f0f31-134">Thread Token Presence</span></span>  | <span data-ttu-id="f0f31-135">Zuvor festgelegte Proxy Identität</span><span class="sxs-lookup"><span data-stu-id="f0f31-135">Proxy Identity Previously Set</span></span> | <span data-ttu-id="f0f31-136">Proxy Identität (Client Identität)</span><span class="sxs-lookup"><span data-stu-id="f0f31-136">Proxy Identity (Client Identity)</span></span>                    |
|------------------------------------|------------------------|-------------------------------|-----------------------------------------------------|
| <span data-ttu-id="f0f31-137">Cloaking nicht festgelegt</span><span class="sxs-lookup"><span data-stu-id="f0f31-137">Cloaking not set</span></span><br/>        | <span data-ttu-id="f0f31-138">Ist doch egal</span><span class="sxs-lookup"><span data-stu-id="f0f31-138">Don't care</span></span><br/>  | <span data-ttu-id="f0f31-139">Ist doch egal</span><span class="sxs-lookup"><span data-stu-id="f0f31-139">Don't care</span></span><br/>         | <span data-ttu-id="f0f31-140">Prozess Token oder Authentifizierungs Identität</span><span class="sxs-lookup"><span data-stu-id="f0f31-140">Process token or authentication identity</span></span><br/> |
| <span data-ttu-id="f0f31-141">statische eoac- \_ \_ Cloaking</span><span class="sxs-lookup"><span data-stu-id="f0f31-141">EOAC\_STATIC\_CLOAKING</span></span><br/>  | <span data-ttu-id="f0f31-142">Anzahl</span><span class="sxs-lookup"><span data-stu-id="f0f31-142">Present</span></span><br/>     | <span data-ttu-id="f0f31-143">Nein</span><span class="sxs-lookup"><span data-stu-id="f0f31-143">No</span></span><br/>                 | <span data-ttu-id="f0f31-144">Thread Token</span><span class="sxs-lookup"><span data-stu-id="f0f31-144">Thread token</span></span><br/>                             |
| <span data-ttu-id="f0f31-145">statische eoac- \_ \_ Cloaking</span><span class="sxs-lookup"><span data-stu-id="f0f31-145">EOAC\_STATIC\_CLOAKING</span></span><br/>  | <span data-ttu-id="f0f31-146">Anzahl</span><span class="sxs-lookup"><span data-stu-id="f0f31-146">Present</span></span><br/>     | <span data-ttu-id="f0f31-147">Ja</span><span class="sxs-lookup"><span data-stu-id="f0f31-147">Yes</span></span><br/>                | <span data-ttu-id="f0f31-148">Aktuelle Proxy Identität</span><span class="sxs-lookup"><span data-stu-id="f0f31-148">Current proxy identity</span></span><br/>                   |
| <span data-ttu-id="f0f31-149">statische eoac- \_ \_ Cloaking</span><span class="sxs-lookup"><span data-stu-id="f0f31-149">EOAC\_STATIC\_CLOAKING</span></span><br/>  | <span data-ttu-id="f0f31-150">Nicht vorhanden</span><span class="sxs-lookup"><span data-stu-id="f0f31-150">Not present</span></span><br/> | <span data-ttu-id="f0f31-151">Nein</span><span class="sxs-lookup"><span data-stu-id="f0f31-151">No</span></span><br/>                 | <span data-ttu-id="f0f31-152">Prozess Token</span><span class="sxs-lookup"><span data-stu-id="f0f31-152">Process token</span></span><br/>                            |
| <span data-ttu-id="f0f31-153">statische eoac- \_ \_ Cloaking</span><span class="sxs-lookup"><span data-stu-id="f0f31-153">EOAC\_STATIC\_CLOAKING</span></span><br/>  | <span data-ttu-id="f0f31-154">Nicht vorhanden</span><span class="sxs-lookup"><span data-stu-id="f0f31-154">Not present</span></span><br/> | <span data-ttu-id="f0f31-155">Ja</span><span class="sxs-lookup"><span data-stu-id="f0f31-155">Yes</span></span><br/>                | <span data-ttu-id="f0f31-156">Aktuelle Proxy Identität</span><span class="sxs-lookup"><span data-stu-id="f0f31-156">Current proxy identity</span></span><br/>                   |
| <span data-ttu-id="f0f31-157">Dynamisches eoac- \_ \_ Cloaking</span><span class="sxs-lookup"><span data-stu-id="f0f31-157">EOAC\_DYNAMIC\_CLOAKING</span></span><br/> | <span data-ttu-id="f0f31-158">Anzahl</span><span class="sxs-lookup"><span data-stu-id="f0f31-158">Present</span></span><br/>     | <span data-ttu-id="f0f31-159">Ist doch egal</span><span class="sxs-lookup"><span data-stu-id="f0f31-159">Don't care</span></span><br/>         | <span data-ttu-id="f0f31-160">Thread Token</span><span class="sxs-lookup"><span data-stu-id="f0f31-160">Thread token</span></span><br/>                             |
| <span data-ttu-id="f0f31-161">Dynamisches eoac- \_ \_ Cloaking</span><span class="sxs-lookup"><span data-stu-id="f0f31-161">EOAC\_DYNAMIC\_CLOAKING</span></span><br/> | <span data-ttu-id="f0f31-162">Nicht vorhanden</span><span class="sxs-lookup"><span data-stu-id="f0f31-162">Not present</span></span><br/> | <span data-ttu-id="f0f31-163">Ist doch egal</span><span class="sxs-lookup"><span data-stu-id="f0f31-163">Don't care</span></span> <br/>        | <span data-ttu-id="f0f31-164">Prozess Token</span><span class="sxs-lookup"><span data-stu-id="f0f31-164">Process token</span></span><br/>                            |



 

<span data-ttu-id="f0f31-165">Im folgenden Flussdiagramm wird veranschaulicht, wie die Proxy Identität in unterschiedlichen Situationen bestimmt wird.</span><span class="sxs-lookup"><span data-stu-id="f0f31-165">The following flowchart illustrates how the proxy identity is determined in different situations.</span></span>

![Diagramm, das den Ablauf zum Ermitteln der Proxy Identität anzeigt.](images/9e8409b7-8475-4824-bdff-cf6b09c139c5.png)

## <a name="setting-cloaking"></a><span data-ttu-id="f0f31-167">Festlegen des Cloaking</span><span class="sxs-lookup"><span data-stu-id="f0f31-167">Setting Cloaking</span></span>

<span data-ttu-id="f0f31-168">Das Cloaking wird als funktionsflag in einem [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity)-aufrufswert festgelegt, der das Cloaking für den gesamten Prozess festlegt.</span><span class="sxs-lookup"><span data-stu-id="f0f31-168">Cloaking is set as a capability flag in a call to [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), which sets cloaking for the entire process.</span></span> <span data-ttu-id="f0f31-169">Diese Funktion wird dann so lange festgelegt, bis der Client Sie durch einen IClientSecurity::[**setblanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket) -Befehl (oder an [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket)) ändert, wodurch das Cloaking für den Proxy festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="f0f31-169">The cloaking capability is then set until the client changes it through a call to IClientSecurity::[**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket) (or to [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket)), which sets cloaking for the proxy.</span></span>

<span data-ttu-id="f0f31-170">Standardmäßig ist das Cloaking nicht festgelegt.</span><span class="sxs-lookup"><span data-stu-id="f0f31-170">By default, cloaking is not set.</span></span> <span data-ttu-id="f0f31-171">Um dies festzulegen, übergeben Sie \_ das statische eoac- \_ Cloaking oder das dynamische eoac- \_ \_ Cloaking an den *pfunktionalitäten* -Parameter in [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) oder [**setblanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket).</span><span class="sxs-lookup"><span data-stu-id="f0f31-171">To set it, pass EOAC\_STATIC\_CLOAKING or EOAC\_DYNAMIC\_CLOAKING to the *pCapabilities* parameter in [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) or [**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket).</span></span>

<span data-ttu-id="f0f31-172">Wenn statischer Cloaking mithilfe von [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity)aktiviert wird, übernimmt jeder Proxy ein Token (Thread oder Prozess), wenn Sie zum ersten Mal einen Aufruf für den Proxy durchführen.</span><span class="sxs-lookup"><span data-stu-id="f0f31-172">When static cloaking is enabled using [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), each proxy picks up a token (thread or process) the first time you make a call on the proxy.</span></span> <span data-ttu-id="f0f31-173">Wenn das statische Cloaking mithilfe von [**setblanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket)aktiviert wird, übernimmt der Proxy das Token zu diesem Zeitpunkt im Thread.</span><span class="sxs-lookup"><span data-stu-id="f0f31-173">When static cloaking is enabled using [**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket), the proxy picks up the token on the thread at that time.</span></span> <span data-ttu-id="f0f31-174">Wenn kein Thread Token verfügbar ist, wenn **setblanket** aufgerufen wird, wird das Prozess Token für die Identität des Proxys verwendet.</span><span class="sxs-lookup"><span data-stu-id="f0f31-174">If no thread token is available when **SetBlanket** is called, the process token is used for the proxy's identity.</span></span> <span data-ttu-id="f0f31-175">Im Grunde korrigiert **setblanket** die Identität des Proxys.</span><span class="sxs-lookup"><span data-stu-id="f0f31-175">Basically, **SetBlanket** fixes the identity of the proxy.</span></span>

<span data-ttu-id="f0f31-176">Bei dynamischer Verschleierung wird die Identität des Proxys auf die gleiche Weise bestimmt, unabhängig davon, ob das dynamische Cloaking mithilfe von [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) oder mit [**setblanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket)festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="f0f31-176">With dynamic cloaking, the proxy's identity is determined the same way regardless of whether dynamic cloaking is set using [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) or with [**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket).</span></span> <span data-ttu-id="f0f31-177">Das aktuelle Thread Token wird verwendet, wenn es vorhanden ist. Andernfalls wird das Prozess Token verwendet.</span><span class="sxs-lookup"><span data-stu-id="f0f31-177">The current thread token is used if there is one; otherwise, the process token is used.</span></span>

<span data-ttu-id="f0f31-178">Wenn für den gesamten Prozess durch einen Aufruf von [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) ein Cloaking festgelegt wird und Sie Aufrufe mit dem Prozess Token durchführen möchten, nehmen Sie beim Aufrufen von Aufrufen keinen Identitätswechsel vor.</span><span class="sxs-lookup"><span data-stu-id="f0f31-178">If cloaking is set for the entire process through a call to [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) and you want to make calls with the process token, do not impersonate while making calls.</span></span>

## <a name="cloaking-and-impersonation-levels"></a><span data-ttu-id="f0f31-179">Verstopfungen und Identitätswechsel Ebenen</span><span class="sxs-lookup"><span data-stu-id="f0f31-179">Cloaking and Impersonation Levels</span></span>

<span data-ttu-id="f0f31-180">Wie bereits erwähnt, wird durch die Funktion zur Verschleierung festgelegt, welche Identität einem Server während des Identitäts Wechsels angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="f0f31-180">As mentioned previously, the cloaking capability determines what identity is presented to a server during impersonation.</span></span> <span data-ttu-id="f0f31-181">Das Cloaking bietet einem Server die Möglichkeit, eine andere Identität als die eigene Identität auf einen anderen Server zu projizieren, der im Auftrag des Clients aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="f0f31-181">Cloaking provides a way for a server to project an identity other than its own to another server it is calling on behalf of the client.</span></span> <span data-ttu-id="f0f31-182">Die Identitätswechsel Ebene gibt an, wie viel Autorität der Client dem Server zugewiesen hat.</span><span class="sxs-lookup"><span data-stu-id="f0f31-182">The impersonation level indicates how much authority the client has given the server.</span></span>

<span data-ttu-id="f0f31-183">Der Identitätswechsel ohne Verschleierung funktioniert, ist jedoch möglicherweise nicht die beste Wahl, da der endgültige Server in einigen Fällen die Identität des ursprünglichen Aufrufers kennen muss.</span><span class="sxs-lookup"><span data-stu-id="f0f31-183">Impersonation without cloaking works, but it may not be the best choice because, in some cases, the final server needs to know the identity of the initial caller.</span></span> <span data-ttu-id="f0f31-184">Dies kann nicht erreicht werden, ohne dass ein Cloaking verwendet werden muss, da es schwierig ist sicherzustellen, dass nur autorisierte Clients auf einen Remote Computer zugreifen können.</span><span class="sxs-lookup"><span data-stu-id="f0f31-184">This cannot be achieved without using cloaking because it is difficult to ensure that only authorized clients can access a remote computer.</span></span> <span data-ttu-id="f0f31-185">Wenn der Identitätswechsel ohne Verschleierung verwendet wird, ist die Identität, die einem Downstreamserver vorgelegt wird, der für den unmittelbaren aufrufenden Prozess.</span><span class="sxs-lookup"><span data-stu-id="f0f31-185">When impersonation is used without cloaking, the identity presented to a downstream server is that of the immediate calling process.</span></span>

<span data-ttu-id="f0f31-186">Allerdings ist das Cloaking ohne Identitätswechsel nicht sinnvoll.</span><span class="sxs-lookup"><span data-stu-id="f0f31-186">However, cloaking is not useful without impersonation.</span></span> <span data-ttu-id="f0f31-187">Das Cloaking ist nur sinnvoll, wenn der Client eine Identitätswechsel Ebene von Identitätswechsel oder Delegaten festgelegt hat.</span><span class="sxs-lookup"><span data-stu-id="f0f31-187">Cloaking makes sense only when the client has set an impersonation level of impersonate or delegate.</span></span> <span data-ttu-id="f0f31-188">(Bei niedrigeren Identitätswechsel Ebenen kann der Server keine verdeckten Aufrufe durchführen.) Ob das Cloaking erfolgreich ist, hängt von der Anzahl der überquerten Computer Grenzen und der Identitätswechsel Ebene ab, die angibt, wie viel Autorität der Server für den Client benötigt.</span><span class="sxs-lookup"><span data-stu-id="f0f31-188">(With lower impersonation levels, the server cannot make cloaked calls.) Whether cloaking is successful depends on the number of computer boundaries crossed and on the impersonation level, which indicates how much authority the server has to act on behalf of the client.</span></span>

<span data-ttu-id="f0f31-189">In einigen Situationen ist es sinnvoll, dass der Server einen Cloaking festlegt, wenn der Client die Identitätswechsel Ebene auf RPC- \_ C- \_ IMP-Stufen Identitätswechsel festlegt \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="f0f31-189">In some situations, it makes sense for the server to set cloaking when the client sets the impersonation level to RPC\_C\_IMP\_LEVEL\_IMPERSONATE.</span></span> <span data-ttu-id="f0f31-190">Es gelten jedoch bestimmte Einschränkungen.</span><span class="sxs-lookup"><span data-stu-id="f0f31-190">However, certain limitations are in effect.</span></span> <span data-ttu-id="f0f31-191">Wenn der ursprüngliche Client die Identitätswechsel Ebene auf RPC- \_ C-IMP-Stufen Identitätswechsel festlegt \_ \_ \_ , kann sich der zwischen Server (der als Client auf dem gleichen Computer fungiert) nur über eine Computer Grenze verbergen.</span><span class="sxs-lookup"><span data-stu-id="f0f31-191">If the original client sets the impersonation level to RPC\_C\_IMP\_LEVEL\_IMPERSONATE, the intermediate server (acting as a client on the same computer) can cloak across only one computer boundary.</span></span> <span data-ttu-id="f0f31-192">Dies liegt daran, dass ein Identitätswechsel Token auf Identitäts Ebene nur über eine Computer Grenze hinweg übermittelt werden kann.</span><span class="sxs-lookup"><span data-stu-id="f0f31-192">This is because an impersonate-level impersonation token can be passed across only one computer boundary.</span></span> <span data-ttu-id="f0f31-193">Nachdem die Computer Grenze überschritten wurde, kann nur auf lokale Ressourcen zugegriffen werden.</span><span class="sxs-lookup"><span data-stu-id="f0f31-193">After the computer boundary has been crossed, only local resources can be accessed.</span></span> <span data-ttu-id="f0f31-194">Die Identität, die dem Server vorgelegt wird, hängt vom Typ des festgelegten Knotentyps ab.</span><span class="sxs-lookup"><span data-stu-id="f0f31-194">The identity presented to the server depends on the type of cloaking that is set.</span></span> <span data-ttu-id="f0f31-195">Wenn kein Cloaking festgelegt ist, ist die Identität, die einem Server vorgelegt wird, der Prozess, der den sofortigen Rückruf durchführt.</span><span class="sxs-lookup"><span data-stu-id="f0f31-195">If no cloaking is set, the identity presented to a server will be that of the process making the immediate call.</span></span>

<span data-ttu-id="f0f31-196">Wenn Sie über mehrere Computer Grenzen verfügen möchten, müssen Sie ein geeignetes Funktions Kennzeichen und einen Identitätswechsel auf delegatebene angeben.</span><span class="sxs-lookup"><span data-stu-id="f0f31-196">To cloak over multiple computer boundaries, you must specify both an appropriate cloaking capability flag and delegate-level impersonation.</span></span> <span data-ttu-id="f0f31-197">Bei dieser Art von Identitätswechsel werden dem Server sowohl die lokalen Anmelde Informationen als auch die Netzwerk Anmelde Informationen des Clients zugewiesen, sodass das Identitätswechsel Token beliebig viele Computer Grenzen überschreiten kann.</span><span class="sxs-lookup"><span data-stu-id="f0f31-197">With this type of impersonation, both the local and network credentials of the client are given to the server, so the impersonation token can cross any number of computer boundaries.</span></span> <span data-ttu-id="f0f31-198">Auch hier ist die Identität, die dem Server vorgelegt wird, abhängig vom Typ der festgelegten Art von Verstopfungen.</span><span class="sxs-lookup"><span data-stu-id="f0f31-198">Again, the identity presented to the server depends on the type of cloaking that is set.</span></span> <span data-ttu-id="f0f31-199">Wenn kein Cloaking mit Identitätswechsel auf delegatebene festgelegt wird, ist die Identität, die einem Server vorgelegt wird, der der aufrufenden Prozess.</span><span class="sxs-lookup"><span data-stu-id="f0f31-199">If no cloaking is set with delegate-level impersonation, the identity presented to a server is that of the process making the call.</span></span>

<span data-ttu-id="f0f31-200">Nehmen wir beispielsweise an, "Process A" ruft "b" auf, und b ruft "C. b" auf</span><span class="sxs-lookup"><span data-stu-id="f0f31-200">For example, suppose Process A calls B, and B calls C. B has set cloaking and A has set the impersonation level to impersonate.</span></span> <span data-ttu-id="f0f31-201">Wenn sich A, B und c auf demselben Computer befinden, funktioniert das Übergeben des Identitätswechsel Tokens von a an B und dann an c.</span><span class="sxs-lookup"><span data-stu-id="f0f31-201">If A, B, and C are on the same computer, passing the impersonation token from A to B and then to C will work.</span></span> <span data-ttu-id="f0f31-202">Wenn sich A und C auf demselben Computer befinden und b nicht ist, wird das Übergeben des Tokens zwischen A und b, jedoch nicht von b zu C ausgeführt. Der-Befehl von b zu C schlägt fehl, weil B C beim Durchführen eines clolovers nicht aufgerufen werden kann.</span><span class="sxs-lookup"><span data-stu-id="f0f31-202">But if A and C are on the same computer, and B is not, passing the token will work between A and B, but not from B to C. The call from B to C will fail because B cannot call C while cloaking.</span></span> <span data-ttu-id="f0f31-203">Wenn jedoch die Identitätswechsel Ebene auf Delegat festgelegt wird, kann das Token von B an C und der Aufruf erfolgreich ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="f0f31-203">However, if A sets the impersonation level to delegate, the token can be passed from B to C and the call may succeed.</span></span>

## <a name="cloaking-scenarios"></a><span data-ttu-id="f0f31-204">Cloaking-Szenarien</span><span class="sxs-lookup"><span data-stu-id="f0f31-204">Cloaking Scenarios</span></span>

<span data-ttu-id="f0f31-205">In der folgenden Abbildung wird von Process A der Aufruf B aufgerufen, C wird aufgerufen, D wird aufgerufen, wenn das Cloaking nicht festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="f0f31-205">In the following illustration, Process A calls B, calls C, calls D when cloaking is not set.</span></span> <span data-ttu-id="f0f31-206">Folglich sieht jeder zwischen Prozess die Identität des Prozesses, der ihn aufgerufen hat.</span><span class="sxs-lookup"><span data-stu-id="f0f31-206">As a result, each intermediate process sees the identity of the process that called it.</span></span>

![Diagramm, das den Prozess anzeigt, wenn das Cloaking nicht festgelegt ist.](images/0d2eb6cf-97d6-4c4e-b97e-abad854b1120.png)

<span data-ttu-id="f0f31-208">Bei statischem Cloaking sieht der Server die Proxy Identität, die während des ersten Aufrufes vom Client an den Server festgelegt wurde.</span><span class="sxs-lookup"><span data-stu-id="f0f31-208">With static cloaking, the server sees the proxy identity that was set during the first call from the client to the server.</span></span> <span data-ttu-id="f0f31-209">Die folgende Abbildung zeigt ein Beispiel für die Proxy Identität, die während eines Aufrufes von B an C festgelegt wird. Bei einem nachfolgenden-Vorgang wird von Prozess D die Identität von b erkannt, wenn das statische Cloaking durch b und C festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="f0f31-209">The following figure shows an example of the proxy identity being set during a call from B to C. On a subsequent call, Process D sees B's identity when static cloaking is set by B and C.</span></span>

![Diagramm, das den Prozess für den statischen Cloaking anzeigt.](images/520938e0-c4a6-4ac1-937d-02baf2007a27.png)

<span data-ttu-id="f0f31-211">Bei dynamischem Cloaking basiert die Identität des Aufrufers während des Identitäts Wechsels auf dem aktuellen Thread Token (sofern vorhanden).</span><span class="sxs-lookup"><span data-stu-id="f0f31-211">With dynamic cloaking, the identity of the caller during impersonation is based on the current thread token, if there is one.</span></span> <span data-ttu-id="f0f31-212">Die folgende Abbildung zeigt die Situation, in der b und C dynamische Cloaking festlegen und D die Identität eines anzeigt, trotz eines früheren Aufrufes von b zu c.</span><span class="sxs-lookup"><span data-stu-id="f0f31-212">The following illustration shows the situation where B and C set dynamic cloaking and D sees the identity of A, despite an earlier call from B to C.</span></span>

![Diagramm, das den Prozess für dynamisches Cloaking anzeigt.](images/d0848465-82f3-4d5a-851e-566d7800ada0.png)

## <a name="related-topics"></a><span data-ttu-id="f0f31-214">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="f0f31-214">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f0f31-215">Delegierung und Identitätswechsel</span><span class="sxs-lookup"><span data-stu-id="f0f31-215">Delegation and Impersonation</span></span>](delegation-and-impersonation.md)
</dt> </dl>

 

