---
description: Bestimmen Sie, ob Ihre Anwendung Administratorrechte erfordert, um böswillige Angriffe zu verhindern. Erstellen Sie für Funktionen, für die Administrator Berechtigungen erforderlich sind, eine separate Anwendung, und verwenden Sie den Befehlszeilen Befehl Windows runas.
ms.assetid: afa520fc-c206-49de-8d73-8f6566ec4fb6
title: Ausführen mit Administrator Rechten
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: dc28843195e9b5cabadc13aa2317b0bdd8058ef8
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "106351084"
---
# <a name="running-with-administrator-privileges"></a><span data-ttu-id="4705d-104">Ausführen mit Administrator Rechten</span><span class="sxs-lookup"><span data-stu-id="4705d-104">Running with Administrator Privileges</span></span>

<span data-ttu-id="4705d-105">Der erste Schritt beim Einrichten des Kontos, unter dem Ihre Anwendung ausgeführt werden muss, besteht darin, zu überprüfen, welche Ressourcen von der Anwendung verwendet werden und welche privilegierten APIs Sie aufruft.</span><span class="sxs-lookup"><span data-stu-id="4705d-105">The first step in establishing which type of account your application needs to run under is to examine what resources the application will use and what privileged APIs it will call.</span></span> <span data-ttu-id="4705d-106">Möglicherweise stellen Sie fest, dass die Anwendung oder große Teile davon keine Administratorrechte erfordern.</span><span class="sxs-lookup"><span data-stu-id="4705d-106">You may find that the application, or large parts of it, do not require administrator privileges.</span></span> <span data-ttu-id="4705d-107">Das *Schreiben von sicherem Code* von Michael Howard und David LeBlanc bietet eine ausgezeichnete Beschreibung, wie diese Bewertung durchgeführt werden kann, und es wird dringend empfohlen.</span><span class="sxs-lookup"><span data-stu-id="4705d-107">*Writing Secure Code*, by Michael Howard and David LeBlanc offers an excellent description of how to carry out this assessment and is highly recommended.</span></span> <span data-ttu-id="4705d-108">(Diese Ressource ist möglicherweise nicht in einigen Sprachen und Ländern verfügbar.)</span><span class="sxs-lookup"><span data-stu-id="4705d-108">(This resource may not be available in some languages and countries.)</span></span>

<span data-ttu-id="4705d-109">Mithilfe eines der folgenden Ansätze können Sie die von Ihrer Anwendung benötigten Berechtigungen mit weniger Anfälligkeit für böswillige Angriffe bereitstellen:</span><span class="sxs-lookup"><span data-stu-id="4705d-109">You can provide the privileges your application needs with less exposure to malicious attack by using one of the following approaches:</span></span>

-   <span data-ttu-id="4705d-110">Führen Sie unter einem Konto mit weniger Berechtigungen aus.</span><span class="sxs-lookup"><span data-stu-id="4705d-110">Run under an account with less privilege.</span></span> <span data-ttu-id="4705d-111">Eine Möglichkeit hierfür ist die Verwendung von [**privilegecheck**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-privilegecheck) , um zu bestimmen, welche Berechtigungen in einem Token aktiviert werden.</span><span class="sxs-lookup"><span data-stu-id="4705d-111">One way to do this is to use [**PrivilegeCheck**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-privilegecheck) to determine what privileges are enabled in a token.</span></span> <span data-ttu-id="4705d-112">Wenn die verfügbaren Berechtigungen für den aktuellen Vorgang nicht ausreichen, können Sie diesen Code deaktivieren und den Benutzer bitten, sich bei einem Konto mit Administratorrechten anzumelden.</span><span class="sxs-lookup"><span data-stu-id="4705d-112">If the available privileges are not adequate for the current operation, you can disable that code and ask the user to logon to an account with administrator privileges.</span></span>
-   <span data-ttu-id="4705d-113">Unterbrechen Sie separate Anwendungsfunktionen, für die Administrator Berechtigungen erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="4705d-113">Break into a separate application functions that require administrator permissions.</span></span> <span data-ttu-id="4705d-114">Sie können für den Benutzer eine Verknüpfung bereitstellen, die den runas-Befehl ausführt.</span><span class="sxs-lookup"><span data-stu-id="4705d-114">You can provide for the user a shortcut that executes the RunAs command.</span></span> <span data-ttu-id="4705d-115">Ausführliche Anweisungen zum Einrichten der Verknüpfung finden Sie unter "runas" in der Hilfe.</span><span class="sxs-lookup"><span data-stu-id="4705d-115">For detailed instructions on how to set up the shortcut, search for "runas" in Help.</span></span> <span data-ttu-id="4705d-116">Programm gesteuert können Sie den Befehl [runas](/windows/desktop/com/runas) unter dem Schlüssel Registrierungsschlüssel [AppID](/windows/desktop/com/appid-key) für Ihre Anwendung konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="4705d-116">Programmatically, you can configure the [RunAs](/windows/desktop/com/runas) command under the [AppId Key](/windows/desktop/com/appid-key) registry key for your application.</span></span>
-   <span data-ttu-id="4705d-117">Authentifizieren Sie den Benutzer durch Aufrufen von [**creduipromptforanmelde**](/windows/desktop/api/wincred/nf-wincred-creduipromptforcredentialsa) Informationen (GUI) oder [**creduicmdlinepromptforanmelde**](/windows/desktop/api/wincred/nf-wincred-creduicmdlinepromptforcredentialsa) Informationen (Befehlszeile), um den Benutzernamen und das Kennwort zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="4705d-117">Authenticate the user by calling [**CredUIPromptForCredentials**](/windows/desktop/api/wincred/nf-wincred-creduipromptforcredentialsa) (GUI) or [**CredUICmdLinePromptForCredentials**](/windows/desktop/api/wincred/nf-wincred-creduicmdlinepromptforcredentialsa) (command line) to obtain user name and password.</span></span> <span data-ttu-id="4705d-118">Ein Beispiel finden Sie unter [anfordern von Anmelde Informationen für den Benutzer](asking-the-user-for-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="4705d-118">For an example, see [Asking the User for Credentials](asking-the-user-for-credentials.md).</span></span>
-   <span data-ttu-id="4705d-119">Nimmt die Identität des Benutzers an.</span><span class="sxs-lookup"><span data-stu-id="4705d-119">Impersonate the user.</span></span> <span data-ttu-id="4705d-120">Ein Prozess, der unter einem Konto mit weitreichenden Berechtigungen wie dem System gestartet wird, kann die Identität eines Benutzerkontos annehmen, indem er den Wert von "Identität [**ateloggedonuser**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) " oder ähnliche Identitätswechsel Funktionen annimmt</span><span class="sxs-lookup"><span data-stu-id="4705d-120">A process that starts under a highly privileged account like System can impersonate a user account by calling [**ImpersonateLoggedOnUser**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) or similar Impersonate functions, thus reducing privilege level.</span></span> <span data-ttu-id="4705d-121">Wenn jedoch ein Rückruf von [**RevertToSelf**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-reverttoself) in den Thread eingefügt wird, wird der Prozess zu den ursprünglichen System Privilegien zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="4705d-121">However, if a call to [**RevertToSelf**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-reverttoself) is injected into the thread, the process returns to the original System privileges.</span></span>

<span data-ttu-id="4705d-122">Wenn Sie festgestellt haben, dass Ihre Anwendung unter einem Konto mit Administratorrechten ausgeführt werden muss und dass ein Administrator Kennwort im Softwaresystem gespeichert werden muss, finden Sie weitere Informationen unter Behandeln von Kenn [Wörtern](handling-passwords.md) für eine sichere Vorgehensweise.</span><span class="sxs-lookup"><span data-stu-id="4705d-122">If you have determined that your application must run under an account with administrator privileges and that an administrator password must be stored in the software system, see [Handling Passwords](handling-passwords.md) for methods of doing this safely.</span></span>

 

 
