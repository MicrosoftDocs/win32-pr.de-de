---
description: Das Datenobjekt ist für alle shelldatenübertragungen von zentraler Bedeutung.
ms.assetid: c63d339e-ac62-4da1-b5ce-22d45a6a3413
title: Shelldatenobjekt
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 812e5c18f5a2120fbf22682c6e768dc005128630
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "104214432"
---
# <a name="shell-data-object"></a><span data-ttu-id="0c7e5-103">Shelldatenobjekt</span><span class="sxs-lookup"><span data-stu-id="0c7e5-103">Shell Data Object</span></span>

<span data-ttu-id="0c7e5-104">Das Datenobjekt ist für alle shelldatenübertragungen von zentraler Bedeutung.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-104">The data object is central to all Shell data transfers.</span></span> <span data-ttu-id="0c7e5-105">Dabei handelt es sich hauptsächlich um einen Container zum Speichern der übertragenen Daten.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-105">It is primarily a container to hold the transferred data.</span></span> <span data-ttu-id="0c7e5-106">Das Ziel kann jedoch auch mit dem Datenobjekt kommunizieren, um einige spezielle Arten von shelldatenübertragungen, wie z. b. optimierte Verschiebungen, zu vereinfachen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-106">However, the target can also communicate with the data object to facilitate some specialized types of Shell data transfer such as optimized moves.</span></span> <span data-ttu-id="0c7e5-107">Dieses Thema enthält eine allgemeine Erörterung der Funktionsweise von shelldatenobjekten, der Art und Weise, wie Sie von einer Quelle erstellt werden und wie Sie von einem Ziel behandelt werden.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-107">This topic provides a general discussion of how Shell data objects work, how they are constructed by a source, and how they are handled by a target.</span></span> <span data-ttu-id="0c7e5-108">Ausführliche Informationen zur Verwendung von Datenobjekten für die Übertragung unterschiedlicher Arten von shelldaten finden Sie unter [Handling Shell Datenübertragung Szenarios](datascenarios.md).</span><span class="sxs-lookup"><span data-stu-id="0c7e5-108">For a detailed discussion of how to use data objects to transfer different types of Shell data, see [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>

-   [<span data-ttu-id="0c7e5-109">Funktionsweise von Datenobjekten</span><span class="sxs-lookup"><span data-stu-id="0c7e5-109">How Data Objects Work</span></span>](#how-data-objects-work)
    -   [<span data-ttu-id="0c7e5-110">Zwischenablage Formate</span><span class="sxs-lookup"><span data-stu-id="0c7e5-110">Clipboard Formats</span></span>](#clipboard-formats)
    -   [<span data-ttu-id="0c7e5-111">FORMATETC-Struktur</span><span class="sxs-lookup"><span data-stu-id="0c7e5-111">FORMATETC Structure</span></span>](#formatetc-structure)
    -   [<span data-ttu-id="0c7e5-112">STGMEDIUM-Struktur</span><span class="sxs-lookup"><span data-stu-id="0c7e5-112">STGMEDIUM structure</span></span>](#stgmedium-structure)
-   [<span data-ttu-id="0c7e5-113">So erstellt eine Quelle ein Datenobjekt</span><span class="sxs-lookup"><span data-stu-id="0c7e5-113">How a Source Creates a Data Object</span></span>](#how-a-source-creates-a-data-object)
    -   [<span data-ttu-id="0c7e5-114">Vorgehensweise beim Hinzufügen eines globalen Speicher Objekts zu einem Datenobjekt</span><span class="sxs-lookup"><span data-stu-id="0c7e5-114">How to Add a Global Memory Object to a Data Object</span></span>](#how-to-add-a-global-memory-object-to-a-data-object)
    -   [<span data-ttu-id="0c7e5-115">Implementieren von IDataObject</span><span class="sxs-lookup"><span data-stu-id="0c7e5-115">Implementing IDataObject</span></span>](#implementing-idataobject)
    -   [<span data-ttu-id="0c7e5-116">Implementieren von IDropSource</span><span class="sxs-lookup"><span data-stu-id="0c7e5-116">Implementing IDropSource</span></span>](#implementing-idropsource)
-   [<span data-ttu-id="0c7e5-117">Verarbeiten eines Datenobjekts durch ein Ziel</span><span class="sxs-lookup"><span data-stu-id="0c7e5-117">How a Target Handles a Data Object</span></span>](#how-a-target-handles-a-data-object)
    -   [<span data-ttu-id="0c7e5-118">Extrahieren von shelldaten aus einem Datenobjekt</span><span class="sxs-lookup"><span data-stu-id="0c7e5-118">Extracting Shell Data from a Data Object</span></span>](#extracting-shell-data-from-a-data-object)
    -   [<span data-ttu-id="0c7e5-119">Implementieren von IDropTarget</span><span class="sxs-lookup"><span data-stu-id="0c7e5-119">Implementing IDropTarget</span></span>](#implementing-idroptarget)
-   [<span data-ttu-id="0c7e5-120">Verwenden des Drag & amp; Drop-Hilfsobjekts</span><span class="sxs-lookup"><span data-stu-id="0c7e5-120">Using the Drag-and-Drop Helper Object</span></span>](#using-the-drag-and-drop-helper-object)
    -   [<span data-ttu-id="0c7e5-121">Verwenden der idragsourcehelper-Schnittstelle</span><span class="sxs-lookup"><span data-stu-id="0c7e5-121">Using the IDragSourceHelper Interface</span></span>](#using-the-idragsourcehelper-interface)
    -   [<span data-ttu-id="0c7e5-122">Verwenden der idroptargethelper-Schnittstelle</span><span class="sxs-lookup"><span data-stu-id="0c7e5-122">Using the IDropTargetHelper Interface</span></span>](#using-the-idroptargethelper-interface)

## <a name="how-data-objects-work"></a><span data-ttu-id="0c7e5-123">Funktionsweise von Datenobjekten</span><span class="sxs-lookup"><span data-stu-id="0c7e5-123">How Data Objects Work</span></span>

<span data-ttu-id="0c7e5-124">Datenobjekte sind Component Object Model (com)-Objekte, die von der Datenquelle zum Übertragen von Daten an ein Ziel erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-124">Data objects are Component Object Model (COM) objects, created by the data source to transfer data to a target.</span></span> <span data-ttu-id="0c7e5-125">Sie enthalten in der Regel mehr als ein Datenelement.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-125">They typically carry more than one item of data.</span></span> <span data-ttu-id="0c7e5-126">Hierfür gibt es zwei Gründe:</span><span class="sxs-lookup"><span data-stu-id="0c7e5-126">There are two reasons for this practice:</span></span>

-   <span data-ttu-id="0c7e5-127">Obwohl fast jeder Datentyp mit einem Datenobjekt übertragen werden kann, weiß die Quelle in der Regel nicht, welche Art von Daten das Ziel annehmen kann.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-127">While almost any type of data can be transferred with a data object, the source typically does not know what kind of data the target can accept.</span></span> <span data-ttu-id="0c7e5-128">Beispielsweise kann es sich bei den Daten um einen Teil eines formatierten Textdokuments handeln.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-128">For instance, the data might be a portion of a formatted text document.</span></span> <span data-ttu-id="0c7e5-129">Obwohl das Ziel möglicherweise in der Lage ist, komplexe Formatierungsinformationen zu verarbeiten, kann es möglicherweise auch nur ANSI-Text akzeptieren.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-129">While the target might be able to handle complex formatting information, it might also be able to accept only ANSI text.</span></span> <span data-ttu-id="0c7e5-130">Aus diesem Grund enthalten Datenobjekte häufig dieselben Daten in verschiedenen Formaten.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-130">For this reason, data objects often include the same data in several different formats.</span></span> <span data-ttu-id="0c7e5-131">Das Ziel kann dann die Daten in einem Format extrahieren, das Sie verarbeiten kann.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-131">The target can then extract the data in a format that it can handle.</span></span>
-   <span data-ttu-id="0c7e5-132">Datenobjekte können auch zusätzliche Datenelemente enthalten, bei denen es sich nicht um Versionen der Quelldaten handelt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-132">Data objects can also contain auxiliary data items that are not versions of source data.</span></span> <span data-ttu-id="0c7e5-133">Diese Art von Datenelement stellt in der Regel zusätzliche Informationen zum Datenübertragungs Vorgang bereit.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-133">This type of data item typically provides additional information about the data transfer operation.</span></span> <span data-ttu-id="0c7e5-134">Beispielsweise verwendet die Shell zusätzliche Datenelemente, um anzugeben, ob eine Datei kopiert oder verschoben werden soll.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-134">For instance, the Shell uses auxiliary data items to indicate whether a file is to be copied or moved.</span></span>

### <a name="clipboard-formats"></a><span data-ttu-id="0c7e5-135">Zwischenablage Formate</span><span class="sxs-lookup"><span data-stu-id="0c7e5-135">Clipboard Formats</span></span>

<span data-ttu-id="0c7e5-136">Jedes Datenelement in einem Datenobjekt weist ein zugeordnetes Format auf, das in der Regel als *Zwischenablage Format* bezeichnet wird.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-136">Each item of data in a data object has an associated format, usually called a *clipboard format*.</span></span> <span data-ttu-id="0c7e5-137">Es gibt eine Reihe von Standardformaten in der Zwischenablage, die in winuser. h deklariert sind und den häufig verwendeten Datentypen entsprechen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-137">There are a number of standard clipboard formats, declared in Winuser.h, that correspond to commonly used types of data.</span></span> <span data-ttu-id="0c7e5-138">Zwischenablage Formate sind ganze Zahlen, aber Sie werden normalerweise durch Ihren äquivalenten Namen bezeichnet, der die Form CF \_ *xxx* hat.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-138">Clipboard formats are integers, but they are normally referred to by their equivalent name, which has the form CF\_*XXX*.</span></span> <span data-ttu-id="0c7e5-139">Beispielsweise ist das Zwischenablage Format für ANSI-Text CF- \_ Text.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-139">For instance, the clipboard format for ANSI text is CF\_TEXT.</span></span>

<span data-ttu-id="0c7e5-140">Anwendungen können den Bereich der verfügbaren Zwischenablage Formate erweitern, indem Sie private Formate definieren.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-140">Applications can extend the range of available clipboard formats by defining private formats.</span></span> <span data-ttu-id="0c7e5-141">Zum Definieren eines privaten Formats Ruft eine Anwendung [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) mit einer Zeichenfolge auf, die das Format angibt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-141">To define a private format, an application calls [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) with a string that identifies the format.</span></span> <span data-ttu-id="0c7e5-142">Die von der Funktion zurückgegebene Ganzzahl ohne Vorzeichen ist ein gültiger Format Wert, der genau wie ein Standardmäßiges Zwischenablage Format verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-142">The unsigned integer that the function returns is a valid format value that can be used just like a standard clipboard format.</span></span> <span data-ttu-id="0c7e5-143">Allerdings müssen sowohl Quelle als auch Ziel das Format registrieren, damit es verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-143">However, both source and target must register the format in order to use it.</span></span> <span data-ttu-id="0c7e5-144">Mit einer Ausnahme –[CF \_ HDROP](clipboard.md)– werden die Zwischenablage Formate, die zum Übertragen von shelldaten verwendet werden, als private Formate definiert.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-144">With one exception—[CF\_HDROP](clipboard.md)—the clipboard formats used to transfer Shell data are defined as private formats.</span></span> <span data-ttu-id="0c7e5-145">Sie müssen von der Quelle und dem Ziel registriert werden, bevor Sie verwendet werden können.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-145">They must be registered by the source and target before they can be used.</span></span> <span data-ttu-id="0c7e5-146">Eine Beschreibung der verfügbaren shellzwischenablage Formate finden Sie unter shellzwischenablage Formate.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-146">For a description of the available Shell clipboard formats, see Shell Clipboard Formats.</span></span>

<span data-ttu-id="0c7e5-147">Obwohl es einige Ausnahmen gibt, enthalten Datenobjekte normalerweise nur ein Datenelement für jedes Zwischenablage Format, das Sie unterstützen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-147">Although there are some exceptions, data objects normally contain only one item of data for each clipboard format they support.</span></span> <span data-ttu-id="0c7e5-148">Diese eins-zu-Eins-Korrelation zwischen Format und Daten ermöglicht die Verwendung des Format Werts als Bezeichner für das zugeordnete Datenelement.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-148">This one-to-one correlation between format and data allows the format value to be used as an identifier for the associated data item.</span></span> <span data-ttu-id="0c7e5-149">Tatsächlich wird bei der Erörterung der Inhalte eines Datenobjekts ein bestimmtes Datenelement in der Regel als "Format" bezeichnet, und es wird durch den Format Namen verwiesen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-149">In fact, when discussing the contents of a data object, a particular item of data is typically called a "format" and is referred to by its format name.</span></span> <span data-ttu-id="0c7e5-150">Beispielsweise Ausdrücke, z. b. "Extrahieren des CF- \_ Text Formats..." werden in der Regel verwendet, wenn das ANSI-Text Datenelement eines Datenobjekts diskutiert wird.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-150">For example, phrases such as "Extract the CF\_TEXT format..." are typically used when discussing a data object's ANSI text data item.</span></span>

<span data-ttu-id="0c7e5-151">Wenn das Ablage Ziel den Zeiger auf das Datenobjekt empfängt, listet das Ablage Ziel die verfügbaren Formate auf, um zu bestimmen, welche Arten von Daten verfügbar sind.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-151">When the drop target receives the pointer to the data object, the drop target enumerates the available formats to determine what types of data are available.</span></span> <span data-ttu-id="0c7e5-152">Anschließend wird mindestens eines der verfügbaren Formate angefordert, und die Daten werden extrahiert.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-152">It then requests one or more of the available formats and extracts the data.</span></span> <span data-ttu-id="0c7e5-153">Die spezifische Methode, mit der das Ziel shelldaten aus einem Datenobjekt extrahiert, variiert im Format. Dies wird ausführlich erläutert, [wie ein Ziel ein Datenobjekt behandelt](#how-a-target-handles-a-data-object).</span><span class="sxs-lookup"><span data-stu-id="0c7e5-153">The specific way that the target extracts Shell data from a data object varies with the format; this is discussed in detail in [How a Target Handles a Data Object](#how-a-target-handles-a-data-object).</span></span>

<span data-ttu-id="0c7e5-154">Bei einfachen Datenübertragungen zwischen der Zwischenablage werden die Daten in einem globalen Speicher Objekt platziert.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-154">With simple clipboard data transfers, the data is placed in a global memory object.</span></span> <span data-ttu-id="0c7e5-155">Die Adresse des Objekts wird zusammen mit dem Format in der Zwischenablage platziert.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-155">The address of that object is placed on the Clipboard, along with its format.</span></span> <span data-ttu-id="0c7e5-156">Das Format der Zwischenablage teilt dem Ziel mit, welche Art von Daten bei der zugeordneten Adresse gefunden werden.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-156">The clipboard format tells the target what kind of data it will find at the associated address.</span></span> <span data-ttu-id="0c7e5-157">Während einfache Zwischenablage Übertragungen leicht implementiert werden können:</span><span class="sxs-lookup"><span data-stu-id="0c7e5-157">While simple clipboard transfers are easy to implement:</span></span>

-   <span data-ttu-id="0c7e5-158">Datenobjekte stellen eine viel flexiblere Methode zum Übertragen von Daten dar.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-158">Data objects provide a much more flexible way to transfer data.</span></span>
-   <span data-ttu-id="0c7e5-159">Datenobjekte eignen sich besser für die Übertragung großer Datenmengen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-159">Data objects are better suited for transferring large amounts of data.</span></span>
-   <span data-ttu-id="0c7e5-160">Datenobjekte müssen verwendet werden, um Daten mit einem Drag & Drop-Vorgang zu übertragen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-160">Data objects must be used to transfer data with a drag-and-drop operation.</span></span>

<span data-ttu-id="0c7e5-161">Aus diesen Gründen werden von allen shelldatenübertragungen Datenobjekte verwendet.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-161">For these reasons, all Shell data transfers use data objects.</span></span> <span data-ttu-id="0c7e5-162">Bei Datenobjekten werden Zwischenablage Formate nicht direkt verwendet.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-162">With data objects, clipboard formats are not used directly.</span></span> <span data-ttu-id="0c7e5-163">Stattdessen werden Datenelemente mit einer Generalisierung des Zwischenablage Formats, einer [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) -Struktur, identifiziert.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-163">Instead, data items are identified with a generalization of the clipboard format, a [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure.</span></span>

### <a name="formatetc-structure"></a><span data-ttu-id="0c7e5-164">FORMATETC-Struktur</span><span class="sxs-lookup"><span data-stu-id="0c7e5-164">FORMATETC Structure</span></span>

<span data-ttu-id="0c7e5-165">Die [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) -Struktur ist eine erweiterte Version eines Zwischenablage Formats.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-165">The [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure is an extended version of a clipboard format.</span></span> <span data-ttu-id="0c7e5-166">Wie bei shelldatenübertragungen verwendet, hat die **FORMATETC** -Struktur die folgenden Eigenschaften:</span><span class="sxs-lookup"><span data-stu-id="0c7e5-166">As used for Shell data transfers, the **FORMATETC** structure has the following characteristics:</span></span>

-   <span data-ttu-id="0c7e5-167">Ein Datenelement wird weiterhin durch das Zwischenablage Format im **cfFormat** -Member identifiziert.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-167">A data item is still identified by its clipboard format, in the **cfFormat** member.</span></span>
-   <span data-ttu-id="0c7e5-168">Die Datenübertragung ist nicht auf globale Speicher Objekte beschränkt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-168">Data transfer is not limited to global memory objects.</span></span> <span data-ttu-id="0c7e5-169">Der **TYMED** -Member wird verwendet, um den Datenübertragungsmechanismus anzugeben, der in der zugeordneten [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) -Struktur enthalten ist.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-169">The **tymed** member is used to indicate the data transfer mechanism contained in the associated [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span> <span data-ttu-id="0c7e5-170">Sie wird auf einen der Werte vom [**typmed \_ xxx**](/windows/win32/api/objidl/ne-objidl-tymed) festgelegt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-170">It is set to one of the [**TYMED\_XXX**](/windows/win32/api/objidl/ne-objidl-tymed) values.</span></span>
-   <span data-ttu-id="0c7e5-171">Die Shell verwendet das **Lindex** -Element mit dem [cfstr \_ File Contents](clipboard.md) -Format, damit ein Datenobjekt mehr als ein Datenelement Pro Format enthalten kann.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-171">The Shell uses the **lIndex** member with its [CFSTR\_FILECONTENTS](clipboard.md) format to allow a data object to contain more than one data item per format.</span></span> <span data-ttu-id="0c7e5-172">Eine Erläuterung zur Verwendung dieses Formats finden Sie im Abschnitt *Verwenden des cfstr \_ File Contents-Formats zum Extrahieren von Daten aus einer Datei* im Abschnitt [Handling Shell Datenübertragung Szenarios](datascenarios.md).</span><span class="sxs-lookup"><span data-stu-id="0c7e5-172">For a discussion of how to use this format, see the *Using the CFSTR\_FILECONTENTS Format to Extract Data from a File* section of [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>
-   <span data-ttu-id="0c7e5-173">Der **dwAspect** -Member ist in der Regel auf DVASPECT-Inhalt festgelegt \_ .</span><span class="sxs-lookup"><span data-stu-id="0c7e5-173">The **dwAspect** member is typically set to DVASPECT\_CONTENT.</span></span> <span data-ttu-id="0c7e5-174">In "shlobj. h" sind jedoch drei Werte definiert, die für die Shell-Datenübertragung verwendet werden können.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-174">However, there are three values defined in Shlobj.h that can be used for Shell data transfer.</span></span> 

    |                     |                                                                                                   |
    |---------------------|---------------------------------------------------------------------------------------------------|
    | <span data-ttu-id="0c7e5-175">DVASPECT- \_ Kopie</span><span class="sxs-lookup"><span data-stu-id="0c7e5-175">DVASPECT\_COPY</span></span>      | <span data-ttu-id="0c7e5-176">Wird verwendet, um anzugeben, dass das Format eine Kopie der Daten darstellt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-176">Used to indicate that the format represents a copy of the data.</span></span>                                   |
    | <span data-ttu-id="0c7e5-177">DVASPECT- \_ Link</span><span class="sxs-lookup"><span data-stu-id="0c7e5-177">DVASPECT\_LINK</span></span>      | <span data-ttu-id="0c7e5-178">Wird verwendet, um anzugeben, dass das Format eine Verknüpfung zu den Daten darstellt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-178">Used to indicate that the format represents a shortcut to the data.</span></span>                               |
    | <span data-ttu-id="0c7e5-179">\_dvaspektkurzname</span><span class="sxs-lookup"><span data-stu-id="0c7e5-179">DVASPECT\_SHORTNAME</span></span> | <span data-ttu-id="0c7e5-180">Wird im CF- \_ HDROP-Format verwendet, um einen Dateipfad anzufordern, bei dem die Namen auf das 8,3-Format verkürzt werden.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-180">Used with the CF\_HDROP format to request a file path with the names shortened to the 8.3 format.</span></span> |

    

     

-   <span data-ttu-id="0c7e5-181">Der **ptd-** Member wird nicht für shelldatenübertragungen verwendet und wird normalerweise auf **null** festgelegt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-181">The **ptd** member is not used for Shell data transfers and is normally set to **NULL**.</span></span>

### <a name="stgmedium-structure"></a><span data-ttu-id="0c7e5-182">STGMEDIUM-Struktur</span><span class="sxs-lookup"><span data-stu-id="0c7e5-182">STGMEDIUM structure</span></span>

<span data-ttu-id="0c7e5-183">Die [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) -Struktur ermöglicht den Zugriff auf die Daten, die übertragen werden.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-183">The [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure provides access to the data being transferred.</span></span> <span data-ttu-id="0c7e5-184">Für shelldaten werden drei Datenübertragungs Mechanismen unterstützt:</span><span class="sxs-lookup"><span data-stu-id="0c7e5-184">Three data transfer mechanisms are supported for Shell data:</span></span>

-   <span data-ttu-id="0c7e5-185">Ein globales Speicher Objekt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-185">A global memory object.</span></span>
-   <span data-ttu-id="0c7e5-186">Eine [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) -Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-186">An [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) interface.</span></span>
-   <span data-ttu-id="0c7e5-187">Eine [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) -Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-187">An [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) interface.</span></span>

<span data-ttu-id="0c7e5-188">Der **TYMED** -Member der [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) -Struktur ist ein [**TYMED \_ xxx**](/windows/win32/api/objidl/ne-objidl-tymed) -Wert, der den Datenübertragungsmechanismus identifiziert.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-188">The **tymed** member of the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure is a [**TYMED\_XXX**](/windows/win32/api/objidl/ne-objidl-tymed) value that identifies the data transfer mechanism.</span></span> <span data-ttu-id="0c7e5-189">Der zweite Member ist ein Zeiger, der vom Ziel verwendet wird, um die Daten zu extrahieren.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-189">The second member is a pointer that is used by the target to extract the data.</span></span> <span data-ttu-id="0c7e5-190">Der Zeiger kann je nach dem Wert " **TYMED** " aus einer Vielzahl von Typen bestehen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-190">The pointer can be one of a variety of types, depending on the **tymed** value.</span></span> <span data-ttu-id="0c7e5-191">Die drei **TYMED** -Werte, die für shelldatenübertragungen verwendet werden, sind in der folgenden Tabelle zusammen mit dem entsprechenden **STGMEDIUM** -Elementnamen zusammengefasst.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-191">The three **tymed** values that are used for Shell data transfers are summarized in the following table, along with their corresponding **STGMEDIUM** member name.</span></span>



| <span data-ttu-id="0c7e5-192">tymed-Wert</span><span class="sxs-lookup"><span data-stu-id="0c7e5-192">tymed Value</span></span>     | <span data-ttu-id="0c7e5-193">Membername</span><span class="sxs-lookup"><span data-stu-id="0c7e5-193">Member name</span></span> | <span data-ttu-id="0c7e5-194">Beschreibung</span><span class="sxs-lookup"><span data-stu-id="0c7e5-194">Description</span></span>                                                                                                                                                                                                                                                                                                       |
|-----------------|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="0c7e5-195">TYMED \_ HGLOBAL</span><span class="sxs-lookup"><span data-stu-id="0c7e5-195">TYMED\_HGLOBAL</span></span>  | <span data-ttu-id="0c7e5-196">**hGlobal**</span><span class="sxs-lookup"><span data-stu-id="0c7e5-196">**hGlobal**</span></span> | <span data-ttu-id="0c7e5-197">Ein Zeiger auf ein globales Speicher Objekt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-197">A pointer to a global memory object.</span></span> <span data-ttu-id="0c7e5-198">Dieser Zeigertyp wird in der Regel zum übertragen kleiner Datenmengen verwendet.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-198">This pointer type is typically used for transferring small amounts of data.</span></span> <span data-ttu-id="0c7e5-199">Beispielsweise verwendet die Shell globale Speicher Objekte, um kurze Text Zeichenfolgen (z. b. Dateinamen oder URLs) zu übertragen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-199">For instance, the Shell uses global memory objects to transfer short text strings such as file names or URLs.</span></span>                                                                                    |
| <span data-ttu-id="0c7e5-200">TYMED- \_ IStream</span><span class="sxs-lookup"><span data-stu-id="0c7e5-200">TYMED\_ISTREAM</span></span>  | <span data-ttu-id="0c7e5-201">**pstm**</span><span class="sxs-lookup"><span data-stu-id="0c7e5-201">**pstm**</span></span>    | <span data-ttu-id="0c7e5-202">Ein Zeiger auf eine [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) -Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-202">A pointer to an [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) interface.</span></span> <span data-ttu-id="0c7e5-203">Dieser Zeigertyp wird für die meisten shelldatenübertragungen bevorzugt, da er relativ wenig Arbeitsspeicher im Vergleich zu "TYMED \_ HGLOBAL" erfordert.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-203">This pointer type is preferred for most Shell data transfers because it requires relatively little memory compared to TYMED\_HGLOBAL.</span></span> <span data-ttu-id="0c7e5-204">Außerdem muss der \_ Daten Übertragungsmechanismus für den TYMED-IStream die Daten nicht auf bestimmte Weise speichern.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-204">Also, the TYMED\_ISTREAM data transfer mechanism does not require the source to store its data in any particular way.</span></span> |
| <span data-ttu-id="0c7e5-205">typmed- \_ IStorage</span><span class="sxs-lookup"><span data-stu-id="0c7e5-205">TYMED\_ISTORAGE</span></span> | <span data-ttu-id="0c7e5-206">**pstg**</span><span class="sxs-lookup"><span data-stu-id="0c7e5-206">**pstg**</span></span>    | <span data-ttu-id="0c7e5-207">Ein Zeiger auf eine [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) -Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-207">A pointer to an [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) interface.</span></span> <span data-ttu-id="0c7e5-208">Das Ziel Ruft die Schnittstellen Methoden zum Extrahieren der Daten auf.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-208">The target calls the interface methods to extract the data.</span></span> <span data-ttu-id="0c7e5-209">Wie bei TYMED \_ IStream erfordert dieser Zeigertyp relativ wenig Arbeitsspeicher.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-209">Like TYMED\_ISTREAM, this pointer type requires relatively little memory.</span></span> <span data-ttu-id="0c7e5-210">Da der IStorage-Dienst jedoch \_ weniger flexibel ist als bei TYMED \_ IStream, wird er nicht so häufig verwendet.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-210">However, because TYMED\_ISTORAGE is less flexible than TYMED\_ISTREAM, it is not as commonly used.</span></span>                  |



 

## <a name="how-a-source-creates-a-data-object"></a><span data-ttu-id="0c7e5-211">So erstellt eine Quelle ein Datenobjekt</span><span class="sxs-lookup"><span data-stu-id="0c7e5-211">How a Source Creates a Data Object</span></span>

<span data-ttu-id="0c7e5-212">Wenn ein Benutzer eine shelldatenübertragung initiiert, ist die Quelle dafür verantwortlich, ein Datenobjekt zu erstellen und mit Daten zu laden.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-212">When a user initiates a Shell data transfer, the source is responsible for creating a data object and loading it with data.</span></span> <span data-ttu-id="0c7e5-213">Im folgenden Verfahren wird der Prozess zusammengefasst:</span><span class="sxs-lookup"><span data-stu-id="0c7e5-213">The following procedure summarizes the process:</span></span>

1.  <span data-ttu-id="0c7e5-214">Rufen Sie [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) auf, um einen gültigen Zwischenablage-Format Wert für jedes shellformat zu erhalten, das in das Datenobjekt eingeschlossen wird.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-214">Call [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) to obtain a valid clipboard format value for each Shell format that will be included in the data object.</span></span> <span data-ttu-id="0c7e5-215">Beachten Sie, dass [CF \_ HDROP](clipboard.md) bereits ein gültiges Zwischenablage Format ist und nicht registriert werden muss.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-215">Remember that [CF\_HDROP](clipboard.md) is already a valid clipboard format and does not need to be registered.</span></span>
2.  <span data-ttu-id="0c7e5-216">Legen Sie die zugeordneten Daten für jedes zu übertragende Format entweder in einem globalen Speicher Objekt ab, oder erstellen Sie ein Objekt, das über eine [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) -oder [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) -Schnittstelle Zugriff auf diese Daten bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-216">For each format to be transferred, either put the associated data into a global memory object or create an object that provides access to that data through an [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) or [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) interface.</span></span> <span data-ttu-id="0c7e5-217">Die **IStream** -und **IStorage** -Schnittstellen werden mit Standard-com-Techniken erstellt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-217">The **IStream** and **IStorage** interfaces are created using standard COM techniques.</span></span> <span data-ttu-id="0c7e5-218">Eine Erläuterung zur Handhabung von globalen Speicher Objekten finden Sie unter [Hinzufügen eines globalen Speicher Objekts zu einem Datenobjekt](#how-to-add-a-global-memory-object-to-a-data-object).</span><span class="sxs-lookup"><span data-stu-id="0c7e5-218">For a discussion of how to handle global memory objects, see [How to Add a Global Memory Object to a Data Object](#how-to-add-a-global-memory-object-to-a-data-object).</span></span>
3.  <span data-ttu-id="0c7e5-219">Erstellen Sie für jedes Format [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) -und [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) -Strukturen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-219">Create [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) and [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structures for each format.</span></span>
4.  <span data-ttu-id="0c7e5-220">Instanziieren Sie ein Datenobjekt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-220">Instantiate a data object.</span></span>
5.  <span data-ttu-id="0c7e5-221">Laden Sie die Daten in das Datenobjekt, indem Sie die [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) -Methode für jedes unterstützte Format aufrufen und die [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) -und [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) -Strukturen des Formats übergeben.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-221">Load the data into the data object by calling the [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) method for each supported format and passing in the format's [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) and [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structures.</span></span>
6.  <span data-ttu-id="0c7e5-222">Bei Datenübertragungen in der Zwischenablage wird [**OleSetClipboard**](/windows/win32/api/ole2/nf-ole2-olesetclipboard) aufgerufen, um einen Zeiger auf die [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) -Schnittstelle des Datenobjekts in der Zwischenablage zu platzieren.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-222">With clipboard data transfers, call [**OleSetClipboard**](/windows/win32/api/ole2/nf-ole2-olesetclipboard) to place a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface on the Clipboard.</span></span> <span data-ttu-id="0c7e5-223">Initiieren Sie bei Drag & Drop-Übertragungen eine *Drag-Schleife* durch Aufrufen von [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop).</span><span class="sxs-lookup"><span data-stu-id="0c7e5-223">For drag-and-drop transfers, initiate a *drag loop* by calling [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop).</span></span> <span data-ttu-id="0c7e5-224">Der **IDataObject** -Zeiger wird beim Löschen der Daten an das Ablage Ziel weitergegeben, wobei die Zieh Schleife beendet wird.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-224">The **IDataObject** pointer will be passed to the drop target when the data is dropped, ending the drag loop.</span></span>

<span data-ttu-id="0c7e5-225">Das Datenobjekt ist nun bereit für die Übertragung an das Ziel.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-225">The data object is now ready to be transferred to the target.</span></span> <span data-ttu-id="0c7e5-226">Bei Datenübertragungen in der Zwischenablage wird das Objekt einfach so lange aufbewahrt, bis das Ziel es durch Aufrufen von [**olegetclipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard)anfordert.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-226">For clipboard data transfers, the object is simply held until the target requests it by calling [**OleGetClipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard).</span></span> <span data-ttu-id="0c7e5-227">Bei Drag & Drop-Datenübertragungen ist das Datenobjekt dafür verantwortlich, ein Symbol zum Darstellen der Daten zu erstellen und zu verschieben, wenn der Benutzer den Cursor verschiebt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-227">For drag-and-drop data transfers, the data object is responsible for creating an icon to represent the data and moving it as the user moves the cursor.</span></span> <span data-ttu-id="0c7e5-228">Während sich das-Objekt in der Drag-Schleife befindet, empfängt die Quelle Statusinformationen über die [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) -Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-228">While the object is in the drag loop, the source receives status information through its [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) interface.</span></span> <span data-ttu-id="0c7e5-229">Weitere Informationen finden Sie unter [Implementieren von IDropSource](#implementing-idropsource).</span><span class="sxs-lookup"><span data-stu-id="0c7e5-229">For further discussion, see [Implementing IDropSource](#implementing-idropsource).</span></span>

<span data-ttu-id="0c7e5-230">Die Quelle empfängt keine Benachrichtigung, wenn das Datenobjekt von einem Ziel aus der Zwischenablage abgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-230">The source receives no notification if the data object is retrieved from the Clipboard by a target.</span></span> <span data-ttu-id="0c7e5-231">Wenn ein Objekt durch einen Drag & Drop-Vorgang auf einem Ziel abgelegt wird, gibt die [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) -Funktion zurück, die aufgerufen wurde, um die Drag-Schleife zu initiieren.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-231">When an object is dropped on a target by a drag-and-drop operation, the [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) function that was called to initiate the drag loop will return.</span></span>

### <a name="how-to-add-a-global-memory-object-to-a-data-object"></a><span data-ttu-id="0c7e5-232">Vorgehensweise beim Hinzufügen eines globalen Speicher Objekts zu einem Datenobjekt</span><span class="sxs-lookup"><span data-stu-id="0c7e5-232">How to Add a Global Memory Object to a Data Object</span></span>

<span data-ttu-id="0c7e5-233">Viele der shelldatenformate sind in Form eines globalen Speicher Objekts.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-233">Many of the Shell data formats are in the form of a global memory object.</span></span> <span data-ttu-id="0c7e5-234">Verwenden Sie das folgende Verfahren, um ein Format zu erstellen, das ein globales Speicher Objekt enthält, und das Sie in das Datenobjekt laden:</span><span class="sxs-lookup"><span data-stu-id="0c7e5-234">Use the following procedure to create a format containing a global memory object and load it into the data object:</span></span>

1.  <span data-ttu-id="0c7e5-235">Erstellen Sie eine [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) -Struktur.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-235">Create a [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure.</span></span> <span data-ttu-id="0c7e5-236">Legen Sie den **cfFormat** -Member auf den entsprechenden Zwischenablage Formatwert und den **TYMED** -Member auf TYMED \_ HGLOBAL fest.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-236">Set the **cfFormat** member to the appropriate clipboard format value and the **tymed** member to TYMED\_HGLOBAL.</span></span>
2.  <span data-ttu-id="0c7e5-237">Erstellen Sie eine [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) -Struktur.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-237">Create an [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span> <span data-ttu-id="0c7e5-238">Legen Sie den **TYMED** -Member auf "TYMED \_ HGLOBAL" fest.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-238">Set the **tymed** member to TYMED\_HGLOBAL.</span></span>
3.  <span data-ttu-id="0c7e5-239">Erstellen Sie ein globales Speicher Objekt, indem Sie [**GlobalAlloc**](/windows/win32/api/winbase/nf-winbase-globalalloc) aufrufen, um einen entsprechend großen Speicherblock zuzuweisen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-239">Create a global memory object by calling [**GlobalAlloc**](/windows/win32/api/winbase/nf-winbase-globalalloc) to allocate a suitably sized block of memory.</span></span>
4.  <span data-ttu-id="0c7e5-240">Weisen Sie den zu übertragenden Datenblock an die von [**globalassign**](/windows/win32/api/winbase/nf-winbase-globalalloc)zurückgegebene Adresse zu.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-240">Assign the block of data to be transferred to the address returned by [**GlobalAlloc**](/windows/win32/api/winbase/nf-winbase-globalalloc).</span></span>
5.  <span data-ttu-id="0c7e5-241">Weisen Sie die Adresse des globalen Speicher Objekts dem **HGLOBAL** -Member der [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) -Struktur zu.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-241">Assign the global memory object's address to the **hGlobal** member of the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span>
6.  <span data-ttu-id="0c7e5-242">Laden Sie das Format in das Datenobjekt, indem Sie [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) aufrufen und die [**Formatierungs**](/windows/win32/api/objidl/ns-objidl-formatetc) -und [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) -Strukturen übergeben, die in den vorherigen Schritten erstellt wurden.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-242">Load the format into the data object by calling [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) and passing in the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) and [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structures created in the previous steps.</span></span>

<span data-ttu-id="0c7e5-243">Mit der folgenden Beispiel Funktion wird ein globales Speicher Objekt mit einem **DWORD** -Wert erstellt und in ein Datenobjekt geladen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-243">The following sample function creates a global memory object containing a **DWORD** value and loads it into a data object.</span></span> <span data-ttu-id="0c7e5-244">Der **pdtobj** -Parameter ist ein Zeiger auf die [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) -Schnittstelle des Datenobjekts, **CF** ist der Zwischenablage Format Wert, und **DW** ist der Datenwert.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-244">The **pdtobj** parameter is a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface, **cf** is the clipboard format value, and **dw** is the data value.</span></span>


```C++
STDAPI DataObj_SetDWORD(IDataObject *pdtobj, UINT cf, DWORD dw)
{
    FORMATETC fmte = {(CLIPFORMAT) cf, 
                      NULL, 
                      DVASPECT_CONTENT, 
                      -1, 
                      TYMED_HGLOBAL};
    STGMEDIUM medium;

    HRESULT hres = E_OUTOFMEMORY;
    DWORD *pdw = (DWORD *)GlobalAlloc(GPTR, sizeof(DWORD));
    
    if (pdw)
    {
        *pdw = dw;       
        medium.tymed = TYMED_HGLOBAL;
        medium.hGlobal = pdw;
        medium.pUnkForRelease = NULL;

        hres = pdtobj->SetData(&fmte, &medium, TRUE);
 
        if (FAILED(hres))
            GlobalFree((HGLOBAL)pdw);
    }
    return hres;
}
```



### <a name="implementing-idataobject"></a><span data-ttu-id="0c7e5-245">Implementieren von IDataObject</span><span class="sxs-lookup"><span data-stu-id="0c7e5-245">Implementing IDataObject</span></span>

<span data-ttu-id="0c7e5-246">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) ist die primäre Schnittstelle eines Datenobjekts.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-246">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) is a data object's primary interface.</span></span> <span data-ttu-id="0c7e5-247">Sie muss von allen Datenobjekten implementiert werden.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-247">It must be implemented by all data objects.</span></span> <span data-ttu-id="0c7e5-248">Sie wird von Quelle und Ziel für eine Vielzahl von Zwecken verwendet, einschließlich:</span><span class="sxs-lookup"><span data-stu-id="0c7e5-248">It is used by both source and target for a variety of purposes, including:</span></span>

-   <span data-ttu-id="0c7e5-249">Laden von Daten in das Datenobjekt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-249">Loading data into the data object.</span></span>
-   <span data-ttu-id="0c7e5-250">Extrahieren von Daten aus dem Datenobjekt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-250">Extracting data from the data object.</span></span>
-   <span data-ttu-id="0c7e5-251">Die Bestimmung der Datentypen im Datenobjekt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-251">Determining what types of data are in the data object.</span></span>
-   <span data-ttu-id="0c7e5-252">Senden von Feedback an das Datenobjekt im Rahmen der Datenübertragung.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-252">Providing feedback to the data object on outcome of the data transfer.</span></span>

<span data-ttu-id="0c7e5-253">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) unterstützt eine Reihe von Methoden.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-253">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) supports a number of methods.</span></span> <span data-ttu-id="0c7e5-254">In diesem Abschnitt wird erläutert, wie die drei wichtigsten Methoden für Shell-Datenobjekte, [SetData](#setdata-method), [enumformatusw](#enumformatetc-method). und [GetData](#getdata-method)implementiert werden.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-254">This section discusses how to implement the three most important methods for Shell data objects, [SetData](#setdata-method), [EnumFormatEtc](#enumformatetc-method), and [GetData](#getdata-method).</span></span> <span data-ttu-id="0c7e5-255">Eine Erläuterung der anderen Methoden finden Sie in der **IDataObject** -Referenz.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-255">For a discussion of the other methods, see the **IDataObject** reference.</span></span>

### <a name="setdata-method"></a><span data-ttu-id="0c7e5-256">SetData-Methode</span><span class="sxs-lookup"><span data-stu-id="0c7e5-256">SetData method</span></span>

<span data-ttu-id="0c7e5-257">Die primäre Funktion der [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) -Methode besteht darin, dass die Quelle das Laden von Daten in das Datenobjekt zulässt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-257">The primary function of the [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) method is to allow the source to load data into the data object.</span></span> <span data-ttu-id="0c7e5-258">Für jedes Format, das eingeschlossen werden soll, erstellt die Quelle eine [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) -Struktur, um das Format und eine [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) -Struktur zu identifizieren, die einen Zeiger auf die Daten enthalten soll.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-258">For each format to be included, the source creates a [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure to identify the format and an [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure to hold a pointer to the data.</span></span> <span data-ttu-id="0c7e5-259">Die Quelle ruft dann die **IDataObject:: SetData** -Methode des Objekts auf und übergibt die **FORMATETC** -und **STGMEDIUM** -Strukturen im Format.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-259">The source then calls the object's **IDataObject::SetData** method and passes in the format's **FORMATETC** and **STGMEDIUM** structures.</span></span> <span data-ttu-id="0c7e5-260">Die-Methode muss diese Informationen speichern, damit Sie verfügbar ist, wenn das Ziel [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) aufruft, um Daten aus dem-Objekt zu extrahieren.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-260">The method must store this information so that it is available when the target calls [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) to extract data from the object.</span></span>

<span data-ttu-id="0c7e5-261">Beim Übertragen von Dateien fügt die Shell jedoch häufig die Informationen für jede Datei ein, die in ein separates [cfstr \_ File Contents](clipboard.md) -Format übertragen werden soll.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-261">However, when transferring files, the Shell often puts the information for each file to be transferred into a separate [CFSTR\_FILECONTENTS](clipboard.md) format.</span></span> <span data-ttu-id="0c7e5-262">Um die verschiedenen Dateien zu unterscheiden, wird der **Lindex** -Member der [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) -Struktur jeder Datei auf einen Indexwert festgelegt, der die jeweilige Datei identifiziert.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-262">To distinguish the different files, the **lIndex** member of each file's [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure is set to an index value that identifies the particular file.</span></span> <span data-ttu-id="0c7e5-263">Ihre [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) -Implementierung muss in der Lage sein, mehrere cfstr \_ File Contents-Formate zu speichern, die sich nur durch ihre **Lindex** -Member unterscheiden.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-263">Your [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) implementation must be capable of storing multiple CFSTR\_FILECONTENTS formats that differ only by their **lIndex** members.</span></span>

<span data-ttu-id="0c7e5-264">Während sich der Cursor über dem Zielfenster befindet, kann das Ziel das Drag & amp; [Drop-Hilfsobjekt](#using-the-drag-and-drop-helper-object) verwenden, um das Zieh Bild anzugeben.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-264">While the cursor is over the target window, the target can use the [drag-and-drop helper object](#using-the-drag-and-drop-helper-object) to specify the drag image.</span></span> <span data-ttu-id="0c7e5-265">Das Drag & amp; Drop Helper-Objekt ruft [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) auf, um private Formate in das Datenobjekt zu laden, das für prozessübergreifende Unterstützung verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-265">The drag-and-drop helper object calls [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) to load private formats into the data object that are used for cross-process support.</span></span> <span data-ttu-id="0c7e5-266">Zur Unterstützung des Drag & Drop-Hilfsobjekts muss die **IDataObject:: SetData** -Implementierung in der Lage sein, beliebige private Formate zu akzeptieren und zu speichern.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-266">To support the drag-and-drop helper object, your **IDataObject::SetData** implementation must be able to accept and store arbitrary private formats.</span></span>

<span data-ttu-id="0c7e5-267">Nachdem die Daten gelöscht wurden, erfordern einige Arten von shelldatenübertragungen, dass das Ziel [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) aufruft, um dem Datenobjekt Informationen zum Ergebnis des Drop-Vorgangs bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-267">After the data has been dropped, some types of Shell data transfer require the target to call [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) to provide the data object with information about the outcome of the drop operation.</span></span> <span data-ttu-id="0c7e5-268">Wenn Sie z. b. Dateien mit einem optimierten Verschiebungs Vorgang verschieben, löscht das Ziel normalerweise die ursprünglichen Dateien, dies ist jedoch nicht zwingend erforderlich.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-268">For example, when moving files with an optimized move operation, the target normally deletes the original files, but it is not required to do so.</span></span> <span data-ttu-id="0c7e5-269">Das Ziel informiert das Datenobjekt darüber, ob es die Dateien durch Aufrufen von **IDataObject:: SetData** mit einem [cfstr \_ logicalperformeddropeer ffect](clipboard.md) -Format gelöscht hat.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-269">The target informs the data object whether it deleted the files by calling **IDataObject::SetData** with a [CFSTR\_LOGICALPERFORMEDDROPEFFECT](clipboard.md) format.</span></span> <span data-ttu-id="0c7e5-270">Es gibt mehrere andere [shellzwischenablage Formate](clipboard.md) , die auch vom Ziel verwendet werden, um Informationen an das Datenobjekt zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-270">There are several other [Shell Clipboard Formats](clipboard.md) that are also used by the target to pass information to the data object.</span></span> <span data-ttu-id="0c7e5-271">Ihre **IDataObject:: SetData** -Implementierung muss in der Lage sein, diese Formate zu erkennen und entsprechend zu reagieren.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-271">Your **IDataObject::SetData** implementation must be able to recognize these formats and respond appropriately.</span></span> <span data-ttu-id="0c7e5-272">Weitere Informationen finden Sie unter [Handling Shell Datenübertragung Szenarios](datascenarios.md).</span><span class="sxs-lookup"><span data-stu-id="0c7e5-272">For further discussion, see [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>

### <a name="enumformatetc-method"></a><span data-ttu-id="0c7e5-273">EnumFormatEtc-Methode</span><span class="sxs-lookup"><span data-stu-id="0c7e5-273">EnumFormatEtc method</span></span>

<span data-ttu-id="0c7e5-274">Wenn das Ziel ein Datenobjekt empfängt, ruft es häufig [**formatusw**](/windows/win32/api/objidl/ns-objidl-formatetc) . auf, um zu bestimmen, welche Formate das Objekt enthält.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-274">When the target receives a data object, it commonly calls [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) to determine what formats the object contains.</span></span> <span data-ttu-id="0c7e5-275">Die-Methode erstellt ein OLE-Enumerationsobjekt und gibt einen Zeiger auf die [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) -Schnittstelle des Objekts zurück.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-275">The method creates an OLE enumeration object and returns a pointer to the object's [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) interface.</span></span> <span data-ttu-id="0c7e5-276">Das Ziel verwendet dann die-Schnittstelle zum Auflisten der verfügbaren Formate.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-276">The target then uses the interface to enumerate the available formats.</span></span>

<span data-ttu-id="0c7e5-277">Ein Enumerationsobjekt sollte die verfügbaren Formate immer in der Reihenfolge der Qualität auflisten, beginnend mit dem besten.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-277">An enumeration object should always enumerate the available formats in order of quality, starting with the best.</span></span> <span data-ttu-id="0c7e5-278">Die relative Qualität von Formaten wird von der Ablage Quelle definiert.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-278">The relative quality of formats is defined by the drop source.</span></span> <span data-ttu-id="0c7e5-279">Im Allgemeinen enthalten die Formate mit der höchsten Qualität die reichsten und am meisten vollständigsten Daten.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-279">In general, the highest-quality formats contain the richest and most complete data.</span></span> <span data-ttu-id="0c7e5-280">Beispielsweise würde ein 24-Bit-Farbbild normalerweise als höhere Qualität angesehen als eine Graustufen Version dieses Bilds.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-280">For instance, a 24-bit color image would normally be considered higher quality than a gray-scale version of that image.</span></span> <span data-ttu-id="0c7e5-281">Der Grund für das Auflisten von Formaten in der Reihenfolge ihrer Qualität besteht darin, dass Ziele in der Regel so lange aufgelistet werden, bis Sie zu einem von Ihnen unterstützten Format gelangen. Anschließend verwenden Sie dieses Format zum Extrahieren der Daten.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-281">The reason for enumerating formats in order of their quality is that targets typically enumerate until they get to a format that they support, and then they use that format to extract the data.</span></span> <span data-ttu-id="0c7e5-282">Damit dieses Verfahren das beste verfügbare Format erzeugt, das vom Ziel unterstützt werden kann, müssen die Formate in der Reihenfolge ihrer Qualität aufgelistet werden.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-282">For this procedure to produce the best available format that the target can support, the formats must be enumerated in order of their quality.</span></span>

<span data-ttu-id="0c7e5-283">Ein Enumerationsobjekt für shelldaten wird auf die gleiche Weise wie für andere Arten der Datenübertragung implementiert, mit einer Ausnahme.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-283">An enumeration object for Shell data is implemented in much the same way as for other types of data transfer, with one notable exception.</span></span> <span data-ttu-id="0c7e5-284">Da Datenobjekte in der Regel nur ein Datenelement Pro Format enthalten, werden normalerweise alle Formate aufgelistet, die an [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata)weitergegeben werden.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-284">Because data objects typically contain only one data item per format, they normally enumerate every format that is passed to [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata).</span></span> <span data-ttu-id="0c7e5-285">Wie im Abschnitt [SetData-Methode](#setdata-method) erläutert, können shelldatenobjekte jedoch mehrere [cfstr \_ File Content](clipboard.md) -Formate enthalten.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-285">However, as discussed in the [SetData method](#setdata-method) section, Shell data objects can contain multiple [CFSTR\_FILECONTENTS](clipboard.md) formats.</span></span>

<span data-ttu-id="0c7e5-286">Der Zweck von [**IDataObject:: enumformatusw**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc) . besteht darin, das Ziel zu bestimmen, welche Datentypen vorhanden sind. es ist nicht erforderlich, mehr als ein [cfstr \_ File Contents](clipboard.md) -Format aufzuzählen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-286">Because the purpose of [**IDataObject::EnumFormatEtc**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc) is to allow the target to determine what types of data are present, there is no need to enumerate more than one [CFSTR\_FILECONTENTS](clipboard.md) format.</span></span> <span data-ttu-id="0c7e5-287">Wenn das Ziel wissen muss, wie viele dieser Formate das Datenobjekt enthält, kann das Ziel diese Informationen aus dem zugehörigen cfstr \_ File Descriptor-Format abrufen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-287">If the target needs to know how many of these formats the data object contains, the target can retrieve that information from the accompanying CFSTR\_FILEDESCRIPTOR format.</span></span> <span data-ttu-id="0c7e5-288">Weitere Informationen zur Implementierung von **IDataObject:: enumformatusw**. finden Sie in der Referenz Dokumentation der-Methode.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-288">For further discussion of how to implement **IDataObject::EnumFormatEtc**, see the method's reference documentation.</span></span>

### <a name="getdata-method"></a><span data-ttu-id="0c7e5-289">GetData-Methode</span><span class="sxs-lookup"><span data-stu-id="0c7e5-289">GetData method</span></span>

<span data-ttu-id="0c7e5-290">Das Ziel ruft [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) auf, um ein bestimmtes Datenformat zu extrahieren.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-290">The target calls [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) to extract a particular data format.</span></span> <span data-ttu-id="0c7e5-291">Das Ziel gibt das Format an, indem es die entsprechende [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) -Struktur übergibt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-291">The target specifies the format by passing in the appropriate [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure.</span></span> <span data-ttu-id="0c7e5-292">**IDataObject:: GetData** gibt die [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) -Struktur des Formats zurück.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-292">**IDataObject::GetData** returns the format's [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span>

<span data-ttu-id="0c7e5-293">Das Ziel kann den **TYMED** -Member der [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) -Struktur auf einen bestimmten TYMED \_ *xxx* -Wert festlegen, um anzugeben, welcher Datenübertragungsmechanismus zum Extrahieren der Daten verwendet werden soll.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-293">The target can set the **tymed** member of the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure to a specific TYMED\_*XXX* value to specify which data transfer mechanism it will use to extract the data.</span></span> <span data-ttu-id="0c7e5-294">Das Ziel kann jedoch auch eine allgemeinere Anforderung erstellen und das Datenobjekt entscheiden lassen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-294">However, the target can also make a more generic request and let the data object decide.</span></span> <span data-ttu-id="0c7e5-295">Um das Datenobjekt zum Auswählen des Datenübertragungsmechanismus aufzufordern, legt das Ziel alle von \_ ihm unterstützten TYMED *xxx* -Werte fest.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-295">To ask the data object to select the data transfer mechanism, the target sets all the TYMED\_*XXX* values that it supports.</span></span> <span data-ttu-id="0c7e5-296">[**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) wählt einen dieser Datenübertragungs Mechanismen aus und gibt die entsprechende [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) -Struktur zurück.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-296">[**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) selects one of these data transfer mechanisms and returns the appropriate [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span> <span data-ttu-id="0c7e5-297">Beispielsweise ist **TYMED** häufig auf TYMED \_ HGLOBAL \| TYMED \_ IStream \| TYMED IStorage festgelegt, \_ um einen der drei Shell-Datenübertragungs Mechanismen anzufordern.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-297">For instance, **tymed** is commonly set to TYMED\_HGLOBAL \| TYMED\_ISTREAM \| TYMED\_ISTORAGE to request any of the three Shell data transfer mechanisms.</span></span>

> [!Note]  
> <span data-ttu-id="0c7e5-298">Da es mehrere [cfstr \_ File Content](clipboard.md) -Formate geben kann, reichen die Member " **cfFormat** " und " **TYMED** " der [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) -Struktur nicht aus, um anzugeben, welche [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) -Struktur " [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) " zurückgeben soll.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-298">Because there can be multiple [CFSTR\_FILECONTENTS](clipboard.md) formats, the **cfFormat** and **tymed** members of the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure are not sufficient to indicate which [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) should return.</span></span> <span data-ttu-id="0c7e5-299">Für das Format cfstr \_ File Contents muss **IDataObject:: GetData** auch den **Lindex** -Member der **FORMATETC** -Struktur untersuchen, um die korrekte **STGMEDIUM** -Struktur zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-299">For the CFSTR\_FILECONTENTS format, **IDataObject::GetData** must also examine the **FORMATETC** structure's **lIndex** member in order to return the correct **STGMEDIUM** structure.</span></span>

 

<span data-ttu-id="0c7e5-300">Das [cfstr \_ indragloop](clipboard.md) -Format wird in Datenobjekten eingefügt, sodass Ziele den Status der Drag & Drop-Schleife überprüfen und gleichzeitig das speicherintensive Rendering der Objektdaten vermeiden können.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-300">The [CFSTR\_INDRAGLOOP](clipboard.md) format is placed in data objects to allow targets to check the status of the drag-and-drop loop while avoiding memory intensive rendering of the object's data.</span></span> <span data-ttu-id="0c7e5-301">Die Daten des Formats sind ein **DWORD** -Wert, der auf einen Wert ungleich 0 (null) festgelegt wird, wenn sich das Datenobjekt innerhalb einer Drag-Schleife befindet.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-301">The format's data is a **DWORD** value that is set to a nonzero value if the data object is within a drag loop.</span></span> <span data-ttu-id="0c7e5-302">Der Datenwert des Formats wird auf 0 (null) festgelegt, wenn die Daten gelöscht wurden.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-302">The format's data value is set to zero if the data has been dropped.</span></span> <span data-ttu-id="0c7e5-303">Wenn ein Ziel dieses Format anfordert und es nicht von der Quelle geladen wurde, sollte [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) so reagieren, als ob die Quelle das Format mit dem Wert 0 (null) geladen hätte.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-303">If a target requests this format and it has not been loaded by the source, [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) should respond as if the source had loaded the format with a value of zero.</span></span>

<span data-ttu-id="0c7e5-304">Während sich der Cursor über dem Zielfenster befindet, kann das Ziel das Drag & amp; [Drop-Hilfsobjekt](#using-the-drag-and-drop-helper-object) verwenden, um das Zieh Bild anzugeben.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-304">While the cursor is over the target window, the target can use the [drag-and-drop helper object](#using-the-drag-and-drop-helper-object) to specify the drag image.</span></span> <span data-ttu-id="0c7e5-305">Das Drag & amp; Drop Helper-Objekt ruft [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) auf, um private Formate in das Datenobjekt zu laden, das für prozessübergreifende Unterstützung verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-305">The drag-and-drop helper object calls [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) to load private formats into the data object that are used for cross-process support.</span></span> <span data-ttu-id="0c7e5-306">Später wird [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) aufgerufen, um Sie abzurufen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-306">It later calls [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) to retrieve them.</span></span> <span data-ttu-id="0c7e5-307">Zur Unterstützung des Drag & Drop-Hilfsobjekts muss Ihre shelldatenobjektimplementierung in der Lage sein, beliebige private Formate zurückzugeben, wenn Sie angefordert werden.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-307">To support the drag-and-drop helper object, your Shell Data Object implementation must be able to return arbitrary private formats when they are requested.</span></span>

### <a name="implementing-idropsource"></a><span data-ttu-id="0c7e5-308">Implementieren von IDropSource</span><span class="sxs-lookup"><span data-stu-id="0c7e5-308">Implementing IDropSource</span></span>

<span data-ttu-id="0c7e5-309">Die Quelle muss ein Objekt erstellen, das eine [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) -Schnittstelle verfügbar macht.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-309">The source must create an object that exposes an [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) interface.</span></span> <span data-ttu-id="0c7e5-310">Diese Schnittstelle ermöglicht es der Quelle, das Zieh *Bild* zu aktualisieren, das die aktuelle Position des Cursors angibt, und dem System Feedback zu geben, wie ein Drag & Drop-Vorgang beendet wird.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-310">This interface allows the source to update the *drag image* that indicates the current position of the cursor and to provide feedback to the system on how to terminate a drag-and-drop operation.</span></span> <span data-ttu-id="0c7e5-311">**IDropSource** verfügt über zwei Methoden: [**GiveFeedback**](/windows/win32/api/oleidl/nf-oleidl-idropsource-givefeedback) und [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag).</span><span class="sxs-lookup"><span data-stu-id="0c7e5-311">**IDropSource** has two methods: [**GiveFeedback**](/windows/win32/api/oleidl/nf-oleidl-idropsource-givefeedback) and [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag).</span></span>

### <a name="givefeedback-method"></a><span data-ttu-id="0c7e5-312">GiveFeedback-Methode</span><span class="sxs-lookup"><span data-stu-id="0c7e5-312">GiveFeedback method</span></span>

<span data-ttu-id="0c7e5-313">In der Drag-Schleife ist eine Ablage Quelle dafür zuständig, die Cursorposition zu verfolgen und ein entsprechendes Zieh Bild anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-313">While in the drag loop, a drop source is responsible for keeping track of the cursor position and displaying an appropriate drag image.</span></span> <span data-ttu-id="0c7e5-314">In einigen Fällen möchten Sie jedoch möglicherweise die Darstellung des Zieh Bilds ändern, wenn es sich über dem Ablage Zielfenster befindet.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-314">However, in some cases you might want to change the appearance of the drag image when it is over the drop target's window.</span></span>

<span data-ttu-id="0c7e5-315">Wenn der Cursor das Zielfenster eingibt oder verlässt und während er sich über das Zielfenster bewegt, ruft das System regelmäßig die [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) -Schnittstelle des Ziels auf.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-315">When the cursor enters or leaves the target window and while it is moving over the target window, the system periodically calls the target's [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface.</span></span> <span data-ttu-id="0c7e5-316">Das Ziel antwortet mit einem [**dropffect**](../com/dropeffect-constants.md) -Wert, der über die [**GiveFeedback**](/windows/win32/api/oleidl/nf-oleidl-idropsource-givefeedback) -Methode an die Quelle weitergeleitet wird.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-316">The target responds with a [**DROPEFFECT**](../com/dropeffect-constants.md) value that is forwarded to the source through the [**GiveFeedback**](/windows/win32/api/oleidl/nf-oleidl-idropsource-givefeedback) method.</span></span> <span data-ttu-id="0c7e5-317">Wenn dies der Grund ist, kann die Quelle die Darstellung des Cursors basierend auf dem **dropffect** -Wert ändern.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-317">If appropriate, the source can modify the appearance of the cursor based on the **DROPEFFECT** value.</span></span> <span data-ttu-id="0c7e5-318">Weitere Informationen finden Sie in den Referenzen zu **GiveFeedback** und [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) .</span><span class="sxs-lookup"><span data-stu-id="0c7e5-318">For further details, see the **GiveFeedback** and [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) references.</span></span>

### <a name="querycontinuedrag-method"></a><span data-ttu-id="0c7e5-319">QueryContinueDrag-Methode</span><span class="sxs-lookup"><span data-stu-id="0c7e5-319">QueryContinueDrag method</span></span>

<span data-ttu-id="0c7e5-320">Diese Methode wird aufgerufen, wenn sich der Mauszeiger-oder Tastatur Zustand ändert, während sich das Datenobjekt in der Drag-Schleife befindet.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-320">This method is called if the mouse button or keyboard state changes while the data object is in the drag loop.</span></span> <span data-ttu-id="0c7e5-321">Es benachrichtigt die Quelle, ob die ESC-Taste gedrückt wurde, und gibt den aktuellen Zustand der Tastatur-Modifizierertasten an, z. b. STRG oder UMSCHALT.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-321">It notifies the source whether the ESC key has been pressed and provides the current state of the keyboard modifier keys, such as CTRL or SHIFT.</span></span> <span data-ttu-id="0c7e5-322">Der Rückgabewert der [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag) -Methode gibt eine von drei Aktionen an:</span><span class="sxs-lookup"><span data-stu-id="0c7e5-322">The [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag) method's return value specifies one of three actions:</span></span>

-   <span data-ttu-id="0c7e5-323">S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-323">S\_OK.</span></span> <span data-ttu-id="0c7e5-324">Fortsetzen des Zieh Vorgangs</span><span class="sxs-lookup"><span data-stu-id="0c7e5-324">Continue the drag operation</span></span>
-   <span data-ttu-id="0c7e5-325">DragDrop \_ S \_ Drop.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-325">DRAGDROP\_S\_DROP.</span></span> <span data-ttu-id="0c7e5-326">Löschen Sie die Daten.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-326">Drop the data.</span></span> <span data-ttu-id="0c7e5-327">Das System ruft dann die [**IDropTarget::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) -Methode des Ziels auf.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-327">The system then calls the target's [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) method.</span></span>
-   <span data-ttu-id="0c7e5-328">DragDrop \_ S \_ Abbrechen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-328">DRAGDROP\_S\_CANCEL.</span></span> <span data-ttu-id="0c7e5-329">Beenden Sie die Drag-Schleife, ohne die Daten zu löschen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-329">Terminate the drag loop without dropping the data.</span></span> <span data-ttu-id="0c7e5-330">Dieser Wert wird normalerweise zurückgegeben, wenn die Escape-Taste gedrückt wurde.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-330">This value is normally returned if the ESCAPE key was pressed.</span></span>

<span data-ttu-id="0c7e5-331">Weitere Informationen finden Sie in den Referenzen [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag) und [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) .</span><span class="sxs-lookup"><span data-stu-id="0c7e5-331">For further discussion, see the [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag) and [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) references.</span></span>

## <a name="how-a-target-handles-a-data-object"></a><span data-ttu-id="0c7e5-332">Verarbeiten eines Datenobjekts durch ein Ziel</span><span class="sxs-lookup"><span data-stu-id="0c7e5-332">How a Target Handles a Data Object</span></span>

<span data-ttu-id="0c7e5-333">Das Ziel empfängt ein Datenobjekt, wenn das Datenobjekt entweder aus der Zwischenablage abgerufen wird oder es vom Benutzer im Zielfenster abgelegt wurde.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-333">The target receives a data object when it either retrieves the data object from the Clipboard or has it dropped on the target window by the user.</span></span> <span data-ttu-id="0c7e5-334">Das Ziel kann dann Daten aus dem Datenobjekt extrahieren.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-334">The target can then extract data from the data object.</span></span> <span data-ttu-id="0c7e5-335">Bei Bedarf kann das Ziel das Datenobjekt auch über das Ergebnis des Vorgangs benachrichtigen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-335">If necessary, the target can also notify the data object of the outcome of the operation.</span></span> <span data-ttu-id="0c7e5-336">Vor einer shelldatenübertragung muss sich ein Ablage Ziel für den Vorgang vorbereiten:</span><span class="sxs-lookup"><span data-stu-id="0c7e5-336">Prior to a Shell data transfer, a drop target must prepare itself for the operation:</span></span>

1.  <span data-ttu-id="0c7e5-337">Das Ziel muss [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) aufrufen, um einen gültigen Zwischenablage-Format Wert für alle shellformate (außer [CF \_ HDROP](clipboard.md)) zu erhalten, die möglicherweise im Datenobjekt enthalten sind.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-337">The target must call [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) to obtain a valid clipboard format value for all Shell formats, other than [CF\_HDROP](clipboard.md), that might be included in the data object.</span></span> <span data-ttu-id="0c7e5-338">CF \_ HDROP ist bereits ein gültiges Zwischenablage Format und muss nicht registriert werden.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-338">CF\_HDROP is already a valid clipboard format and does not need to be registered.</span></span>
2.  <span data-ttu-id="0c7e5-339">Um einen Drag & Drop-Vorgang zu unterstützen, muss das Ziel eine [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) -Schnittstelle implementieren und ein Zielfenster registrieren.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-339">To support a drag-and-drop operation, the target must implement an [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface and register a target window.</span></span> <span data-ttu-id="0c7e5-340">Zum Registrieren eines Zielfensters Ruft das Ziel [**RegisterDragDrop**](/windows/win32/api/ole2/nf-ole2-registerdragdrop) auf und übergibt das Fenster Handle und den **IDropTarget** -Schnittstellen Zeiger.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-340">To register a target window, the target calls [**RegisterDragDrop**](/windows/win32/api/ole2/nf-ole2-registerdragdrop) and passes in the window's handle and the **IDropTarget** interface pointer.</span></span>

<span data-ttu-id="0c7e5-341">Bei Übertragungen von Zwischenablage empfängt das Ziel keine Benachrichtigung, dass ein Datenobjekt in der Zwischenablage abgelegt wurde.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-341">For clipboard transfers, the target does not receive any notification that a data object has been placed on the Clipboard.</span></span> <span data-ttu-id="0c7e5-342">In der Regel wird eine Anwendung benachrichtigt, dass ein Objekt von einer Benutzeraktion in der Zwischenablage gespeichert wird, z. b. durch Klicken auf die Schaltfläche Einfügen auf der Symbolleiste der Anwendung.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-342">Typically, an application is notified that an object is on the Clipboard by a user action, such as clicking the Paste button on the application's toolbar.</span></span> <span data-ttu-id="0c7e5-343">Das Ziel ruft dann den [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) -Zeiger des Datenobjekts aus der Zwischenablage ab, indem [**olegetclipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard)aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-343">The target then retrieves the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) pointer from the Clipboard by calling [**OleGetClipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard).</span></span> <span data-ttu-id="0c7e5-344">Bei Drag & Drop-Datenübertragungen verwendet das System die [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) -Schnittstelle des Ziels, um dem Ziel Informationen zum Fortschritt der Datenübertragung bereitzustellen:</span><span class="sxs-lookup"><span data-stu-id="0c7e5-344">For drag-and-drop data transfers, the system uses the target's [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface to provide the target with information about the progress of the data transfer:</span></span>

-   <span data-ttu-id="0c7e5-345">Das System ruft [**IDropTarget::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) auf, wenn der Cursor in das Zielfenster eintritt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-345">The system calls [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) when the cursor enters the target window.</span></span>
-   <span data-ttu-id="0c7e5-346">Das System ruft in regelmäßigen Abständen [**IDropTarget::D ragover**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) auf, wenn der Cursor über das Zielfenster verläuft, um dem Ziel die aktuelle Cursorposition zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-346">The system periodically calls [**IDropTarget::DragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) as the cursor passes over the target window, to give the target the current cursor position.</span></span>
-   <span data-ttu-id="0c7e5-347">Das System ruft [**IDropTarget::D ragleave**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragleave) auf, wenn der Cursor das Zielfenster verlässt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-347">The system calls [**IDropTarget::DragLeave**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragleave) when the cursor leaves the target window.</span></span>
-   <span data-ttu-id="0c7e5-348">Das System ruft [**IDropTarget::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) auf, wenn der Benutzer das Datenobjekt im Zielfenster löscht.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-348">The system calls [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) when the user drops the data object on the target window.</span></span>

<span data-ttu-id="0c7e5-349">Eine Erläuterung der Implementierung dieser Methoden finden Sie unter [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget).</span><span class="sxs-lookup"><span data-stu-id="0c7e5-349">For a discussion of how to implement these methods, see [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget).</span></span>

<span data-ttu-id="0c7e5-350">Wenn die Daten gelöscht werden, stellt [**IDropTarget::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) dem Ziel einen Zeiger auf die [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) -Schnittstelle des Datenobjekts bereit.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-350">When the data is dropped, [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) provides the target with a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface.</span></span> <span data-ttu-id="0c7e5-351">Das Ziel verwendet dann diese Schnittstelle, um Daten aus dem Datenobjekt zu extrahieren.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-351">The target then uses this interface to extract data from the data object.</span></span>

### <a name="extracting-shell-data-from-a-data-object"></a><span data-ttu-id="0c7e5-352">Extrahieren von shelldaten aus einem Datenobjekt</span><span class="sxs-lookup"><span data-stu-id="0c7e5-352">Extracting Shell Data from a Data Object</span></span>

<span data-ttu-id="0c7e5-353">Nachdem ein Datenobjekt gelöscht oder aus der Zwischenablage abgerufen wurde, kann das Ziel die benötigten Daten extrahieren.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-353">Once a data object has been dropped or retrieved from the Clipboard, the target can extract the data it needs.</span></span> <span data-ttu-id="0c7e5-354">Der erste Schritt im Extraktionsprozess besteht in der Regel darin, die im Datenobjekt enthaltenen Formate aufzulisten:</span><span class="sxs-lookup"><span data-stu-id="0c7e5-354">The first step in the extraction process is typically to enumerate the formats contained by the data object:</span></span>

-   <span data-ttu-id="0c7e5-355">Rufen Sie [**IDataObject:: enumformatusw**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc). auf.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-355">Call [**IDataObject::EnumFormatEtc**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc).</span></span> <span data-ttu-id="0c7e5-356">Das Datenobjekt erstellt ein Standardmäßiges OLE-Enumerationsobjekt und gibt einen Zeiger auf seine [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) -Schnittstelle zurück.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-356">The data object creates a standard OLE enumeration object and returns a pointer to its [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) interface.</span></span>
-   <span data-ttu-id="0c7e5-357">Verwenden Sie die [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) -Methoden, um die Formate aufzulisten, die im Datenobjekt enthalten sind.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-357">Use the [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) methods to enumerate the formats contained by the data object.</span></span> <span data-ttu-id="0c7e5-358">Dieser Vorgang ruft in der Regel eine [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) -Struktur für jedes Format ab, das das Objekt enthält.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-358">This operation usually retrieves one [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure for each format that the object contains.</span></span> <span data-ttu-id="0c7e5-359">Das Enumerationsobjekt gibt jedoch normalerweise nur eine einzelne **FORMATETC** -Struktur für das [cfstr \_ File Contents](clipboard.md) -Format zurück, unabhängig davon, wie viele dieser Formate im Datenobjekt enthalten sind.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-359">However, the enumeration object normally returns only a single **FORMATETC** structure for the [CFSTR\_FILECONTENTS](clipboard.md) format, regardless of how many such formats are contained by the data object.</span></span>
-   <span data-ttu-id="0c7e5-360">Wählen Sie ein oder mehrere Formate aus, die extrahiert werden sollen, und speichern Sie Ihre [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) -Strukturen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-360">Select one or more formats to be extracted, and store their [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structures.</span></span>

<span data-ttu-id="0c7e5-361">Wenn Sie ein bestimmtes Format abrufen möchten, übergeben Sie die zugeordnete [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) -Struktur an [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata).</span><span class="sxs-lookup"><span data-stu-id="0c7e5-361">To retrieve a particular format, pass the associated [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure to [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata).</span></span> <span data-ttu-id="0c7e5-362">Diese Methode gibt eine [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) -Struktur zurück, die Zugriff auf die Daten bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-362">This method returns an [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure that provides access to the data.</span></span> <span data-ttu-id="0c7e5-363">Wenn Sie einen bestimmten Datenübertragungsmechanismus angeben möchten, legen Sie den Wert " **TYMED** " der **FORMATETC** -Struktur auf den entsprechenden Wert von "TYMED \_ *xxx* " fest.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-363">To specify a particular data transfer mechanism, set the **tymed** value of the **FORMATETC** structure to the corresponding TYMED\_*XXX* value.</span></span> <span data-ttu-id="0c7e5-364">Um das Datenobjekt zum Auswählen eines Datenübertragungsmechanismus aufzufordern, legt das Ziel die TYMED \_ *xxx* -Werte für jeden Datenübertragungsmechanismus fest, der vom Ziel verarbeitet werden kann.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-364">To ask the data object to select a data transfer mechanism, the target sets the TYMED\_*XXX* values for every data transfer mechanism that the target can handle.</span></span> <span data-ttu-id="0c7e5-365">Das Datenobjekt wählt einen dieser Datenübertragungs Mechanismen aus und gibt die entsprechende **STGMEDIUM** -Struktur zurück.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-365">The data object selects one of these data transfer mechanisms and returns the appropriate **STGMEDIUM** structure.</span></span>

<span data-ttu-id="0c7e5-366">Bei den meisten Formaten kann das Ziel die Daten abrufen, indem es die [**formatierte**](/windows/win32/api/objidl/ns-objidl-formatetc) Struktur übergibt, die beim Auflisten der verfügbaren Formate empfangen wurde.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-366">For most formats, the target can retrieve the data by passing the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure that it received when it enumerated the available formats.</span></span> <span data-ttu-id="0c7e5-367">Eine Ausnahme von dieser Regel ist " [cfstr \_ File Content](clipboard.md)".</span><span class="sxs-lookup"><span data-stu-id="0c7e5-367">One exception to this rule is [CFSTR\_FILECONTENTS](clipboard.md).</span></span> <span data-ttu-id="0c7e5-368">Da ein Datenobjekt mehrere Instanzen dieses Formats enthalten kann, entspricht die vom Enumerator zurückgegebene **FORMATETC** -Struktur möglicherweise nicht dem speziellen Format, das Sie extrahieren möchten.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-368">Because a data object can contain multiple instances of this format, the **FORMATETC** structure returned by the enumerator might not correspond to the particular format you want to extract.</span></span> <span data-ttu-id="0c7e5-369">Zusätzlich zur Angabe der Member " **cfFormat** " und " **TYMED** " müssen Sie auch das **Lindex** -Element auf den Indexwert der Datei festlegen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-369">In addition to specifying the **cfFormat** and **tymed** members, you must also set the **lIndex** member to the file's index value.</span></span> <span data-ttu-id="0c7e5-370">Weitere Informationen finden Sie im Abschnitt *Verwenden des cfstr \_ File Contents-Formats zum Extrahieren von Daten aus einer Datei* im Abschnitt [Handling Shell Datenübertragung Szenarios](datascenarios.md)</span><span class="sxs-lookup"><span data-stu-id="0c7e5-370">For further discussion, see the *Using the CFSTR\_FILECONTENTS Format to Extract Data from a File* section of [Handling Shell Data Transfer Scenarios](datascenarios.md)</span></span>

<span data-ttu-id="0c7e5-371">Der Daten Extraktionsprozess hängt vom Typ des Zeigers ab, der in der zurückgegebenen [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) -Struktur enthalten ist.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-371">The data extraction process depends on the type of pointer contained by the returned [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span> <span data-ttu-id="0c7e5-372">Wenn die Struktur einen Zeiger auf eine [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) -oder [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) -Schnittstelle enthält, verwenden Sie die Schnittstellen Methoden, um die Daten zu extrahieren.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-372">If the structure contains a pointer to an [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) or [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) interface, use the interface methods to extract the data.</span></span> <span data-ttu-id="0c7e5-373">Der Prozess des Extrahierens von Daten aus einem globalen Speicher Objekt wird im nächsten Abschnitt erläutert.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-373">The process of extracting data from a global memory object is discussed in the next section.</span></span>

### <a name="extracting-a-global-memory-object-from-a-data-object"></a><span data-ttu-id="0c7e5-374">Extrahieren eines globalen Speicher Objekts aus einem Datenobjekt</span><span class="sxs-lookup"><span data-stu-id="0c7e5-374">Extracting a global memory object from a data object</span></span>

<span data-ttu-id="0c7e5-375">Viele der shelldatenformate sind in Form eines globalen Speicher Objekts.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-375">Many of the Shell data formats are in the form of a global memory object.</span></span> <span data-ttu-id="0c7e5-376">Verwenden Sie das folgende Verfahren, um ein Format zu extrahieren, das ein globales Speicher Objekt aus einem Datenobjekt enthält, und weisen Sie die zugehörigen Daten einer lokalen Variablen zu:</span><span class="sxs-lookup"><span data-stu-id="0c7e5-376">Use the following procedure to extract a format containing a global memory object from a data object and assign its data to a local variable:</span></span>

1.  <span data-ttu-id="0c7e5-377">Erstellen Sie eine [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) -Struktur.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-377">Create a [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure.</span></span> <span data-ttu-id="0c7e5-378">Legen Sie den **cfFormat** -Member auf den entsprechenden Zwischenablage Formatwert und den **TYMED** -Member auf TYMED \_ HGLOBAL fest.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-378">Set the **cfFormat** member to the appropriate clipboard format value and the **tymed** member to TYMED\_HGLOBAL.</span></span>
2.  <span data-ttu-id="0c7e5-379">Erstellen Sie eine leere [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) -Struktur.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-379">Create an empty [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span>
3.  <span data-ttu-id="0c7e5-380">Rufen Sie [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata)auf, und übergeben Sie Zeiger auf die [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) -und [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) -Strukturen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-380">Call [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata), and pass in pointers to the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) and [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structures.</span></span>

    <span data-ttu-id="0c7e5-381">Wenn [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) zurückgegeben wird, enthält die [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) -Struktur einen Zeiger auf das globale Speicher Objekt, das die Daten enthält.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-381">When [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) returns, the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure will contain a pointer to the global memory object that contains the data.</span></span>

4.  <span data-ttu-id="0c7e5-382">Weisen Sie die Daten einer lokalen Variablen zu, indem Sie [**GlobalLock**](/windows/win32/api/winbase/nf-winbase-globallock) aufrufen und den **HGLOBAL** -Member der [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) -Struktur übergeben.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-382">Assign the data to a local variable by calling [**GlobalLock**](/windows/win32/api/winbase/nf-winbase-globallock) and passing in the **hGlobal** member of the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span>
5.  <span data-ttu-id="0c7e5-383">Nennen Sie [**globalunlock**](/windows/win32/api/winbase/nf-winbase-globalunlock) , um die Sperre für das globale Speicher Objekt freizugeben.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-383">Call [**GlobalUnlock**](/windows/win32/api/winbase/nf-winbase-globalunlock) to release the lock on the global memory object.</span></span>
6.  <span data-ttu-id="0c7e5-384">Aufrufen von [**ReleaseStgMedium**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) , um das globale Speicher Objekt freizugeben.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-384">Call [**ReleaseStgMedium**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) to release the global memory object.</span></span>

> [!Note]  
> <span data-ttu-id="0c7e5-385">Sie müssen [**ReleaseStgMedium**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) verwenden, um das globale Speicher Objekt freizugeben, nicht [**GlobalFree**](/windows/win32/api/winbase/nf-winbase-globalfree).</span><span class="sxs-lookup"><span data-stu-id="0c7e5-385">You must use [**ReleaseStgMedium**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) to release the global memory object, not [**GlobalFree**](/windows/win32/api/winbase/nf-winbase-globalfree).</span></span>

 

<span data-ttu-id="0c7e5-386">Im folgenden Beispiel wird gezeigt, wie ein **DWORD** -Wert extrahiert wird, der als globales Speicher Objekt aus einem Datenobjekt gespeichert wird.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-386">The following example shows how to extract a **DWORD** value stored as a global memory object from a data object.</span></span> <span data-ttu-id="0c7e5-387">Der Parameter " **pdtobj** " ist ein Zeiger auf die [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) -Schnittstelle des Datenobjekts, " **CF** " ist das Zwischenablage Format, das die gewünschten Daten identifiziert, und " **pdwout** " wird verwendet, um den Datenwert zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-387">The **pdtobj** parameter is a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface, **cf** is the clipboard format that identifies the desired data, and **pdwOut** is used to return the data value.</span></span>


```C++
STDAPI DataObj_GetDWORD(IDataObject *pdtobj, UINT cf, DWORD *pdwOut)
{    STGMEDIUM medium;
   FORMATETC fmte = {(CLIPFORMAT) cf, NULL, DVASPECT_CONTENT, -1, 
       TYMED_HGLOBAL};
    HRESULT hres = pdtobj->GetData(&fmte, &medium);
    if (SUCCEEDED(hres))
   {
       DWORD *pdw = (DWORD *)GlobalLock(medium.hGlobal);
       if (pdw)
       {
           *pdwOut = *pdw;
           GlobalUnlock(medium.hGlobal);
       }
       else
       {
           hres = E_UNEXPECTED;
       }
       ReleaseStgMedium(&medium);
   }
   return hres;
}
```



### <a name="implementing-idroptarget"></a><span data-ttu-id="0c7e5-388">Implementieren von IDropTarget</span><span class="sxs-lookup"><span data-stu-id="0c7e5-388">Implementing IDropTarget</span></span>

<span data-ttu-id="0c7e5-389">Das System verwendet die [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) -Schnittstelle für die Kommunikation mit dem Ziel, während sich der Cursor über dem Zielfenster befindet.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-389">The system uses the [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface to communicate with the target while the cursor is over the target window.</span></span> <span data-ttu-id="0c7e5-390">Die Ziel Antworten werden über die [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) -Schnittstelle an die Quelle weitergeleitet.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-390">The target's responses are forwarded to the source through its [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) interface.</span></span> <span data-ttu-id="0c7e5-391">Abhängig von der Antwort kann die Quelle das Symbol ändern, das die Daten darstellt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-391">Depending on the response, the source can modify the icon that represents the data.</span></span> <span data-ttu-id="0c7e5-392">Wenn das Ablage Ziel das Daten Symbol angeben muss, können Sie hierfür ein [Drag & Drop-Hilfsobjekt](#using-the-drag-and-drop-helper-object)erstellen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-392">If the drop target needs to specify the data icon, it can do so by creating a [drag-and-drop helper object](#using-the-drag-and-drop-helper-object).</span></span>

<span data-ttu-id="0c7e5-393">Bei herkömmlichen Drag & Drop-Vorgängen informiert das Ziel das Datenobjekt über das Ergebnis des Vorgangs, indem der *pdweffect* -Parameter von [**IDropTarget::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) auf den entsprechenden [**droetffect**](../com/dropeffect-constants.md) -Wert festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-393">With conventional drag-and-drop operations, the target informs the data object of the outcome of the operation by setting the *pdwEffect* parameter of [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) to the appropriate [**DROPEFFECT**](../com/dropeffect-constants.md) value.</span></span> <span data-ttu-id="0c7e5-394">Bei shelldatenobjekten muss das Ziel möglicherweise auch [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata)aufrufen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-394">With Shell data objects, the target might also need to call [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata).</span></span> <span data-ttu-id="0c7e5-395">Eine Erläuterung dazu, wie Ziele auf verschiedene Datenübertragungs Szenarien reagieren sollten, finden Sie unter [Handling Shell Datenübertragung Szenarios](datascenarios.md).</span><span class="sxs-lookup"><span data-stu-id="0c7e5-395">For a discussion of how targets should respond for different data transfer scenarios, see [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>

<span data-ttu-id="0c7e5-396">In den folgenden Abschnitten wird kurz erläutert, wie die Methoden [**IDropTarget::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter), [**IDropTarget::D ragover**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover)und [**IDropTarget::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) implementiert werden.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-396">The following sections briefly discuss how to implement the [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter), [**IDropTarget::DragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover), and [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) methods.</span></span> <span data-ttu-id="0c7e5-397">Weitere Informationen finden Sie in der Referenz Dokumentation.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-397">For further details, see the reference documentation.</span></span>

### <a name="dragenter-method"></a><span data-ttu-id="0c7e5-398">DragEnter-Methode</span><span class="sxs-lookup"><span data-stu-id="0c7e5-398">DragEnter method</span></span>

<span data-ttu-id="0c7e5-399">Das System ruft die [**IDropTarget::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) -Methode auf, wenn der Cursor in das Zielfenster eintritt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-399">The system calls the [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) method when the cursor enters the target window.</span></span> <span data-ttu-id="0c7e5-400">Die zugehörigen Parameter stellen dem Ziel den Speicherort des Cursors, den Zustand der Tastatur-Modifizierertasten, z. b. die STRG-Taste, und einen Zeiger auf die [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) -Schnittstelle des Datenobjekts bereit.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-400">Its parameters provide the target with the location of the cursor, the state of keyboard modifier keys such as the CTRL key, and a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface.</span></span> <span data-ttu-id="0c7e5-401">Das Ziel ist dafür verantwortlich, dass diese Schnittstelle verwendet wird, um zu bestimmen, ob Sie keines der im Datenobjekt enthaltenen Formate annehmen kann.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-401">The target is responsible for using that interface to determine whether it can accept any of the formats contained by the data object.</span></span> <span data-ttu-id="0c7e5-402">Wenn dies möglich ist, bleibt der Wert von *pdweffect* normalerweise unverändert.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-402">If it can, it normally leaves the value of *pdwEffect* unchanged.</span></span> <span data-ttu-id="0c7e5-403">Wenn keine Daten aus dem Datenobjekt akzeptiert werden können, wird der Parameter *pdweffect* auf dropffect None festgelegt \_ .</span><span class="sxs-lookup"><span data-stu-id="0c7e5-403">If it cannot accept any data from the data object, it sets the *pdwEffect* parameter to DROPEFFECT\_NONE.</span></span> <span data-ttu-id="0c7e5-404">Das System übergibt den Wert dieses Parameters an die [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) -Schnittstelle des Datenobjekts, damit das entsprechende Zieh Bild angezeigt werden kann.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-404">The system passes the value of this parameter to the data object's [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) interface to allow it to display the appropriate drag image.</span></span>

<span data-ttu-id="0c7e5-405">Ziele sollten die [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) -Methode nicht verwenden, um shelldaten vor dem Löschen zu Rendering.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-405">Targets should not use the [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) method to render Shell data before it has been dropped.</span></span> <span data-ttu-id="0c7e5-406">Das vollständige Rendering der Daten des Objekts für jedes derartige vorkommen kann dazu führen, dass der Zieh Cursor nicht mehr angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-406">Fully rendering the object's data for each such occurrence might cause the drag cursor to stall.</span></span> <span data-ttu-id="0c7e5-407">Um dieses Problem zu vermeiden, enthalten einige Shellobjekte ein [cfstr \_ indragloop](clipboard.md) -Format.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-407">To avoid this problem, some Shell objects contain a [CFSTR\_INDRAGLOOP](clipboard.md) format.</span></span> <span data-ttu-id="0c7e5-408">Durch das Extrahieren dieses Formats können Ziele den Status der Drag-Schleife überprüfen und gleichzeitig das speicherintensive Rendering der Objektdaten vermeiden.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-408">By extracting this format, targets can check the status of the drag loop while avoiding memory intensive rendering of the object's data.</span></span> <span data-ttu-id="0c7e5-409">Der Datenwert des Formats ist ein **DWORD** , das auf einen Wert ungleich 0 (null) festgelegt wird, wenn sich das Datenobjekt innerhalb einer Drag-Schleife befindet.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-409">The format's data value is a **DWORD** that is set to a nonzero value if the data object is within a drag loop.</span></span> <span data-ttu-id="0c7e5-410">Der Datenwert des Formats wird auf 0 (null) festgelegt, wenn die Daten gelöscht wurden.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-410">The format's data value is set to zero if the data has been dropped.</span></span>

<span data-ttu-id="0c7e5-411">Wenn das Ziel Daten aus dem Datenobjekt akzeptieren kann, sollte es **grfkeystate** überprüfen, um zu bestimmen, ob Modifizierertasten gedrückt wurden, um das normale Ablage Verhalten zu ändern.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-411">If the target can accept data from the data object, it should examine **grfKeyState** to determine whether any modifier keys have been pressed to modify the normal drop behavior.</span></span> <span data-ttu-id="0c7e5-412">Der Standard Vorgang ist z. b. in der Regel eine Verschiebung, aber das Drücken der STRG-Taste weist normalerweise auf einen Kopiervorgang hin.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-412">For instance, the default operation is typically a move, but depressing the CTRL key usually indicates a copy operation.</span></span>

<span data-ttu-id="0c7e5-413">Während sich der Cursor über dem Zielfenster befindet, kann das Ziel das Drag & amp; [Drop-Hilfsobjekt](#using-the-drag-and-drop-helper-object) verwenden, um das Zieh Bild des Datenobjekts durch ein eigenes zu ersetzen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-413">While the cursor is over the target window, the target can use the [drag-and-drop helper object](#using-the-drag-and-drop-helper-object) to replace the data object's drag image with its own.</span></span> <span data-ttu-id="0c7e5-414">Wenn dies der Fall ist, sollte [**IDropTarget::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) [**idroptargethelper::D ragenter**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragenter) aufgerufen werden, um die in den *DragEnter* -Parametern enthaltenen Informationen an das Drag & amp; Drop-Hilfsobjekt zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-414">If so, [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) should call [**IDropTargetHelper::DragEnter**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragenter) to pass the information contained in the *DragEnter* parameters to the drag-and-drop helper object.</span></span>

### <a name="dragover-method"></a><span data-ttu-id="0c7e5-415">DragOver-Methode</span><span class="sxs-lookup"><span data-stu-id="0c7e5-415">DragOver method</span></span>

<span data-ttu-id="0c7e5-416">Wenn der Cursor innerhalb des Zielfensters bewegt wird, ruft das System regelmäßig die [**IDropTarget::D ragover**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) -Methode auf.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-416">As the cursor moves within the target window, the system periodically calls the [**IDropTarget::DragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) method.</span></span> <span data-ttu-id="0c7e5-417">Mit den zugehörigen Parametern wird das Ziel mit der Position des Cursors und dem Zustand der Tastatur Modifizierertasten, z. b. STRG-Taste, bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-417">Its parameters provide the target with the location of the cursor and the state of keyboard modifier keys such as the CTRL key.</span></span> <span data-ttu-id="0c7e5-418">**IDropTarget::D ragover** hat weitgehend dieselben Zuständigkeiten wie [**IDropTarget::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter), und die Implementierungen sind normalerweise sehr ähnlich.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-418">**IDropTarget::DragOver** has much the same responsibilities as [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter), and the implementations are usually very similar.</span></span>

<span data-ttu-id="0c7e5-419">Wenn das Ziel das Drag & amp; Drop-Hilfsobjekt verwendet, muss [**IDropTarget::D ragover**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) [**idroptargethelper::D ragover**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover) anrufen, um die in den *DragOver* -Parametern enthaltenen Informationen an das Drag & amp; Drop-Hilfsobjekt weiterzuleiten.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-419">If the target is using the drag-and-drop helper object, [**IDropTarget::DragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) should call [**IDropTargetHelper::DragOver**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover) to forward the information contained in the *DragOver* parameters to the drag-and-drop helper object.</span></span>

### <a name="drop-method"></a><span data-ttu-id="0c7e5-420">Drop-Methode</span><span class="sxs-lookup"><span data-stu-id="0c7e5-420">Drop method</span></span>

<span data-ttu-id="0c7e5-421">Das System ruft die [**IDropTarget::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) -Methode auf, um das Ziel zu benachrichtigen, dass der Benutzer die Daten gelöscht hat. Dies geschieht in der Regel durch Freigeben der Maustaste.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-421">The system calls the [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) method to notify the target that the user has dropped the data, typically by releasing the mouse button.</span></span> <span data-ttu-id="0c7e5-422">**IDropTarget::D ROP** hat dieselben Parameter wie [**IDropTarget::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter).</span><span class="sxs-lookup"><span data-stu-id="0c7e5-422">**IDropTarget::Drop** has the same parameters as [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter).</span></span> <span data-ttu-id="0c7e5-423">Das Ziel antwortet normalerweise durch Extrahieren eines oder mehrerer Formate aus dem Datenobjekt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-423">The target normally responds by extracting one or more formats from the data object.</span></span> <span data-ttu-id="0c7e5-424">Wenn der Vorgang abgeschlossen ist, sollte das Ziel den Parameter " *pdweffect* " auf einen [**dropffect**](../com/dropeffect-constants.md) -Wert festlegen, der das Ergebnis des Vorgangs angibt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-424">When finished, the target should set the *pdwEffect* parameter to a [**DROPEFFECT**](../com/dropeffect-constants.md) value that indicates the outcome of the operation.</span></span> <span data-ttu-id="0c7e5-425">Für einige Arten von shelldatenübertragungen muss das Ziel auch [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) aufrufen, um ein Format mit zusätzlichen Informationen zum Ergebnis des Vorgangs an das Datenobjekt zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-425">For some types of Shell data transfer, the target must also call [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) to pass a format with additional information on the outcome of the operation to the data object.</span></span> <span data-ttu-id="0c7e5-426">Eine ausführliche Erläuterung finden Sie unter [Handling Shell Datenübertragung Szenarios](datascenarios.md).</span><span class="sxs-lookup"><span data-stu-id="0c7e5-426">For a detailed discussion, see [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>

<span data-ttu-id="0c7e5-427">Wenn das Ziel das Drag & amp; Drop-Hilfsobjekt verwendet, sollte [**IDropTarget::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) [**idroptargethelper::D ROP**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-drop) aufgerufen werden, um die in den [**idroptargethelper::D ragover**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover) -Parametern enthaltenen Informationen an das Drag & amp; Drop Helper-Objekt weiterzuleiten.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-427">If the target is using the drag-and-drop helper object, [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) should call [**IDropTargetHelper::Drop**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-drop) to forward the information contained in the [**IDropTargetHelper::DragOver**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover) parameters to the drag-and-drop helper object.</span></span>

## <a name="using-the-drag-and-drop-helper-object"></a><span data-ttu-id="0c7e5-428">Verwenden des Drag & amp; Drop-Hilfsobjekts</span><span class="sxs-lookup"><span data-stu-id="0c7e5-428">Using the Drag-and-Drop Helper Object</span></span>

<span data-ttu-id="0c7e5-429">Das Drag & amp; Drop-Hilfsobjekt (CLSID \_ DragDropHelper) wird von der Shell exportiert, damit Ziele das Zieh Bild angeben können, während es sich über dem Zielfenster befindet.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-429">The drag-and-drop helper object (CLSID\_DragDropHelper) is exported by the Shell to allow targets to specify the drag image while it is over the target window.</span></span> <span data-ttu-id="0c7e5-430">Wenn Sie das Drag & amp; Drop-Hilfsobjekt verwenden möchten, erstellen Sie ein in-Process-Server Objekt, indem Sie [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) mit einem Klassen Bezeichner (CLSID) von CLSID \_ DragDropHelper aufrufen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-430">To use the drag-and-drop helper object, create an in-process server object by calling [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) with a class identifier (CLSID) of CLSID\_DragDropHelper.</span></span> <span data-ttu-id="0c7e5-431">Das Drag & amp; Drop-Hilfsobjekt macht zwei Schnittstellen verfügbar, die wie folgt verwendet werden:</span><span class="sxs-lookup"><span data-stu-id="0c7e5-431">The drag-and-drop helper object exposes two interfaces that are used in the following way:</span></span>

-   <span data-ttu-id="0c7e5-432">Die [**idragsourcehelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idragsourcehelper) -Schnittstelle ermöglicht dem Ablage Ziel, ein Symbol anzugeben, das das Datenobjekt darstellt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-432">The [**IDragSourceHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idragsourcehelper) interface allows the drop target to specify an icon to represent the data object.</span></span>
-   <span data-ttu-id="0c7e5-433">Die [**idroptargethelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) -Schnittstelle ermöglicht dem Ablage Ziel, das Drag & Drop-Hilfsobjekt der Cursorposition zu informieren und das Daten Symbol anzuzeigen oder auszublenden.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-433">The [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) interface allows the drop target to inform the drag-and-drop helper object of the cursor location, and to show or hide the data icon.</span></span>

### <a name="using-the-idragsourcehelper-interface"></a><span data-ttu-id="0c7e5-434">Verwenden der idragsourcehelper-Schnittstelle</span><span class="sxs-lookup"><span data-stu-id="0c7e5-434">Using the IDragSourceHelper Interface</span></span>

<span data-ttu-id="0c7e5-435">Die [**idragsourcehelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idragsourcehelper) -Schnittstelle wird vom Drag & amp; Drop-Hilfsobjekt verfügbar gemacht, damit ein Ablage Ziel das Bild bereitstellen kann, das angezeigt wird, während sich der Cursor über dem Zielfenster befindet.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-435">The [**IDragSourceHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idragsourcehelper) interface is exposed by the drag-and-drop helper object to allow a drop target to provide the image that will be displayed while the cursor is over the target window.</span></span> <span data-ttu-id="0c7e5-436">**Idragsourcehelper** bietet zwei alternative Möglichkeiten, um die Bitmap anzugeben, die als Drag-Bild verwendet werden soll:</span><span class="sxs-lookup"><span data-stu-id="0c7e5-436">**IDragSourceHelper** provides two alternative ways to specify the bitmap to be used as a drag image:</span></span>

-   <span data-ttu-id="0c7e5-437">Ablage Ziele, die über ein Fenster verfügen, können eine di \_ GetDragImage-Fenster Meldung für diese registrieren, indem Sie das Drag & amp; Drop-Hilfsobjekt mit [**idragsourcehelper:: initializefromwindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idragsourcehelper-initializefromwindow)initialisieren.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-437">Drop targets that have a window can register a DI\_GETDRAGIMAGE window message for it by initializing the drag-and-drop helper object with [**IDragSourceHelper::InitializeFromWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idragsourcehelper-initializefromwindow).</span></span> <span data-ttu-id="0c7e5-438">Wenn das Ziel eine di \_ GetDragImage-Nachricht empfängt, fügt der Handler die Bitmapinformationen des Zieh Bilds in die [**shdragimage**](/windows/desktop/api/Shobjidl_core/ns-shobjidl_core-shdragimage) -Struktur ein, die als *LPARAM* -Wert der Nachricht übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-438">When the target receives a DI\_GETDRAGIMAGE message, the handler puts the drag image bitmap information in the [**SHDRAGIMAGE**](/windows/desktop/api/Shobjidl_core/ns-shobjidl_core-shdragimage) structure that is passed as the message's *lParam* value.</span></span>
-   <span data-ttu-id="0c7e5-439">Fensterlose Ablage Ziele geben eine Bitmap an, wenn Sie das Drag & amp; Drop-Hilfsobjekt mit [**idragsourcehelper:: initializefrombitmap**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idragsourcehelper-initializefrombitmap)initialisieren.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-439">Windowless drop targets specify a bitmap when they initialize the drag-and-drop helper object with [**IDragSourceHelper::InitializeFromBitmap**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idragsourcehelper-initializefrombitmap).</span></span>

### <a name="using-the-idroptargethelper-interface"></a><span data-ttu-id="0c7e5-440">Verwenden der idroptargethelper-Schnittstelle</span><span class="sxs-lookup"><span data-stu-id="0c7e5-440">Using the IDropTargetHelper Interface</span></span>

<span data-ttu-id="0c7e5-441">Diese Schnittstelle ermöglicht dem Ablage Ziel, das Drag & amp; Drop-Hilfsobjekt zu benachrichtigen, wenn der Cursor in das Ziel wechselt oder das Ziel verlässt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-441">This interface allows the drop target to notify the drag-and-drop helper object when the cursor enters or leaves the target.</span></span> <span data-ttu-id="0c7e5-442">Während sich der Cursor über dem Zielfenster befindet, ermöglicht [**idroptargethelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) das Ziel dem Ziel, dem Drag & Drop-Hilfsobjekt die Informationen zu übergeben, die das Ziel über seine [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) -Schnittstelle empfängt.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-442">While the cursor is over the target window, [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) allows the target to give the drag-and-drop helper object the information that the target receives through its [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface.</span></span>

<span data-ttu-id="0c7e5-443">Vier der [**idroptargethelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) -Methoden –[**idroptargethelper::D ragenter**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragenter), [**idroptargethelper::D ragleave**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragleave), [**idroptargethelper::D ragover**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover)und [**idroptargethelper::D ROP**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-drop)– sind der [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) -Methode mit demselben Namen zugeordnet.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-443">Four of the [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) methods—[**IDropTargetHelper::DragEnter**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragenter), [**IDropTargetHelper::DragLeave**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragleave), [**IDropTargetHelper::DragOver**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover), and [**IDropTargetHelper::Drop**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-drop)—are associated with the [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) method of the same name.</span></span> <span data-ttu-id="0c7e5-444">Um das Drag & amp; Drop-Hilfsobjekt zu verwenden, sollte jede der **IDropTarget** -Methoden die entsprechende **idroptargethelper** -Methode zum Weiterleiten der Informationen an das Drag & amp; Drop-Hilfsobjekt abrufen.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-444">To use the drag-and-drop helper object, each of the **IDropTarget** methods should call the corresponding **IDropTargetHelper** method to forward the information to the drag-and-drop helper object.</span></span> <span data-ttu-id="0c7e5-445">Die fünfte **idroptargethelper** -Methode, [**idroptargethelper:: Show**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-show), benachrichtigt das Drag & amp; Drop-Hilfsobjekt, das Zieh Bild anzuzeigen oder auszublenden.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-445">The fifth **IDropTargetHelper** method, [**IDropTargetHelper::Show**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-show), notifies the drag-and-drop helper object to show or hide the drag image.</span></span> <span data-ttu-id="0c7e5-446">Diese Methode wird verwendet, wenn ein Zielfenster in einem Videomodus mit niedriger Farbtiefe gezogen wird.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-446">This method is used when dragging over a target window in a low color-depth video mode.</span></span> <span data-ttu-id="0c7e5-447">Dies ermöglicht es dem Ziel, das Zieh Bild beim Zeichnen des Fensters auszublenden.</span><span class="sxs-lookup"><span data-stu-id="0c7e5-447">It allows the target to hide the drag image while it is painting the window.</span></span>

 

 
