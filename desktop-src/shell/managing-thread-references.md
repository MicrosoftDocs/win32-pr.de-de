---
description: Dieser Artikel enthält Informationen zur Verwaltung von Thread verweisen mithilfe von Funktionen aus den shelllightweight-Hilfsprogrammfunktionen.
ms.assetid: d8d479fd-c45a-4dfa-b496-76abc7c09a42
title: Verwalten von Thread verweisen
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b629cd97c99e3b30e66810b5f54720d0dbb1c87d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "104979992"
---
# <a name="managing-thread-references"></a><span data-ttu-id="36172-103">Verwalten von Thread verweisen</span><span class="sxs-lookup"><span data-stu-id="36172-103">Managing Thread References</span></span>

<span data-ttu-id="36172-104">Dieser Artikel enthält Informationen zur Verwaltung von Thread verweisen mithilfe von Funktionen aus den shelllightweight-Hilfsprogrammfunktionen.</span><span class="sxs-lookup"><span data-stu-id="36172-104">This article contains information about the management of thread references using functions from the Shell lightweight utility functions.</span></span>


<span data-ttu-id="36172-105">Situationen treten auf, wenn ein übergeordneter Thread für die Lebensdauer eines untergeordneten Threads aktiv gehalten werden muss.</span><span class="sxs-lookup"><span data-stu-id="36172-105">Situations arise when a parent thread must be kept active for the lifetime of a child thread.</span></span> <span data-ttu-id="36172-106">Wenn z. bWeise ein Component Object Model (com)-Objekt auf dem übergeordneten Thread erstellt und an den untergeordneten Thread gemarshallt wird, kann dieser übergeordnete Thread nicht vor dem untergeordneten Thread beendet werden.</span><span class="sxs-lookup"><span data-stu-id="36172-106">For instance, if a Component Object Model (COM) object is created on the parent thread and marshaled to the child thread, that parent thread cannot terminate before the child thread.</span></span> <span data-ttu-id="36172-107">Um dies zu erreichen, stellt die Shell diese Funktionen bereit.</span><span class="sxs-lookup"><span data-stu-id="36172-107">To accomplish this, the Shell provides these functions.</span></span>

-   [<span data-ttu-id="36172-108">**Shkreatethlesref**</span><span class="sxs-lookup"><span data-stu-id="36172-108">**SHCreateThreadRef**</span></span>](/windows/desktop/api/Shlwapi/nf-shlwapi-shcreatethreadref)
-   [<span data-ttu-id="36172-109">**Shsetthreadref**</span><span class="sxs-lookup"><span data-stu-id="36172-109">**SHSetThreadRef**</span></span>](/windows/desktop/api/Shlwapi/nf-shlwapi-shsetthreadref)
-   [<span data-ttu-id="36172-110">**Shgetthreadref**</span><span class="sxs-lookup"><span data-stu-id="36172-110">**SHGetThreadRef**</span></span>](/windows/desktop/api/Shlwapi/nf-shlwapi-shgetthreadref)

<span data-ttu-id="36172-111">Verwenden Sie diese Funktionen in ihrem übergeordneten Thread, wie hier beschrieben.</span><span class="sxs-lookup"><span data-stu-id="36172-111">Use these functions in your parent thread as outlined here.</span></span>

1.  <span data-ttu-id="36172-112">Deklarieren Sie eine Anwendungs definierte Thread Prozedur nach der Form der [*Thread proc*](/previous-versions/windows/desktop/legacy/ms686736(v=vs.85)) -Funktion.</span><span class="sxs-lookup"><span data-stu-id="36172-112">Declare an application-defined thread procedure following the form of the [*ThreadProc*](/previous-versions/windows/desktop/legacy/ms686736(v=vs.85)) function.</span></span>

    ``` syntax
    DWORD WINAPI ThreadProc(LPVOID lpParameter);
    ```

2.  <span data-ttu-id="36172-113">Rufen Sie in [*Thread proc*](/previous-versions/windows/desktop/legacy/ms686736(v=vs.85)) [**shaliatetheinref**](/windows/desktop/api/Shlwapi/nf-shlwapi-shcreatethreadref) auf, um einen Verweis auf den Thread zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="36172-113">In your [*ThreadProc*](/previous-versions/windows/desktop/legacy/ms686736(v=vs.85)), call [**SHCreateThreadRef**](/windows/desktop/api/Shlwapi/nf-shlwapi-shcreatethreadref) to create a reference to the thread.</span></span> <span data-ttu-id="36172-114">Dadurch wird ein Zeiger auf eine Instanz von [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown)bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="36172-114">This provides a pointer to an instance of [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown).</span></span> <span data-ttu-id="36172-115">Dieses **IUnknown** verwendet den Wert, auf den *pkref* zeigt, um einen Verweis Zähler beizubehalten.</span><span class="sxs-lookup"><span data-stu-id="36172-115">This **IUnknown** uses the value pointed to by *pcRef* to maintain a reference count.</span></span> <span data-ttu-id="36172-116">Solange diese Anzahl größer als 0 ist, bleibt der Thread aktiv.</span><span class="sxs-lookup"><span data-stu-id="36172-116">As long as this count is greater than 0, the thread remains active.</span></span>
3.  <span data-ttu-id="36172-117">Wenn Sie diesen Zeiger auf [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown)verwenden, wird [**shsetthreadref**](/windows/desktop/api/Shlwapi/nf-shlwapi-shsetthreadref) in [*Thread proc*](/previous-versions/windows/desktop/legacy/ms686736(v=vs.85))aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="36172-117">Using that pointer to [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown), call [**SHSetThreadRef**](/windows/desktop/api/Shlwapi/nf-shlwapi-shsetthreadref) in your [*ThreadProc*](/previous-versions/windows/desktop/legacy/ms686736(v=vs.85)).</span></span> <span data-ttu-id="36172-118">Dadurch wird der Verweis so festgelegt, dass nachfolgende Aufrufe von [**shgetthreadref**](/windows/desktop/api/Shlwapi/nf-shlwapi-shgetthreadref) etwas abrufen können.</span><span class="sxs-lookup"><span data-stu-id="36172-118">This sets the reference so that subsequent calls to [**SHGetThreadRef**](/windows/desktop/api/Shlwapi/nf-shlwapi-shgetthreadref) have something to retrieve.</span></span>
4.  <span data-ttu-id="36172-119">Wenn Ihr [*ThreadProc*](/previous-versions/windows/desktop/legacy/ms686736(v=vs.85)) einen anderen Thread erstellt, kann *Thread proc* von Thread proc [**shgetthreadref**](/windows/desktop/api/Shlwapi/nf-shlwapi-shgetthreadref) mit dem Zeiger auf [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) aufrufen, der von [**shkreatethumref**](/windows/desktop/api/Shlwapi/nf-shlwapi-shcreatethreadref)abgerufen wurde.</span><span class="sxs-lookup"><span data-stu-id="36172-119">If your [*ThreadProc*](/previous-versions/windows/desktop/legacy/ms686736(v=vs.85)) creates another thread, that thread's *ThreadProc* can call [**SHGetThreadRef**](/windows/desktop/api/Shlwapi/nf-shlwapi-shgetthreadref) with the pointer to [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) obtained by [**SHCreateThreadRef**](/windows/desktop/api/Shlwapi/nf-shlwapi-shcreatethreadref).</span></span> <span data-ttu-id="36172-120">Dadurch wird der Verweis Zähler erhöht, auf den der *pkref* -Parameter in **shkreatethread Ref** zeigt.</span><span class="sxs-lookup"><span data-stu-id="36172-120">This increments the reference count pointed to by the *pcRef* parameter in **SHCreateThreadRef**.</span></span>
5.  <span data-ttu-id="36172-121">Erstellen Sie den Thread.</span><span class="sxs-lookup"><span data-stu-id="36172-121">Create the thread.</span></span> <span data-ttu-id="36172-122">Dies erfolgt in der Regel durch Aufrufen von " [**shcreatethread**](/windows/desktop/api/Shlwapi/nf-shlwapi-shcreatethread)", wobei ein Zeiger auf " [*ThreadProc*](/previous-versions/windows/desktop/legacy/ms686736(v=vs.85)) " im Parameter " *pfnthreadproc* " übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="36172-122">This is usually done by calling [**SHCreateThread**](/windows/desktop/api/Shlwapi/nf-shlwapi-shcreatethread), passing a pointer to your [*ThreadProc*](/previous-versions/windows/desktop/legacy/ms686736(v=vs.85)) in the *pfnThreadProc* parameter.</span></span> <span data-ttu-id="36172-123">Übergeben Sie außerdem das CTF- \_ Thread- \_ ref-Flag im *dwFlags* -Parameter.</span><span class="sxs-lookup"><span data-stu-id="36172-123">Also pass the CTF\_THREAD\_REF flag in the *dwFlags* parameter.</span></span> <span data-ttu-id="36172-124">Der Thread ist aktiv, solange *ThreadProc* ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="36172-124">The thread is active as long as *ThreadProc* is executing.</span></span>
6.  <span data-ttu-id="36172-125">Wenn ein untergeordneter Thread erstellt wird, übergeben Sie das CTF-Flag zum **\_ \_ zählen** von Verweisen im *dwFlags* -Parameter im Aufrufen an seinen [**shkreatethread**](/windows/desktop/api/Shlwapi/nf-shlwapi-shcreatethread).</span><span class="sxs-lookup"><span data-stu-id="36172-125">When a child thread is created, pass the **CTF\_REF\_COUNTED** flag in the *dwFlags* parameter in the call to its [**SHCreateThread**](/windows/desktop/api/Shlwapi/nf-shlwapi-shcreatethread).</span></span>
7.  <span data-ttu-id="36172-126">Wenn untergeordnete Threads fertiggestellt und freigegeben werden, wird der Wert, auf den die *pkref* des übergeordneten Threads zeigt, verringert.</span><span class="sxs-lookup"><span data-stu-id="36172-126">As child threads complete and are released, the value pointed to by the parent thread's *pcRef* decreases.</span></span> <span data-ttu-id="36172-127">Nachdem alle untergeordneten Threads abgeschlossen sind, kann der ursprüngliche [*ThreadProc*](/previous-versions/windows/desktop/legacy/ms686736(v=vs.85)) -Vorgang abgeschlossen werden und den endgültigen Thread Verweis freigeben, wodurch der Verweis Zähler auf 0 (null) gelöscht wird.</span><span class="sxs-lookup"><span data-stu-id="36172-127">Once all child threads are complete, the original [*ThreadProc*](/previous-versions/windows/desktop/legacy/ms686736(v=vs.85)) can complete and release the final thread reference, dropping the reference count to 0.</span></span> <span data-ttu-id="36172-128">An diesem Punkt wird der Verweis auf den ursprünglichen, von [**shkreatethread**](/windows/desktop/api/Shlwapi/nf-shlwapi-shcreatethread) geöffneten Thread freigegeben, und der Thread ist abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="36172-128">At that point, the reference to the original thread opened by [**SHCreateThread**](/windows/desktop/api/Shlwapi/nf-shlwapi-shcreatethread) is released and the thread completed.</span></span>

<span data-ttu-id="36172-129">Eine weitere verwandte Funktion ist " [**shreleasethlesref**](/windows/desktop/api/Shlwapi/nf-shlwapi-shreleasethreadref)".</span><span class="sxs-lookup"><span data-stu-id="36172-129">Another related function is [**SHReleaseThreadRef**](/windows/desktop/api/Shlwapi/nf-shlwapi-shreleasethreadref).</span></span> <span data-ttu-id="36172-130">Diese Funktion wird von [*ThreadProc*](/previous-versions/windows/desktop/legacy/ms686736(v=vs.85)) aufgerufen, wenn der Thread mithilfe von [**shkreatethread**](/windows/desktop/api/Shlwapi/nf-shlwapi-shcreatethread) mit dem **CTF- \_ Thread \_ ref** -Flag erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="36172-130">This function is called by the [*ThreadProc*](/previous-versions/windows/desktop/legacy/ms686736(v=vs.85)) if the thread has been created using [**SHCreateThread**](/windows/desktop/api/Shlwapi/nf-shlwapi-shcreatethread) with the **CTF\_THREAD\_REF** flag.</span></span> <span data-ttu-id="36172-131">*Thread proc* ist jedoch nicht erforderlich.</span><span class="sxs-lookup"><span data-stu-id="36172-131">However, the *ThreadProc* is not required to do so implicitly.</span></span> <span data-ttu-id="36172-132">Der Aufruf von [**IUnknown:: Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release) auf dem Zeiger auf [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) , der über " [**shcreatethleref**](/windows/desktop/api/Shlwapi/nf-shlwapi-shcreatethreadref) " abgerufen wurde, muss nur durchgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="36172-132">Calling [**IUnknown::Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release) on the pointer to [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) obtained through [**SHCreateThreadRef**](/windows/desktop/api/Shlwapi/nf-shlwapi-shcreatethreadref) is all that needs to be done.</span></span>

 

 
