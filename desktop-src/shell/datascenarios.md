---
description: In diesem Dokument werden gängige Szenarios für die Shell-Datenübertragung vorgestellt und erläutert, wie Sie in Ihrer Anwendung implementiert werden.
ms.assetid: 7fce555c-a93d-4414-9119-7ae9acdd4d89
title: Behandeln von Shelldatenübertragungs-Szenarien
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 35855b66e4108580d5bac305855837563ca59785
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "104977313"
---
# <a name="handling-shell-data-transfer-scenarios"></a><span data-ttu-id="8cf82-103">Behandeln von Shelldatenübertragungs-Szenarien</span><span class="sxs-lookup"><span data-stu-id="8cf82-103">Handling Shell Data Transfer Scenarios</span></span>

<span data-ttu-id="8cf82-104">Das [shelldatenobjektdokument](dataobject.md) erläutert den allgemeinen Ansatz, der zum Übertragen von shelldaten mit Drag & Drop oder der Zwischenablage verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="8cf82-104">The [Shell Data Object](dataobject.md) document discussed the general approach that is used to transfer Shell data with drag-and-drop or the Clipboard.</span></span> <span data-ttu-id="8cf82-105">Zum Implementieren von shelldatenübertragungen in Ihrer Anwendung müssen Sie jedoch auch verstehen, wie Sie diese allgemeinen Prinzipien und Techniken auf die Vielzahl von Methoden anwenden können, mit denen shelldaten übertragen werden können.</span><span class="sxs-lookup"><span data-stu-id="8cf82-105">However, to implement Shell data transfer in your application, you must also understand how to apply these general principles and techniques to the variety of ways that Shell data can be transferred.</span></span> <span data-ttu-id="8cf82-106">In diesem Dokument werden gängige Szenarios für die Shell-Datenübertragung vorgestellt und erläutert, wie Sie in Ihrer Anwendung implementiert werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-106">This document presents common Shell data transfer scenarios and discusses how to implement each one in your application.</span></span>

-   [<span data-ttu-id="8cf82-107">Allgemeine Richtlinien</span><span class="sxs-lookup"><span data-stu-id="8cf82-107">General Guidelines</span></span>](#general-guidelines)
-   [<span data-ttu-id="8cf82-108">Kopieren von Dateinamen aus der Zwischenablage in eine Anwendung</span><span class="sxs-lookup"><span data-stu-id="8cf82-108">Copying File Names from the Clipboard to an Application</span></span>](#copying-file-names-from-the-clipboard-to-an-application)
    -   [<span data-ttu-id="8cf82-109">Extrahieren der Dateinamen aus dem Datenobjekt</span><span class="sxs-lookup"><span data-stu-id="8cf82-109">Extracting the File Names from the Data Object</span></span>](#extracting-the-file-names-from-the-data-object)
-   [<span data-ttu-id="8cf82-110">Kopieren des Inhalts einer gelöschten Datei in eine Anwendung</span><span class="sxs-lookup"><span data-stu-id="8cf82-110">Copying the Contents of a Dropped File into an Application</span></span>](#copying-the-contents-of-a-dropped-file-into-an-application)
    -   [<span data-ttu-id="8cf82-111">Verwenden des cfstr \_ File Contents-Formats zum Extrahieren von Daten aus einer Datei</span><span class="sxs-lookup"><span data-stu-id="8cf82-111">Using the CFSTR\_FILECONTENTS Format to Extract Data from a File</span></span>](/windows)
-   [<span data-ttu-id="8cf82-112">Verarbeiten optimierter Verschiebungs Vorgänge</span><span class="sxs-lookup"><span data-stu-id="8cf82-112">Handling Optimized Move Operations</span></span>](#handling-optimized-move-operations)
-   [<span data-ttu-id="8cf82-113">Behandeln von Lösch Vorgängen</span><span class="sxs-lookup"><span data-stu-id="8cf82-113">Handling Delete-on-Paste Operations</span></span>](#handling-delete-on-paste-operations)
-   [<span data-ttu-id="8cf82-114">Übertragen von Daten in und aus virtuellen Ordnern</span><span class="sxs-lookup"><span data-stu-id="8cf82-114">Transfering Data to and from Virtual Folders</span></span>](#transfering-data-to-and-from-virtual-folders)
    -   [<span data-ttu-id="8cf82-115">Akzeptieren von Daten aus einem virtuellen Ordner</span><span class="sxs-lookup"><span data-stu-id="8cf82-115">Accepting Data from a Virtual Folder</span></span>](#accepting-data-from-a-virtual-folder)
    -   [<span data-ttu-id="8cf82-116">Übertragen von Daten in eine und aus einer Namespace Erweiterung</span><span class="sxs-lookup"><span data-stu-id="8cf82-116">Transferring Data to and from a NameSpace Extension</span></span>](#transferring-data-to-and-from-a-namespace-extension)
-   [<span data-ttu-id="8cf82-117">Löschen von Dateien im Papierkorb</span><span class="sxs-lookup"><span data-stu-id="8cf82-117">Dropping Files on the Recycle Bin</span></span>](#dropping-files-on-the-recycle-bin)
-   [<span data-ttu-id="8cf82-118">Erstellen und Importieren von Schrott Dateien</span><span class="sxs-lookup"><span data-stu-id="8cf82-118">Creating and Importing Scrap Files</span></span>](#creating-and-importing-scrap-files)
    -   [<span data-ttu-id="8cf82-119">Roundtrip-Unterstützung</span><span class="sxs-lookup"><span data-stu-id="8cf82-119">Round-trip Support</span></span>](#round-trip-support)
    -   [<span data-ttu-id="8cf82-120">Zwischengespeicherte Datenformate</span><span class="sxs-lookup"><span data-stu-id="8cf82-120">Cached Data Formats</span></span>](#cached-data-formats)
    -   [<span data-ttu-id="8cf82-121">Verzögertes Rendering</span><span class="sxs-lookup"><span data-stu-id="8cf82-121">Delayed Rendering</span></span>](#delayed-rendering)
-   [<span data-ttu-id="8cf82-122">Asynchrones ziehen und Ablegen von shellobjekten</span><span class="sxs-lookup"><span data-stu-id="8cf82-122">Dragging and Dropping Shell Objects Asynchronously</span></span>](#dragging-and-dropping-shell-objects-asynchronously)
    -   [<span data-ttu-id="8cf82-123">Verwenden von iasyncoperation/idataobjectasynccapability</span><span class="sxs-lookup"><span data-stu-id="8cf82-123">Using IASyncOperation/IDataObjectAsyncCapability</span></span>](#using-iasyncoperationidataobjectasynccapability)

> [!Note]  
> <span data-ttu-id="8cf82-124">Obwohl in jedem dieser Szenarien eine bestimmte Datenübertragungs Operation erläutert wird, gelten viele davon für eine Reihe von verwandten Szenarios.</span><span class="sxs-lookup"><span data-stu-id="8cf82-124">Although each of these scenarios discusses a specific data transfer operation, many of them apply to a variety of related scenarios.</span></span> <span data-ttu-id="8cf82-125">Der primäre Unterschied zwischen den meisten Zwischenablage-und Drag & Drop-Übertragungen ist beispielsweise die Art und Weise, in der das Datenobjekt beim Ziel ankommt.</span><span class="sxs-lookup"><span data-stu-id="8cf82-125">For instance, the primary difference between most Clipboard and drag-and-drop transfers is in how the data object arrives at the target.</span></span> <span data-ttu-id="8cf82-126">Wenn das Ziel über einen Zeiger auf die [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) -Schnittstelle des Datenobjekts verfügt, sind die Verfahren zum Extrahieren von Informationen größtenteils identisch für beide Daten Übertragungs Typen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-126">Once the target has a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface, the procedures for extracting information are largely the same for both types of data transfer.</span></span> <span data-ttu-id="8cf82-127">Einige der Szenarien sind jedoch auf eine bestimmte Art von Vorgang beschränkt.</span><span class="sxs-lookup"><span data-stu-id="8cf82-127">However, some of the scenarios are limited to a specific type of operation.</span></span> <span data-ttu-id="8cf82-128">Ausführliche Informationen finden Sie in den einzelnen Szenarios.</span><span class="sxs-lookup"><span data-stu-id="8cf82-128">Refer to the individual scenario for details.</span></span>

 

## <a name="general-guidelines"></a><span data-ttu-id="8cf82-129">Allgemeine Richtlinien</span><span class="sxs-lookup"><span data-stu-id="8cf82-129">General Guidelines</span></span>

<span data-ttu-id="8cf82-130">In den folgenden Abschnitten wird ein einzelnes, relativ spezifisches Datenübertragungs Szenario erläutert.</span><span class="sxs-lookup"><span data-stu-id="8cf82-130">Each of the following sections discusses a single, fairly specific data transfer scenario.</span></span> <span data-ttu-id="8cf82-131">Allerdings sind Datenübertragungen oft komplexer und können Aspekte mehrerer Szenarien beinhalten.</span><span class="sxs-lookup"><span data-stu-id="8cf82-131">However, data transfers are often more complex and might involve aspects of several scenarios.</span></span> <span data-ttu-id="8cf82-132">In der Regel wissen Sie im Voraus nicht, welches Szenario Sie tatsächlich behandeln müssen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-132">You typically do not know, in advance, which scenario you will actually need to handle.</span></span> <span data-ttu-id="8cf82-133">Im folgenden finden Sie einige allgemeine Richtlinien, die Sie berücksichtigen sollten.</span><span class="sxs-lookup"><span data-stu-id="8cf82-133">Here are a few general guidelines to keep in mind.</span></span>

<span data-ttu-id="8cf82-134">Für Datenquellen:</span><span class="sxs-lookup"><span data-stu-id="8cf82-134">For data sources:</span></span>

-   <span data-ttu-id="8cf82-135">Die shellzwischenablage Formate mit Ausnahme von [CF \_ HDROP](clipboard.md)sind nicht vordefiniert.</span><span class="sxs-lookup"><span data-stu-id="8cf82-135">The Shell Clipboard formats, with the exception of [CF\_HDROP](clipboard.md), are not predefined.</span></span> <span data-ttu-id="8cf82-136">Jedes Format, das Sie verwenden möchten, muss durch Aufrufen von [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata)registriert werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-136">Each format you want to use must be registered by calling [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata).</span></span>
-   <span data-ttu-id="8cf82-137">Die Formate in den Datenobjekten werden in der von der Quelle bevorzugten Reihenfolge bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="8cf82-137">The formats in the data objects are provided in the order of preference from the source.</span></span> <span data-ttu-id="8cf82-138">Zählen Sie das Datenobjekt auf, und wählen Sie das erste aus, das Sie verwenden können.</span><span class="sxs-lookup"><span data-stu-id="8cf82-138">Enumerate the data object and pick the first one you can consume.</span></span>
-   <span data-ttu-id="8cf82-139">Schließen Sie beliebig viele Formate ein, die Sie unterstützen können.</span><span class="sxs-lookup"><span data-stu-id="8cf82-139">Include as many formats as you can support.</span></span> <span data-ttu-id="8cf82-140">Im allgemeinen wissen Sie nicht, wo das Datenobjekt gelöscht wird.</span><span class="sxs-lookup"><span data-stu-id="8cf82-140">You generally do not know where the data object will be dropped.</span></span> <span data-ttu-id="8cf82-141">Diese Vorgehensweise verbessert die Wahrscheinlichkeit, dass das Datenobjekt ein Format enthält, das das Ablage Ziel annehmen kann.</span><span class="sxs-lookup"><span data-stu-id="8cf82-141">This practice improves the odds that the data object will contain a format that the drop target can accept.</span></span>
-   <span data-ttu-id="8cf82-142">Vorhandene Dateien sollten im [CF- \_ HDROP](clipboard.md) -Format angeboten werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-142">Existing files should be offered with the [CF\_HDROP](clipboard.md) format.</span></span>
-   <span data-ttu-id="8cf82-143">Stellen Sie Datei ähnliche Daten mit [cfstr file \_ Content](clipboard.md) / [cfstr \_ Filedescriptor](clipboard.md) -Formaten zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="8cf82-143">Offer file-like data with [CFSTR\_FILECONTENTS](clipboard.md)/[CFSTR\_FILEDESCRIPTOR](clipboard.md) formats.</span></span> <span data-ttu-id="8cf82-144">Diese Vorgehensweise ermöglicht es dem Ziel, eine Datei aus einem Datenobjekt zu erstellen, ohne dass Informationen über den zugrunde liegenden Datenspeicher benötigt werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-144">This approach allows the target to create a file from a data object without needing to know anything about the underlying data storage.</span></span> <span data-ttu-id="8cf82-145">Normalerweise sollten Sie die Daten als [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) -Schnittstelle darstellen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-145">You should normally present the data as an [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) interface.</span></span> <span data-ttu-id="8cf82-146">Dieser Datenübertragungsmechanismus ist flexibler als ein globales Speicher Objekt und beansprucht viel weniger Arbeitsspeicher.</span><span class="sxs-lookup"><span data-stu-id="8cf82-146">This data transfer mechanism is more flexible than a global memory object and uses much less memory.</span></span>
-   <span data-ttu-id="8cf82-147">Drag sources sollte beim Ziehen von shellelementen das Format [cfstr \_ shellidlist](clipboard.md) bieten.</span><span class="sxs-lookup"><span data-stu-id="8cf82-147">Drag sources should offer the [CFSTR\_SHELLIDLIST](clipboard.md) format when dragging Shell items.</span></span> <span data-ttu-id="8cf82-148">Datenobjekte für Elemente können entweder über die [**IShellFolder:: getuiobjectof**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getuiobjectof) -Methode oder die [**IShellItem:: bindtohandler**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellitem-bindtohandler) -Methode abgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-148">Data objects for items can be acquired through either the [**IShellFolder::GetUIObjectOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getuiobjectof) or [**IShellItem::BindToHandler**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellitem-bindtohandler) methods.</span></span> <span data-ttu-id="8cf82-149">Datenquellen können eine standardmäßige Datenobjekt Implementierung erstellen, die das Format [cfstr \_ shellidlist](clipboard.md) mithilfe von [**shkreatedataobject**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shcreatedataobject)unterstützt.</span><span class="sxs-lookup"><span data-stu-id="8cf82-149">Data sources can create a standard data object implementation that supports the [CFSTR\_SHELLIDLIST](clipboard.md) format by using [**SHCreateDataObject**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shcreatedataobject).</span></span>
-   <span data-ttu-id="8cf82-150">Ablage Ziele, die die Elemente, die mit dem shellelement-Programmiermodell gezogen werden, als Grund für Elemente verwenden möchten, können ein IDataObject mithilfe von [**shkreateshellitemarrayfromdataobject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-shcreateshellitemarrayfromdataobject)in ein [**ishellitemarray**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellitemarray) konvertieren.</span><span class="sxs-lookup"><span data-stu-id="8cf82-150">Drop targets that want to reason about the items being dragged using the shell item programming model can convert an IDataObject into an [**IShellItemArray**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellitemarray) using [**SHCreateShellItemArrayFromDataObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-shcreateshellitemarrayfromdataobject).</span></span>
-   <span data-ttu-id="8cf82-151">Standard-Feedback Cursor verwenden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-151">Use standard feedback cursors.</span></span>
-   <span data-ttu-id="8cf82-152">Unterstützung von left und Right Drag.</span><span class="sxs-lookup"><span data-stu-id="8cf82-152">Support left and right drag.</span></span>
-   <span data-ttu-id="8cf82-153">Verwenden Sie das Datenobjekt selbst aus einem eingebetteten Objekt.</span><span class="sxs-lookup"><span data-stu-id="8cf82-153">Use the data object itself from an embedded object.</span></span> <span data-ttu-id="8cf82-154">Diese Vorgehensweise ermöglicht es Ihrer Anwendung, beliebige zusätzliche Formate abzurufen, die das Datenobjekt bereitstellen muss, und vermeidet eine zusätzliche Ebene der Kapselung.</span><span class="sxs-lookup"><span data-stu-id="8cf82-154">This approach allows your application to retrieve any extra formats the data object has to offer and avoids creating an extra layer of containment.</span></span> <span data-ttu-id="8cf82-155">Beispielsweise wird ein eingebettetes Objekt von Server a aus Server/Container B gezogen und für den Container C gelöscht. c sollte ein eingebettetes Objekt von Server a erstellen, kein eingebettetes Objekt von Server B, das ein eingebettetes Objekt von Server a enthält.</span><span class="sxs-lookup"><span data-stu-id="8cf82-155">For instance, an embedded object from server A is dragged from server/container B and dropped on container C. C should create an embedded object of server A, not an embedded object of server B containing an embedded object of server A.</span></span>
-   <span data-ttu-id="8cf82-156">Beachten Sie, dass die Shell beim Verschieben von Dateien [optimierte](#handling-optimized-move-operations) Verschiebe [-oder Lösch](#handling-delete-on-paste-operations) Vorgänge verwenden kann.</span><span class="sxs-lookup"><span data-stu-id="8cf82-156">Remember that the Shell might use [optimized moves](#handling-optimized-move-operations) or [delete-on-paste](#handling-delete-on-paste-operations) operations when moving files.</span></span> <span data-ttu-id="8cf82-157">Die Anwendung sollte diese Vorgänge erkennen und entsprechend reagieren können.</span><span class="sxs-lookup"><span data-stu-id="8cf82-157">Your application should be able to recognize these operations and respond appropriately.</span></span>

<span data-ttu-id="8cf82-158">Für Datenziele:</span><span class="sxs-lookup"><span data-stu-id="8cf82-158">For data targets:</span></span>

-   <span data-ttu-id="8cf82-159">Die shellzwischenablage Formate mit Ausnahme von [CF \_ HDROP](clipboard.md)sind nicht vordefiniert.</span><span class="sxs-lookup"><span data-stu-id="8cf82-159">The Shell Clipboard formats, with the exception of [CF\_HDROP](clipboard.md), are not predefined.</span></span> <span data-ttu-id="8cf82-160">Jedes Format, das Sie verwenden möchten, muss durch Aufrufen von [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata)registriert werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-160">Each format you want to use must be registered by calling [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata).</span></span>
-   <span data-ttu-id="8cf82-161">Implementieren und Registrieren eines OLE Drop-Ziels.</span><span class="sxs-lookup"><span data-stu-id="8cf82-161">Implement and register an OLE drop target.</span></span> <span data-ttu-id="8cf82-162">Vermeiden Sie nach Möglichkeit die Verwendung von Windows 3,1-Zielen oder der [**WM- \_ dropfiles**](wm-dropfiles.md) -Nachricht.</span><span class="sxs-lookup"><span data-stu-id="8cf82-162">Avoid using Windows 3.1 targets or the [**WM\_DROPFILES**](wm-dropfiles.md) message, if possible.</span></span>
-   <span data-ttu-id="8cf82-163">Die Formate, die in einem Datenobjekt enthalten sind, variieren in Abhängigkeit davon, woher das Objekt stammt.</span><span class="sxs-lookup"><span data-stu-id="8cf82-163">The formats contained by a data object vary, depending on where the object comes from.</span></span> <span data-ttu-id="8cf82-164">Da Sie im Allgemeinen nicht wissen, wo ein Datenobjekt stammt, gehen Sie nicht davon aus, dass ein bestimmtes Format vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="8cf82-164">Since you generally do not know in advance where a data object comes from, do not assume that a particular format will be present.</span></span> <span data-ttu-id="8cf82-165">Das Datenobjekt sollte die Formate in der Reihenfolge der Qualität auflisten, beginnend mit dem besten.</span><span class="sxs-lookup"><span data-stu-id="8cf82-165">The data object should enumerate the formats in order of quality, starting with the best.</span></span> <span data-ttu-id="8cf82-166">Um also das beste verfügbare Format zu erhalten, zählen Anwendungen normalerweise zu den verfügbaren Formaten und verwenden das erste Format in der Enumeration, das Sie unterstützen können.</span><span class="sxs-lookup"><span data-stu-id="8cf82-166">Thus, to get the best available format, applications normally enumerate the available formats and use the first format in the enumeration that they can support.</span></span>
-   <span data-ttu-id="8cf82-167">Unterstützung für den rechten Zieh Vorgang.</span><span class="sxs-lookup"><span data-stu-id="8cf82-167">Support right-drag.</span></span> <span data-ttu-id="8cf82-168">Sie können das Kontextmenü des Zieh Vorgangs anpassen, indem Sie einen [Drag & Drop-Handler](context-menu-handlers.md)erstellen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-168">You can customize the drag shortcut menu by creating a [drag-and-drop handler](context-menu-handlers.md).</span></span>
-   <span data-ttu-id="8cf82-169">Wenn Ihre Anwendung vorhandene Dateien annimmt, muss Sie in der Lage sein, das [CF- \_ HDROP](clipboard.md) -Format zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="8cf82-169">If your application will accept existing files, it must be able to handle the [CF\_HDROP](clipboard.md) format.</span></span>
-   <span data-ttu-id="8cf82-170">Im Allgemeinen sollten Anwendungen, die Dateien akzeptieren, auch die cfstr [ \_ FileContent](clipboard.md)- / [ \_ Filedescriptor](clipboard.md) -Formate verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="8cf82-170">In general, applications that accept files should also handle the [CFSTR\_FILECONTENTS](clipboard.md)/[CFSTR\_FILEDESCRIPTOR](clipboard.md) formats.</span></span> <span data-ttu-id="8cf82-171">Obwohl Dateien aus dem Dateisystem das [CF- \_ HDROP](clipboard.md) -Format aufweisen, verwenden Dateien von Anbietern, wie z. b. Namespace Erweiterungen, in der Regel [cfstr \_ FileContent](clipboard.md) / [cfstr \_ Filedescriptor](clipboard.md).</span><span class="sxs-lookup"><span data-stu-id="8cf82-171">While files from the file system have the [CF\_HDROP](clipboard.md) format, files from providers such as namespace extensions generally use [CFSTR\_FILECONTENTS](clipboard.md)/[CFSTR\_FILEDESCRIPTOR](clipboard.md).</span></span> <span data-ttu-id="8cf82-172">Beispiele hierfür sind Windows CE Ordner, File Transfer Protocol (FTP)-Ordner, Webordner und CAB-Ordner.</span><span class="sxs-lookup"><span data-stu-id="8cf82-172">Examples include Windows CE folders, File Transfer Protocol (FTP) folders, web folders, and CAB folders.</span></span> <span data-ttu-id="8cf82-173">Die Quelle implementiert normalerweise eine [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) -Schnittstelle, um Daten aus Ihrem Speicher als Datei darzustellen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-173">The source normally implements an [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) interface to present data from its storage as a file.</span></span>
-   <span data-ttu-id="8cf82-174">Beachten Sie, dass die Shell beim Verschieben von Dateien [optimierte](#handling-optimized-move-operations) Verschiebe [-oder Lösch](#handling-delete-on-paste-operations) Vorgänge verwenden kann.</span><span class="sxs-lookup"><span data-stu-id="8cf82-174">Remember that the Shell might use [optimized moves](#handling-optimized-move-operations) or [delete-on-paste](#handling-delete-on-paste-operations) operations when moving files.</span></span> <span data-ttu-id="8cf82-175">Die Anwendung sollte diese Vorgänge erkennen und entsprechend reagieren können.</span><span class="sxs-lookup"><span data-stu-id="8cf82-175">Your application should be able to recognize these operations and respond appropriately.</span></span>

## <a name="copying-file-names-from-the-clipboard-to-an-application"></a><span data-ttu-id="8cf82-176">Kopieren von Dateinamen aus der Zwischenablage in eine Anwendung</span><span class="sxs-lookup"><span data-stu-id="8cf82-176">Copying File Names from the Clipboard to an Application</span></span>

<span data-ttu-id="8cf82-177">**Szenario:** Ein Benutzer wählt eine oder mehrere Dateien im Windows-Explorer aus und kopiert sie in die Zwischenablage.</span><span class="sxs-lookup"><span data-stu-id="8cf82-177">**Scenario:** A user selects one or more files in Windows Explorer and copies them to the Clipboard.</span></span> <span data-ttu-id="8cf82-178">Die Anwendung extrahiert die Dateinamen und fügt Sie in das Dokument ein.</span><span class="sxs-lookup"><span data-stu-id="8cf82-178">Your application extracts the file names and pastes them into the document.</span></span>

<span data-ttu-id="8cf82-179">Dieses Szenario könnte beispielsweise verwendet werden, um es einem Benutzer zu ermöglichen, einen HTML-Link zu erstellen, indem Sie die Datei Ausschnitten und in Ihre Anwendung einfügen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-179">This scenario could be used, for instance, to allow a user to create an HTML link by cutting and pasting the file to your application.</span></span> <span data-ttu-id="8cf82-180">Die Anwendung kann dann den Dateinamen aus dem Datenobjekt extrahieren und verarbeiten, um ein Anchor-Tag zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-180">Your application can then extract the file name from the data object and process it to create an anchor tag.</span></span>

<span data-ttu-id="8cf82-181">Wenn ein Benutzer eine Datei in Windows-Explorer auswählt und in die Zwischenablage kopiert, erstellt die Shell ein Datenobjekt.</span><span class="sxs-lookup"><span data-stu-id="8cf82-181">When a user selects a file in Windows Explorer and copies it to the Clipboard, the Shell creates a data object.</span></span> <span data-ttu-id="8cf82-182">Anschließend wird [**OleSetClipboard**](/windows/win32/api/ole2/nf-ole2-olesetclipboard) aufgerufen, um einen Zeiger auf die [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) -Schnittstelle des Datenobjekts in der Zwischenablage zu platzieren.</span><span class="sxs-lookup"><span data-stu-id="8cf82-182">It then calls [**OleSetClipboard**](/windows/win32/api/ole2/nf-ole2-olesetclipboard) to place a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface on the Clipboard.</span></span>

<span data-ttu-id="8cf82-183">Wenn der Benutzer den Befehl **Einfügen** aus dem Menü oder der Symbolleiste Ihrer Anwendung auswählt:</span><span class="sxs-lookup"><span data-stu-id="8cf82-183">When the user selects the **Paste** command from your application's menu or toolbar:</span></span>

1.  <span data-ttu-id="8cf82-184">Rufen Sie [**olegetclipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard) auf, um die [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) -Schnittstelle des Datenobjekts abzurufen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-184">Call [**OleGetClipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard) to retrieve the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface.</span></span>
2.  <span data-ttu-id="8cf82-185">Rufen Sie [**IDataObject:: EnumFormatEtc**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc) auf, um ein Enumeratorobjekt anzufordern.</span><span class="sxs-lookup"><span data-stu-id="8cf82-185">Call [**IDataObject::EnumFormatEtc**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc) to request an enumerator object.</span></span>
3.  <span data-ttu-id="8cf82-186">Verwenden Sie die [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) -Schnittstelle des Enumeratorobjekts, um die Formate aufzulisten, die im Datenobjekt enthalten sind.</span><span class="sxs-lookup"><span data-stu-id="8cf82-186">Use the enumerator object's [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) interface to enumerate the formats contained by the data object.</span></span>

> [!Note]  
> <span data-ttu-id="8cf82-187">Die letzten beiden Schritte in diesem Verfahren sind aus Gründen der Vollständigkeit enthalten.</span><span class="sxs-lookup"><span data-stu-id="8cf82-187">The final two steps in this procedure are included for completeness.</span></span> <span data-ttu-id="8cf82-188">Sie sind in der Regel für einfache Dateiübertragungen nicht erforderlich.</span><span class="sxs-lookup"><span data-stu-id="8cf82-188">They are typically not necessary for simple file transfers.</span></span> <span data-ttu-id="8cf82-189">Alle Datenobjekte, die für diesen Datentyp verwendet werden, sollten das [CF- \_ HDROP](clipboard.md) -Format enthalten, das verwendet werden kann, um die Namen der Dateien zu bestimmen, die im Objekt enthalten sind.</span><span class="sxs-lookup"><span data-stu-id="8cf82-189">All data objects used for this type of data transfer should contain the [CF\_HDROP](clipboard.md) format, which can be used to determine the names of the files contained by the object.</span></span> <span data-ttu-id="8cf82-190">Bei allgemeineren Datenübertragungen sollten Sie jedoch die Formate auflisten und das beste auswählen, das von Ihrer Anwendung verarbeitet werden kann.</span><span class="sxs-lookup"><span data-stu-id="8cf82-190">However, for more general data transfers, you should enumerate the formats and select the best one that your application can handle.</span></span>

 

### <a name="extracting-the-file-names-from-the-data-object"></a><span data-ttu-id="8cf82-191">Extrahieren der Dateinamen aus dem Datenobjekt</span><span class="sxs-lookup"><span data-stu-id="8cf82-191">Extracting the File Names from the Data Object</span></span>

<span data-ttu-id="8cf82-192">Der nächste Schritt besteht darin, einen oder mehrere Dateinamen aus dem Datenobjekt zu extrahieren und in Ihre Anwendung einzufügen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-192">The next step is to extract one or more file names from the data object and paste them into your application.</span></span> <span data-ttu-id="8cf82-193">Beachten Sie, dass das in diesem Abschnitt beschriebene Verfahren zum Extrahieren eines Datei namens aus einem Datenobjekt auch für Drag & Drop-Übertragungen gilt.</span><span class="sxs-lookup"><span data-stu-id="8cf82-193">Note that the procedure discussed in this section for extracting a file name from a data object applies equally well to drag-and-drop transfers.</span></span>

<span data-ttu-id="8cf82-194">Die einfachste Methode zum Abrufen von Dateinamen aus einem Datenobjekt ist das [CF- \_ HDROP](clipboard.md) -Format:</span><span class="sxs-lookup"><span data-stu-id="8cf82-194">The simplest way to retrieve file names from a data object is the [CF\_HDROP](clipboard.md) format:</span></span>

1.  <span data-ttu-id="8cf82-195">Aufrufen von [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata).</span><span class="sxs-lookup"><span data-stu-id="8cf82-195">Call [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata).</span></span> <span data-ttu-id="8cf82-196">Legen Sie **den cfFormat** -Member [**der FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) -Struktur auf [CF \_ HDROP](clipboard.md) und den **TYMED** -Member auf [TYMED \_ HGLOBAL](dataobject.md)fest.</span><span class="sxs-lookup"><span data-stu-id="8cf82-196">Set the **cfFormat** member of the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure to [CF\_HDROP](clipboard.md) and the **tymed** member to [TYMED\_HGLOBAL](dataobject.md).</span></span> <span data-ttu-id="8cf82-197">Der **dwAspect** -Member ist normalerweise auf den dvaspesinhalt festgelegt \_ .</span><span class="sxs-lookup"><span data-stu-id="8cf82-197">The **dwAspect** member is normally set to DVASPECT\_CONTENT.</span></span> <span data-ttu-id="8cf82-198">Wenn Sie jedoch den Pfad der Datei im kurzen Format (8,3) benötigen, legen Sie **dwAspect** auf dvaspekt Short fest \_ .</span><span class="sxs-lookup"><span data-stu-id="8cf82-198">However, if you need to have the file's path in short (8.3) format, set **dwAspect** to DVASPECT\_SHORT.</span></span>

    <span data-ttu-id="8cf82-199">Wenn [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) zurückgibt, verweist der **HGLOBAL** -Member der [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) -Struktur auf ein globales Speicher Objekt, das die Daten enthält.</span><span class="sxs-lookup"><span data-stu-id="8cf82-199">When [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) returns, the **hGlobal** member of the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure points to a global memory object that contains the data.</span></span>

2.  <span data-ttu-id="8cf82-200">Erstellen Sie eine HDROP-Variable, und legen Sie Sie auf den **HGLOBAL** -Member der [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) -Struktur fest.</span><span class="sxs-lookup"><span data-stu-id="8cf82-200">Create an HDROP variable and set it to the **hGlobal** member of the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span> <span data-ttu-id="8cf82-201">Die HDROP-Variable ist nun ein Handle für eine [**dropfiles**](/windows/desktop/api/shlobj_core/ns-shlobj_core-dropfiles) -Struktur, auf die eine Double-NULL-terminierte Zeichenfolge mit den voll qualifizierten Dateipfaden der kopierten Dateien folgt.</span><span class="sxs-lookup"><span data-stu-id="8cf82-201">The HDROP variable is now a handle to a [**DROPFILES**](/windows/desktop/api/shlobj_core/ns-shlobj_core-dropfiles) structure followed by a double null-terminated string containing the fully qualified file paths of the copied files.</span></span>
3.  <span data-ttu-id="8cf82-202">Bestimmen Sie, wie viele Dateipfade in der Liste aufgeführt sind, indem Sie [**dragqueryfile**](/windows/desktop/api/Shellapi/nf-shellapi-dragqueryfilea) aufrufen, wobei der *ifile* -Parameter auf 0xFFFFFFFF festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="8cf82-202">Determine how many file paths are in the list by calling [**DragQueryFile**](/windows/desktop/api/Shellapi/nf-shellapi-dragqueryfilea) with the *iFile* parameter set to 0xFFFFFFFF.</span></span> <span data-ttu-id="8cf82-203">Die-Funktion gibt die Anzahl der Dateipfade in der Liste zurück.</span><span class="sxs-lookup"><span data-stu-id="8cf82-203">The function returns the number of file paths in the list.</span></span> <span data-ttu-id="8cf82-204">Der null basierte Index des Dateipfads in dieser Liste wird im nächsten Schritt verwendet, um einen bestimmten Pfad zu identifizieren.</span><span class="sxs-lookup"><span data-stu-id="8cf82-204">The file path's zero-based index in this list is used in the next step to identify a particular path.</span></span>
4.  <span data-ttu-id="8cf82-205">Extrahieren Sie die Dateipfade aus dem globalen Speicher Objekt, indem Sie [**dragqueryfile**](/windows/desktop/api/Shellapi/nf-shellapi-dragqueryfilea) einmal für jede Datei aufrufen, wobei *ifile* auf den Index der Datei festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="8cf82-205">Extract the file paths from the global memory object by calling [**DragQueryFile**](/windows/desktop/api/Shellapi/nf-shellapi-dragqueryfilea) once for each file, with *iFile* set to the file's index.</span></span>
5.  <span data-ttu-id="8cf82-206">Verarbeiten Sie die Dateipfade nach Bedarf, und fügen Sie Sie in Ihre Anwendung ein.</span><span class="sxs-lookup"><span data-stu-id="8cf82-206">Process the file paths as needed and paste them into your application.</span></span>
6.  <span data-ttu-id="8cf82-207">Aufrufen von [**ReleaseStgMedium**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) und übergeben des Zeigers an die [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) -Struktur, die Sie in Schritt 1 an [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) übergeben haben.</span><span class="sxs-lookup"><span data-stu-id="8cf82-207">Call [**ReleaseStgMedium**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) and pass in the pointer to the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure that you passed to [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) in step 1.</span></span> <span data-ttu-id="8cf82-208">Nachdem Sie die Struktur freigegeben haben, ist der HDROP-Wert, den Sie in Schritt 2 erstellt haben, nicht mehr gültig und sollte nicht verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-208">Once you have released the structure, the HDROP value that you created in step 2 is no longer valid and should not be used.</span></span>

## <a name="copying-the-contents-of-a-dropped-file-into-an-application"></a><span data-ttu-id="8cf82-209">Kopieren des Inhalts einer gelöschten Datei in eine Anwendung</span><span class="sxs-lookup"><span data-stu-id="8cf82-209">Copying the Contents of a Dropped File into an Application</span></span>

<span data-ttu-id="8cf82-210">**Szenario:** Ein Benutzer zieht eine oder mehrere Dateien aus Windows-Explorer und löscht Sie im Fenster Ihrer Anwendung.</span><span class="sxs-lookup"><span data-stu-id="8cf82-210">**Scenario:** A user drags one or more files from Windows Explorer and drops them on your application's window.</span></span> <span data-ttu-id="8cf82-211">Die Anwendung extrahiert den Inhalt der Datei (en) und fügt Sie in die Anwendung ein.</span><span class="sxs-lookup"><span data-stu-id="8cf82-211">Your application extracts the content of the file (s) and pastes it into the application.</span></span>

<span data-ttu-id="8cf82-212">In diesem Szenario werden Drag & Drop verwendet, um die Dateien aus Windows-Explorer in die Anwendung zu übertragen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-212">This scenario uses drag-and-drop to transfer the files from Windows Explorer to the application.</span></span> <span data-ttu-id="8cf82-213">Vor dem-Vorgang muss Ihre Anwendung folgende Aktionen ausführen:</span><span class="sxs-lookup"><span data-stu-id="8cf82-213">Prior to the operation, your application must:</span></span>

1.  <span data-ttu-id="8cf82-214">Wenden Sie [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) an, um alle benötigten shellzwischenablage Formate zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="8cf82-214">Call [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) to register any needed Shell Clipboard formats.</span></span>
2.  <span data-ttu-id="8cf82-215">Wenden Sie [**RegisterDragDrop**](/windows/win32/api/ole2/nf-ole2-registerdragdrop) an, um ein Zielfenster und die [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) -Schnittstelle Ihrer Anwendung zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="8cf82-215">Call [**RegisterDragDrop**](/windows/win32/api/ole2/nf-ole2-registerdragdrop) to register a target window and your application's [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface.</span></span>

<span data-ttu-id="8cf82-216">Nachdem der Benutzer den Vorgang initiiert hat, wählen Sie eine oder mehrere Dateien aus, und ziehen Sie die folgenden Schritte:</span><span class="sxs-lookup"><span data-stu-id="8cf82-216">After the user initiates the operation by selecting one or more files and starting to drag them:</span></span>

1.  <span data-ttu-id="8cf82-217">Windows-Explorer erstellt ein Datenobjekt und lädt die unterstützten Formate in dieses Objekt.</span><span class="sxs-lookup"><span data-stu-id="8cf82-217">Windows Explorer creates a data object and loads the supported formats into it.</span></span>
2.  <span data-ttu-id="8cf82-218">Windows-Explorer ruft [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) auf, um die Drag-Schleife zu initiieren.</span><span class="sxs-lookup"><span data-stu-id="8cf82-218">Windows Explorer calls [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) to initiate the drag loop.</span></span>
3.  <span data-ttu-id="8cf82-219">Wenn das Zieh Bild das Zielfenster erreicht, benachrichtigt das System Sie durch Aufrufen von [**IDropTarget::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter).</span><span class="sxs-lookup"><span data-stu-id="8cf82-219">When the drag image reaches your target window, the system notifies you by calling [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter).</span></span>
4.  <span data-ttu-id="8cf82-220">Um zu ermitteln, was das Datenobjekt enthält, rufen Sie die [**IDataObject:: EnumFormatEtc**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc) -Methode des Datenobjekts auf.</span><span class="sxs-lookup"><span data-stu-id="8cf82-220">To determine what the data object contains, call the data object's [**IDataObject::EnumFormatEtc**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc) method.</span></span> <span data-ttu-id="8cf82-221">Verwenden Sie das von der-Methode zurückgegebene Enumeratorobjekt, um die Formate aufzulisten, die im Datenobjekt enthalten sind.</span><span class="sxs-lookup"><span data-stu-id="8cf82-221">Use the enumerator object returned by the method to enumerate the formats contained by the data object.</span></span> <span data-ttu-id="8cf82-222">Wenn die Anwendung keines dieser Formate akzeptieren soll, geben Sie dropffect \_ None zurück.</span><span class="sxs-lookup"><span data-stu-id="8cf82-222">If your application does not want to accept any of these formats, return DROPEFFECT\_NONE.</span></span> <span data-ttu-id="8cf82-223">Im Rahmen dieses Szenarios sollte Ihre Anwendung alle Datenobjekte ignorieren, die keine Formate enthalten, die zum Übertragen von Dateien verwendet werden, wie z. b. [CF \_ HDROP](clipboard.md).</span><span class="sxs-lookup"><span data-stu-id="8cf82-223">For the purposes of this scenario, your application should ignore any data objects that do not contain formats used to transfer files, such as [CF\_HDROP](clipboard.md).</span></span>
5.  <span data-ttu-id="8cf82-224">Wenn der Benutzer die Daten löscht, ruft das System [**IDropTarget::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop)auf.</span><span class="sxs-lookup"><span data-stu-id="8cf82-224">When the user drops the data, the system calls [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop).</span></span>
6.  <span data-ttu-id="8cf82-225">Verwenden Sie die [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) -Schnittstelle, um den Inhalt der Dateien zu extrahieren.</span><span class="sxs-lookup"><span data-stu-id="8cf82-225">Use the [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface to extract the contents of the files.</span></span>

<span data-ttu-id="8cf82-226">Es gibt verschiedene Möglichkeiten, den Inhalt eines shellobjekts aus einem Datenobjekt zu extrahieren.</span><span class="sxs-lookup"><span data-stu-id="8cf82-226">There are several different ways to extract the contents of a Shell object from a data object.</span></span> <span data-ttu-id="8cf82-227">Verwenden Sie in der Regel die folgende Reihenfolge:</span><span class="sxs-lookup"><span data-stu-id="8cf82-227">In general, use the following order:</span></span>

-   <span data-ttu-id="8cf82-228">Wenn die Datei ein [CF- \_ Text](clipboard.md) Format enthält, sind die Daten ANSI-Text.</span><span class="sxs-lookup"><span data-stu-id="8cf82-228">If the file contains a [CF\_TEXT](clipboard.md) format, the data is ANSI text.</span></span> <span data-ttu-id="8cf82-229">Sie können das CF- \_ Text Format verwenden, um die Daten zu extrahieren, anstatt die Datei selbst zu öffnen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-229">You can use the CF\_TEXT format to extract the data, rather than opening the file itself.</span></span>
-   <span data-ttu-id="8cf82-230">Wenn die Datei ein verknüpftes oder eingebettetes OLE-Objekt enthält, enthält das Datenobjekt ein CF- \_ embeddedObject-Format.</span><span class="sxs-lookup"><span data-stu-id="8cf82-230">If the file contains a linked or embedded OLE object, the data object contains a CF\_EMBEDDEDOBJECT format.</span></span> <span data-ttu-id="8cf82-231">Verwenden Sie OLE-Standardtechniken, um die Daten zu extrahieren.</span><span class="sxs-lookup"><span data-stu-id="8cf82-231">Use standard OLE techniques to extract the data.</span></span> <span data-ttu-id="8cf82-232">[Schrott Dateien](#creating-and-importing-scrap-files) enthalten immer ein CF \_ embeddedObject-Format.</span><span class="sxs-lookup"><span data-stu-id="8cf82-232">[Scrap files](#creating-and-importing-scrap-files) always contain a CF\_EMBEDDEDOBJECT format.</span></span>
-   <span data-ttu-id="8cf82-233">Wenn das Shellobjekt aus dem Dateisystem besteht, enthält das Datenobjekt ein [CF- \_ HDROP](clipboard.md) -Format mit den Namen der Dateien.</span><span class="sxs-lookup"><span data-stu-id="8cf82-233">If the Shell object is from the file system, the data object contains a [CF\_HDROP](clipboard.md) format with the names of the files.</span></span> <span data-ttu-id="8cf82-234">Extrahieren Sie den Dateinamen aus [CF \_ HDROP](clipboard.md) , und rufen Sie [**olecreatefromfile**](/windows/win32/api/ole2/nf-ole2-olecreatefromfile) auf, um ein neues verknüpftes oder eingebettetes Objekt zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-234">Extract the file name from [CF\_HDROP](clipboard.md) and call [**OleCreateFromFile**](/windows/win32/api/ole2/nf-ole2-olecreatefromfile) to create a new linked or embedded object.</span></span> <span data-ttu-id="8cf82-235">Eine Erläuterung dazu, wie Sie einen Dateinamen aus einem [CF- \_ HDROP](clipboard.md) -Format abrufen, finden Sie unter [Kopieren von Dateinamen aus der Zwischenablage in eine Anwendung](#copying-file-names-from-the-clipboard-to-an-application).</span><span class="sxs-lookup"><span data-stu-id="8cf82-235">For a discussion of how to retrieve a file name from a [CF\_HDROP](clipboard.md) format, see [Copying File Names from the Clipboard to an Application](#copying-file-names-from-the-clipboard-to-an-application).</span></span>
-   <span data-ttu-id="8cf82-236">Wenn das Datenobjekt ein [cfstr \_ File Descriptor](clipboard.md) -Format enthält, können Sie den Inhalt einer Datei aus dem Format " [cfstr \_ fileContents](clipboard.md) " der Datei extrahieren.</span><span class="sxs-lookup"><span data-stu-id="8cf82-236">If the data object contains a [CFSTR\_FILEDESCRIPTOR](clipboard.md) format, you can extract a file's contents from the file's [CFSTR\_FILECONTENTS](clipboard.md) format.</span></span> <span data-ttu-id="8cf82-237">Eine Erläuterung dieses Verfahrens finden [Sie unter Verwenden des cfstr \_ File Contents-Formats zum Extrahieren von Daten aus einer Datei](/windows).</span><span class="sxs-lookup"><span data-stu-id="8cf82-237">For a discussion of this procedure, see [Using the CFSTR\_FILECONTENTS Format to Extract Data from a File](/windows).</span></span>
-   <span data-ttu-id="8cf82-238">Vor der Shell- [Version 4,71](versions.md)hat eine Anwendung angegeben, dass Sie einen Verknüpfungs Dateityp übertragen hat, indem Sie **FD \_ linkui** im **dwFlags** -Member der [**Filedescriptor**](/windows/win32/api/shlobj_core/ns-shlobj_core-filedescriptora) -Struktur festgelegt hat.</span><span class="sxs-lookup"><span data-stu-id="8cf82-238">Prior to Shell [version 4.71](versions.md), an application indicated that it was transferring a shortcut file type by setting **FD\_LINKUI** in the **dwFlags** member of the [**FILEDESCRIPTOR**](/windows/win32/api/shlobj_core/ns-shlobj_core-filedescriptora) structure.</span></span> <span data-ttu-id="8cf82-239">Für spätere Versionen der Shell ist die bevorzugte Methode, um anzugeben, dass Verknüpfungen übertragen werden, das Format " [cfstr \_ preferreddropeffect](clipboard.md) ", das auf den Link "DropEffect" festgelegt ist \_ .</span><span class="sxs-lookup"><span data-stu-id="8cf82-239">For later versions of the Shell, the preferred way to indicate that shortcuts are being transferred is to use the [CFSTR\_PREFERREDDROPEFFECT](clipboard.md) format set to DROPEFFECT\_LINK.</span></span> <span data-ttu-id="8cf82-240">Diese Vorgehensweise ist viel effizienter als das Extrahieren der **Filedescriptor** -Struktur, nur um ein Flag zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-240">This approach is much more efficient than extracting the **FILEDESCRIPTOR** structure just to check a flag.</span></span>

<span data-ttu-id="8cf82-241">Wenn der Daten Extraktionsprozess langwierig ist, sollten Sie den Vorgang in einem Hintergrund Thread asynchron ausführen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-241">If the data extraction process will be lengthy, you might want to do the operation asynchronously on a background thread.</span></span> <span data-ttu-id="8cf82-242">Der primäre Thread kann dann ohne unnötige Verzögerungen fortfahren.</span><span class="sxs-lookup"><span data-stu-id="8cf82-242">Your primary thread can then proceed without unnecessary delays.</span></span> <span data-ttu-id="8cf82-243">Eine Erläuterung zum Verarbeiten der asynchronen Datenextraktion finden Sie unter [asynchrones ziehen und Ablegen von shellobjekten](#dragging-and-dropping-shell-objects-asynchronously).</span><span class="sxs-lookup"><span data-stu-id="8cf82-243">For a discussion of how to handle asynchronous data extraction, see [Dragging and Dropping Shell Objects Asynchronously](#dragging-and-dropping-shell-objects-asynchronously).</span></span>

### <a name="using-the-cfstr_filecontents-format-to-extract-data-from-a-file"></a><span data-ttu-id="8cf82-244">Verwenden des cfstr \_ File Contents-Formats zum Extrahieren von Daten aus einer Datei</span><span class="sxs-lookup"><span data-stu-id="8cf82-244">Using the CFSTR\_FILECONTENTS Format to Extract Data from a File</span></span>

<span data-ttu-id="8cf82-245">Das Format [cfstr \_ fileContents](clipboard.md) bietet eine sehr flexible und leistungsstarke Möglichkeit, den Inhalt einer Datei zu übertragen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-245">The [CFSTR\_FILECONTENTS](clipboard.md) format provides a very flexible and powerful way to transfer the contents of a file.</span></span> <span data-ttu-id="8cf82-246">Es ist nicht einmal erforderlich, dass die Daten als einzelne Datei gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-246">It is not even necessary for the data to be stored as a single file.</span></span> <span data-ttu-id="8cf82-247">Für dieses Format ist lediglich erforderlich, dass das Datenobjekt die Daten für das Ziel wie eine-Datei präsentiert.</span><span class="sxs-lookup"><span data-stu-id="8cf82-247">All that is required for this format is that the data object present the data to the target as if it were a file.</span></span> <span data-ttu-id="8cf82-248">Beispielsweise kann es sich bei den eigentlichen Daten um einen Abschnitt eines Textdokuments oder um einen Datenblock handeln, der aus einer Datenbank extrahiert wird.</span><span class="sxs-lookup"><span data-stu-id="8cf82-248">For instance, the actual data might be a section of a text document or a block of data extracted from a database.</span></span> <span data-ttu-id="8cf82-249">Das Ziel kann die Daten als Datei behandeln und muss nichts über den zugrunde liegenden Speichermechanismus wissen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-249">The target can treat the data as a file and does not need to know anything about the underlying storage mechanism.</span></span>

<span data-ttu-id="8cf82-250">Namespace Erweiterungen verwenden normalerweise [cfstr \_ File Content](clipboard.md) , um Daten zu übertragen, da dieses Format keinen bestimmten Speichermechanismus annimmt.</span><span class="sxs-lookup"><span data-stu-id="8cf82-250">Namespace extensions normally use [CFSTR\_FILECONTENTS](clipboard.md) to transfer data because this format does not assume any particular storage mechanism.</span></span> <span data-ttu-id="8cf82-251">Eine Namespace Erweiterung kann einen beliebigen Speichermechanismus verwenden und dieses Format verwenden, um die Objekte den Anwendungen so darzustellen, als wären Sie Dateien.</span><span class="sxs-lookup"><span data-stu-id="8cf82-251">A namespace extension can use whatever storage mechanism is convenient, and use this format to present its objects to applications as if they were files.</span></span>

<span data-ttu-id="8cf82-252">Der Datenübertragungsmechanismus für [cfstr \_ FileContent](clipboard.md) ist normalerweise [TYMED \_ IStream](dataobject.md).</span><span class="sxs-lookup"><span data-stu-id="8cf82-252">The data transfer mechanism for [CFSTR\_FILECONTENTS](clipboard.md) is normally [TYMED\_ISTREAM](dataobject.md).</span></span> <span data-ttu-id="8cf82-253">Das übertragen eines [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) -Schnittstellen Zeigers erfordert viel weniger Arbeitsspeicher als das Laden der Daten in ein globales Speicher Objekt, und **IStream** ist eine einfachere Möglichkeit, um Daten darzustellen als [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage).</span><span class="sxs-lookup"><span data-stu-id="8cf82-253">Transferring an [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) interface pointer requires much less memory than loading the data into a global memory object, and **IStream** is a simpler way to represent data than [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage).</span></span>

<span data-ttu-id="8cf82-254">Ein [cfstr \_ File Contents](clipboard.md) -Format wird immer von einem [cfstr- \_ Filedescriptor](clipboard.md) -Format begleitet.</span><span class="sxs-lookup"><span data-stu-id="8cf82-254">A [CFSTR\_FILECONTENTS](clipboard.md) format is always accompanied by a [CFSTR\_FILEDESCRIPTOR](clipboard.md) format.</span></span> <span data-ttu-id="8cf82-255">Sie müssen den Inhalt dieses Formats zuerst überprüfen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-255">You must examine the contents of this format first.</span></span> <span data-ttu-id="8cf82-256">Wenn mehr als eine Datei übertragen wird, enthält das Datenobjekt tatsächlich mehrere [cfstr \_ File Content](clipboard.md) -Formate, eine für jede Datei.</span><span class="sxs-lookup"><span data-stu-id="8cf82-256">If more than one file is being transferred, the data object will actually contain multiple [CFSTR\_FILECONTENTS](clipboard.md) formats, one for each file.</span></span> <span data-ttu-id="8cf82-257">Das Format [cfstr \_ Filedescriptor](clipboard.md) enthält den Namen und die Attribute der einzelnen Dateien und stellt einen Indexwert für jede Datei bereit, die erforderlich ist, um das [cfstr \_ File Contents](clipboard.md) -Format einer bestimmten Datei zu extrahieren.</span><span class="sxs-lookup"><span data-stu-id="8cf82-257">The [CFSTR\_FILEDESCRIPTOR](clipboard.md) format contains the name and attributes of each file, and provides an index value for each file that is needed to extract a particular file's [CFSTR\_FILECONTENTS](clipboard.md) format.</span></span>

<span data-ttu-id="8cf82-258">So extrahieren Sie ein [cfstr \_ File Contents](clipboard.md) -Format:</span><span class="sxs-lookup"><span data-stu-id="8cf82-258">To extract a [CFSTR\_FILECONTENTS](clipboard.md) format:</span></span>

1.  <span data-ttu-id="8cf82-259">Extrahieren Sie das Format " [cfstr \_ Filedescriptor](clipboard.md) " als Wert für " [TYMED \_ HGLOBAL](dataobject.md) ".</span><span class="sxs-lookup"><span data-stu-id="8cf82-259">Extract the [CFSTR\_FILEDESCRIPTOR](clipboard.md) format as a [TYMED\_HGLOBAL](dataobject.md) value.</span></span>
2.  <span data-ttu-id="8cf82-260">Der **HGLOBAL** -Member der zurückgegebenen [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) -Struktur verweist auf ein globales Speicher Objekt.</span><span class="sxs-lookup"><span data-stu-id="8cf82-260">The **hGlobal** member of the returned [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure points to a global memory object.</span></span> <span data-ttu-id="8cf82-261">Sperren Sie das Objekt, indem Sie den **HGLOBAL** -Wert an [**GlobalLock**](/windows/win32/api/winbase/nf-winbase-globallock)übergeben.</span><span class="sxs-lookup"><span data-stu-id="8cf82-261">Lock that object by passing the **hGlobal** value to [**GlobalLock**](/windows/win32/api/winbase/nf-winbase-globallock).</span></span>
3.  <span data-ttu-id="8cf82-262">Wandeln Sie den von [**GlobalLock**](/windows/win32/api/winbase/nf-winbase-globallock) zurückgegebenen Zeiger in einen [**filegroupdescriptor**](/windows/win32/api/shlobj_core/ns-shlobj_core-filegroupdescriptora) -Zeiger um.</span><span class="sxs-lookup"><span data-stu-id="8cf82-262">Cast the pointer returned by [**GlobalLock**](/windows/win32/api/winbase/nf-winbase-globallock) to a [**FILEGROUPDESCRIPTOR**](/windows/win32/api/shlobj_core/ns-shlobj_core-filegroupdescriptora) pointer.</span></span> <span data-ttu-id="8cf82-263">Er verweist auf eine **filegroupdescriptor** -Struktur, auf die mindestens eine [**Filedescriptor**](/windows/win32/api/shlobj_core/ns-shlobj_core-filedescriptora) -Struktur folgt.</span><span class="sxs-lookup"><span data-stu-id="8cf82-263">It will point to a **FILEGROUPDESCRIPTOR** structure followed by one or more [**FILEDESCRIPTOR**](/windows/win32/api/shlobj_core/ns-shlobj_core-filedescriptora) structures.</span></span> <span data-ttu-id="8cf82-264">Jede **Filedescriptor** -Struktur enthält eine Beschreibung einer Datei, die in einem der zugehörigen [cfstr \_ File Content](clipboard.md) -Formate enthalten ist.</span><span class="sxs-lookup"><span data-stu-id="8cf82-264">Each **FILEDESCRIPTOR** structure contains a description of a file that is contained by one of the accompanying [CFSTR\_FILECONTENTS](clipboard.md) formats.</span></span>
4.  <span data-ttu-id="8cf82-265">Überprüfen Sie die [**Filedescriptor**](/windows/win32/api/shlobj_core/ns-shlobj_core-filedescriptora) -Strukturen, um zu bestimmen, welcher der Datei entspricht, die Sie extrahieren möchten.</span><span class="sxs-lookup"><span data-stu-id="8cf82-265">Examine the [**FILEDESCRIPTOR**](/windows/win32/api/shlobj_core/ns-shlobj_core-filedescriptora) structures to determine which one corresponds to the file you want to extract.</span></span> <span data-ttu-id="8cf82-266">Der null basierte Index dieser **Filedescriptor** -Struktur wird verwendet, um das Format der Datei " [cfstr \_ fileContents](clipboard.md) " der Datei zu identifizieren.</span><span class="sxs-lookup"><span data-stu-id="8cf82-266">The zero-based index of that **FILEDESCRIPTOR** structure is used to identify the file's [CFSTR\_FILECONTENTS](clipboard.md) format.</span></span> <span data-ttu-id="8cf82-267">Da die Größe eines globalen Speicherblocks nicht Byte genau ist, verwenden Sie die Member **nfilesizelow** und **nfilesizehigh** der Struktur, um zu bestimmen, wie viele Bytes die Datei im globalen Speicher Objekt darstellen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-267">Because the size of a global memory block is not byte-precise, use the structure's **nFileSizeLow** and **nFileSizeHigh** members to determine how many bytes represent the file in the global memory object.</span></span>
5.  <span data-ttu-id="8cf82-268">Rufen Sie [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) auf, wobei der **cfFormat** -Member der [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) -Struktur auf den Wert [cfstr \_ fileContents](clipboard.md) festgelegt ist und der **Lindex** -Member auf den Index festgelegt ist, den Sie im vorherigen Schritt festgelegt haben.</span><span class="sxs-lookup"><span data-stu-id="8cf82-268">Call [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) with the **cfFormat** member of the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure set to the [CFSTR\_FILECONTENTS](clipboard.md) value and the **lIndex** member set to the index that you determined in the previous step.</span></span> <span data-ttu-id="8cf82-269">Der **TYMED** -Member ist in der Regel auf " [TYMED \_ HGLOBAL](dataobject.md) \| TYMED \_ IStream \| TYMED IStorage" festgelegt \_ .</span><span class="sxs-lookup"><span data-stu-id="8cf82-269">The **tymed** member is typically set to [TYMED\_HGLOBAL](dataobject.md) \| TYMED\_ISTREAM \| TYMED\_ISTORAGE.</span></span> <span data-ttu-id="8cf82-270">Das Datenobjekt kann dann seinen bevorzugten Datenübertragungsmechanismus auswählen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-270">The data object can then choose its preferred data transfer mechanism.</span></span>
6.  <span data-ttu-id="8cf82-271">Die [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) -Struktur, die [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) zurückgibt, enthält einen Zeiger auf die Daten der Datei.</span><span class="sxs-lookup"><span data-stu-id="8cf82-271">The [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure that [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) returns will contain a pointer to the file's data.</span></span> <span data-ttu-id="8cf82-272">Überprüfen Sie den **TYMED** -Member der-Struktur, um den Datenübertragungsmechanismus zu bestimmen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-272">Examine the **tymed** member of the structure to determine the data transfer mechanism.</span></span>
7.  <span data-ttu-id="8cf82-273">Wenn **TYMED** auf " [TYMED \_ IStream](dataobject.md) " oder "TYMED IStorage" festgelegt ist \_ , verwenden Sie die-Schnittstelle zum Extrahieren der Daten.</span><span class="sxs-lookup"><span data-stu-id="8cf82-273">If **tymed** is set to [TYMED\_ISTREAM](dataobject.md) or TYMED\_ISTORAGE, use the interface to extract the data.</span></span> <span data-ttu-id="8cf82-274">Wenn **TYMED** auf TYMED HGLOBAL festgelegt ist \_ , sind die Daten in einem globalen Speicher Objekt enthalten.</span><span class="sxs-lookup"><span data-stu-id="8cf82-274">If **tymed** is set to TYMED\_HGLOBAL, the data is contained in a global memory object.</span></span> <span data-ttu-id="8cf82-275">Eine Erläuterung zum Extrahieren von Daten aus einem globalen Speicher Objekt finden Sie im Abschnitt *Extrahieren eines globalen Speicher Objekts aus einem Datenobjekt* des Shell- [Datenobjekts](dataobject.md).</span><span class="sxs-lookup"><span data-stu-id="8cf82-275">For a discussion of how to extract data from a global memory object, see the *Extracting a global memory object from a data object* section of [Shell Data Object](dataobject.md).</span></span>
8.  <span data-ttu-id="8cf82-276">Zum Entsperren des globalen Speicher Objekts, das Sie in Schritt 2 gesperrt haben, wird [**GlobalLock**](/windows/win32/api/winbase/nf-winbase-globallock) aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-276">Call [**GlobalLock**](/windows/win32/api/winbase/nf-winbase-globallock) to unlock the global memory object that you locked in step 2.</span></span>

## <a name="handling-optimized-move-operations"></a><span data-ttu-id="8cf82-277">Verarbeiten optimierter Verschiebungs Vorgänge</span><span class="sxs-lookup"><span data-stu-id="8cf82-277">Handling Optimized Move Operations</span></span>

<span data-ttu-id="8cf82-278">**Szenario:** Eine Datei wird mithilfe einer optimierten Verschiebung aus dem Dateisystem in eine Namespace Erweiterung verschoben.</span><span class="sxs-lookup"><span data-stu-id="8cf82-278">**Scenario:** A file is moved from the file system to a namespace extension using an optimized move.</span></span>

<span data-ttu-id="8cf82-279">Bei einem herkömmlichen Verschiebungs Vorgang erstellt das Ziel eine Kopie der Daten, und die Quelle löscht das Original.</span><span class="sxs-lookup"><span data-stu-id="8cf82-279">In a conventional move operation, the target makes a copy of the data and the source deletes the original.</span></span> <span data-ttu-id="8cf82-280">Diese Vorgehensweise kann ineffizient sein, da zwei Kopien der Daten erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="8cf82-280">This procedure can be inefficient because it requires two copies of the data.</span></span> <span data-ttu-id="8cf82-281">Bei großen Objekten, z. b. Datenbanken, ist ein herkömmlicher Verschiebungs Vorgang möglicherweise nicht einmal praktikabel.</span><span class="sxs-lookup"><span data-stu-id="8cf82-281">With large objects such as databases, a conventional move operation might not even be practical.</span></span>

<span data-ttu-id="8cf82-282">Bei einem optimierten Verschiebe Vorgang verwendet das Ziel das Verständnis, wie die Daten gespeichert werden, um den gesamten Verschiebungs Vorgang zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="8cf82-282">With an optimized move, the target uses its understanding of how the data is stored to handle the entire move operation.</span></span> <span data-ttu-id="8cf82-283">Es gibt nie eine zweite Kopie der Daten, und die Quelle muss die ursprünglichen Daten nicht löschen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-283">There is never a second copy of the data, and there is no need for the source to delete the original data.</span></span> <span data-ttu-id="8cf82-284">Shelldaten sind gut für optimierte Verschiebungen geeignet, da das Ziel den gesamten Vorgang mithilfe der Shell-API verarbeiten kann.</span><span class="sxs-lookup"><span data-stu-id="8cf82-284">Shell data is well suited to optimized moves because the target can handle the entire operation using the Shell API.</span></span> <span data-ttu-id="8cf82-285">Ein typisches Beispiel ist das Verschieben von Dateien.</span><span class="sxs-lookup"><span data-stu-id="8cf82-285">A typical example is moving files.</span></span> <span data-ttu-id="8cf82-286">Wenn das Ziel den Pfad einer Datei aufweist, die verschoben werden soll, kann es [**SHFileOperation**](/windows/desktop/api/Shellapi/nf-shellapi-shfileoperationa) verwenden, um es zu verschieben.</span><span class="sxs-lookup"><span data-stu-id="8cf82-286">Once the target has the path of a file to be moved, it can use [**SHFileOperation**](/windows/desktop/api/Shellapi/nf-shellapi-shfileoperationa) to move it.</span></span> <span data-ttu-id="8cf82-287">Es ist nicht erforderlich, dass die Quelle die ursprüngliche Datei löscht.</span><span class="sxs-lookup"><span data-stu-id="8cf82-287">There is no need for the source to delete the original file.</span></span>

> [!Note]  
> <span data-ttu-id="8cf82-288">Die Shell verwendet normalerweise eine optimierte Verschiebung, um Dateien zu verschieben.</span><span class="sxs-lookup"><span data-stu-id="8cf82-288">The Shell normally uses an optimized move to move files.</span></span> <span data-ttu-id="8cf82-289">Zum ordnungsgemäßen verarbeiten von shelldatenübertragungen muss Ihre Anwendung in der Lage sein, eine optimierte Verschiebung zu erkennen und zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="8cf82-289">To handle Shell data transfer properly, your application must be capable of detecting and handling an optimized move.</span></span>

 

<span data-ttu-id="8cf82-290">Optimierte Verschiebungen werden wie folgt behandelt:</span><span class="sxs-lookup"><span data-stu-id="8cf82-290">Optimized moves are handled in the following way:</span></span>

1.  <span data-ttu-id="8cf82-291">Die Quelle ruft [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) auf, wobei der *dweffect* -Parameter auf dropeer ffect Move festgelegt \_ ist, um anzugeben, dass die Quell Objekte verschoben werden können.</span><span class="sxs-lookup"><span data-stu-id="8cf82-291">The source calls [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) with the *dwEffect* parameter set to DROPEFFECT\_MOVE to indicate that the source objects can be moved.</span></span>
2.  <span data-ttu-id="8cf82-292">Das Ziel empfängt den dropeer ffect-Verschiebungs \_ Wert über eine seiner [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) -Methoden, was darauf hinweist, dass eine Verschiebung zulässig ist.</span><span class="sxs-lookup"><span data-stu-id="8cf82-292">The target receives the DROPEFFECT\_MOVE value through one of its [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) methods, indicating that a move is allowed.</span></span>
3.  <span data-ttu-id="8cf82-293">Das Ziel kopiert entweder das Objekt (nicht optimierte Verschiebung) oder verschiebt das Objekt (optimierte Verschiebung).</span><span class="sxs-lookup"><span data-stu-id="8cf82-293">The target either copies the object (unoptimized move) or moves the object (optimized move).</span></span>
4.  <span data-ttu-id="8cf82-294">Das Ziel teilt der Quelle dann mit, ob die ursprünglichen Daten gelöscht werden müssen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-294">The target then tells the source whether it needs to delete the original data.</span></span>

    <span data-ttu-id="8cf82-295">Eine optimierte Verschiebung ist der Standard Vorgang, bei dem die Daten vom Ziel gelöscht werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-295">An optimized move is the default operation, with the data deleted by the target.</span></span> <span data-ttu-id="8cf82-296">So informieren Sie die Quelle, dass eine optimierte Verschiebung durchgeführt wurde:</span><span class="sxs-lookup"><span data-stu-id="8cf82-296">To inform the source that an optimized move was performed:</span></span>

    -   -   <span data-ttu-id="8cf82-297">Das Ziel legt den Wert von *pdweffect* , der über seine [**IDropTarget::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) -Methode empfangen wurde, auf einen anderen Wert als dropeer ffect \_ Move fest.</span><span class="sxs-lookup"><span data-stu-id="8cf82-297">The target sets the *pdwEffect* value it received through its [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) method to some value other than DROPEFFECT\_MOVE.</span></span> <span data-ttu-id="8cf82-298">Er ist in der Regel auf "dropeer ffect \_ None" oder "dropeer" Kopieren festgelegt \_ .</span><span class="sxs-lookup"><span data-stu-id="8cf82-298">It is typically set to either DROPEFFECT\_NONE or DROPEFFECT\_COPY.</span></span> <span data-ttu-id="8cf82-299">Der Wert wird von [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop)an die Quelle zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="8cf82-299">The value will be returned to the source by [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop).</span></span>
        -   <span data-ttu-id="8cf82-300">Das Ziel ruft außerdem die [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) -Methode des Datenobjekts auf und übergibt ihm einen auf dropeer ffect None festgelegten [cfstr \_ performeddropeer ffect](clipboard.md) -Format Bezeichner \_ .</span><span class="sxs-lookup"><span data-stu-id="8cf82-300">The target also calls the data object's [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) method and passes it a [CFSTR\_PERFORMEDDROPEFFECT](clipboard.md) format identifier set to DROPEFFECT\_NONE.</span></span> <span data-ttu-id="8cf82-301">Dieser Methoden Aufrufwert ist erforderlich, da einige Ablage Ziele den Parameter " *pdweffect* " von [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) möglicherweise nicht ordnungsgemäß festlegen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-301">This method call is necessary because some drop targets might not set the *pdwEffect* parameter of [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) properly.</span></span> <span data-ttu-id="8cf82-302">Das [cfstr \_ performeddropeer ffect](clipboard.md) -Format ist die zuverlässige Möglichkeit, um anzugeben, dass eine optimierte Verschiebung stattfindet.</span><span class="sxs-lookup"><span data-stu-id="8cf82-302">The [CFSTR\_PERFORMEDDROPEFFECT](clipboard.md) format is the reliable way to indicate that an optimized move has taken place.</span></span>

    <span data-ttu-id="8cf82-303">Wenn das Ziel eine nicht optimierte Verschiebung durchgeführt hat, müssen die Daten von der Quelle gelöscht werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-303">If the target did an unoptimized move, the data must be deleted by the source.</span></span> <span data-ttu-id="8cf82-304">So informieren Sie die Quelle, dass eine nicht optimierte Verschiebung durchgeführt wurde:</span><span class="sxs-lookup"><span data-stu-id="8cf82-304">To inform the source that an unoptimized move was performed:</span></span>

    -   -   <span data-ttu-id="8cf82-305">Das Ziel legt den Wert von *pdweffect* fest, den er über seine [**IDropTarget::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) -Methode empfangen hat, auf dropffect \_ Move.</span><span class="sxs-lookup"><span data-stu-id="8cf82-305">The target sets the *pdwEffect* value it received through its [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) method to DROPEFFECT\_MOVE.</span></span> <span data-ttu-id="8cf82-306">Der Wert wird von [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop)an die Quelle zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="8cf82-306">The value will be returned to the source by [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop).</span></span>
        -   <span data-ttu-id="8cf82-307">Das Ziel ruft außerdem die [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) -Methode des Datenobjekts auf und übergibt ihm einen auf dropffect-Verschiebungs Satz festgelegten [cfstr \_ performeddropeer ffect](clipboard.md) -Format Bezeichner \_ .</span><span class="sxs-lookup"><span data-stu-id="8cf82-307">The target also calls the data object's [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) method and passes it a [CFSTR\_PERFORMEDDROPEFFECT](clipboard.md) format identifier set to DROPEFFECT\_MOVE.</span></span> <span data-ttu-id="8cf82-308">Dieser Methoden Aufrufwert ist erforderlich, da einige Ablage Ziele den Parameter " *pdweffect* " von [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) möglicherweise nicht ordnungsgemäß festlegen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-308">This method call is necessary because some drop targets might not set the *pdwEffect* parameter of [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) properly.</span></span> <span data-ttu-id="8cf82-309">Das [cfstr \_ performeddropeer ffect](clipboard.md) -Format ist die zuverlässige Möglichkeit, um anzugeben, dass eine nicht optimierte Verschiebung stattfindet.</span><span class="sxs-lookup"><span data-stu-id="8cf82-309">The [CFSTR\_PERFORMEDDROPEFFECT](clipboard.md) format is the reliable way to indicate that an unoptimized move has taken place.</span></span>

5.  <span data-ttu-id="8cf82-310">Die Quelle überprüft die beiden Werte, die vom Ziel zurückgegeben werden können.</span><span class="sxs-lookup"><span data-stu-id="8cf82-310">The source inspects the two values that can be returned by the target.</span></span> <span data-ttu-id="8cf82-311">Wenn beide auf dropffect Move festgelegt sind \_ , wird die nicht optimierte Verschiebung durch Löschen der ursprünglichen Daten abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-311">If both are set to DROPEFFECT\_MOVE, it completes the unoptimized move by deleting the original data.</span></span> <span data-ttu-id="8cf82-312">Andernfalls hat das Ziel eine optimierte Verschiebung durchgeführt, und die ursprünglichen Daten wurden gelöscht.</span><span class="sxs-lookup"><span data-stu-id="8cf82-312">Otherwise, the target did an optimized move and the original data has been deleted.</span></span>

## <a name="handling-delete-on-paste-operations"></a><span data-ttu-id="8cf82-313">Behandeln von Lösch Vorgängen</span><span class="sxs-lookup"><span data-stu-id="8cf82-313">Handling Delete-on-Paste Operations</span></span>

<span data-ttu-id="8cf82-314">**Szenario:** Mindestens eine Datei wird aus einem Ordner in Windows-Explorer ausgeschnitten und in eine Namespace Erweiterung eingefügt.</span><span class="sxs-lookup"><span data-stu-id="8cf82-314">**Scenario:** One or more files are cut from a folder in Windows Explorer and pasted into a namespace extension.</span></span> <span data-ttu-id="8cf82-315">In Windows-Explorer bleiben die Dateien hervorgehoben, bis Sie Feedback zum Ergebnis des Einfügevorgangs erhalten.</span><span class="sxs-lookup"><span data-stu-id="8cf82-315">Windows Explorer leaves the files highlighted until it receives feedback on the outcome of the paste operation.</span></span>

<span data-ttu-id="8cf82-316">Wenn ein Benutzer in der Regel Daten schneidet, verschwindet er sofort aus der Ansicht.</span><span class="sxs-lookup"><span data-stu-id="8cf82-316">Traditionally, when a user cuts data it immediately disappears from view.</span></span> <span data-ttu-id="8cf82-317">Dies ist möglicherweise nicht effizient und kann zu Problemen mit der Benutzerfreundlichkeit führen, wenn der Benutzer sich Gedanken darüber machen muss, was mit den Daten geschehen ist.</span><span class="sxs-lookup"><span data-stu-id="8cf82-317">This might not be efficient, and it can lead to usability problems if the user becomes concerned about what has happened to the data.</span></span> <span data-ttu-id="8cf82-318">Ein alternativer Ansatz ist die Verwendung eines DELETE-on-Paste-Vorgangs.</span><span class="sxs-lookup"><span data-stu-id="8cf82-318">An alternative approach is to use a delete-on-paste operation.</span></span>

<span data-ttu-id="8cf82-319">Bei einem DELETE-on-Copy-Vorgang werden die ausgewählten Daten nicht sofort aus der Ansicht entfernt.</span><span class="sxs-lookup"><span data-stu-id="8cf82-319">With a delete-on-paste operation, the selected data is not immediately removed from view.</span></span> <span data-ttu-id="8cf82-320">Stattdessen markiert die Quell Anwendung Sie als ausgewählt, möglicherweise durch Ändern der Schriftart oder der Hintergrundfarbe.</span><span class="sxs-lookup"><span data-stu-id="8cf82-320">Instead, the source application marks it as selected, perhaps by changing the font or background color.</span></span> <span data-ttu-id="8cf82-321">Nachdem die Zielanwendung die Daten eingefügt hat, benachrichtigt Sie die Quelle über das Ergebnis des Vorgangs.</span><span class="sxs-lookup"><span data-stu-id="8cf82-321">After the target application has pasted the data, it notifies the source about the outcome of the operation.</span></span> <span data-ttu-id="8cf82-322">Wenn das Ziel eine [optimierte Verschiebung](#handling-optimized-move-operations)durchgeführt hat, kann die Quelle die Anzeige einfach aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="8cf82-322">If the target performed an [optimized move](#handling-optimized-move-operations), the source can simply update its display.</span></span> <span data-ttu-id="8cf82-323">Wenn das Ziel einen normalen Verschiebe Vorgang durchgeführt hat, muss die Quelle auch die Kopie der Daten löschen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-323">If the target performed a normal move, the source must also delete its copy of the data.</span></span> <span data-ttu-id="8cf82-324">Wenn beim Einfügen ein Fehler auftritt, stellt die Quell Anwendung die ausgewählten Daten in der ursprünglichen Darstellung wieder her.</span><span class="sxs-lookup"><span data-stu-id="8cf82-324">If the paste fails, the source application restores the selected data to its original appearance.</span></span>

> [!Note]  
> <span data-ttu-id="8cf82-325">Die Shell verwendet normalerweise DELETE-on-Copy, wenn ein Ausschneide-/Einfügevorgang zum Verschieben von Dateien verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="8cf82-325">The Shell normally uses delete-on-paste when a cut/paste operation is used to move files.</span></span> <span data-ttu-id="8cf82-326">Beim Einfügen von Lösch Vorgängen mit shellobjekten wird normalerweise eine [optimierte Verschiebung](#handling-optimized-move-operations) verwendet, um die Dateien zu verschieben.</span><span class="sxs-lookup"><span data-stu-id="8cf82-326">Delete-on-paste operations with Shell objects normally use an [optimized move](#handling-optimized-move-operations) to move the files.</span></span> <span data-ttu-id="8cf82-327">Damit die Shell-Datenübertragung ordnungsgemäß durchgeführt werden kann, muss Ihre Anwendung in der Lage sein, Vorgänge zum Löschen und einfügen zu erkennen und zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="8cf82-327">To handle Shell data transfer properly, your application must be capable of detecting and handling delete-on-paste operations.</span></span>

 

<span data-ttu-id="8cf82-328">Die grundlegende Anforderung für DELETE-on-Paste besteht darin, dass das Ziel das Ergebnis des Vorgangs an die Quelle melden muss.</span><span class="sxs-lookup"><span data-stu-id="8cf82-328">The essential requirement for delete-on-paste is that the target must report the outcome of the operation to the source.</span></span> <span data-ttu-id="8cf82-329">Standardmäßige Zwischenablage Techniken können jedoch nicht zum Implementieren von DELETE-on-Paste verwendet werden, da Sie keine Möglichkeit bieten, mit der Quelle zu kommunizieren.</span><span class="sxs-lookup"><span data-stu-id="8cf82-329">However, standard Clipboard techniques cannot be used to implement delete-on-paste because they do not provide a way for the target to communicate with the source.</span></span> <span data-ttu-id="8cf82-330">Stattdessen verwendet die Zielanwendung die [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) -Methode des Datenobjekts, um das Ergebnis an das Datenobjekt zu melden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-330">Instead, the target application uses the data object's [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) method to report the outcome to the data object.</span></span> <span data-ttu-id="8cf82-331">Das Datenobjekt kann dann über eine private Schnittstelle mit der Quelle kommunizieren.</span><span class="sxs-lookup"><span data-stu-id="8cf82-331">The data object can then communicate with the source through a private interface.</span></span>

<span data-ttu-id="8cf82-332">Das grundlegende Verfahren für eine DELETE-on-Paste-Operation lautet wie folgt:</span><span class="sxs-lookup"><span data-stu-id="8cf82-332">The basic procedure for a delete-on-paste operation is as follows:</span></span>

1.  <span data-ttu-id="8cf82-333">Die Quelle markiert die Bildschirm Anzeige der ausgewählten Daten.</span><span class="sxs-lookup"><span data-stu-id="8cf82-333">The source marks the screen display of the selected data.</span></span>
2.  <span data-ttu-id="8cf82-334">Die Quelle erstellt ein Datenobjekt.</span><span class="sxs-lookup"><span data-stu-id="8cf82-334">The source creates a data object.</span></span> <span data-ttu-id="8cf82-335">Dies weist auf einen Ausschneide Vorgang hin, indem das Format [cfstr \_ preferreddroetffect](clipboard.md) mit dem Datenwert dropffect Move hinzugefügt wird \_ .</span><span class="sxs-lookup"><span data-stu-id="8cf82-335">It indicates a cut operation by adding the [CFSTR\_PREFERREDDROPEFFECT](clipboard.md) format with a data value of DROPEFFECT\_MOVE.</span></span>
3.  <span data-ttu-id="8cf82-336">Die Quelle platziert das Datenobjekt mithilfe von [**OleSetClipboard**](/windows/win32/api/ole2/nf-ole2-olesetclipboard)in der Zwischenablage.</span><span class="sxs-lookup"><span data-stu-id="8cf82-336">The source places the data object on the Clipboard using [**OleSetClipboard**](/windows/win32/api/ole2/nf-ole2-olesetclipboard).</span></span>
4.  <span data-ttu-id="8cf82-337">Das Ziel Ruft das Datenobjekt mithilfe von [**olegetclipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard)aus der Zwischenablage ab.</span><span class="sxs-lookup"><span data-stu-id="8cf82-337">The target retrieves the data object from the Clipboard using [**OleGetClipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard).</span></span>
5.  <span data-ttu-id="8cf82-338">Das Ziel extrahiert die [cfstr \_ preferreddropinffect](clipboard.md) -Daten.</span><span class="sxs-lookup"><span data-stu-id="8cf82-338">The target extracts the [CFSTR\_PREFERREDDROPEFFECT](clipboard.md) data.</span></span> <span data-ttu-id="8cf82-339">Wenn es nur auf dropffect Move festgelegt ist \_ , kann das Ziel entweder eine optimierte Verschiebung durchführen oder einfach die Daten kopieren.</span><span class="sxs-lookup"><span data-stu-id="8cf82-339">If it is set to only DROPEFFECT\_MOVE, the target can either do an optimized move or simply copy the data.</span></span>
6.  <span data-ttu-id="8cf82-340">Wenn das Ziel keine optimierte Verschiebung durchführt, wird die [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) -Methode aufgerufen, wobei das Format [cfstr \_ performeddropeer ffect](clipboard.md) auf dropeer ffect Move festgelegt ist \_ .</span><span class="sxs-lookup"><span data-stu-id="8cf82-340">If the target does not do an optimized move, it calls the [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) method with the [CFSTR\_PERFORMEDDROPEFFECT](clipboard.md) format set to DROPEFFECT\_MOVE.</span></span>
7.  <span data-ttu-id="8cf82-341">Wenn das Einfügen abgeschlossen ist, ruft das Ziel die [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) -Methode auf, wobei das Format [cfstr \_ pastesucc-](clipboard.md) Version auf dropeer ffect Move festgelegt ist \_ .</span><span class="sxs-lookup"><span data-stu-id="8cf82-341">When the paste is complete, the target calls the [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) method with the [CFSTR\_PASTESUCCEEDED](clipboard.md) format set to DROPEFFECT\_MOVE.</span></span>
8.  <span data-ttu-id="8cf82-342">Wenn die [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) -Methode der Quelle mit dem auf dropffect verschieben festgelegten [cfstr- \_ pastesucc-](clipboard.md) Wert-Format aufgerufen wird \_ , muss überprüft werden, ob Sie auch das auf dropeer ffect Move festgelegte [cfstr \_ performeddropeer ffect](clipboard.md) -Format erhalten hat \_ .</span><span class="sxs-lookup"><span data-stu-id="8cf82-342">When the source's [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) method is called with the [CFSTR\_PASTESUCCEEDED](clipboard.md) format set to DROPEFFECT\_MOVE, it must check to see if it also received the [CFSTR\_PERFORMEDDROPEFFECT](clipboard.md) format set to DROPEFFECT\_MOVE.</span></span> <span data-ttu-id="8cf82-343">Wenn beide Formate vom Ziel gesendet werden, müssen die Daten von der Quelle gelöscht werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-343">If both formats are sent by the target, the source will have to delete the data.</span></span> <span data-ttu-id="8cf82-344">Wenn nur das [cfstr- \_ pastesucc-](clipboard.md) Format empfangen wird, kann die Quelle einfach die Daten aus der Anzeige entfernen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-344">If only the [CFSTR\_PASTESUCCEEDED](clipboard.md) format is received, the source can simply remove the data from its display.</span></span> <span data-ttu-id="8cf82-345">Wenn bei der Übertragung ein Fehler auftritt, aktualisiert die Quelle die ursprüngliche Darstellung der Anzeige.</span><span class="sxs-lookup"><span data-stu-id="8cf82-345">If the transfer fails, the source updates the display to its original appearance.</span></span>

## <a name="transfering-data-to-and-from-virtual-folders"></a><span data-ttu-id="8cf82-346">Übertragen von Daten in und aus virtuellen Ordnern</span><span class="sxs-lookup"><span data-stu-id="8cf82-346">Transfering Data to and from Virtual Folders</span></span>

<span data-ttu-id="8cf82-347">**Szenario:** Ein Benutzer zieht ein Objekt aus oder löscht es in einem virtuellen Ordner.</span><span class="sxs-lookup"><span data-stu-id="8cf82-347">**Scenario:** A user drags an object from or drops it on a virtual folder.</span></span>

<span data-ttu-id="8cf82-348">Virtuelle Ordner enthalten Objekte, die im Allgemeinen nicht Teil des Dateisystems sind.</span><span class="sxs-lookup"><span data-stu-id="8cf82-348">Virtual folders contain objects that are generally not part of the file system.</span></span> <span data-ttu-id="8cf82-349">Einige virtuelle Ordner, z. b. der Papierkorb, können Daten darstellen, die auf der Festplatte gespeichert sind, aber nicht als gewöhnliche Dateisystem Objekte.</span><span class="sxs-lookup"><span data-stu-id="8cf82-349">Some virtual folders, such as the Recycle Bin, can represent data that is stored on the hard disk but not as ordinary file system objects.</span></span> <span data-ttu-id="8cf82-350">Einige können gespeicherte Daten darstellen, die sich auf einem Remote System befinden, z. b. ein Handheld-PC oder eine FTP-Site.</span><span class="sxs-lookup"><span data-stu-id="8cf82-350">Some can represent stored data that is on a remote system, such as a handheld PC, or an FTP site.</span></span> <span data-ttu-id="8cf82-351">Andere, wie z. b. der Ordner Drucker, enthalten Objekte, die keine gespeicherten Daten darstellen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-351">Others, such as the Printers folder, contain objects that do not represent stored data at all.</span></span> <span data-ttu-id="8cf82-352">Während einige virtuelle Ordner Teil des Systems sind, können Entwickler auch benutzerdefinierte virtuelle Ordner erstellen und installieren, indem Sie eine Namespace Erweiterung implementieren.</span><span class="sxs-lookup"><span data-stu-id="8cf82-352">While some virtual folders are part of the system, developers can also create and install custom virtual folders by implementing a namespace extension.</span></span>

<span data-ttu-id="8cf82-353">Unabhängig vom Datentyp oder der Art der Speicherung werden die Ordner-und Datei Objekte, die in einem virtuellen Ordner enthalten sind, von der Shell angezeigt, als wären Sie normale Dateien und Ordner.</span><span class="sxs-lookup"><span data-stu-id="8cf82-353">Regardless of the type of data or how it is stored, the folder and file objects that are contained by a virtual folder are presented by the Shell as if they were normal files and folders.</span></span> <span data-ttu-id="8cf82-354">Es liegt in der Verantwortung des virtuellen Ordners, die darin enthaltenen Daten zu übernehmen und Sie der Shell entsprechend darzustellen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-354">It is the responsibility of the virtual folder to take whatever data it contains and present it to the Shell appropriately.</span></span> <span data-ttu-id="8cf82-355">Diese Anforderung bedeutet, dass virtuelle Ordner normalerweise Drag & Drop-Datenübertragungen und Zwischenablage Daten übertragen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-355">This requirement means that virtual folders normally support drag-and-drop and Clipboard data transfers.</span></span>

<span data-ttu-id="8cf82-356">Es gibt zwei Gruppen von Entwicklern, die sich mit der Datenübertragung zu und von virtuellen Ordnern befassen müssen:</span><span class="sxs-lookup"><span data-stu-id="8cf82-356">There are thus two groups of developers who need to be concerned with data transfer to and from virtual folders:</span></span>

-   <span data-ttu-id="8cf82-357">Entwickler, deren Anwendungen Daten akzeptieren müssen, die von einem virtuellen Ordner übertragen werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-357">Developers whose applications need to accept data that is transferred from a virtual folder.</span></span>
-   <span data-ttu-id="8cf82-358">Entwickler, deren Namespace Erweiterungen die Datenübertragung ordnungsgemäß unterstützen müssen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-358">Developers whose namespace extensions need to properly support data transfer.</span></span>

### <a name="accepting-data-from-a-virtual-folder"></a><span data-ttu-id="8cf82-359">Akzeptieren von Daten aus einem virtuellen Ordner</span><span class="sxs-lookup"><span data-stu-id="8cf82-359">Accepting Data from a Virtual Folder</span></span>

<span data-ttu-id="8cf82-360">Virtuelle Ordner können praktisch jeden Datentyp darstellen und können diese Daten in beliebiger Weise speichern.</span><span class="sxs-lookup"><span data-stu-id="8cf82-360">Virtual folders can represent virtually any type of data and can store that data in any way they choose.</span></span> <span data-ttu-id="8cf82-361">Einige virtuelle Ordner enthalten möglicherweise normale Dateisystem Dateien und-Ordner.</span><span class="sxs-lookup"><span data-stu-id="8cf82-361">Some virtual folders might actually contain normal file system files and folders.</span></span> <span data-ttu-id="8cf82-362">Andere können beispielsweise alle Objekte in einem einzelnen Dokument oder in einer Datenbank packen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-362">Others might, for instance, pack all their objects into a single document or database.</span></span>

<span data-ttu-id="8cf82-363">Wenn ein Dateisystem Objekt an eine Anwendung übertragen wird, enthält das Datenobjekt normalerweise ein [CF- \_ HDROP](clipboard.md) -Format mit dem voll qualifizierten Pfad des Objekts.</span><span class="sxs-lookup"><span data-stu-id="8cf82-363">When a file system object is transferred to an application, the data object normally contains a [CF\_HDROP](clipboard.md) format with the object's fully qualified path.</span></span> <span data-ttu-id="8cf82-364">Die Anwendung kann diese Zeichenfolge extrahieren und die normalen Dateisystemfunktionen verwenden, um die Datei zu öffnen und die Daten zu extrahieren.</span><span class="sxs-lookup"><span data-stu-id="8cf82-364">Your application can extract this string and use the normal file system functions to open the file and extract its data.</span></span> <span data-ttu-id="8cf82-365">Da virtuelle Ordner in der Regel jedoch keine normalen Dateisystem Objekte enthalten, verwenden Sie in der Regel nicht [CF \_ HDROP](clipboard.md).</span><span class="sxs-lookup"><span data-stu-id="8cf82-365">However, because virtual folders typically do not contain normal file system objects, they generally do not use [CF\_HDROP](clipboard.md).</span></span>

<span data-ttu-id="8cf82-366">Anstelle von [CF \_ HDROP](clipboard.md)werden Daten normalerweise aus virtuellen Ordnern mit den cfstr [ \_ Filedescriptor](clipboard.md)- / Formaten[cfstr \_ fileContents](clipboard.md) übertragen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-366">Instead of [CF\_HDROP](clipboard.md), data is normally transferred from virtual folders with the [CFSTR\_FILEDESCRIPTOR](clipboard.md)/[CFSTR\_FILECONTENTS](clipboard.md) formats.</span></span> <span data-ttu-id="8cf82-367">Das Format " [cfstr \_ FileContent](clipboard.md) " hat gegenüber [CF \_ HDROP](clipboard.md)zwei Vorteile:</span><span class="sxs-lookup"><span data-stu-id="8cf82-367">The [CFSTR\_FILECONTENTS](clipboard.md) format has two advantages over [CF\_HDROP](clipboard.md):</span></span>

-   <span data-ttu-id="8cf82-368">Es wird keine bestimmte Methode der Datenspeicherung angenommen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-368">No particular method of data storage is assumed.</span></span>
-   <span data-ttu-id="8cf82-369">Das Format ist flexibler.</span><span class="sxs-lookup"><span data-stu-id="8cf82-369">The format is more flexible.</span></span> <span data-ttu-id="8cf82-370">Es unterstützt drei Datenübertragungs Mechanismen: ein globales Speicher Objekt, eine [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) -Schnittstelle oder eine [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) -Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="8cf82-370">It supports three data transfer mechanisms: a global memory object, an [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) interface, or an [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) interface.</span></span>

<span data-ttu-id="8cf82-371">Globale Speicher Objekte werden selten zum Übertragen von Daten in oder von virtuellen Objekten verwendet, da die Daten vollständig in den Arbeitsspeicher kopiert werden müssen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-371">Global memory objects are rarely used to transfer data to or from virtual objects because the data must be copied into memory in its entirety.</span></span> <span data-ttu-id="8cf82-372">Die Übertragung eines Schnittstellen Zeigers erfordert fast keinen Arbeitsspeicher und ist viel effizienter.</span><span class="sxs-lookup"><span data-stu-id="8cf82-372">Transferring an interface pointer requires almost no memory and is much more efficient.</span></span> <span data-ttu-id="8cf82-373">Bei sehr großen Dateien kann ein Schnittstellen Zeiger der einzige praktische Datenübertragungsmechanismus sein.</span><span class="sxs-lookup"><span data-stu-id="8cf82-373">With very large files, an interface pointer might be the only practical data transfer mechanism.</span></span> <span data-ttu-id="8cf82-374">Normalerweise werden Daten durch einen [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) -Zeiger dargestellt, da diese Schnittstelle etwas flexibler als [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage)ist.</span><span class="sxs-lookup"><span data-stu-id="8cf82-374">Typically, data is represented by an [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) pointer, because that interface is somewhat more flexible than [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage).</span></span> <span data-ttu-id="8cf82-375">Das Ziel extrahiert den Zeiger aus dem Datenobjekt und verwendet die Schnittstellen Methoden, um die Daten zu extrahieren.</span><span class="sxs-lookup"><span data-stu-id="8cf82-375">The target extracts the pointer from the data object and uses the interface methods to extract the data.</span></span>

<span data-ttu-id="8cf82-376">Weitere Informationen zur Handhabung der cfstr [ \_ Filedescriptor](clipboard.md)-Datei / [ \_ Inhalts](clipboard.md) Formate finden [Sie unter Verwenden des Datei \_ Inhalts Formats von cfstr zum Extrahieren von Daten aus einer Datei](/windows).</span><span class="sxs-lookup"><span data-stu-id="8cf82-376">For further discussion of how to handle the [CFSTR\_FILEDESCRIPTOR](clipboard.md)/[CFSTR\_FILECONTENTS](clipboard.md) formats, see [Using the CFSTR\_FILECONTENTS Format to Extract Data from a File](/windows).</span></span>

### <a name="transferring-data-to-and-from-a-namespace-extension"></a><span data-ttu-id="8cf82-377">Übertragen von Daten in eine und aus einer Namespace Erweiterung</span><span class="sxs-lookup"><span data-stu-id="8cf82-377">Transferring Data to and from a NameSpace Extension</span></span>

<span data-ttu-id="8cf82-378">Wenn Sie eine Namespace Erweiterung implementieren, werden Sie normalerweise Drag & Drop-Funktionen unterstützen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-378">When you implement a namespace extension, you will normally want to support drag-and-drop capabilities.</span></span> <span data-ttu-id="8cf82-379">Befolgen Sie die Empfehlungen für Drop Sources und Targets, die unter [Allgemeine Richtlinien](#general-guidelines)erläutert werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-379">Follow the recommendations for drop sources and targets discussed in [General Guidelines](#general-guidelines).</span></span> <span data-ttu-id="8cf82-380">Insbesondere muss eine Namespace Erweiterung Folgendes ausführen:</span><span class="sxs-lookup"><span data-stu-id="8cf82-380">In particular, a namespace extension must:</span></span>

-   <span data-ttu-id="8cf82-381">Sie können die cfstr [ \_ Filedescriptor](clipboard.md) / [cfstr \_ FileContent](clipboard.md) -Formate verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="8cf82-381">Be able to handle the [CFSTR\_FILEDESCRIPTOR](clipboard.md)/[CFSTR\_FILECONTENTS](clipboard.md) formats.</span></span> <span data-ttu-id="8cf82-382">Diese beiden Formate werden normalerweise zum Übertragen von Objekten in und aus Namespace Erweiterungen verwendet.</span><span class="sxs-lookup"><span data-stu-id="8cf82-382">These two formats are normally used to transfer objects to and from namespace extensions.</span></span>
-   <span data-ttu-id="8cf82-383">Kann [optimierte](#handling-optimized-move-operations)Verschiebungen verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="8cf82-383">Be able to handle [optimized moves](#handling-optimized-move-operations).</span></span> <span data-ttu-id="8cf82-384">Die Shell erwartet, dass Shellobjekte mit optimiertem Verschiebe Vorgang verschoben werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-384">The Shell expects that Shell objects will be moved with an optimized move.</span></span>
-   <span data-ttu-id="8cf82-385">Kann einen [Lösch](#handling-delete-on-paste-operations) Vorgang verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="8cf82-385">Be able to handle a [delete-on-paste](#handling-delete-on-paste-operations) operation.</span></span> <span data-ttu-id="8cf82-386">Die Shell verwendet DELETE-on-Copy, wenn Objekte mit einem Ausschneide-/Einfügevorgang aus der Shell verschoben werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-386">The Shell uses delete-on-paste when objects are moved from the Shell with a cut/paste operation.</span></span>
-   <span data-ttu-id="8cf82-387">Kann die Datenübertragung über eine [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) -oder [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) -Schnittstelle verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="8cf82-387">Be able to handle data transfer through an [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) or [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) interface.</span></span> <span data-ttu-id="8cf82-388">Die Datenübertragung zu oder von einem virtuellen Ordner erfolgt normalerweise durch Übertragung eines dieser beiden Schnittstellen Zeiger, in der Regel ein **IStream** -Zeiger.</span><span class="sxs-lookup"><span data-stu-id="8cf82-388">Data transfer to or from a virtual folder is normally handled by transferring one of these two interface pointers, typically an **IStream** pointer.</span></span> <span data-ttu-id="8cf82-389">Das Ziel ruft dann die Schnittstellen Methoden auf, um die Daten zu extrahieren:</span><span class="sxs-lookup"><span data-stu-id="8cf82-389">The target then calls the interface methods to extract the data:</span></span>
    -   -   <span data-ttu-id="8cf82-390">Als Drop-Quelle muss die Namespace Erweiterung die Daten aus dem Speicher extrahieren und diese Schnittstelle an das Ziel übergeben.</span><span class="sxs-lookup"><span data-stu-id="8cf82-390">As a drop source, the namespace extension must extract the data from storage and pass it through this interface to the target.</span></span>
        -   <span data-ttu-id="8cf82-391">Als Drop-Ziel muss eine Namespace Erweiterung Daten von einer Quelle über diese Schnittstelle akzeptieren und ordnungsgemäß speichern.</span><span class="sxs-lookup"><span data-stu-id="8cf82-391">As a drop target, a namespace extension must accept data from a source through this interface and store it properly.</span></span>

## <a name="dropping-files-on-the-recycle-bin"></a><span data-ttu-id="8cf82-392">Löschen von Dateien im Papierkorb</span><span class="sxs-lookup"><span data-stu-id="8cf82-392">Dropping Files on the Recycle Bin</span></span>

<span data-ttu-id="8cf82-393">**Szenario:** Der Benutzer löscht eine Datei im **Papierkorb**.</span><span class="sxs-lookup"><span data-stu-id="8cf82-393">**Scenario:** The user drops a file on the **Recycle Bin**.</span></span> <span data-ttu-id="8cf82-394">Die ursprüngliche Datei wird von der Anwendung oder der Namespace Erweiterung gelöscht.</span><span class="sxs-lookup"><span data-stu-id="8cf82-394">Your application or namespace extension deletes the original file.</span></span>

<span data-ttu-id="8cf82-395">Der Papierkorb ist ein virtueller Ordner, der als Repository für Dateien verwendet wird, die nicht mehr benötigt werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-395">The Recycle Bin is a virtual folder that is used as a repository for files that are no longer needed.</span></span> <span data-ttu-id="8cf82-396">Solange der Papierkorb nicht geleert wurde, kann der Benutzer die Datei später wiederherstellen und an das Dateisystem zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="8cf82-396">As long as the Recycle Bin has not been emptied, the user can later recover the file and return it to the file system.</span></span>

<span data-ttu-id="8cf82-397">Zum größten Teil funktioniert das Übertragen von shellobjekten in den Papierkorb ähnlich wie jeder andere Ordner.</span><span class="sxs-lookup"><span data-stu-id="8cf82-397">For the most part, transferring Shell objects to the Recycle Bin works much like any other folder.</span></span> <span data-ttu-id="8cf82-398">Wenn ein Benutzer jedoch eine Datei im **Papierkorb** löscht, muss die Quelle das Original löschen, auch wenn das Feedback aus dem Ordner einen Kopiervorgang angibt.</span><span class="sxs-lookup"><span data-stu-id="8cf82-398">However, when a user drops a file on the **Recycle Bin**, the source needs to delete the original, even if the feedback from the folder indicates a copy operation.</span></span> <span data-ttu-id="8cf82-399">Normalerweise kann eine Ablage Quelle nicht wissen, in welchem Ordner das Datenobjekt abgelegt wurde.</span><span class="sxs-lookup"><span data-stu-id="8cf82-399">Normally, a drop source has no way of knowing which folder its data object has been dropped on.</span></span> <span data-ttu-id="8cf82-400">Wenn jedoch für Windows 2000 und spätere Systeme ein Datenobjekt im **Papierkorb** abgelegt wird, ruft die Shell die [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) -Methode des Datenobjekts mit einem [cfstr \_ targetclsid](clipboard.md) -Format auf, das auf den Klassen Bezeichner (CLSID) (CLSID) des Papierkorbs festgelegt ist \_ .</span><span class="sxs-lookup"><span data-stu-id="8cf82-400">However, for Windows 2000 and later systems, when a data object is dropped on the **Recycle Bin**, the Shell will call the data object's [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) method with a [CFSTR\_TARGETCLSID](clipboard.md) format set to the Recycle Bin's class identifier (CLSID) (CLSID\_RecycleBin).</span></span> <span data-ttu-id="8cf82-401">Damit der Papierkorb ordnungsgemäß verarbeitet wird, sollte das Datenobjekt in der Lage sein, dieses Format zu erkennen und die Informationen über eine private Schnittstelle an die Quelle zu übermitteln.</span><span class="sxs-lookup"><span data-stu-id="8cf82-401">To handle the Recycle Bin case properly, your data object should be able to recognize this format and communicate the information to the source through a private interface.</span></span>

> [!Note]  
> <span data-ttu-id="8cf82-402">Wenn [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) mit dem Format " [cfstr \_ targetclsid](clipboard.md) " aufgerufen wird, das auf "CLSID RecycleBin" festgelegt ist \_ , sollte die Datenquelle alle geöffneten Handles für die Objekte schließen, die übertragen werden, bevor Sie von der Methode zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-402">When [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) is called with a [CFSTR\_TARGETCLSID](clipboard.md) format set to CLSID\_RecycleBin, the data source should close any open handles to the objects that are being transferred before returning from the method.</span></span> <span data-ttu-id="8cf82-403">Andernfalls können Sie Freigabe Verletzungen erstellen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-403">Otherwise, you might create sharing violations.</span></span>

 

## <a name="creating-and-importing-scrap-files"></a><span data-ttu-id="8cf82-404">Erstellen und Importieren von Schrott Dateien</span><span class="sxs-lookup"><span data-stu-id="8cf82-404">Creating and Importing Scrap Files</span></span>

<span data-ttu-id="8cf82-405">**Szenario:** Ein Benutzer zieht einige Daten aus der Datendatei einer OLE-Anwendung und löscht Sie auf dem Desktop oder Windows-Explorer.</span><span class="sxs-lookup"><span data-stu-id="8cf82-405">**Scenario:** A user drags some data from an OLE application's data file and drops it on the desktop or Windows Explorer.</span></span>

<span data-ttu-id="8cf82-406">Mithilfe von Windows können Benutzer ein Objekt aus der Datendatei einer OLE-Anwendung ziehen und auf dem Desktop oder einem Dateisystem Ordner ablegen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-406">Windows allows users to drag an object from an OLE application's data file and drop it on the desktop or a file system folder.</span></span> <span data-ttu-id="8cf82-407">Mit diesem Vorgang wird eine *Dumpdatei* erstellt, die die Daten oder einen Link zu den Daten enthält.</span><span class="sxs-lookup"><span data-stu-id="8cf82-407">This operation creates a *scrap file*, which contains the data or a link to the data.</span></span> <span data-ttu-id="8cf82-408">Der Dateiname stammt aus dem Kurznamen, der für die CLSID des Objekts und den [CF- \_ Textdaten](clipboard.md) registriert ist.</span><span class="sxs-lookup"><span data-stu-id="8cf82-408">The file name is taken from the short name registered for the CLSID of the object and the [CF\_TEXT](clipboard.md) data.</span></span> <span data-ttu-id="8cf82-409">Damit die Shell eine Ablage Datei mit Daten erstellt, muss die [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) -Schnittstelle der Anwendung das CF \_ embedsource-Zwischenablage Format unterstützen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-409">For the Shell to create a scrap file containing data, the application's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface must support the CF\_EMBEDSOURCE Clipboard format.</span></span> <span data-ttu-id="8cf82-410">Um eine Datei zu erstellen, die einen Link enthält, muss **IDataObject** das CF- \_ LinkSource-Format unterstützen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-410">To create a file containing a link, **IDataObject** must support the CF\_LINKSOURCE format.</span></span>

<span data-ttu-id="8cf82-411">Es gibt auch drei optionale Features, die eine Anwendung zur Unterstützung von Schrott Dateien implementieren kann:</span><span class="sxs-lookup"><span data-stu-id="8cf82-411">There are also three optional features that an application can implement to support scrap files:</span></span>

-   <span data-ttu-id="8cf82-412">Roundtrip-Unterstützung</span><span class="sxs-lookup"><span data-stu-id="8cf82-412">Round-trip support</span></span>
-   <span data-ttu-id="8cf82-413">Zwischengespeicherte Datenformate</span><span class="sxs-lookup"><span data-stu-id="8cf82-413">Cached data formats</span></span>
-   <span data-ttu-id="8cf82-414">Verzögertes Rendering</span><span class="sxs-lookup"><span data-stu-id="8cf82-414">Delayed rendering</span></span>

### <a name="round-trip-support"></a><span data-ttu-id="8cf82-415">Roundtrip-Unterstützung</span><span class="sxs-lookup"><span data-stu-id="8cf82-415">Round-trip Support</span></span>

<span data-ttu-id="8cf82-416">Ein *Roundtrip* umfasst das übertragen eines Datenobjekts in einen anderen Container und dann zurück zum ursprünglichen Dokument.</span><span class="sxs-lookup"><span data-stu-id="8cf82-416">A *round trip* involves transferring a data object to another container and then back to the original document.</span></span> <span data-ttu-id="8cf82-417">Beispielsweise kann ein Benutzer eine Gruppe von Zellen aus einer Kalkulations Tabelle auf den Desktop übertragen und dabei eine Dumpdatei mit den Daten erstellen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-417">For instance, a user could transfer a group of cells from a spreadsheet to the desktop, creating a scrap file with the data.</span></span> <span data-ttu-id="8cf82-418">Wenn der Benutzer den Schrott dann wieder in die Kalkulations Tabelle überträgt, müssen die Daten in das Dokument integriert werden, so wie es vor der ursprünglichen Übertragung der Fall war.</span><span class="sxs-lookup"><span data-stu-id="8cf82-418">If the user then transfers the scrap back to the spreadsheet, the data needs to be integrated into the document as it was before the original transfer.</span></span>

<span data-ttu-id="8cf82-419">Wenn die Shell die Schrott Datei erstellt, stellt Sie die Daten als Einbettungs Objekt dar.</span><span class="sxs-lookup"><span data-stu-id="8cf82-419">When the Shell creates the scrap file, it represents the data as an embedding object.</span></span> <span data-ttu-id="8cf82-420">Wenn der Schrott an einen anderen Container übertragen wird, wird er als Einbettungs Objekt übertragen, auch wenn er an das ursprüngliche Dokument zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="8cf82-420">When the scrap is transferred to another container, it is transferred as an embedding object, even if it is being returned to the original document.</span></span> <span data-ttu-id="8cf82-421">Ihre Anwendung ist dafür verantwortlich, das im Schrott enthaltene Datenformat zu ermitteln und die Daten bei Bedarf wieder in das systemeigene Format zu versetzen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-421">Your application is responsible for determining the data format contained in the scrap and putting the data back into its native format if necessary.</span></span>

<span data-ttu-id="8cf82-422">Um das Format des eingebetteten Objekts festzulegen, bestimmen Sie seine CLSID, indem Sie das CF \_ objectdescriptor-Format des Objekts abrufen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-422">To establish the format of the embedded object, determine its CLSID by retrieving the object's CF\_OBJECTDESCRIPTOR format.</span></span> <span data-ttu-id="8cf82-423">Wenn die CLSID ein Datenformat angibt, das der Anwendung angehört, sollte Sie die systemeigenen Daten übertragen, anstatt [**olecreatefromdata**](/windows/win32/api/ole2/nf-ole2-olecreatefromdata)aufrufen zu müssen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-423">If the CLSID indicates a data format that belongs to the application, it should transfer the native data instead of calling [**OleCreateFromData**](/windows/win32/api/ole2/nf-ole2-olecreatefromdata).</span></span>

### <a name="cached-data-formats"></a><span data-ttu-id="8cf82-424">Zwischengespeicherte Datenformate</span><span class="sxs-lookup"><span data-stu-id="8cf82-424">Cached Data Formats</span></span>

<span data-ttu-id="8cf82-425">Wenn die Shell eine Schrott Datei erstellt, wird die Registrierung auf die Liste der verfügbaren Formate überprüft.</span><span class="sxs-lookup"><span data-stu-id="8cf82-425">When the Shell creates a scrap file, it checks the registry for the list of available formats.</span></span> <span data-ttu-id="8cf82-426">Standardmäßig sind zwei Formate verfügbar: CF \_ embedsource und CF \_ LinkSource.</span><span class="sxs-lookup"><span data-stu-id="8cf82-426">By default, there are two formats available: CF\_EMBEDSOURCE and CF\_LINKSOURCE.</span></span> <span data-ttu-id="8cf82-427">Es gibt jedoch eine Reihe von Szenarien, in denen Anwendungen möglicherweise Dateien in verschiedenen Formaten haben müssen:</span><span class="sxs-lookup"><span data-stu-id="8cf82-427">However, there are a number of scenarios where applications might need to have scrap files in different formats:</span></span>

-   <span data-ttu-id="8cf82-428">, Um das Übertragen von Daten Auszüge an nicht-OLE-Container zuzulassen, wodurch eingebettete Objekt Formate nicht akzeptiert werden können.</span><span class="sxs-lookup"><span data-stu-id="8cf82-428">To allow scraps to be transferred to non-OLE containers, which cannot accepted embedded object formats.</span></span>
-   <span data-ttu-id="8cf82-429">, Damit Suites von Anwendungen mit einem privaten Format kommunizieren können.</span><span class="sxs-lookup"><span data-stu-id="8cf82-429">To allow suites of applications to communicate with a private format.</span></span>
-   <span data-ttu-id="8cf82-430">, Um Roundtrips einfacher zu handhaben.</span><span class="sxs-lookup"><span data-stu-id="8cf82-430">To make round trips easier to handle.</span></span>

<span data-ttu-id="8cf82-431">Anwendungen können dem Schrott Formate hinzufügen, indem Sie Sie in der Registrierung Zwischenspeichern.</span><span class="sxs-lookup"><span data-stu-id="8cf82-431">Applications can add formats to the scrap by caching them in the registry.</span></span> <span data-ttu-id="8cf82-432">Es gibt zwei Arten von zwischengespeicherten Formaten:</span><span class="sxs-lookup"><span data-stu-id="8cf82-432">There are two types of cached formats:</span></span>

-   <span data-ttu-id="8cf82-433">Prioritäts Cache Formate.</span><span class="sxs-lookup"><span data-stu-id="8cf82-433">Priority cache formats.</span></span> <span data-ttu-id="8cf82-434">Für diese Formate werden die Daten vollständig aus dem Datenobjekt in den Schrott kopiert.</span><span class="sxs-lookup"><span data-stu-id="8cf82-434">For these formats, the data is copied in its entirety into the scrap from the data object.</span></span>
-   <span data-ttu-id="8cf82-435">Verzögert gerenderte Formate.</span><span class="sxs-lookup"><span data-stu-id="8cf82-435">Delay-rendered formats.</span></span> <span data-ttu-id="8cf82-436">Für diese Formate wird das Datenobjekt nicht in den Schrott kopiert.</span><span class="sxs-lookup"><span data-stu-id="8cf82-436">For these formats, the data object is not copied to the scrap.</span></span> <span data-ttu-id="8cf82-437">Stattdessen wird das Rendering verzögert, bis ein Ziel die Daten anfordert.</span><span class="sxs-lookup"><span data-stu-id="8cf82-437">Instead, rendering is delayed until a target requests the data.</span></span> <span data-ttu-id="8cf82-438">Das Verzögerungs Rendering wird im nächsten Abschnitt ausführlicher erläutert.</span><span class="sxs-lookup"><span data-stu-id="8cf82-438">Delay-rendering is discussed in more detail in the next section.</span></span>

<span data-ttu-id="8cf82-439">Zum Hinzufügen eines Prioritäts Caches oder eines verzögerten gerenderten Formats erstellen Sie unter dem **CLSID** -Schlüssel der Anwendung, bei der es sich um die Datenquelle handelt, einen **DataFormat** -Unterschlüssel.</span><span class="sxs-lookup"><span data-stu-id="8cf82-439">To add a priority cache or delay-rendered format, create a **DataFormat** subkey under the **CLSID** key of the application that is the source of the data.</span></span> <span data-ttu-id="8cf82-440">Erstellen Sie unter diesem Unterschlüssel einen **prioritycacheformats** -oder einen **Delta Format** -Unterschlüssel.</span><span class="sxs-lookup"><span data-stu-id="8cf82-440">Under that subkey, create a **PriorityCacheFormats** or **DelayRenderFormats** subkey.</span></span> <span data-ttu-id="8cf82-441">Erstellen Sie für jeden Prioritäts Cache oder das verzögert gerenderte Format einen nummerierten Unterschlüssel, beginnend mit 0 (null).</span><span class="sxs-lookup"><span data-stu-id="8cf82-441">For each priority cache or delay-rendered format, create a numbered subkey starting with zero.</span></span> <span data-ttu-id="8cf82-442">Legen Sie den Wert dieses Schlüssels entweder auf eine Zeichenfolge mit dem registrierten Namen des Formats oder einen \# X-Wert fest, wobei X die Format Nummer eines standardmäßigen Zwischenablage Formats darstellt.</span><span class="sxs-lookup"><span data-stu-id="8cf82-442">Set the value of this key to either a string with the registered name of the format or a \#X value, where X represents the format number of a standard Clipboard format.</span></span>

<span data-ttu-id="8cf82-443">Das folgende Beispiel zeigt zwischengespeicherte Formate für zwei Anwendungen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-443">The following sample shows cached formats for two applications.</span></span> <span data-ttu-id="8cf82-444">Die MyProg1-Anwendung hat das Rich-Text-Format als Prioritäts Cache Format und das private Format "My Format" als verzögert gerendertes Format.</span><span class="sxs-lookup"><span data-stu-id="8cf82-444">The MyProg1 application has the rich-text format as a priority cache format, and a private format "My Format" as a delay-rendered format.</span></span> <span data-ttu-id="8cf82-445">Die MyProg2-Anwendung hat das CF- \_ Bitmapformat ( \# 8) als Prioritäts Cache Format.</span><span class="sxs-lookup"><span data-stu-id="8cf82-445">The MyProg2 application has the CF\_BITMAP format (\#8") as a priority cache format.</span></span>

```
HKEY_CLASSES_ROOT
   CLSID
      {GUID}
         (Default) = MyProg1
         DataFormats
            PriorityCacheFormats
               0
                  (Default) = Rich Text Format
            DelayRenderFormats
               0
                  (Default) = My Format
      {GUID}
         (Default) = MyProg2
         DataFormats
            PriorityCacheFormats
               0
                  (Default) = #8
```

<span data-ttu-id="8cf82-446">Weitere Formate können hinzugefügt werden, indem zusätzliche nummerierte Unterschlüssel erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-446">Additional formats can be added by creating additional numbered subkeys.</span></span>

### <a name="delayed-rendering"></a><span data-ttu-id="8cf82-447">Verzögertes Rendering</span><span class="sxs-lookup"><span data-stu-id="8cf82-447">Delayed Rendering</span></span>

<span data-ttu-id="8cf82-448">Ein verzögertes Renderingformat ermöglicht einer Anwendung, eine Schrott Datei zu erstellen, aber die Kosten für das Rendern der Daten zu verzögern, bis Sie von einem Ziel angefordert werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-448">A delayed rendering format allows an application to create a scrap file but delay the expense of rendering the data until it is requested by a target.</span></span> <span data-ttu-id="8cf82-449">Die [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) -Schnittstelle eines Schrott Angebots bietet die verzögerten Renderingformate für das Ziel zusammen mit nativen und zwischengespeicherten Daten.</span><span class="sxs-lookup"><span data-stu-id="8cf82-449">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface of a scrap will offer the delayed rendering formats to the target along with native and cached data.</span></span> <span data-ttu-id="8cf82-450">Wenn das Ziel ein verzögertes Renderingformat anfordert, führt die Shell die Anwendung aus und stellt die Daten für das Ziel aus dem aktiven Objekt bereit.</span><span class="sxs-lookup"><span data-stu-id="8cf82-450">If the target requests a delayed rendering format, the Shell will run the application and provide the data to the target from the active object.</span></span>

> [!Note]  
> <span data-ttu-id="8cf82-451">Da das verzögerte Rendering etwas riskant ist, sollte es mit Bedacht verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-451">Because delayed rendering is somewhat risky, it should be used with caution.</span></span> <span data-ttu-id="8cf82-452">Dies funktioniert nicht, wenn der Server nicht verfügbar ist, oder bei Anwendungen, die nicht OLE-fähig sind.</span><span class="sxs-lookup"><span data-stu-id="8cf82-452">It will not work if the server is not available, or on applications that are not OLE-enabled.</span></span>

 

## <a name="dragging-and-dropping-shell-objects-asynchronously"></a><span data-ttu-id="8cf82-453">Asynchrones ziehen und Ablegen von shellobjekten</span><span class="sxs-lookup"><span data-stu-id="8cf82-453">Dragging and Dropping Shell Objects Asynchronously</span></span>

<span data-ttu-id="8cf82-454">**Szenario:** Ein Benutzer überträgt einen großen Datenblock von der Quelle zum Ziel.</span><span class="sxs-lookup"><span data-stu-id="8cf82-454">**Scenario:** A user transfers a large block of data from source to target.</span></span> <span data-ttu-id="8cf82-455">Um zu vermeiden, dass beide Anwendungen für einen beträchtlichen Zeitraum blockiert werden, extrahiert das Ziel die Daten asynchron.</span><span class="sxs-lookup"><span data-stu-id="8cf82-455">To avoid blocking both applications for a significant amount of time, the target extracts the data asynchronously.</span></span>

<span data-ttu-id="8cf82-456">Normalerweise ist Drag & amp; Drop ein synchroner Vorgang.</span><span class="sxs-lookup"><span data-stu-id="8cf82-456">Normally, drag-and-drop is a synchronous operation.</span></span> <span data-ttu-id="8cf82-457">Kurz gesagt:</span><span class="sxs-lookup"><span data-stu-id="8cf82-457">In brief:</span></span>

1.  <span data-ttu-id="8cf82-458">Die Drop-Quelle ruft [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) auf und blockiert ihren primären Thread, bis die Funktion zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="8cf82-458">The drop source calls [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) and blocks its primary thread until the function returns.</span></span> <span data-ttu-id="8cf82-459">Das Blockieren des primären Threads blockiert normalerweise die UI-Verarbeitung.</span><span class="sxs-lookup"><span data-stu-id="8cf82-459">Blocking the primary thread normally blocks UI processing.</span></span>
2.  <span data-ttu-id="8cf82-460">Nachdem die [**IDropTarget::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) -Methode des Ziels aufgerufen wurde, extrahiert das Ziel die Daten aus dem Datenobjekt im primären Thread.</span><span class="sxs-lookup"><span data-stu-id="8cf82-460">After the target's [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) method is called, the target extracts the data from the data object on its primary thread.</span></span> <span data-ttu-id="8cf82-461">Diese Prozedur blockiert normalerweise die UI-Verarbeitung des Ziels für die Dauer des Extraktions Vorgangs.</span><span class="sxs-lookup"><span data-stu-id="8cf82-461">This procedure normally blocks the target's UI processing for the duration of the extraction process.</span></span>
3.  <span data-ttu-id="8cf82-462">Nachdem die Daten extrahiert wurden, gibt das Ziel den [**IDropTarget::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) -Rückruf zurück, das System gibt [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop)zurück, und beide Threads können fortgesetzt werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-462">Once the data has been extracted, the target returns the [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) call, the system returns [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop), and both threads can proceed.</span></span>

<span data-ttu-id="8cf82-463">Kurz gesagt, kann die synchrone Datenübertragung die primären Threads beider Anwendungen für einen beträchtlichen Zeitraum blockieren.</span><span class="sxs-lookup"><span data-stu-id="8cf82-463">In short, synchronous data transfer can block the primary threads of both applications for a significant amount of time.</span></span> <span data-ttu-id="8cf82-464">Insbesondere müssen beide Threads warten, während die Daten vom Ziel extrahiert werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-464">In particular, both threads must wait while the target extracts the data.</span></span> <span data-ttu-id="8cf82-465">Bei kleinen Datenmengen ist die Zeit, die zum Extrahieren von Daten erforderlich ist, gering, und die synchrone Datenübertragung funktioniert sehr gut.</span><span class="sxs-lookup"><span data-stu-id="8cf82-465">For small amounts of data, the time required to extract data is small and synchronous data transfer works quite well.</span></span> <span data-ttu-id="8cf82-466">Das synchrone extrahieren großer Datenmengen kann jedoch zu langen Verzögerungen führen und die Benutzeroberfläche von Ziel und Quelle beeinträchtigen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-466">However, synchronously extracting large amounts of data can cause lengthy delays and interfere with the UI of both target and source.</span></span>

<span data-ttu-id="8cf82-467">Die [**iasyncoperation**](/previous-versions//bb776309(v=vs.85)) / [**idataobjectasynccapability**](/windows/desktop/api/Shldisp/nn-shldisp-idataobjectasynccapability) -Schnittstelle ist eine optionale Schnittstelle, die von einem Datenobjekt implementiert werden kann.</span><span class="sxs-lookup"><span data-stu-id="8cf82-467">The [**IAsyncOperation**](/previous-versions//bb776309(v=vs.85))/[**IDataObjectAsyncCapability**](/windows/desktop/api/Shldisp/nn-shldisp-idataobjectasynccapability) interface is an optional interface that can be implemented by a data object.</span></span> <span data-ttu-id="8cf82-468">Sie ermöglicht dem Dropziel das asynchrone Extrahieren von Daten aus dem Datenobjekt in einem Hintergrund Thread.</span><span class="sxs-lookup"><span data-stu-id="8cf82-468">It gives the drop target the ability to extract data from the data object asynchronously on a background thread.</span></span> <span data-ttu-id="8cf82-469">Nachdem die Datenextraktion an den Hintergrund Thread übergeben wurde, können die primären Threads beider Anwendungen fortgesetzt werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-469">Once data extraction is handed off to the background thread, the primary threads of both applications are free to proceed.</span></span>

### <a name="using-iasyncoperationidataobjectasynccapability"></a><span data-ttu-id="8cf82-470">Verwenden von iasyncoperation/idataobjectasynccapability</span><span class="sxs-lookup"><span data-stu-id="8cf82-470">Using IASyncOperation/IDataObjectAsyncCapability</span></span>

> [!Note]  
> <span data-ttu-id="8cf82-471">Die Schnittstelle wurde ursprünglich als " [**iasyncoperation**](/previous-versions//bb776309(v=vs.85))" bezeichnet, aber später in " [**idataobjectasynccapability**](/windows/desktop/api/Shldisp/nn-shldisp-idataobjectasynccapability)" geändert.</span><span class="sxs-lookup"><span data-stu-id="8cf82-471">The interface was originally named [**IAsyncOperation**](/previous-versions//bb776309(v=vs.85)), but this was later changed to [**IDataObjectAsyncCapability**](/windows/desktop/api/Shldisp/nn-shldisp-idataobjectasynccapability).</span></span> <span data-ttu-id="8cf82-472">Andernfalls sind die beiden Schnittstellen identisch.</span><span class="sxs-lookup"><span data-stu-id="8cf82-472">Otherwise, the two interfaces are identical.</span></span>

 

<span data-ttu-id="8cf82-473">Der Zweck von [**iasyncoperation**](/previous-versions//bb776309(v=vs.85)) / [**idataobjectasynccapability**](/windows/desktop/api/Shldisp/nn-shldisp-idataobjectasynccapability) besteht darin, dass die Drop-Quelle und das Ablage Ziel aushandeln, ob Daten asynchron extrahiert werden können.</span><span class="sxs-lookup"><span data-stu-id="8cf82-473">The purpose of [**IAsyncOperation**](/previous-versions//bb776309(v=vs.85))/[**IDataObjectAsyncCapability**](/windows/desktop/api/Shldisp/nn-shldisp-idataobjectasynccapability) is to allow the drop source and drop target to negotiate whether data can be extracted asynchronously.</span></span> <span data-ttu-id="8cf82-474">Im folgenden Verfahren wird erläutert, wie die Drop-Quelle die-Schnittstelle verwendet:</span><span class="sxs-lookup"><span data-stu-id="8cf82-474">The following procedure outlines how the drop source uses the interface:</span></span>

1.  <span data-ttu-id="8cf82-475">Erstellen Sie ein Datenobjekt, das [**iasyncoperation**](/previous-versions//bb776309(v=vs.85)) / [**idataobjectasynccapability**](/windows/desktop/api/Shldisp/nn-shldisp-idataobjectasynccapability)verfügbar macht.</span><span class="sxs-lookup"><span data-stu-id="8cf82-475">Create a data object that exposes [**IAsyncOperation**](/previous-versions//bb776309(v=vs.85))/[**IDataObjectAsyncCapability**](/windows/desktop/api/Shldisp/nn-shldisp-idataobjectasynccapability).</span></span>
2.  <span data-ttu-id="8cf82-476">Setzen Sie [**setasyncmode**](/windows/desktop/api/Shldisp/nf-shldisp-idataobjectasynccapability-setasyncmode) mit *fdoopasync* auf **Variant \_ true** , um anzugeben, dass ein asynchroner Vorgang unterstützt wird.</span><span class="sxs-lookup"><span data-stu-id="8cf82-476">Call [**SetAsyncMode**](/windows/desktop/api/Shldisp/nf-shldisp-idataobjectasynccapability-setasyncmode) with *fDoOpAsync* set to **VARIANT\_TRUE** to indicate that an asynchronous operation is supported.</span></span>
3.  <span data-ttu-id="8cf82-477">Nachdem [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) zurückgegeben wurde, wird [**inoperation**](/windows/desktop/api/Shldisp/nf-shldisp-idataobjectasynccapability-inoperation)aufgerufen:</span><span class="sxs-lookup"><span data-stu-id="8cf82-477">After [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) returns, call [**InOperation**](/windows/desktop/api/Shldisp/nf-shldisp-idataobjectasynccapability-inoperation):</span></span>
    -   <span data-ttu-id="8cf82-478">Wenn [**inoperation**](/windows/desktop/api/Shldisp/nf-shldisp-idataobjectasynccapability-inoperation) fehlschlägt oder **Variant \_ false** zurückgibt, wurde eine normale synchrone Datenübertragung durchgeführt, und der Daten Extraktions Vorgang ist abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-478">If [**InOperation**](/windows/desktop/api/Shldisp/nf-shldisp-idataobjectasynccapability-inoperation) fails or returns **VARIANT\_FALSE**, a normal synchronous data transfer has taken place and the data extraction process is finished.</span></span> <span data-ttu-id="8cf82-479">Die Quelle sollte alle erforderlichen Bereinigungs Schritte ausführen und den Vorgang fortsetzen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-479">The source should do any cleanup that is required, and proceed.</span></span>
    -   <span data-ttu-id="8cf82-480">Wenn [**inoperation**](/windows/desktop/api/Shldisp/nf-shldisp-idataobjectasynccapability-inoperation) **Variant \_ true** zurückgibt, werden die Daten asynchron extrahiert.</span><span class="sxs-lookup"><span data-stu-id="8cf82-480">If [**InOperation**](/windows/desktop/api/Shldisp/nf-shldisp-idataobjectasynccapability-inoperation) returns **VARIANT\_TRUE**, the data is being extracted asynchronously.</span></span> <span data-ttu-id="8cf82-481">Bereinigungs Vorgänge sollten von [**EndOperation**](/windows/desktop/api/Shldisp/nf-shldisp-idataobjectasynccapability-endoperation)behandelt werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-481">Cleanup operations should be handled by [**EndOperation**](/windows/desktop/api/Shldisp/nf-shldisp-idataobjectasynccapability-endoperation).</span></span>
4.  <span data-ttu-id="8cf82-482">Geben Sie das Datenobjekt frei.</span><span class="sxs-lookup"><span data-stu-id="8cf82-482">Release the data object.</span></span>
5.  <span data-ttu-id="8cf82-483">Wenn die asynchrone Datenübertragung beendet ist, benachrichtigt das Datenobjekt die Quelle normalerweise über eine private Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="8cf82-483">When the asynchronous data transfer is complete, the data object normally notifies the source through a private interface.</span></span>

<span data-ttu-id="8cf82-484">Im folgenden Verfahren wird erläutert, wie das Ablage Ziel die [**iasyncoperation**](/previous-versions//bb776309(v=vs.85)) / [**idataobjectasynccapability**](/windows/desktop/api/Shldisp/nn-shldisp-idataobjectasynccapability) -Schnittstelle zum asynchronen Extrahieren von Daten verwendet:</span><span class="sxs-lookup"><span data-stu-id="8cf82-484">The following procedure outlines how the drop target uses the [**IAsyncOperation**](/previous-versions//bb776309(v=vs.85))/[**IDataObjectAsyncCapability**](/windows/desktop/api/Shldisp/nn-shldisp-idataobjectasynccapability) interface to extract data asynchronously:</span></span>

1.  <span data-ttu-id="8cf82-485">Wenn das System [**IDropTarget::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop)aufruft, rufen Sie [**IDataObject:: QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) auf, und fordern Sie eine [**iasyncoperation**](/previous-versions//bb776309(v=vs.85)) / [**idataobjectasynccapability**](/windows/desktop/api/Shldisp/nn-shldisp-idataobjectasynccapability) -Schnittstelle (IID \_ iasyncoperation/IID \_ idataobjectasynccapability) aus dem Datenobjekt an.</span><span class="sxs-lookup"><span data-stu-id="8cf82-485">When the system calls [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop), call [**IDataObject::QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) and request an [**IAsyncOperation**](/previous-versions//bb776309(v=vs.85))/[**IDataObjectAsyncCapability**](/windows/desktop/api/Shldisp/nn-shldisp-idataobjectasynccapability) interface (IID\_IAsyncOperation/IID\_IDataObjectAsyncCapability) from the data object.</span></span>
2.  <span data-ttu-id="8cf82-486">[**Getasyncmode**](/windows/desktop/api/Shldisp/nf-shldisp-idataobjectasynccapability-getasyncmode)aufrufen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-486">Call [**GetAsyncMode**](/windows/desktop/api/Shldisp/nf-shldisp-idataobjectasynccapability-getasyncmode).</span></span> <span data-ttu-id="8cf82-487">Wenn die Methode **Variant \_ true** zurückgibt, unterstützt das Datenobjekt die asynchrone Datenextraktion.</span><span class="sxs-lookup"><span data-stu-id="8cf82-487">If the method returns **VARIANT\_TRUE**, the data object supports asynchronous data extraction.</span></span>
3.  <span data-ttu-id="8cf82-488">Erstellen Sie einen separaten Thread zum Verarbeiten der Datenextraktion, und rufen Sie [**Startoperation**](/windows/desktop/api/Shldisp/nf-shldisp-idataobjectasynccapability-startoperation)auf.</span><span class="sxs-lookup"><span data-stu-id="8cf82-488">Create a separate thread to handle data extraction and call [**StartOperation**](/windows/desktop/api/Shldisp/nf-shldisp-idataobjectasynccapability-startoperation).</span></span>
4.  <span data-ttu-id="8cf82-489">Gibt den [**IDropTarget::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) -Rückruf zurück, wie bei einem normalen Datenübertragungs Vorgang.</span><span class="sxs-lookup"><span data-stu-id="8cf82-489">Return the [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) call, as you would for a normal data transfer operation.</span></span> <span data-ttu-id="8cf82-490">[**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) gibt die Blockierung der Ablage Quelle zurück und entsperrt Sie.</span><span class="sxs-lookup"><span data-stu-id="8cf82-490">[**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) will return and unblock the drop source.</span></span> <span data-ttu-id="8cf82-491">Nennen Sie [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) nicht, um das Ergebnis eines optimierten verschiebe-oder Löschvorgangs anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-491">Do not call [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) to indicate the outcome of an optimized move or delete-on-paste operation.</span></span> <span data-ttu-id="8cf82-492">Warten Sie, bis der Vorgang abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="8cf82-492">Wait until the operation is finished.</span></span>
5.  <span data-ttu-id="8cf82-493">Extrahieren Sie die Daten im Hintergrund Thread.</span><span class="sxs-lookup"><span data-stu-id="8cf82-493">Extract the data on the background thread.</span></span> <span data-ttu-id="8cf82-494">Die Blockierung des primären Threads des Ziels wird aufgehoben und der Vorgang kann fortgesetzt werden.</span><span class="sxs-lookup"><span data-stu-id="8cf82-494">The target's primary thread is unblocked and free to proceed.</span></span>
6.  <span data-ttu-id="8cf82-495">Wenn es sich bei der Datenübertragung um einen [optimierten](#handling-optimized-move-operations) Verschiebe [-oder Lösch](#handling-delete-on-paste-operations) Vorgang handelt, müssen Sie [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) aufrufen, um das Ergebnis anzugeben.</span><span class="sxs-lookup"><span data-stu-id="8cf82-495">If the data transfer was an [optimized move](#handling-optimized-move-operations) or [delete-on-paste](#handling-delete-on-paste-operations) operation, call [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) to indicate the outcome.</span></span>
7.  <span data-ttu-id="8cf82-496">Benachrichtigen Sie das Datenobjekt, dass die Extraktion abgeschlossen ist, indem Sie [**EndOperation**](/windows/desktop/api/Shldisp/nf-shldisp-idataobjectasynccapability-endoperation)aufrufen.</span><span class="sxs-lookup"><span data-stu-id="8cf82-496">Notify the data object that extraction is finished by calling [**EndOperation**](/windows/desktop/api/Shldisp/nf-shldisp-idataobjectasynccapability-endoperation).</span></span>

 

 
