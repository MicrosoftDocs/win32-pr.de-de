---
description: Initiiert den Client seitigen ausgehenden [*Sicherheitskontext*](../secgloss/s-gly.md) von einem Anmelde Informations Handle mithilfe der eingeschränkten NTLM- [*Delegierung*](../secgloss/s-gly.md).
ms.assetid: a96b04f6-504c-4fd1-b62e-c08ba2b616e5
title: InitializeSecurityContext (NTLM)-Funktion (SSPI. h)
ms.topic: reference
ms.date: 07/25/2019
ms.openlocfilehash: f858d765f9030f10ff94909e3b7b7ffa9fd1fcd7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "104217770"
---
# <a name="initializesecuritycontext-ntlm-function"></a><span data-ttu-id="26b0c-103">InitializeSecurityContext (NTLM)-Funktion</span><span class="sxs-lookup"><span data-stu-id="26b0c-103">InitializeSecurityContext (NTLM) function</span></span>

<span data-ttu-id="26b0c-104">Die **InitializeSecurityContext (NTLM)** -Funktion initiiert den Client seitigen ausgehenden [*Sicherheitskontext*](../secgloss/s-gly.md) von einem Anmelde Informationen-handle.</span><span class="sxs-lookup"><span data-stu-id="26b0c-104">The **InitializeSecurityContext (NTLM)** function initiates the client side, outbound [*security context*](../secgloss/s-gly.md) from a credential handle.</span></span> <span data-ttu-id="26b0c-105">Die-Funktion wird verwendet, um einen [*Sicherheitskontext*](../secgloss/s-gly.md) zwischen der Client Anwendung und einem Remotepeer zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="26b0c-105">The function is used to build a [*security context*](../secgloss/s-gly.md) between the client application and a remote peer.</span></span> <span data-ttu-id="26b0c-106">**InitializeSecurityContext (NTLM)** gibt ein Token zurück, das der Client an den Remotepeer übergeben muss, den der Peer wiederum über den [**calltsecuritycontext (NTLM)**](acceptsecuritycontext--ntlm.md) -Befehl an die lokale Sicherheits Implementierung übermittelt.</span><span class="sxs-lookup"><span data-stu-id="26b0c-106">**InitializeSecurityContext (NTLM)** returns a token that the client must pass to the remote peer, which the peer in turn submits to the local security implementation through the [**AcceptSecurityContext (NTLM)**](acceptsecuritycontext--ntlm.md) call.</span></span> <span data-ttu-id="26b0c-107">Das generierte Token sollte von allen Aufrufern als nicht transparent angesehen werden.</span><span class="sxs-lookup"><span data-stu-id="26b0c-107">The token generated should be considered opaque by all callers.</span></span>

<span data-ttu-id="26b0c-108">In der Regel wird die **InitializeSecurityContext (NTLM)** -Funktion in einer Schleife aufgerufen, bis ein ausreichender [*Sicherheitskontext*](../secgloss/s-gly.md) eingerichtet wird.</span><span class="sxs-lookup"><span data-stu-id="26b0c-108">Typically, the **InitializeSecurityContext (NTLM)** function is called in a loop until a sufficient [*security context*](../secgloss/s-gly.md) is established.</span></span>

## <a name="syntax"></a><span data-ttu-id="26b0c-109">Syntax</span><span class="sxs-lookup"><span data-stu-id="26b0c-109">Syntax</span></span>


```C++
SECURITY_STATUS SEC_Entry InitializeSecurityContext(
  _In_opt_    PCredHandle    phCredential,
  _In_opt_    PCtxtHandle    phContext,
  _In_        SEC_CHAR       *pszTargetName,
  _In_        ULONG          fContextReq,
  _In_        ULONG          Reserved1,
  _In_        ULONG          TargetDataRep,
  _In_opt_    PSecBufferDesc pInput,
  _In_        ULONG          Reserved2,
  _Inout_opt_ PCtxtHandle    phNewContext,
  _Inout_opt_ PSecBufferDesc pOutput,
  _Out_       PULONG         pfContextAttr,
  _Out_opt_   PTimeStamp     ptsExpiry
);
```



## <a name="parameters"></a><span data-ttu-id="26b0c-110">Parameter</span><span class="sxs-lookup"><span data-stu-id="26b0c-110">Parameters</span></span>

<dl> <dt>

<span data-ttu-id="26b0c-111">*phcredential* \[ in, optional\]</span><span class="sxs-lookup"><span data-stu-id="26b0c-111">*phCredential* \[in, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="26b0c-112">Ein Handle für die Anmelde Informationen, die von [**AcquireCredentialsHandle (NTLM)**](acquirecredentialshandle--ntlm.md)zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="26b0c-112">A handle to the credentials returned by [**AcquireCredentialsHandle (NTLM)**](acquirecredentialshandle--ntlm.md).</span></span> <span data-ttu-id="26b0c-113">Dieses Handle wird zum Erstellen des [*Sicherheits Kontexts*](../secgloss/s-gly.md)verwendet.</span><span class="sxs-lookup"><span data-stu-id="26b0c-113">This handle is used to build the [*security context*](../secgloss/s-gly.md).</span></span> <span data-ttu-id="26b0c-114">Die **InitializeSecurityContext (NTLM)** -Funktion erfordert mindestens ausgehende Anmelde Informationen.</span><span class="sxs-lookup"><span data-stu-id="26b0c-114">The **InitializeSecurityContext (NTLM)** function requires at least OUTBOUND credentials.</span></span>

</dd> <dt>

<span data-ttu-id="26b0c-115">*phcontext* \[ in, optional\]</span><span class="sxs-lookup"><span data-stu-id="26b0c-115">*phContext* \[in, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="26b0c-116">Ein Zeiger auf eine [ctxthandle](sspi-handles.md) -Struktur.</span><span class="sxs-lookup"><span data-stu-id="26b0c-116">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="26b0c-117">Beim ersten Aufrufe von **InitializeSecurityContext (NTLM)** ist dieser Zeiger **null**.</span><span class="sxs-lookup"><span data-stu-id="26b0c-117">On the first call to **InitializeSecurityContext (NTLM)**, this pointer is **NULL**.</span></span> <span data-ttu-id="26b0c-118">Beim zweiten-Befehl ist dieser Parameter ein Zeiger auf das Handle des partiell formatierten Kontexts, der durch den ersten-Befehl im *phnewcontext* -Parameter zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="26b0c-118">On the second call, this parameter is a pointer to the handle to the partially formed context returned in the *phNewContext* parameter by the first call.</span></span>

</dd> <dt>

<span data-ttu-id="26b0c-119">*psztargetname* \[ in\]</span><span class="sxs-lookup"><span data-stu-id="26b0c-119">*pszTargetName* \[in\]</span></span>
</dt> <dd>

<span data-ttu-id="26b0c-120">Ein Zeiger auf eine NULL-terminierte Zeichenfolge, die den Dienst Prinzipal Namen (SPN) oder den [*Sicherheitskontext*](../secgloss/s-gly.md) des Zielservers angibt.</span><span class="sxs-lookup"><span data-stu-id="26b0c-120">A pointer to a null-terminated string that indicates the service principal name (SPN) or the [*security context*](../secgloss/s-gly.md) of the destination server.</span></span>

<span data-ttu-id="26b0c-121">Anwendungen müssen einen gültigen SPN bereitstellen, um Replay-Angriffe zu vermeiden.</span><span class="sxs-lookup"><span data-stu-id="26b0c-121">Applications must supply a valid SPN to help mitigate replay attacks.</span></span>

<span data-ttu-id="26b0c-122">Verwenden Sie einen voll qualifizierten Zielnamen, da Kurznamen nicht Gesamtstruktur übergreifend unterstützt werden.</span><span class="sxs-lookup"><span data-stu-id="26b0c-122">Use a fully qualified target name because short names are not supported across forests.</span></span>

</dd> <dt>

<span data-ttu-id="26b0c-123">*"f"* \[ in\]</span><span class="sxs-lookup"><span data-stu-id="26b0c-123">*fContextReq* \[in\]</span></span>
</dt> <dd>

<span data-ttu-id="26b0c-124">Bitflags, die Anforderungen für den Kontext angeben.</span><span class="sxs-lookup"><span data-stu-id="26b0c-124">Bit flags that indicate requests for the context.</span></span> <span data-ttu-id="26b0c-125">Nicht alle Pakete können alle Anforderungen unterstützen.</span><span class="sxs-lookup"><span data-stu-id="26b0c-125">Not all packages can support all requirements.</span></span> <span data-ttu-id="26b0c-126">Flags, die für diesen Parameter verwendet werden, haben das Präfix ISC \_ req \_ , z \_ . b. ISC req-Delegat \_ .</span><span class="sxs-lookup"><span data-stu-id="26b0c-126">Flags used for this parameter are prefixed with ISC\_REQ\_, for example, ISC\_REQ\_DELEGATE.</span></span> <span data-ttu-id="26b0c-127">Dieser Parameter kann mindestens eines der folgenden Attributflags sein.</span><span class="sxs-lookup"><span data-stu-id="26b0c-127">This parameter can be one or more of the following attributes flags.</span></span>



<table><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><thead><tr class="header"><th><span data-ttu-id="26b0c-128">Wert</span><span class="sxs-lookup"><span data-stu-id="26b0c-128">Value</span></span></th><th><span data-ttu-id="26b0c-129">Bedeutung</span><span class="sxs-lookup"><span data-stu-id="26b0c-129">Meaning</span></span></th></tr></thead><tbody><tr class="odd"><td><span id="ISC_REQ_ALLOCATE_MEMORY"></span><span id="isc_req_allocate_memory"></span><dl> <span data-ttu-id="26b0c-130"><dt><strong>ISC_REQ_ALLOCATE_MEMORY</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="26b0c-130"><dt><strong>ISC_REQ_ALLOCATE_MEMORY</strong></dt> </span></span></dl></td><td><span data-ttu-id="26b0c-131">Das [*Sicherheitspaket*](../secgloss/s-gly.md) weist Ihnen Ausgabepuffer zu.</span><span class="sxs-lookup"><span data-stu-id="26b0c-131">The [*security package*](../secgloss/s-gly.md) allocates output buffers for you.</span></span> <span data-ttu-id="26b0c-132">Wenn Sie die Ausgabepuffer nicht mehr verwenden, geben Sie Sie frei, indem Sie die [<strong>freecontextbuffer</strong>] (/Windows/Win32/API/SSPI/NF-SSPI-freecontextbuffer)-Funktion aufrufen.</span><span class="sxs-lookup"><span data-stu-id="26b0c-132">When you have finished using the output buffers, free them by calling the [<strong>FreeContextBuffer</strong>](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) function.</span></span><br/></td></tr><tr class="even"><td><span id="ISC_REQ_CONFIDENTIALITY"></span><span id="isc_req_confidentiality"></span><dl> <span data-ttu-id="26b0c-133"><dt><strong>ISC_REQ_CONFIDENTIALITY</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="26b0c-133"><dt><strong>ISC_REQ_CONFIDENTIALITY</strong></dt> </span></span></dl></td><td><span data-ttu-id="26b0c-134">Verschlüsseln Sie Nachrichten mithilfe der [<strong>verschlüsseltmessage</strong>] (EncryptMessage--General.MD)-Funktion.</span><span class="sxs-lookup"><span data-stu-id="26b0c-134">Encrypt messages by using the [<strong>EncryptMessage</strong>](encryptmessage--general.md) function.</span></span><br/></td></tr><tr class="odd"><td><span id="ISC_REQ_CONNECTION"></span><span id="isc_req_connection"></span><dl> <span data-ttu-id="26b0c-135"><dt><strong>ISC_REQ_CONNECTION</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="26b0c-135"><dt><strong>ISC_REQ_CONNECTION</strong></dt> </span></span></dl></td><td><span data-ttu-id="26b0c-136">Der [*Sicherheitskontext*](../secgloss/s-gly.md) verarbeitet keine Formatierungs Meldungen.</span><span class="sxs-lookup"><span data-stu-id="26b0c-136">The [*security context*](../secgloss/s-gly.md) will not handle formatting messages.</span></span> <span data-ttu-id="26b0c-137">Dies ist der Standardwert.</span><span class="sxs-lookup"><span data-stu-id="26b0c-137">This value is the default.</span></span><br/></td></tr><tr class="even"><td><span id="ISC_REQ_EXTENDED_ERROR"></span><span id="isc_req_extended_error"></span><dl> <span data-ttu-id="26b0c-138"><dt><strong>ISC_REQ_EXTENDED_ERROR</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="26b0c-138"><dt><strong>ISC_REQ_EXTENDED_ERROR</strong></dt> </span></span></dl></td><td><span data-ttu-id="26b0c-139">Wenn Fehler auftreten, wird die Remote Partei benachrichtigt.</span><span class="sxs-lookup"><span data-stu-id="26b0c-139">When errors occur, the remote party will be notified.</span></span><br/></td></tr><tr class="odd"><td><span id="ISC_REQ_INTEGRITY"></span><span id="isc_req_integrity"></span><dl> <span data-ttu-id="26b0c-140"><dt><strong>ISC_REQ_INTEGRITY</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="26b0c-140"><dt><strong>ISC_REQ_INTEGRITY</strong></dt> </span></span></dl></td><td><span data-ttu-id="26b0c-141">Signieren von Nachrichten und Überprüfen von Signaturen mithilfe der Funktionen [<strong>verschlüsseltmessage</strong>] (EncryptMessage--General.MD) und [<strong>makesignature</strong>] (makesignature.MD).</span><span class="sxs-lookup"><span data-stu-id="26b0c-141">Sign messages and verify signatures by using the [<strong>EncryptMessage</strong>](encryptmessage--general.md) and [<strong>MakeSignature</strong>](makesignature.md) functions.</span></span><br/></td></tr><tr class="even"><td><span id="ISC_REQ_MUTUAL_AUTH"></span><span id="isc_req_mutual_auth"></span><dl> <span data-ttu-id="26b0c-142"><dt><strong>ISC_REQ_MUTUAL_AUTH</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="26b0c-142"><dt><strong>ISC_REQ_MUTUAL_AUTH</strong></dt> </span></span></dl></td><td><span data-ttu-id="26b0c-143">Die Richtlinie für die gegenseitige Authentifizierung des Dienstanbieter wird erfüllt.</span><span class="sxs-lookup"><span data-stu-id="26b0c-143">The mutual authentication policy of the service will be satisfied.</span></span><br/><blockquote>[!Caution]<br />
<span data-ttu-id="26b0c-144">Dies bedeutet nicht notwendigerweise, dass die gegenseitige Authentifizierung durchgeführt wird, sondern nur, dass die Authentifizierungs Richtlinie des Dienstanbieter erfüllt ist.</span><span class="sxs-lookup"><span data-stu-id="26b0c-144">This does not necessarily mean that mutual authentication is performed, only that the authentication policy of the service is satisfied.</span></span> <span data-ttu-id="26b0c-145">Um sicherzustellen, dass die gegenseitige Authentifizierung erfolgt, wenden Sie die [<strong>QueryContextAttributes (NTLM)</strong>] (QueryContextAttributes--NTLM.MD)-Funktion an.</span><span class="sxs-lookup"><span data-stu-id="26b0c-145">To ensure that mutual authentication is performed, call the [<strong>QueryContextAttributes (NTLM)</strong>](querycontextattributes--ntlm.md) function.</span></span></blockquote><br/></td></tr><tr class="odd"><td><span id="ISC_REQ_REPLAY_DETECT"></span><span id="isc_req_replay_detect"></span><dl> <span data-ttu-id="26b0c-146"><dt><strong>ISC_REQ_REPLAY_DETECT</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="26b0c-146"><dt><strong>ISC_REQ_REPLAY_DETECT</strong></dt> </span></span></dl></td><td><span data-ttu-id="26b0c-147">Erkennen von wiedergegebenen Nachrichten, die mithilfe der Funktionen [<strong>verschlüsseltmessage</strong>] (EncryptMessage--General.MD) oder [<strong>makesignature</strong>] (makesignature.MD) codiert wurden.</span><span class="sxs-lookup"><span data-stu-id="26b0c-147">Detect replayed messages that have been encoded by using the [<strong>EncryptMessage</strong>](encryptmessage--general.md) or [<strong>MakeSignature</strong>](makesignature.md) functions.</span></span><br/></td></tr><tr class="even"><td><span id="ISC_REQ_SEQUENCE_DETECT"></span><span id="isc_req_sequence_detect"></span><dl> <span data-ttu-id="26b0c-148"><dt><strong>ISC_REQ_SEQUENCE_DETECT</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="26b0c-148"><dt><strong>ISC_REQ_SEQUENCE_DETECT</strong></dt> </span></span></dl></td><td><span data-ttu-id="26b0c-149">Erkennen, dass Nachrichten außerhalb der Reihenfolge empfangen wurden.</span><span class="sxs-lookup"><span data-stu-id="26b0c-149">Detect messages received out of sequence.</span></span><br/></td></tr><tr class="odd"><td><span id="ISC_REQ_STREAM"></span><span id="isc_req_stream"></span><dl> <span data-ttu-id="26b0c-150"><dt><strong>ISC_REQ_STREAM</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="26b0c-150"><dt><strong>ISC_REQ_STREAM</strong></dt> </span></span></dl></td><td><span data-ttu-id="26b0c-151">Unterstützen einer Datenstrom orientierten Verbindung.</span><span class="sxs-lookup"><span data-stu-id="26b0c-151">Support a stream-oriented connection.</span></span><br/></td></tr></tbody></table>



 

<span data-ttu-id="26b0c-152">Die angeforderten Attribute werden möglicherweise nicht vom Client unterstützt.</span><span class="sxs-lookup"><span data-stu-id="26b0c-152">The requested attributes may not be supported by the client.</span></span> <span data-ttu-id="26b0c-153">Weitere Informationen finden Sie unter dem Parameter *pfContextAttr* .</span><span class="sxs-lookup"><span data-stu-id="26b0c-153">For more information, see the *pfContextAttr* parameter.</span></span>

<span data-ttu-id="26b0c-154">Weitere Beschreibungen der verschiedenen Attribute finden Sie unter [Kontext Anforderungen](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="26b0c-154">For further descriptions of the various attributes, see [Context Requirements](context-requirements.md).</span></span>

</dd> <dt>

<span data-ttu-id="26b0c-155">*"Reserved1"* \[ in\]</span><span class="sxs-lookup"><span data-stu-id="26b0c-155">*Reserved1* \[in\]</span></span>
</dt> <dd>

<span data-ttu-id="26b0c-156">Dieser Parameter ist reserviert und muss auf 0 (null) festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="26b0c-156">This parameter is reserved and must be set to zero.</span></span>

</dd> <dt>

<span data-ttu-id="26b0c-157">*Targetdatarep* \[ in\]</span><span class="sxs-lookup"><span data-stu-id="26b0c-157">*TargetDataRep* \[in\]</span></span>
</dt> <dd>

<span data-ttu-id="26b0c-158">Die Datendarstellung (z. b. Byte Reihenfolge) für das Ziel.</span><span class="sxs-lookup"><span data-stu-id="26b0c-158">The data representation, such as byte ordering, on the target.</span></span> <span data-ttu-id="26b0c-159">Dieser Parameter kann entweder "Security \_ native \_ drep" oder "Security \_ Network \_ drep" lauten.</span><span class="sxs-lookup"><span data-stu-id="26b0c-159">This parameter can be either SECURITY\_NATIVE\_DREP or SECURITY\_NETWORK\_DREP.</span></span>

</dd> <dt>

<span data-ttu-id="26b0c-160">*pinput* \[ in, optional\]</span><span class="sxs-lookup"><span data-stu-id="26b0c-160">*pInput* \[in, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="26b0c-161">Ein Zeiger auf eine [**secbufferdesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) -Struktur, die Zeiger auf die Puffer enthält, die als Eingabe für das Paket bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="26b0c-161">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure that contains pointers to the buffers supplied as input to the package.</span></span> <span data-ttu-id="26b0c-162">Der Wert dieses Parameters muss beim ersten Aufrufen der Funktion **null** sein, es sei denn, der Client Kontext wurde vom Server initiiert.</span><span class="sxs-lookup"><span data-stu-id="26b0c-162">Unless the client context was initiated by the server, the value of this parameter must be **NULL** on the first call to the function.</span></span> <span data-ttu-id="26b0c-163">Bei nachfolgenden Aufrufen der Funktion oder wenn der Client Kontext vom Server initiiert wurde, ist der Wert dieses Parameters ein Zeiger auf einen Puffer, der ausreichend Arbeitsspeicher für das vom Remote Computer zurückgegebene Token zugeordnet ist.</span><span class="sxs-lookup"><span data-stu-id="26b0c-163">On subsequent calls to the function or when the client context was initiated by the server, the value of this parameter is a pointer to a buffer allocated with enough memory to hold the token returned by the remote computer.</span></span>

</dd> <dt>

<span data-ttu-id="26b0c-164">*"Reserved2"* \[ in\]</span><span class="sxs-lookup"><span data-stu-id="26b0c-164">*Reserved2* \[in\]</span></span>
</dt> <dd>

<span data-ttu-id="26b0c-165">Dieser Parameter ist reserviert und muss auf 0 (null) festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="26b0c-165">This parameter is reserved and must be set to zero.</span></span>

</dd> <dt>

<span data-ttu-id="26b0c-166">*phnewcontext* \[ in, out, optional\]</span><span class="sxs-lookup"><span data-stu-id="26b0c-166">*phNewContext* \[in, out, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="26b0c-167">Ein Zeiger auf eine [ctxthandle](sspi-handles.md) -Struktur.</span><span class="sxs-lookup"><span data-stu-id="26b0c-167">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="26b0c-168">Beim ersten Aufrufe von **InitializeSecurityContext (NTLM)** empfängt dieser Zeiger das neue Kontext handle.</span><span class="sxs-lookup"><span data-stu-id="26b0c-168">On the first call to **InitializeSecurityContext (NTLM)**, this pointer receives the new context handle.</span></span> <span data-ttu-id="26b0c-169">Beim zweiten-Befehl kann *phnewcontext* mit dem im *phcontext* -Parameter angegebenen Handle identisch sein.</span><span class="sxs-lookup"><span data-stu-id="26b0c-169">On the second call, *phNewContext* can be the same as the handle specified in the *phContext* parameter.</span></span>

</dd> <dt>

<span data-ttu-id="26b0c-170">*poutput* \[ in, out, optional\]</span><span class="sxs-lookup"><span data-stu-id="26b0c-170">*pOutput* \[in, out, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="26b0c-171">Ein Zeiger auf eine [**secbufferdesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) -Struktur, die Zeiger auf die [**secbuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) -Struktur enthält, die die Ausgabedaten empfängt.</span><span class="sxs-lookup"><span data-stu-id="26b0c-171">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure that contains pointers to the [**SecBuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) structure that receives the output data.</span></span> <span data-ttu-id="26b0c-172">Wenn ein Puffer \_ in der Eingabe als Sek. gelesen wurde, wird er in der Ausgabe angezeigt.</span><span class="sxs-lookup"><span data-stu-id="26b0c-172">If a buffer was typed as SEC\_READWRITE in the input, it will be there on output.</span></span> <span data-ttu-id="26b0c-173">Das System weist einen Puffer für das Sicherheits Token zu, wenn dies angefordert wird (über den ISC \_ -req \_ \_ -Speicher Belegungs Speicher), und gibt die Adresse im Puffer Deskriptor für das Sicherheits Token ein.</span><span class="sxs-lookup"><span data-stu-id="26b0c-173">The system will allocate a buffer for the security token if requested (through ISC\_REQ\_ALLOCATE\_MEMORY) and fill in the address in the buffer descriptor for the security token.</span></span>

</dd> <dt>

<span data-ttu-id="26b0c-174">*pfContextAttr* \[ vorgenommen\]</span><span class="sxs-lookup"><span data-stu-id="26b0c-174">*pfContextAttr* \[out\]</span></span>
</dt> <dd>

<span data-ttu-id="26b0c-175">Ein Zeiger auf eine Variable, die einen Satz von Bitflags empfangen soll, die die [*Attribute*](../secgloss/a-gly.md#_security_attribute_gly) des eingerichteten Kontexts angeben.</span><span class="sxs-lookup"><span data-stu-id="26b0c-175">A pointer to a variable to receive a set of bit flags that indicate the [*attributes*](../secgloss/a-gly.md#_security_attribute_gly) of the established context.</span></span> <span data-ttu-id="26b0c-176">Eine Beschreibung der verschiedenen Attribute finden Sie unter [Kontext Anforderungen](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="26b0c-176">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span>

<span data-ttu-id="26b0c-177">Flags, die für diesen Parameter verwendet werden, haben das Präfix ISC \_ RET, wie z \_ \_ . b. ISC</span><span class="sxs-lookup"><span data-stu-id="26b0c-177">Flags used for this parameter are prefixed with ISC\_RET, such as ISC\_RET\_DELEGATE.</span></span> <span data-ttu-id="26b0c-178">Eine Liste gültiger Werte finden Sie unter dem Parameter *fContextReq* .</span><span class="sxs-lookup"><span data-stu-id="26b0c-178">For a list of valid values, see the *fContextReq* parameter.</span></span>

<span data-ttu-id="26b0c-179">Suchen Sie erst nach sicherheitsbezogenen Attributen, wenn der abschließende Funktions aufruger erfolgreich zurückgegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="26b0c-179">Do not check for security-related attributes until the final function call returns successfully.</span></span> <span data-ttu-id="26b0c-180">Attributflags, die sich nicht auf die Sicherheit beziehen, wie z. b. das von ASC \_ ret \_ zugewiesene \_ arbeitsspeicherflag, können vor der letzten Rückgabe geprüft werden.</span><span class="sxs-lookup"><span data-stu-id="26b0c-180">Attribute flags that are not related to security, such as the ASC\_RET\_ALLOCATED\_MEMORY flag, can be checked before the final return.</span></span>

> [!Note]  
> <span data-ttu-id="26b0c-181">Bestimmte Kontext Attribute können während der Aushandlung mit einem Remotepeer geändert werden.</span><span class="sxs-lookup"><span data-stu-id="26b0c-181">Particular context attributes can change during negotiation with a remote peer.</span></span>

 

</dd> <dt>

<span data-ttu-id="26b0c-182">*ptsexpiry* \[ Out, optional\]</span><span class="sxs-lookup"><span data-stu-id="26b0c-182">*ptsExpiry* \[out, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="26b0c-183">Ein Zeiger auf eine [**Zeitstempel**](timestamp.md) Struktur, die die Ablaufzeit des Kontexts empfängt.</span><span class="sxs-lookup"><span data-stu-id="26b0c-183">A pointer to a [**TimeStamp**](timestamp.md) structure that receives the expiration time of the context.</span></span> <span data-ttu-id="26b0c-184">Es wird empfohlen, dass das [*Sicherheitspaket*](../secgloss/s-gly.md) diesen Wert immer in der lokalen Zeit zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="26b0c-184">It is recommended that the [*security package*](../secgloss/s-gly.md) always return this value in local time.</span></span> <span data-ttu-id="26b0c-185">Dieser Parameter ist optional, und für kurzlebige Clients sollte **null** übergeben werden.</span><span class="sxs-lookup"><span data-stu-id="26b0c-185">This parameter is optional and **NULL** should be passed for short-lived clients.</span></span>

</dd> </dl>

## <a name="return-value"></a><span data-ttu-id="26b0c-186">Rückgabewert</span><span class="sxs-lookup"><span data-stu-id="26b0c-186">Return value</span></span>

<span data-ttu-id="26b0c-187">Wenn die Funktion erfolgreich ausgeführt wird, gibt die Funktion einen der folgenden Erfolgs Codes zurück.</span><span class="sxs-lookup"><span data-stu-id="26b0c-187">If the function succeeds, the function returns one of the following success codes.</span></span>



| <span data-ttu-id="26b0c-188">Rückgabecode</span><span class="sxs-lookup"><span data-stu-id="26b0c-188">Return code</span></span>                                                                                                    | <span data-ttu-id="26b0c-189">Beschreibung</span><span class="sxs-lookup"><span data-stu-id="26b0c-189">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                         |
|----------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <dl> <span data-ttu-id="26b0c-190"><dt>**Sek. \_ E \_ OK**</dt></span><span class="sxs-lookup"><span data-stu-id="26b0c-190"><dt>**SEC\_E\_OK**</dt></span></span> </dl>                      | <span data-ttu-id="26b0c-191">Der [*Sicherheitskontext*](../secgloss/s-gly.md) wurde erfolgreich initialisiert.</span><span class="sxs-lookup"><span data-stu-id="26b0c-191">The [*security context*](../secgloss/s-gly.md) was successfully initialized.</span></span> <span data-ttu-id="26b0c-192">Ein weiterer [**InitializeSecurityContext (NTLM)**](initializesecuritycontext--ntlm.md) -Rückruf ist nicht erforderlich.</span><span class="sxs-lookup"><span data-stu-id="26b0c-192">There is no need for another [**InitializeSecurityContext (NTLM)**](initializesecuritycontext--ntlm.md) call.</span></span> <span data-ttu-id="26b0c-193">Wenn die Funktion ein Ausgabe Token zurückgibt, d. h., wenn das secbuffer- \_ Token in *poutput* eine Länge ungleich NULL aufweist, muss dieses Token an den Server gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="26b0c-193">If the function returns an output token, that is, if the SECBUFFER\_TOKEN in *pOutput* is of nonzero length, that token must be sent to the server.</span></span><br/> |
| <dl> <span data-ttu-id="26b0c-194"><dt>**SEK \_ . \_ \_ und \_ fortfahren**</dt></span><span class="sxs-lookup"><span data-stu-id="26b0c-194"><dt>**SEC\_I\_COMPLETE\_AND\_CONTINUE**</dt></span></span> </dl> | <span data-ttu-id="26b0c-195">Der Client muss das [**completeauthtoken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) -Element aufzurufen und die Ausgabe dann an den Server übergeben.</span><span class="sxs-lookup"><span data-stu-id="26b0c-195">The client must call [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) and then pass the output to the server.</span></span> <span data-ttu-id="26b0c-196">Der Client wartet dann auf ein zurück gegebenes Token und übergibt es in einem anderen-Befehl an [**InitializeSecurityContext (NTLM)**](initializesecuritycontext--ntlm.md).</span><span class="sxs-lookup"><span data-stu-id="26b0c-196">The client then waits for a returned token and passes it, in another call, to [**InitializeSecurityContext (NTLM)**](initializesecuritycontext--ntlm.md).</span></span><br/>                                                                                                                                  |
| <dl> <span data-ttu-id="26b0c-197"><dt>**SEK \_ . \_ \_**</dt></span><span class="sxs-lookup"><span data-stu-id="26b0c-197"><dt>**SEC\_I\_COMPLETE\_NEEDED**</dt></span></span> </dl>        | <span data-ttu-id="26b0c-198">Der Client muss die Erstellung der Nachricht abschließen und dann die [**completeauthtoken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) -Funktion aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="26b0c-198">The client must finish building the message and then call the [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) function.</span></span><br/>                                                                                                                                                                                                                                                                                   |
| <dl> <span data-ttu-id="26b0c-199"><dt>**SEK \_ . \_ \_**</dt></span><span class="sxs-lookup"><span data-stu-id="26b0c-199"><dt>**SEC\_I\_CONTINUE\_NEEDED**</dt></span></span> </dl>        | <span data-ttu-id="26b0c-200">Der Client muss das Ausgabe Token an den Server senden und auf ein Rückgabe Token warten.</span><span class="sxs-lookup"><span data-stu-id="26b0c-200">The client must send the output token to the server and wait for a return token.</span></span> <span data-ttu-id="26b0c-201">Das zurückgegebene Token wird dann in einem anderen Befehl von [**InitializeSecurityContext (NTLM)**](initializesecuritycontext--ntlm.md)übergeben.</span><span class="sxs-lookup"><span data-stu-id="26b0c-201">The returned token is then passed in another call to [**InitializeSecurityContext (NTLM)**](initializesecuritycontext--ntlm.md).</span></span> <span data-ttu-id="26b0c-202">Das Ausgabe Token kann leer sein.</span><span class="sxs-lookup"><span data-stu-id="26b0c-202">The output token can be empty.</span></span><br/>                                                                                                                                                       |



 

<span data-ttu-id="26b0c-203">Wenn die Funktion fehlschlägt, gibt die Funktion einen der folgenden Fehlercodes zurück.</span><span class="sxs-lookup"><span data-stu-id="26b0c-203">If the function fails, the function returns one of the following error codes.</span></span>



| <span data-ttu-id="26b0c-204">Rückgabecode</span><span class="sxs-lookup"><span data-stu-id="26b0c-204">Return code</span></span>                                                                                                          | <span data-ttu-id="26b0c-205">Beschreibung</span><span class="sxs-lookup"><span data-stu-id="26b0c-205">Description</span></span>                                                                                                                                                                                                                                                                                         |
|----------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <dl> <span data-ttu-id="26b0c-206"><dt>**SEK \_ b \_ nicht genügend Arbeits \_ Speicher**</dt></span><span class="sxs-lookup"><span data-stu-id="26b0c-206"><dt>**SEC\_E\_INSUFFICIENT\_MEMORY**</dt></span></span> </dl>          | <span data-ttu-id="26b0c-207">Es ist nicht genügend Arbeitsspeicher verfügbar, um die angeforderte Aktion abzuschließen.</span><span class="sxs-lookup"><span data-stu-id="26b0c-207">There is not enough memory available to complete the requested action.</span></span><br/>                                                                                                                                                                                                                   |
| <dl> <span data-ttu-id="26b0c-208"><dt>**Sek. \_ E ( \_ interner \_ Fehler)**</dt></span><span class="sxs-lookup"><span data-stu-id="26b0c-208"><dt>**SEC\_E\_INTERNAL\_ERROR**</dt></span></span> </dl>               | <span data-ttu-id="26b0c-209">Es ist ein Fehler aufgetreten, der keinem SSPI-Fehlercode zugeordnet wurde.</span><span class="sxs-lookup"><span data-stu-id="26b0c-209">An error occurred that did not map to an SSPI error code.</span></span><br/>                                                                                                                                                                                                                                |
| <dl> <span data-ttu-id="26b0c-210"><dt>**s \_ E \_ ungültiges \_ handle**</dt></span><span class="sxs-lookup"><span data-stu-id="26b0c-210"><dt>**SEC\_E\_INVALID\_HANDLE**</dt></span></span> </dl>               | <span data-ttu-id="26b0c-211">Das an die Funktion über gegebene Handle ist ungültig.</span><span class="sxs-lookup"><span data-stu-id="26b0c-211">The handle passed to the function is not valid.</span></span><br/>                                                                                                                                                                                                                                          |
| <dl> <span data-ttu-id="26b0c-212"><dt>**s \_ E \_ ungültiges \_ Token**</dt></span><span class="sxs-lookup"><span data-stu-id="26b0c-212"><dt>**SEC\_E\_INVALID\_TOKEN**</dt></span></span> </dl>                | <span data-ttu-id="26b0c-213">Der Fehler tritt auf, wenn ein ungültiges Eingabe Token vorliegt, z. b. ein Token, das während der Übertragung beschädigt ist, ein Token falscher Größe oder ein Token, das an die falsche [*eingeschränkte Delegierung*](../secgloss/s-gly.md)geleitet wurde.</span><span class="sxs-lookup"><span data-stu-id="26b0c-213">The error is due to a malformed input token, such as a token corrupted in transit, a token of incorrect size, or a token passed into the wrong [*constrained delegation*](../secgloss/s-gly.md).</span></span> <span data-ttu-id="26b0c-214">Das Übergeben eines Tokens an das falsche Paket kann erfolgen, wenn der Client und der Server nicht die ordnungsgemäße [*eingeschränkte Delegierung*](../secgloss/s-gly.md)ausgehandelt haben.</span><span class="sxs-lookup"><span data-stu-id="26b0c-214">Passing a token to the wrong package can happen if the client and server did not negotiate the proper [*constrained delegation*](../secgloss/s-gly.md).</span></span><br/> |
| <dl> <span data-ttu-id="26b0c-215"><dt>**Sek. \_ E- \_ Anmeldung \_ verweigert**</dt></span><span class="sxs-lookup"><span data-stu-id="26b0c-215"><dt>**SEC\_E\_LOGON\_DENIED**</dt></span></span> </dl>                 | <span data-ttu-id="26b0c-216">Die Anmeldung ist fehlgeschlagen.</span><span class="sxs-lookup"><span data-stu-id="26b0c-216">The logon failed.</span></span><br/>                                                                                                                                                                                                                                                                        |
| <dl> <span data-ttu-id="26b0c-217"><dt>**s \_ E \_ keine \_ authentifizier Ende Zertifizierungsstelle \_**</dt></span><span class="sxs-lookup"><span data-stu-id="26b0c-217"><dt>**SEC\_E\_NO\_AUTHENTICATING\_AUTHORITY**</dt></span></span> </dl> | <span data-ttu-id="26b0c-218">Es konnte keine Autorität für die Authentifizierung kontaktiert werden.</span><span class="sxs-lookup"><span data-stu-id="26b0c-218">No authority could be contacted for authentication.</span></span> <span data-ttu-id="26b0c-219">Der Domänen Name der authentifizier enden Partei ist möglicherweise falsch, die Domäne kann nicht erreichbar sein, oder es ist ein Fehler bei der Vertrauensstellung aufgetreten.</span><span class="sxs-lookup"><span data-stu-id="26b0c-219">The domain name of the authenticating party could be wrong, the domain could be unreachable, or there might have been a trust relationship failure.</span></span><br/>                                                                                  |
| <dl> <span data-ttu-id="26b0c-220"><dt>**s \_ E \_ keine \_ Anmelde Informationen**</dt></span><span class="sxs-lookup"><span data-stu-id="26b0c-220"><dt>**SEC\_E\_NO\_CREDENTIALS**</dt></span></span> </dl>               | <span data-ttu-id="26b0c-221">In der [*eingeschränkten Delegierung*](../secgloss/s-gly.md)sind keine Anmelde Informationen verfügbar.</span><span class="sxs-lookup"><span data-stu-id="26b0c-221">No credentials are available in the [*constrained delegation*](../secgloss/s-gly.md).</span></span><br/>                                                                                                                                                  |
| <dl> <span data-ttu-id="26b0c-222"><dt>**Sekunde \_ E \_ Ziel \_ unbekannt**</dt></span><span class="sxs-lookup"><span data-stu-id="26b0c-222"><dt>**SEC\_E\_TARGET\_UNKNOWN**</dt></span></span> </dl>               | <span data-ttu-id="26b0c-223">Das Ziel wurde nicht erkannt.</span><span class="sxs-lookup"><span data-stu-id="26b0c-223">The target was not recognized.</span></span><br/>                                                                                                                                                                                                                                                           |
| <dl> <span data-ttu-id="26b0c-224"><dt>**s \_ E \_ nicht unterstützte \_ Funktion**</dt></span><span class="sxs-lookup"><span data-stu-id="26b0c-224"><dt>**SEC\_E\_UNSUPPORTED\_FUNCTION**</dt></span></span> </dl>         | <span data-ttu-id="26b0c-225">\_ \_ \_ \_ \_ \_ Im *fContextReq* -Parameter wurde ein ungültiges Kontext Attribut Kennzeichen (ISC req-Delegat oder ISC req-Eingabeaufforderung für die Anmelde Informationen) angegeben.</span><span class="sxs-lookup"><span data-stu-id="26b0c-225">A context attribute flag that is not valid (ISC\_REQ\_DELEGATE or ISC\_REQ\_PROMPT\_FOR\_CREDS) was specified in the *fContextReq* parameter.</span></span><br/>                                                                                                                                            |
| <dl> <span data-ttu-id="26b0c-226"><dt>**SEK \_ . \_ falscher \_ Prinzipal**</dt></span><span class="sxs-lookup"><span data-stu-id="26b0c-226"><dt>**SEC\_E\_WRONG\_PRINCIPAL**</dt></span></span> </dl>              | <span data-ttu-id="26b0c-227">Der Prinzipal, der die Authentifizierungsanforderung empfangen hat, ist nicht mit dem Prinzipal identisch, der an den *psztargetname* -Parameter übergeben wurde.</span><span class="sxs-lookup"><span data-stu-id="26b0c-227">The principal that received the authentication request is not the same as the one passed into the *pszTargetName* parameter.</span></span> <span data-ttu-id="26b0c-228">Dies weist auf einen Fehler bei der gegenseitigen Authentifizierung hin.</span><span class="sxs-lookup"><span data-stu-id="26b0c-228">This indicates a failure in mutual authentication.</span></span><br/>                                                                                                          |



 

## <a name="remarks"></a><span data-ttu-id="26b0c-229">Bemerkungen</span><span class="sxs-lookup"><span data-stu-id="26b0c-229">Remarks</span></span>

<span data-ttu-id="26b0c-230">Der Aufrufer ist dafür verantwortlich, zu bestimmen, ob die abschließenden Kontext Attribute ausreichend sind.</span><span class="sxs-lookup"><span data-stu-id="26b0c-230">The caller is responsible for determining whether the final context attributes are sufficient.</span></span> <span data-ttu-id="26b0c-231">Wenn beispielsweise Vertraulichkeit angefordert wurde, Sie aber nicht eingerichtet werden konnte, können einige Anwendungen die Verbindung sofort beenden.</span><span class="sxs-lookup"><span data-stu-id="26b0c-231">If, for example, confidentiality was requested, but could not be established, some applications may choose to shut down the connection immediately.</span></span>

<span data-ttu-id="26b0c-232">Wenn Attribute des [*Sicherheits Kontexts*](../secgloss/s-gly.md) nicht ausreichen, muss der Client den teilweise erstellten Kontext durch Aufrufen der [**Delta Context**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) -Funktion freigeben.</span><span class="sxs-lookup"><span data-stu-id="26b0c-232">If attributes of the [*security context*](../secgloss/s-gly.md) are not sufficient, the client must free the partially created context by calling the [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) function.</span></span>

<span data-ttu-id="26b0c-233">Die **InitializeSecurityContext (NTLM)** -Funktion wird von einem Client verwendet, um einen ausgehenden Kontext zu initialisieren.</span><span class="sxs-lookup"><span data-stu-id="26b0c-233">The **InitializeSecurityContext (NTLM)** function is used by a client to initialize an outbound context.</span></span>

<span data-ttu-id="26b0c-234">Bei einem zweistufigen [*Sicherheitskontext*](../secgloss/s-gly.md)sieht die aufrufende Sequenz wie folgt aus:</span><span class="sxs-lookup"><span data-stu-id="26b0c-234">For a two-leg [*security context*](../secgloss/s-gly.md), the calling sequence is as follows:</span></span>

1.  <span data-ttu-id="26b0c-235">Der Client ruft die-Funktion auf, wobei *phcontext* auf **null** festgelegt ist, und füllt den Puffer Deskriptor mit der Eingabe Nachricht.</span><span class="sxs-lookup"><span data-stu-id="26b0c-235">The client calls the function with *phContext* set to **NULL** and fills in the buffer descriptor with the input message.</span></span>
2.  <span data-ttu-id="26b0c-236">Das [*Sicherheitspaket*](../secgloss/s-gly.md) überprüft die Parameter und erstellt ein undurchsichtiges Token, das es im Token-Element im Puffer Array platziert.</span><span class="sxs-lookup"><span data-stu-id="26b0c-236">The [*security package*](../secgloss/s-gly.md) examines the parameters and constructs an opaque token, placing it in the TOKEN element in the buffer array.</span></span> <span data-ttu-id="26b0c-237">Wenn der *Parameter "Parameter" den Wert* "ISC \_ req \_ -Speicher Belegungs Flag" enthält \_ , ordnet das [*Sicherheitspaket*](../secgloss/s-gly.md) den Arbeitsspeicher zu und gibt den Zeiger im Token-Element zurück.</span><span class="sxs-lookup"><span data-stu-id="26b0c-237">If the *fContextReq* parameter includes the ISC\_REQ\_ALLOCATE\_MEMORY flag, the [*security package*](../secgloss/s-gly.md) allocates the memory and returns the pointer in the TOKEN element.</span></span>
3.  <span data-ttu-id="26b0c-238">Der Client sendet das Token, das im *poutput* -Puffer zurückgegeben wurde, an den Zielserver.</span><span class="sxs-lookup"><span data-stu-id="26b0c-238">The client sends the token returned in the *pOutput* buffer to the target server.</span></span> <span data-ttu-id="26b0c-239">Der Server übergibt dann das Token als Eingabe Argument in einem Rückruf der Funktion " [**Accept tsecuritycontext (NTLM)**](acceptsecuritycontext--ntlm.md) ".</span><span class="sxs-lookup"><span data-stu-id="26b0c-239">The server then passes the token as an input argument in a call to the [**AcceptSecurityContext (NTLM)**](acceptsecuritycontext--ntlm.md) function.</span></span>
4.  <span data-ttu-id="26b0c-240">" [**Accept tsecuritycontext (NTLM)**](acceptsecuritycontext--ntlm.md) " gibt möglicherweise ein Token zurück, das der Server für einen zweiten **callalizesecuritycontext (NTLM)** an den Client sendet, wenn der erste zurückgegebene Befehl "s Continue" zurückgegeben wird \_ \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="26b0c-240">[**AcceptSecurityContext (NTLM)**](acceptsecuritycontext--ntlm.md) may return a token, which the server sends to the client for a second call to **InitializeSecurityContext (NTLM)** if the first call returned SEC\_I\_CONTINUE\_NEEDED.</span></span>

<span data-ttu-id="26b0c-241">Bei mehrstufigen [*Sicherheits Kontexten*](../secgloss/s-gly.md), wie z. b. der gegenseitigen Authentifizierung, sieht die Aufruf Sequenz wie folgt aus:</span><span class="sxs-lookup"><span data-stu-id="26b0c-241">For multiple-leg [*security context*](../secgloss/s-gly.md)s, such as mutual authentication, the calling sequence is as follows:</span></span>

1.  <span data-ttu-id="26b0c-242">Der Client ruft die-Funktion wie zuvor beschrieben auf, aber das Paket gibt den Fortschritt zurück, der für den \_ \_ \_ erfolgreichen Erfolg benötigt wird.</span><span class="sxs-lookup"><span data-stu-id="26b0c-242">The client calls the function as described earlier, but the package returns the SEC\_I\_CONTINUE\_NEEDED success code.</span></span>
2.  <span data-ttu-id="26b0c-243">Der Client sendet das Ausgabe Token an den Server und wartet auf die Antwort des Servers.</span><span class="sxs-lookup"><span data-stu-id="26b0c-243">The client sends the output token to the server and waits for the server's reply.</span></span>
3.  <span data-ttu-id="26b0c-244">Beim Empfang der Serverantwort ruft der Client erneut **InitializeSecurityContext (NTLM)** auf, wobei *phcontext* auf das Handle festgelegt ist, das beim letzten Aufruf zurückgegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="26b0c-244">Upon receipt of the server's response, the client calls **InitializeSecurityContext (NTLM)** again, with *phContext* set to the handle that was returned from the last call.</span></span> <span data-ttu-id="26b0c-245">Das vom Server empfangene Token wird im *pinput* -Parameter bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="26b0c-245">The token received from the server is supplied in the *pInput* parameter.</span></span>

<span data-ttu-id="26b0c-246">Wenn der Server erfolgreich geantwortet hat, gibt das [*Sicherheitspaket*](../secgloss/s-gly.md) SEK \_ . E OK zurück, \_ und es wird eine sichere Sitzung eingerichtet.</span><span class="sxs-lookup"><span data-stu-id="26b0c-246">If the server has successfully responded, the [*security package*](../secgloss/s-gly.md) returns SEC\_E\_OK and a secure session is established.</span></span>

<span data-ttu-id="26b0c-247">Wenn die Funktion eine der Fehler Antworten zurückgibt, wird die Antwort des Servers nicht akzeptiert, und die Sitzung wird nicht festgelegt.</span><span class="sxs-lookup"><span data-stu-id="26b0c-247">If the function returns one of the error responses, the server's response is not accepted, and the session is not established.</span></span>

<span data-ttu-id="26b0c-248">Wenn die Funktion Sekunden zurück \_ gibt \_ , die ich \_ benötigtes, SEK \_ ., \_ \_ benötigtes \_ \_ \_ und \_ fortfahren, werden die Schritte 2 und 3 wiederholt.</span><span class="sxs-lookup"><span data-stu-id="26b0c-248">If the function returns SEC\_I\_CONTINUE\_NEEDED, SEC\_I\_COMPLETE\_NEEDED, or SEC\_I\_COMPLETE\_AND\_CONTINUE, steps 2 and 3 are repeated.</span></span>

<span data-ttu-id="26b0c-249">Um einen [*Sicherheitskontext*](../secgloss/s-gly.md)zu initialisieren, sind möglicherweise mehrere Aufrufe dieser Funktion erforderlich, je nach dem zugrunde liegenden Authentifizierungsmechanismus sowie den im *fContextReq* -Parameter angegebenen Optionen.</span><span class="sxs-lookup"><span data-stu-id="26b0c-249">To initialize a [*security context*](../secgloss/s-gly.md), more than one call to this function may be required, depending on the underlying authentication mechanism as well as the choices specified in the *fContextReq* parameter.</span></span>

<span data-ttu-id="26b0c-250">Die Parameter " *stmtreq* " und " *pfcontextattributes* " sind Bitmasken, die verschiedene Kontext Attribute darstellen.</span><span class="sxs-lookup"><span data-stu-id="26b0c-250">The *fContextReq* and *pfContextAttributes* parameters are bitmasks that represent various context attributes.</span></span> <span data-ttu-id="26b0c-251">Eine Beschreibung der verschiedenen Attribute finden Sie unter [Kontext Anforderungen](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="26b0c-251">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span> <span data-ttu-id="26b0c-252">Der *pfcontextattributes* -Parameter ist bei erfolgreicher Rückgabe gültig, aber nur bei der letzten erfolgreichen Rückgabe sollten Sie die Flags untersuchen, die die Sicherheitsaspekte des Kontexts betreffen.</span><span class="sxs-lookup"><span data-stu-id="26b0c-252">The *pfContextAttributes* parameter is valid on any successful return, but only on the final successful return should you examine the flags that pertain to security aspects of the context.</span></span> <span data-ttu-id="26b0c-253">Zwischen Rückgabewerte können festgelegt werden, z. b. das von ISC \_ ret \_ zugewiesene \_ arbeitsspeicherflag.</span><span class="sxs-lookup"><span data-stu-id="26b0c-253">Intermediate returns can set, for example, the ISC\_RET\_ALLOCATED\_MEMORY flag.</span></span>

<span data-ttu-id="26b0c-254">Wenn das \_ Flag für die Verwendung von ISC req- \_ \_ \_ verwendender Kennwort festgelegt ist, muss das [*Sicherheitspaket*](../secgloss/s-gly.md) \_ \_ im *pinput* -Eingabepuffer nach einem secbuffer-pkg-Parametertyp suchen.</span><span class="sxs-lookup"><span data-stu-id="26b0c-254">If the ISC\_REQ\_USE\_SUPPLIED\_CREDS flag is set, the [*security package*](../secgloss/s-gly.md) must look for a SECBUFFER\_PKG\_PARAMS buffer type in the *pInput* input buffer.</span></span> <span data-ttu-id="26b0c-255">Dabei handelt es sich nicht um eine generische Lösung, Sie ermöglicht jedoch eine starke Kopplung von [*Sicherheitspaketen*](../secgloss/s-gly.md) und Anwendungen, wenn dies angebracht ist.</span><span class="sxs-lookup"><span data-stu-id="26b0c-255">This is not a generic solution, but it allows for a strong pairing of [*security package*](../secgloss/s-gly.md) and application when appropriate.</span></span>

<span data-ttu-id="26b0c-256">Wenn ISC \_ req \_ Speicher belegt wurde, muss der Aufrufer \_ den Speicher freigeben, indem er die [**freecontextbuffer**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) -Funktion aufruft.</span><span class="sxs-lookup"><span data-stu-id="26b0c-256">If ISC\_REQ\_ALLOCATE\_MEMORY was specified, the caller must free the memory by calling the [**FreeContextBuffer**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) function.</span></span>

<span data-ttu-id="26b0c-257">Das Eingabe Token könnte z. b. die Herausforderung von einem LAN-Manager sein.</span><span class="sxs-lookup"><span data-stu-id="26b0c-257">For example, the input token could be the challenge from a LAN Manager.</span></span> <span data-ttu-id="26b0c-258">In diesem Fall wäre das Ausgabe Token die NTLM-verschlüsselte Antwort auf die Abfrage.</span><span class="sxs-lookup"><span data-stu-id="26b0c-258">In this case, the output token would be the NTLM-encrypted response to the challenge.</span></span>

<span data-ttu-id="26b0c-259">Welche Aktion der Client durchführt, hängt vom Rückgabecode dieser Funktion ab.</span><span class="sxs-lookup"><span data-stu-id="26b0c-259">The action the client takes depends on the return code from this function.</span></span> <span data-ttu-id="26b0c-260">Wenn der Rückgabecode sec \_ E \_ OK ist, gibt es keinen zweiten **InitializeSecurityContext (NTLM)** -Befehl, und es wird keine Antwort vom Server erwartet.</span><span class="sxs-lookup"><span data-stu-id="26b0c-260">If the return code is SEC\_E\_OK, there will be no second **InitializeSecurityContext (NTLM)** call, and no response from the server is expected.</span></span> <span data-ttu-id="26b0c-261">Wenn es sich bei dem Rückgabecode um "s" handelt \_ \_ \_ , erwartet der Client ein Token als Antwort vom Server und übergibt ihn in einem zweiten **callalizesecuritycontext (NTLM)**.</span><span class="sxs-lookup"><span data-stu-id="26b0c-261">If the return code is SEC\_I\_CONTINUE\_NEEDED, the client expects a token in response from the server and passes it in a second call to **InitializeSecurityContext (NTLM)**.</span></span> <span data-ttu-id="26b0c-262">Der von \_ mir \_ \_ benötigte Rückgabecode gibt an, dass der Client die Erstellung der Nachricht abschließen und die [**completeauthtoken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) -Funktion aufzurufen muss.</span><span class="sxs-lookup"><span data-stu-id="26b0c-262">The SEC\_I\_COMPLETE\_NEEDED return code indicates that the client must finish building the message and call the [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) function.</span></span> <span data-ttu-id="26b0c-263">Der Code "s \_ I \_ Complete \_ and \_ Continue" umfasst beide Aktionen.</span><span class="sxs-lookup"><span data-stu-id="26b0c-263">The SEC\_I\_COMPLETE\_AND\_CONTINUE code incorporates both of these actions.</span></span>

<span data-ttu-id="26b0c-264">Wenn **InitializeSecurityContext (NTLM)** beim ersten (oder einzigen) Aufruf Erfolg zurückgibt, muss der Aufrufer schließlich die [**Delta Context**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) -Funktion für das zurückgegebene Handle aufzurufen, auch wenn der Aufruf in einem späteren Abschnitt des Authentifizierungs Austauschs fehlschlägt.</span><span class="sxs-lookup"><span data-stu-id="26b0c-264">If **InitializeSecurityContext (NTLM)** returns success on the first (or only) call, then the caller must eventually call the [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) function on the returned handle, even if the call fails on a later leg of the authentication exchange.</span></span>

<span data-ttu-id="26b0c-265">Der Client ruft **InitializeSecurityContext (NTLM)** möglicherweise erneut auf, nachdem er erfolgreich abgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="26b0c-265">The client may call **InitializeSecurityContext (NTLM)** again after it has completed successfully.</span></span> <span data-ttu-id="26b0c-266">Dies gibt dem [*Sicherheitspaket*](../secgloss/s-gly.md) an, dass eine erneute Authentifizierung gewünscht wird.</span><span class="sxs-lookup"><span data-stu-id="26b0c-266">This indicates to the [*security package*](../secgloss/s-gly.md) that a reauthentication is wanted.</span></span>

<span data-ttu-id="26b0c-267">Kernelmodusaufrufer haben die folgenden Unterschiede: der Zielname ist eine [*Unicode*](../secgloss/u-gly.md) -Zeichenfolge, die mithilfe von [**virtualbelegc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc)im virtuellen Arbeitsspeicher zugeordnet werden muss. Er darf nicht aus dem Pool zugeordnet werden.</span><span class="sxs-lookup"><span data-stu-id="26b0c-267">Kernel mode callers have the following differences: the target name is a [*Unicode*](../secgloss/u-gly.md) string that must be allocated in virtual memory by using [**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc); it must not be allocated from the pool.</span></span> <span data-ttu-id="26b0c-268">Puffer, die in *pinput* und *poutput* übergeben und bereitgestellt werden, müssen sich im virtuellen Speicher befinden, nicht im Pool.</span><span class="sxs-lookup"><span data-stu-id="26b0c-268">Buffers passed and supplied in *pInput* and *pOutput* must be in virtual memory, not in the pool.</span></span>

## <a name="requirements"></a><span data-ttu-id="26b0c-269">Anforderungen</span><span class="sxs-lookup"><span data-stu-id="26b0c-269">Requirements</span></span>



| <span data-ttu-id="26b0c-270">Anforderung</span><span class="sxs-lookup"><span data-stu-id="26b0c-270">Requirement</span></span> | <span data-ttu-id="26b0c-271">Wert</span><span class="sxs-lookup"><span data-stu-id="26b0c-271">Value</span></span> |
|-------------------------------------|--------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="26b0c-272">Unterstützte Mindestversion (Client)</span><span class="sxs-lookup"><span data-stu-id="26b0c-272">Minimum supported client</span></span><br/> | <span data-ttu-id="26b0c-273">Nur Windows XP \[ -Desktop-Apps\]</span><span class="sxs-lookup"><span data-stu-id="26b0c-273">Windows XP \[desktop apps only\]</span></span><br/>                                                            |
| <span data-ttu-id="26b0c-274">Unterstützte Mindestversion (Server)</span><span class="sxs-lookup"><span data-stu-id="26b0c-274">Minimum supported server</span></span><br/> | <span data-ttu-id="26b0c-275">Nur Windows Server 2003 \[ -Desktop-Apps\]</span><span class="sxs-lookup"><span data-stu-id="26b0c-275">Windows Server 2003 \[desktop apps only\]</span></span><br/>                                                   |
| <span data-ttu-id="26b0c-276">Header</span><span class="sxs-lookup"><span data-stu-id="26b0c-276">Header</span></span><br/>                   | <dl> <span data-ttu-id="26b0c-277"><dt>SSPI. h (Include Security. h)</dt></span><span class="sxs-lookup"><span data-stu-id="26b0c-277"><dt>Sspi.h (include Security.h)</dt></span></span> </dl> |
| <span data-ttu-id="26b0c-278">Bibliothek</span><span class="sxs-lookup"><span data-stu-id="26b0c-278">Library</span></span><br/>                  | <dl> <span data-ttu-id="26b0c-279"><dt>Secur32. lib</dt></span><span class="sxs-lookup"><span data-stu-id="26b0c-279"><dt>Secur32.lib</dt></span></span> </dl>                 |
| <span data-ttu-id="26b0c-280">DLL</span><span class="sxs-lookup"><span data-stu-id="26b0c-280">DLL</span></span><br/>                      | <dl> <span data-ttu-id="26b0c-281"><dt>Secur32.dll</dt></span><span class="sxs-lookup"><span data-stu-id="26b0c-281"><dt>Secur32.dll</dt></span></span> </dl>                 |



## <a name="see-also"></a><span data-ttu-id="26b0c-282">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="26b0c-282">See also</span></span>

<dl> <dt>

[<span data-ttu-id="26b0c-283">SSPI-Funktionen</span><span class="sxs-lookup"><span data-stu-id="26b0c-283">SSPI Functions</span></span>](authentication-functions.md#sspi-functions)
</dt> <dt>

[<span data-ttu-id="26b0c-284">**Akzeptsecuritycontext (NTLM)**</span><span class="sxs-lookup"><span data-stu-id="26b0c-284">**AcceptSecurityContext (NTLM)**</span></span>](acceptsecuritycontext--ntlm.md)
</dt> <dt>

[<span data-ttu-id="26b0c-285">**AcquireCredentialsHandle (NTLM)**</span><span class="sxs-lookup"><span data-stu-id="26b0c-285">**AcquireCredentialsHandle (NTLM)**</span></span>](acquirecredentialshandle--ntlm.md)
</dt> <dt>

[<span data-ttu-id="26b0c-286">**CompleteAuthToken**</span><span class="sxs-lookup"><span data-stu-id="26b0c-286">**CompleteAuthToken**</span></span>](/windows/win32/api/sspi/nf-sspi-completeauthtoken)
</dt> <dt>

[<span data-ttu-id="26b0c-287">**Delta Context-Kontext**</span><span class="sxs-lookup"><span data-stu-id="26b0c-287">**DeleteSecurityContext**</span></span>](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext)
</dt> <dt>

[<span data-ttu-id="26b0c-288">**Freecontextbuffer**</span><span class="sxs-lookup"><span data-stu-id="26b0c-288">**FreeContextBuffer**</span></span>](/windows/win32/api/sspi/nf-sspi-freecontextbuffer)
</dt> <dt>

[<span data-ttu-id="26b0c-289">**Secbuffer**</span><span class="sxs-lookup"><span data-stu-id="26b0c-289">**SecBuffer**</span></span>](/windows/win32/api/sspi/ns-sspi-secbuffer)
</dt> <dt>

[<span data-ttu-id="26b0c-290">**Secbufferdebug**</span><span class="sxs-lookup"><span data-stu-id="26b0c-290">**SecBufferDesc**</span></span>](/windows/win32/api/sspi/ns-sspi-secbufferdesc)
</dt> </dl>

 

 
