---
description: Gibt Anmeldeinformationen zurück, um einen nicht in die Domäne beigetretenen Container bei Active Directory zu authentifizieren.
title: ICcgDomainAuthCredentials::GetPasswordCredentials-Methode (ccgplugins.h)
ms.topic: reference
ms.date: 10/21/2020
topic_type:
- APIRef
- kbSyntax
api_name:
- ICcgDomainAuthCredentials.GetPasswordCredentials
api_type:
- COM
api_location:
- ccgplugins.h
ms.openlocfilehash: abd70a109e491773b374ae32787760d265167baa
ms.sourcegitcommit: cb87082135319cbdc5df541e3071eebb83a58972
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 06/04/2021
ms.locfileid: "111387804"
---
# <a name="iccgdomainauthcredentialsgetpasswordcredentials-method"></a>ICcgDomainAuthCredentials::GetPasswordCredentials-Methode

Gibt Anmeldeinformationen zurück, um einen nicht in die Domäne beigetretenen Container bei Active Directory zu authentifizieren.

## <a name="syntax"></a>Syntax


```C++
HRESULT GetPasswordCredentials(
[in] LPCWSTR pluginInput, 
[out] LPWSTR* domainName, 
[out] LPWSTR* username, 
[out] LPWSTR* password);
);
```



## <a name="parameters"></a>Parameter

<dl> <dt>

*pluginInput* \[ In\]
</dt> <dd>

Eine von der Containerlaufzeit übergebene Eingabezeichenfolge. Die Clientimplementierung verwendet die bereitgestellte Eingabezeichenfolge, um Authentifizierungsanmeldeinformationen abzurufen, die in der Regel von einem sicheren Speicheranbieter abgerufen werden, die in den Ausgabeparametern zurückgegeben werden. Die Eingabezeichenfolge wird dem Host Compute Services (HCS) in einer Spezifikationsdatei für Anmeldeinformationen bereitgestellt. Weitere Informationen finden Sie im Abschnitt **Hinweise**.

</dd> </dl>

<dl> <dt>

*domainName* \[ out\]
</dt> <dd>

Der Domänenname für die Anmeldeinformationen.

</dd> </dl>

<dl> <dt>

*Benutzername* \[ out\]
</dt> <dd>

Der Benutzername für die Anmeldeinformationen.

</dd> </dl>

<dl> <dt>

*Kennwort* \[ out\]
</dt> <dd>

Das Kennwort für die Anmeldeinformationen.

</dd> </dl>

## <a name="return-value"></a>Rückgabewert

Der Rückgabewert ist ein **HRESULT.** Der Wert S \_ OK gibt an, dass der Aufruf erfolgreich war.

## <a name="remarks"></a>Hinweise

Die API kann gleichzeitig aufgerufen werden. Daher muss der Entwickler sicherstellen, dass seine Implementierung threadsicher ist. Darüber hinaus wird das COM-Objekt out-of-proc aktiviert und muss entsprechend registriert werden. 

Der Implementer muss einen Schlüssel unter "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\CCG\COMClasses" für seine COM-CLSID hinzufügen. Der Schreibzugriff auf "CCG\COMClasses" ist auf SYSTEM- und Administratorkonten beschränkt. 

Im Folgenden finden Sie eine Beispieldatei für die Spezifikation von Anmeldeinformationen. Informationen zur Bereitstellung dieser Datei für Docker finden Sie unter [Ausführen eines Containers mit einem gMSA.](/virtualization/windowscontainers/manage-containers/gmsa-run-container)

```json
{
    "CmsPlugins": [
        "ActiveDirectory"
    ],
    "DomainJoinConfig": {
        "Sid": "S-1-5-21-3700119848-2853083131-2094573802",
        "MachineAccountName": "gmsa1",
        "Guid": "630a7dd3-2d3e-4471-ae91-1d9ea2556cd5",
        "DnsTreeName": "contoso.com",
        "DnsName": "contoso.com",
        "NetBiosName": "CONTOSO"
    },
    "ActiveDirectoryConfig": {
        "GroupManagedServiceAccounts": [
            {
                "Name": "gmsa1",
                "Scope": "contoso.com"
            },
            {
                "Name": "gmsa1",
                "Scope": "CONTOSO"
            }
        ],
        "HostAccountConfig": {
            "PortableCcgVersion": "1",
            "PluginGUID": "{CFCA0441-511D-4B2A-862E-20348A78760B}",
            "PluginInput": "contoso.com:gmsaccg:<password>"
        }
    }
}

```

## <a name="examples"></a>Beispiele

Das folgende Beispiel zeigt eine einfache Implementierung von **ICcgDomainAuthCredentials**. Beachten Sie, dass dieses Beispiel zur Veranschaulichung die Anmeldeinformationen durch einfache Analyse der Eingabezeichenfolge erhält. Eine reale Implementierung würde die Anmeldeinformationen in einem sicheren Datenspeicher speichern und die Eingabezeichenfolge verwenden, um die Anmeldeinformationen zu finden. Außerdem wurden die STANDARDMÄßIGEN COM-Methodenimplementierungen in diesem Beispiel aus Kürze weggelassen.


```C++
// UUID generated by the developer
[uuid("cfca0441-511d-4b2a-862e-20348a78760b")] 
class CCGStubPlugin : public RuntimeClass<RuntimeClassFlags<RuntimeClassType::ClassicCom>, ICcgDomainAuthCredentials >
{
   public:
    CCGStubPlugin() {}

    ~CCGStubPlugin() {}

    IFACEMETHODIMP GetPasswordCredentials(
        _In_ LPCWSTR pluginInput,
        _Outptr_ LPWSTR *domainName,
        _Outptr_ LPWSTR *username,
        _Outptr_ LPWSTR *password)
    {
        std::wstring domainParsed, userParsed, passwordParsed; 
        try
        {
            if(domainName == NULL || username == NULL || password == NULL)
            {
                return STG_E_INVALIDPARAMETER;
            }
            *domainName = NULL;
            *username = NULL;
            *password = NULL;
            wstring pluginInputString(pluginInput);
            if (count(pluginInputString.begin(), pluginInputString.end(), ':') < 2)
            {
                return CO_E_NOT_SUPPORTED;
            }
            // Extract creds of this format Domain:Username:Password
            size_t sep1 = pluginInputString.find(L":");
            size_t sep2 = pluginInputString.find(L":", sep1 + 1);
            domainParsed = pluginInputString.substr(0, sep1);
            userParsed = pluginInputString.substr(sep1 + 1, sep2 - sep1 - 1);
            passwordParsed = pluginInputString.substr(sep2 + 1);
        }
        catch (...)
        {
            return EVENT_E_INTERNALERROR;
        }

        auto userCo = wil::make_cotaskmem_string_nothrow(userParsed.c_str());
        auto passwordCo = wil::make_cotaskmem_string_nothrow(passwordParsed.c_str());
        auto domainCo = wil::make_cotaskmem_string_nothrow(domainParsed.c_str());
        if (userCo == nullptr || passwordCo == nullptr || domainCo == nullptr)
        {
            return STG_E_INSUFFICIENTMEMORY;
        }

        *domainName = domainCo.release();
        *username = userCo.release();
        *password = passwordCo.release();
        return S_OK;
    }
};
CoCreatableClass(CCGStubPlugin);

```



## <a name="requirements"></a>Requirements (Anforderungen)




| Anforderung | Wert |
|-------------------------------------|-----------------------------------------------------------------------------------------|
| Unterstützte Mindestversion (Server) | Windows Server, Version 2004                                    |
| Header                   | ccgplugins.h   |
| IID                    | 6ecda518-2010-4437-8bc3-46e752b7b172          |



 

