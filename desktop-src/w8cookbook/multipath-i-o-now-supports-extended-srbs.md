---
title: Multipfad-e/a unterstützt jetzt erweiterte Speicher Anforderungs Blöcke.
description: Multipfad-e/a unterstützt jetzt erweiterte Speicher Anforderungs Blöcke.
ms.assetid: 5373D9ED-34AF-4D66-8888-49F1EBF768F4
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f558f8088b5066b51447c5f2ea23edd5154d5c10
ms.sourcegitcommit: 46376be61d3fa308f9b1a06d7e2fa122a39755af
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/10/2020
ms.locfileid: "104316658"
---
# <a name="multipath-io-now-supports-extended-storage-request-blocks"></a><span data-ttu-id="226a7-103">Multipfad-e/a unterstützt jetzt erweiterte Speicher Anforderungs Blöcke.</span><span class="sxs-lookup"><span data-stu-id="226a7-103">Multipath I/O now supports extended storage request blocks</span></span>

## <a name="platforms"></a><span data-ttu-id="226a7-104">Plattformen</span><span class="sxs-lookup"><span data-stu-id="226a7-104">Platforms</span></span>

<span data-ttu-id="226a7-105">**Server** – Windows Server 2012</span><span class="sxs-lookup"><span data-stu-id="226a7-105">**Servers** – Windows Server 2012</span></span> 

## <a name="description"></a><span data-ttu-id="226a7-106">BESCHREIBUNG</span><span class="sxs-lookup"><span data-stu-id="226a7-106">Description</span></span>

<span data-ttu-id="226a7-107">In Windows Server 2012, einer neuen Struktur, ersetzt der Speicher \_ Anforderungs \_ Block (Extended SRB) den SCSI- \_ Anforderungs \_ Block (Legacy SRB) im Kernspeicher Stapel.</span><span class="sxs-lookup"><span data-stu-id="226a7-107">In Windows Server 2012, a new structure, the STORAGE\_REQUEST\_BLOCK (extended SRB) replaces the SCSI\_REQUEST\_BLOCK (legacy SRB) in the core storage stack.</span></span> <span data-ttu-id="226a7-108">Erweiterte SRSB repliziert die Funktionalität der Legacy-SRSB, sind aber auch erweiterbar und skalierbar.</span><span class="sxs-lookup"><span data-stu-id="226a7-108">Extended SRBs replicate the functionality of the legacy SRBs, but are also extensible and scalable.</span></span>

<span data-ttu-id="226a7-109">Multipfad-e/a (MPIO) unterstützt erweiterte SRSB und ermöglicht es gerätespezifischen Modulen (DSMs), auch erweiterte SRB-Unterstützung anzugeben.</span><span class="sxs-lookup"><span data-stu-id="226a7-109">Multipath I/O (MPIO) supports extended SRBs and allows Device Specific Modules (DSMs) to specify extended SRB support as well.</span></span> <span data-ttu-id="226a7-110">Damit der Speicher Stapel eines Multipfad-Geräts erweiterte SRB-Objekte verwenden kann, **müssen jedoch alle Komponenten im Stapel erweiterte SRB-Unterstützung (einschließlich DSM) unterstützen**.</span><span class="sxs-lookup"><span data-stu-id="226a7-110">However, in order for a multipath device’s storage stack to use extended SRBs, **all components in the stack must support extended SRBs, including the DSM**.</span></span> <span data-ttu-id="226a7-111">Beachten Sie, dass das Microsoft-in-Box-DSM, MSDSM, erweiterte SRSB unterstützt.</span><span class="sxs-lookup"><span data-stu-id="226a7-111">Note that the Microsoft in-box DSM, MSDSM, does support extended SRBs.</span></span>

<span data-ttu-id="226a7-112">Die SCSI- \_ Pass- \_ through- \_ Struktur ist nicht Teil der erweiterten MPIO-Pass-Through-Struktur, da der erweiterte SCSI-Durchlauf eine Variable Größe aufweisen kann, je nach Befehlszeilen Debugger (CDB).</span><span class="sxs-lookup"><span data-stu-id="226a7-112">The SCSI\_PASS\_THROUGH\_EX structure is not part of the extended MPIO pass through structure since the extended SCSI pass through can be of a variable size, depending on the command line debugger (CDB).</span></span> <span data-ttu-id="226a7-113">Stattdessen verfügt der erweiterte MPIO-Durchlauf über ein Feld, das den Offset vom Anfang der erweiterten MPIO-Pass-Through-Struktur zur SCSI- \_ Pass-Through-Struktur beschreibt \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="226a7-113">Instead, the extended MPIO pass through has a field that describes the offset from the beginning of the extended MPIO pass through structure to the SCSI\_PASS\_THROUGH\_EX structure.</span></span> <span data-ttu-id="226a7-114">Der Aufrufer muss sicherstellen, dass er einen Puffer der entsprechenden Größe zuweist und den SCSI-Pass-Through-Offset ordnungsgemäß festgelegt</span><span class="sxs-lookup"><span data-stu-id="226a7-114">The caller must make sure they allocate a buffer of the appropriate size and set the SCSI pass through offset correctly.</span></span> <span data-ttu-id="226a7-115">Solange der Aufrufer den Regeln für erweiterte SCSI-Pass-Through-Vorgänge folgt, sollten keine zusätzlichen Aufgaben für die Verwendung des erweiterten MPIO-Pass-Through ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="226a7-115">As long as the caller follows the rules for extended SCSI pass-throughs, then there should not be any extra work for them to use the extended MPIO pass through.</span></span>

> [!Note]  
> <span data-ttu-id="226a7-116">Wenn das DSM erweiterte SRB nicht unterstützt, schlägt MPIO für erweiterte MPIO-Pass-Through-Anforderungen fehl, für die das MPIO \_ IOCTL- \_ Flag das \_ DSM- \_ Flag Set umfasst.</span><span class="sxs-lookup"><span data-stu-id="226a7-116">If the DSM does not support extended SRBs, MPIO will fail extended MPIO pass through requests that have the MPIO\_IOCTL\_FLAG\_INVOLVE\_DSM flag set.</span></span>

 

## <a name="manifestation"></a><span data-ttu-id="226a7-117">Ausstrahlung</span><span class="sxs-lookup"><span data-stu-id="226a7-117">Manifestation</span></span>

<span data-ttu-id="226a7-118">Wenn ein beliebiger Teil des Speicher Stapels des Geräts, einschließlich DSM, erweiterte SRB-Objekte nicht unterstützt, wird der Speicher Stapel auf Legacy-SRB zurückgesetzt.</span><span class="sxs-lookup"><span data-stu-id="226a7-118">If any part of the device’s storage stack, including DSM, does not support extended SRBs, the storage stack will revert to using legacy SRBs.</span></span>

## <a name="solution"></a><span data-ttu-id="226a7-119">Lösung</span><span class="sxs-lookup"><span data-stu-id="226a7-119">Solution</span></span>

<span data-ttu-id="226a7-120">Es gibt nur zwei MPIO-Anforderungen für ein DSM, um Speicher Anforderungs Blöcke zu unterstützen \_ \_ :</span><span class="sxs-lookup"><span data-stu-id="226a7-120">There are only two MPIO requirements for a DSM to support STORAGE\_REQUEST\_BLOCKS:</span></span>

-   <span data-ttu-id="226a7-121">Das DSM muss seinen Typ als DsmType6 melden.</span><span class="sxs-lookup"><span data-stu-id="226a7-121">The DSM must report its type as DsmType6</span></span>
-   <span data-ttu-id="226a7-122">Das DSM muss die Funktion "DSM \_ Address \_ Type \_ supported" bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="226a7-122">The DSM must provide the DSM\_ADDRESS\_TYPE\_SUPPORTED function</span></span>

<span data-ttu-id="226a7-123">Wenn das DSM DsmType6 nicht meldet oder wenn es meldet DsmType6, aber die Funktion "DSM Address Type supported" nicht bereitstellt \_ \_ \_ , wird von MPIO angenommen, dass das DSM erweiterte SRSB nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="226a7-123">If the DSM does not report DsmType6 or if it reports DsmType6 but does not provide the DSM\_ADDRESS\_TYPE\_SUPPORTED function, MPIO will assume the DSM does not support extended SRBs.</span></span>

<span data-ttu-id="226a7-124">Die \_ \_ unterstützte DSM Address Type- \_ Funktion akzeptiert zwei Parameter, von denen einer ein Adresstyp ist.</span><span class="sxs-lookup"><span data-stu-id="226a7-124">The DSM\_ADDRESS\_TYPE\_SUPPORTED function accepts two parameters, one of which is an address type.</span></span> <span data-ttu-id="226a7-125">Dieser Adresstyp muss einer der Werte für den Speicher \_ \_ Adresstyp sein, der \_ \* in SRB. h definiert ist.</span><span class="sxs-lookup"><span data-stu-id="226a7-125">This address type must be one of the STORAGE\_ADDRESS\_TYPE\_\* values defined in srb.h.</span></span> <span data-ttu-id="226a7-126">Das DSM muss "true" zurückgeben, wenn es den angegebenen adrestyp unterstützt, andernfalls "false".</span><span class="sxs-lookup"><span data-stu-id="226a7-126">The DSM must return TRUE if it supports the given address type and FALSE if it does not.</span></span> <span data-ttu-id="226a7-127">Die Definition von "Support" ist letztendlich das DSM.</span><span class="sxs-lookup"><span data-stu-id="226a7-127">The definition of “support” is ultimately up to the DSM.</span></span> <span data-ttu-id="226a7-128">MPIO verwendet diese Funktion, um sicherzustellen, dass das DSM nicht falsch verhält, wenn ein erweitertes SRB mit einer Stor- \_ Adressstruktur des angegebenen Typs übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="226a7-128">MPIO uses this function to ensure that the DSM will not misbehave if it is handed an extended SRB with a STOR\_ADDRESS structure of the given type.</span></span> <span data-ttu-id="226a7-129">Daher ruft MPIO diese Funktion im Allgemeinen auf, wenn ein multipfadgerät aufgezählt wird, aber die Funktion kann jederzeit aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="226a7-129">As such, MPIO generally calls this function when a multipath device is being enumerated, but the function could be called at any time.</span></span>

<span data-ttu-id="226a7-130">Wenn ein DSM nie die Stor-Adresse eines erweiterten SRB berührt \_ , kann es für jeden gültigen Wert des Speicher \_ Adress Typs "true" zurückgeben \_ \_ \* .</span><span class="sxs-lookup"><span data-stu-id="226a7-130">If a DSM never touches an extended SRB’s STOR\_ADDRESS, then it can return TRUE for any valid STORAGE\_ADDRESS\_TYPE\_\* value.</span></span> <span data-ttu-id="226a7-131">Lesen Sie das Beispiel-DSM im WDK.</span><span class="sxs-lookup"><span data-stu-id="226a7-131">Review the sample DSM in the WDK.</span></span>

<span data-ttu-id="226a7-132">**Andere wichtige Hinweise**</span><span class="sxs-lookup"><span data-stu-id="226a7-132">**Other important notes**</span></span>

-   <span data-ttu-id="226a7-133">DSMs, die erweiterte SRBs unterstützen, muss sowohl SCSI \_ -Anforderungs \_ Block Strukturen als auch Speicher \_ Anforderungs Block- \_ Strukturen verarbeiten können.</span><span class="sxs-lookup"><span data-stu-id="226a7-133">DSMs that support extended SRBs must be able to handle both SCSI\_REQUEST\_BLOCK structures and STORAGE\_REQUEST\_BLOCK structures.</span></span> <span data-ttu-id="226a7-134">Nur weil ein DSM meldet, dass erweiterte SRSB unterstützt werden, bedeutet das nicht, dass es exklusiv erweiterte SRSB empfängt.</span><span class="sxs-lookup"><span data-stu-id="226a7-134">Just because a DSM reports that it supports extended SRBs does not mean that it will exclusively receive extended SRBs.</span></span> <span data-ttu-id="226a7-135">Es kann weiterhin eine beliebige Anzahl von Legacy-SRB-Systemen zusätzlich zu erweiterten SRB-Systemen empfangen und muss daher beide verarbeiten können.</span><span class="sxs-lookup"><span data-stu-id="226a7-135">It may still receive any number of legacy SRBs in addition to extended SRBs, and therefore must be able to handle both.</span></span>
-   <span data-ttu-id="226a7-136">Wir haben im WDK eine Header Datei mit dem Namen "srbhelper. h" bereitgestellt, die Inline Funktionen enthält, um Treiber zu unterstützen, die sowohl erweiterte als auch ältere SRB verarbeiten müssen.</span><span class="sxs-lookup"><span data-stu-id="226a7-136">We have provided a header file in the WDK called srbhelper.h that contains inline functions to help drivers that must handle both extended and legacy SRBs.</span></span> <span data-ttu-id="226a7-137">In unserem Beispiel-DSM wird dieser Header verwendet, damit Sie ihn als ein Beispiel für die Verwendung dieser Funktionen verwenden können.</span><span class="sxs-lookup"><span data-stu-id="226a7-137">Our sample DSM uses this header so you can use it as an example of how to use these functions.</span></span>
-   <span data-ttu-id="226a7-138">Ein DSM, das erweiterte SRSB nicht unterstützt, muss niemals erweiterte SRSB verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="226a7-138">A DSM that does not support extended SRBs will never have to handle extended SRBs.</span></span>
-   <span data-ttu-id="226a7-139">Es ist möglich, dass ein MPIO dazu führt, dass der Speicher Stapel auf Legacy-SRB zurückgreift, wenn das DSM einen bestimmten Speicher Adresstyp nicht unterstützt \_ \_ \_ \* (aber andernfalls erweiterte SRB unterstützt).</span><span class="sxs-lookup"><span data-stu-id="226a7-139">It’s possible that a MPIO will cause the storage stack to fall back on legacy SRBs in the event that the DSM does not support a given STORAGE\_ADDRESS\_TYPE\_\* (but otherwise supports extended SRBs).</span></span>
-   <span data-ttu-id="226a7-140">"BTL8" ist der einzige Speicher \_ Adresstyp, der \_ \_ \* derzeit für Windows Server 2012 definiert ist.</span><span class="sxs-lookup"><span data-stu-id="226a7-140">“BTL8” is the only STORAGE\_ADDRESS\_TYPE\_\*currently defined for Windows Server 2012.</span></span>

 

 




