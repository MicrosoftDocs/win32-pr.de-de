---
description: Dieser Abschnitt enthält eine Übersicht über das Modell der direkten Manipulations Bearbeitung, die Art und Weise, wie Fenster Meldungen durch direkte Bearbeitung verarbeitet werden und wie sich der Zustand eines Viewports ändert, wenn Eingaben Ausgabe Bewegungen zugeordnet werden.
ms.assetid: 0818E34E-990E-4C36-9954-EF87EB226AF6
title: Verarbeiten von Eingaben mit directmanipulation
ms.topic: article
ms.date: 02/03/2020
ms.openlocfilehash: 284a0a1866a2082e2c34c65de347b0dcdfab3a64
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/06/2021
ms.locfileid: "106343553"
---
# <a name="processing-input-with-directmanipulation"></a><span data-ttu-id="6c527-103">Verarbeiten von Eingaben mit directmanipulation</span><span class="sxs-lookup"><span data-stu-id="6c527-103">Processing input with DirectManipulation</span></span>

<span data-ttu-id="6c527-104">Dieser Abschnitt enthält eine Übersicht über das Modell der [direkten Manipulations](direct-manipulation-portal.md) Bearbeitung, die Art und Weise, wie Fenster Meldungen durch direkte Bearbeitung verarbeitet werden und wie sich der Zustand eines Viewports ändert, wenn Eingaben Ausgabe Bewegungen zugeordnet werden.</span><span class="sxs-lookup"><span data-stu-id="6c527-104">This section provides an overview of the [Direct Manipulation](direct-manipulation-portal.md) threading model, how window messages are processed by Direct Manipulation, and how the state of a viewport changes as input is mapped to output motions.</span></span>

- [<span data-ttu-id="6c527-105">Eingabe Fluss</span><span class="sxs-lookup"><span data-stu-id="6c527-105">Input flow</span></span>](#input-flow)
- [<span data-ttu-id="6c527-106">Anmerkungen</span><span class="sxs-lookup"><span data-stu-id="6c527-106">Remarks</span></span>](#remarks)

<span data-ttu-id="6c527-107">Die [direkte Manipulation](direct-manipulation-portal.md) verwendet zwei Threads zum Koordinieren von asynchronen Vorgängen:</span><span class="sxs-lookup"><span data-stu-id="6c527-107">[Direct Manipulation](direct-manipulation-portal.md) uses two threads to coordinate asynchronous operations:</span></span>

<span data-ttu-id="6c527-108">*UI-Thread* : der Thread, der das **HWND** besitzt, das mit Input verknüpft ist.</span><span class="sxs-lookup"><span data-stu-id="6c527-108">*UI thread* - the thread that owns the **HWND** associated with input.</span></span> <span data-ttu-id="6c527-109">Dieser Thread besitzt die Initialisierung der [direkten Bearbeitung](direct-manipulation-portal.md).</span><span class="sxs-lookup"><span data-stu-id="6c527-109">This thread owns initialization of [Direct Manipulation](direct-manipulation-portal.md).</span></span> <span data-ttu-id="6c527-110">Die Maus-und Tastatureingabe Verarbeitung erfolgt ebenfalls im UI-Thread.</span><span class="sxs-lookup"><span data-stu-id="6c527-110">Mouse and keyboard input processing also happens on the UI thread.</span></span>

<span data-ttu-id="6c527-111">*Delegatthread* -der Thread, der erstellt wurde und sich im Besitz einer [direkten Bearbeitung](direct-manipulation-portal.md)befindet</span><span class="sxs-lookup"><span data-stu-id="6c527-111">*Delegate thread* - the thread created and owned by [Direct Manipulation](direct-manipulation-portal.md).</span></span> <span data-ttu-id="6c527-112">Die Berührungs Eingabe Verarbeitung erfolgt im delegatenthread.</span><span class="sxs-lookup"><span data-stu-id="6c527-112">Touch input processing happens on the delegate thread.</span></span>

## <a name="input-flow"></a><span data-ttu-id="6c527-113">Eingabe Fluss</span><span class="sxs-lookup"><span data-stu-id="6c527-113">Input flow</span></span>

<span data-ttu-id="6c527-114">In einer typischen Konfiguration, bei der Treffer Tests im UI-Thread durchgeführt werden, werden Fenster Meldungen von [direkter Bearbeitung](direct-manipulation-portal.md) in der folgenden Reihenfolge verarbeitet:</span><span class="sxs-lookup"><span data-stu-id="6c527-114">In a typical configuration where hit testing is done on the UI thread, window messages are processed by [Direct Manipulation](direct-manipulation-portal.md) in the following order:</span></span>

![Diagramm, das die Reihenfolge anzeigt, in der Nachrichten verarbeitet werden.](images/inputprocessing.png)

<span data-ttu-id="6c527-116">Für einen Viewport im Ruhezustand:</span><span class="sxs-lookup"><span data-stu-id="6c527-116">For a viewport at rest:</span></span>

1. <span data-ttu-id="6c527-117">Eine Reihe von Fenster Meldungen erreichen den delegatenthread.</span><span class="sxs-lookup"><span data-stu-id="6c527-117">A series of window messages reach the delegate thread.</span></span>
2. <span data-ttu-id="6c527-118">[WM_POINTERDOWN](../inputmsg/wm-pointerdown.md) -und [DM_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) -Nachrichten werden vom delegatenthread an den IHT-Thread (Independent Hit Test) gesendet.</span><span class="sxs-lookup"><span data-stu-id="6c527-118">[WM_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) messages are sent by the delegate thread to the Independent Hit Test (IHT) thread.</span></span>
3. <span data-ttu-id="6c527-119">Wenn [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) vom IHT-Thread aufgerufen wird, werden Nachrichten möglicherweise vom delegatenthread an den UI-Thread gesendet, abhängig vom Wert des [**directmanipulation- \_ \_ hittesttyps**](/windows/win32/api/directmanipulation/ne-directmanipulation-directmanipulation_hittest_type) , wenn [**registerhittesttarget**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-registerhittesttarget) aufgerufen wurde.</span><span class="sxs-lookup"><span data-stu-id="6c527-119">If [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) is called from the IHT thread, messages might get sent to the UI thread by the delegate thread, depending on the value of [**DIRECTMANIPULATION\_HITTEST\_TYPE**](/windows/win32/api/directmanipulation/ne-directmanipulation-directmanipulation_hittest_type) when [**RegisterHitTestTarget**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-registerhittesttarget) was called.</span></span>
4. <span data-ttu-id="6c527-120">Wenn [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) nicht vom IHT-Thread aufgerufen wird, werden Nachrichten immer vom delegatenthread an den UI-Thread gesendet.</span><span class="sxs-lookup"><span data-stu-id="6c527-120">If [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) is not called from the IHT thread, messages are always sent by the delegate thread to the UI thread.</span></span>
5. <span data-ttu-id="6c527-121">Der Client kann " [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) " aus dem UI-Thread aufrufen, damit die [direkte Manipulation](direct-manipulation-portal.md) eine Manipulation erkennen kann.</span><span class="sxs-lookup"><span data-stu-id="6c527-121">The client can call [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) from the UI thread to let [Direct Manipulation](direct-manipulation-portal.md) detect a manipulation.</span></span>
6. <span data-ttu-id="6c527-122">Wenn eine Manipulation erkannt wird, sendet die [direkte Manipulation](direct-manipulation-portal.md) eine [WM/_POINTERCAPTURECHANGED-](../inputmsg/wm-pointercapturechanged.md) Nachricht, um den Client zu benachrichtigen, dass die Eingabe von direkter Bearbeitung verarbeitet wird.</span><span class="sxs-lookup"><span data-stu-id="6c527-122">If a manipulation is detected, [Direct Manipulation](direct-manipulation-portal.md) sends a [WM/_POINTERCAPTURECHANGED](../inputmsg/wm-pointercapturechanged.md) message to notify the client that the input is being handled by Direct Manipulation.</span></span> <span data-ttu-id="6c527-123">Der viewportstatus wird auf "wird **ausgeführt** " festgelegt, und die Ausgabe Transformation wird aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="6c527-123">The viewport status is set to **RUNNING** and the output transform will be updated.</span></span>
7. <span data-ttu-id="6c527-124">Wenn eine andere Interaktion als eine Manipulation erkannt wird, sendet die [direkte Manipulation](direct-manipulation-portal.md) verbleibende Nachrichten an den UI-Thread.</span><span class="sxs-lookup"><span data-stu-id="6c527-124">If an interaction other than a manipulation is detected, [Direct Manipulation](direct-manipulation-portal.md) sends remaining messages to the UI thread.</span></span>

<span data-ttu-id="6c527-125">Für einen Viewport in Bewegung (mit dem Status "wird ausgeführt" oder "Trägheit") erreicht die Fenster Meldung zuerst den delegatenthread, bei dem die [direkte Manipulation](direct-manipulation-portal.md) Tests für alle laufenden Viewports durchführt.</span><span class="sxs-lookup"><span data-stu-id="6c527-125">For a viewport in motion (with a status of RUNNING or INERTIA), the window message reaches the delegate thread first, where [Direct Manipulation](direct-manipulation-portal.md) hit tests against all running viewports.</span></span> <span data-ttu-id="6c527-126">Die direkte Bearbeitung weist den Kontakt automatisch den entsprechenden Viewports zu, die durch Treffer Tests identifiziert werden.</span><span class="sxs-lookup"><span data-stu-id="6c527-126">Direct Manipulation automatically assigns the contact to the appropriate viewports identified by hit testing.</span></span> <span data-ttu-id="6c527-127">Der viewportstatus wird ausgeführt, und die Ausgabe Transformation wird aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="6c527-127">The viewport status is RUNNING and the output transform will be updated.</span></span>

<span data-ttu-id="6c527-128">In einigen Fällen kann ein Anwendungs Benutzeroberflächen Thread zu langsam sein, um auf Treffer Tests zu reagieren.</span><span class="sxs-lookup"><span data-stu-id="6c527-128">In some cases, an application UI thread may be too slow to respond to hit testing.</span></span> <span data-ttu-id="6c527-129">Ein Treffer Test Thread kann verwendet werden,[](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-registerhittesttarget)um dem Client das Verschieben von [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) -und [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) -Nachrichten in einen bestimmten Thread zu ermöglichen, sodass Treffer Tests möglich sind.</span><span class="sxs-lookup"><span data-stu-id="6c527-129">A hit test thread may be used ([**RegisterHitTestTarget**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-registerhittesttarget)) to allow the client to move [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) messages to a specific thread to allow for hit testing.</span></span>

## <a name="remarks"></a><span data-ttu-id="6c527-130">Bemerkungen</span><span class="sxs-lookup"><span data-stu-id="6c527-130">Remarks</span></span>

<span data-ttu-id="6c527-131">In der Regel sendet die [direkte Manipulation](direct-manipulation-portal.md) nur die Nachrichten vom Typ " [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) " und " [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) " an den UI-Thread, wobei spätere Nachrichten beim Warten auf eine Antwort vom Client</span><span class="sxs-lookup"><span data-stu-id="6c527-131">Typically, [Direct Manipulation](direct-manipulation-portal.md) sends only [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) messages to the UI thread, withholding later messages while waiting for a response from the client.</span></span> <span data-ttu-id="6c527-132">Wenn der Client [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact)aufruft, empfängt der UI-Thread nur dann, wenn eine Manipulation erkannt wird, die Informationen [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) und [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md)und [WM/_POINTERCAPTURECHANGED](../inputmsg/wm-pointercapturechanged.md).</span><span class="sxs-lookup"><span data-stu-id="6c527-132">If the client calls [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact), the only messages the UI thread receives when a manipulation is detected are [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md), and [WM/_POINTERCAPTURECHANGED message](../inputmsg/wm-pointercapturechanged.md).</span></span>

<span data-ttu-id="6c527-133">Beim Verarbeiten von [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) -und [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) -Nachrichten ruft der Client möglicherweise nicht [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) auf.</span><span class="sxs-lookup"><span data-stu-id="6c527-133">The client might not call [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) when processing [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) messages.</span></span> <span data-ttu-id="6c527-134">In diesem Fall sendet die [direkte Manipulation](direct-manipulation-portal.md) alle Nachrichten an den UI-Thread, ohne die Nachrichten zu analysieren, um festzustellen, ob eine Bearbeitung vorliegt.</span><span class="sxs-lookup"><span data-stu-id="6c527-134">In this case, [Direct Manipulation](direct-manipulation-portal.md) sends all messages to the UI thread without analyzing the messages to see if there is a manipulation.</span></span> <span data-ttu-id="6c527-135">Der Client kann dann einen beliebigen Punkt auswählen, um **SetContact** aufzurufen, und die direkte Bearbeitung der Erkennung von Manipulationen und das Senden von [WM/_POINTERCAPTURECHANGED Nachrichten](../inputmsg/wm-pointercapturechanged.md) Nachrichten senden, wenn ein solcher erkannt wird.</span><span class="sxs-lookup"><span data-stu-id="6c527-135">The client can then choose any point to call **SetContact** and have Direct Manipulation start detecting manipulations, and send [WM/_POINTERCAPTURECHANGED message](../inputmsg/wm-pointercapturechanged.md) messages when one is detected.</span></span>

<span data-ttu-id="6c527-136">**Windows 10 und höher:** Sie können entscheiden, welche Manipulationen Sie behandeln möchten, indem Sie " [**defercontact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationdefercontactservice-defercontact) " aufrufen, bevor Sie " [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) " in einer [WM/_POINTERDOWN-](../inputmsg/wm-pointerdown.md) oder [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) -Nachricht aufrufen.</span><span class="sxs-lookup"><span data-stu-id="6c527-136">**Windows 10 and later:** You can decide which manipulations you want to handle by calling [**DeferContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationdefercontactservice-defercontact) before calling [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) on a [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) or [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) message.</span></span> <span data-ttu-id="6c527-137">**Defercontact** stellt sicher, dass alle nachfolgenden Nachrichten für den angegebenen Zeitraum an den UI-Thread gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="6c527-137">**DeferContact** ensures all subsequent messages are sent to the UI thread for the specified period of time.</span></span>
