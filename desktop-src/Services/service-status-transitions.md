---
description: Ein Dienst ist dafür verantwortlich, seine Statusänderungen an den Dienststeuerungs-Manager (Service Control Manager, SCM) zu melden.
ms.assetid: 74a85730-6667-46fe-ae12-26561ccedb73
title: Dienststatus Übergänge
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8df7684b1ebc04aa1116b09a3ae4321f2552d7b6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "104568619"
---
# <a name="service-state-transitions"></a><span data-ttu-id="9bbb0-103">Dienststatus Übergänge</span><span class="sxs-lookup"><span data-stu-id="9bbb0-103">Service State Transitions</span></span>

<span data-ttu-id="9bbb0-104">Ein Dienst ist dafür verantwortlich, seine Statusänderungen an den Dienststeuerungs-Manager (Service Control Manager, SCM) zu melden.</span><span class="sxs-lookup"><span data-stu-id="9bbb0-104">A service is responsible for reporting changes in its state to the service control manager (SCM).</span></span> <span data-ttu-id="9bbb0-105">Dienst Steuerungsprogramme und das System können den Zustand eines Dienstanbieter nur über den SCM ermitteln, daher ist es wichtig, dass ein Dienst seinen Zustand korrekt meldet.</span><span class="sxs-lookup"><span data-stu-id="9bbb0-105">Service control programs and the system can find out the state of a service only from the SCM, so it is important that a service report its state correctly.</span></span> <span data-ttu-id="9bbb0-106">Ein Dienst meldet seinen Zustand, indem er die Funktion [**SetServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus) mit einem Zeiger auf eine vollständig initialisierte [**Dienst \_ Status**](/windows/desktop/api/Winsvc/ns-winsvc-service_status) Struktur aufruft.</span><span class="sxs-lookup"><span data-stu-id="9bbb0-106">A service reports its state by calling the [**SetServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus) function with a pointer to a fully initialized [**SERVICE\_STATUS**](/windows/desktop/api/Winsvc/ns-winsvc-service_status) structure.</span></span> <span data-ttu-id="9bbb0-107">Der **dwcurrentstate** -Member der-Struktur enthält den Dienststatus, der gemeldet werden soll.</span><span class="sxs-lookup"><span data-stu-id="9bbb0-107">The **dwCurrentState** member of the structure contains the service state to be reported.</span></span>

<span data-ttu-id="9bbb0-108">Der anfängliche Zustand eines Dienstanbieter ist "Dienst \_ beendet".</span><span class="sxs-lookup"><span data-stu-id="9bbb0-108">The initial state of a service is SERVICE\_STOPPED.</span></span> <span data-ttu-id="9bbb0-109">Wenn der SCM den Dienst startet, legt er den Dienststatus auf " \_ ausstehende Dienst Start" fest \_ und ruft die [*ServiceMain*](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) -Funktion des dienstaners auf.</span><span class="sxs-lookup"><span data-stu-id="9bbb0-109">When the SCM starts the service, it sets the service state to SERVICE\_START\_PENDING and calls the service's [*ServiceMain*](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) function.</span></span> <span data-ttu-id="9bbb0-110">Der Dienst schließt dann seine Initialisierung mit einer der in [Service Main-Funktion](service-servicemain-function.md)beschriebenen Verfahren ab.</span><span class="sxs-lookup"><span data-stu-id="9bbb0-110">The service then completes its initialization using one of the techniques described in [Service ServiceMain Function](service-servicemain-function.md).</span></span> <span data-ttu-id="9bbb0-111">Nachdem der Dienst seine Initialisierung abgeschlossen hat und bereit ist, mit dem Empfang von Steuerungsanforderungen zu beginnen, ruft der Dienst [**SetServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus) für den Berichts Dienst auf, der ausgeführt wird, \_ und gibt die Steuerungsanforderungen an, die der Dienst akzeptiert.</span><span class="sxs-lookup"><span data-stu-id="9bbb0-111">After the service completes its initialization and is ready to start receiving control requests, the service calls [**SetServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus) to report SERVICE\_RUNNING and specify the control requests the service is prepared to accept.</span></span> <span data-ttu-id="9bbb0-112">Der Übergang vom Dienst \_ Start \_ Pending to Service \_ Running zeigt den SCM-und Dienst Überwachungstools an, dass der Dienst erfolgreich gestartet wurde.</span><span class="sxs-lookup"><span data-stu-id="9bbb0-112">The transition from SERVICE\_START\_PENDING to SERVICE\_RUNNING indicates to the SCM and service-monitoring tools that the service has started successfully.</span></span> <span data-ttu-id="9bbb0-113">Wenn der Dienst einen anderen Zustand als den Dienst meldet \_ , der ausgeführt wird, können die SCM-oder Dienst Überwachungstools den Dienst als fehlerhaft markieren.</span><span class="sxs-lookup"><span data-stu-id="9bbb0-113">If the service reports a state other than SERVICE\_RUNNING, the SCM or service-monitoring tools might mark the service as having failed to start.</span></span>

<span data-ttu-id="9bbb0-114">Der SCM sendet nur die angegebenen Steuerungsanforderungen an den Dienst (mit Ausnahme der \_ Anforderung der Dienststeuerungs- \_ Abfrage, die immer gesendet wird).</span><span class="sxs-lookup"><span data-stu-id="9bbb0-114">The SCM sends only the specified control requests to the service (except for the SERVICE\_CONTROL\_INTERROGATE request, which is always sent).</span></span> <span data-ttu-id="9bbb0-115">Eine Liste der Steuerungsanforderungen, die ein Dienst annehmen kann, finden Sie unter dem **dwcontrolsaccepted** -Member der [**Service \_ Status**](/windows/desktop/api/Winsvc/ns-winsvc-service_status) -Struktur.</span><span class="sxs-lookup"><span data-stu-id="9bbb0-115">For a list of the control requests that a service can accept, see the **dwControlsAccepted** member of the [**SERVICE\_STATUS**](/windows/desktop/api/Winsvc/ns-winsvc-service_status) structure.</span></span> <span data-ttu-id="9bbb0-116">Informationen zum Registrieren von für den Empfang von Geräte Ereignissen finden Sie in der [**registerdevicenotifi-**](/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa) Funktion.</span><span class="sxs-lookup"><span data-stu-id="9bbb0-116">For information about registering to receive device events, see the [**RegisterDeviceNotification**](/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa) function.</span></span>

<span data-ttu-id="9bbb0-117">Der Dienststatus ändert sich in der Regel aufgrund der Verarbeitung einer Steuerungs Anforderung.</span><span class="sxs-lookup"><span data-stu-id="9bbb0-117">The service state typically changes as a result of handling a control request.</span></span> <span data-ttu-id="9bbb0-118">Steuerungsanforderungen, die bewirken, dass der Dienststatus geändert \_ wird, umfassen das Anhalten der Dienst Kontrolle \_ , das Anhalten der Dienst \_ Kontrolle und die \_ Dienst \_ Steuerung \_ .</span><span class="sxs-lookup"><span data-stu-id="9bbb0-118">Control requests that cause the service state to change include SERVICE\_CONTROL\_STOP, SERVICE\_CONTROL\_PAUSE, and SERVICE\_CONTROL\_CONTINUE.</span></span> <span data-ttu-id="9bbb0-119">Wenn der Dienst lange Verarbeitung ausführen muss, um eine dieser Anforderungen zu verarbeiten, sollte ein sekundärer Thread erstellt werden, um die lange Verarbeitung auszuführen und den entsprechenden ausstehenden Status an den SCM zu melden.</span><span class="sxs-lookup"><span data-stu-id="9bbb0-119">If the service must do lengthy processing to handle any of these requests, it should create a secondary thread to perform the lengthy processing and report the corresponding pending state to the SCM.</span></span> <span data-ttu-id="9bbb0-120">(Um eine optimale Leistung bei Windows Vista und höheren Versionen von Windows zu erzielen, sollte der Dienst für diesen Zweck einen Arbeits Thread aus einem [Thread Pool](/windows/desktop/ProcThread/thread-pools) verwenden.) Der Dienst sollte dann den abgeschlossenen Zustandsübergang melden, wenn die lange Verarbeitung abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="9bbb0-120">(For best performance on Windows Vista and later versions of Windows, the service should use a worker thread from a [thread pool](/windows/desktop/ProcThread/thread-pools) for this purpose.) The service should then report the completed state transition when the lengthy processing is finished.</span></span> <span data-ttu-id="9bbb0-121">Weitere Informationen zum Verarbeiten von Steuerungsanforderungen finden Sie unter [Dienststeuerungs-Handlerfunktion](service-control-handler-function.md).</span><span class="sxs-lookup"><span data-stu-id="9bbb0-121">For more information about handling control requests, see [Service Control Handler Function](service-control-handler-function.md).</span></span>

<span data-ttu-id="9bbb0-122">Nur bestimmte Dienst Zustandsübergänge sind gültig.</span><span class="sxs-lookup"><span data-stu-id="9bbb0-122">Only certain service state transitions are valid.</span></span> <span data-ttu-id="9bbb0-123">Das folgende Diagramm zeigt die gültigen Übergänge.</span><span class="sxs-lookup"><span data-stu-id="9bbb0-123">The following diagram shows the valid transitions.</span></span>

![gültige Dienststatus Übergänge](images/service-status-transitions.png)

<span data-ttu-id="9bbb0-125">Der Dienststatus, der dem SCM gemeldet wird, bestimmt, wie der SCM mit dem Dienst interagiert.</span><span class="sxs-lookup"><span data-stu-id="9bbb0-125">The service state reported to the SCM determines how the SCM interacts with the service.</span></span> <span data-ttu-id="9bbb0-126">Wenn beispielsweise ein Dienst Berichte \_ \_ nicht mehr ausstehend ist, überträgt der SCM keine weiteren Steuerungsanforderungen an den Dienst, da dieser Zustand angibt, dass der Dienst heruntergefahren wird.</span><span class="sxs-lookup"><span data-stu-id="9bbb0-126">For example, if a service reports SERVICE\_STOP\_PENDING, the SCM does not transmit further control requests to the service because this state indicates that the service is shutting down.</span></span> <span data-ttu-id="9bbb0-127">Der nächste vom Dienst gemeldete Status sollte vom Dienst \_ beendet werden, da dies der einzige gültige Status ist, nachdem der Dienst \_ beendet wurde \_ .</span><span class="sxs-lookup"><span data-stu-id="9bbb0-127">The next state reported by the service should be SERVICE\_STOPPED because that is the only valid state after SERVICE\_STOP\_PENDING.</span></span> <span data-ttu-id="9bbb0-128">Wenn ein Dienst jedoch einen Übergang meldet, der nicht gültig ist, kann der SCM den-Befehl nicht ausführen.</span><span class="sxs-lookup"><span data-stu-id="9bbb0-128">However, if a service reports a transition that is not valid, the SCM does not fail the call.</span></span>

<span data-ttu-id="9bbb0-129">Im folgenden Diagramm werden Dienst Zustandsübergänge ausführlicher dargestellt, einschließlich der Steuerungsanforderungen, die von einem Dienst Steuerungsprogramm (dem Dienst Client) initiiert werden, und den [**SetServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus) -aufrufen, die ein Dienst zum Melden von Zustandsänderungen an den SCM vornimmt.</span><span class="sxs-lookup"><span data-stu-id="9bbb0-129">The following diagram shows service state transitions in more detail, including the control requests initiated by a service control program (the service client) and the [**SetServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus) calls that a service makes to report state changes to the SCM.</span></span> <span data-ttu-id="9bbb0-130">Wie bereits erwähnt, sendet der SCM nur Steuerungsanforderungen, die der Dienst angegeben hat, damit ein Dienst möglicherweise nicht alle im Diagramm angezeigten Anforderungen empfängt.</span><span class="sxs-lookup"><span data-stu-id="9bbb0-130">As mentioned earlier, the SCM sends only control requests that the service has specified it will accept, so a service might not receive all of the requests shown in the diagram.</span></span>

![<span data-ttu-id="9bbb0-131">Dienststatus Übergänge im Detail</span><span class="sxs-lookup"><span data-stu-id="9bbb0-131">service status transitions in detail</span></span> ](images/service-status-flow-diagram.png)

## <a name="related-topics"></a><span data-ttu-id="9bbb0-132">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="9bbb0-132">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="9bbb0-133">**ControlService**</span><span class="sxs-lookup"><span data-stu-id="9bbb0-133">**ControlService**</span></span>](/windows/desktop/api/Winsvc/nf-winsvc-controlservice)
</dt> <dt>

[<span data-ttu-id="9bbb0-134">**Controlserviceex**</span><span class="sxs-lookup"><span data-stu-id="9bbb0-134">**ControlServiceEx**</span></span>](/windows/desktop/api/Winsvc/nf-winsvc-controlserviceexa)
</dt> <dt>

[<span data-ttu-id="9bbb0-135">**SetServiceStatus**</span><span class="sxs-lookup"><span data-stu-id="9bbb0-135">**SetServiceStatus**</span></span>](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus)
</dt> </dl>

 

 
