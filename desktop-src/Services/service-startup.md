---
description: Zum Starten eines Dienst-oder Treiber Dienstanbieter verwendet das Dienst Steuerungsprogramm die Start Service-Funktion.
ms.assetid: 7d2ee779-1554-436a-a65c-f0322745f46a
title: Dienststart
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0f5fcd9ee820357e75bf07649da8e6c5445d3f42
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "106369807"
---
# <a name="service-startup"></a><span data-ttu-id="522c8-103">Dienststart</span><span class="sxs-lookup"><span data-stu-id="522c8-103">Service Startup</span></span>

<span data-ttu-id="522c8-104">Zum Starten eines Dienst-oder Treiber Dienstanbieter verwendet das Dienst Steuerungsprogramm die [**Start Service**](/windows/desktop/api/Winsvc/nf-winsvc-startservicea) -Funktion.</span><span class="sxs-lookup"><span data-stu-id="522c8-104">To start a service or driver service, the service control program uses the [**StartService**](/windows/desktop/api/Winsvc/nf-winsvc-startservicea) function.</span></span> <span data-ttu-id="522c8-105">Die Funktion " **StartService** " schlägt fehl, wenn die Datenbank gesperrt ist.</span><span class="sxs-lookup"><span data-stu-id="522c8-105">The **StartService** function fails if the database is locked.</span></span> <span data-ttu-id="522c8-106">Wenn dies auftritt, sollte das Dienst Steuerungsprogramm einige Sekunden warten und " **StartService** " erneut aufrufen.</span><span class="sxs-lookup"><span data-stu-id="522c8-106">If this occurs, the service control program should wait a few seconds and call **StartService** again.</span></span> <span data-ttu-id="522c8-107">Der aktuelle Sperr Status der Datenbank kann durch Aufrufen der [**queryservicelockstatus**](/windows/desktop/api/Winsvc/nf-winsvc-queryservicelockstatusa) -Funktion überprüft werden.</span><span class="sxs-lookup"><span data-stu-id="522c8-107">It can check the current lock status of the database by calling the [**QueryServiceLockStatus**](/windows/desktop/api/Winsvc/nf-winsvc-queryservicelockstatusa) function.</span></span>

<span data-ttu-id="522c8-108">Wenn das Dienst Steuerungsprogramm einen Dienst startet, kann es die [**Start Service**](/windows/desktop/api/Winsvc/nf-winsvc-startservicea) -Funktion verwenden, um ein Array von Argumenten anzugeben, die an die [**ServiceMain**](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) -Funktion des dienstanders übermittelt werden sollen.</span><span class="sxs-lookup"><span data-stu-id="522c8-108">If the service control program is starting a service, it can use the [**StartService**](/windows/desktop/api/Winsvc/nf-winsvc-startservicea) function to specify an array of arguments to be passed to the service's [**ServiceMain**](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) function.</span></span> <span data-ttu-id="522c8-109">Die **Start Service** -Funktion gibt zurück, nachdem ein neuer Thread erstellt wurde, um die **ServiceMain** -Funktion auszuführen.</span><span class="sxs-lookup"><span data-stu-id="522c8-109">The **StartService** function returns after a new thread is created to execute the **ServiceMain** function.</span></span> <span data-ttu-id="522c8-110">Das Dienst Steuerungsprogramm kann den Status des neu gestarteten dienstangangs in einer [**Dienst \_ Status**](/windows/desktop/api/Winsvc/ns-winsvc-service_status) Struktur abrufen, indem er die [**QueryServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-queryservicestatus) -Funktion aufrufen.</span><span class="sxs-lookup"><span data-stu-id="522c8-110">The service control program can retrieve the status of the newly started service in a [**SERVICE\_STATUS**](/windows/desktop/api/Winsvc/ns-winsvc-service_status) structure by calling the [**QueryServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-queryservicestatus) function.</span></span> <span data-ttu-id="522c8-111">Während der Initialisierung sollte der **dwcurrentstate** -Member "Service \_ Start Pending" lauten \_ .</span><span class="sxs-lookup"><span data-stu-id="522c8-111">During initialization, the **dwCurrentState** member should be SERVICE\_START\_PENDING.</span></span> <span data-ttu-id="522c8-112">Beim **dwwaithint** -Element handelt es sich um ein Zeitintervall (in Millisekunden), das angibt, wie lange das Dienst Steuerungsprogramm warten soll, bis der **QueryServiceStatus** erneut aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="522c8-112">The **dwWaitHint** member is a time interval, in milliseconds, that indicates how long the service control program should wait before calling **QueryServiceStatus** again.</span></span> <span data-ttu-id="522c8-113">Wenn die Initialisierung vollständig ist, ändert der Dienst **dwcurrentstate** in den Dienst, der \_ ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="522c8-113">When the initialization is complete, the service changes **dwCurrentState** to SERVICE\_RUNNING.</span></span>

<span data-ttu-id="522c8-114">Der Dienststeuerungs-Manager unterstützt das Übergeben von benutzerdefinierten Umgebungsvariablen an einen Dienst beim Start nicht.</span><span class="sxs-lookup"><span data-stu-id="522c8-114">The service control manager does not support passing custom environment variables to a service at startup.</span></span> <span data-ttu-id="522c8-115">Der Dienststeuerungs-Manager erkennt und übergibt auch keine Änderungen an Umgebungsvariablen, während der Dienst ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="522c8-115">Also, the service control manager does not detect and pass on changes to environment variables as the service is running.</span></span> <span data-ttu-id="522c8-116">Anstatt einen Dienst von einer Umgebungsvariablen abhängig zu gestalten, verwenden Sie Registrierungs Werte oder [**ServiceMain**](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) -Argumente.</span><span class="sxs-lookup"><span data-stu-id="522c8-116">Instead of making a service dependent on an environment variable, use registry values or [**ServiceMain**](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) arguments.</span></span>

<span data-ttu-id="522c8-117">Im folgenden finden Sie eine vereinfachte Übersicht darüber, was geschieht, wenn ein typischer Dienst vom Dienststeuerungs-Manager gestartet wird:</span><span class="sxs-lookup"><span data-stu-id="522c8-117">The following is a simplified overview of what happens when a typical service is started by the service control manager:</span></span>

-   <span data-ttu-id="522c8-118">Der SCM liest den Dienst Pfad aus der Registrierung und bereitet den Start des Dienstanbieter vor.</span><span class="sxs-lookup"><span data-stu-id="522c8-118">The SCM reads the service path from the registry and prepares to start the service.</span></span> <span data-ttu-id="522c8-119">Dies schließt das Abrufen der Dienst Sperre ein.</span><span class="sxs-lookup"><span data-stu-id="522c8-119">This includes acquiring the service lock.</span></span> <span data-ttu-id="522c8-120">Jeder Versuch, einen anderen Dienst zu starten, während die Dienst Sperre aufrechterhalten wird, wird blockiert, bis die Dienst Sperre aufgehoben wird.</span><span class="sxs-lookup"><span data-stu-id="522c8-120">Any attempt to start another service while the service lock is held will block until the service lock is released.</span></span>
-   <span data-ttu-id="522c8-121">Der SCM startet den Prozess und wartet, bis der untergeordnete Prozess beendet wird (was auf einen Fehler hinweist) oder meldet, dass der Dienst \_ ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="522c8-121">The SCM starts the process and waits until either the child process exits (indicating a failure) or reports the SERVICE\_RUNNING status.</span></span>
-   <span data-ttu-id="522c8-122">Die Anwendung führt die sehr einfache Initialisierung durch und ruft die [**StartServiceCtrlDispatcher**](/windows/desktop/api/Winsvc/nf-winsvc-startservicectrldispatchera) -Funktion auf.</span><span class="sxs-lookup"><span data-stu-id="522c8-122">The application performs its very simple initialization and calls the [**StartServiceCtrlDispatcher**](/windows/desktop/api/Winsvc/nf-winsvc-startservicectrldispatchera) function.</span></span>
-   <span data-ttu-id="522c8-123">[**StartServiceCtrlDispatcher**](/windows/desktop/api/Winsvc/nf-winsvc-startservicectrldispatchera) stellt eine Verbindung mit dem Dienststeuerungs-Manager her und startet einen zweiten Thread, der die [**ServiceMain**](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) -Funktion für den Dienst aufruft.</span><span class="sxs-lookup"><span data-stu-id="522c8-123">[**StartServiceCtrlDispatcher**](/windows/desktop/api/Winsvc/nf-winsvc-startservicectrldispatchera) connects to the service control manager and starts a second thread that calls the [**ServiceMain**](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) function for the service.</span></span> <span data-ttu-id="522c8-124">**ServiceMain** sollte melden, dass der Dienst \_ so schnell wie möglich ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="522c8-124">**ServiceMain** should report SERVICE\_RUNNING as soon as possible.</span></span>
-   <span data-ttu-id="522c8-125">Wenn der Dienststeuerungs-Manager benachrichtigt wird, dass der Dienst ausgeführt wird, wird die Dienst Sperre freigegeben.</span><span class="sxs-lookup"><span data-stu-id="522c8-125">When the service control manager is notified that the service is running, it releases the service lock.</span></span>

<span data-ttu-id="522c8-126">Wenn der Dienst seinen Status nicht innerhalb von 80 Sekunden aktualisiert, zuzüglich des letzten warte Hinweises, stellt der Dienststeuerungs-Manager fest, dass der Dienst nicht mehr reagiert.</span><span class="sxs-lookup"><span data-stu-id="522c8-126">If service does not update its status within 80 seconds, plus the last wait hint, the service control manager determines that the service has stopped responding.</span></span> <span data-ttu-id="522c8-127">Der Dienststeuerungs-Manager protokolliert ein Ereignis und beendet den Dienst.</span><span class="sxs-lookup"><span data-stu-id="522c8-127">The service control manager will log an event and stop the service.</span></span>

<span data-ttu-id="522c8-128">Wenn das Programm einen Treiber Dienst startet, wird " [**StartService**](/windows/desktop/api/Winsvc/nf-winsvc-startservicea) " zurückgegeben, nachdem die Initialisierung des Gerätetreibers abgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="522c8-128">If the program is starting a driver service, [**StartService**](/windows/desktop/api/Winsvc/nf-winsvc-startservicea) returns after the device driver has completed its initialization.</span></span>

<span data-ttu-id="522c8-129">Weitere Informationen finden Sie unter [Starten eines Dienstanbieter](starting-a-service.md).</span><span class="sxs-lookup"><span data-stu-id="522c8-129">For more information, see [Starting a Service](starting-a-service.md).</span></span>

 

 
