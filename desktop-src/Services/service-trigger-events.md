---
description: Ein Dienst kann sich registrieren, um gestartet oder angehalten zu werden, wenn ein Auslöserereignis auftritt.
ms.assetid: ca02a3ae-b16a-4427-b6db-b935c9cf23b3
title: Dienst Triggerereignisse
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fdefd94b7896936f7ab4fc014647b08470611573
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "106360807"
---
# <a name="service-trigger-events"></a><span data-ttu-id="7562c-103">Dienst Triggerereignisse</span><span class="sxs-lookup"><span data-stu-id="7562c-103">Service Trigger Events</span></span>

<span data-ttu-id="7562c-104">Ein Dienst kann sich registrieren, um gestartet oder angehalten zu werden, wenn ein Auslöserereignis auftritt.</span><span class="sxs-lookup"><span data-stu-id="7562c-104">A service can register to be started or stopped when a trigger event occurs.</span></span> <span data-ttu-id="7562c-105">Dadurch entfällt die Notwendigkeit, Dienste zu starten, wenn das System gestartet wird, oder Dienste, die auf ein Ereignis warten oder es aktiv warten. ein Dienst kann bei Bedarf gestartet werden, anstatt automatisch zu starten, ob eine Arbeit durchzuführen ist.</span><span class="sxs-lookup"><span data-stu-id="7562c-105">This eliminates the need for services to start when the system starts, or for services to poll or actively wait for an event; a service can start when it is needed, instead of starting automatically whether or not there is work to do.</span></span> <span data-ttu-id="7562c-106">Beispiele für vordefinierte Triggerereignisse sind die Ankunft eines Geräts einer angegebenen Geräteschnittstellen Klasse oder die Verfügbarkeit eines bestimmten Firewallports.</span><span class="sxs-lookup"><span data-stu-id="7562c-106">Examples of predefined trigger events include arrival of a device of a specified device interface class or availability of a particular firewall port.</span></span> <span data-ttu-id="7562c-107">Ein Dienst kann sich auch für ein benutzerdefiniertes Ereignis registrieren, das von einem ETW-Anbieter ( [Ereignis Ablauf Verfolgung für Windows](../etw/event-tracing-portal.md) ) generiert wurde.</span><span class="sxs-lookup"><span data-stu-id="7562c-107">A service can also register for a custom trigger event generated by an [Event Tracing for Windows](../etw/event-tracing-portal.md) (ETW) provider.</span></span>

<span data-ttu-id="7562c-108">**Windows Server 2008, Windows Vista, Windows Server 2003 und Windows XP:** Dienst Triggerereignisse werden erst ab Windows Server 2008 R2 und Windows 7 unterstützt.</span><span class="sxs-lookup"><span data-stu-id="7562c-108">**Windows Server 2008, Windows Vista, Windows Server 2003 and Windows XP:** Service trigger events are not supported until Windows Server 2008 R2 and Windows 7.</span></span>

<span data-ttu-id="7562c-109">Ein-Triggern besteht aus einem triggerereignistyp, einem triggerereignisuntertyp, der Aktion, die als Reaktion auf das Triggerereignis ausgeführt werden soll, und (bei bestimmten triggerereignistypen) einem oder mehreren triggerspezifischen Datenelementen.</span><span class="sxs-lookup"><span data-stu-id="7562c-109">A trigger consists of a trigger event type, a trigger event subtype, the action to be taken in response to the trigger event, and (for certain trigger event types) one or more trigger-specific data items.</span></span> <span data-ttu-id="7562c-110">Der Untertyp und die triggerspezifischen Datenelemente geben zusammen die Bedingungen an, mit denen der Dienst des Ereignisses benachrichtigt wird.</span><span class="sxs-lookup"><span data-stu-id="7562c-110">The subtype and the trigger-specific data items together specify the conditions for notifying the service of the event.</span></span> <span data-ttu-id="7562c-111">Das Format eines Datenelements hängt vom Typ des auslöserereignisses ab. ein Datenelement kann Binärdaten, eine Zeichenfolge oder eine mehrteilige Zeichenfolge sein.</span><span class="sxs-lookup"><span data-stu-id="7562c-111">The format of a data item depends on the trigger event type; a data item can be binary data, a string, or a multistring.</span></span> <span data-ttu-id="7562c-112">Zeichen folgen müssen Unicode sein. ANSI-Zeichen folgen werden nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="7562c-112">Strings must be Unicode; ANSI strings are not supported.</span></span>

<span data-ttu-id="7562c-113">Um für Triggerereignisse zu registrieren, ruft der Dienst [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) mit **Service \_ config- \_ \_ Triggerinformationen** auf und stellt eine dienstinganformationen- [**\_ \_ Informations**](/windows/desktop/api/winsvc/ns-winsvc-service_trigger_info) Struktur bereit.</span><span class="sxs-lookup"><span data-stu-id="7562c-113">To register for trigger events, the service calls [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) with **SERVICE\_CONFIG\_TRIGGER\_INFO** and supplies a [**SERVICE\_TRIGGER\_INFO**](/windows/desktop/api/winsvc/ns-winsvc-service_trigger_info) structure.</span></span> <span data-ttu-id="7562c-114">Die **Dienst \_ - \_ auslöserinfo** -Struktur verweist auf ein Array von [**Dienst- \_ auslöserstrukturen**](/windows/desktop/api/winsvc/ns-winsvc-service_trigger) , die jeweils einen-Parameter angeben</span><span class="sxs-lookup"><span data-stu-id="7562c-114">The **SERVICE\_TRIGGER\_INFO** structure points to an array of [**SERVICE\_TRIGGER**](/windows/desktop/api/winsvc/ns-winsvc-service_trigger) structures, each specifying one trigger.</span></span>

<span data-ttu-id="7562c-115">Die angegebene Triggeraktion wird ausgeführt, wenn die Auslöserbedingung beim Starten des Systems true ist, oder wenn die Triggerbedingung bei Ausführung des Systems true wird.</span><span class="sxs-lookup"><span data-stu-id="7562c-115">The specified trigger action is taken if the trigger condition is true when the system starts, or if the trigger condition becomes true while the system is running.</span></span> <span data-ttu-id="7562c-116">Wenn z. b. ein Dienst registriert wird, wenn ein bestimmtes Gerät verfügbar ist, wird der Dienst gestartet, wenn das System gestartet wird, wenn das Gerät bereits an den Computer angeschlossen ist. der Dienst wird gestartet, wenn das Gerät eintrifft, wenn der Benutzer das Gerät in den Betrieb einfügt, während das System ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="7562c-116">For example, if a service registers to be started when a particular device is available, the service is started when the system starts if the device is already plugged in to the computer; the service is started when the device arrives if the user plugs in the device while the system is running.</span></span>

<span data-ttu-id="7562c-117">Wenn ein triggerspezifische Datenelemente enthält, wird die Triggeraktion nur dann durchgeführt, wenn das Datenelement, das das Triggerereignis begleitet, mit einem der Datenelemente übereinstimmt, die der Dienst mit dem-Triggerwert angegeben hat.</span><span class="sxs-lookup"><span data-stu-id="7562c-117">If a trigger has trigger-specific data items, the trigger action is taken only if the data item that accompanies the trigger event matches one of the data items that the service specified with the trigger.</span></span> <span data-ttu-id="7562c-118">Der binäre Datenabgleich erfolgt durch einen bitweisen Vergleich.</span><span class="sxs-lookup"><span data-stu-id="7562c-118">Binary data matching is done by bitwise comparison.</span></span> <span data-ttu-id="7562c-119">Beim Zeichen folgen Vergleich wird die Groß-/Kleinschreibung beachtet</span><span class="sxs-lookup"><span data-stu-id="7562c-119">String matching is case-insensitive.</span></span> <span data-ttu-id="7562c-120">Wenn das Datenelement eine mehrteilige Zeichenfolge ist, müssen alle Zeichen folgen in der mehrteiligen Zeichenfolge entsprechen.</span><span class="sxs-lookup"><span data-stu-id="7562c-120">If the data item is a multistring, all strings in the multistring must match.</span></span>

<span data-ttu-id="7562c-121">Wenn ein Dienst als Antwort auf ein Triggerereignis gestartet wird, empfängt der Dienst das **Dienst \_ Trigger- \_ \_ Argument Started** als *argv* \[ 1 \] in seiner [*ServiceMain*](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) -Rückruffunktion.</span><span class="sxs-lookup"><span data-stu-id="7562c-121">When a service is started in response to a trigger event, the service receives **SERVICE\_TRIGGER\_STARTED\_ARGUMENT** as *argv*\[1\] in its [*ServiceMain*](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) callback function.</span></span> <span data-ttu-id="7562c-122">*Argv* \[ 0 \] ist immer der Kurzname des Dienstanbieter.</span><span class="sxs-lookup"><span data-stu-id="7562c-122">*Argv*\[0\] is always the short name of the service.</span></span>

<span data-ttu-id="7562c-123">Ein Dienst, der als Antwort auf ein auslösereignis registriert wird, wird möglicherweise nach einem Leerlauf Timeout angehalten, wenn der Dienst nicht ausgeführt werden kann.</span><span class="sxs-lookup"><span data-stu-id="7562c-123">A service that registers to be started in response to a trigger event might stop itself after an idle time-out when the service has no work to do.</span></span> <span data-ttu-id="7562c-124">Ein Dienst, der sich selbst beendet, muss darauf vorbereitet sein, **Service \_ Control- \_ triggerEvent** -Steuerungsanforderungen zu verarbeiten, die ankommen, während der Dienst sich selbst beendet.</span><span class="sxs-lookup"><span data-stu-id="7562c-124">A service that stops itself must be prepared to handle **SERVICE\_CONTROL\_TRIGGEREVENT** control requests that arrive while the service is stopping itself.</span></span> <span data-ttu-id="7562c-125">Der SCM sendet bei jedem Auftreten eines neuen triggerereignisses, wenn der Dienst ausgeführt wird, eine Dienst Steuerungs Anforderung für das **\_ \_ triggerEvent** -Steuerelement.</span><span class="sxs-lookup"><span data-stu-id="7562c-125">The SCM sends a **SERVICE\_CONTROL\_TRIGGEREVENT** control request whenever a new trigger event occurs while the service is in the running state.</span></span> <span data-ttu-id="7562c-126">Um den Verlust von Triggerereignissen zu vermeiden, sollte der Dienst das Herunterfahren des Fehlers für jede **\_ Dienststeuerungs- \_ triggerEvent** -Steuerungs Anforderung zurückgeben, die eingeht, während der Dienst von der Ausführung zu "beendet" übergeht. **\_ \_ \_**</span><span class="sxs-lookup"><span data-stu-id="7562c-126">To avoid losing trigger events, the service should return **ERROR\_SHUTDOWN\_IN\_PROGRESS** for any **SERVICE\_CONTROL\_TRIGGEREVENT** control request that arrives while the service is transitioning from running to stopped.</span></span> <span data-ttu-id="7562c-127">Dadurch wird der SCM angewiesen, Triggerereignisse in die Warteschlange zu stellen und zu warten, bis der Dienst beendet wird.</span><span class="sxs-lookup"><span data-stu-id="7562c-127">This instructs the SCM to queue trigger events and wait for the service to enter the stopped state.</span></span> <span data-ttu-id="7562c-128">Der SCM führt dann die Aktion aus, die dem Ereignis in der Warteschlange zugeordnet ist, beispielsweise das Starten des Dienstanbieter.</span><span class="sxs-lookup"><span data-stu-id="7562c-128">The SCM then takes the action associated with the queued trigger event, such as starting the service.</span></span>

<span data-ttu-id="7562c-129">Wenn der Dienst für die erneute Verarbeitung von Triggerereignissen bereit ist, wird das **Dienst \_ Accept- \_ triggerEvent** in der vom Steuerelement akzeptierten Maske in einem Aufrufen von [**SetServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus)festgelegt.</span><span class="sxs-lookup"><span data-stu-id="7562c-129">When the service is ready to handle trigger events again, it sets **SERVICE\_ACCEPT\_TRIGGEREVENT** in its controls-accepted mask in a call to [**SetServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus).</span></span> <span data-ttu-id="7562c-130">Dies erfolgt in der Regel, wenn der Dienst **SetServiceStatus** aufruft, während der **Dienst \_ ausgeführt** wird.</span><span class="sxs-lookup"><span data-stu-id="7562c-130">This is usually done when the service calls **SetServiceStatus** with **SERVICE\_RUNNING**.</span></span> <span data-ttu-id="7562c-131">Der SCM gibt dann eine **Dienst \_ Steuerungs \_ triggerEvent** -Anforderung für jedes Trigger-Ereignis in der Warteschlange aus, bis die Warteschlange leer ist.</span><span class="sxs-lookup"><span data-stu-id="7562c-131">The SCM then issues a **SERVICE\_CONTROL\_TRIGGEREVENT** request for each queued trigger event until the queue is empty.</span></span>

<span data-ttu-id="7562c-132">Ein Dienst, für den abhängige Dienste ausgeführt werden, kann nicht als Antwort auf ein Auslöserereignis beendet werden.</span><span class="sxs-lookup"><span data-stu-id="7562c-132">A service that has dependent services running cannot be stopped in response to a trigger event.</span></span>

<span data-ttu-id="7562c-133">Auslösende-und triggeranhalte-Anforderungen sind unter wenig Arbeitsspeicher nicht garantiert.</span><span class="sxs-lookup"><span data-stu-id="7562c-133">Trigger-start and trigger-stop requests are not guaranteed under low memory conditions.</span></span>

<span data-ttu-id="7562c-134">Verwenden Sie die [**QueryServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-queryserviceconfig2a) -Funktion, um die triggerereigniskonfiguration eines dienstangs abzurufen</span><span class="sxs-lookup"><span data-stu-id="7562c-134">Use the [**QueryServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-queryserviceconfig2a) function to retrieve a service’s trigger event configuration.</span></span>

<span data-ttu-id="7562c-135">Das SC-Tool (sc.exe) kann verwendet werden, um die Triggerereignisse eines Dienstanbieter an der Eingabeaufforderung zu konfigurieren oder abzufragen.</span><span class="sxs-lookup"><span data-stu-id="7562c-135">The SC tool (sc.exe) can be used to configure or query a service’s trigger events at the command prompt.</span></span> <span data-ttu-id="7562c-136">Verwenden Sie die Option **TriggerInfo** , um einen Dienst so zu konfigurieren, dass er als Reaktion auf ein Triggerereignis gestartet oder beendet wird.</span><span class="sxs-lookup"><span data-stu-id="7562c-136">Use the **triggerinfo** option to configure a service to start or stop in response to a trigger event.</span></span> <span data-ttu-id="7562c-137">Verwenden Sie die Option **qtriggerinfo, um die triggerkonfiguration** eines Dienstanbieter abzufragen.</span><span class="sxs-lookup"><span data-stu-id="7562c-137">Use the **qtriggerinfo** option to query the trigger configuration of a service.</span></span>

<span data-ttu-id="7562c-138">Im folgenden Beispiel wird die auslöserkonfiguration des W32Time-Dienstanbieter abgefragt, die so konfiguriert ist, dass gestartet wird, wenn der Computer einer Domäne hinzugefügt wird.</span><span class="sxs-lookup"><span data-stu-id="7562c-138">The following example queries the trigger configuration of the W32time service, which is configured to start when the computer is joined to a domain and stop when the computer leaves the domain.</span></span>

``` syntax
C:\>sc qtriggerinfo w32time
[SC] QueryServiceConfig2 SUCCESS

SERVICE_NAME: w32time

        START SERVICE
          DOMAIN JOINED STATUS         : 1ce20aba-9851-4421-9430-1ddeb766e809 [DOMAIN JOINED]
        STOP SERVICE
          DOMAIN JOINED STATUS         : ddaf516e-58c2-4866-9574-c3b615d42ea1 [NOT DOMAIN JOINED]
```

<span data-ttu-id="7562c-139">Im folgenden Beispiel wird die auslöserkonfiguration des Tablet Input-diensdienstanbieter abgefragt, die für den Start konfiguriert ist, wenn ein HID-Gerät mit der **GUID** {4d1e55b2-f16f-11CF-88cb-001111000030} und einer der angegebenen versteckten Geräte-IDs eintreffen.</span><span class="sxs-lookup"><span data-stu-id="7562c-139">The following example queries the trigger configuration of the tablet input service, which is configured to start when a HID device with the **GUID** {4d1e55b2-f16f-11cf-88cb-001111000030} and any of the specified HID device IDs arrives.</span></span>

``` syntax
C:\>sc qtriggerinfo tabletinputservice
[SC] QueryServiceConfig2 SUCCESS

SERVICE_NAME: tabletinputservice

        START SERVICE
          DEVICE INTERFACE ARRIVAL     : 4d1e55b2-f16f-11cf-88cb-001111000030 [INTERFACE CLASS GUID]
            DATA                       : HID_DEVICE_UP:000D_U:0001
            DATA                       : HID_DEVICE_UP:000D_U:0002
            DATA                       : HID_DEVICE_UP:000D_U:0003
            DATA                       : HID_DEVICE_UP:000D_U:0004
```

 

 
