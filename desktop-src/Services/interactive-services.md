---
description: In der Regel sind Dienste Konsolen Anwendungen, die ohne grafische Benutzeroberfläche (GUI) unbeaufsichtigt ausgeführt werden sollen.
ms.assetid: 3d6e090a-00b1-47d8-a4fb-620f3db8ba9c
title: Interaktive Dienste
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 57dda3018b4b37e8c5ee56d67cd1db2c56da9b67
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "103867611"
---
# <a name="interactive-services"></a><span data-ttu-id="90d33-103">Interaktive Dienste</span><span class="sxs-lookup"><span data-stu-id="90d33-103">Interactive Services</span></span>

<span data-ttu-id="90d33-104">In der Regel sind Dienste Konsolen Anwendungen, die ohne grafische Benutzeroberfläche (GUI) unbeaufsichtigt ausgeführt werden sollen.</span><span class="sxs-lookup"><span data-stu-id="90d33-104">Typically, services are console applications that are designed to run unattended without a graphical user interface (GUI).</span></span> <span data-ttu-id="90d33-105">Einige Dienste erfordern jedoch möglicherweise gelegentliche Interaktionen mit einem Benutzer.</span><span class="sxs-lookup"><span data-stu-id="90d33-105">However, some services may require occasional interaction with a user.</span></span> <span data-ttu-id="90d33-106">Auf dieser Seite werden die besten Möglichkeiten zur Interaktion mit dem Benutzer von einem Dienst erläutert.</span><span class="sxs-lookup"><span data-stu-id="90d33-106">This page discusses the best ways to interact with the user from a service.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="90d33-107">Dienste können nicht direkt mit einem Benutzer in Windows Vista interagieren.</span><span class="sxs-lookup"><span data-stu-id="90d33-107">Services cannot directly interact with a user as of Windows Vista.</span></span> <span data-ttu-id="90d33-108">Daher sollten die im Abschnitt mit einem interaktiven Dienst erwähnten Verfahren nicht in neuem Code verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="90d33-108">Therefore, the techniques mentioned in the section titled Using an Interactive Service should not be used in new code.</span></span>

 

## <a name="interacting-with-a-user-from-a-service-indirectly"></a><span data-ttu-id="90d33-109">Indirekte Interaktion mit einem Benutzer von einem Dienst</span><span class="sxs-lookup"><span data-stu-id="90d33-109">Interacting with a User from a Service Indirectly</span></span>

<span data-ttu-id="90d33-110">Sie können die folgenden Verfahren verwenden, um mit dem Benutzer von einem Dienst auf allen unterstützten Versionen von Windows zu interagieren:</span><span class="sxs-lookup"><span data-stu-id="90d33-110">You can use the following techniques to interact with the user from a service on all supported versions of Windows:</span></span>

-   <span data-ttu-id="90d33-111">Zeigt ein Dialogfeld in der Benutzersitzung mithilfe der [**wtssendmessage**](/windows/desktop/api/wtsapi32/nf-wtsapi32-wtssendmessagea) -Funktion an.</span><span class="sxs-lookup"><span data-stu-id="90d33-111">Display a dialog box in the user's session using the [**WTSSendMessage**](/windows/desktop/api/wtsapi32/nf-wtsapi32-wtssendmessagea) function.</span></span>
-   <span data-ttu-id="90d33-112">Erstellen Sie eine separate ausgeblendete GUI-Anwendung, und verwenden Sie die Funktion "Funktion", [**um die Anwendung**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) im Kontext des interaktiven Benutzers auszuführen.</span><span class="sxs-lookup"><span data-stu-id="90d33-112">Create a separate hidden GUI application and use the [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) function to run the application within the context of the interactive user.</span></span> <span data-ttu-id="90d33-113">Entwerfen Sie die GUI-Anwendung für die Kommunikation mit dem Dienst über eine Methode der prozessübergreifenden Kommunikation (prozessübergreifende Communication, IPC), z. b. Named Pipes.</span><span class="sxs-lookup"><span data-stu-id="90d33-113">Design the GUI application to communicate with the service through some method of interprocess communication (IPC), for example, named pipes.</span></span> <span data-ttu-id="90d33-114">Der Dienst kommuniziert mit der GUI-Anwendung, um ihm mitzuteilen, wann die GUI angezeigt werden soll.</span><span class="sxs-lookup"><span data-stu-id="90d33-114">The service communicates with the GUI application to tell it when to display the GUI.</span></span> <span data-ttu-id="90d33-115">Die Anwendung kommuniziert die Ergebnisse der Benutzerinteraktion zurück an den Dienst, sodass der Dienst die geeignete Aktion ausführen kann.</span><span class="sxs-lookup"><span data-stu-id="90d33-115">The application communicates the results of the user interaction back to the service so that the service can take the appropriate action.</span></span> <span data-ttu-id="90d33-116">Beachten Sie, dass IPC Ihre Dienst Schnittstellen über das Netzwerk verfügbar machen kann, es sei denn, Sie verwenden eine geeignete Zugriffs Steuerungs Liste (ACL).</span><span class="sxs-lookup"><span data-stu-id="90d33-116">Note that IPC can expose your service interfaces over the network unless you use an appropriate access control list (ACL).</span></span>

    <span data-ttu-id="90d33-117">Wenn dieser Dienst auf einem System mit mehreren Benutzern ausgeführt wird, fügen Sie die Anwendung dem folgenden Schlüssel hinzu, damit Sie in jeder Sitzung ausgeführt wird: **HKEY \_ local \_ Machine \\ Software \\ Microsoft \\ Windows \\ CurrentVersion \\ Run**.</span><span class="sxs-lookup"><span data-stu-id="90d33-117">If this service runs on a multiuser system, add the application to the following key so that it is run in each session: **HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run**.</span></span> <span data-ttu-id="90d33-118">Wenn die Anwendung Named Pipes für IPC verwendet, kann der Server zwischen mehreren Benutzer Prozessen unterscheiden, indem jeder Pipe basierend auf der Sitzungs-ID ein eindeutiger Name übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="90d33-118">If the application uses named pipes for IPC, the server can distinguish between multiple user processes by giving each pipe a unique name based on the session ID.</span></span>

<span data-ttu-id="90d33-119">Die folgende Technik ist auch für Windows Server 2003 und Windows XP verfügbar:</span><span class="sxs-lookup"><span data-stu-id="90d33-119">The following technique is also available for Windows Server 2003 and Windows XP:</span></span>

-   <span data-ttu-id="90d33-120">Zeigen Sie ein Meldungs Feld an, indem Sie die [**MessageBox**](/windows/win32/api/winuser/nf-winuser-messagebox) -Funktion mit **MB \_ Dienst \_ Benachrichtigung** aufrufen.</span><span class="sxs-lookup"><span data-stu-id="90d33-120">Display a message box by calling the [**MessageBox**](/windows/win32/api/winuser/nf-winuser-messagebox) function with **MB\_SERVICE\_NOTIFICATION**.</span></span> <span data-ttu-id="90d33-121">Dies wird empfohlen, um einfache Statusmeldungen anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="90d33-121">This is recommended for displaying simple status messages.</span></span> <span data-ttu-id="90d33-122">Sie können **MessageBox** während der Dienst Initialisierung oder der [**handlerex**](/windows/desktop/api/WinSvc/nc-winsvc-lphandler_function_ex) -Routine nicht aufrufen, es sei denn, Sie nennen Sie von einem separaten Thread aus, sodass Sie schnell zum SCM zurückkehren.</span><span class="sxs-lookup"><span data-stu-id="90d33-122">Do not call **MessageBox** during service initialization or from the [**HandlerEx**](/windows/desktop/api/WinSvc/nc-winsvc-lphandler_function_ex) routine, unless you call it from a separate thread, so that you return to the SCM in a timely manner.</span></span>

## <a name="using-an-interactive-service"></a><span data-ttu-id="90d33-123">Verwenden eines interaktiven Dienstanbieter</span><span class="sxs-lookup"><span data-stu-id="90d33-123">Using an Interactive Service</span></span>

<span data-ttu-id="90d33-124">Standardmäßig verwenden Dienste eine nicht interaktive [Fenster Station](/windows/desktop/winstation/window-stations) und können nicht mit dem Benutzer interagieren.</span><span class="sxs-lookup"><span data-stu-id="90d33-124">By default, services use a noninteractive [window station](/windows/desktop/winstation/window-stations) and cannot interact with the user.</span></span> <span data-ttu-id="90d33-125">Ein *interaktiver Dienst* kann jedoch eine Benutzeroberfläche anzeigen und Benutzereingaben erhalten.</span><span class="sxs-lookup"><span data-stu-id="90d33-125">However, an *interactive service* can display a user interface and receive user input.</span></span>

> [!Caution]  
> <span data-ttu-id="90d33-126">Dienste, die in einem Sicherheitskontext mit erhöhten Rechten ausgeführt werden, z. b. das LocalSystem-Konto, sollten auf dem interaktiven Desktop kein Fenster erstellen, da jede andere Anwendung, die auf dem interaktiven Desktop ausgeführt wird, mit diesem Fenster interagieren kann.</span><span class="sxs-lookup"><span data-stu-id="90d33-126">Services running in an elevated security context, such as the LocalSystem account, should not create a window on the interactive desktop because any other application that is running on the interactive desktop can interact with this window.</span></span> <span data-ttu-id="90d33-127">Dadurch wird der Dienst für jede Anwendung verfügbar gemacht, die von einem angemeldeten Benutzer ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="90d33-127">This exposes the service to any application that a logged-on user executes.</span></span> <span data-ttu-id="90d33-128">Außerdem sollten Dienste, die als "LocalSystem" ausgeführt werden, nicht durch Aufrufen der [**openwindowstation**](/windows/desktop/api/winuser/nf-winuser-openwindowstationa) -oder [**getthreaddesktop-**](/windows/desktop/api/winuser/nf-winuser-getthreaddesktop) Funktion auf den interaktiven Desktop zugreifen.</span><span class="sxs-lookup"><span data-stu-id="90d33-128">Also, services that are running as LocalSystem should not access the interactive desktop by calling the [**OpenWindowStation**](/windows/desktop/api/winuser/nf-winuser-openwindowstationa) or [**GetThreadDesktop**](/windows/desktop/api/winuser/nf-winuser-getthreaddesktop) function.</span></span>

 

<span data-ttu-id="90d33-129">Um einen interaktiven Dienst zu erstellen, führen Sie die folgenden Schritte aus, wenn Sie die [**CreateService**](/windows/desktop/api/Winsvc/nf-winsvc-createservicea) -Funktion aufrufen:</span><span class="sxs-lookup"><span data-stu-id="90d33-129">To create an interactive service, do the following when calling the [**CreateService**](/windows/desktop/api/Winsvc/nf-winsvc-createservicea) function:</span></span>

1.  <span data-ttu-id="90d33-130">Geben Sie NULL für den *lpservicestartname* -Parameter an, um den Dienst im Kontext des [Kontos "LocalSystem](localsystem-account.md)" auszuführen.</span><span class="sxs-lookup"><span data-stu-id="90d33-130">Specify NULL for the *lpServiceStartName* parameter to run the service in the context of the [LocalSystem account](localsystem-account.md).</span></span>
2.  <span data-ttu-id="90d33-131">Geben Sie das **Dienst \_ interaktive \_ prozessflag** an.</span><span class="sxs-lookup"><span data-stu-id="90d33-131">Specify the **SERVICE\_INTERACTIVE\_PROCESS** flag.</span></span>

<span data-ttu-id="90d33-132">Um zu ermitteln, ob ein Dienst als interaktiver Dienst ausgeführt wird, rufen Sie die [**getprocesswindowstation**](/windows/desktop/api/winuser/nf-winuser-getprocesswindowstation) -Funktion auf, um ein Handle für die Fenster Station abzurufen, und die [**getuserobjectinformation**](/windows/desktop/api/winuser/nf-winuser-getuserobjectinformationa) -Funktion, um zu testen, ob die Fenster Station über das **\_ sichtbare WSF** -Attribut verfügt.</span><span class="sxs-lookup"><span data-stu-id="90d33-132">To determine whether a service is running as an interactive service, call the [**GetProcessWindowStation**](/windows/desktop/api/winuser/nf-winuser-getprocesswindowstation) function to retrieve a handle to the window station, and the [**GetUserObjectInformation**](/windows/desktop/api/winuser/nf-winuser-getuserobjectinformationa) function to test whether the window station has the **WSF\_VISIBLE** attribute.</span></span>

<span data-ttu-id="90d33-133">Beachten Sie jedoch, dass der folgende Registrierungsschlüssel den Wert " **nointeractiveservices**" enthält, der die Auswirkung des \_ interaktiven Dienst \_ Vorgangs steuert:</span><span class="sxs-lookup"><span data-stu-id="90d33-133">However, note that the following registry key contains a value, **NoInteractiveServices**, that controls the effect of SERVICE\_INTERACTIVE\_PROCESS:</span></span>

<span data-ttu-id="90d33-134">**HKEY \_ local \_ Machine \\ System \\ CurrentControlSet \\ Control \\ Windows**</span><span class="sxs-lookup"><span data-stu-id="90d33-134">**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Windows**</span></span>

<span data-ttu-id="90d33-135">Der **nointeractiveservices** -Wert ist standardmäßig auf 1 festgelegt. Dies bedeutet, dass kein Dienst interaktiv ausgeführt werden darf, unabhängig davon, ob der **Dienst \_ interaktiv \_ verarbeitet** wird.</span><span class="sxs-lookup"><span data-stu-id="90d33-135">The **NoInteractiveServices** value defaults to 1, which means that no service is allowed to run interactively, regardless of whether it has **SERVICE\_INTERACTIVE\_PROCESS**.</span></span> <span data-ttu-id="90d33-136">Wenn **nointeractiveservices** auf "0" festgelegt ist, können Dienste mit **\_ interaktivem Dienst \_ Prozess** interaktiv ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="90d33-136">When **NoInteractiveServices** is set to a 0, services with **SERVICE\_INTERACTIVE\_PROCESS** are allowed to run interactively.</span></span>

<span data-ttu-id="90d33-137">**Windows 7, Windows Server 2008 R2, Windows XP und Windows Server 2003:** Der **nointeractiveservices** -Wert ist standardmäßig auf 0 festgelegt. Dies bedeutet, dass Dienste mit **\_ interaktivem Dienst \_ Prozess** interaktiv ausgeführt werden können.</span><span class="sxs-lookup"><span data-stu-id="90d33-137">**Windows 7, Windows Server 2008 R2, Windows XP and Windows Server 2003:** The **NoInteractiveServices** value defaults to 0, which means that services with **SERVICE\_INTERACTIVE\_PROCESS** are allowed to run interactively.</span></span> <span data-ttu-id="90d33-138">Wenn **nointeractiveservices** auf einen Wert ungleich 0 (null) festgelegt ist, kann kein Dienst, der danach gestartet wird, interaktiv ausgeführt werden, unabhängig davon, ob der **Dienst \_ interaktiv \_ verarbeitet** wird.</span><span class="sxs-lookup"><span data-stu-id="90d33-138">When **NoInteractiveServices** is set to a nonzero value, no service started thereafter is allowed to run interactively, regardless of whether it has **SERVICE\_INTERACTIVE\_PROCESS**.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="90d33-139">Alle-Dienste werden in Terminal Dienste-Sitzung 0 ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="90d33-139">All services run in Terminal Services session 0.</span></span> <span data-ttu-id="90d33-140">Wenn ein interaktiver Dienst also eine Benutzeroberfläche anzeigt, wird er nur für den Benutzer angezeigt, der eine Verbindung mit Sitzung 0 hergestellt hat.</span><span class="sxs-lookup"><span data-stu-id="90d33-140">Therefore, if an interactive service displays a user interface, it is visible only to the user who connected to session 0.</span></span> <span data-ttu-id="90d33-141">Da es nicht möglich ist, sicherzustellen, dass der interaktive Benutzer mit Sitzung 0 verbunden ist, sollten Sie einen Dienst nicht so konfigurieren, dass er als interaktiver Dienst unter Terminal Diensten oder auf einem System ausgeführt wird, das die schnelle Benutzerumschaltung unterstützt (schnelle Benutzerumschaltung wird mithilfe von Terminal Diensten implementiert).</span><span class="sxs-lookup"><span data-stu-id="90d33-141">Because there is no way to guarantee that the interactive user is connected to session 0, do not configure a service to run as an interactive service under Terminal Services or on a system that supports fast user switching (fast user switching is implemented using Terminal Services).</span></span>

 

 

 
