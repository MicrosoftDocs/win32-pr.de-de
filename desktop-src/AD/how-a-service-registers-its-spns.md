---
title: Registrieren der SPNs durch einen Dienst
description: Bevor ein Client einen SPN zum Authentifizieren einer Instanz eines Dienstanbieter verwenden kann, muss der SPN für das Benutzer-oder Computer Konto registriert werden, das von der Dienst Instanz für die Anmeldung verwendet wird.
ms.assetid: 39712c1f-3a9a-4c98-a1cb-879ab0b4cb63
ms.tgt_platform: multiple
keywords:
- Registrieren des SPNs AD durch einen Dienst
- Dienst Prinzipal Name AD, wie ein Dienst seine SPNs registriert
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 74410be3a024fc6accd1d8394e2ba8335be9f550
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/16/2019
ms.locfileid: "103855427"
---
# <a name="how-a-service-registers-its-spns"></a><span data-ttu-id="19dd2-105">Registrieren der SPNs durch einen Dienst</span><span class="sxs-lookup"><span data-stu-id="19dd2-105">How a Service Registers its SPNs</span></span>

<span data-ttu-id="19dd2-106">Bevor ein Client einen SPN zum Authentifizieren einer Instanz eines Dienstanbieter verwenden kann, muss der SPN für das Benutzer-oder Computer Konto registriert werden, das von der Dienst Instanz für die Anmeldung verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="19dd2-106">Before a client can use an SPN to authenticate an instance of a service, the SPN must be registered on the user or computer account that the service instance will use to log on.</span></span> <span data-ttu-id="19dd2-107">In der Regel wird die SPN-Registrierung von einem Dienst Installationsprogramm ausgeführt, das mit Domänen Administratorrechten ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="19dd2-107">Typically, SPN registration is done by a service installation program running with domain administrator privileges.</span></span>

<span data-ttu-id="19dd2-108">Das Dienst Installationsprogramm, das eine Dienst Instanz auf einem Host Computer installiert, führt normalerweise das folgende Verfahren aus.</span><span class="sxs-lookup"><span data-stu-id="19dd2-108">The service installer that installs a service instance on a host computer typically performs the following procedure.</span></span>

<span data-ttu-id="19dd2-109">**So registrieren Sie SPNs für eine Dienst Instanz**</span><span class="sxs-lookup"><span data-stu-id="19dd2-109">**To register SPNs for a service instance**</span></span>

1.  <span data-ttu-id="19dd2-110">Rufen Sie die [**dsgetspn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsgetspna) -Funktion auf, um einen oder mehrere eindeutige SPNs für die Dienst Instanz zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="19dd2-110">Call the [**DsGetSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsgetspna) function to create one or more unique SPNs for the service instance.</span></span> <span data-ttu-id="19dd2-111">Weitere Informationen finden Sie unter [namens Formate für eindeutige SPNs](name-formats-for-unique-spns.md).</span><span class="sxs-lookup"><span data-stu-id="19dd2-111">For more information, see [Name Formats for Unique SPNs](name-formats-for-unique-spns.md).</span></span>
2.  <span data-ttu-id="19dd2-112">Wenden Sie die [**dsschreiteaccountspn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) -Funktion an, um die Namen für das Anmelde Konto des Diensts zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="19dd2-112">Call the [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) function to register the names on the service's logon account.</span></span>

<span data-ttu-id="19dd2-113">[**Dswrite teaccountspn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) registriert SPNs als Eigenschaft eines Benutzer-oder Computer Konto Objekts im Verzeichnis.</span><span class="sxs-lookup"><span data-stu-id="19dd2-113">[**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) registers SPNs as a property of a user or computer account object in the directory.</span></span> <span data-ttu-id="19dd2-114">**Benutzer** -und **Computer** Objekte verfügen über ein **servicePrincipalName** -Attribut, bei dem es sich um ein mehr wertiges Attribut zum Speichern aller SPNs handelt, die einem Benutzer-oder Computer Konto zugeordnet sind.</span><span class="sxs-lookup"><span data-stu-id="19dd2-114">**user** and **computer** objects have a **servicePrincipalName** attribute, which is a multi-valued attribute for storing all the SPNs associated with a user or computer account.</span></span> <span data-ttu-id="19dd2-115">Wenn der Dienst unter einem Benutzerkonto ausgeführt wird, werden die SPNs im **servicePrincipalName** -Attribut dieses Kontos gespeichert.</span><span class="sxs-lookup"><span data-stu-id="19dd2-115">If the service runs under a user account, the SPNs are stored in the **servicePrincipalName** attribute of that account.</span></span> <span data-ttu-id="19dd2-116">Wenn der Dienst im Konto "LocalSystem" ausgeführt wird, werden die SPNs im **servicePrincipalName** -Attribut des Kontos auf dem Host Computer des Diensts gespeichert.</span><span class="sxs-lookup"><span data-stu-id="19dd2-116">If the service runs in the LocalSystem account, the SPNs are stored in the **servicePrincipalName** attribute of the account of the service's host computer.</span></span> <span data-ttu-id="19dd2-117">Der **dswrite-accountspn** -Aufrufer muss den Distinguished Name des Konto Objekts angeben, unter dem die SPNs gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="19dd2-117">The **DsWriteAccountSpn** caller must specify the distinguished name of the account object under which the SPNs are stored.</span></span>

<span data-ttu-id="19dd2-118">Um sicherzustellen, dass registrierte SPNs sicher sind, kann das **servicePrincipalName** -Attribut nicht direkt geschrieben werden. Sie kann nur durch Aufrufen von [**dswrite-accountspn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna)geschrieben werden.</span><span class="sxs-lookup"><span data-stu-id="19dd2-118">To ensure that registered SPNs are secure, the **servicePrincipalName** attribute cannot be written directly; it can only be written by calling [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna).</span></span> <span data-ttu-id="19dd2-119">Der Aufrufer muss über Schreibzugriff auf das **servicePrincipalName** -Attribut des Zielkontos verfügen.</span><span class="sxs-lookup"><span data-stu-id="19dd2-119">The caller must have write-access to the **servicePrincipalName** attribute of the target account.</span></span> <span data-ttu-id="19dd2-120">In der Regel wird Schreibzugriff standardmäßig nur für Domänen Administratoren erteilt.</span><span class="sxs-lookup"><span data-stu-id="19dd2-120">Typically, write access is granted by default only to domain administrators.</span></span> <span data-ttu-id="19dd2-121">Es gibt jedoch einen Sonderfall, bei dem ein Dienst, der unter dem Konto "LocalSystem" ausgeführt wird, seine eigenen SPNs auf dem Computer Konto des Dienst Hosts registrieren kann.</span><span class="sxs-lookup"><span data-stu-id="19dd2-121">However, there is a special case in which the system allows a service running under the LocalSystem account to register its own SPNs on the computer account of the service's host.</span></span> <span data-ttu-id="19dd2-122">In diesem Fall muss der SPN, der geschrieben wird, das Format "" aufweisen, <service class> / <host> und " &lt; Host &gt; " muss der DNS-Name des lokalen Computers sein.</span><span class="sxs-lookup"><span data-stu-id="19dd2-122">In this case, the SPN being written must have the form "<service class>/<host>" and "&lt;host&gt;" must be the DNS name of the local computer.</span></span>

<span data-ttu-id="19dd2-123">[**Dsbeschreib teaccountspn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) kann auch SPNs von einem Konto entfernen.</span><span class="sxs-lookup"><span data-stu-id="19dd2-123">[**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) can also remove SPNs from an account.</span></span> <span data-ttu-id="19dd2-124">Ein Vorgangs Parameter gibt an, ob die SPNs dem Konto hinzugefügt, aus dem Konto entfernt oder verwendet werden, um alle aktuellen SPNs für das Konto vollständig zu ersetzen.</span><span class="sxs-lookup"><span data-stu-id="19dd2-124">An operation parameter indicates whether the SPNs are to be added to the account, removed from the account, or used to completely replace all current SPNs for the account.</span></span> <span data-ttu-id="19dd2-125">Wenn eine Dienst Instanz deinstalliert wird, entfernen Sie alle für diese Instanz registrierten SPNs.</span><span class="sxs-lookup"><span data-stu-id="19dd2-125">When a service instance is uninstalled, remove any SPNs registered for that instance.</span></span>

<span data-ttu-id="19dd2-126">Weitere Informationen und ein Codebeispiel, in dem die SPNs eines dienstanders registriert oder aufgehoben werden, finden Sie unter [Registrieren der SPNs für einen Dienst](registering-the-spns-for-a-service.md).</span><span class="sxs-lookup"><span data-stu-id="19dd2-126">For more information and a code example that registers or unregisters a service's SPNs, see [Registering the SPNs for a Service](registering-the-spns-for-a-service.md).</span></span>

<span data-ttu-id="19dd2-127">Host basierte Dienste, die das einfache SPN-Format " <service class> / <host> " verwenden, haben die Möglichkeit, die [**DsServerRegisterSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsserverregisterspna) -Funktion zu verwenden, die für eine Dienst Instanz SPNs erstellt und registriert.</span><span class="sxs-lookup"><span data-stu-id="19dd2-127">Host-based services that use the simple SPN format "<service class>/<host>", have the option of using the [**DsServerRegisterSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsserverregisterspna) function, which both creates and registers SPNs for a service instance.</span></span> <span data-ttu-id="19dd2-128">**DsServerRegisterSpn** ist eine Hilfsfunktion, die [**dsgetspn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsgetspna) und [**dsschreiteaccountspn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna)aufruft.</span><span class="sxs-lookup"><span data-stu-id="19dd2-128">**DsServerRegisterSpn** is a helper function that calls [**DsGetSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsgetspna) and [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna).</span></span>

<span data-ttu-id="19dd2-129">Weitere Informationen finden Sie unter [Dienst Anmeldekonten](service-logon-accounts.md).</span><span class="sxs-lookup"><span data-stu-id="19dd2-129">For more information, see [Service Logon Accounts](service-logon-accounts.md).</span></span>

 

 




