---
title: Erstellen von Sicherheits Deskriptoren für neue Verzeichnisobjekte
description: Sie können ADSI verwenden, um eine Sicherheits Beschreibung zu erstellen und Sie als ntSecurityDescriptor-Eigenschaft eines neuen Objekts festzulegen, oder Sie verwenden, um die ntSecurityDescriptor-Eigenschaft eines vorhandenen Objekts zu ersetzen.
ms.assetid: b9ff626f-17f1-4fc1-9d6e-4f47e29a5aeb
ms.tgt_platform: multiple
keywords:
- Erstellen einer Sicherheits Beschreibung für ein neues Verzeichnis Objekt AD
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 78265d27c52023d669e27fc9890fd2d5273e2ffd
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/17/2020
ms.locfileid: "104472628"
---
# <a name="creating-security-descriptors-for-new-directory-objects"></a><span data-ttu-id="61ccc-104">Erstellen von Sicherheits Deskriptoren für neue Verzeichnisobjekte</span><span class="sxs-lookup"><span data-stu-id="61ccc-104">Creating Security Descriptors for new directory objects</span></span>

<span data-ttu-id="61ccc-105">Sie können ADSI verwenden, um eine Sicherheits Beschreibung zu erstellen und Sie als **ntSecurityDescriptor** -Eigenschaft eines neuen Objekts festzulegen, oder Sie verwenden, um die **ntSecurityDescriptor** -Eigenschaft eines vorhandenen Objekts zu ersetzen.</span><span class="sxs-lookup"><span data-stu-id="61ccc-105">You can use ADSI to create a security descriptor and set it as a new object's **nTSecurityDescriptor** property or use it to replace an existing object's **nTSecurityDescriptor** property.</span></span>

<span data-ttu-id="61ccc-106">So erstellen Sie eine Sicherheits Beschreibung für ein Objekt:</span><span class="sxs-lookup"><span data-stu-id="61ccc-106">To create a security descriptor for an object:</span></span>

1.  <span data-ttu-id="61ccc-107">Verwenden Sie [**cokreateinstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) , um das ADSI COM-Objekt für die neue Sicherheits Beschreibung zu erstellen, und rufen Sie einen [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) -Schnittstellen Zeiger auf dieses Objekt ab.</span><span class="sxs-lookup"><span data-stu-id="61ccc-107">Use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) to create the ADSI COM object for the new security descriptor and get an [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) interface pointer to that object.</span></span> <span data-ttu-id="61ccc-108">Beachten Sie, dass die Klassen-ID **CLSID \_ securityDescriptor** ist.</span><span class="sxs-lookup"><span data-stu-id="61ccc-108">Be aware that the class ID is **CLSID\_SecurityDescriptor**.</span></span>
2.  <span data-ttu-id="61ccc-109">Verwenden Sie die [**IADsSecurityDescriptor::p UT- \_ Besitzer**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) Methode, um den Besitzer des Objekts festzulegen.</span><span class="sxs-lookup"><span data-stu-id="61ccc-109">Use the [**IADsSecurityDescriptor::put\_Owner**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to set the owner of the object.</span></span> <span data-ttu-id="61ccc-110">Der Vertrauens nehmer ist ein Benutzer, eine Gruppe oder ein anderer Sicherheits Prinzipal.</span><span class="sxs-lookup"><span data-stu-id="61ccc-110">The trustee is a user, group, or other security principal.</span></span> <span data-ttu-id="61ccc-111">Eine Anwendung sollte den Wert aus der entsprechenden Eigenschaft aus dem Benutzer-oder Gruppen Objekt des Vertrauens nehmers verwenden, auf den der ACE angewendet werden soll.</span><span class="sxs-lookup"><span data-stu-id="61ccc-111">An application should use the value from the appropriate property from the user or group object of the trustee to which to apply the ACE.</span></span>
3.  <span data-ttu-id="61ccc-112">Verwenden Sie die [**IADsSecurityDescriptor::p UT- \_ Steuerungs**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) Methode, um zu steuern, ob DACLs und SACLs von dem Objekt von seinem übergeordneten Container geerbt werden.</span><span class="sxs-lookup"><span data-stu-id="61ccc-112">Use the [**IADsSecurityDescriptor::put\_Control**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to control whether DACLs and SACLs are inherited by the object from its parent container.</span></span>
4.  <span data-ttu-id="61ccc-113">Verwenden Sie [**cokreateinstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) , um das ADSI COM-Objekt für die DACL für die neue Sicherheits Beschreibung zu erstellen, und rufen Sie einen [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) -Schnittstellen Zeiger auf dieses Objekt ab.</span><span class="sxs-lookup"><span data-stu-id="61ccc-113">Use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) to create the ADSI COM object for the DACL for the new security descriptor and get an [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) interface pointer to that object.</span></span> <span data-ttu-id="61ccc-114">Beachten Sie, dass die Klassen-ID **CLSID \_ AccessControlList** ist.</span><span class="sxs-lookup"><span data-stu-id="61ccc-114">Be aware that the class ID is **CLSID\_AccessControlList**.</span></span>
5.  <span data-ttu-id="61ccc-115">Verwenden Sie für jeden ACE, der der DACL hinzugefügt werden soll, [**cokreateinstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) , um das ADSI COM-Objekt für den neuen ACE zu erstellen, und rufen Sie einen [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) -Schnittstellen Zeiger auf dieses Objekt ab.</span><span class="sxs-lookup"><span data-stu-id="61ccc-115">For each ACE to add to the DACL, use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) to create the ADSI COM object for the new ACE and get an [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) interface pointer to that object.</span></span> <span data-ttu-id="61ccc-116">Beachten Sie, dass die Klassen-ID CLSID \_ AccessControlEntry ist.</span><span class="sxs-lookup"><span data-stu-id="61ccc-116">Be aware that the class ID is CLSID\_AccessControlEntry.</span></span>
6.  <span data-ttu-id="61ccc-117">Legen Sie für jeden ACE, der der DACL hinzugefügt werden soll, die Eigenschaften des ACE mithilfe der Eigenschafts Methoden des [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) -Objekts des ACE fest.</span><span class="sxs-lookup"><span data-stu-id="61ccc-117">For each ACE to add to the DACL, set the properties of the ACE using the property methods of the ACE's [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) object.</span></span> <span data-ttu-id="61ccc-118">Weitere Informationen zu den Eigenschaften, die für einen ACE festgelegt werden, finden Sie unter [Festlegen von Zugriffsrechten für ein Objekt](setting-access-rights-on-an-object.md).</span><span class="sxs-lookup"><span data-stu-id="61ccc-118">For more information about the properties to set on an ACE, see [Setting Access Rights on an Object](setting-access-rights-on-an-object.md).</span></span>
7.  <span data-ttu-id="61ccc-119">Verwenden Sie für jeden ACE, der der DACL hinzugefügt werden soll, die **QueryInterface** -Methode für das [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) -Objekt, um einen [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) -Zeiger zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="61ccc-119">For each ACE to add to the DACL, use the **QueryInterface** method on the [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) object to get an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) pointer.</span></span> <span data-ttu-id="61ccc-120">Die [**IADsAccessControlList:: addace**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) -Methode erfordert einen **IDispatch** -Schnittstellen Zeiger auf den ACE.</span><span class="sxs-lookup"><span data-stu-id="61ccc-120">The [**IADsAccessControlList::AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) method requires an **IDispatch** interface pointer to the ACE.</span></span>
8.  <span data-ttu-id="61ccc-121">Verwenden Sie für jeden ACE, der der DACL hinzugefügt werden soll, [**IADsAccessControlList:: addace**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) , um den neuen ACE der DACL hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="61ccc-121">For each ACE to add to the DACL, use [**IADsAccessControlList::AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) to add the new ACE to the DACL.</span></span> <span data-ttu-id="61ccc-122">Beachten Sie, dass sich die Reihenfolge der ACEs innerhalb der ACL auf die Auswertung des Zugriffs auf das Objekt auswirken kann.</span><span class="sxs-lookup"><span data-stu-id="61ccc-122">Be aware that the order of the ACEs within the ACL can affect the evaluation of access to the object.</span></span> <span data-ttu-id="61ccc-123">Der richtige Zugriff auf das Objekt erfordert möglicherweise, dass Sie eine neue ACL erstellen, die ACEs aus der vorhandenen ACL in der richtigen Reihenfolge der neuen ACL hinzufügen und dann die vorhandene ACL in der Sicherheits Beschreibung durch die neue ACL ersetzen.</span><span class="sxs-lookup"><span data-stu-id="61ccc-123">The correct access to the object may require you to create a new ACL, add the ACEs from the existing ACL in the correct order to the new ACL, and then replace the existing ACL in the security descriptor with the new ACL.</span></span> <span data-ttu-id="61ccc-124">Weitere Informationen finden Sie unter [Reihenfolge von ACEs in einer DACL](/windows/desktop/SecAuthZ/order-of-aces-in-a-dacl).</span><span class="sxs-lookup"><span data-stu-id="61ccc-124">For more information, see [Order of ACEs in a DACL](/windows/desktop/SecAuthZ/order-of-aces-in-a-dacl).</span></span>
9.  <span data-ttu-id="61ccc-125">Führen Sie die Schritte 4-8 aus, um die SACL für den neuen Sicherheits Deskriptor zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="61ccc-125">Follow Steps 4-8 to create the SACL for the new security descriptor.</span></span>
10. <span data-ttu-id="61ccc-126">Verwenden Sie die [**IADsSecurityDescriptor::p UT-Methode " \_ diskretionaryacl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) ", um die DACL festzulegen.</span><span class="sxs-lookup"><span data-stu-id="61ccc-126">Use the [**IADsSecurityDescriptor::put\_DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to set the DACL.</span></span> <span data-ttu-id="61ccc-127">Weitere Informationen zu DACLs finden Sie unter [null-DACLs und leere DACLs](null-dacls-and-empty-dacls.md).</span><span class="sxs-lookup"><span data-stu-id="61ccc-127">For more information about DACLs, see [Null DACLs and Empty DACLs](null-dacls-and-empty-dacls.md).</span></span>
11. <span data-ttu-id="61ccc-128">Verwenden Sie die [**IADsSecurityDescriptor::p UT \_ SystemAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) -Methode, um die SACL festzulegen.</span><span class="sxs-lookup"><span data-stu-id="61ccc-128">Use the [**IADsSecurityDescriptor::put\_SystemAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to set the SACL.</span></span>
12. <span data-ttu-id="61ccc-129">Konvertieren Sie das [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) -Objekt in eine [**Variante**](/windows/win32/api/oaidl/ns-oaidl-variant) , indem Sie mithilfe der **QueryInterface** -Methode des **IADsSecurityDescriptor** -Objekts eine [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) -Schnittstelle abrufen.</span><span class="sxs-lookup"><span data-stu-id="61ccc-129">Convert the [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) object to a [**VARIANT**](/windows/win32/api/oaidl/ns-oaidl-variant) by using the **QueryInterface** method of the **IADsSecurityDescriptor** object to obtain an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) interface.</span></span> <span data-ttu-id="61ccc-130">Legen Sie dann den **VT** -Member **der Variante** auf **VT \_ Dispatch** fest, und legen Sie den **pdispVal** -Member der **Variante** gleich dem **IDispatch** -Zeiger fest.</span><span class="sxs-lookup"><span data-stu-id="61ccc-130">Then set the **vt** member of the **VARIANT** to **VT\_DISPATCH** and set the **pdispVal** member of the **VARIANT** equal to the **IDispatch** pointer.</span></span>
13. <span data-ttu-id="61ccc-131">Rufen Sie einen [**IADs**](/windows/desktop/api/iads/nn-iads-iads) -Schnittstellen Zeiger auf das-Objekt ab.</span><span class="sxs-lookup"><span data-stu-id="61ccc-131">Obtain an [**IADs**](/windows/desktop/api/iads/nn-iads-iads) interface pointer to the object.</span></span>
14. <span data-ttu-id="61ccc-132">Verwenden Sie die [**IADs::P UT**](/windows/desktop/api/iads/nf-iads-iads-put) -Methode mit "ntSecurityDescriptor" und die oben erstellte [**Variante**](/windows/win32/api/oaidl/ns-oaidl-variant) , um die neue Sicherheits Beschreibung in den Eigenschaften Cache zu schreiben.</span><span class="sxs-lookup"><span data-stu-id="61ccc-132">Use the [**IADs::Put**](/windows/desktop/api/iads/nf-iads-iads-put) method with "nTSecurityDescriptor" and the [**VARIANT**](/windows/win32/api/oaidl/ns-oaidl-variant) created above to write the new security descriptor to the property cache.</span></span>
15. <span data-ttu-id="61ccc-133">Verwenden Sie die [**IADs:: SetInfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo) -Methode, um die-Eigenschaft für das Objekt im Verzeichnis zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="61ccc-133">Use the [**IADs::SetInfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo) method to update the property on the object in the directory.</span></span>

 

 