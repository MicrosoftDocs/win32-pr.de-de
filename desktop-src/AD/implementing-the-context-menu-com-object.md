---
title: Implementieren des Kontextmenü-com-Objekts
description: Eine Kontextmenüerweiterung ist ein COM-Objekt, das als in-proc-Server implementiert wird.
ms.assetid: 362dd8e5-1518-4bf4-ac53-115263cd6c62
ms.tgt_platform: multiple
keywords:
- Kontextmenü-com-Objekt AD
- Kontextmenü-com-Objekt AD, implementieren
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a34d6b487d130327b379ed845f2d0157f2b28056
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/17/2020
ms.locfileid: "106339471"
---
# <a name="implementing-the-context-menu-com-object"></a><span data-ttu-id="1f238-105">Implementieren des Kontextmenü-com-Objekts</span><span class="sxs-lookup"><span data-stu-id="1f238-105">Implementing the Context Menu COM Object</span></span>

<span data-ttu-id="1f238-106">Eine Kontextmenüerweiterung ist ein COM-Objekt, das als in-proc-Server implementiert wird.</span><span class="sxs-lookup"><span data-stu-id="1f238-106">A context menu extension is a COM object implemented as an in-proc server.</span></span> <span data-ttu-id="1f238-107">Die Kontextmenüerweiterung muss die [**ishellextinit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) -und [**IContextMenu**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-icontextmenu) -Schnittstellen implementieren.</span><span class="sxs-lookup"><span data-stu-id="1f238-107">The context menu extension must implement the [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) and [**IContextMenu**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-icontextmenu) interfaces.</span></span> <span data-ttu-id="1f238-108">Eine Kontextmenüerweiterung wird instanziiert, wenn der Benutzer das Kontextmenü für ein Objekt einer Klasse anzeigt, für die die Kontextmenüerweiterung registriert wurde.</span><span class="sxs-lookup"><span data-stu-id="1f238-108">A context menu extension is instantiated when the user displays the context menu for an object of a class for which the context menu extension has been registered.</span></span>

## <a name="implementing-ishellextinit"></a><span data-ttu-id="1f238-109">Implementieren von ishellextinit</span><span class="sxs-lookup"><span data-stu-id="1f238-109">Implementing IShellExtInit</span></span>

<span data-ttu-id="1f238-110">Nachdem das COM-Objekt der Kontextmenüerweiterung instanziiert wurde, wird die [**ishellextinit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) -Methode aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="1f238-110">After the context menu extension COM object is instantiated, the [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) method is called.</span></span> <span data-ttu-id="1f238-111">**Ishellextinit:: Initialize** liefert die Kontextmenüerweiterung mit einem [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) -Objekt, das Daten enthält, die für das Verzeichnis Objekt relevant sind, für das das Kontextmenü gilt.</span><span class="sxs-lookup"><span data-stu-id="1f238-111">**IShellExtInit::Initialize** supplies the context menu extension with an [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) object that contains data pertinent to the directory object that the context menu applies to.</span></span>

<span data-ttu-id="1f238-112">Das [**IDataObject-Objekt**](/windows/win32/api/objidl/nn-objidl-idataobject) enthält Daten im [**cfstr \_ dsobjectnames**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) -Format.</span><span class="sxs-lookup"><span data-stu-id="1f238-112">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) contains data in the [**CFSTR\_DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) format.</span></span> <span data-ttu-id="1f238-113">Das Datenformat **cfstr \_ dsobjectnames** ist ein **HGLOBAL** , das eine [**dsobjectnames**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) -Struktur enthält.</span><span class="sxs-lookup"><span data-stu-id="1f238-113">The **CFSTR\_DSOBJECTNAMES** data format is an **HGLOBAL** that contains a [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) structure.</span></span> <span data-ttu-id="1f238-114">Die **dsobjectnames** -Struktur enthält Daten über das Verzeichnis Objekt, auf das die Eigenschaften Blatt Erweiterung angewendet wird.</span><span class="sxs-lookup"><span data-stu-id="1f238-114">The **DSOBJECTNAMES** structure contains data about the directory object that the property sheet extension applies to.</span></span>

<span data-ttu-id="1f238-115">Das [**IDataObject-Objekt**](/windows/win32/api/objidl/nn-objidl-idataobject) enthält auch Daten im Format der Optionen für die [**cfstr \_ DS- \_ Anzeige \_ Spezifikation \_**](cfstr-ds-display-spec-options.md) .</span><span class="sxs-lookup"><span data-stu-id="1f238-115">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) also contains data in the [**CFSTR\_DS\_DISPLAY\_SPEC\_OPTIONS**](cfstr-ds-display-spec-options.md) format.</span></span> <span data-ttu-id="1f238-116">Das Datenformat der **cfstr \_ DS- \_ Anzeige \_ \_ Spezifikation** ist ein **HGLOBAL** , das eine [**dsdisplayspecoptions**](/windows/desktop/api/Dsclient/ns-dsclient-dsdisplayspecoptions) -Struktur enthält.</span><span class="sxs-lookup"><span data-stu-id="1f238-116">The **CFSTR\_DS\_DISPLAY\_SPEC\_OPTIONS** data format is an **HGLOBAL** that contains a [**DSDISPLAYSPECOPTIONS**](/windows/desktop/api/Dsclient/ns-dsclient-dsdisplayspecoptions) structure.</span></span> <span data-ttu-id="1f238-117">**Dsdisplayspecoptions** enthält Konfigurationsdaten, die von der Erweiterung verwendet werden können.</span><span class="sxs-lookup"><span data-stu-id="1f238-117">The **DSDISPLAYSPECOPTIONS** contains configuration data for use by the extension.</span></span>

<span data-ttu-id="1f238-118">Wenn ein anderer Wert als **S \_ OK** von [**ishellextinit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize)zurückgegeben wird, wird die Kontextmenüerweiterung nicht verwendet.</span><span class="sxs-lookup"><span data-stu-id="1f238-118">If any value other than **S\_OK** is returned from [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize), the context menu extension will not be used.</span></span>

<span data-ttu-id="1f238-119">Die Parameter " *pidlfolder* " und " *hkeyprogid* " der [**ishellextinit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) -Methode werden nicht verwendet.</span><span class="sxs-lookup"><span data-stu-id="1f238-119">The *pidlFolder* and *hkeyProgID* parameters of the [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) method are not used.</span></span>

## <a name="implementing-icontextmenu"></a><span data-ttu-id="1f238-120">Implementieren von IContextMenu</span><span class="sxs-lookup"><span data-stu-id="1f238-120">Implementing IContextMenu</span></span>

<span data-ttu-id="1f238-121">Nachdem [**ishellextinit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) zurückgegeben wurde, wird die [**IContextMenu:: querycontextmenu**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu) -Methode aufgerufen, um die Menü Elemente zu erhalten, die von der Kontextmenüerweiterung hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="1f238-121">After [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) returns, the [**IContextMenu::QueryContextMenu**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu) method is called to obtain the menu item or items that the context menu extension will add.</span></span> <span data-ttu-id="1f238-122">Die **querycontextmenu** -Implementierung ist recht unkompliziert.</span><span class="sxs-lookup"><span data-stu-id="1f238-122">The **QueryContextMenu** implementation is fairly straightforward.</span></span> <span data-ttu-id="1f238-123">Die Kontextmenüerweiterung fügt die Menü Elemente mithilfe der [**InsertMenuItem**](/windows/win32/api/winuser/nf-winuser-insertmenuitema) -Funktion oder einer ähnlichen Funktion hinzu.</span><span class="sxs-lookup"><span data-stu-id="1f238-123">The context menu extension adds its menu items using the [**InsertMenuItem**](/windows/win32/api/winuser/nf-winuser-insertmenuitema) or similar function.</span></span> <span data-ttu-id="1f238-124">Die Menübefehls Bezeichner müssen größer oder gleich *idcmdfirst* sein und müssen kleiner als *idcmdlast* sein.</span><span class="sxs-lookup"><span data-stu-id="1f238-124">The menu command identifiers must be greater than or equal to *idCmdFirst* and must be less than *idCmdLast*.</span></span> <span data-ttu-id="1f238-125">**Querycontextmenu** muss den größten numerischen Bezeichner zurückgeben, der dem Menü plus 1 hinzugefügt wurde.</span><span class="sxs-lookup"><span data-stu-id="1f238-125">**QueryContextMenu** must return the greatest numeric identifier added to the menu plus one.</span></span> <span data-ttu-id="1f238-126">Die beste Möglichkeit, Menübefehls Bezeichner zuzuweisen, besteht darin, bei Null zu beginnen und nacheinander zu arbeiten.</span><span class="sxs-lookup"><span data-stu-id="1f238-126">The best way to assign menu command identifiers is to start at zero and work up in sequence.</span></span> <span data-ttu-id="1f238-127">Wenn die Kontextmenüerweiterung keine Menü Elemente benötigt, sollten Sie dem Menü einfach keine Elemente hinzufügen und NULL aus **querycontextmenu** zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="1f238-127">If the context menu extension does not need to any menu items, it should simply not add any items to the menu and return zero from **QueryContextMenu**.</span></span>

<span data-ttu-id="1f238-128">[**IContextMenu:: getcommandstring**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-getcommandstring) wird aufgerufen, um Textdaten für das Menü Element abzurufen, z. b. den Hilfetext, der für das Menü Element angezeigt werden soll.</span><span class="sxs-lookup"><span data-stu-id="1f238-128">[**IContextMenu::GetCommandString**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-getcommandstring) is called to retrieve textual data for the menu item, such as help text to be displayed for the menu item.</span></span> <span data-ttu-id="1f238-129">Es ist möglich, dass der Kontextmenü Host Unicode-Zeichen folgen verwendet, während die Erweiterung ANSI-Zeichen folgen verwendet.</span><span class="sxs-lookup"><span data-stu-id="1f238-129">It is possible that the context menu host will use Unicode strings while the extension uses ANSI strings.</span></span> <span data-ttu-id="1f238-130">Aus diesem Grund müssen die Fälle " **GCS \_ helptexta**", " **GCS \_ helptextw**", " **GCS \_ Verba** " und " **GCS \_ verbw** " einzeln behandelt werden.</span><span class="sxs-lookup"><span data-stu-id="1f238-130">Because of this, the **GCS\_HELPTEXTA**, **GCS\_HELPTEXTW**, **GCS\_VERBA** and **GCS\_VERBW** cases must be handled individually.</span></span> <span data-ttu-id="1f238-131">Die Implementierung dieser Methode ist optional.</span><span class="sxs-lookup"><span data-stu-id="1f238-131">Implementation of this method is optional.</span></span>

<span data-ttu-id="1f238-132">[**IContextMenu:: InvokeCommand**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand) wird aufgerufen, wenn eines der von der Kontextmenüerweiterung installierten Menü Elemente ausgewählt wird.</span><span class="sxs-lookup"><span data-stu-id="1f238-132">[**IContextMenu::InvokeCommand**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand) is called when one of the menu items installed by the context menu extension is selected.</span></span> <span data-ttu-id="1f238-133">Das Kontextmenü führt die gewünschten Aktionen als Reaktion auf diese Methode aus oder initiiert Sie.</span><span class="sxs-lookup"><span data-stu-id="1f238-133">The context menu performs or initiates the desired actions in response to this method.</span></span>

 

 