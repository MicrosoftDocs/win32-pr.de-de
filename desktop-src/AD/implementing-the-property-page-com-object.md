---
title: Implementieren des COM-Objekts der Eigenschaften Seite
description: Eine Eigenschaften Blatt Erweiterung ist ein COM-Objekt, das als in-proc-Server implementiert wird.
ms.assetid: 77a71086-1949-4828-801e-073ea5a6838b
ms.tgt_platform: multiple
keywords:
- Implementieren des COM-Objekts der Eigenschaften Seite
- COM-Objekt der Eigenschaften Seite, implementieren
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 55962002ca059ad6e9c137925d1ba21ba9adc513
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/17/2020
ms.locfileid: "103858143"
---
# <a name="implementing-the-property-page-com-object"></a><span data-ttu-id="ae015-105">Implementieren des COM-Objekts der Eigenschaften Seite</span><span class="sxs-lookup"><span data-stu-id="ae015-105">Implementing the Property Page COM Object</span></span>

<span data-ttu-id="ae015-106">Eine Eigenschaften Blatt Erweiterung ist ein COM-Objekt, das als in-proc-Server implementiert wird.</span><span class="sxs-lookup"><span data-stu-id="ae015-106">A property sheet extension is a COM object implemented as an in-proc server.</span></span> <span data-ttu-id="ae015-107">Die Eigenschaften Blatt Erweiterung muss die [**ishellextinit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) -und [**ishellpropsheetext**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellpropsheetext) -Schnittstellen implementieren.</span><span class="sxs-lookup"><span data-stu-id="ae015-107">The property sheet extension must implement the [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) and [**IShellPropSheetExt**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellpropsheetext) interfaces.</span></span> <span data-ttu-id="ae015-108">Eine Eigenschaften Blatt Erweiterung wird instanziiert, wenn der Benutzer das Eigenschaften Blatt für ein Objekt einer Klasse anzeigt, für die die Eigenschaften Blatt Erweiterung im Anzeige Spezifizierer der Klasse registriert wurde.</span><span class="sxs-lookup"><span data-stu-id="ae015-108">A property sheet extension is instantiated when the user displays the property sheet for an object of a class for which the property sheet extension has been registered in the display specifier of the class.</span></span>

-   [<span data-ttu-id="ae015-109">Implementieren von ishellextinit</span><span class="sxs-lookup"><span data-stu-id="ae015-109">Implementing IShellExtInit</span></span>](#implementing-ishellextinit)
-   [<span data-ttu-id="ae015-110">Implementieren von ishellpropsheetext</span><span class="sxs-lookup"><span data-stu-id="ae015-110">Implementing IShellPropSheetExt</span></span>](#implementing-ishellpropsheetext)
-   [<span data-ttu-id="ae015-111">Übergeben des Erweiterungs Objekts an die Eigenschaften Seite</span><span class="sxs-lookup"><span data-stu-id="ae015-111">Passing the Extension Object to the Property Page</span></span>](#passing-the-extension-object-to-the-property-page)
-   [<span data-ttu-id="ae015-112">Arbeiten mit dem Benachrichtigungs Objekt</span><span class="sxs-lookup"><span data-stu-id="ae015-112">Working With the Notification Object</span></span>](#working-with-the-notification-object)
-   [<span data-ttu-id="ae015-113">Verschiedenes</span><span class="sxs-lookup"><span data-stu-id="ae015-113">Miscellaneous</span></span>](#miscellaneous)
-   [<span data-ttu-id="ae015-114">Eigenschaften Blätter für Mehrfachauswahl</span><span class="sxs-lookup"><span data-stu-id="ae015-114">Multiple-Selection Property Sheets</span></span>](#multiple-selection-property-sheets)
-   [<span data-ttu-id="ae015-115">Neu in Windows Server 2003</span><span class="sxs-lookup"><span data-stu-id="ae015-115">New with Windows Server 2003</span></span>](#new-with-windows-server-2003)
-   [<span data-ttu-id="ae015-116">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="ae015-116">Related topics</span></span>](#related-topics)

## <a name="implementing-ishellextinit"></a><span data-ttu-id="ae015-117">Implementieren von ishellextinit</span><span class="sxs-lookup"><span data-stu-id="ae015-117">Implementing IShellExtInit</span></span>

<span data-ttu-id="ae015-118">Nachdem das COM-Objekt der Eigenschafts Blatt Erweiterung instanziiert wurde, wird die [**ishellextinit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) -Methode aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="ae015-118">After the property sheet extension COM object is instantiated, the [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) method is called.</span></span> <span data-ttu-id="ae015-119">**Ishellextinit:: Initialize** stellt die Eigenschaften Blatt Erweiterung mit einem [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) -Objekt bereit, das Daten enthält, die sich auf das Verzeichnis Objekt beziehen, das das Eigenschaften Blatt anwendet.</span><span class="sxs-lookup"><span data-stu-id="ae015-119">**IShellExtInit::Initialize** supplies the property sheet extension with an [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) object that contains data that pertains to the directory object that the property sheet applies.</span></span>

<span data-ttu-id="ae015-120">Das [**IDataObject-Objekt**](/windows/win32/api/objidl/nn-objidl-idataobject) enthält Daten im [**cfstr \_ dsobjectnames**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) -Format.</span><span class="sxs-lookup"><span data-stu-id="ae015-120">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) contains data in the [**CFSTR\_DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) format.</span></span> <span data-ttu-id="ae015-121">Das Datenformat **cfstr \_ dsobjectnames** ist ein **HGLOBAL** , das eine [**dsobjectnames**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) -Struktur enthält.</span><span class="sxs-lookup"><span data-stu-id="ae015-121">The **CFSTR\_DSOBJECTNAMES** data format is an **HGLOBAL** that contains a [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) structure.</span></span> <span data-ttu-id="ae015-122">Die **dsobjectnames** -Struktur enthält Verzeichnis Objektdaten, auf die die Eigenschaften Blatt Erweiterung angewendet wird.</span><span class="sxs-lookup"><span data-stu-id="ae015-122">The **DSOBJECTNAMES** structure contains directory object data that the property sheet extension applies.</span></span>

<span data-ttu-id="ae015-123">Das [**IDataObject-Objekt**](/windows/win32/api/objidl/nn-objidl-idataobject) enthält auch Daten im Format der Optionen für die [**cfstr \_ DS- \_ Anzeige \_ Spezifikation \_**](cfstr-ds-display-spec-options.md) .</span><span class="sxs-lookup"><span data-stu-id="ae015-123">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) also contains data in the [**CFSTR\_DS\_DISPLAY\_SPEC\_OPTIONS**](cfstr-ds-display-spec-options.md) format.</span></span> <span data-ttu-id="ae015-124">Das Datenformat der **cfstr \_ DS- \_ Anzeige \_ \_ Spezifikation** ist ein **HGLOBAL** , das eine [**dsdisplayspecoptions**](/windows/desktop/api/Dsclient/ns-dsclient-dsdisplayspecoptions) -Struktur enthält.</span><span class="sxs-lookup"><span data-stu-id="ae015-124">The **CFSTR\_DS\_DISPLAY\_SPEC\_OPTIONS** data format is an **HGLOBAL** that contains a [**DSDISPLAYSPECOPTIONS**](/windows/desktop/api/Dsclient/ns-dsclient-dsdisplayspecoptions) structure.</span></span> <span data-ttu-id="ae015-125">**Dsdisplayspecoptions** enthält Konfigurationsdaten, die von der Erweiterung verwendet werden können.</span><span class="sxs-lookup"><span data-stu-id="ae015-125">The **DSDISPLAYSPECOPTIONS** contains configuration data for use by the extension.</span></span>

<span data-ttu-id="ae015-126">Wenn ein anderer Wert als **S \_ OK** von [**ishellextinit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize)zurückgegeben wird, wird das Eigenschaften Blatt nicht angezeigt.</span><span class="sxs-lookup"><span data-stu-id="ae015-126">If any value other than **S\_OK** is returned from [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize), the property sheet is not displayed.</span></span>

<span data-ttu-id="ae015-127">Die Parameter " *pidlfolder* " und " *hkeyprogid* " der [**ishellextinit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) -Methode werden nicht verwendet.</span><span class="sxs-lookup"><span data-stu-id="ae015-127">The *pidlFolder* and *hkeyProgID* parameters of the [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) method are not used.</span></span>

<span data-ttu-id="ae015-128">Der [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) -Zeiger kann durch die Erweiterung gespeichert werden, indem der Verweis Zähler von **IDataObject** erhöht wird.</span><span class="sxs-lookup"><span data-stu-id="ae015-128">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) pointer can be saved by the extension by incrementing the reference count of the **IDataObject**.</span></span> <span data-ttu-id="ae015-129">Diese Schnittstelle muss freigegeben werden, wenn Sie nicht mehr benötigt wird.</span><span class="sxs-lookup"><span data-stu-id="ae015-129">This interface must be released when no longer required.</span></span>

## <a name="implementing-ishellpropsheetext"></a><span data-ttu-id="ae015-130">Implementieren von ishellpropsheetext</span><span class="sxs-lookup"><span data-stu-id="ae015-130">Implementing IShellPropSheetExt</span></span>

<span data-ttu-id="ae015-131">Nachdem [**ishellextinit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) zurückgegeben wurde, wird die [**ishellpropsheetext:: addPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) -Methode aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="ae015-131">After [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) returns, the [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) method is called.</span></span> <span data-ttu-id="ae015-132">Die Eigenschaften Blatt Erweiterung muss während dieser Methode die Seite oder Seiten hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="ae015-132">The property sheet extension must add the page or pages during this method.</span></span> <span data-ttu-id="ae015-133">Eine Eigenschaften Seite wird erstellt, indem Sie eine [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) -Struktur füllt und diese Struktur dann [**an die Funktion**](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) "die Funktion" von "|</span><span class="sxs-lookup"><span data-stu-id="ae015-133">A property page is created by filling a [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) structure and then passing this structure to the [**CreatePropertySheetPage**](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) function.</span></span> <span data-ttu-id="ae015-134">Die Eigenschaften Seite wird dann durch Aufrufen der Rückruffunktion, die an **ishellpropsheetext:: addPages** im *lpfnaddpage* -Parameter übergeben wird, dem Eigenschaften Blatt hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="ae015-134">The property page is then added to the property sheet by calling the callback function passed to **IShellPropSheetExt::AddPages** in the *lpfnAddPage* parameter.</span></span>

<span data-ttu-id="ae015-135">Wenn ein anderer Wert als **S \_ OK** von [**ishellpropsheetext:: addPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages)zurückgegeben wird, wird das Eigenschaften Blatt nicht angezeigt.</span><span class="sxs-lookup"><span data-stu-id="ae015-135">If any value other than **S\_OK** is returned from [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages), the property sheet is not displayed.</span></span>

<span data-ttu-id="ae015-136">Wenn die Eigenschaften Blatt Erweiterung keine Seiten zum Eigenschaften Blatt hinzufügen muss, sollte Sie nicht die Rückruffunktion aufrufen, die an [**ishellpropsheetext:: addPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) im *lpfnaddpage* -Parameter übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="ae015-136">If the property sheet extension is not required to add any pages to the property sheet, it should not call the callback function passed to [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) in the *lpfnAddPage* parameter.</span></span>

<span data-ttu-id="ae015-137">Die [**ishellpropsheetext:: replacepage**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-replacepage) -Methode wird nicht verwendet.</span><span class="sxs-lookup"><span data-stu-id="ae015-137">The [**IShellPropSheetExt::ReplacePage**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-replacepage) method is not used.</span></span>

## <a name="passing-the-extension-object-to-the-property-page"></a><span data-ttu-id="ae015-138">Übergeben des Erweiterungs Objekts an die Eigenschaften Seite</span><span class="sxs-lookup"><span data-stu-id="ae015-138">Passing the Extension Object to the Property Page</span></span>

<span data-ttu-id="ae015-139">Das Erweiterungs Objekt des Eigenschaften Blatts ist unabhängig von der Eigenschaften Seite.</span><span class="sxs-lookup"><span data-stu-id="ae015-139">The property sheet extension object is independent from the property page.</span></span> <span data-ttu-id="ae015-140">In vielen Fällen ist es wünschenswert, das Erweiterungs Objekt oder ein anderes Objekt auf der Eigenschaften Seite zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="ae015-140">In many cases, it is desirable to be able to use the extension object, or some other object, from the property page.</span></span> <span data-ttu-id="ae015-141">Legen Sie hierzu den **LPARAM** -Member der [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) -Struktur auf den Objekt Zeiger fest.</span><span class="sxs-lookup"><span data-stu-id="ae015-141">To do this, set the **lParam** member of [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) structure to the object pointer.</span></span> <span data-ttu-id="ae015-142">Die Eigenschaften Seite kann diesen Wert dann abrufen, wenn die [**WM- \_ InitDialog**](../dlgbox/wm-initdialog.md) -Nachricht verarbeitet wird.</span><span class="sxs-lookup"><span data-stu-id="ae015-142">The property page can then retrieve this value when it processes the [**WM\_INITDIALOG**](../dlgbox/wm-initdialog.md) message.</span></span> <span data-ttu-id="ae015-143">Für eine Eigenschaften Seite ist der *LPARAM* -Parameter der **WM- \_ InitDialog** -Nachricht ein Zeiger auf die **PROPSHEETPAGE** -Struktur.</span><span class="sxs-lookup"><span data-stu-id="ae015-143">For a property page, the *lParam* parameter of the **WM\_INITDIALOG** message is a pointer to the **PROPSHEETPAGE** structure.</span></span> <span data-ttu-id="ae015-144">Rufen Sie den Objekt Zeiger ab, indem Sie den *LPARAM* der **WM- \_ InitDialog** -Nachricht in einen **PROPSHEETPAGE** -Zeiger umwandeln und dann den **LPARAM** -Member der **PROPSHEETPAGE** -Struktur abrufen.</span><span class="sxs-lookup"><span data-stu-id="ae015-144">Retrieve the object pointer by casting the *lParam* of the **WM\_INITDIALOG** message to a **PROPSHEETPAGE** pointer and then retrieving the **lParam** member of the **PROPSHEETPAGE** structure.</span></span>

<span data-ttu-id="ae015-145">Im folgenden C++-Codebeispiel wird gezeigt, wie ein-Objekt an eine Eigenschaften Seite übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="ae015-145">The following C++ code example shows how to pass an object to a property page.</span></span>


```C++
case WM_INITDIALOG:
    {
        LPPROPSHEETPAGE pPage = (LPPROPSHEETPAGE)lParam;

        if(NULL != pPage)
        {
            CPropSheetExt *pPropSheetExt;
            pPropSheetExt = (CPropSheetExt*)pPage->lParam;

            if(pPropSheetExt)
            {
                return pPropSheetExt>OnInitDialog(wParam, lParam);
            }
        }
    }
    break;
```



<span data-ttu-id="ae015-146">Beachten Sie, dass das Eigenschaften Blatt nach dem Aufrufen von [**ishellpropsheetext:: addPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) das Erweiterungs Objekt des Eigenschaften Blatts freigibt und es nie erneut verwendet.</span><span class="sxs-lookup"><span data-stu-id="ae015-146">Be aware that after [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) is called, the property sheet will release the property sheet extension object and never use it again.</span></span> <span data-ttu-id="ae015-147">Dies bedeutet, dass das Erweiterungs Objekt gelöscht wird, bevor die Eigenschaften Seite angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="ae015-147">This means that the extension object would be deleted before the property page is displayed.</span></span> <span data-ttu-id="ae015-148">Wenn die Seite versucht, auf den Objekt Zeiger zuzugreifen, wird der Arbeitsspeicher freigegeben, und der Zeiger ist nicht gültig.</span><span class="sxs-lookup"><span data-stu-id="ae015-148">When the page attempts to access the object pointer, the memory will have been freed and the pointer will not be valid.</span></span> <span data-ttu-id="ae015-149">Um dies zu korrigieren, erhöhen Sie den Verweis Zähler für das Erweiterungs Objekt, wenn die Seite hinzugefügt wird, und geben Sie dann das Objekt frei, wenn das Dialogfeld der Eigenschaften Seite zerstört wird.</span><span class="sxs-lookup"><span data-stu-id="ae015-149">To correct this, increment the reference count for the extension object when the page is added and then release the object when the property page dialog is destroyed.</span></span> <span data-ttu-id="ae015-150">Dadurch entsteht ein weiteres Problem, da das Dialogfeld Eigenschaften Seite erst erstellt wird, wenn die Seite zum ersten Mal angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="ae015-150">This creates another issue because the property page dialog box is not created until the first time the page is displayed.</span></span> <span data-ttu-id="ae015-151">Wenn der Benutzer nie die Erweiterungs Seite auswählt, wird die Seite niemals erstellt und zerstört.</span><span class="sxs-lookup"><span data-stu-id="ae015-151">If the user never selects the extension page, the page never gets created and destroyed.</span></span> <span data-ttu-id="ae015-152">Dies führt dazu, dass das Erweiterungs Objekt nie freigegeben wird, sodass ein Speicherfehler auftritt.</span><span class="sxs-lookup"><span data-stu-id="ae015-152">This results in the extension object never getting released, so a memory leak occurs.</span></span> <span data-ttu-id="ae015-153">Um dies zu vermeiden, implementieren Sie eine Eigenschaften Seiten-Rückruffunktion.</span><span class="sxs-lookup"><span data-stu-id="ae015-153">To avoid this, implement a property page callback function.</span></span> <span data-ttu-id="ae015-154">Fügen Sie zu diesem Zweck dem **dwFlags** -Member der [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) -Struktur das Flag " **PSP \_ usecallback** " hinzu, und legen Sie den **pfncallback** -Member der **PROPSHEETPAGE** -Struktur auf die Adresse der implementierten [**PropSheetPageProc**](/windows/win32/api/prsht/nc-prsht-lpfnpspcallbacka) -Funktion fest.</span><span class="sxs-lookup"><span data-stu-id="ae015-154">To do this, add the **PSP\_USECALLBACK** flag to the **dwFlags** member of the [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) structure and set the **pfnCallback** member of the **PROPSHEETPAGE** structure to the address of the [**PropSheetPageProc**](/windows/win32/api/prsht/nc-prsht-lpfnpspcallbacka) function implemented.</span></span> <span data-ttu-id="ae015-155">Wenn die **PropSheetPageProc** -Funktion die **pspcb- \_ releasebenachrichtigung** empfängt, enthält der *PPSP* -Parameter von **PropSheetPageProc** einen Zeiger auf die **PROPSHEETPAGE** -Struktur.</span><span class="sxs-lookup"><span data-stu-id="ae015-155">When the **PropSheetPageProc** function receives the **PSPCB\_RELEASE** notification, the *ppsp* parameter of the **PropSheetPageProc** contains a pointer to the **PROPSHEETPAGE** structure.</span></span> <span data-ttu-id="ae015-156">Der **LPARAM** -Member der **PROPSHEETPAGE** -Struktur enthält den Erweiterungs Zeiger, der zum Freigeben des Objekts verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="ae015-156">The **lParam** member of the **PROPSHEETPAGE** structure contains the extension pointer which can be used to release the object.</span></span>

<span data-ttu-id="ae015-157">Im folgenden C++-Codebeispiel wird gezeigt, wie ein Erweiterungs Objekt freigegeben wird.</span><span class="sxs-lookup"><span data-stu-id="ae015-157">The following C++ code example shows how to release an extension object.</span></span>


```C++
UINT CALLBACK CPropSheetExt::PageCallbackProc(  HWND hWnd,
                                                UINT uMsg,
                                                LPPROPSHEETPAGE ppsp)
{
    switch(uMsg)
    {
    case PSPCB_CREATE:
        // Must return TRUE to enable the page to be created.
        return TRUE;

    case PSPCB_RELEASE:
        {
            /*
            Release the object. This is called even if the page dialog box was 
            never actually created.
            */
            CPropSheetExt *pPropSheetExt = (CPropSheetExt*)ppsp->lParam;

            if(pPropSheetExt)
            {
                pPropSheetExt->Release();
            }
        }
        break;
    }

    return FALSE;
}
```



## <a name="working-with-the-notification-object"></a><span data-ttu-id="ae015-158">Arbeiten mit dem Benachrichtigungs Objekt</span><span class="sxs-lookup"><span data-stu-id="ae015-158">Working With the Notification Object</span></span>

<span data-ttu-id="ae015-159">Da die Erweiterungs Seiten der Eigenschaften Seite in einem Eigenschaften Blatt angezeigt werden, das von einer für die Erweiterung unbekannten Komponente erstellt wurde, ist es erforderlich, einen "Manager" zu verwenden, um die Datenübertragung zwischen den Erweiterungs Seiten und dem Eigenschaften Blatt zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="ae015-159">Because the property sheet extension pages are displayed within a property sheet created by a component unknown to the extension, it is necessary to use a "manager" to handle the data transfer between the extension pages and the property sheet.</span></span> <span data-ttu-id="ae015-160">Dieser "Manager" wird als Benachrichtigungs Objekt bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="ae015-160">This "manager" is called the notification object.</span></span> <span data-ttu-id="ae015-161">Das Benachrichtigungs Objekt fungiert als Moderator zwischen den einzelnen Seiten und dem Eigenschaften Blatt.</span><span class="sxs-lookup"><span data-stu-id="ae015-161">The notification object operates as a moderator between the individual pages and the property sheet.</span></span>

<span data-ttu-id="ae015-162">Wenn das Eigenschafts Blatt-Erweiterungs Objekt initialisiert wird, muss die Erweiterung ein Benachrichtigungs Objekt durch Aufrufen von [**adspropcreatenotifyobj**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcreatenotifyobj)erstellen, wobei das [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) -Objekt, das von [**ishellextinit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) abgerufen wurde, und der Name des Verzeichnis Objekts übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="ae015-162">When the property sheet extension object is initialized, the extension must create a notification object by calling [**ADsPropCreateNotifyObj**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcreatenotifyobj), passing the [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) obtained from [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) and the directory object name.</span></span> <span data-ttu-id="ae015-163">Der Verweis Zähler der **IDataObject** -Schnittstelle muss nicht erhöht werden, da das Benachrichtigungs Objekt, das von der **adspropkreatenotifyobj** -Funktion erstellt wird, dies tut.</span><span class="sxs-lookup"><span data-stu-id="ae015-163">It is not necessary to increment the reference count of the **IDataObject** interface, because the notification object created by **ADsPropCreateNotifyObj** function will do this.</span></span> <span data-ttu-id="ae015-164">Das von **adspropkreatenotifyobj** bereitgestellte Benachrichtigungs Objekt Handle sollte für die spätere Verwendung gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="ae015-164">The notification object handle provided by **ADsPropCreateNotifyObj** should be saved for later use.</span></span> <span data-ttu-id="ae015-165">**Adspropkreatenotifyobj** kann entweder während **ishellextinit:: Initialize** oder [**ishellpropsheetext:: addPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages)aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="ae015-165">**ADsPropCreateNotifyObj** can be either called during **IShellExtInit::Initialize** or [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages).</span></span> <span data-ttu-id="ae015-166">Wenn die Eigenschaften Blatt Erweiterung heruntergefahren wird, muss Sie eine WM-Benachrichtigung zum [**\_ \_ Benachrichtigen \_**](wm-adsprop-notify-exit.md) der Nachricht an das Benachrichtigungs Objekt senden.</span><span class="sxs-lookup"><span data-stu-id="ae015-166">When the property sheet extension is shut down, it must send a [**WM\_ADSPROP\_NOTIFY\_EXIT**](wm-adsprop-notify-exit.md) message to the notification object.</span></span> <span data-ttu-id="ae015-167">Dies bewirkt, dass sich das Benachrichtigungs Objekt selbst zerstört.</span><span class="sxs-lookup"><span data-stu-id="ae015-167">This causes the notification object to destroy itself.</span></span> <span data-ttu-id="ae015-168">Dies wird am besten erreicht, wenn die [**PropSheetPageProc**](/windows/win32/api/prsht/nc-prsht-lpfnpspcallbacka) -Funktion die **pspcb- \_ releasebenachrichtigung** empfängt.</span><span class="sxs-lookup"><span data-stu-id="ae015-168">This is best done when the [**PropSheetPageProc**](/windows/win32/api/prsht/nc-prsht-lpfnpspcallbacka) function receives the **PSPCB\_RELEASE** notification.</span></span>

<span data-ttu-id="ae015-169">Durch Aufrufen von [**adspropgetinitinfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo)kann die Erweiterung des Eigenschaften Blatts zusätzlich zu den vom [**cfstr \_ dsobjectnames**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) -Zwischenablage Format bereitgestellten Daten abrufen.</span><span class="sxs-lookup"><span data-stu-id="ae015-169">The property sheet extension can obtain data in addition to that provided by the [**CFSTR\_DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) clipboard format by calling [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo).</span></span> <span data-ttu-id="ae015-170">Einer der Vorteile der Verwendung von **adspropgetinitinfo** besteht darin, dass ein [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) -Objekt bereitgestellt wird, das für die programmgesteuerte Arbeit mit dem Directory-Objekt verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="ae015-170">One of the advantages of using **ADsPropGetInitInfo** is that it provides an [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) object used to programmatically work with the directory object.</span></span>

> [!Note]  
> <span data-ttu-id="ae015-171">Im Gegensatz zu den meisten com-Methoden und-Funktionen erhöht [**adspropgetinitinfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo) den Verweis Zähler für das [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) -Objekt nicht.</span><span class="sxs-lookup"><span data-stu-id="ae015-171">Unlike most COM methods and functions, [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo) does not increment the reference count for the [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) object.</span></span> <span data-ttu-id="ae015-172">Das **IDirectoryObject** darf nicht freigegeben werden, es sei denn, der Verweis Zähler wird zuerst manuell inkrementiert.</span><span class="sxs-lookup"><span data-stu-id="ae015-172">The **IDirectoryObject** must not be released unless the reference count is manually incremented first.</span></span>

 

<span data-ttu-id="ae015-173">Wenn die Eigenschaften Seite erstmalig erstellt wird, muss die Erweiterung die Seite beim Benachrichtigungs Objekt registrieren, indem [**adspropsethwnd**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwnd) mit dem Fenster Handle der Seite aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="ae015-173">When the property page is first created, the extension should register the page with the notification object by calling [**ADsPropSetHwnd**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwnd) with the window handle of the page.</span></span>

<span data-ttu-id="ae015-174">[**Adspropcheckifbeschreib Table**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcheckifwritable) ist eine Utility-Funktion, die die Eigenschaften Blatt Erweiterung verwenden kann, um zu bestimmen, ob eine Eigenschaft geschrieben werden kann.</span><span class="sxs-lookup"><span data-stu-id="ae015-174">[**ADsPropCheckIfWritable**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcheckifwritable) is a utility function that the property sheet extension can use to determine if a property can be written.</span></span>

## <a name="miscellaneous"></a><span data-ttu-id="ae015-175">Verschiedenes</span><span class="sxs-lookup"><span data-stu-id="ae015-175">Miscellaneous</span></span>

<span data-ttu-id="ae015-176">Das Handle der Eigenschaften Seite wird an die Dialogfeld Seite der Seite übermittelt.</span><span class="sxs-lookup"><span data-stu-id="ae015-176">The handle of the property page is passed to the page dialog box procedure.</span></span> <span data-ttu-id="ae015-177">Das Eigenschaften Blatt ist das direkt übergeordnete Element der Eigenschaften Seite, sodass das Handle des Eigenschaften Blatts durch Aufrufen der [**GetParent**](/windows/win32/api/winuser/nf-winuser-getparent) -Funktion mit dem Eigenschaften Seiten Handle abgerufen werden kann.</span><span class="sxs-lookup"><span data-stu-id="ae015-177">The property sheet is the direct parent of the property page, so the handle of the property sheet can be obtained by calling the [**GetParent**](/windows/win32/api/winuser/nf-winuser-getparent) function with the property page handle.</span></span>

<span data-ttu-id="ae015-178">Wenn sich der Inhalt der Erweiterungs Seite ändert, sollte in der Erweiterung das [**propsheet \_**](/windows/win32/api/prsht/nf-prsht-propsheet_changed) -Makro geändert verwendet werden, um das Eigenschaften Blatt über Änderungen zu benachrichtigen.</span><span class="sxs-lookup"><span data-stu-id="ae015-178">When the contents of the extension page changes, the extension should use the [**PropSheet\_Changed**](/windows/win32/api/prsht/nf-prsht-propsheet_changed) macro to notify the property sheet of changes.</span></span> <span data-ttu-id="ae015-179">Auf dem Eigenschaften Blatt wird dann die Schaltfläche anwenden aktiviert.</span><span class="sxs-lookup"><span data-stu-id="ae015-179">The property sheet will then enable the Apply button.</span></span>

## <a name="multiple-selection-property-sheets"></a><span data-ttu-id="ae015-180">Eigenschaften Blätter Multiple-Selection</span><span class="sxs-lookup"><span data-stu-id="ae015-180">Multiple-Selection Property Sheets</span></span>

<span data-ttu-id="ae015-181">Mit den Betriebssystemen Windows Server 2003 und höher unterstützen die Active Directory-Verwaltungs-MMC-Snap-Ins Eigenschaften Blatt Erweiterungen für mehrere Verzeichnisobjekte.</span><span class="sxs-lookup"><span data-stu-id="ae015-181">With Windows Server 2003 and later operating systems, the Active Directory administrative MMC snap-ins support property sheet extensions for multiple directory objects.</span></span> <span data-ttu-id="ae015-182">Diese Eigenschaften Blätter werden angezeigt, wenn die Eigenschaften für mehr als ein Element gleichzeitig angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="ae015-182">These property sheets are displayed when the properties are viewed for more than one item at a time.</span></span> <span data-ttu-id="ae015-183">Der Hauptunterschied zwischen einer Erweiterung für ein Einzel Auswahl-Eigenschafts Blatt und einer Erweiterung für eine Eigenschaften Seite mit mehreren Auswahl besteht darin, dass die [**dsobjectnames**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) -Struktur, die vom [**cfstr \_ dsobjectnames**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) -Zwischenablage Format in [**ishellextinit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) bereitgestellt wird, mehr als eine [**dsobject**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) -Struktur enthält.</span><span class="sxs-lookup"><span data-stu-id="ae015-183">The primary difference between a single-selection property sheet extension and a multiple-selection property sheet extension is that the [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) structure supplied by the [**CFSTR\_DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) clipboard format in [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) will contain more than one [**DSOBJECT**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) structure.</span></span>

<span data-ttu-id="ae015-184">Wenn das Benachrichtigungs Objekt erstellt wird, muss eine Mehrfachauswahl-Eigenschaften Blatt Erweiterung anstelle eines von der Erweiterung erstellten Namens einen eindeutigen Namen übergeben, der vom Snap-in bereitgestellt wird.</span><span class="sxs-lookup"><span data-stu-id="ae015-184">When the notification object is created, a multi-selection property sheet extension must pass a unique name that is provided by the snap-in rather than a name created by the extension.</span></span> <span data-ttu-id="ae015-185">Um den eindeutigen Namen abzurufen, fordern Sie das [**cfstr \_ DS \_ multiselectproppage**](cfstr-ds-multiselectproppage.md) -Zwischenablage Format aus dem [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) an, das von [**ishellextinit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize)abgerufen wurde.</span><span class="sxs-lookup"><span data-stu-id="ae015-185">To obtain the unique name, request the [**CFSTR\_DS\_MULTISELECTPROPPAGE**](cfstr-ds-multiselectproppage.md) clipboard format from the [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) obtained from [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize).</span></span> <span data-ttu-id="ae015-186">Diese Daten sind ein **HGLOBAL** , das eine mit NULL endenden Unicode-Zeichenfolge enthält, die der eindeutige Name ist.</span><span class="sxs-lookup"><span data-stu-id="ae015-186">This data is an **HGLOBAL** that contains a null-terminated Unicode string that is the unique name.</span></span> <span data-ttu-id="ae015-187">Dieser eindeutige Name wird dann an die [**adspropkreatenotifyobj**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcreatenotifyobj) -Funktion übergeben, um das Benachrichtigungs Objekt zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="ae015-187">This unique name is then passed to the [**ADsPropCreateNotifyObj**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcreatenotifyobj) function to create the notification object.</span></span> <span data-ttu-id="ae015-188">Die Beispiel Funktion " **comateadsnotificationobject** " im [Beispiel Code für die Implementierung des Eigenschaften Blatt-com-Objekts](example-code-for-implementation-of-the-property-sheet-com-object.md) veranschaulicht, wie dies ordnungsgemäß funktioniert, und dass mit früheren Versionen des Snap-ins kompatibel ist, die keine Eigenschaften Blätter für Mehrfachauswahl unterstützen.</span><span class="sxs-lookup"><span data-stu-id="ae015-188">The **CreateADsNotificationObject** example function in [Example Code for Implementation of the Property Sheet COM Object](example-code-for-implementation-of-the-property-sheet-com-object.md) demonstrates how to do this correctly, as well as being compatible with earlier versions of the snap-in that do not support multi-selection property sheets.</span></span>

<span data-ttu-id="ae015-189">Bei Mehrfachauswahl-Eigenschaften Blättern wird das System nur an das erste Objekt im [**dsobject**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) -Array gebunden.</span><span class="sxs-lookup"><span data-stu-id="ae015-189">For multiple-selection property sheets, the system only binds to the first object in the [**DSOBJECT**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) array.</span></span> <span data-ttu-id="ae015-190">Aus diesem Grund liefert [**adspropgetinitinfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo) nur das [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) -Attribut und das Write-able-Attribut für das erste Objekt im Array.</span><span class="sxs-lookup"><span data-stu-id="ae015-190">Because of this, [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo) only supplies the [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) and write-able attributes for the first object in the array.</span></span> <span data-ttu-id="ae015-191">Die anderen Objekte im Array sind nicht an gebunden.</span><span class="sxs-lookup"><span data-stu-id="ae015-191">The other objects in the array are not bound to.</span></span>

<span data-ttu-id="ae015-192">Eine Mehrfachauswahl-Eigenschaften Blatt Erweiterung wird unter dem [**adminmultiselectpropertypages**](/windows/desktop/ADSchema/a-adminmultiselectpropertypages) -Attribut registriert.</span><span class="sxs-lookup"><span data-stu-id="ae015-192">A multiple-selection property sheet extension is registered under the [**adminMultiselectPropertyPages**](/windows/desktop/ADSchema/a-adminmultiselectpropertypages) attribute.</span></span>

## <a name="new-with-windows-server-2003"></a><span data-ttu-id="ae015-193">Neu in Windows Server 2003</span><span class="sxs-lookup"><span data-stu-id="ae015-193">New with Windows Server 2003</span></span>

<span data-ttu-id="ae015-194">Die folgenden Features sind neu in Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="ae015-194">The following features are new with Windows Server 2003.</span></span>

<span data-ttu-id="ae015-195">Wenn auf der Eigenschaften Seite ein Fehler auftritt, kann [**adspropsenderrormessage**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsenderrormessage) mit den entsprechenden Fehler Daten aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="ae015-195">If the property page encounters an error, [**ADsPropSendErrorMessage**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsenderrormessage) can be called with the appropriate error data.</span></span> <span data-ttu-id="ae015-196">**Adspropsenderrormessage** speichert alle Fehlermeldungen in einer Warteschlange.</span><span class="sxs-lookup"><span data-stu-id="ae015-196">**ADsPropSendErrorMessage** will store all error messages in a queue.</span></span> <span data-ttu-id="ae015-197">Diese Meldungen werden angezeigt, wenn [**adspropshowerrordialog**](/windows/desktop/api/Adsprop/nf-adsprop-adspropshowerrordialog) das nächste Mal aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="ae015-197">These messages will be displayed the next time [**ADsPropShowErrorDialog**](/windows/desktop/api/Adsprop/nf-adsprop-adspropshowerrordialog) is called.</span></span> <span data-ttu-id="ae015-198">Wenn **adspropshowerrordialog** zurückgibt, werden die Nachrichten in der Warteschlange gelöscht.</span><span class="sxs-lookup"><span data-stu-id="ae015-198">When **ADsPropShowErrorDialog** returns, the queued messages are deleted.</span></span>

<span data-ttu-id="ae015-199">In Windows Server 2003 wird die Funktion " [**adspropabthwndwithtitle**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwndwithtitle) " eingeführt.</span><span class="sxs-lookup"><span data-stu-id="ae015-199">Windows Server 2003 introduces the [**ADsPropSetHwndWithTitle**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwndwithtitle) function.</span></span> <span data-ttu-id="ae015-200">Diese Funktion ähnelt [**adspropsetup**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwnd), enthält jedoch den Seitentitel.</span><span class="sxs-lookup"><span data-stu-id="ae015-200">This function is similar to [**ADsPropSetHwnd**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwnd), but includes the page title.</span></span> <span data-ttu-id="ae015-201">Dadurch kann das von [**adspropshowerrordialog**](/windows/desktop/api/Adsprop/nf-adsprop-adspropshowerrordialog) angezeigte Fehler Dialogfeld nützlichere Daten für den Benutzer bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="ae015-201">This enables the error dialog box displayed by [**ADsPropShowErrorDialog**](/windows/desktop/api/Adsprop/nf-adsprop-adspropshowerrordialog) to provide more useful data to the user.</span></span> <span data-ttu-id="ae015-202">Wenn die Eigenschaften Blatt Erweiterung die **adspropshowerrordialog** -Funktion verwendet, sollte die Erweiterung anstelle von **adsproppinthwnd** **adspropabthwndwithtitle** verwenden.</span><span class="sxs-lookup"><span data-stu-id="ae015-202">If the property sheet extension uses the **ADsPropShowErrorDialog** function, the extension should use **ADsPropSetHwndWithTitle** rather than **ADsPropSetHwnd**.</span></span>

## <a name="related-topics"></a><span data-ttu-id="ae015-203">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="ae015-203">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="ae015-204">Beispiel Code für die Implementierung des Eigenschaften Blatts-com-Objekts</span><span class="sxs-lookup"><span data-stu-id="ae015-204">Example Code for Implementation of the Property Sheet COM Object</span></span>](example-code-for-implementation-of-the-property-sheet-com-object.md)
</dt> </dl>

 

 