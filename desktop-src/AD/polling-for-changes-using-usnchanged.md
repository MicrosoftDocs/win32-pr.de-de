---
title: Abrufen von Änderungen mithilfe von ""
description: Änderungen von Active Directory können auch durch Abfragen des Attributs "Attribut" abgerufen werden, wodurch die Einschränkungen des Dirsync-Steuer Elements vermieden werden.
ms.assetid: 83bda359-09e5-4abf-8f60-9c63bccfcdd1
ms.tgt_platform: multiple
keywords:
- Abrufen von Änderungen mithilfe von "US-Changed AD"
- Über geändertes AD
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a8e062c84fae575f837f45d78be7c92e5e284c1e
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/17/2020
ms.locfileid: "103858132"
---
# <a name="polling-for-changes-using-usnchanged"></a><span data-ttu-id="b537b-105">Abrufen von Änderungen mithilfe von ""</span><span class="sxs-lookup"><span data-stu-id="b537b-105">Polling for Changes Using USNChanged</span></span>

<span data-ttu-id="b537b-106">Das DirSync-Steuerelement ist leistungsfähig und effizient, hat jedoch zwei bedeutende Einschränkungen:</span><span class="sxs-lookup"><span data-stu-id="b537b-106">The DirSync control is powerful and efficient, but has two significant limitations:</span></span>

-   <span data-ttu-id="b537b-107">Nur für Anwendungen mit hohen Berechtigungen: um das DirSync-Steuerelement zu verwenden, muss eine Anwendung unter einem Konto ausgeführt werden, das über die Berechtigung " **SE \_ Sync \_ Agent \_ Name** " auf dem Domänen Controller verfügt.</span><span class="sxs-lookup"><span data-stu-id="b537b-107">Only for highly privileged applications: To use the DirSync control, an application must run under an account that has the **SE\_SYNC\_AGENT\_NAME** privilege on the domain controller.</span></span> <span data-ttu-id="b537b-108">Wenige Konten sind so stark privilegiert, sodass eine Anwendung, die das DirSync-Steuerelement verwendet, nicht von normalen Benutzern ausgeführt werden kann.</span><span class="sxs-lookup"><span data-stu-id="b537b-108">Few accounts are so highly privileged, so an application that uses the DirSync control cannot be run by ordinary users.</span></span>
-   <span data-ttu-id="b537b-109">Keine Unterstruktur Bereich: das DirSync-Steuerelement gibt alle Änderungen zurück, die innerhalb eines Namens Kontexts auftreten.</span><span class="sxs-lookup"><span data-stu-id="b537b-109">No subtree scoping: The DirSync control returns all changes that occur within a naming context.</span></span> <span data-ttu-id="b537b-110">Eine Anwendung, die nur an Änderungen interessiert ist, die in einer kleinen Teilstruktur eines Namens Kontexts auftreten, muss viele irrelevante Änderungen durchlaufen, was sowohl für die Anwendung als auch für den Domänen Controller ineffizient ist.</span><span class="sxs-lookup"><span data-stu-id="b537b-110">An application interested only in changes that occur in a small subtree of a naming context must wade through many irrelevant changes, which is inefficient both for the application and for the domain controller.</span></span>

<span data-ttu-id="b537b-111">Änderungen von Active Directory können auch durch Abfragen [**des Attributs**](/windows/desktop/ADSchema/a-usnchanged) "Attribut" abgerufen werden, wodurch die Einschränkungen des Dirsync-Steuer Elements vermieden werden.</span><span class="sxs-lookup"><span data-stu-id="b537b-111">Changes from Active Directory can also be obtained by querying the [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) attribute, which avoids the limitations of the DirSync control.</span></span> <span data-ttu-id="b537b-112">Diese Alternative ist nicht besser geeignet als das DirSync-Steuerelement, da es das Übertragen aller Attribute erfordert, wenn sich ein beliebiges Attribut ändert, und es mehr Arbeit vom Anwendungsentwickler erfordert, um bestimmte Fehler Szenarios ordnungsgemäß zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="b537b-112">This alternative is not better than the DirSync control in all respects because it involves transmitting all attributes when any attribute changes and it requires more work from the application developer to handle certain failure scenarios correctly.</span></span> <span data-ttu-id="b537b-113">Derzeit ist dies die beste Möglichkeit, bestimmte Anwendungen für die Änderungs Nachverfolgung zu schreiben.</span><span class="sxs-lookup"><span data-stu-id="b537b-113">It is, currently, the best way to write certain change-tracking applications.</span></span>

<span data-ttu-id="b537b-114">Wenn ein Objekt von einem Domänen [**Controller geändert wird**](/windows/desktop/ADSchema/a-usnchanged) , wird das Attribut "-Attribut" für dieses Objekt auf einen Wert festgelegt, der größer ist als der vorherige Wert des Attributs "Attribut" für dieses Objekt und größer als der aktuelle Wert **des Attributs** **"Attribut"** für alle anderen auf diesem Domänen Controller gespeicherten Objekte.</span><span class="sxs-lookup"><span data-stu-id="b537b-114">When a domain controller modifies an object it sets that object's [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) attribute to a value that is larger than the previous value of the **uSNChanged** attribute for that object, and larger than the current value of the **uSNChanged** attribute for all other objects held on that domain controller.</span></span> <span data-ttu-id="b537b-115">Folglich kann eine Anwendung das zuletzt geänderte Objekt auf einem Domänen Controller suchen, indem Sie das-Objekt mit dem **größten Wert von** "von der Größe" gefunden hat.</span><span class="sxs-lookup"><span data-stu-id="b537b-115">As a consequence, an application can find the most recently changed object on a domain controller by finding the object with the largest **uSNChanged** value.</span></span> <span data-ttu-id="b537b-116">Das zweite zuletzt geänderte Objekt auf einem Domänen Controller verfügt über den **zweitgrößten Wert** für "Wert", usw.</span><span class="sxs-lookup"><span data-stu-id="b537b-116">The second most recently changed object on a domain controller will have the second largest **uSNChanged** value, and so on.</span></span>

<span data-ttu-id="b537b-117">Das Attribut [**"Attribut"**](/windows/desktop/ADSchema/a-usnchanged) wird nicht repliziert, daher werden in der Regel unterschiedliche Werte durch das Lesen des Attributs " **" von "** " für ein Objekt auf zwei verschiedenen Domänen Controllern</span><span class="sxs-lookup"><span data-stu-id="b537b-117">The [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) attribute is not replicated, therefore reading an object's **uSNChanged** attribute at two different domain controllers will typically give different values.</span></span>

<span data-ttu-id="b537b-118">So kann z. b [**. das Attribut**](/windows/desktop/ADSchema/a-usnchanged) "-Attribut" verwendet werden, um Änderungen in einer Teilstruktur zu verfolgen. Führen Sie zunächst eine "vollständige Synchronisierung" der Teilstruktur "s" aus. angenommen, **der größte Wert** für "Wert" für ein Objekt in S ist U. führen Sie in Regel  mäßigen Abständen Abfragen für alle Objekte in der Teilstruktur aus Die Abfrage gibt alle Objekte zurück, die seit der vollständigen Synchronisierung geändert wurden. Legen Sie auf die größte **Änderung** der geänderten Objekte fest, und wiederholen Sie den Abruf Vorgang.</span><span class="sxs-lookup"><span data-stu-id="b537b-118">For example, the [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) attribute can be used to track changes in a subtree S. First, perform a "full sync" of the subtree S. Suppose the largest **uSNChanged** value for any object in S is U. Periodically query for all objects in subtree S whose **uSNChanged** value is greater than U. The query will return all objects that have changed since the full sync. Set U to the largest **uSNChanged** among these changed objects, and you are ready to poll again.</span></span>

<span data-ttu-id="b537b-119">Die folgenden Feinheiten der Implementierung einer Anwendungs [**geänderten**](/windows/desktop/ADSchema/a-usnchanged) Synchronisierungs Anwendung sind:</span><span class="sxs-lookup"><span data-stu-id="b537b-119">The subtleties of implementing a [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) synchronization application include:</span></span>

-   <span data-ttu-id="b537b-120">Verwenden Sie das **highestCommittedUSN** -Attribut von RootDSE, um die von der Anwendung [**geänderten**](/windows/desktop/ADSchema/a-usnchanged) Filter zu binden.</span><span class="sxs-lookup"><span data-stu-id="b537b-120">Use the **highestCommittedUSN** attribute of rootDSE to bound your [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) filters.</span></span> <span data-ttu-id="b537b-121">Das heißt, bevor Sie eine vollständige Synchronisierung starten, lesen Sie die **highestCommittedUSN** Ihres zugehörigen Domänen Controllers.</span><span class="sxs-lookup"><span data-stu-id="b537b-121">That is, before starting a full sync, read the **highestCommittedUSN** of your affiliated domain controller.</span></span> <span data-ttu-id="b537b-122">Führen Sie dann eine vollständige Synchronisierungs Abfrage (mithilfe von Auslagerungs Ergebnissen) aus, um die Datenbank zu initialisieren.</span><span class="sxs-lookup"><span data-stu-id="b537b-122">Then, perform a full synchronization query (using paged results) to initialize the database.</span></span> <span data-ttu-id="b537b-123">Speichern Sie nach Abschluss des Vorgangs den Wert **highestCommittedUSN** , der vor der vollständigen Synchronisierungs Abfrage gelesen wurde. , wenn für die nächste Synchronisierung als untere Grenze **des Attributs** "-Attribut" verwendet werden soll.</span><span class="sxs-lookup"><span data-stu-id="b537b-123">When this is complete, store the **highestCommittedUSN** value read before the full sync query; to use as the lower bounds of the **uSNChanged** attribute for the next synchronization.</span></span> <span data-ttu-id="b537b-124">Um später eine inkrementelle Synchronisierung durchzuführen, müssen Sie das rootDSE-Attribut **highestCommittedUSN** erneut registrieren.</span><span class="sxs-lookup"><span data-stu-id="b537b-124">Later, to perform an incremental synchronization, reread the **highestCommittedUSN** rootDSE attribute.</span></span> <span data-ttu-id="b537b-125">Fragen Sie dann relevante Objekte ab, indem Sie auslagerbare Ergebnisse verwenden, deren " **enchanged** " größer ist als die Untergrenze des von der vorherigen Synchronisierung **gespeicherten Attributs** von "Wert".</span><span class="sxs-lookup"><span data-stu-id="b537b-125">Then query for relevant objects, using paged results, whose **uSNChanged** is greater than the lower bounds of the **uSNChanged** attribute value saved from the previous synchronization.</span></span> <span data-ttu-id="b537b-126">Aktualisieren Sie die Datenbank mit diesen Informationen.</span><span class="sxs-lookup"><span data-stu-id="b537b-126">Update the database using this information.</span></span> <span data-ttu-id="b537b-127">Aktualisieren Sie nach Abschluss des Vorgangs die unteren Begrenzungen **des Attributs** "" von " **highestCommittedUSN** ", die vor der inkrementellen Synchronisierungs Abfrage gelesen wurden.</span><span class="sxs-lookup"><span data-stu-id="b537b-127">When complete, update the lower bounds of the **uSNChanged** attribute from the **highestCommittedUSN** value read before the incremental synchronization query.</span></span> <span data-ttu-id="b537b-128">Speichern Sie immer die unteren Begrenzungen des Werts für den Wert **des Attributs** in demselben Speicher, den die Anwendung mit dem Domänen Controller Inhalt synchronisiert.</span><span class="sxs-lookup"><span data-stu-id="b537b-128">Always store the lower bounds of the **uSNChanged** attribute value in the same storage that the application is synchronizing with the domain controller content.</span></span>

    <span data-ttu-id="b537b-129">Wenn Sie diese Prozedur befolgen, anstatt Sie basierend auf den von der Anwendung [**geänderten**](/windows/desktop/ADSchema/a-usnchanged) Werten für abgerufene Objekte zu überprüfen, wird verhindert, dass der Server aktualisierte Objekte erneut untersucht, die außerhalb des für die Anwendung anwendbaren Satzes liegen.</span><span class="sxs-lookup"><span data-stu-id="b537b-129">Following this procedure, rather than that based on [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) values on retrieved objects, avoids making the server reexamine updated objects that fall outside the set that is applicable to the application.</span></span>

-   <span data-ttu-id="b537b-130">Da es sich bei " [**US Changed**](/windows/desktop/ADSchema/a-usnchanged) " um ein nicht repliziertes Attribut handelt, muss die Anwendung bei jeder Ausführung eine Bindung an denselben Domänen Controller herstellen.</span><span class="sxs-lookup"><span data-stu-id="b537b-130">Because [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) is a non-replicated attribute, the application must bind to the same domain controller every time it runs.</span></span> <span data-ttu-id="b537b-131">Wenn eine Bindung an diesen Domänen Controller nicht möglich ist, muss er entweder warten, bis dies möglich ist, oder einem neuen Domänen Controller zuordnen und eine vollständige Synchronisierung mit diesem Domänen Controller durchführen.</span><span class="sxs-lookup"><span data-stu-id="b537b-131">If it cannot bind to that domain controller it must either wait until it can do so, or affiliate with some new domain controller and perform a full synchronization with that domain controller.</span></span> <span data-ttu-id="b537b-132">Wenn die Anwendung mit einem Domänen Controller in Betrieb ist, wird der DNS-Name des Domänen Controllers in einem stabilen Speicher aufgezeichnet, bei dem es sich um denselben Speicher handelt wie der Inhalt des Domänen Controllers.</span><span class="sxs-lookup"><span data-stu-id="b537b-132">When the application affiliates with a domain controller it records the DNS name of that domain controller in stable storage, which is the same storage it is keeping consistent with the domain controller content.</span></span> <span data-ttu-id="b537b-133">Anschließend verwendet er den gespeicherten DNS-Namen, um für nachfolgende Synchronisierung eine Bindung an denselben Domänen Controller herzustellen.</span><span class="sxs-lookup"><span data-stu-id="b537b-133">Then it uses the stored DNS name to bind to the same domain controller for subsequent synchronizations.</span></span>
-   <span data-ttu-id="b537b-134">Die Anwendung muss erkennen, wenn der Domänen Controller, dem er derzeit angehört, von der Sicherung wieder hergestellt wurde, da dies zu Inkonsistenzen führen kann.</span><span class="sxs-lookup"><span data-stu-id="b537b-134">The application must detect when the domain controller it is currently affiliated with has been restored from backup, because this can cause inconsistency.</span></span> <span data-ttu-id="b537b-135">Wenn die Anwendung mit einem Domänen Controller mit einem Domänen Controller ausgeführt wird, wird die Aufruf-ID des Domänen Controllers im stabilen Speicher zwischengespeichert, d. h. der gleiche Speicher, der dem Domänen Controller Inhalt entspricht.</span><span class="sxs-lookup"><span data-stu-id="b537b-135">When the application affiliates with a domain controller it caches the "invocation id" of that domain controller in stable storage, that is, the same storage it is keeping consistent with the domain controller content.</span></span> <span data-ttu-id="b537b-136">Die Aufruf-ID eines Domänen Controllers ist eine GUID, die im **invocationID** -Attribut des Dienst Objekts des Domänen Controllers gespeichert ist.</span><span class="sxs-lookup"><span data-stu-id="b537b-136">The "invocation id" of a domain controller is a GUID stored in the **invocationID** attribute of the domain controller's service object.</span></span> <span data-ttu-id="b537b-137">Um den Distinguished Name des Dienst Objekts eines Domänen Controllers zu erhalten, lesen Sie das Attribut **dsservicename** von RootDSE.</span><span class="sxs-lookup"><span data-stu-id="b537b-137">To get the distinguished name of a domain controller's service object, read the **dsServiceName** attribute of the rootDSE.</span></span>

    <span data-ttu-id="b537b-138">Beachten Sie, dass wenn der stabile Speicher der Anwendung aus der Sicherung wieder hergestellt wird, keine Konsistenzprobleme auftreten, da der Name des Domänen Controllers, die Aufruf-ID [**und die unteren Grenzen des Attributs**](/windows/desktop/ADSchema/a-usnchanged) "Wert des Attributs" mit den Daten gespeichert werden, die mit dem Domänen Controller Inhalt synchronisiert werden.</span><span class="sxs-lookup"><span data-stu-id="b537b-138">Be aware that when the application's stable storage is restored from backup there are no consistency problems because the domain controller name, invocation id, and lower bounds of the [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) attribute value are stored with the data synchronized with the domain controller content.</span></span>

-   <span data-ttu-id="b537b-139">Verwenden Sie Paging bei der Abfrage des Servers, sowohl vollständige als auch inkrementelle Synchronisierung, um die Möglichkeit zu vermeiden, große Resultsets gleichzeitig abzurufen.</span><span class="sxs-lookup"><span data-stu-id="b537b-139">Use paging when querying the server, both full and incremental synchronizations, to avoid the possibility of retrieving large result sets simultaneously.</span></span> <span data-ttu-id="b537b-140">Weitere Informationen finden Sie unter [Angeben anderer Suchoptionen](specifying-other-search-options.md).</span><span class="sxs-lookup"><span data-stu-id="b537b-140">For more information, see [Specifying Other Search Options](specifying-other-search-options.md).</span></span>
-   <span data-ttu-id="b537b-141">Führen Sie indexbasierte Abfragen aus, um zu vermeiden, dass der Server beim Verwenden von ausgelagerten Ergebnissen große Zwischenergebnisse speichert.</span><span class="sxs-lookup"><span data-stu-id="b537b-141">Perform index-based queries to avoid forcing the server to store large intermediate results when using paged results.</span></span> <span data-ttu-id="b537b-142">Weitere Informationen finden Sie unter [indizierte Attribute](indexed-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="b537b-142">For more information, see [Indexed Attributes](indexed-attributes.md).</span></span>
-   <span data-ttu-id="b537b-143">Verwenden Sie im Allgemeinen keine serverseitige Sortierung von Suchergebnissen, wodurch der Server große Zwischenergebnisse speichern und sortieren kann.</span><span class="sxs-lookup"><span data-stu-id="b537b-143">In general, do not use server-side sorting of search results, which can force the server to store and sort large intermediate results.</span></span> <span data-ttu-id="b537b-144">Dies gilt für vollständige und inkrementelle Synchronisierung.</span><span class="sxs-lookup"><span data-stu-id="b537b-144">This applies to both full and incremental synchronizations.</span></span> <span data-ttu-id="b537b-145">Weitere Informationen finden Sie unter [Angeben anderer Suchoptionen](specifying-other-search-options.md).</span><span class="sxs-lookup"><span data-stu-id="b537b-145">For more information, see [Specifying Other Search Options](specifying-other-search-options.md).</span></span>
-   <span data-ttu-id="b537b-146">Behandeln Sie keine übergeordneten Bedingungen ordnungsgemäß.</span><span class="sxs-lookup"><span data-stu-id="b537b-146">Handle no parent conditions gracefully.</span></span> <span data-ttu-id="b537b-147">Die Anwendung erkennt möglicherweise ein Objekt, bevor es das übergeordnete Objekt erkannt hat.</span><span class="sxs-lookup"><span data-stu-id="b537b-147">The application may recognize an object before it has recognized its parent.</span></span> <span data-ttu-id="b537b-148">Abhängig von der Anwendung ist dies möglicherweise ein Problem.</span><span class="sxs-lookup"><span data-stu-id="b537b-148">Depending upon the application, this may or may not be a problem.</span></span> <span data-ttu-id="b537b-149">Die Anwendung kann den aktuellen Status des übergeordneten Elements immer aus dem Verzeichnis lesen.</span><span class="sxs-lookup"><span data-stu-id="b537b-149">The application can always read the current state of the parent from the directory.</span></span>
-   <span data-ttu-id="b537b-150">Speichern Sie das [**objectGUID**](/windows/desktop/ADSchema/a-objectguid) -Attribut jedes überwachten Objekts, um verschockte oder gelöschte Objekte zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="b537b-150">To handle moved or deleted objects, store the [**objectGUID**](/windows/desktop/ADSchema/a-objectguid) attribute of each tracked object.</span></span> <span data-ttu-id="b537b-151">Das **objectGUID** -Attribut eines Objekts bleibt unverändert, unabhängig davon, wo es in die Gesamtstruktur verschoben wird.</span><span class="sxs-lookup"><span data-stu-id="b537b-151">An object's **objectGUID** attribute remains unchanged regardless of where it is moved throughout the forest.</span></span>
-   <span data-ttu-id="b537b-152">Um verschoderte Objekte zu verarbeiten, führen Sie entweder regelmäßige vollständige Synchronisierung durch, oder vergrößern Sie den Suchbereich, und Filtern Sie uninteressante Änderungen am Client Ende heraus.</span><span class="sxs-lookup"><span data-stu-id="b537b-152">To handle moved objects, either perform periodic full synchronizations or increase the search scope and filter out uninteresting changes at the client end.</span></span>
-   <span data-ttu-id="b537b-153">Um gelöschte Objekte zu verarbeiten, führen Sie entweder regelmäßige vollständige Synchronisierungen durch, oder führen Sie bei der inkrementellen Synchronisierung eine separate Suche nach gelöschten</span><span class="sxs-lookup"><span data-stu-id="b537b-153">To handle deleted objects, either perform periodic full synchronizations or perform a separate search for deleted objects when you perform an incremental synchronization.</span></span> <span data-ttu-id="b537b-154">Wenn Sie gelöschte Objekte Abfragen, rufen Sie die [**objectGUID**](/windows/desktop/ADSchema/a-objectguid) der gelöschten Objekte ab, um zu bestimmen, welche Objekte aus der Datenbank gelöscht werden sollen.</span><span class="sxs-lookup"><span data-stu-id="b537b-154">When you query for deleted objects, retrieve the [**objectGUID**](/windows/desktop/ADSchema/a-objectguid) of the deleted objects to determine the objects to delete from your database.</span></span> <span data-ttu-id="b537b-155">Weitere Informationen finden Sie unter [Abrufen von gelöschten Objekten](retrieving-deleted-objects.md).</span><span class="sxs-lookup"><span data-stu-id="b537b-155">For more information, see [Retrieving Deleted Objects](retrieving-deleted-objects.md).</span></span>
-   <span data-ttu-id="b537b-156">Beachten Sie, dass die Suchergebnisse nur die Objekte und Attribute enthalten, für die der Aufrufer über Leseberechtigung verfügt (basierend auf den Sicherheits Beschreibungen und den DACLs für die verschiedenen Objekte).</span><span class="sxs-lookup"><span data-stu-id="b537b-156">Be aware that the search results include only the objects and attributes that the caller has permission to read (based on the security descriptors and DACLs on the various objects).</span></span> <span data-ttu-id="b537b-157">Weitere Informationen finden Sie unter [Auswirkungen der Sicherheit bei Abfragen](effects-of-security-on-queries.md).</span><span class="sxs-lookup"><span data-stu-id="b537b-157">For more information, see [Effects of Security on Queries](effects-of-security-on-queries.md).</span></span>

<span data-ttu-id="b537b-158">Weitere Informationen und ein Codebeispiel, in dem die Grundlagen einer Anwendungs geänderten Synchronisierungs Anwendung veranschaulicht werden, finden Sie unter [Beispielcode zum Abrufen von Änderungen mithilfe von "US-nchanged](example-code-to-retrieve-changes-using-usnchanged.md)".</span><span class="sxs-lookup"><span data-stu-id="b537b-158">For more information, and a code example that shows the basics of a USNChanged synchronization application, see [Example Code to Retrieve Changes Using USNChanged](example-code-to-retrieve-changes-using-usnchanged.md).</span></span>

 

 