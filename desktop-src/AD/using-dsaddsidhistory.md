---
title: Verwenden von dsaddsidhistory
description: In diesem Thema wird beschrieben, wie Sie die dsaddsidhistory-Funktion verwenden.
ms.assetid: cbf4983c-551d-4771-870e-a192ed898eb7
ms.tgt_platform: multiple
keywords:
- Verwenden von dsaddsidhistory Active Directory
- Active Directory Active Directory mithilfe von dsaddsidhistory
- Dsaddsidhistory Active Directory mit
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3d45792dbd8c7a2bfa2dd047111a3ed165a2011e
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/16/2019
ms.locfileid: "103707511"
---
# <a name="using-dsaddsidhistory"></a><span data-ttu-id="8cc89-106">Verwenden von dsaddsidhistory</span><span class="sxs-lookup"><span data-stu-id="8cc89-106">Using DsAddSidHistory</span></span>

<span data-ttu-id="8cc89-107">Die [**dsaddsidhistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) -Funktion Ruft die primäre Konto Sicherheits-ID (SID) eines Sicherheits Prinzipals aus einer Domäne (der Quell Domäne) ab und fügt Sie dem **SIDHistory** -Attribut eines Sicherheits Prinzipals in einer anderen (Ziel-) Domäne in einer anderen Gesamtstruktur hinzu.</span><span class="sxs-lookup"><span data-stu-id="8cc89-107">The [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) function gets the primary account security identifier (SID) of a security principal from one domain (the source domain) and adds it to the **sIDHistory** attribute of a security principal in another (destination) domain in a different forest.</span></span> <span data-ttu-id="8cc89-108">Wenn sich die Quell Domäne im einheitlichen Modus von Windows 2000 befindet, ruft diese Funktion auch die **SIDHistory** -Werte des Quell Prinzipals ab und fügt Sie dem **SIDHistory** des Ziel Prinzipals hinzu.</span><span class="sxs-lookup"><span data-stu-id="8cc89-108">When the source domain is in Windows 2000 native mode, this function also retrieves the **sIDHistory** values of the source principal and adds them to the destination principal's **sIDHistory**.</span></span>

<span data-ttu-id="8cc89-109">Das Hinzufügen von SIDs zum **SIDHistory** eines Sicherheits Prinzipals ist ein Sicherheits abhängiger Vorgang, der dem Ziel Prinzipal Zugriff auf alle Ressourcen gewährt, auf die der Quell Prinzipal Zugriff hat, vorausgesetzt, dass Vertrauens Stellungen von anwendbaren Ressourcen Domänen zur Zieldomäne vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="8cc89-109">Adding SIDs to a security principal's **sIDHistory** is a security-sensitive operation that effectively grants to the destination principal access to all resources accessible to the source principal, provided that trusts exist from applicable resource domains to the destination domain.</span></span>

<span data-ttu-id="8cc89-110">In einer Windows 2000-Domäne im einheitlichen Modus erstellt eine Benutzeranmeldung ein Zugriffs Token, das die primäre Konto-SID und die Gruppen-SIDs des Benutzers sowie den Benutzer **SIDHistory** und den **SIDHistory** der Gruppen enthält, in denen der Benutzer Mitglied ist.</span><span class="sxs-lookup"><span data-stu-id="8cc89-110">In a native mode Windows 2000 domain a user logon creates an access token that contains the user primary account SID and group SIDs, as well as the user **sIDHistory** and the **sIDHistory** of the groups of which the user is a member.</span></span> <span data-ttu-id="8cc89-111">Wenn diese früheren SIDs (**SIDHistory** -Werte) im Token des Benutzers vorhanden sind, erhält der Benutzer Zugriff auf Ressourcen, die durch Zugriffs Steuerungs Listen (ACLs) geschützt sind, die die früheren SIDs enthalten.</span><span class="sxs-lookup"><span data-stu-id="8cc89-111">Having these former SIDs (**sIDHistory** values) in the user's token grants the user access to resources protected by access-control lists (ACLs) containing the former SIDs.</span></span>

<span data-ttu-id="8cc89-112">Mit diesem Vorgang werden bestimmte Windows 2000-Bereitstellungs Szenarien vereinfacht.</span><span class="sxs-lookup"><span data-stu-id="8cc89-112">This operation facilitates certain Windows 2000 deployment scenarios.</span></span> <span data-ttu-id="8cc89-113">Insbesondere wird ein Szenario unterstützt, in dem Konten in einer neuen Windows 2000-Gesamtstruktur für Benutzer und Gruppen erstellt werden, die bereits in einer Windows NT 4,0-Produktionsumgebung vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="8cc89-113">In particular, it supports a scenario in which accounts in a new Windows 2000 forest are created for users and groups that already exist in an Windows NT 4.0 production environment.</span></span> <span data-ttu-id="8cc89-114">Wenn Sie die Windows NT 4,0-Konto-SID im Windows 2000-Konto **SIDHistory** platzieren, wird der Zugriff auf Netzwerkressourcen beibehalten, damit sich der Benutzer bei seinem neuen Windows 2000-Konto anmeldet.</span><span class="sxs-lookup"><span data-stu-id="8cc89-114">By placing the Windows NT 4.0 account SID in the Windows 2000 account **sIDHistory**, access to network resources is preserved for the user logging onto his new Windows 2000 account.</span></span>

<span data-ttu-id="8cc89-115">[**Dsaddsidhistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) unterstützt auch die Migration von BDCs-Ressourcen Servern (Windows NT 4,0 Backup Domain Controllers) (oder DCS und Mitglieds Server in einer Windows 2000-Domäne im einheitlichen Modus) zu einer Windows 2000-Domäne als Mitglieds Server.</span><span class="sxs-lookup"><span data-stu-id="8cc89-115">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) also supports migration of Windows NT 4.0 backup domain controllers (BDCs) resource servers (or DCs and member servers in a native mode Windows 2000 domain) to a Windows 2000 domain as member servers.</span></span> <span data-ttu-id="8cc89-116">Diese Migration erfordert die Erstellung in der Windows 2000-Zieldomäne von lokalen Domänen Gruppen, die in Ihrem **SIDHistory**-Element die primären SIDs der lokalen Gruppen, die auf dem BDC definiert sind (oder lokale Domänen Gruppen, auf die in ACLs auf den Windows 2000-Servern verwiesen wird) in der Quell Domäne.</span><span class="sxs-lookup"><span data-stu-id="8cc89-116">This migration requires the creation, in the destination Windows 2000 domain, of domain local groups that contain, in their **sIDHistory**, the primary SIDs of the local groups defined on the BDC (or domain local groups referenced in ACLs on the Windows 2000 servers) in the source domain.</span></span> <span data-ttu-id="8cc89-117">Durch Erstellen einer lokalen Zielgruppe, die den **SIDHistory** und alle Mitglieder der lokalen Quell Gruppe enthält, wird der Zugriff auf die migrierten Server Ressourcen, die durch ACLs geschützt sind, die auf die lokale Quell Gruppe verweisen, für alle Mitglieder beibehalten.</span><span class="sxs-lookup"><span data-stu-id="8cc89-117">By creating a destination local group containing the **sIDHistory** and all members of the source local group, access to the migrated server resources, protected by ACLs referencing the source local group, is maintained for all members.</span></span>

> [!Note]  
> <span data-ttu-id="8cc89-118">Die Verwendung von [**dsaddsidhistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) erfordert ein Verständnis der umfassenderen administrativen und Sicherheits Implikationen in diesen und anderen Szenarien.</span><span class="sxs-lookup"><span data-stu-id="8cc89-118">Use of [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requires an understanding of its broader administrative and security implications in these and other scenarios.</span></span> <span data-ttu-id="8cc89-119">Weitere Informationen finden Sie im Whitepaper "Planen der Migration von Windows NT zu Microsoft Windows 2000", das als Dommig.doc in den Windows 2000-Support Tools bereitgestellt wird.</span><span class="sxs-lookup"><span data-stu-id="8cc89-119">For more information, see the white paper "Planning Migration from Windows NT to Microsoft Windows 2000", delivered as Dommig.doc in the Windows 2000 Support Tools.</span></span> <span data-ttu-id="8cc89-120">Diese Dokumentation finden Sie auch auf der Produkt-CD unter \\ Support \\ Tools.</span><span class="sxs-lookup"><span data-stu-id="8cc89-120">This documentation may also be found on the product CD under \\support\\tools.</span></span>

 

## <a name="authorization-requirements"></a><span data-ttu-id="8cc89-121">Autorisierungs Anforderungen</span><span class="sxs-lookup"><span data-stu-id="8cc89-121">Authorization Requirements</span></span>

<span data-ttu-id="8cc89-122">[**Dsaddsidhistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) erfordert Administratorrechte in den Quell-und Zieldomänen.</span><span class="sxs-lookup"><span data-stu-id="8cc89-122">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requires administrator privileges in the source and destination domains.</span></span> <span data-ttu-id="8cc89-123">Insbesondere muss der Aufrufer dieser API Mitglied der Gruppe "Domänen Administratoren" in der Zieldomäne sein.</span><span class="sxs-lookup"><span data-stu-id="8cc89-123">Specifically, the caller of this API must be a member of the Domain Administrators group in the destination domain.</span></span> <span data-ttu-id="8cc89-124">Für diese Mitgliedschaft wird eine hart codierte Überprüfung durchgeführt.</span><span class="sxs-lookup"><span data-stu-id="8cc89-124">A hard-coded check for this membership is performed.</span></span> <span data-ttu-id="8cc89-125">Außerdem muss der Aufrufer oder das im *srcdomaincreds* -Parameter bereitgestellte Konto, wenn er nicht **null** ist, Mitglied der Gruppe "Administratoren" oder "Domänen Administratoren" in der Quell Domäne sein.</span><span class="sxs-lookup"><span data-stu-id="8cc89-125">Also, the caller or the account provided in the *SrcDomainCreds* parameter, if not **NULL**, must be a member of either the Administrators or Domain Administrators group in the source domain.</span></span>

## <a name="domain-and-trust-requirements"></a><span data-ttu-id="8cc89-126">Domänen-und Vertrauens Anforderungen</span><span class="sxs-lookup"><span data-stu-id="8cc89-126">Domain and Trust Requirements</span></span>

<span data-ttu-id="8cc89-127">[**Dsaddsidhistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) erfordert, dass die Zieldomäne im einheitlichen Modus von Windows 2000 oder höher ist, da nur dieser Domänentyp das **SIDHistory** -Attribut unterstützt.</span><span class="sxs-lookup"><span data-stu-id="8cc89-127">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requires that the destination domain be in Windows 2000 native mode or later, because only this domain type supports the **sIDHistory** attribute.</span></span> <span data-ttu-id="8cc89-128">Die Quell Domäne kann entweder Windows NT 4,0 oder Windows 2000, gemischter oder einheitlicher Modus sein.</span><span class="sxs-lookup"><span data-stu-id="8cc89-128">The source domain may be either Windows NT 4.0 or Windows 2000, mixed or native mode.</span></span> <span data-ttu-id="8cc89-129">Die Quell-und Zieldomänen dürfen sich nicht in derselben Gesamtstruktur befinden.</span><span class="sxs-lookup"><span data-stu-id="8cc89-129">The source and destination domains must not be in the same forest.</span></span> <span data-ttu-id="8cc89-130">Windows NT 4,0-Domänen sind definitionsgemäß nicht in einer Gesamtstruktur vorhanden.</span><span class="sxs-lookup"><span data-stu-id="8cc89-130">Windows NT 4.0 domains are by definition not in a forest.</span></span> <span data-ttu-id="8cc89-131">Diese Gesamtstruktur übergreifende Einschränkung stellt sicher, dass doppelte SIDs, unabhängig davon, ob Sie als primäre SIDs-oder **SIDHistory** -Werte angezeigt werden, nicht in derselben Gesamtstruktur erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="8cc89-131">This inter-forest constraint ensures that duplicate SIDs, whether appearing as primary SIDs or **sIDHistory** values, are not created in the same forest.</span></span>

<span data-ttu-id="8cc89-132">[**Dsaddsidhistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) erfordert in den in der folgenden Tabelle aufgeführten Fällen eine externe Vertrauensstellung von der Quell Domäne zur Zieldomäne.</span><span class="sxs-lookup"><span data-stu-id="8cc89-132">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requires an external trust from the source domain to the destination domain in the cases listed in the following table.</span></span>



| <span data-ttu-id="8cc89-133">Fall</span><span class="sxs-lookup"><span data-stu-id="8cc89-133">Case</span></span>                                                                             | <span data-ttu-id="8cc89-134">BESCHREIBUNG</span><span class="sxs-lookup"><span data-stu-id="8cc89-134">Description</span></span>                                                                                                                                                                                                                                                                 |
|----------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="8cc89-135">Die Quell Domäne ist Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="8cc89-135">The source domain is Windows 2000.</span></span><br/>                                    | <span data-ttu-id="8cc89-136">Das Quell- **SIDHistory** -Attribut, das nur in Windows 2000-Quell Domänen verfügbar ist, ist möglicherweise nur mit LDAP lesbar, das diese Vertrauensstellung für den Integritätsschutz erfordert.</span><span class="sxs-lookup"><span data-stu-id="8cc89-136">The source **sIDHistory** attribute, available only in Windows 2000 source domains, may be read only using LDAP, which requires this trust for integrity protection.</span></span><br/>                                                                                             |
| <span data-ttu-id="8cc89-137">Die Quell Domäne ist Windows NT 4,0, und *srcdomaincreds* ist **null**.</span><span class="sxs-lookup"><span data-stu-id="8cc89-137">The source domain is Windows NT 4.0 and *SrcDomainCreds* is **NULL**.</span></span><br/> | <span data-ttu-id="8cc89-138">Der Identitätswechsel, der zur Unterstützung der Quell Domänen Vorgänge mithilfe der Anmelde Informationen des Aufrufers erforderlich ist, hängt von dieser Vertrauensstellung</span><span class="sxs-lookup"><span data-stu-id="8cc89-138">The impersonation, required to support source domain operations using the caller's credentials, depends on this trust.</span></span> <span data-ttu-id="8cc89-139">Der Identitätswechsel erfordert auch, dass der Zieldomänen Controller auf Domänen Controllern standardmäßig "vertrauenswürdig für Delegierung" aktiviert ist.</span><span class="sxs-lookup"><span data-stu-id="8cc89-139">Impersonation also requires that the destination domain controller has "Trusted for Delegation" enabled by default on domain controllers.</span></span><br/> |



 

<span data-ttu-id="8cc89-140">Es ist jedoch keine Vertrauensstellung zwischen den Quell-und Zieldomänen erforderlich, wenn es sich bei der Quell Domäne um Windows NT 4,0 und *srcdomaincreds* nicht um **null** handelt.</span><span class="sxs-lookup"><span data-stu-id="8cc89-140">However, there is no trust required between the source and destination domains if the source domain is Windows NT 4.0 and *SrcDomainCreds* is not **NULL**.</span></span>

## <a name="source-domain-controller-requirements"></a><span data-ttu-id="8cc89-141">Anforderungen an den Quell Domänen Controller</span><span class="sxs-lookup"><span data-stu-id="8cc89-141">Source Domain Controller Requirements</span></span>

<span data-ttu-id="8cc89-142">[**Dsaddsidhistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) erfordert, dass der Domänen Controller, der als Ziel für Vorgänge in der Quell Domäne ausgewählt ist, der PDC in Windows NT 4,0-Domänen oder der PDC-Emulator in Windows 2000-Domänen ist.</span><span class="sxs-lookup"><span data-stu-id="8cc89-142">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requires that the domain controller, selected as the target for operations in the source domain, be the PDC in Windows NT 4.0 domains or the PDC Emulator in Windows 2000 domains.</span></span> <span data-ttu-id="8cc89-143">Die Überwachung der Quell Domäne wird mithilfe von Schreibvorgängen generiert. der PDC ist daher in Windows NT 4,0-Quell Domänen erforderlich, und die Einschränkung "PDC-only" stellt sicher, dass **dsaddsidhistory** -Überwachungen auf einem einzelnen Computer generiert werden.</span><span class="sxs-lookup"><span data-stu-id="8cc89-143">Source domain auditing is generated by way of write operations, therefore, the PDC is required in Windows NT 4.0 source domains, and the PDC-only restriction ensures that **DsAddSidHistory** audits are generated on a single computer.</span></span> <span data-ttu-id="8cc89-144">Dies verringert die Notwendigkeit, die Überwachungs Protokolle aller DCS zu überprüfen, um die Verwendung dieses Vorgangs zu überwachen.</span><span class="sxs-lookup"><span data-stu-id="8cc89-144">This reduces the need to review the audit logs of all DCs to monitor use of this operation.</span></span>

> [!Note]  
> <span data-ttu-id="8cc89-145">In Windows NT 4,0-Quell Domänen muss auf dem PDC (Ziel der Vorgänge in der Quell Domäne) Service Pack 4 (SP4) und höher ausgeführt werden, um eine ordnungsgemäße Unterstützung der Überwachung sicherzustellen.</span><span class="sxs-lookup"><span data-stu-id="8cc89-145">In Windows NT 4.0 source domains, the PDC (target of operations in the source domain) must be running Service Pack 4 (SP4) and later to ensure proper auditing support.</span></span>

 

<span data-ttu-id="8cc89-146">Der folgende Registrierungs Wert muss als reg \_ DWORD-Wert erstellt und auf dem Quell Domänen Controller für Windows NT 4,0-und Windows 2000-Quell Domänen Controller auf 1 festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="8cc89-146">The following registry value must be created as a REG\_DWORD value and set to 1 on the source domain controller for both Windows NT 4.0 and Windows 2000 source DCs.</span></span>

```
HKEY_LOCAL_MACHINE
   System
      CurrentControlSet
         Control
            Lsa
               TcpipClientSupport
```

<span data-ttu-id="8cc89-147">Durch Festlegen dieses Werts werden RPC-Aufrufe über den TCP-Transport ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="8cc89-147">Setting this value enables RPC calls over the TCP transport.</span></span> <span data-ttu-id="8cc89-148">Dies ist erforderlich, da samrpc-Schnittstellen standardmäßig nur auf Named Pipes Remote fähig sind.</span><span class="sxs-lookup"><span data-stu-id="8cc89-148">This is required because, by default, SAMRPC interfaces are remotable only on named pipes.</span></span> <span data-ttu-id="8cc89-149">Die Verwendung von Named Pipes führt zu einem System für die Verwaltung von Anmelde Informationen, das sich für interaktiv angemeldete Benutzer eignet, die vernetzte Aufrufe durchführen, aber für einen System Prozess, der Netzwerk Aufrufe durch benutzerdefinierte Anmelde Informationen ausführt, nicht flexibel ist.</span><span class="sxs-lookup"><span data-stu-id="8cc89-149">Using named pipes results in a credential management system suitable for interactively logged-on users making networked calls, but is not flexible for a system process that makes network calls with user-supplied credentials.</span></span> <span data-ttu-id="8cc89-150">RPC über TCP ist für diesen Zweck besser geeignet.</span><span class="sxs-lookup"><span data-stu-id="8cc89-150">RPC over TCP is more suitable for that purpose.</span></span> <span data-ttu-id="8cc89-151">Wenn dieser Wert festgelegt wird, wird die Systemsicherheit nicht verringert.</span><span class="sxs-lookup"><span data-stu-id="8cc89-151">Setting this value does not diminish system security.</span></span> <span data-ttu-id="8cc89-152">Wenn dieser Wert erstellt oder geändert wird, muss der Quell Domänen Controller neu gestartet werden, damit diese Einstellung wirksam wird.</span><span class="sxs-lookup"><span data-stu-id="8cc89-152">If this value is created or changed, the source domain controller must be restarted for this setting to take effect.</span></span>

<span data-ttu-id="8cc89-153">Die neue lokale Gruppe " <SrcDomainName> $ $ $" muss zu Überprüfungszwecken in der Quell Domäne erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="8cc89-153">A new local group, "<SrcDomainName>$$$", must be created in the source domain for auditing purposes.</span></span>

## <a name="auditing"></a><span data-ttu-id="8cc89-154">Überwachung</span><span class="sxs-lookup"><span data-stu-id="8cc89-154">Auditing</span></span>

<span data-ttu-id="8cc89-155">[**Dsaddsidhistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) -Vorgänge werden überwacht, um sicherzustellen, dass sowohl Quell-als auch Zieldomänen Administratoren erkennen können, wann diese Funktion ausgeführt wurde.</span><span class="sxs-lookup"><span data-stu-id="8cc89-155">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) operations are audited to ensure that both source and destination domain administrators are able to detect when this function has been run.</span></span> <span data-ttu-id="8cc89-156">Die Überwachung ist sowohl in der Quell-als auch in der Zieldomäne obligatorisch.</span><span class="sxs-lookup"><span data-stu-id="8cc89-156">Auditing is mandatory in both the source and destination domains.</span></span> <span data-ttu-id="8cc89-157">**Dsaddsidhistory** überprüft, ob der Überwachungsmodus in jeder Domäne on ist, und dass die Konto Verwaltungs Überwachung für Erfolgs-/Fehlerereignisse ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="8cc89-157">**DsAddSidHistory** verifies that the Audit Mode is on in each domain and that Account Management auditing of Success/Failure events is on.</span></span> <span data-ttu-id="8cc89-158">In der Zieldomäne wird für jeden erfolgreichen oder fehlgeschlagenen **dsaddsidhistory** -Vorgang ein eindeutiges Überwachungs Ereignis vom Typ "SID-Verlauf hinzufügen" generiert.</span><span class="sxs-lookup"><span data-stu-id="8cc89-158">In the destination domain, a unique "Add Sid History" audit event is generated for each successful or failed **DsAddSidHistory** operation.</span></span>

<span data-ttu-id="8cc89-159">Eindeutige Überwachungs Ereignisse für "SID-Verlauf hinzufügen" sind auf Windows NT 4,0-Systemen nicht verfügbar.</span><span class="sxs-lookup"><span data-stu-id="8cc89-159">Unique "Add Sid History" audit events are not available on Windows NT 4.0 systems.</span></span> <span data-ttu-id="8cc89-160">Um Überwachungs Ereignisse zu generieren, die die Verwendung von [**dsaddsidhistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) für die Quell Domäne eindeutig widerspiegeln, werden Vorgänge für eine spezielle Gruppe durchführt, deren Name der eindeutige Bezeichner im Überwachungs Protokoll ist.</span><span class="sxs-lookup"><span data-stu-id="8cc89-160">To generate audit events that unambiguously reflect use of [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) against the source domain, it performs operations on a special group whose name is the unique identifier in the audit log.</span></span> <span data-ttu-id="8cc89-161">Die lokale Gruppe " <SrcDomainName> $ $ $", deren Name aus dem NetBIOS-Namen der Quell Domäne besteht, der mit drei Dollarzeichen ($) (ASCII-Code = 0x24 und Unicode = U + 0024) angehängt ist, muss vor dem Aufrufen von **dsaddsidhistory** auf dem Quell Domänen Controller erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="8cc89-161">A local group, "<SrcDomainName>$$$", whose name is composed of the source domain NetBIOS name appended with three dollar signs ($) (ASCII code = 0x24 and Unicode = U+0024), must be created on the source domain controller prior to calling **DsAddSidHistory**.</span></span> <span data-ttu-id="8cc89-162">Jeder Quell Benutzer und jede globale Gruppe, die Ziel dieses Vorgangs ist, wird der Mitgliedschaft in dieser Gruppe hinzugefügt und daraus entfernt.</span><span class="sxs-lookup"><span data-stu-id="8cc89-162">Each source user and global group that is a target of this operation is added to and then removed from the membership of this group.</span></span> <span data-ttu-id="8cc89-163">Dadurch werden die Überwachungs Ereignisse Add Member und DELETE Member in der Quell Domäne generiert, die Durchsuchen nach Ereignissen überwacht werden können, die auf den Gruppennamen verweisen.</span><span class="sxs-lookup"><span data-stu-id="8cc89-163">This generates Add Member and Delete Member audit events in the source domain, which can be monitored by searching for events that reference the group name.</span></span>

> [!Note]  
> <span data-ttu-id="8cc89-164">[**Dsaddsidhistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) -Vorgänge in lokalen Gruppen in einer Windows NT 4,0-oder Windows 2000-Quell Domäne im gemischten Modus können nicht überwacht werden, da lokale Gruppen nicht zu Mitgliedern einer anderen lokalen Gruppe gemacht werden können und daher nicht zur speziellen <SrcDomainName> lokalen Gruppe "$ $ $" hinzugefügt werden können.</span><span class="sxs-lookup"><span data-stu-id="8cc89-164">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) operations on local groups in a Windows NT 4.0, or Windows 2000 mixed-mode source domain cannot be audited because local groups cannot be made members of another local group and therefore cannot be added to the special "<SrcDomainName>$$$" local group.</span></span> <span data-ttu-id="8cc89-165">Diese fehlende Überwachung stellt kein Sicherheitsproblem für die Quell Domäne dar, da der Zugriff auf die Quell Domänen Ressource von diesem Vorgang nicht beeinträchtigt wird.</span><span class="sxs-lookup"><span data-stu-id="8cc89-165">This lack of auditing does not present a security issue to the source domain, because source domain resource access is not affected by this operation.</span></span> <span data-ttu-id="8cc89-166">Das Hinzufügen der SID einer lokalen Quell Gruppe zu einer lokalen Zielgruppe gewährt keinen Zugriff auf die Quell Ressourcen, die von dieser lokalen Gruppe geschützt werden, auf zusätzliche Benutzer.</span><span class="sxs-lookup"><span data-stu-id="8cc89-166">Adding the SID of a source local group to a destination local group does not grant access to source resources, protected by that local group, to any additional users.</span></span> <span data-ttu-id="8cc89-167">Durch das Hinzufügen von Mitgliedern zur lokalen Zielgruppe erhalten Sie keinen Zugriff auf Quell Ressourcen.</span><span class="sxs-lookup"><span data-stu-id="8cc89-167">Adding members to the destination local group does not grant them access to source resources.</span></span> <span data-ttu-id="8cc89-168">Hinzugefügten Mitgliedern wird nur der Zugriff auf Server in der Zieldomäne gewährt, die aus der Quell Domäne migriert wurden, die möglicherweise von der lokalen SID der Quell Gruppe geschützte Ressourcen besitzt.</span><span class="sxs-lookup"><span data-stu-id="8cc89-168">Added members are granted access only to servers in the destination domain migrated from the source domain, which may have resources protected by the source local group SID.</span></span>

 

## <a name="data-transmission-security"></a><span data-ttu-id="8cc89-169">Daten Übertragungssicherheit</span><span class="sxs-lookup"><span data-stu-id="8cc89-169">Data Transmission Security</span></span>

<span data-ttu-id="8cc89-170">[**Dsaddsidhistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) erzwingt die folgenden Sicherheitsmaßnahmen:</span><span class="sxs-lookup"><span data-stu-id="8cc89-170">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) enforces the following security measures:</span></span>

-   <span data-ttu-id="8cc89-171">Wird von einer Windows 2000-Arbeitsstation aufgerufen, werden die Anmelde Informationen des Aufrufers verwendet, um den RPC-Aufruf an den Zieldomänen Controller zu authentifizieren und zu schützen.</span><span class="sxs-lookup"><span data-stu-id="8cc89-171">Called from a Windows 2000 workstation, the caller's credentials are used to authenticate and privacy-protect the RPC call to the destination domain controller.</span></span> <span data-ttu-id="8cc89-172">Wenn *srcdomaincreds* nicht **null** ist, müssen sowohl die Arbeitsstation als auch der Ziel-DC die 128-Bit-Verschlüsselung unterstützen, um die Anmelde Informationen zu schützen.</span><span class="sxs-lookup"><span data-stu-id="8cc89-172">If *SrcDomainCreds* is not **NULL**, both the workstation and the destination DC must support 128-bit encryption to privacy-protect the credentials.</span></span> <span data-ttu-id="8cc89-173">Wenn die 128-Bit-Verschlüsselung nicht verfügbar ist und *srcdomaincreds* bereitgestellt werden, muss der-Befehl auf dem Ziel-DC erfolgen.</span><span class="sxs-lookup"><span data-stu-id="8cc89-173">If 128-bit encryption is not available and *SrcDomainCreds* are provided, then the call must be made on the destination DC.</span></span>
-   <span data-ttu-id="8cc89-174">Der Zieldomänen Controller kommuniziert mit dem Quell Domänen Controller entweder mithilfe von *srcdomaincreds* oder mithilfe der Anmelde Informationen des Aufrufers, um sich gegenseitig zu authentifizieren und den Integritätsschutz für den Lesevorgang der SID des Quell Kontos (mit einem Sam-Lookup) und **SIDHistory** (mit einem LDAP-Lesevorgang</span><span class="sxs-lookup"><span data-stu-id="8cc89-174">The destination domain controller communicates with the source domain controller using either *SrcDomainCreds* or the caller's credentials to mutually authenticate and integrity-protect the read of the source account SID (using a SAM lookup) and **sIDHistory** (using an LDAP read).</span></span>

## <a name="threat-models"></a><span data-ttu-id="8cc89-175">Bedrohungs Modelle</span><span class="sxs-lookup"><span data-stu-id="8cc89-175">Threat Models</span></span>

<span data-ttu-id="8cc89-176">In der folgenden Tabelle sind die potenziellen Bedrohungen im Zusammenhang mit dem [**dsaddsidhistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) -Befehl aufgelistet, und es werden die Sicherheitsmaßnahmen für die jeweilige Bedrohung behandelt.</span><span class="sxs-lookup"><span data-stu-id="8cc89-176">The following table lists the potential threats associated with the [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) call and addresses the security measures pertinent to the particular threat.</span></span>



<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><span data-ttu-id="8cc89-177">Potenzielle Bedrohung</span><span class="sxs-lookup"><span data-stu-id="8cc89-177">Potential threat</span></span></th>
<th><span data-ttu-id="8cc89-178">Sicherheitsmeasure</span><span class="sxs-lookup"><span data-stu-id="8cc89-178">Security measure</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span data-ttu-id="8cc89-179">Man im mittleren Angriff</span><span class="sxs-lookup"><span data-stu-id="8cc89-179">Man in the Middle Attack</span></span><br/> <span data-ttu-id="8cc89-180">Ein nicht autorisierter Benutzer fängt die Such-SID des Rückgabe Aufrufens <em>des Quell Objekts</em> ab und ersetzt dabei die Quell Objekt-SID durch eine beliebige sid für das Einfügen in ein SIDHistory-Zielobjekt.</span><span class="sxs-lookup"><span data-stu-id="8cc89-180">An unauthorized user intercepts the <em>lookup SID of source object</em> return call, replacing the source object SID with an arbitrary SID for insertion into a target object SIDhistory.</span></span><br/></td>
<td><span data-ttu-id="8cc89-181">Die <em>Such-SID des Quell Objekts</em> ist eine authentifizierte RPC-Nachricht, die die Administrator Anmelde Informationen des Aufrufers mit dem paketintegritäts-Nachrichten Schutz verwendet.</span><span class="sxs-lookup"><span data-stu-id="8cc89-181">The <em>lookup SID of source object</em> is an authenticated RPC, using the caller's administrator credentials, with packet integrity message protection.</span></span> <span data-ttu-id="8cc89-182">Dadurch wird sichergestellt, dass der Rückgabe Befehl ohne Erkennung nicht geändert werden kann.</span><span class="sxs-lookup"><span data-stu-id="8cc89-182">This ensures that the return call cannot be modified without detection.</span></span> <span data-ttu-id="8cc89-183">Vom Zieldomänen Controller wird ein eindeutiges Ereignis zum Hinzufügen einer SID-Verlaufs Überwachung erstellt &quot; &quot; , das die dem Ziel Konto- <strong>SIDHistory</strong>hinzugefügte sid</span><span class="sxs-lookup"><span data-stu-id="8cc89-183">The destination domain controller creates a unique &quot;Add SID History&quot; audit event that reflects the SID added to the destination account <strong>sIDHistory</strong>.</span></span><br/></td>
</tr>
<tr class="even">
<td><span data-ttu-id="8cc89-184">Trojaner-Quell Domäne</span><span class="sxs-lookup"><span data-stu-id="8cc89-184">Trojan Source Domain</span></span><br/> <span data-ttu-id="8cc89-185">Ein nicht autorisierter Benutzer erstellt eine &quot; Trojaner &quot; -Quell Domäne in einem privaten Netzwerk mit derselben Domänen-SID und einigen der gleichen Konto-SIDs wie die berechtigte Quell Domäne.</span><span class="sxs-lookup"><span data-stu-id="8cc89-185">An unauthorized user creates a &quot;Trojan Horse&quot; source domain on a private network that has the same domain SID and some of the same account SIDs as the legitimate source domain.</span></span> <span data-ttu-id="8cc89-186">Der nicht autorisierte Benutzer versucht dann, <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>dsaddsidhistory</strong></a> in einer Zieldomäne auszuführen, um die SID eines Quell Kontos zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="8cc89-186">The unauthorized user then attempts to run <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a> in a destination domain to obtain the SID of a source account.</span></span> <span data-ttu-id="8cc89-187">Dies geschieht, ohne dass die echten Quell Domänen Administrator-Anmelde Informationen erforderlich sind und keine Überwachungs Pfade in der realen Quell Domäne belassen werden.</span><span class="sxs-lookup"><span data-stu-id="8cc89-187">This is done without the need for the real source Domain Administrator credentials and without leaving an audit trail in the real source domain.</span></span> <span data-ttu-id="8cc89-188">Die Methode des nicht autorisierten Benutzers zum Erstellen der Trojaner-Quell Domäne kann eines der folgenden sein:</span><span class="sxs-lookup"><span data-stu-id="8cc89-188">The unauthorized user's method for creating the Trojan Horse source domain could be one of the following:</span></span>
<ul>
<li><span data-ttu-id="8cc89-189">Erwerben Sie eine Kopie (BDC-Sicherung) der Quell Domäne Sam.</span><span class="sxs-lookup"><span data-stu-id="8cc89-189">Obtain a copy (BDC backup) of the source domain SAM.</span></span></li>
<li><span data-ttu-id="8cc89-190">Erstellen Sie eine neue Domäne, ändern Sie die Domänen-SID auf dem Datenträger entsprechend der berechtigten SID der Quell Domäne, und erstellen Sie dann ausreichend Benutzer, um ein Konto mit der gewünschten sid zu instanziieren.</span><span class="sxs-lookup"><span data-stu-id="8cc89-190">Create a new domain, altering the domain SID on disk to match the legitimate source domain SID, then create enough users to instantiate an account with the desired SID.</span></span></li>
<li><span data-ttu-id="8cc89-191">Erstellen Sie ein BDC-Replikat.</span><span class="sxs-lookup"><span data-stu-id="8cc89-191">Create a BDC replica.</span></span> <span data-ttu-id="8cc89-192">Hierfür sind Anmelde Informationen des Quell Domänen Administrators erforderlich.</span><span class="sxs-lookup"><span data-stu-id="8cc89-192">This requires source domain Administrator credentials.</span></span> <span data-ttu-id="8cc89-193">Dann nimmt der nicht autorisierte Benutzer das Replikat in ein privates Netzwerk, um den Angriff zu implementieren.</span><span class="sxs-lookup"><span data-stu-id="8cc89-193">Then the unauthorized user takes the replica to a private network to implement the attack.</span></span></li>
</ul>
<br/></td>
<td><span data-ttu-id="8cc89-194">Es gibt zwar viele Möglichkeiten, wie ein nicht autorisierter Benutzer eine gewünschte Quell Objekt-SID abrufen oder erstellen kann, aber der nicht autorisierte Benutzer kann ihn nicht zum Aktualisieren des <strong>SIDHistory</strong> eines Kontos verwenden, ohne Mitglied der Gruppe der Zieldomänen Administratoren zu sein.</span><span class="sxs-lookup"><span data-stu-id="8cc89-194">Although there are many ways for an unauthorized user to retrieve or create a desired source object SID, the unauthorized user cannot use it to update an account's <strong>sIDHistory</strong> without being a member of the destination Domain Administrators group.</span></span> <span data-ttu-id="8cc89-195">Da die Überprüfung auf dem Zieldomänen Controller für die Mitgliedschaft von Domänen Administratoren hart codiert ist, gibt es auf dem Ziel-DC keine Methode zum Ändern der Zugriffs Steuerungsdaten, die diese Funktion schützen.</span><span class="sxs-lookup"><span data-stu-id="8cc89-195">Because the check, on the destination domain controller, for Domain Administrator membership is hard-coded, on the target DC, there is no method for doing a disk modification to change the access control data protecting this function.</span></span> <span data-ttu-id="8cc89-196">Der Versuch, ein Trojaner-Quell Konto zu klonen, wird in der Zieldomäne überwacht.</span><span class="sxs-lookup"><span data-stu-id="8cc89-196">An attempt to clone a Trojan Horse source account is audited in the destination domain.</span></span> <span data-ttu-id="8cc89-197">Dieser Angriff wird durch das Reservieren der Mitgliedschaft in der Gruppe der Domänen Administratoren für nur sehr vertrauenswürdige Personen verhindert.</span><span class="sxs-lookup"><span data-stu-id="8cc89-197">This attack is mitigated by reserving membership in the Domain Administrators group for only highly trusted individuals.</span></span><br/></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="8cc89-198">Änderung des SID-Verlaufs auf dem Datenträger</span><span class="sxs-lookup"><span data-stu-id="8cc89-198">On-disk Modification of SID History</span></span><br/> <span data-ttu-id="8cc89-199">Ein hoch entwickelter nicht autorisierter Benutzer mit Anmelde Informationen des Domänen Administrators und mit physischem Zugriff auf einen Domänen Controller in der Zieldomäne könnte einen Konto- <strong>SIDHistory</strong> -Wert auf dem Datenträger ändern</span><span class="sxs-lookup"><span data-stu-id="8cc89-199">A sophisticated unauthorized user, with Domain Administrator credentials and with physical access to a DC in the destination domain, could modify an account <strong>sIDHistory</strong> value on disk.</span></span><br/></td>
<td><span data-ttu-id="8cc89-200">Dieser Versuch wird nicht durch die Verwendung von <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>dsaddsidhistory</strong></a>aktiviert.</span><span class="sxs-lookup"><span data-stu-id="8cc89-200">This attempt is not enabled by use of <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a>.</span></span> <span data-ttu-id="8cc89-201">Dieser Angriff wird verringert, indem der physische Zugriff auf Domänen Controller mit Ausnahme von sehr vertrauenswürdigen Administratoren verhindert wird.</span><span class="sxs-lookup"><span data-stu-id="8cc89-201">This attack is mitigated by preventing physical access to domain controllers to all except highly trusted administrators.</span></span><br/></td>
</tr>
<tr class="even">
<td><span data-ttu-id="8cc89-202">Nicht autorisierter Code zum Entfernen von Schutzmaßnahmen</span><span class="sxs-lookup"><span data-stu-id="8cc89-202">Rogue Code Used to Remove Protections</span></span><br/> <span data-ttu-id="8cc89-203">Ein nicht autorisierter Benutzer oder nicht autorisierter Administrator mit physischem Zugriff auf den Verzeichnisdienst Code könnte nicht autorisierten Code erstellen, der Folgendes:</span><span class="sxs-lookup"><span data-stu-id="8cc89-203">An unauthorized user or rogue administrator with physical access to the Directory Service code could create rogue code that:</span></span>
<ol>
<li><span data-ttu-id="8cc89-204">Entfernt die Überprüfung der Mitgliedschaft in der Gruppe "Domänen Administratoren" im Code.</span><span class="sxs-lookup"><span data-stu-id="8cc89-204">Removes the check for membership in the Domain Administrators group in the code.</span></span></li>
<li><span data-ttu-id="8cc89-205">Ändert die Aufrufe auf dem Quell Domänen Controller, der die SID auf einen nicht überwachten lookupsidfromname zeigt.</span><span class="sxs-lookup"><span data-stu-id="8cc89-205">Changes the calls on the source domain controller that points the SID to a LookupSidFromName that is not audited.</span></span></li>
<li><span data-ttu-id="8cc89-206">Entfernt Überwachungs Protokoll Aufrufe.</span><span class="sxs-lookup"><span data-stu-id="8cc89-206">Removes audit log calls.</span></span></li>
</ol>
<br/></td>
<td><span data-ttu-id="8cc89-207">Ein Benutzer mit physischem Zugriff auf den DS-Code und ausreichend wissen, um nicht autorisierten Code zu erstellen, ist in der Lage, das <strong>SIDHistory</strong> -Attribut eines Kontos willkürlich zu ändern.</span><span class="sxs-lookup"><span data-stu-id="8cc89-207">Someone with physical access to the DS code and knowledgeable enough to create rogue code has the capability of arbitrarily modifying the <strong>sIDHistory</strong> attribute of an account.</span></span> <span data-ttu-id="8cc89-208">Die <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>dsaddsidhistory</strong></a> -API erhöht dieses Sicherheitsrisiko nicht.</span><span class="sxs-lookup"><span data-stu-id="8cc89-208">The <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a> API does not increase this security risk.</span></span><br/></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="8cc89-209">Ressourcen anfällig für gestohlene SIDs</span><span class="sxs-lookup"><span data-stu-id="8cc89-209">Resources Vulnerable to Stolen SIDs</span></span><br/> <span data-ttu-id="8cc89-210">Wenn ein nicht autorisierter Benutzer eine der hier beschriebenen Methoden zum Ändern eines Konto- <strong>SIDHistory</strong>verwendet hat und die Ressourcen Domänen von Interesse der nicht autorisierten Benutzerkonto Domäne vertrauen, kann der nicht autorisierte Benutzer nicht autorisierten Zugriff auf die Ressourcen der gestohlenen sid erhalten. Dies ist möglicherweise nicht möglich, ohne einen Überwachungs Pfad in der Konto Domäne zu verlassen, von der die SID gestohlen wurde.</span><span class="sxs-lookup"><span data-stu-id="8cc89-210">If an unauthorized user has succeeded in using one of the methods described here to modify an account <strong>sIDHistory</strong>, and if the resource domains of interest trust the unauthorized user account domain, then the unauthorized user can get unauthorized access to the stolen SID's resources, potentially without leaving an audit trail in the account domain from which the SID was stolen.</span></span><br/></td>
<td><span data-ttu-id="8cc89-211">Ressourcen Domänen Administratoren schützen Ihre Ressourcen, indem Sie nur Vertrauens Stellungen einrichten, die aus Sicht der Sicherheit sinnvoll sind.</span><span class="sxs-lookup"><span data-stu-id="8cc89-211">Resource domain administrators protect their resources by setting up only those trust relationships that make sense from a security perspective.</span></span> <span data-ttu-id="8cc89-212">Die Verwendung von <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>dsaddsidhistory</strong></a> ist in der vertrauenswürdigen Zieldomäne auf Mitglieder der Gruppe der Domänen Administratoren beschränkt, die bereits über umfassende Berechtigungen innerhalb des Umfangs ihrer Zuständigkeiten verfügen.</span><span class="sxs-lookup"><span data-stu-id="8cc89-212">Use of <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a> is restricted, in the trusted target domain, to members of the Domain Administrators group who already have broad permissions within the scope of their responsibilities.</span></span><br/></td>
</tr>
<tr class="even">
<td><span data-ttu-id="8cc89-213">Nicht autorisierte Zieldomäne</span><span class="sxs-lookup"><span data-stu-id="8cc89-213">Rogue Target Domain</span></span><br/> <span data-ttu-id="8cc89-214">Ein nicht autorisierter Benutzer erstellt eine Windows 2000-Domäne mit einem Konto, dessen <strong>SIDHistory</strong> eine sid enthält, die aus einer Quell Domäne gestohlen wurde.</span><span class="sxs-lookup"><span data-stu-id="8cc89-214">An unauthorized user creates a Windows 2000 domain with an account whose <strong>sIDHistory</strong> contains a SID that has been stolen from a source domain.</span></span> <span data-ttu-id="8cc89-215">Der nicht autorisierte Benutzer verwendet dieses Konto, um nicht autorisierten Zugriff auf Ressourcen zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="8cc89-215">The unauthorized user uses this account for unauthorized access to resources.</span></span><br/></td>
<td><span data-ttu-id="8cc89-216">Der nicht autorisierte Benutzer benötigt Administrator Anmelde Informationen für die Quell Domäne, damit <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>dsaddsidhistory</strong></a>verwendet werden kann, und verlässt einen Überwachungs Pfad auf dem Quell Domänen Controller.</span><span class="sxs-lookup"><span data-stu-id="8cc89-216">The unauthorized user requires Administrator credentials for the source domain in order to use <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a>, and leaves an audit trail on the source domain controller.</span></span> <span data-ttu-id="8cc89-217">Die nicht autorisierte Zieldomäne erhält nicht autorisierten Zugriff nur in anderen Domänen, die der nicht autorisierten Domäne vertrauen, die Administrator Rechte in diesen Ressourcen Domänen benötigt.</span><span class="sxs-lookup"><span data-stu-id="8cc89-217">The rogue target domain gains unauthorized access only in other domains that trust the rogue domain, which requires Administrator privileges in those resource domains.</span></span><br/></td>
</tr>
</tbody>
</table>



 

## <a name="operational-constraints"></a><span data-ttu-id="8cc89-218">Betriebliche Einschränkungen</span><span class="sxs-lookup"><span data-stu-id="8cc89-218">Operational Constraints</span></span>

<span data-ttu-id="8cc89-219">In diesem Abschnitt werden die operativen Einschränkungen der Verwendung der [**dsaddsidhistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) -Funktion beschrieben.</span><span class="sxs-lookup"><span data-stu-id="8cc89-219">This section describes the operational constraints of using the [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) function.</span></span>

<span data-ttu-id="8cc89-220">Die SID von *srcprincipal* darf nicht bereits in der Ziel Gesamtstruktur vorhanden sein, entweder als primäre Konto-SID oder als **SIDHistory** eines Kontos.</span><span class="sxs-lookup"><span data-stu-id="8cc89-220">The SID of *SrcPrincipal* must not already exist in the destination forest, either as a primary account SID or in the **sIDHistory** of an account.</span></span> <span data-ttu-id="8cc89-221">Die Ausnahme besteht darin, dass [**dsaddsidhistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) keinen Fehler generiert, wenn versucht wird, eine SID zu einem **SIDHistory** -Wert hinzuzufügen, der eine identische sid enthält.</span><span class="sxs-lookup"><span data-stu-id="8cc89-221">The exception is that [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) does not generate an error when attempting to add a SID to a **sIDHistory** that contains an identical SID.</span></span> <span data-ttu-id="8cc89-222">Durch dieses Verhalten kann **dsaddsidhistory** mehrmals mit identischer Eingabe ausgeführt werden, was Erfolg und einen konsistenten Endzustand für die Benutzerfreundlichkeit des Tool Entwicklers zur Folge hat.</span><span class="sxs-lookup"><span data-stu-id="8cc89-222">This behavior enables **DsAddSidHistory** to be run multiple times with identical input, resulting in success and a consistent end state, for tool developer ease-of-use.</span></span>

> [!Note]  
> <span data-ttu-id="8cc89-223">Die Replikations Latenz des globalen Katalogs kann ein Fenster bereitstellen, in dem doppelte SIDs erstellt werden können.</span><span class="sxs-lookup"><span data-stu-id="8cc89-223">Global Catalog replication latency may provide a window during which duplicate SIDs may be created.</span></span> <span data-ttu-id="8cc89-224">Doppelte SIDs können jedoch problemlos von einem Administrator gelöscht werden.</span><span class="sxs-lookup"><span data-stu-id="8cc89-224">However, duplicate SIDs can be easily deleted by an administrator.</span></span>

 

<span data-ttu-id="8cc89-225">*Srcprincipal* und *dstprincipal* müssen einen der folgenden Typen aufweisen:</span><span class="sxs-lookup"><span data-stu-id="8cc89-225">*SrcPrincipal* and *DstPrincipal* must be one of the following types:</span></span>

-   <span data-ttu-id="8cc89-226">Benutzer</span><span class="sxs-lookup"><span data-stu-id="8cc89-226">User</span></span>
-   <span data-ttu-id="8cc89-227">Sicherheits aktivierte Gruppe, einschließlich:</span><span class="sxs-lookup"><span data-stu-id="8cc89-227">Security Enabled Group, including:</span></span>

    <dl> <span data-ttu-id="8cc89-228">Lokale Gruppe</span><span class="sxs-lookup"><span data-stu-id="8cc89-228">Local group</span></span>  
    <span data-ttu-id="8cc89-229">Globale Gruppe</span><span class="sxs-lookup"><span data-stu-id="8cc89-229">Global group</span></span>  
    <span data-ttu-id="8cc89-230">Lokale Domänen Gruppe (nur Windows 2000 einheitlicher Modus)</span><span class="sxs-lookup"><span data-stu-id="8cc89-230">Domain local group (Windows 2000 native mode only)</span></span>  
    <span data-ttu-id="8cc89-231">Universelle Gruppe (nur Windows 2000 einheitlicher Modus)</span><span class="sxs-lookup"><span data-stu-id="8cc89-231">Universal group (Windows 2000 native mode only)</span></span>  
    </dl>

<span data-ttu-id="8cc89-232">Die Objekttypen von *srcprincipal* und *dstprincipal* müssen mit identisch sein.</span><span class="sxs-lookup"><span data-stu-id="8cc89-232">The object types of *SrcPrincipal* and *DstPrincipal* must match.</span></span>

-   <span data-ttu-id="8cc89-233">Wenn *srcprincipal* ein Benutzer ist, muss *dstprincipal* ein Benutzer sein.</span><span class="sxs-lookup"><span data-stu-id="8cc89-233">If *SrcPrincipal* is a User, *DstPrincipal* must be a User.</span></span>
-   <span data-ttu-id="8cc89-234">Wenn *srcprincipal* eine lokale Gruppe oder eine lokale Gruppe der Domäne ist, muss *dstprincipal* eine lokale Gruppe der Domäne sein.</span><span class="sxs-lookup"><span data-stu-id="8cc89-234">If *SrcPrincipal* is a Local or Domain Local Group, *DstPrincipal* must be a Domain Local Group.</span></span>
-   <span data-ttu-id="8cc89-235">Wenn *srcprincipal* eine globale oder universelle Gruppe ist, muss *dstprincipal* eine globale oder universelle Gruppe sein.</span><span class="sxs-lookup"><span data-stu-id="8cc89-235">If *SrcPrincipal* is a Global or Universal Group, *DstPrincipal* must be a Global or Universal Group.</span></span>

<span data-ttu-id="8cc89-236">*Srcprincipal* und *dstprincipal* dürfen keinen der folgenden Typen aufweisen: ([**dsaddsidhistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) schlägt in diesen Fällen mit einem Fehler fehl)</span><span class="sxs-lookup"><span data-stu-id="8cc89-236">*SrcPrincipal* and *DstPrincipal* cannot be one of the following types: ([**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) fails with an error in these cases)</span></span>

-   <span data-ttu-id="8cc89-237">Computer (Arbeitsstation oder Domänen Controller)</span><span class="sxs-lookup"><span data-stu-id="8cc89-237">Computer (workstation or domain controller)</span></span>
-   <span data-ttu-id="8cc89-238">Vertrauensstellung zwischen Domänen</span><span class="sxs-lookup"><span data-stu-id="8cc89-238">Inter-domain trust</span></span>
-   <span data-ttu-id="8cc89-239">Temporäres doppeltes Konto (praktisch nicht verwendetes Feature, Legacy von LanMan)</span><span class="sxs-lookup"><span data-stu-id="8cc89-239">Temporary duplicate account (virtually unused feature, a legacy of LANman)</span></span>
-   <span data-ttu-id="8cc89-240">Konten mit bekannten SIDs.</span><span class="sxs-lookup"><span data-stu-id="8cc89-240">Accounts with Well Known SIDs.</span></span> <span data-ttu-id="8cc89-241">Bekannte SIDs sind in jeder Domäne identisch. das Hinzufügen zu einem **SIDHistory** würde also die SID-Eindeutigkeits Anforderung einer Windows 2000-Gesamtstruktur verletzen.</span><span class="sxs-lookup"><span data-stu-id="8cc89-241">Well Known SIDs are identical in every domain; thus adding them to a **sIDHistory** would violate the SID uniqueness requirement of a Windows 2000 forest.</span></span> <span data-ttu-id="8cc89-242">Konten mit bekannten SIDs enthalten die folgenden lokalen Gruppen:</span><span class="sxs-lookup"><span data-stu-id="8cc89-242">Accounts with Well Known SIDs include the following local groups:</span></span>

    <dl> <span data-ttu-id="8cc89-243">Konto-Operatoren</span><span class="sxs-lookup"><span data-stu-id="8cc89-243">Account operators</span></span>  
    <span data-ttu-id="8cc89-244">Administratoren</span><span class="sxs-lookup"><span data-stu-id="8cc89-244">Administrators</span></span>  
    <span data-ttu-id="8cc89-245">Sicherungs Operatoren</span><span class="sxs-lookup"><span data-stu-id="8cc89-245">Backup operators</span></span>  
    <span data-ttu-id="8cc89-246">Gäste</span><span class="sxs-lookup"><span data-stu-id="8cc89-246">Guests</span></span>  
    <span data-ttu-id="8cc89-247">Druck Operatoren</span><span class="sxs-lookup"><span data-stu-id="8cc89-247">Print operators</span></span>  
    <span data-ttu-id="8cc89-248">Replicator</span><span class="sxs-lookup"><span data-stu-id="8cc89-248">Replicator</span></span>  
    <span data-ttu-id="8cc89-249">Server-Operatoren</span><span class="sxs-lookup"><span data-stu-id="8cc89-249">Server operators</span></span>  
    <span data-ttu-id="8cc89-250">Benutzer</span><span class="sxs-lookup"><span data-stu-id="8cc89-250">Users</span></span>  
    </dl>

<span data-ttu-id="8cc89-251">Wenn *srcprincipal* über eine bekannte relative Kennung (RID) und ein Domänen spezifisches Präfix verfügt, d. h. Domänen Administratoren, Domänen Benutzer und Domänen Computer, muss *dstprincipal* dieselbe bekannte Rid aufweisen, damit [**dsaddsidhistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) erfolgreich ausgeführt werden kann.</span><span class="sxs-lookup"><span data-stu-id="8cc89-251">If *SrcPrincipal* has a well-known relative identifier (RID) and a domain specific prefix, that is, Domain Administrators, Domain Users, and Domain Computers, then *DstPrincipal* must possess the same well-known RID in order for [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) to succeed.</span></span> <span data-ttu-id="8cc89-252">Konten mit bekannten RIDs enthalten folgende Benutzer und globale Gruppen:</span><span class="sxs-lookup"><span data-stu-id="8cc89-252">Accounts with well-known RIDs include the following users and global groups:</span></span>

-   <span data-ttu-id="8cc89-253">Administrator</span><span class="sxs-lookup"><span data-stu-id="8cc89-253">Administrator</span></span>
-   <span data-ttu-id="8cc89-254">Gast</span><span class="sxs-lookup"><span data-stu-id="8cc89-254">Guest</span></span>
-   <span data-ttu-id="8cc89-255">Domänen Administratoren</span><span class="sxs-lookup"><span data-stu-id="8cc89-255">Domain administrators</span></span>
-   <span data-ttu-id="8cc89-256">Domänen Gäste</span><span class="sxs-lookup"><span data-stu-id="8cc89-256">Domain guests</span></span>
-   <span data-ttu-id="8cc89-257">Domänenbenutzer</span><span class="sxs-lookup"><span data-stu-id="8cc89-257">Domain users</span></span>

## <a name="setting-the-registry-value"></a><span data-ttu-id="8cc89-258">Festlegen des Registrierungs Werts</span><span class="sxs-lookup"><span data-stu-id="8cc89-258">Setting the Registry Value</span></span>

<span data-ttu-id="8cc89-259">Im folgenden Verfahren wird gezeigt, wie der Registrierungs Wert TcpipClientSupport festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="8cc89-259">The following procedure shows how to set the TcpipClientSupport registry value.</span></span>

<span data-ttu-id="8cc89-260">**So legen Sie den Registrierungs Wert "TcpipClientSupport" fest**</span><span class="sxs-lookup"><span data-stu-id="8cc89-260">**To Set the TcpipClientSupport Registry Value**</span></span>

1.  <span data-ttu-id="8cc89-261">Erstellen Sie den folgenden Registrierungs Wert als reg \_ DWORD-Wert auf dem Quell Domänen Controller, und legen Sie seinen Wert auf 1 fest.</span><span class="sxs-lookup"><span data-stu-id="8cc89-261">Create the following registry value as a REG\_DWORD value on the source domain controller and set its value to 1.</span></span>

    <span data-ttu-id="8cc89-262">**HKEY \_ local \_ Machine \\ System \\ CurrentControlSet \\ Control \\ LSA \\ TcpipClientSupport**</span><span class="sxs-lookup"><span data-stu-id="8cc89-262">**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\TcpipClientSupport**</span></span>

2.  <span data-ttu-id="8cc89-263">Starten Sie dann den Quell Domänen Controller neu.</span><span class="sxs-lookup"><span data-stu-id="8cc89-263">Then, restart the source domain controller.</span></span> <span data-ttu-id="8cc89-264">Dieser Registrierungs Wert bewirkt, dass Sam an TCP/IP lauscht.</span><span class="sxs-lookup"><span data-stu-id="8cc89-264">This registry value causes the SAM to listen on TCP/IP.</span></span> <span data-ttu-id="8cc89-265">[**Dsaddsidhistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) schlägt fehl, wenn dieser Wert nicht auf dem Quell Domänen Controller festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="8cc89-265">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) will fail if this value is not set on the source domain controller.</span></span>

## <a name="enabling-auditing-of-usergroup-management-events"></a><span data-ttu-id="8cc89-266">Aktivieren der Überwachung von Ereignissen zur Benutzer-/Gruppenverwaltung</span><span class="sxs-lookup"><span data-stu-id="8cc89-266">Enabling Auditing of User/Group Management Events</span></span>

<span data-ttu-id="8cc89-267">Das folgende Verfahren zeigt, wie Sie die Überwachung von Ereignissen für die Benutzer-/Gruppenverwaltung in einer Windows 2000-oder Windows Server 2003-Quell-oder-Zieldomäne aktivieren.</span><span class="sxs-lookup"><span data-stu-id="8cc89-267">The following procedure shows how to enable auditing of User/Group management events in a Windows 2000 or Windows Server 2003 source or destination domain.</span></span>

<span data-ttu-id="8cc89-268">**So aktivieren Sie die Überwachung von Benutzer-/gruppenverwaltungsereignissen in einer Windows 2000-oder Windows Server 2003-Quell-oder-Zieldomäne**</span><span class="sxs-lookup"><span data-stu-id="8cc89-268">**To enable auditing of User/Group management events in a Windows 2000 or Windows Server 2003 source or destination domain**</span></span>

1.  <span data-ttu-id="8cc89-269">Wählen Sie im MMC-Snap-in Active Directory-Benutzer und-Computer den Container Domänen Controller der Zieldomäne aus.</span><span class="sxs-lookup"><span data-stu-id="8cc89-269">In the Active Directory Users and Computers MMC Snap-in, select the destination domain Domain Controllers container.</span></span>
2.  <span data-ttu-id="8cc89-270">Klicken **Sie mit** der rechten Maustaste auf **Domänen Controller** .</span><span class="sxs-lookup"><span data-stu-id="8cc89-270">Right-click **Domain Controllers** and choose **Properties**.</span></span>
3.  <span data-ttu-id="8cc89-271">Klicken Sie auf die Registerkarte **Gruppenrichtlinie** .</span><span class="sxs-lookup"><span data-stu-id="8cc89-271">Click the **Group Policy** tab.</span></span>
4.  <span data-ttu-id="8cc89-272">Wählen Sie die **Standard Domänen Controller Richtlinie** aus, und klicken Sie auf **Bearbeiten**</span><span class="sxs-lookup"><span data-stu-id="8cc89-272">Select the **Default Domain Controllers Policy** and click **Edit**.</span></span>
5.  <span data-ttu-id="8cc89-273">Doppelklicken Sie unter **Computer Konfiguration \\ Windows-Einstellungen \\ Sicherheitseinstellungen \\ lokale Richtlinien Überwachungs \\ Richtlinie** auf **Kontoverwaltung** überwachen.</span><span class="sxs-lookup"><span data-stu-id="8cc89-273">Under **Computer Configuration\\Windows Settings\\Security Settings\\Local Policies\\Audit Policy**, double-click **Audit Account Management**.</span></span>
6.  <span data-ttu-id="8cc89-274">Wählen Sie im Fenster Überwachungs **Kontoverwaltung** sowohl **erfolgreiche** als auch **Fehler** hafte Überwachung aus.</span><span class="sxs-lookup"><span data-stu-id="8cc89-274">In the **Audit Account Management** window, select both **Success** and **Failure** auditing.</span></span> <span data-ttu-id="8cc89-275">Richtlinien Updates werden nach einem Neustart oder nach einer Aktualisierung wirksam.</span><span class="sxs-lookup"><span data-stu-id="8cc89-275">Policy updates take effect after a restart or after a refresh occurs.</span></span>
7.  <span data-ttu-id="8cc89-276">Überprüfen Sie, ob die Überwachung aktiviert ist, indem Sie die effektive Überwachungsrichtlinie im Gruppenrichtlinie MMC-Snap-in anzeigen.</span><span class="sxs-lookup"><span data-stu-id="8cc89-276">Verify that auditing is enabled by viewing the effective audit policy in the Group Policy MMC Snap-in.</span></span>

<span data-ttu-id="8cc89-277">Das folgende Verfahren zeigt, wie Sie die Überwachung von Ereignissen für die Benutzer-/Gruppenverwaltung in einer Windows NT 4,0-Domäne aktivieren.</span><span class="sxs-lookup"><span data-stu-id="8cc89-277">The following procedure shows how to enable auditing of User/Group management events in a Windows NT 4.0 domain.</span></span>

<span data-ttu-id="8cc89-278">**So aktivieren Sie die Überwachung von Benutzer-/gruppenverwaltungsereignissen in einer Windows NT 4,0-Domäne**</span><span class="sxs-lookup"><span data-stu-id="8cc89-278">**To enable auditing of User/Group management events in a Windows NT 4.0 domain**</span></span>

1.  <span data-ttu-id="8cc89-279">Klicken Sie im **Benutzer-Manager für Domänen** auf das Menü **Richtlinien** , **und wählen Sie** überwachen</span><span class="sxs-lookup"><span data-stu-id="8cc89-279">In **User Manager for Domains**, click the **Policies** menu and select **Audit**.</span></span>
2.  <span data-ttu-id="8cc89-280">Wählen Sie **diese Ereignisse** überwachen aus.</span><span class="sxs-lookup"><span data-stu-id="8cc89-280">Select **Audit These Events**.</span></span>
3.  <span data-ttu-id="8cc89-281">Überprüfen Sie für die **Benutzer-und Gruppenverwaltung** den **Erfolg und den Fehler**.</span><span class="sxs-lookup"><span data-stu-id="8cc89-281">For **User and Group Management**, check **Success and Failure**.</span></span>

<span data-ttu-id="8cc89-282">Das folgende Verfahren zeigt, wie Sie die Überwachung von Benutzer-/gruppenverwaltungsereignissen in einer Windows NT 4,0-, Windows 2000-oder Windows Server 2003-Quell Domäne aktivieren.</span><span class="sxs-lookup"><span data-stu-id="8cc89-282">The following procedure shows how to enable auditing of User/Group management events in a Windows NT 4.0, Windows 2000, or Windows Server 2003 source domain.</span></span>

<span data-ttu-id="8cc89-283">**So aktivieren Sie die Überwachung von Benutzer-/gruppenverwaltungsereignissen in einer Windows NT 4,0-, Windows 2000-oder Windows Server 2003-Quell Domäne**</span><span class="sxs-lookup"><span data-stu-id="8cc89-283">**To enable auditing of User/Group management events in a Windows NT 4.0, Windows 2000, or Windows Server 2003 source domain**</span></span>

1.  <span data-ttu-id="8cc89-284">Klicken Sie im **Benutzer-Manager für Domänen** auf das **Benutzer** Menü, und wählen Sie **neue lokale Gruppe** aus.</span><span class="sxs-lookup"><span data-stu-id="8cc89-284">In **User Manager for Domains**, click the **User** menu and select **New Local Group**.</span></span>
2.  <span data-ttu-id="8cc89-285">Geben Sie einen Gruppennamen ein, der aus dem NetBIOS-Namen der Quell Domäne besteht, der mit drei Dollarzeichen ($) angehängt wird, z. b. fabrikam $ $ $.</span><span class="sxs-lookup"><span data-stu-id="8cc89-285">Enter a group name composed of the source domain NetBIOS name appended with three dollar signs ($), for example, FABRIKAM$$$.</span></span> <span data-ttu-id="8cc89-286">Das Beschreibungsfeld sollte angeben, dass diese Gruppe verwendet wird, um die Verwendung von [**dsaddsidhistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) oder Klon Vorgängen zu überwachen.</span><span class="sxs-lookup"><span data-stu-id="8cc89-286">The description field should indicate that this group is used to audit use of [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) or cloning operations.</span></span> <span data-ttu-id="8cc89-287">Stellen Sie sicher, dass in der Gruppe keine Mitglieder vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="8cc89-287">Ensure there are no members in the group.</span></span> <span data-ttu-id="8cc89-288">Klicken Sie auf **OK**.</span><span class="sxs-lookup"><span data-stu-id="8cc89-288">Click **OK**.</span></span>

<span data-ttu-id="8cc89-289">Der [**dsaddsidhistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) -Vorgang schlägt fehl, wenn die Quell-und Ziel Überwachung nicht aktiviert ist, wie hier beschrieben.</span><span class="sxs-lookup"><span data-stu-id="8cc89-289">The [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) operation fails if source and destination auditing are not enabled as described here.</span></span>

## <a name="set-up-trust-if-required"></a><span data-ttu-id="8cc89-290">Einrichten von Vertrauens Stellungen bei Bedarf</span><span class="sxs-lookup"><span data-stu-id="8cc89-290">Set up Trust if Required</span></span>

<span data-ttu-id="8cc89-291">Wenn einer der folgenden Punkte zutrifft, muss eine Vertrauensstellung von der Quell Domäne zur Zieldomäne eingerichtet werden (Dies muss in einer anderen Gesamtstruktur Vorkommen):</span><span class="sxs-lookup"><span data-stu-id="8cc89-291">If one of the following is true, a trust must be established from the source domain to the destination domain (this must occur in a different forest):</span></span>

-   <span data-ttu-id="8cc89-292">Die Quell Domäne ist Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="8cc89-292">The source domain is Windows Server 2003.</span></span>
-   <span data-ttu-id="8cc89-293">Die Quell Domäne ist Windows NT 4,0, und *srcdomaincreds* ist **null**.</span><span class="sxs-lookup"><span data-stu-id="8cc89-293">The source domain is Windows NT 4.0 and *SrcDomainCreds* is **NULL**.</span></span>

 

 





