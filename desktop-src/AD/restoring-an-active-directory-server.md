---
title: Wiederherstellen eines Active Directory Servers
description: Active Directory Server müssen offline wieder hergestellt werden.
ms.assetid: 91fbbdc1-0e84-4b89-8a38-4c8d0268992b
ms.tgt_platform: multiple
keywords:
- Active Directory wird wieder hergestellt Active Directory
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 273d02fd50d6b3bd68a055a6a783566e4ebddcf7
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/17/2020
ms.locfileid: "103858121"
---
# <a name="restoring-an-active-directory-server"></a><span data-ttu-id="55094-104">Wiederherstellen eines Active Directory Servers</span><span class="sxs-lookup"><span data-stu-id="55094-104">Restoring an Active Directory Server</span></span>

<span data-ttu-id="55094-105">Active Directory Server müssen offline wieder hergestellt werden.</span><span class="sxs-lookup"><span data-stu-id="55094-105">Active Directory servers must be restored offline.</span></span> <span data-ttu-id="55094-106">Das System muss im Verzeichnisdienst-Wiederherstellungs Modus neu gestartet werden.</span><span class="sxs-lookup"><span data-stu-id="55094-106">The system must be restarted in Directory Services Restore mode.</span></span> <span data-ttu-id="55094-107">In diesem Modus wird das Betriebssystem ohne Active Directory Domain Services ausgeführt, und alle Benutzer Validierung erfolgt über den Sicherheits Konten-Manager (Security Accounts Manager, Sam) in der Registrierung.</span><span class="sxs-lookup"><span data-stu-id="55094-107">In this mode, the operating system is running without Active Directory Domain Services and all user validation occurs through the Security Accounts Manager (SAM) in the registry.</span></span> <span data-ttu-id="55094-108">Verwenden Sie zum Wiederherstellen Active Directory Domain Services die Anmelde Informationen eines lokalen Administrators auf dem wiederhergestellten Domänen Controller.</span><span class="sxs-lookup"><span data-stu-id="55094-108">To restore Active Directory Domain Services, use the credentials of a local administrator on the domain controller that is restored.</span></span>

<span data-ttu-id="55094-109">Der Aufrufer der Wiederherstellungs Funktionen muss über die Berechtigung " **SE \_ Restore \_ Name** Access" verfügen.</span><span class="sxs-lookup"><span data-stu-id="55094-109">The caller of the restore functions must have the **SE\_RESTORE\_NAME** access privilege.</span></span> <span data-ttu-id="55094-110">Verwenden Sie die [**dssetauthidentity**](dssetauthidentity.md) -Funktion, um den Sicherheitskontext festzulegen, unter dem die Verzeichnis Sicherungs-und Wiederherstellungs Funktionen aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="55094-110">Use the [**DsSetAuthIdentity**](dssetauthidentity.md) function to set the security context under which the directory backup and restore functions are called.</span></span>

<span data-ttu-id="55094-111">Beachten Sie, dass Sie bei der Wiederherstellung Active Directory Domain Services auch die anderen Systemstatus Komponenten wiederherstellen müssen.</span><span class="sxs-lookup"><span data-stu-id="55094-111">Be aware that when you restore Active Directory Domain Services, you must also restore the other system state components.</span></span>

<span data-ttu-id="55094-112">**Wiederherstellung Active Directory Domain Services**</span><span class="sxs-lookup"><span data-stu-id="55094-112">**To restore Active Directory Domain Services**</span></span>

1.  <span data-ttu-id="55094-113">Ruft die [**dsisntdsonline**](dsisntdsonline.md) -Funktion auf, um zu bestimmen, ob Active Directory Domain Services ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="55094-113">Call the [**DsIsNTDSOnline**](dsisntdsonline.md) function to determine if Active Directory Domain Services are running.</span></span>
2.  <span data-ttu-id="55094-114">Wenn Active Directory Domain Services nicht ausgeführt werden, wird die [**dsrestoreprepare**](dsrestoreprepare.md) -Funktion aufgerufen, um den Wiederherstellungs Vorgang zu initialisieren und ein Sicherungs Kontext Handle abzurufen.</span><span class="sxs-lookup"><span data-stu-id="55094-114">If Active Directory Domain Services are not running, the [**DsRestorePrepare**](dsrestoreprepare.md) function is called to initialize the restore operation and obtain a backup context handle.</span></span> <span data-ttu-id="55094-115">Wenn Active Directory Domain Services ausgeführt wird, kann es nicht wieder hergestellt werden, und die Wiederherstellungs Anwendung muss den Wiederherstellungs Vorgang fehlschlagen.</span><span class="sxs-lookup"><span data-stu-id="55094-115">If Active Directory Domain Services are running, it cannot be restored and the restore application must fail the restore operation.</span></span> <span data-ttu-id="55094-116">Die **dsrestoreprepare** -Funktion erfordert, dass das ablauftoken während des Sicherungs Vorgangs von der [**dsbackupprepare**](dsbackupprepare.md) -Funktion abgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="55094-116">The **DsRestorePrepare** function requires that the expiry token be obtained from the [**DsBackupPrepare**](dsbackupprepare.md) function during the backup operation.</span></span>
3.  <span data-ttu-id="55094-117">Aufrufen der [**dsrestoregetdatabaselocations**](dsrestoregetdatabaselocations.md) -Funktion zum Bestimmen der Verzeichnisse, in denen die Dateien wieder hergestellt werden sollen.</span><span class="sxs-lookup"><span data-stu-id="55094-117">Call the [**DsRestoreGetDatabaseLocations**](dsrestoregetdatabaselocations.md) function to determine the directories where the files are to be restored.</span></span> <span data-ttu-id="55094-118">Wenn diese Funktion fehlschlägt, stellen Sie die Daten im ursprünglichen Sicherungs Quellverzeichnis wieder her. Das ist das Verzeichnis, aus dem die Daten gesichert wurden.</span><span class="sxs-lookup"><span data-stu-id="55094-118">If this function fails, restore the data back to the original backup source directory; that is the directory from which the data was backed up.</span></span>
4.  <span data-ttu-id="55094-119">Wenden Sie die [**dsrestoreregiester**](dsrestoreregister.md) -Funktion an, um den Active Directory Server für den Wiederherstellungs Vorgang vorzubereiten und die Wiederherstellungs Verzeichnisse zu sperren.</span><span class="sxs-lookup"><span data-stu-id="55094-119">Call the [**DsRestoreRegister**](dsrestoreregister.md) function to prepare the Active Directory server for the restore operation and lock the restore directories.</span></span>
5.  <span data-ttu-id="55094-120">Verwenden Sie Win32-Standardfunktionen, um die Dateien wiederherzustellen.</span><span class="sxs-lookup"><span data-stu-id="55094-120">Use standard Win32 functions to restore the files.</span></span> <span data-ttu-id="55094-121">Löschen Sie zuerst alle Dateien im Zielverzeichnis. Kopieren Sie dann die Sicherungsdateien in das Zielverzeichnis.</span><span class="sxs-lookup"><span data-stu-id="55094-121">First, delete all files in the destination directory; then copy the backup files to the destination directory.</span></span>
6.  <span data-ttu-id="55094-122">Wenden Sie die [**dsrestoreregistercomplete**](dsrestoreregistercomplete.md) -Funktion an, um anzugeben, dass die Wiederherstellung abgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="55094-122">Call the [**DsRestoreRegisterComplete**](dsrestoreregistercomplete.md) function to indicate that the restore has completed.</span></span>
7.  <span data-ttu-id="55094-123">Ruft die [**dsrestoreend**](dsrestoreend.md) -Funktion auf, um alle dem Kontext zugeordneten Ressourcen freizugeben.</span><span class="sxs-lookup"><span data-stu-id="55094-123">Call the [**DsRestoreEnd**](dsrestoreend.md) function to release any resources associated with the context.</span></span>

<span data-ttu-id="55094-124">Nach einer Wiederherstellung im Verzeichnisdienst-Wiederherstellungs Modus sollte der Domänen Controller im normalen Modus neu gestartet werden.</span><span class="sxs-lookup"><span data-stu-id="55094-124">After a restore in Directory Services Restore mode, the domain controller should be restarted in normal mode.</span></span> <span data-ttu-id="55094-125">Wenn der Verzeichnisdienst gestartet wird, führt der Domänen Controller die normale Konsistenzprüfung durch, und das wiederhergestellte Verzeichnis wird dann online geschaltet.</span><span class="sxs-lookup"><span data-stu-id="55094-125">When the directory service starts, the domain controller will perform the normal consistency check and the restored directory will then be online.</span></span>

<span data-ttu-id="55094-126">Beachten Sie, dass das Wiederherstellen eines Active Directory Servers immer ein zweiteilige Vorgang ist.</span><span class="sxs-lookup"><span data-stu-id="55094-126">Be aware that restoring an Active Directory server is always a two-part operation.</span></span> <span data-ttu-id="55094-127">Stellen Sie zunächst die Datenbank zu einem Zeitpunkt wieder her, zu dem die Sicherung erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="55094-127">First, restore the database to a time when the backup was taken.</span></span> <span data-ttu-id="55094-128">Zweitens: Replizieren Sie das Verzeichnis, in dem die neu wiederhergestellten DSA-Updates nach der Sicherung von anderen DSAs in der Domäne und in der Unternehmens Gesamtstruktur repliziert werden.</span><span class="sxs-lookup"><span data-stu-id="55094-128">Second, replicate the directory, where the newly restored DSA replicates post-backup updates from other DSAs in the domain and enterprise forest.</span></span>

<span data-ttu-id="55094-129">Ein Computer unter Windows 2000 oder Windows Server 2003, der ein Replikat des Verzeichnis Dienstanbieter enthält, ist ein Domänen Controller.</span><span class="sxs-lookup"><span data-stu-id="55094-129">A computer running on Windows 2000 or Windows Server 2003, that contains a replica of the directory service, is a domain controller.</span></span>

<span data-ttu-id="55094-130">Die [**dsrestoreregisterfunktion**](dsrestoreregister.md) fügt Daten zur Registrierung hinzu, die den Registrierungsvorgang für die Wiederherstellung überstehen müssen, damit die Wiederherstellung ordnungsgemäß funktioniert.</span><span class="sxs-lookup"><span data-stu-id="55094-130">The [**DsRestoreRegister**](dsrestoreregister.md) function adds data to the registry that must survive the registry restoration process for the restoration to work correctly.</span></span> <span data-ttu-id="55094-131">Um sicherzustellen, dass diese Registrierungsdaten beibehalten werden, stellen Sie Active Directory Domain Services mit den **DSRestore \*** -Funktionen wieder her, bevor Sie den Computer neu starten, nachdem die [**RegReplaceKey**](/windows/desktop/api/winreg/nf-winreg-regreplacekeya) -Funktion aufgerufen wurde.</span><span class="sxs-lookup"><span data-stu-id="55094-131">To ensure this registry data is preserved, restore Active Directory Domain Services with the **DsRestore\*** functions prior to restarting the computer after the [**RegReplaceKey**](/windows/desktop/api/winreg/nf-winreg-regreplacekeya) function is called.</span></span> <span data-ttu-id="55094-132">Dieser Prozess funktioniert, weil **RegReplaceKey** die Registrierungs Struktur nicht tatsächlich ersetzt, bis der Computer neu gestartet wird, und die von der **dsrestoreregisterfunktion** hinzugefügten Registrierungsdaten werden beim Wiederherstellungs Vorgang einer Registrierung ausdrücklich ausgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="55094-132">This process works because **RegReplaceKey** does not actually replace the registry hive until the computer is restarted and the registry data added by the **DsRestoreRegister** function is specifically excluded from being replaced during a registry restore operation.</span></span>

 

 