---
title: Festlegen von Zugriffsrechten für ein Objekt
description: In diesem Thema wird beschrieben, wie ein ACE für ein Zugriffsrecht erstellt und dieser ACE für die DACL eines Objekts festgelegt wird.
ms.assetid: c0b45709-4652-46c7-8d52-44076802d109
ms.tgt_platform: multiple
keywords:
- Festlegen von Zugriffsrechten für ein Objekt
- Objekte AD, Festlegen von Zugriffsrechten für ein Objekt
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2bcf54de381dab2af1dab4ea44654fb0a5682f06
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/17/2020
ms.locfileid: "104472468"
---
# <a name="setting-access-rights-on-an-object"></a>Festlegen von Zugriffsrechten für ein Objekt

Bei Verwendung der ADSI-COM-Objekte [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) (Sicherheits Beschreibung), [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) (DACLs und SACLs) und [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) (ACE) zum Hinzufügen eines ACE zu einer ACL nehmen Sie Änderungen an der **ntSecurityDescriptor** -Eigenschaft des angegebenen Objekts im Eigenschafts Cache vor. Dies bedeutet, dass Put-Methoden für die Objekte, die den neuen ACE enthalten, und die [**IADs. SetInfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo) -Methode aufgerufen werden müssen, um die aktualisierte Sicherheits Beschreibung aus dem Eigenschafts Cache in das Verzeichnis zu schreiben.

Weitere Informationen und ein Codebeispiel, in dem ein ACE für ein Objekt in Active Directory Domain Services festgelegt wird, finden Sie unter [Beispielcode für das Festlegen eines ACE für ein Verzeichnis Objekt](example-code-for-setting-an-ace-on-a-directory-object.md).

Verwenden Sie den folgenden allgemeinen Prozess, um einen ACE für ein Zugriffsrecht zu erstellen und diesen ACE für die DACL eines Objekts festzulegen.

1.  Einen [**IADs**](/windows/desktop/api/iads/nn-iads-iads) -Schnittstellen Zeiger auf das-Objekt zu erhalten.
2.  Verwenden Sie die [**IADs. Get**](/windows/desktop/api/iads/nf-iads-iads-get) -Methode, um die Sicherheits Beschreibung des-Objekts zu erhalten. Der Name der Eigenschaft, die die Sicherheits Beschreibung enthält, ist **ntSecurityDescriptor**. Die-Eigenschaft wird als [**Variant**](/windows/win32/api/oaidl/ns-oaidl-variant) zurückgegeben, die einen [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) -Zeiger enthält (das **VT** -Element ist **VT \_ Dispatch**). Aufrufen von **QueryInterface** für diesen **IDispatch** -Zeiger, um eine [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) -Schnittstelle zu erhalten, mit der die Methoden für diese Schnittstelle für den Zugriff auf die ACL der Sicherheits Beschreibung verwendet werden.
3.  Verwenden Sie die Eigenschaft [**IADsSecurityDescriptor. diskretionaryacl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) , um die DACL zu erhalten. Die-Methode gibt einen [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) -Zeiger zurück. Ruft **QueryInterface** für diesen **IDispatch** -Zeiger auf, um eine [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) -Schnittstelle zu erhalten, mit der die Methoden für diese Schnittstelle für den Zugriff auf die einzelnen ACEs in der ACL verwendet werden.
4.  Verwenden Sie [**cokreateinstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) , um das ADSI COM-Objekt für den neuen ACE zu erstellen, und rufen Sie einen [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) -Schnittstellen Zeiger auf dieses Objekt ab. Beachten Sie, dass die Klassen-ID CLSID \_ AccessControlEntry ist.
5.  Legen Sie die Eigenschaften des ACE mithilfe der [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) -Methoden fest:

    1.  Verwenden Sie [**IADsAccessControlEntry::p \_ UT**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) -Vertrauens nehmer, um den Treuhänder festzulegen, für den dieser ACE gilt. Der Vertrauens nehmer ist ein Benutzer, eine Gruppe oder ein anderer Sicherheits Prinzipal. Die Anwendung sollte den Wert aus der entsprechenden Eigenschaft aus dem Benutzer-oder Gruppen Objekt des Vertrauens nehmers verwenden, auf den Sie den ACE anwenden möchten. Der Vertrauens nehmer ist als **BSTR** angegeben und kann die folgenden Formen annehmen:
        -   Das Domänen Konto (der Anmelde Name, das in einer früheren Version von Windows NT verwendet wurde) im Format " <domain> \\ <user account> ", wobei " &lt; Domäne &gt; " der Name der Windows NT-Domäne mit dem Benutzer und " &lt; Benutzerkonto &gt; " ist die **sAMAccountName** -Eigenschaft des angegebenen Benutzers. Beispiel: "Fabrikam \\ JeffSmith".
        -   Ein bekannter Sicherheits Prinzipal, der besondere Identitäten darstellt, die vom Windows NT-Sicherheitssystem definiert werden, wie z. b. "alle", "Lokales System", "Prinzipal selbst", "authentifizierter Benutzer", "Ersteller Die-Objekte, die die bekannten Sicherheits Prinzipale darstellen, werden im Container für bekannte Sicherheits Prinzipale unterhalb des Konfigurations Containers gespeichert. Beispielsweise anonyme Anmeldung.
        -   Integrierte Gruppe, die die integrierten Benutzergruppen darstellt, die vom Windows NT-Sicherheitssystem definiert werden. Sie hat die Form "Builtin \\ <group name> ", wobei " &lt; Gruppenname &gt; " der Name der integrierten Benutzergruppe ist. Die Objekte, die die integrierten Gruppen darstellen, werden im Container "Builtin" unterhalb des Domänen Containers gespeichert. Beispiel: "Builtin \\ Administrators".
        -   SID (Zeichen folgen Format) des angegebenen Benutzers, bei dem es sich um die **objectSID** -Eigenschaft des angegebenen Benutzers handelt. Sie können in ein Zeichen folgen Formular konvertieren, indem Sie die [**convertsidtstringsid**](/windows/desktop/api/sddl/nf-sddl-convertsidtostringsida) -Funktion in der Win32-Sicherheits-API verwenden. Beispiel: "S-1-5-32-548".
    2.  Verwenden Sie die [**IADsAccessControlEntry. AccessMask**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) -Eigenschaft, um die Maske festzulegen, die das Zugriffsrecht angibt. Die [**AD \_ Rights \_ enum**](/windows/win32/api/iads/ne-iads-ads_rights_enum) -Enumeration gibt die Zugriffsrechte an, die Sie für ein Verzeichnis Objekt festlegen können.
    3.  Verwenden Sie die [**IADsAccessControlEntry. AceType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) -Eigenschaft, um anzugeben, ob die von **AccessMask** festgelegten Zugriffsrechte zugelassen oder verweigert werden. Bei Standard rechten kann es sich um den Zugriff auf den Zugriff auf die Zugriffsberechtigung für den Benutzer oder den Zugriff auf den **\_ \_ Zugriff \_ auf ADS** **\_ \_ \_** Verwenden Sie für objektspezifische Rechte (Rechte, die für einen bestimmten Teil eines Objekts oder für einen bestimmten Objekttyp gelten) das Objekt " **ADS- \_ AceType- \_ Zugriff \_ zugelassen \_** " oder " **ADS- \_ AceType- \_ \_ \_ Objekt verweigert**". Die ADS-Aufzählungs- [**\_ AceType \_**](/windows/win32/api/iads/ne-iads-ads_acetype_enum) -Enumeration gibt die Zugriffs Typen an, die Sie für einen ACE festlegen können.
    4.  Verwenden Sie die Eigenschaft [**IADsAccessControlEntry. AceFlags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) , um anzugeben, ob andere Container oder Objekte unterhalb des angegebenen Objekts den ACE erben können. Die Enumeration " [**ADS \_ aceflag \_ enum**](/windows/win32/api/iads/ne-iads-ads_aceflag_enum) " gibt die Vererbungs Flags an, die Sie für einen ACE festlegen können.
    5.  Verwenden Sie die Eigenschaft [**IADsAccessControlEntry. Flags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) , um anzugeben, ob das Recht für einen bestimmten Teil des Objekts, einen vererbten Objekttyp oder beides gilt.
    6.  Wenn **Flags** auf **ADS Flag- \_ \_ \_ Objekttyp \_ vorhanden** festgelegt ist, legen Sie die [**IADsAccessControlEntry. ObjectType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) -Eigenschaft o fest, und geben Sie eine Zeichenfolge mit der GUID der Objektklasse an (für **ADS \_ right \_ DS \_ Create \_ Child** or **ADS \_ right \_ DS \_ Delete \_ Child**), Property, Property Set, validierte Write oder Extended right, auf die der ACE angewendet Die GUID muss als Zeichenfolge der Form angegeben werden, die von der [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) -Funktion in der com-Bibliothek erstellt wird.
    7.  Legen Sie die [**IADsAccessControlEntry. eritedobjecttype**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) -Eigenschaft auf fest, um eine Zeichenfolge anzugeben, die die GUID der geerbten Objektklasse enthält, auf die der ACE angewendet wird, wenn **Flags** auf ADS festgelegt sind **\_ \_ \_ \_ \_**. Die GUID muss als Zeichenfolge der Form angegeben werden, die von der [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) -Funktion in der com-Bibliothek erstellt wird.

6.  Verwenden Sie die **QueryInterface** -Methode für das [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) -Objekt, um einen [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) -Zeiger zu erhalten. Die [**IADsAccessControlList. addace**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) -Methode erfordert einen **IDispatch** -Schnittstellen Zeiger auf den ACE.
7.  Verwenden Sie [**IADsAccessControlList. addace**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) , um den neuen ACE der DACL hinzuzufügen. Beachten Sie, dass sich die Reihenfolge der ACEs innerhalb der ACL auf die Auswertung des Zugriffs auf das Objekt auswirken kann. Der richtige Zugriff auf das Objekt erfordert möglicherweise, dass Sie eine neue ACL erstellen, die ACEs aus der vorhandenen ACL in der richtigen Reihenfolge der neuen ACL hinzufügen und dann die vorhandene ACL in der Sicherheits Beschreibung durch die neue ACL ersetzen. Weitere Informationen finden Sie unter [Reihenfolge von ACEs in einer DACL](/windows/desktop/SecAuthZ/order-of-aces-in-a-dacl).
8.  Verwenden Sie die Eigenschaft [**IADsSecurityDescriptor. diskretionaryacl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) , um die DACL mit dem neuen ACE in die Sicherheits Beschreibung zu schreiben. Weitere Informationen zu DACLs finden Sie unter [null-DACLs und leere DACLs](null-dacls-and-empty-dacls.md).
9.  Verwenden Sie die [**IADs. Put**](/windows/desktop/api/iads/nf-iads-iads-put) -Methode, um die Sicherheits Beschreibung in die **ntSecurityDescriptor** -Eigenschaft des Objekts in den Eigenschaften Cache zu schreiben.
10. Verwenden Sie die [**IADs. SetInfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo) -Methode, um die-Eigenschaft für das Objekt im Verzeichnis zu aktualisieren.

 

 