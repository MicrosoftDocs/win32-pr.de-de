---
title: Festlegen von Zugriffsrechten für ein Objekt
description: In diesem Thema wird beschrieben, wie Sie einen ACE für ein Zugriffsrecht erstellen und diesen ACE für die DACL eines Objekts festlegen.
ms.assetid: c0b45709-4652-46c7-8d52-44076802d109
ms.tgt_platform: multiple
keywords:
- Festlegen von Zugriffsrechten für ein Objekt-AD
- Objekte AD , Festlegen von Zugriffsrechten für ein Objekt
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7b6d0983246b0f7a39225d11ef5d919b3b26230699209e86812ad68928d072e5
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/11/2021
ms.locfileid: "118183429"
---
# <a name="setting-access-rights-on-an-object"></a>Festlegen von Zugriffsrechten für ein Objekt

Wenn Sie die ADSI-COM-Objekte [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) (Sicherheitsdeskriptor), [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) (DACLs und SACLs) und [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) (ACE) zum Hinzufügen eines ACE zu einer ACL verwenden, ändern Sie die **nTSecurityDescriptor-Eigenschaft** des angegebenen Objekts im Eigenschaftencache. Dies bedeutet, dass Methoden für die Objekte abgelegt werden müssen, die den neuen ACE enthalten, und die [**IADs.SetInfo-Methode**](/windows/desktop/api/iads/nf-iads-iads-setinfo) muss aufgerufen werden, um den aktualisierten Sicherheitsdeskriptor aus dem Eigenschaftencache in das Verzeichnis zu schreiben.

Weitere Informationen und ein Codebeispiel, das einen ACE für ein Objekt in Active Directory Domain Services festlegt, finden Sie unter [Beispielcode zum Festlegen eines ACE für ein Verzeichnisobjekt.](example-code-for-setting-an-ace-on-a-directory-object.md)

Verwenden Sie den folgenden allgemeinen Prozess, um einen ACE für ein Zugriffsrecht zu erstellen und diesen ACE für die DACL eines Objekts festzulegen.

1.  Abrufen eines [**IADs-Schnittstellenzeigers**](/windows/desktop/api/iads/nn-iads-iads) auf das -Objekt.
2.  Verwenden Sie die [**IADs.Get-Methode,**](/windows/desktop/api/iads/nf-iads-iads-get) um die Sicherheitsbeschreibung des Objekts abzurufen. Der Name der Eigenschaft, die den Sicherheitsdeskriptor enthält, ist **nTSecurityDescriptor.** Die -Eigenschaft wird als [**VARIANT**](/windows/win32/api/oaidl/ns-oaidl-variant) zurückgegeben, der einen [**IDispatch-Zeiger**](/windows/win32/api/oaidl/nn-oaidl-idispatch) enthält (der **vt-Member** ist **VT \_ DISPATCH).** Rufen Sie **QueryInterface** für diesen **IDispatch-Zeiger** auf, um eine [**IADsSecurityDescriptor-Schnittstelle**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) abzurufen, um die Methoden für diese Schnittstelle zu verwenden, um auf die ACL des Sicherheitsdeskriptors zuzugreifen.
3.  Verwenden Sie die [**IADsSecurityDescriptor.DiscretionaryAcl-Eigenschaft,**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) um die DACL abzurufen. Die -Methode gibt einen [**IDispatch-Zeiger**](/windows/win32/api/oaidl/nn-oaidl-idispatch) zurück. Rufen Sie **QueryInterface** für diesen **IDispatch-Zeiger** auf, um eine [**IADsAccessControlList-Schnittstelle**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) abzurufen, um die Methoden für diese Schnittstelle zu verwenden, um auf die einzelnen ACEs in der Zugriffssteuerungsliste zuzugreifen.
4.  Verwenden Sie [**CoCreateInstance,**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) um das ADSI-COM-Objekt für den neuen ACE zu erstellen und einen [**IADsAccessControlEntry-Schnittstellenzeiger**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) auf dieses Objekt abzurufen. Beachten Sie, dass die Klassen-ID CLSID \_ AccessControlEntry lautet.
5.  Legen Sie die Eigenschaften des ACE mithilfe der [**IADsAccessControlEntry-Methoden**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) fest:

    1.  Verwenden Sie [**IADsAccessControlEntry::p ut-Vertrauensnehmer, \_**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) um den Vertrauensnehmer festzulegen, für den dieser ACE gilt. Der Vertrauensnehmer ist ein Benutzer, eine Gruppe oder ein anderer Sicherheitsprinzipal. Ihre Anwendung sollte den Wert aus der entsprechenden Eigenschaft des Benutzer- oder Gruppenobjekts des Vertrauensnehmers verwenden, auf den Sie den ACE anwenden möchten. Der Vertrauensnehmer wird als **BSTR** angegeben und kann folgende Formen annehmen:
        -   Domänenkonto (der Anmeldename, der in einer früheren Version von Windows NT verwendet wurde) im Format <domain> \\ <user account> " " " wobei " &lt; Domäne " der Name der Windows &gt; NT-Domäne ist, die den Benutzer enthält, und " &lt; Benutzerkonto " ist die &gt; **sAMAccountName-Eigenschaft** des angegebenen Benutzers. Beispiel: "fabrikam \\ jeffsmith".
        -   Ein bekannter Sicherheitsprinzipal, der spezielle Identitäten darstellt, die vom Windows NT-Sicherheitssystem definiert werden, z. B. jeder Benutzer, das lokale System, der Prinzipal selbst, der authentifizierte Benutzer, der Erstellerbesitzer usw. Die Objekte, die die bekannten Sicherheitsprinzipale darstellen, werden im Container Well Known Security Principals unterhalb des Konfigurationscontainers gespeichert. Beispiel: anonyme Anmeldung.
        -   Integrierte Gruppe, die die integrierten Benutzergruppen darstellt, die vom Windows NT-Sicherheitssystem definiert werden. Sie hat das Format \\ <group name> "BUILTIN", wobei &lt; "Gruppenname" &gt; der Name der integrierten Benutzergruppe ist. Die Objekte, die die integrierten Gruppen darstellen, werden im Integrierten Container unter dem Domänencontainer gespeichert. Beispiel: "BUILTIN \\ Administrators".
        -   SID (Zeichenfolgenformat) des angegebenen Benutzers, bei dem es sich um die **objectSID-Eigenschaft** des angegebenen Benutzers handelt. Sie können das Zeichenfolgenformular mithilfe der [**ConvertSidToStringSid-Funktion**](/windows/desktop/api/sddl/nf-sddl-convertsidtostringsida) im Win32-Sicherheits-API konvertieren. Beispiel: "S-1-5-32-548".
    2.  Verwenden Sie die [**IADsAccessControlEntry.AccessMask-Eigenschaft,**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) um die Maske festzulegen, die das Zugriffsrecht angibt. Die [**ADS \_ RIGHTS \_ ENUM-Enumeration**](/windows/win32/api/iads/ne-iads-ads_rights_enum) gibt die Zugriffsrechte an, die Sie für ein Verzeichnisobjekt festlegen können.
    3.  Verwenden Sie die [**IADsAccessControlEntry.AceType-Eigenschaft,**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) um anzugeben, ob die von **AccessMask** festgelegten Zugriffsrechte zugelassen oder verweigert werden sollen. Bei Standardrechten kann dies **ADS \_ ACETYPE \_ ACCESS \_ ALLOWED** oder **ADS \_ ACETYPE ACCESS \_ \_ DENIED** sein. Verwenden Sie für objektspezifische Rechte (Rechte, die für einen bestimmten Teil eines Objekts oder für einen bestimmten Objekttyp gelten) **ADS \_ ACETYPE \_ ACCESS ALLOWED \_ \_ OBJECT** oder **ADS \_ ACETYPE ACCESS \_ \_ DENIED \_ OBJECT**. Die [**ADS \_ ACETYPE \_ ENUM-Enumeration**](/windows/win32/api/iads/ne-iads-ads_acetype_enum) gibt die Zugriffstypen an, die Sie für einen ACE festlegen können.
    4.  Verwenden Sie die [**IADsAccessControlEntry.AceFlags-Eigenschaft,**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) um anzugeben, ob andere Container oder Objekte unter dem angegebenen Objekt den ACE erben können. Die [**ADS \_ ACEFLAG-ENUM-Enumeration \_**](/windows/win32/api/iads/ne-iads-ads_aceflag_enum) gibt die Vererbungsflags an, die Sie für einen ACE festlegen können.
    5.  Verwenden Sie die [**IADsAccessControlEntry.Flags-Eigenschaft,**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) um anzugeben, ob das Recht für einen bestimmten Teil des Objekts, einen geerbten Objekttyp oder beides gilt.
    6.  Wenn **Flags** auf **ADS FLAG OBJECT TYPE \_ \_ \_ \_ PRESENT** festgelegt ist, legen Sie die [**IADsAccessControlEntry.ObjectType-Eigenschaft**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) fest, und geben Sie eine Zeichenfolge mit der GUID der Objektklasse an (für **ADS RIGHT \_ \_ DS CREATE \_ \_ CHILD** oder **ADS RIGHT \_ \_ DS DELETE \_ \_ CHILD**), Eigenschaft, Eigenschaftensatz, überprüfter Schreibvorgang oder erweitertes Recht, für das der ACE gilt. Die GUID muss als Zeichenfolge des Formulars angegeben werden, das von der [**StringFromGUID2-Funktion**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) in der COM-Bibliothek erstellt wird.
    7.  Wenn **Flags** auf **ADS FLAG \_ \_ INHERITED OBJECT TYPE \_ \_ \_ PRESENT** festgelegt ist, legen Sie die [**IADsAccessControlEntry.InheritedObjectType-Eigenschaft**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) fest, um eine Zeichenfolge anzugeben, die die GUID der geerbten Objektklasse enthält, für die der ACE gilt. Die GUID muss als Zeichenfolge des Formulars angegeben werden, das von der [**StringFromGUID2-Funktion**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) in der COM-Bibliothek erstellt wird.

6.  Verwenden Sie die **QueryInterface-Methode** für das [**IADsAccessControlEntry-Objekt,**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) um einen [**IDispatch-Zeiger**](/windows/win32/api/oaidl/nn-oaidl-idispatch) abzurufen. Die [**IADsAccessControlList.AddAce-Methode**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) erfordert einen **IDispatch-Schnittstellenzeiger** auf den ACE.
7.  Verwenden Sie [**IADsAccessControlList.AddAce,**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) um der DACL den neuen ACE hinzuzufügen. Beachten Sie, dass sich die Reihenfolge der ACEs innerhalb der Zugriffssteuerungsliste auf die Auswertung des Zugriffs auf das Objekt auswirken kann. Für den richtigen Zugriff auf das -Objekt müssen Sie möglicherweise eine neue ACL erstellen, die ACEs aus der vorhandenen ACL in der richtigen Reihenfolge zur neuen ACL hinzufügen und dann die vorhandene ACL in der Sicherheitsbeschreibung durch die neue ACL ersetzen. Weitere Informationen finden Sie unter [Reihenfolge der ACEs in einer DACL.](/windows/desktop/SecAuthZ/order-of-aces-in-a-dacl)
8.  Verwenden Sie die [**IADsSecurityDescriptor.DiscretionaryAcl-Eigenschaft,**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) um die DACL mit dem neuen ACE in den Sicherheitsdeskriptor zu schreiben. Weitere Informationen zu DACLs finden Sie unter [NULL-DACLs und Leere DACLs.](null-dacls-and-empty-dacls.md)
9.  Verwenden Sie die [**IADs.Put-Methode,**](/windows/desktop/api/iads/nf-iads-iads-put) um den Sicherheitsdeskriptor in die **nTSecurityDescriptor-Eigenschaft** des Objekts in den Eigenschaftencache zu schreiben.
10. Verwenden Sie die [**IADs.SetInfo-Methode,**](/windows/desktop/api/iads/nf-iads-iads-setinfo) um die -Eigenschaft für das -Objekt im Verzeichnis zu aktualisieren.

 

 