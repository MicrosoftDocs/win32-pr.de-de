---
description: Die CNG-API implementiert ein erweiterbares Anbieter Modell, mit dem Sie einen Anbieter laden können, indem Sie anstelle eines bestimmten Anbieters den erforderlichen Kryptografiealgorithmus angeben.
ms.assetid: a88a089b-4afe-4201-96f7-97f19bce18a1
title: Typische CNG-Programmierung
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1119da63ca1ea0613444b150914c06664f36c121
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "103751657"
---
# <a name="typical-cng-programming"></a><span data-ttu-id="3b308-103">Typische CNG-Programmierung</span><span class="sxs-lookup"><span data-stu-id="3b308-103">Typical CNG Programming</span></span>

<span data-ttu-id="3b308-104">Die CNG-API implementiert ein erweiterbares Anbieter Modell, mit dem Sie einen Anbieter laden können, indem Sie anstelle eines bestimmten Anbieters den erforderlichen Kryptografiealgorithmus angeben.</span><span class="sxs-lookup"><span data-stu-id="3b308-104">The CNG API implements an extensible provider model that lets you load a provider by specifying the required cryptographic algorithm rather than a particular provider.</span></span> <span data-ttu-id="3b308-105">Der Vorteil besteht darin, dass ein Algorithmusanbieter ersetzt oder aktualisiert werden kann, und Sie müssen den Code nicht in irgendeiner Weise ändern, um den neuen Anbieter zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="3b308-105">The advantage is that an algorithm provider can be replaced or upgraded and you will not have to change your code in any way to use the new provider.</span></span> <span data-ttu-id="3b308-106">Wenn ein Algorithmus in Zukunft als unsicher eingestuft wird, kann auch eine sicherere Version dieses Algorithmus installiert werden, ohne dass sich dies auf den Code auswirkt.</span><span class="sxs-lookup"><span data-stu-id="3b308-106">Also, if some algorithm is determined to be unsafe in the future, a more secure version of that algorithm can be installed without affecting your code.</span></span> <span data-ttu-id="3b308-107">Die meisten CNG-APIs erfordern einen Anbieter oder ein Objekt, das von einem Anbieter erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="3b308-107">Most of the CNG APIs require a provider or an object created by a provider.</span></span>

<span data-ttu-id="3b308-108">Die üblichen Schritte bei der Verwendung der CNG-API für kryptografische primitive Vorgänge sind wie folgt:</span><span class="sxs-lookup"><span data-stu-id="3b308-108">The typical steps involved in using the CNG API for cryptographic primitive operations are as follows:</span></span>

1.  <span data-ttu-id="3b308-109">Öffnen des Algorithmusanbieters</span><span class="sxs-lookup"><span data-stu-id="3b308-109">Opening the Algorithm Provider</span></span>
2.  <span data-ttu-id="3b308-110">Festlegen oder Festlegen von algorithmuseigenschaften</span><span class="sxs-lookup"><span data-stu-id="3b308-110">Getting or Setting Algorithm Properties</span></span>
3.  <span data-ttu-id="3b308-111">Erstellen oder Importieren eines Schlüssels</span><span class="sxs-lookup"><span data-stu-id="3b308-111">Creating or Importing a Key</span></span>
4.  <span data-ttu-id="3b308-112">Ausführen kryptografischer Vorgänge</span><span class="sxs-lookup"><span data-stu-id="3b308-112">Performing Cryptographic Operations</span></span>
5.  <span data-ttu-id="3b308-113">Schließen des Algorithmusanbieters</span><span class="sxs-lookup"><span data-stu-id="3b308-113">Closing the Algorithm Provider</span></span>

<span data-ttu-id="3b308-114">Weitere Informationen finden Sie unter Programmieren von Beispielen.</span><span class="sxs-lookup"><span data-stu-id="3b308-114">For more information, see Programming Examples.</span></span>

## <a name="opening-the-algorithm-provider"></a><span data-ttu-id="3b308-115">Öffnen des Algorithmusanbieters</span><span class="sxs-lookup"><span data-stu-id="3b308-115">Opening the Algorithm Provider</span></span>

<span data-ttu-id="3b308-116">Die Funktion " [**BCryptOpenAlgorithmProvider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptopenalgorithmprovider) " bietet ein algorithmusanbieterhandle, das in nachfolgenden CNG-APIs verwendet wird, z. [**b. bcryptkreatehash**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptcreatehash) oder [**BCryptGenerateKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair).</span><span class="sxs-lookup"><span data-stu-id="3b308-116">The [**BCryptOpenAlgorithmProvider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptopenalgorithmprovider) function provides you with an algorithm provider handle that is used in subsequent CNG APIs, such as [**BCryptCreateHash**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptcreatehash) or [**BCryptGenerateKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair).</span></span>

## <a name="getting-or-setting-algorithm-properties"></a><span data-ttu-id="3b308-117">Festlegen oder Festlegen von algorithmuseigenschaften</span><span class="sxs-lookup"><span data-stu-id="3b308-117">Getting or Setting Algorithm Properties</span></span>

<span data-ttu-id="3b308-118">Sie können das algorithmusanbieterhandle verwenden, um Implementierungsdetails für den Algorithmus zu erhalten, z. b. die Schlüsselgröße oder den aktuellen Betriebsmodus.</span><span class="sxs-lookup"><span data-stu-id="3b308-118">You can use the algorithm provider handle to get implementation details for the algorithm, such as the key size or the current mode of operation.</span></span> <span data-ttu-id="3b308-119">Sie verwenden die Funktion " [**BCryptGetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgetproperty) ", um bestimmte Eigenschaften abzurufen.</span><span class="sxs-lookup"><span data-stu-id="3b308-119">You use the [**BCryptGetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgetproperty) function to obtain specific properties.</span></span>

<span data-ttu-id="3b308-120">Sie können auch die Eigenschaften des Algorithmus ändern.</span><span class="sxs-lookup"><span data-stu-id="3b308-120">You can also modify the properties of the algorithm.</span></span> <span data-ttu-id="3b308-121">Wenn Sie z. b. die ECB-Block Verschlüsselungs Verkettung mit AES verwenden möchten, legen Sie die Eigenschaft **bcrypt- \_ Verkettungs \_ Modus** eines AES-Algorithmus auf **bcrypt \_ Chain \_ Mode \_ ECB** fest. die Eigenschaft wird allen mit diesem algorithmushandle erstellten AES-Schlüsseln zugewiesen, ohne dass jeder AES-Schlüssel konfiguriert werden muss.</span><span class="sxs-lookup"><span data-stu-id="3b308-121">For example, If you want to use ECB block cipher chaining with AES, you set the **BCRYPT\_CHAINING\_MODE** property of an AES algorithm to **BCRYPT\_CHAIN\_MODE\_ECB**; the property is assigned to all AES keys created using this algorithm handle, without the need to configure each and every AES key.</span></span> <span data-ttu-id="3b308-122">Sie verwenden die Funktion " [**BCryptSetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptsetproperty) ", um diese Eigenschaften zu ändern.</span><span class="sxs-lookup"><span data-stu-id="3b308-122">You use the [**BCryptSetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptsetproperty) function to modify these properties.</span></span>

## <a name="creating-or-importing-a-key"></a><span data-ttu-id="3b308-123">Erstellen oder Importieren eines Schlüssels</span><span class="sxs-lookup"><span data-stu-id="3b308-123">Creating or Importing a Key</span></span>

<span data-ttu-id="3b308-124">Abhängig vom verwendeten Algorithmustyp müssen Sie möglicherweise einen Schlüssel erstellen oder laden.</span><span class="sxs-lookup"><span data-stu-id="3b308-124">Depending on the type of algorithm you use, you may need to create or load a key.</span></span> <span data-ttu-id="3b308-125">Die Funktion [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) nimmt z. b. ein Schlüssel Handle für den ersten Parameter an.</span><span class="sxs-lookup"><span data-stu-id="3b308-125">For example, the [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) function takes a key handle for the first parameter.</span></span> <span data-ttu-id="3b308-126">Wenn diese Funktion Daten mit einem symmetrischen Verschlüsselungsalgorithmus wie z. b. AES verschlüsseln soll, müssen Sie zuerst einen Schlüssel abrufen.</span><span class="sxs-lookup"><span data-stu-id="3b308-126">If you want that function to encrypt data with a symmetric encryption algorithm such as AES, you must first obtain a key.</span></span> <span data-ttu-id="3b308-127">Wie Sie den Schlüssel abrufen, hängt vom verwendeten Algorithmustyp und der Quelle des Schlüssels ab.</span><span class="sxs-lookup"><span data-stu-id="3b308-127">How you obtain the key depends on the type of algorithm being used and the source of the key.</span></span>

<span data-ttu-id="3b308-128">Sie können kurzlebige Schlüssel mit den Funktionen [**BCryptGenerateSymmetricKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratesymmetrickey) und [**BCryptGenerateKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair) erstellen.</span><span class="sxs-lookup"><span data-stu-id="3b308-128">You can create ephemeral keys with the [**BCryptGenerateSymmetricKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratesymmetrickey) and [**BCryptGenerateKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair) functions.</span></span> <span data-ttu-id="3b308-129">Sie können auch kurzlebige Schlüssel aus einem speicherblob mit den Funktionen " [**BCryptImportKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkey) " und " [**BCryptImportKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkeypair) " importieren.</span><span class="sxs-lookup"><span data-stu-id="3b308-129">You can also import ephemeral keys from a memory BLOB with the [**BCryptImportKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkey) and [**BCryptImportKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkeypair) functions.</span></span>

<span data-ttu-id="3b308-130">Bei persistenten Schlüsseln verwenden Sie die Schlüsselspeicher Funktionen, um einen Schlüsselspeicher Anbieter zu laden und dann die Schlüssel zu erstellen oder zu laden.</span><span class="sxs-lookup"><span data-stu-id="3b308-130">For persisted keys, you use the key storage functions to load a key storage provider, and then create or load the keys.</span></span> <span data-ttu-id="3b308-131">Sie können diese Funktionen auch zum Erstellen oder Laden von kurzlebigen Schlüsseln verwenden, indem Sie **null** für alle Container Namen übergeben.</span><span class="sxs-lookup"><span data-stu-id="3b308-131">You can also use these functions to create or load ephemeral keys by passing **NULL** for any container names.</span></span> <span data-ttu-id="3b308-132">Weitere Informationen zu den wichtigsten Speicherfunktionen finden Sie unter [CNG-Schlüsselspeicher Funktionen](cng-key-storage-functions.md).</span><span class="sxs-lookup"><span data-stu-id="3b308-132">For more information about the key storage functions, see [CNG Key Storage Functions](cng-key-storage-functions.md).</span></span>

## <a name="performing-cryptographic-operations"></a><span data-ttu-id="3b308-133">Ausführen kryptografischer Vorgänge</span><span class="sxs-lookup"><span data-stu-id="3b308-133">Performing Cryptographic Operations</span></span>

<span data-ttu-id="3b308-134">Sie sind nun bereit, den kryptografischen Vorgang auszuführen, z. b. das Verschlüsseln oder Entschlüsseln von Daten mit den Funktionen [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) bzw. [**bcryptentschlpt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptdecrypt) .</span><span class="sxs-lookup"><span data-stu-id="3b308-134">You are now ready to perform the cryptographic operation, such as encrypting or decrypting data by using the [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) or [**BCryptDecrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptdecrypt) functions, respectively.</span></span>

## <a name="closing-the-algorithm-provider"></a><span data-ttu-id="3b308-135">Schließen des Algorithmusanbieters</span><span class="sxs-lookup"><span data-stu-id="3b308-135">Closing the Algorithm Provider</span></span>

<span data-ttu-id="3b308-136">Wenn der Anbieter nicht mehr benötigt wird, müssen Sie das Handle an die Funktion " [**bcryptclosealgorithmprovider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptclosealgorithmprovider) " übergeben, um den Anbieter zu schließen.</span><span class="sxs-lookup"><span data-stu-id="3b308-136">When the provider is no longer needed, you must pass the handle to the [**BCryptCloseAlgorithmProvider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptclosealgorithmprovider) function to close the provider.</span></span> <span data-ttu-id="3b308-137">Dies bewirkt, dass der Anbieter alle Ressourcen freigibt, die für die Instanz des Algorithmusanbieters reserviert wurden.</span><span class="sxs-lookup"><span data-stu-id="3b308-137">This causes the provider to release any resources that have been allocated for that algorithm provider instance.</span></span> <span data-ttu-id="3b308-138">Nachdem ein Anbieter Handle geschlossen wurde, kann es nicht wieder verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="3b308-138">After a provider handle is closed, it cannot be reused.</span></span>

<span data-ttu-id="3b308-139">Das Laden eines Anbieters kann ein relativ Zeit intensiver Prozess sein.</span><span class="sxs-lookup"><span data-stu-id="3b308-139">Loading a provider can be a relatively time-intensive process.</span></span> <span data-ttu-id="3b308-140">Daher sollten Sie alle Anbieter Handles Zwischenspeichern, die während der Lebensdauer der Anwendung mehrmals referenziert werden.</span><span class="sxs-lookup"><span data-stu-id="3b308-140">You should therefore cache any provider handles that you will reference multiple times during the lifetime of your application.</span></span>

## <a name="programming-examples"></a><span data-ttu-id="3b308-141">Programmierbeispiele</span><span class="sxs-lookup"><span data-stu-id="3b308-141">Programming Examples</span></span>

<span data-ttu-id="3b308-142">In den folgenden Beispielen wird beschrieben, wie bestimmte Kryptografievorgänge mithilfe von CNG durchgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="3b308-142">The following examples describe how to perform specific cryptographic operations using CNG.</span></span>

-   [<span data-ttu-id="3b308-143">Erstellen eines Hash mit CNG</span><span class="sxs-lookup"><span data-stu-id="3b308-143">Creating a Hash with CNG</span></span>](creating-a-hash-with-cng.md)
-   [<span data-ttu-id="3b308-144">Signieren von Daten mit CNG</span><span class="sxs-lookup"><span data-stu-id="3b308-144">Signing Data with CNG</span></span>](signing-data-with-cng.md)
-   [<span data-ttu-id="3b308-145">Verschlüsseln von Daten mit CNG</span><span class="sxs-lookup"><span data-stu-id="3b308-145">Encrypting Data with CNG</span></span>](encrypting-data-with-cng.md)

 

 



