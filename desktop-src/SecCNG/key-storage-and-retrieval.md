---
description: CNG bietet ein Modell für den privaten Schlüsselspeicher, das die Anpassung an den aktuellen und den zukünftigen Bedarf an der Erstellung von Anwendungen ermöglicht, die Kryptografiefunktionen wie die Verschlüsselung mit öffentlichem oder öffentlichem Schlüssel verwenden, sowie die Anforderungen der Speicherung von Schlüsselmaterial.
ms.assetid: 95e5750f-fdc5-41f3-a4ce-9593a7081e95
title: Schlüssel Speicherung und-Abruf
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5abfd6319353440c580d53990075a71613a1eba9
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "104347758"
---
# <a name="key-storage-and-retrieval"></a><span data-ttu-id="2050a-103">Schlüssel Speicherung und-Abruf</span><span class="sxs-lookup"><span data-stu-id="2050a-103">Key Storage and Retrieval</span></span>

-   [<span data-ttu-id="2050a-104">Key Storage-Architektur</span><span class="sxs-lookup"><span data-stu-id="2050a-104">Key Storage Architecture</span></span>](#key-storage-architecture)
-   [<span data-ttu-id="2050a-105">Schlüsseltypen</span><span class="sxs-lookup"><span data-stu-id="2050a-105">Key Types</span></span>](#key-types)
-   [<span data-ttu-id="2050a-106">Unterstützte Algorithmen</span><span class="sxs-lookup"><span data-stu-id="2050a-106">Supported Algorithms</span></span>](#supported-algorithms)
-   [<span data-ttu-id="2050a-107">Schlüssel Verzeichnisse und-Dateien</span><span class="sxs-lookup"><span data-stu-id="2050a-107">Key Directories and Files</span></span>](#key-directories-and-files)

## <a name="key-storage-architecture"></a><span data-ttu-id="2050a-108">Key Storage-Architektur</span><span class="sxs-lookup"><span data-stu-id="2050a-108">Key Storage Architecture</span></span>

<span data-ttu-id="2050a-109">CNG bietet ein Modell für den privaten Schlüsselspeicher, das die Anpassung an den aktuellen und den zukünftigen Bedarf an der Erstellung von Anwendungen ermöglicht, die Kryptografiefunktionen wie die Verschlüsselung mit öffentlichem oder öffentlichem Schlüssel verwenden, sowie die Anforderungen der Speicherung von Schlüsselmaterial.</span><span class="sxs-lookup"><span data-stu-id="2050a-109">CNG provides a model for private key storage that allows adapting to the current and future demands of creating applications that use cryptography features such as public or private key encryption, as well as the demands of the storage of key material.</span></span> <span data-ttu-id="2050a-110">Der Schlüsselspeicher Router ist die zentrale Routine in diesem Modell und wird in Ncrypt.dll implementiert.</span><span class="sxs-lookup"><span data-stu-id="2050a-110">The key storage router is the central routine in this model and is implemented in Ncrypt.dll.</span></span> <span data-ttu-id="2050a-111">Eine Anwendung greift auf die Schlüsselspeicher Anbieter (Key Storage Providers, kSPS) im System über den Schlüsselspeicher Router zu, der Details, wie z. b. die Schlüssel Isolation, sowohl von der Anwendung als auch vom Speicher Anbieter selbst verbirgt.</span><span class="sxs-lookup"><span data-stu-id="2050a-111">An application accesses the key storage providers (KSPs) on the system through the key storage router, which conceals details, such as key isolation, from both the application and the storage provider itself.</span></span> <span data-ttu-id="2050a-112">Die folgende Abbildung zeigt den Entwurf und die Funktion der Architektur der CNG-Schlüssel Isolation.</span><span class="sxs-lookup"><span data-stu-id="2050a-112">The following illustration shows the design and function of the CNG key isolation architecture.</span></span>

![CNG-Schlüsselspeicher Anbieter](images/cng-key-storage-provider.png)

<span data-ttu-id="2050a-114">Um die Anforderungen an die Common Criteria (CC) einzuhalten, müssen die langlebige Schlüssel isoliert werden, damit Sie im Anwendungsprozess nie vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="2050a-114">To comply with common criteria (CC) requirements, the long-lived keys must be isolated so that they are never present in the application process.</span></span> <span data-ttu-id="2050a-115">CNG unterstützt derzeit die Speicherung von asymmetrischen privaten Schlüsseln mithilfe der Microsoft-Software-KSP, die in Windows Server 2008 und Windows Vista enthalten und standardmäßig installiert ist.</span><span class="sxs-lookup"><span data-stu-id="2050a-115">CNG currently supports the storage of asymmetric private keys by using the Microsoft software KSP that is included with Windows Server 2008 and Windows Vista and installed by default.</span></span>

<span data-ttu-id="2050a-116">Die Schlüssel Isolation ist in Windows Server 2008 und Windows Vista standardmäßig aktiviert.</span><span class="sxs-lookup"><span data-stu-id="2050a-116">Key isolation is enabled by default in Windows Server 2008 and Windows Vista.</span></span> <span data-ttu-id="2050a-117">Die Schlüssel Isolations Funktion ist auf Plattformen vor diesen nicht verfügbar.</span><span class="sxs-lookup"><span data-stu-id="2050a-117">The key isolation feature is not available on platforms prior to these.</span></span> <span data-ttu-id="2050a-118">Außerdem werden Drittanbieter-kSPS nicht in den Key Isolation Service (LSA-Prozess) geladen.</span><span class="sxs-lookup"><span data-stu-id="2050a-118">Also, third party KSPs are not loaded in the key isolation service (LSA process).</span></span> <span data-ttu-id="2050a-119">Nur der Microsoft KSP wird in den Schlüssel Isolations Dienst geladen.</span><span class="sxs-lookup"><span data-stu-id="2050a-119">Only the Microsoft KSP is loaded in the key isolation service.</span></span>

<span data-ttu-id="2050a-120">Der LSA-Prozess wird als Schlüssel Isolations Prozess verwendet, um die Leistung zu maximieren.</span><span class="sxs-lookup"><span data-stu-id="2050a-120">The LSA process is used as the key isolation process to maximize performance.</span></span> <span data-ttu-id="2050a-121">Der gesamte Zugriff auf private Schlüssel durchläuft den Schlüsselspeicher Router, der einen umfassenden Satz von Funktionen für die Verwaltung und Verwendung privater Schlüssel verfügbar macht.</span><span class="sxs-lookup"><span data-stu-id="2050a-121">All access to private keys goes through the key storage router, which exposes a comprehensive set of functions for managing and using private keys.</span></span>

<span data-ttu-id="2050a-122">CNG speichert den öffentlichen Teil des gespeicherten Schlüssels getrennt vom privaten Teil.</span><span class="sxs-lookup"><span data-stu-id="2050a-122">CNG stores the public portion of the stored key separately from the private portion.</span></span> <span data-ttu-id="2050a-123">Der öffentliche Teil eines Schlüssel Paars wird ebenfalls im Schlüssel Isolations Dienst verwaltet, und der Zugriff erfolgt über den lokalen Remote Prozedur Aufruf (Remote Procedure Aufruf, LRPC).</span><span class="sxs-lookup"><span data-stu-id="2050a-123">The public portion of a key pair is also maintained in the key isolation service and is accessed by using local remote procedure call (LRPC).</span></span> <span data-ttu-id="2050a-124">Der Schlüsselspeicher Router verwendet LRPC, wenn der Schlüssel Isolations Prozess aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="2050a-124">The key storage router uses LRPC when calling into the key isolation process.</span></span> <span data-ttu-id="2050a-125">Der gesamte Zugriff auf private Schlüssel erfolgt über den Router des privaten Schlüssels und wird von CNG überwacht.</span><span class="sxs-lookup"><span data-stu-id="2050a-125">All access to private keys goes through the private key router and is audited by CNG.</span></span>

<span data-ttu-id="2050a-126">Wie oben beschrieben, kann eine große Bandbreite an Hardware Speichergeräten unterstützt werden.</span><span class="sxs-lookup"><span data-stu-id="2050a-126">As described above, a wide range of hardware storage devices can be supported.</span></span> <span data-ttu-id="2050a-127">In jedem Fall ist die Schnittstelle zu all diesen Speichergeräten identisch.</span><span class="sxs-lookup"><span data-stu-id="2050a-127">In each case, the interface to all of these storage devices is identical.</span></span> <span data-ttu-id="2050a-128">Sie enthält Funktionen zum Durchführen verschiedener Vorgänge für private Schlüssel sowie Funktionen, die die Schlüssel Speicherung und-Verwaltung betreffen.</span><span class="sxs-lookup"><span data-stu-id="2050a-128">It includes functions to perform various private key operations as well as functions that pertain to key storage and management.</span></span>

<span data-ttu-id="2050a-129">CNG bietet eine Reihe von APIs, die zum Erstellen, speichern und Abrufen von Kryptografieschlüsseln verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="2050a-129">CNG provides a set of APIs that are used to create, store, and retrieve cryptographic keys.</span></span> <span data-ttu-id="2050a-130">Eine Liste dieser APIs finden Sie unter [CNG-Schlüsselspeicher Funktionen](cng-key-storage-functions.md).</span><span class="sxs-lookup"><span data-stu-id="2050a-130">For a list of these APIs, see [CNG Key Storage Functions](cng-key-storage-functions.md).</span></span>

## <a name="key-types"></a><span data-ttu-id="2050a-131">Schlüsseltypen</span><span class="sxs-lookup"><span data-stu-id="2050a-131">Key Types</span></span>

<span data-ttu-id="2050a-132">CNG unterstützt die folgenden Schlüsseltypen:</span><span class="sxs-lookup"><span data-stu-id="2050a-132">CNG supports the following key types:</span></span>

-   <span data-ttu-id="2050a-133">Diffie-Hellman öffentlichen und privaten Schlüsseln.</span><span class="sxs-lookup"><span data-stu-id="2050a-133">Diffie-Hellman public and private keys.</span></span>
-   <span data-ttu-id="2050a-134">Öffentliche und private Schlüssel für den Algorithmus für digitale Signaturen (DSA, FPS 186-2).</span><span class="sxs-lookup"><span data-stu-id="2050a-134">Digital Signature Algorithm (DSA, FIPS 186-2) public and private keys.</span></span>
-   <span data-ttu-id="2050a-135">\#Öffentliche und Private RSA-Schlüssel (PKCS 1).</span><span class="sxs-lookup"><span data-stu-id="2050a-135">RSA (PKCS \#1) public and private keys.</span></span>
-   <span data-ttu-id="2050a-136">Mehrere öffentliche und private Legacy Schlüssel (CryptoAPI).</span><span class="sxs-lookup"><span data-stu-id="2050a-136">Several legacy (CryptoAPI) public and private keys.</span></span>
-   <span data-ttu-id="2050a-137">Öffentliche und private Schlüssel für die elliptische Kurve der Kryptografie.</span><span class="sxs-lookup"><span data-stu-id="2050a-137">Elliptic Curve Cryptography public and private keys.</span></span>

## <a name="supported-algorithms"></a><span data-ttu-id="2050a-138">Unterstützte Algorithmen</span><span class="sxs-lookup"><span data-stu-id="2050a-138">Supported Algorithms</span></span>

<span data-ttu-id="2050a-139">CNG unterstützt die folgenden Schlüssel Algorithmen.</span><span class="sxs-lookup"><span data-stu-id="2050a-139">CNG supports the following key algorithms.</span></span>

| <span data-ttu-id="2050a-140">Algorithmus</span><span class="sxs-lookup"><span data-stu-id="2050a-140">Algorithm</span></span> | <span data-ttu-id="2050a-141">Schlüssel-/Hashlänge (Bits)</span><span class="sxs-lookup"><span data-stu-id="2050a-141">Key/hash length (bits)</span></span>             |
|-----------|------------------------------------|
| <span data-ttu-id="2050a-142">RSA</span><span class="sxs-lookup"><span data-stu-id="2050a-142">RSA</span></span>       | <span data-ttu-id="2050a-143">512 bis 16384, in 64-Bit-Inkrementen</span><span class="sxs-lookup"><span data-stu-id="2050a-143">512 to 16384, in 64 bit increments</span></span> |
| <span data-ttu-id="2050a-144">DH</span><span class="sxs-lookup"><span data-stu-id="2050a-144">DH</span></span>        | <span data-ttu-id="2050a-145">512 bis 16384, in 64-Bit-Inkrementen</span><span class="sxs-lookup"><span data-stu-id="2050a-145">512 to 16384, in 64 bit increments</span></span> |
| <span data-ttu-id="2050a-146">DSA</span><span class="sxs-lookup"><span data-stu-id="2050a-146">DSA</span></span>       | <span data-ttu-id="2050a-147">512 bis 1024, in 64-Bit-Inkrementen</span><span class="sxs-lookup"><span data-stu-id="2050a-147">512 to 1024, in 64 bit increments</span></span>  |
| <span data-ttu-id="2050a-148">ECDsa</span><span class="sxs-lookup"><span data-stu-id="2050a-148">ECDSA</span></span>     | <span data-ttu-id="2050a-149">P-256, p-384, p-521 (NIST-Kurven)</span><span class="sxs-lookup"><span data-stu-id="2050a-149">P-256, P-384, P-521 (NIST Curves)</span></span>  |
| <span data-ttu-id="2050a-150">ECDH</span><span class="sxs-lookup"><span data-stu-id="2050a-150">ECDH</span></span>      | <span data-ttu-id="2050a-151">P-256, p-384, p-521 (NIST-Kurven)</span><span class="sxs-lookup"><span data-stu-id="2050a-151">P-256, P-384, P-521 (NIST Curves)</span></span>  |
| <span data-ttu-id="2050a-152">MD2</span><span class="sxs-lookup"><span data-stu-id="2050a-152">MD2</span></span>       | <span data-ttu-id="2050a-153">128</span><span class="sxs-lookup"><span data-stu-id="2050a-153">128</span></span>                                |
| <span data-ttu-id="2050a-154">MD4</span><span class="sxs-lookup"><span data-stu-id="2050a-154">MD4</span></span>       | <span data-ttu-id="2050a-155">128</span><span class="sxs-lookup"><span data-stu-id="2050a-155">128</span></span>                                |
| <span data-ttu-id="2050a-156">MD5</span><span class="sxs-lookup"><span data-stu-id="2050a-156">MD5</span></span>       | <span data-ttu-id="2050a-157">128</span><span class="sxs-lookup"><span data-stu-id="2050a-157">128</span></span>                                |
| <span data-ttu-id="2050a-158">SHA-1</span><span class="sxs-lookup"><span data-stu-id="2050a-158">SHA-1</span></span>     | <span data-ttu-id="2050a-159">160</span><span class="sxs-lookup"><span data-stu-id="2050a-159">160</span></span>                                |
| <span data-ttu-id="2050a-160">SHA-256</span><span class="sxs-lookup"><span data-stu-id="2050a-160">SHA-256</span></span>   | <span data-ttu-id="2050a-161">256</span><span class="sxs-lookup"><span data-stu-id="2050a-161">256</span></span>                                |
| <span data-ttu-id="2050a-162">SHA-384</span><span class="sxs-lookup"><span data-stu-id="2050a-162">SHA-384</span></span>   | <span data-ttu-id="2050a-163">384</span><span class="sxs-lookup"><span data-stu-id="2050a-163">384</span></span>                                |
| <span data-ttu-id="2050a-164">SHA-512</span><span class="sxs-lookup"><span data-stu-id="2050a-164">SHA-512</span></span>   | <span data-ttu-id="2050a-165">512</span><span class="sxs-lookup"><span data-stu-id="2050a-165">512</span></span>                                |



 

## <a name="key-directories-and-files"></a><span data-ttu-id="2050a-166">Schlüssel Verzeichnisse und-Dateien</span><span class="sxs-lookup"><span data-stu-id="2050a-166">Key Directories and Files</span></span>

<span data-ttu-id="2050a-167">Die Microsoft Legacy CryptoAPI-CSPs speichern private Schlüssel in den folgenden Verzeichnissen.</span><span class="sxs-lookup"><span data-stu-id="2050a-167">The Microsoft legacy CryptoAPI CSPs store private keys in the following directories.</span></span>

| <span data-ttu-id="2050a-168">Schlüsseltyp</span><span class="sxs-lookup"><span data-stu-id="2050a-168">Key type</span></span>                | <span data-ttu-id="2050a-169">Verzeichnisse</span><span class="sxs-lookup"><span data-stu-id="2050a-169">Directories</span></span>                                                                                                                                                 |
|-------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="2050a-170">Benutzer privat</span><span class="sxs-lookup"><span data-stu-id="2050a-170">User private</span></span>            | <span data-ttu-id="2050a-171">% APPDATA% \\ Microsoft \\ Crypto \\ RSA- \\ *Benutzer-SID*</span><span class="sxs-lookup"><span data-stu-id="2050a-171">%APPDATA%\\Microsoft\\Crypto\\RSA\\*User SID*</span></span>\\<br/><span data-ttu-id="2050a-172">% APPDATA% \\ Microsoft \\ Crypto \\ DSS- \\ *Benutzer-SID*</span><span class="sxs-lookup"><span data-stu-id="2050a-172">%APPDATA%\\Microsoft\\Crypto\\DSS\\*User SID*</span></span>\\<br/>                                                   |
| <span data-ttu-id="2050a-173">Lokales System privat</span><span class="sxs-lookup"><span data-stu-id="2050a-173">Local system private</span></span>    | <span data-ttu-id="2050a-174">% ALLUSERSPROFILE% \\ Anwendungsdaten \\ Microsoft \\ Crypto \\ RSA \\ S-1-5-18</span><span class="sxs-lookup"><span data-stu-id="2050a-174">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\RSA\\S-1-5-18</span></span>\\<br/><span data-ttu-id="2050a-175">% ALLUSERSPROFILE% \\ Anwendungsdaten \\ Microsoft \\ Crypto \\ DSS \\ S-1-5-18</span><span class="sxs-lookup"><span data-stu-id="2050a-175">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\DSS\\S-1-5-18</span></span>\\<br/>   |
| <span data-ttu-id="2050a-176">Lokaler Dienst privat</span><span class="sxs-lookup"><span data-stu-id="2050a-176">Local service private</span></span>   | <span data-ttu-id="2050a-177">% ALLUSERSPROFILE% \\ Anwendungsdaten \\ Microsoft \\ Crypto \\ RSA \\ S-1-5-19</span><span class="sxs-lookup"><span data-stu-id="2050a-177">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\RSA\\S-1-5-19</span></span>\\<br/><span data-ttu-id="2050a-178">% ALLUSERSPROFILE% \\ Anwendungsdaten \\ Microsoft \\ Crypto \\ DSS \\ S-1-5-19</span><span class="sxs-lookup"><span data-stu-id="2050a-178">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\DSS\\S-1-5-19</span></span>\\<br/>   |
| <span data-ttu-id="2050a-179">Netzwerkdienst privat</span><span class="sxs-lookup"><span data-stu-id="2050a-179">Network service private</span></span> | <span data-ttu-id="2050a-180">% ALLUSERSPROFILE% \\ Anwendungsdaten \\ Microsoft \\ Crypto \\ RSA \\ S-1-5-20</span><span class="sxs-lookup"><span data-stu-id="2050a-180">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\RSA\\S-1-5-20</span></span>\\<br/><span data-ttu-id="2050a-181">% ALLUSERSPROFILE% \\ Anwendungsdaten \\ Microsoft \\ Crypto \\ DSS \\ S-1-5-20</span><span class="sxs-lookup"><span data-stu-id="2050a-181">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\DSS\\S-1-5-20</span></span>\\<br/>   |
| <span data-ttu-id="2050a-182">Freigegeben, privat</span><span class="sxs-lookup"><span data-stu-id="2050a-182">Shared private</span></span>          | <span data-ttu-id="2050a-183">% ALLUSERSPROFILE% \\ Anwendungsdaten \\ Microsoft \\ Crypto \\ RSA \\ MachineKeys</span><span class="sxs-lookup"><span data-stu-id="2050a-183">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\RSA\\MachineKeys</span></span><br/><span data-ttu-id="2050a-184">% ALLUSERSPROFILE% \\ Anwendungsdaten \\ Microsoft \\ Crypto \\ DSS \\ MachineKeys</span><span class="sxs-lookup"><span data-stu-id="2050a-184">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\DSS\\MachineKeys</span></span><br/> |



 

<span data-ttu-id="2050a-185">CNG speichert private Schlüssel in den folgenden Verzeichnissen.</span><span class="sxs-lookup"><span data-stu-id="2050a-185">CNG stores private keys in the following directories.</span></span>

| <span data-ttu-id="2050a-186">Schlüsseltyp</span><span class="sxs-lookup"><span data-stu-id="2050a-186">Key type</span></span>                | <span data-ttu-id="2050a-187">Verzeichnis</span><span class="sxs-lookup"><span data-stu-id="2050a-187">Directory</span></span>                                                          |
|-------------------------|--------------------------------------------------------------------|
| <span data-ttu-id="2050a-188">Benutzer privat</span><span class="sxs-lookup"><span data-stu-id="2050a-188">User private</span></span>            | <span data-ttu-id="2050a-189">% APPDATA% \\ Microsoft \\ - \\ Kryptografieschlüssel</span><span class="sxs-lookup"><span data-stu-id="2050a-189">%APPDATA%\\Microsoft\\Crypto\\Keys</span></span>                                 |
| <span data-ttu-id="2050a-190">Lokales System privat</span><span class="sxs-lookup"><span data-stu-id="2050a-190">Local system private</span></span>    | <span data-ttu-id="2050a-191">% ALLUSERSPROFILE% \\ Anwendungsdaten \\ Microsoft \\ Crypto \\ systemkeys</span><span class="sxs-lookup"><span data-stu-id="2050a-191">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\SystemKeys</span></span> |
| <span data-ttu-id="2050a-192">Lokaler Dienst privat</span><span class="sxs-lookup"><span data-stu-id="2050a-192">Local service private</span></span>   | <span data-ttu-id="2050a-193">% Windir% \\ ServiceProfiles \\ LocalService</span><span class="sxs-lookup"><span data-stu-id="2050a-193">%WINDIR%\\ServiceProfiles\\LocalService</span></span>                            |
| <span data-ttu-id="2050a-194">Netzwerkdienst privat</span><span class="sxs-lookup"><span data-stu-id="2050a-194">Network service private</span></span> | <span data-ttu-id="2050a-195">% Windir% \\ ServiceProfiles \\ NetworkService</span><span class="sxs-lookup"><span data-stu-id="2050a-195">%WINDIR%\\ServiceProfiles\\NetworkService</span></span>                          |
| <span data-ttu-id="2050a-196">Freigegeben, privat</span><span class="sxs-lookup"><span data-stu-id="2050a-196">Shared private</span></span>          | <span data-ttu-id="2050a-197">% ALLUSERSPROFILE% \\ Anwendungsdaten \\ Microsoft \\ - \\ Kryptografieschlüssel</span><span class="sxs-lookup"><span data-stu-id="2050a-197">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\Keys</span></span>       |



 

<span data-ttu-id="2050a-198">Im folgenden finden Sie einige der Unterschiede zwischen den kryptoapi-und CNG-Schlüssel Containern.</span><span class="sxs-lookup"><span data-stu-id="2050a-198">The following are some of the differences between the CryptoAPI and CNG key containers.</span></span>

-   <span data-ttu-id="2050a-199">CNG verwendet unterschiedliche Dateinamen für Schlüsseldateien als Schlüsseldateien, die vom Rsaenh.dll und Dssenh.dll Legacy-CSPs erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="2050a-199">CNG uses different file names for key files than key files that are created by the Rsaenh.dll and Dssenh.dll legacy CSPs.</span></span> <span data-ttu-id="2050a-200">Die Legacy Schlüsseldateien verfügen ebenfalls über die Erweiterung ". Key", aber CNG-Schlüsseldateien haben nicht die Erweiterung. Key.</span><span class="sxs-lookup"><span data-stu-id="2050a-200">The legacy key files also have the .key extension, but CNG key files do not have the .key extension.</span></span>
-   <span data-ttu-id="2050a-201">CNG unterstützt vollständige Unicode-Schlüssel Container Namen; CNG verwendet einen Hash des Unicode-Container namens, während CryptoAPI einen Hash des ANSI-Container namens verwendet.</span><span class="sxs-lookup"><span data-stu-id="2050a-201">CNG fully supports Unicode key container names; CNG uses a hash of the Unicode container name, whereas CryptoAPI uses a hash of the ANSI container name.</span></span>
-   <span data-ttu-id="2050a-202">CNG ist in Bezug auf RSA-Schlüsselpaare flexibler.</span><span class="sxs-lookup"><span data-stu-id="2050a-202">CNG is more flexible with regard to RSA key pairs.</span></span> <span data-ttu-id="2050a-203">CNG unterstützt z. b. öffentliche Exponenten mit einer Länge von mehr als 32 Bit und unterstützt Schlüssel, bei denen p und q eine unterschiedliche Länge aufweisen.</span><span class="sxs-lookup"><span data-stu-id="2050a-203">For example, CNG supports public exponents larger than 32-bits in length, and it supports keys in which p and q are different lengths.</span></span>
-   <span data-ttu-id="2050a-204">In CryptoAPI wird die Schlüssel Containerdatei in einem Verzeichnis gespeichert, dessen Name die Text Entsprechung der SID des Benutzers ist.</span><span class="sxs-lookup"><span data-stu-id="2050a-204">In CryptoAPI, the key container file is stored in a directory whose name is the textual equivalent of the user's SID.</span></span> <span data-ttu-id="2050a-205">Dies ist nicht mehr der Fall in CNG, wodurch die Schwierigkeit entfällt, Benutzer aus einer Domäne in eine andere zu verschieben, ohne alle Ihre privaten Schlüssel zu verlieren.</span><span class="sxs-lookup"><span data-stu-id="2050a-205">This is no longer the case in CNG, which removes the difficulty of moving users from one domain to another without losing all of their private keys.</span></span>
-   <span data-ttu-id="2050a-206">Der CNG-KSP und die Schlüsselnamen sind auf die **maximalen \_ Pfad** -Unicode-Zeichen beschränkt.</span><span class="sxs-lookup"><span data-stu-id="2050a-206">The CNG KSP and key names are limited to **MAX\_PATH** Unicode characters.</span></span> <span data-ttu-id="2050a-207">Der CryptoAPI-CSP-und der Schlüssel Name sind auf die **maximalen \_ Pfad** -ANSI-Zeichen beschränkt.</span><span class="sxs-lookup"><span data-stu-id="2050a-207">The CryptoAPI CSP and key names are limited to **MAX\_PATH** ANSI characters.</span></span>
-   <span data-ttu-id="2050a-208">CNG bietet die Funktion benutzerdefinierter Schlüsseleigenschaften.</span><span class="sxs-lookup"><span data-stu-id="2050a-208">CNG offers the capability of user-defined key properties.</span></span> <span data-ttu-id="2050a-209">Benutzer können benutzerdefinierte Eigenschaften erstellen und mit ihnen verknüpften Schlüsseln verknüpfen.</span><span class="sxs-lookup"><span data-stu-id="2050a-209">Users can create and associate custom properties with keys, and have them stored with persisted keys.</span></span>

<span data-ttu-id="2050a-210">Beim Beibehalten eines Schlüssels kann CNG zwei Dateien erstellen.</span><span class="sxs-lookup"><span data-stu-id="2050a-210">When persisting a key, CNG can create two files.</span></span> <span data-ttu-id="2050a-211">Die erste Datei enthält den privaten Schlüssel im neuen CNG-Format und wird immer erstellt.</span><span class="sxs-lookup"><span data-stu-id="2050a-211">The first file contains the private key in the new CNG format and is always created.</span></span> <span data-ttu-id="2050a-212">Diese Datei kann von den Legacy-CryptoAPI-CSPs nicht verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="2050a-212">This file is not usable by the legacy CryptoAPI CSPs.</span></span> <span data-ttu-id="2050a-213">Die zweite Datei enthält den gleichen privaten Schlüssel im Legacy-kryptoapi-Schlüssel Container.</span><span class="sxs-lookup"><span data-stu-id="2050a-213">The second file contains the same private key in the legacy CryptoAPI key container.</span></span> <span data-ttu-id="2050a-214">Die zweite Datei entspricht dem Format und dem Speicherort, die von Rsaenh.dll verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="2050a-214">The second file conforms to the format and location used by Rsaenh.dll.</span></span> <span data-ttu-id="2050a-215">Die zweite Datei kann nur erstellt werden, wenn der **NCrypt- \_ Flag zum Schreiben von Schreib \_ Schlüsseln in den \_ \_ Legacy \_ Speicher \_** angegeben wird, wenn die [**ncryptfinalizekey**](/windows/desktop/api/Ncrypt/nf-ncrypt-ncryptfinalizekey) -Funktion aufgerufen wird, um einen RSA-Schlüssel zu finalisieren.</span><span class="sxs-lookup"><span data-stu-id="2050a-215">Creation of the second file only occurs if the **NCRYPT\_WRITE\_KEY\_TO\_LEGACY\_STORE\_FLAG** flag is specified when the [**NCryptFinalizeKey**](/windows/desktop/api/Ncrypt/nf-ncrypt-ncryptfinalizekey) function is called to finalize an RSA key.</span></span> <span data-ttu-id="2050a-216">Diese Funktion wird für DSA-und DH-Schlüssel nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="2050a-216">This feature is not supported for DSA and DH keys.</span></span>

<span data-ttu-id="2050a-217">Wenn eine Anwendung versucht, einen vorhandenen persistenten Schlüssel zu öffnen, versucht CNG zuerst, die native CNG-Datei zu öffnen.</span><span class="sxs-lookup"><span data-stu-id="2050a-217">When an application attempts to open an existing persisted key, CNG first attempts to open the native CNG file.</span></span> <span data-ttu-id="2050a-218">Wenn diese Datei nicht vorhanden ist, versucht CNG, einen übereinstimmenden Schlüssel im Legacy-kryptoapi-Schlüssel Container zu finden.</span><span class="sxs-lookup"><span data-stu-id="2050a-218">If this file does not exist, then CNG attempts to locate a matching key in the legacy CryptoAPI key container.</span></span>

<span data-ttu-id="2050a-219">Wenn Sie kryptoapi-Schlüssel von einem Quellcomputer auf einen Zielcomputer mit dem Windows-Migrationstool für den Benutzerstatus (Anwendungsprotokoll) verschieben oder kopieren, kann CNG nicht auf die Schlüssel auf dem Zielcomputer zugreifen.</span><span class="sxs-lookup"><span data-stu-id="2050a-219">When you move or copy CryptoAPI keys from a source machine to a target machine with Windows User State Migration Tool (USMT), CNG will fail to access the keys on the target machine.</span></span> <span data-ttu-id="2050a-220">Für den Zugriff auf solche migrierten Schlüssel müssen Sie die CryptoAPI verwenden.</span><span class="sxs-lookup"><span data-stu-id="2050a-220">To access such migrated keys, you must use the CryptoAPI.</span></span>

 

 




