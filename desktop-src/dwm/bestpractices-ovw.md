---
title: Überlegungen zur Leistung und bewährte Methoden
description: In diesem Thema werden bewährte Methoden für die Verwendung der Desktopfenster-Manager-APIs (DWM) vorgestellt.
ms.assetid: 5b1f6ff8-1d3f-4a70-8efd-90f8802e8532
keywords:
- Desktopfenster-Manager (DWM), bewährte Methoden
- Dwm (Desktopfenster-Manager), bewährte Methoden
- Desktopfenster-Manager (DWM), Anwendungspraktiken
- Dwm (Desktopfenster-Manager), Anwendungspraktiken
- Desktopfenster-Manager (DWM), Zeichnen von Methoden
- Dwm (Desktopfenster-Manager), Zeichnen von Methoden
- Desktopfenster-Manager (DWM), weich zeichnerhintergrund
- Dwm (Desktopfenster-Manager), weich zeichnerhintergrund
- Anwendungspraktiken
- Zeichnungs Methoden
- weichzeichnerhintergrund
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ec76a4920a91f9502940e866d58641a2550d9354
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/20/2020
ms.locfileid: "106340930"
---
# <a name="performance-considerations-and-best-practices"></a><span data-ttu-id="20cde-114">Überlegungen zur Leistung und bewährte Methoden</span><span class="sxs-lookup"><span data-stu-id="20cde-114">Performance Considerations and Best Practices</span></span>

<span data-ttu-id="20cde-115">In diesem Thema werden bewährte Methoden für die Verwendung der Desktopfenster-Manager-APIs (DWM) vorgestellt.</span><span class="sxs-lookup"><span data-stu-id="20cde-115">This topic presents a set of best practices for using the Desktop Window Manager (DWM) APIs.</span></span>

<span data-ttu-id="20cde-116">Dieses Thema enthält folgende Abschnitte:</span><span class="sxs-lookup"><span data-stu-id="20cde-116">This topic contains the following sections:</span></span>

-   [<span data-ttu-id="20cde-117">Anwendungspraktiken für dwm</span><span class="sxs-lookup"><span data-stu-id="20cde-117">Application Practices for DWM</span></span>](#application-practices-for-dwm)
-   [<span data-ttu-id="20cde-118">Zeichnungs Methoden für dwm</span><span class="sxs-lookup"><span data-stu-id="20cde-118">Drawing Practices for DWM</span></span>](#drawing-practices-for-dwm)
-   [<span data-ttu-id="20cde-119">DWM-Blur-Behind Client Region</span><span class="sxs-lookup"><span data-stu-id="20cde-119">DWM Blur-Behind Client Region</span></span>](#dwm-blur-behind-client-region)

## <a name="application-practices-for-dwm"></a><span data-ttu-id="20cde-120">Anwendungspraktiken für dwm</span><span class="sxs-lookup"><span data-stu-id="20cde-120">Application Practices for DWM</span></span>

<span data-ttu-id="20cde-121">Wenn Ihre Anwendung die DPI-Skalierung (dpi) verarbeitet, können Sie eine Anwendung als dpi-fähig deklarieren und die automatische Skalierung verhindern, indem Sie das dpi-abhängige Flag im Programm Manifest festlegen oder die [**SetProcessDPIAware**](/windows/desktop/api/winuser/nf-winuser-setprocessdpiaware) -Funktion während der Programm Initialisierung aufrufen.</span><span class="sxs-lookup"><span data-stu-id="20cde-121">If your application handles dots per inch (dpi) scaling, you can declare an application as dpi-aware and prevent automatic scaling by setting the dpi-aware flag in the program's manifest or by calling the [**SetProcessDPIAware**](/windows/desktop/api/winuser/nf-winuser-setprocessdpiaware) function during program initialization.</span></span>

<span data-ttu-id="20cde-122">Wenn die DWM-Komposition aktiviert ist, empfangen verdeckte Anwendungen keine [**WM- \_ Paint**](/windows/desktop/gdi/wm-paint) -Meldungen mehr und werden nicht aufgefordert, Sie erneut zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="20cde-122">With DWM composition turned on, obscured applications no longer receive [**WM\_PAINT**](/windows/desktop/gdi/wm-paint) messages and are not asked to re-render.</span></span> <span data-ttu-id="20cde-123">Der Inhalt jedes Fensters ist bereits zum Verfassen des Bildschirm Bilds verfügbar.</span><span class="sxs-lookup"><span data-stu-id="20cde-123">Each window's content is already available to compose the screen image.</span></span>

<span data-ttu-id="20cde-124">[**\_ \_ Transparente WS-Ex**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) -Fenster der obersten Ebene sollten bei Treffer Tests mit einem in **WS- \_ Ex \_ geschichteten** Stil kombiniert werden.</span><span class="sxs-lookup"><span data-stu-id="20cde-124">Top-level [**WS\_EX\_TRANSPARENT**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) windows should be combined with a **WS\_EX\_LAYERED** style for the purposes of hit testing.</span></span> <span data-ttu-id="20cde-125">**WS \_ Die \_ transparente Transparenz** ist im klassischen Sinne und ohne Umleitung nützlich für untergeordnete Fenster in einer Hierarchie von Fenstern, die zum selben Thread gehören, aber nicht für Windows der obersten Ebene vorgesehen sind.</span><span class="sxs-lookup"><span data-stu-id="20cde-125">**WS\_EX\_TRANSPARENT** in the classic sense, without redirection, is useful for child windows in a hierarchy of windows that belong to the same thread, but is not intended for top-level windows.</span></span>

<span data-ttu-id="20cde-126">Verwenden Sie Bereiche oder Schichten, um formatierte oder gemischte Fenster zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="20cde-126">Use regions or layering to create shaped or blended windows.</span></span> <span data-ttu-id="20cde-127">Beachten Sie, dass in Windows Vista und höheren Versionen von Windows der benutzerdefinierte Zeichnungs Bereich eines Fensters der obersten Ebene nicht die gewünschten veralteten Inhalte in undrawn-Regionen bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="20cde-127">Note that in Windows Vista and later versions of Windows, custom drawing only part of a top-level window will not provide the desired stale content in undrawn regions.</span></span>

<span data-ttu-id="20cde-128">Mithilfe von APIs, wie z. b. [**getdcorgex**](/windows/desktop/api/wingdi/nf-wingdi-getdcorgex) , können bestimmte tatsächliche Werte bestimmt werden.</span><span class="sxs-lookup"><span data-stu-id="20cde-128">APIs such as [**GetDCOrgEx**](/windows/desktop/api/wingdi/nf-wingdi-getdcorgex) can be used to determine certain actual values.</span></span> <span data-ttu-id="20cde-129">Wenn Sie über einen Gerätekontext (DC) für ein umgeleitetes Fenster verfügen, entspricht der von **getdcorgex** zurückgegebene Ursprung nicht dem Ursprung Ihres Fensters auf dem Bildschirm.</span><span class="sxs-lookup"><span data-stu-id="20cde-129">If you have a device context (DC) for a redirected window, the origin returned by **GetDCOrgEx** will not match the origin of your window on the screen.</span></span> <span data-ttu-id="20cde-130">Der Ursprung ist stattdessen der Ursprung der Hintergrund Puffer Oberfläche für das Fenster: (0,0).</span><span class="sxs-lookup"><span data-stu-id="20cde-130">The origin will instead be the origin of the back-buffer surface for your window: (0, 0).</span></span>

<span data-ttu-id="20cde-131">Wenn alle anderen Fehler ausfallen, deaktivieren Sie das Fenster Rendering durch Aufrufen der Funktion [**DwmSetWindowAttribute**](/windows/desktop/api/Dwmapi/nf-dwmapi-dwmsetwindowattribute) .</span><span class="sxs-lookup"><span data-stu-id="20cde-131">When all else fails, disable window rendering by calling the [**DwmSetWindowAttribute**](/windows/desktop/api/Dwmapi/nf-dwmapi-dwmsetwindowattribute) function.</span></span>

## <a name="drawing-practices-for-dwm"></a><span data-ttu-id="20cde-132">Zeichnungs Methoden für dwm</span><span class="sxs-lookup"><span data-stu-id="20cde-132">Drawing Practices for DWM</span></span>

<span data-ttu-id="20cde-133">Vermeiden Sie es, direkt auf die primäre Anzeige Oberfläche zu zeichnen.</span><span class="sxs-lookup"><span data-stu-id="20cde-133">Avoid drawing directly to the primary display surface.</span></span> <span data-ttu-id="20cde-134">Dadurch wird die DWM gezwungen, die Komposition zu deaktivieren, bis die primäre Geräteoberfläche von der Anwendung freigegeben wird.</span><span class="sxs-lookup"><span data-stu-id="20cde-134">Doing so will force the DWM to disable composition until your application releases the primary device surface.</span></span>

<span data-ttu-id="20cde-135">Evaluieren Sie, ob Ihre Anwendung ihre eigene doppelte Pufferung bereitstellen muss.</span><span class="sxs-lookup"><span data-stu-id="20cde-135">Evaluate whether your application must provide its own double buffering.</span></span> <span data-ttu-id="20cde-136">Der DWM verdoppelt Inhalt und stellt das Fenster in einem einzelnen Frame dar.</span><span class="sxs-lookup"><span data-stu-id="20cde-136">The DWM effectively double buffers content and presents the window in a single frame.</span></span>

<span data-ttu-id="20cde-137">Vermeiden Sie Lese-oder Schreibvorgänge auf einem anzeigen Domänen Controller.</span><span class="sxs-lookup"><span data-stu-id="20cde-137">Avoid reading from or writing to a display DC.</span></span> <span data-ttu-id="20cde-138">Obwohl es von DWM unterstützt wird, wird es aufgrund einer verringerten Leistung nicht empfohlen.</span><span class="sxs-lookup"><span data-stu-id="20cde-138">Although supported by DWM, we do not recommend it because of decreased performance.</span></span>

<span data-ttu-id="20cde-139">Vermeiden Sie das Zeichnen im nicht-Client Bereich.</span><span class="sxs-lookup"><span data-stu-id="20cde-139">Avoid drawing in the non-client area.</span></span> <span data-ttu-id="20cde-140">Obwohl die Anwendung auf diesen Bereich zugreifen kann und das Zeichnen von der Microsoft Win32-API unterstützt wird, kann dies dazu führen, dass das Fenster einen beliebigen Glasrahmen verliert.</span><span class="sxs-lookup"><span data-stu-id="20cde-140">Although this area can be accessed by the application, and drawing there is supported by the Microsoft Win32 API, doing this can cause the window to lose any glass border it has.</span></span>

<span data-ttu-id="20cde-141">Vermeiden Sie das Mischen von Windows Graphics Device Interface (GDI) und Microsoft DirectX, es sei denn, Sie überlappen sich nicht</span><span class="sxs-lookup"><span data-stu-id="20cde-141">Avoid mixing Windows Graphics Device Interface (GDI) and Microsoft DirectX unless they do not overlap.</span></span> <span data-ttu-id="20cde-142">Wenn eine Mischung erforderlich ist, zeichnen Sie den GDI-Inhalt in eine DirectX-Software Oberfläche, und kombinieren Sie diese vor der Komposition auf dem Bildschirm, oder zeichnen Sie Sie in separaten Fenstern.</span><span class="sxs-lookup"><span data-stu-id="20cde-142">If mixing is necessary, either draw the GDI content into a DirectX software surface and combine them before composing to the screen, or else draw them in separate windows.</span></span>

<span data-ttu-id="20cde-143">Verwenden Sie die [**BitBLT**](/windows/desktop/api/wingdi/nf-wingdi-bitblt) -oder die [**StretchBlt**](/windows/desktop/api/wingdi/nf-wingdi-stretchblt) -Funktion anstelle von Windows GDI+, um die Zeichnung zum Rendern darzustellen.</span><span class="sxs-lookup"><span data-stu-id="20cde-143">Use [**BitBlt**](/windows/desktop/api/wingdi/nf-wingdi-bitblt) or [**StretchBlt**](/windows/desktop/api/wingdi/nf-wingdi-stretchblt) function instead of Windows GDI+ to present your drawing for rendering.</span></span> <span data-ttu-id="20cde-144">GDI+ rendert jeweils eine Scan Zeile mit Software Rendering.</span><span class="sxs-lookup"><span data-stu-id="20cde-144">GDI+ renders one scan line at a time with software rendering.</span></span> <span data-ttu-id="20cde-145">Dies kann zu einem Flimmern in Ihren Anwendungen führen.</span><span class="sxs-lookup"><span data-stu-id="20cde-145">This can cause flickering in your applications.</span></span>

## <a name="dwm-blur-behind-client-region"></a><span data-ttu-id="20cde-146">DWM-Blur-Behind Client Region</span><span class="sxs-lookup"><span data-stu-id="20cde-146">DWM Blur-Behind Client Region</span></span>

<span data-ttu-id="20cde-147">Das Rendern des weich Zeichnens-Effekts ist ein ressourcenintensiver Vorgang für die CPU und die Grafikverarbeitungseinheit (GPU).</span><span class="sxs-lookup"><span data-stu-id="20cde-147">Rendering the blur-behind effect is a resource-intensive operation for both the CPU and the graphics processing unit (GPU).</span></span> <span data-ttu-id="20cde-148">Anwendungsentwickler werden dazu aufgefordert, die Auswirkungen der Verwendung von Client Bereichs Unschärfe zu berücksichtigenden, sodass Sie nicht übermäßig viele Ressourcen verbraucht.</span><span class="sxs-lookup"><span data-stu-id="20cde-148">Application developers are urged to consider the implications of using client-area blur so that it does not consume excessive resources.</span></span> <span data-ttu-id="20cde-149">In den folgenden Fällen sollten Sie eine besondere Vorsicht walten lassen:</span><span class="sxs-lookup"><span data-stu-id="20cde-149">You should use particular caution in the following cases:</span></span>

-   <span data-ttu-id="20cde-150">Wenn Sie davon ausgehen, dass die Größe des Client Bereichs weich ist, ist dies auch dann der Fall, wenn keine Updates im unscharfen Bereich selbst auftreten.</span><span class="sxs-lookup"><span data-stu-id="20cde-150">When you expect the size of the client-area blur to be significant, even if no updates will occur in the blurred area itself.</span></span> <span data-ttu-id="20cde-151">Die Unschärfe muss für den Fall gerendert werden, dass im unscharfen Bereich des Fensters Updates auftreten, was zu CPU-und GPU-Kosten führt.</span><span class="sxs-lookup"><span data-stu-id="20cde-151">The blur has to be rendered in case any updates occur under the blurred area of the window, which incurs CPU and GPU costs.</span></span> <span data-ttu-id="20cde-152">Außerdem verursachen Fenster Vorgänge im Fenster (verschieben/ändern der Größe/Übergänge) Mehrkosten.</span><span class="sxs-lookup"><span data-stu-id="20cde-152">In addition, window operations on the window (move/resize/transitions) will incur more costs.</span></span>
-   <span data-ttu-id="20cde-153">Wenn Sie im unscharfen Client Bereich beträchtliche Updates erwarten.</span><span class="sxs-lookup"><span data-stu-id="20cde-153">When you expect significant updates in the blurred client area.</span></span> <span data-ttu-id="20cde-154">Dies erfordert eine Umgestaltung der weich Zeichnung bei jedem Update und eine übermäßige Ressourcennutzung.</span><span class="sxs-lookup"><span data-stu-id="20cde-154">This will require a repaint of the blur on every update and consume excessive resources.</span></span>
-   <span data-ttu-id="20cde-155">Wenn der Weichzeichner einen erheblichen Bereich abdecken soll und auch Updates für diesen Bereich erwartet werden, wird dringend empfohlen, den Client Bereich nicht zu verwischen.</span><span class="sxs-lookup"><span data-stu-id="20cde-155">If the blur is expected to cover a significant area, and updates to that area are also expected, we strongly recommended that you do not blur the client area.</span></span>

 

 