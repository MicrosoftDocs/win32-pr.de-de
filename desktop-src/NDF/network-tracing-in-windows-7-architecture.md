---
title: Netzwerk Ablauf Verfolgung in Windows 7-Architektur
description: Die folgende Abbildung zeigt die grundlegende Architektur der Netzwerk Ablauf Verfolgung in Windows 7.
ms.assetid: b3023469-0f98-451c-b39f-c3eae771eacc
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 41221ebf434c05a8c9b7c8489e861128029b5320
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/20/2020
ms.locfileid: "106339296"
---
# <a name="network-tracing-in-windows-7-architecture"></a><span data-ttu-id="86fc5-103">Netzwerk Ablauf Verfolgung in Windows 7: Architektur</span><span class="sxs-lookup"><span data-stu-id="86fc5-103">Network Tracing in Windows 7: Architecture</span></span>

<span data-ttu-id="86fc5-104">Die folgende Abbildung zeigt die grundlegende Architektur der Netzwerk Ablauf Verfolgung in Windows 7.</span><span class="sxs-lookup"><span data-stu-id="86fc5-104">The illustration below shows the basic network tracing architecture in Windows 7.</span></span>

![Architektur Diagramm der Netzwerk Ablauf Verfolgung](images/ut1.png)

<span data-ttu-id="86fc5-106">Die Netzwerk Ablauf Verfolgung nutzt das in Windows verfügbare etw-Framework (Event Tracing for Windows).</span><span class="sxs-lookup"><span data-stu-id="86fc5-106">Network tracing utilizes the Event Tracing for Windows (ETW) framework available in Windows.</span></span> <span data-ttu-id="86fc5-107">Netzwerkkomponenten (z. b. Winsock, TCP/IP, NDIS, Paket Erfassung usw.) registrieren sich als etw-Ablauf Verfolgungs Anbieter und geben Ereignisse im Zusammenhang mit der Netzwerkaktivität aus.</span><span class="sxs-lookup"><span data-stu-id="86fc5-107">Network components (such as Winsock, TCP/IP, NDIS, packet-capture, and so on) register as ETW trace providers and emit events related to network activity.</span></span> <span data-ttu-id="86fc5-108">Jede beschreibbare Aktivität von Bedeutung kann ein Ereignis sein, das an etw protokolliert wird.</span><span class="sxs-lookup"><span data-stu-id="86fc5-108">Any recordable activity of significance can be an event logged to ETW.</span></span> <span data-ttu-id="86fc5-109">Die Ablauf Verfolgung für diese Netzwerkkomponenten und Paket Erfassungen kann mit dem **netsh** -Ablauf Verfolgungs Kontext aktiviert werden, der als etw-Controller fungiert.</span><span class="sxs-lookup"><span data-stu-id="86fc5-109">Tracing for these network components and packet captures can be enabled using the **netsh trace** context which acts as an ETW controller.</span></span>

<span data-ttu-id="86fc5-110">Die generierten Ablauf Verfolgungen werden in einer ETL-Datei (Event Trace Log, Ereignis Ablauf Verfolgungs Protokoll) gesammelt.</span><span class="sxs-lookup"><span data-stu-id="86fc5-110">The generated traces are collected in an Event Trace Log (ETL) file.</span></span> <span data-ttu-id="86fc5-111">Diese ETL-Dateien können dann mit einer Reihe von Tools analysiert werden, z. b. Netzwerkmonitor 3,2 und höher, Ereignisanzeige, **Netsh Trace Convert** oder Tracerpt.exe.</span><span class="sxs-lookup"><span data-stu-id="86fc5-111">These ETL files can then be analyzed using a number of tools, such as Network Monitor 3.2 and later, Event Viewer, **netsh trace convert**, or Tracerpt.exe.</span></span>

<span data-ttu-id="86fc5-112">Jedes ETW-Ereignis verfügt über einen allgemeinen Header, bei dem etw Informationen speichert, z. b. die Ereignis Eigenschaften, Zeitstempel und die Aktivitäts-ID.</span><span class="sxs-lookup"><span data-stu-id="86fc5-112">Each ETW event has a common header where ETW stores information such as the event properties, time stamps, and activity ID.</span></span> <span data-ttu-id="86fc5-113">(Weitere Informationen zu Aktivitäts-IDs finden [Sie unterschreiben verwandter Ereignisse in einem End-to-End-Szenario](../etw/writing-related-events-in-an-end-to-end-scenario.md)).</span><span class="sxs-lookup"><span data-stu-id="86fc5-113">(For more information about activity IDs, see [Writing Related Events in an End-to-End Scenario](../etw/writing-related-events-in-an-end-to-end-scenario.md)).</span></span> <span data-ttu-id="86fc5-114">Die Aktivitäts-ID wird verwendet, um Ereignisse zu korrelieren.</span><span class="sxs-lookup"><span data-stu-id="86fc5-114">The activity ID is used to correlate events.</span></span> <span data-ttu-id="86fc5-115">Im Benutzermodus werden Aktivitäts-IDs in Threads gespeichert, und alle Ereignisse, die in einem Thread protokolliert werden, werden automatisch mit der gleichen Aktivitäts-ID gekennzeichnet.</span><span class="sxs-lookup"><span data-stu-id="86fc5-115">In user mode, activity IDs are stored in threads, and all events logged in one thread will automatically be tagged with the same activity ID.</span></span> <span data-ttu-id="86fc5-116">Im Kernel Modus muss die Aktivitäts-ID explizit übermittelt werden, wenn ein Ereignis protokolliert wird.</span><span class="sxs-lookup"><span data-stu-id="86fc5-116">In kernel mode, the activity ID must be explicitly passed when an event is logged.</span></span> <span data-ttu-id="86fc5-117">ETL-Dateien werden standardmäßig zusammen mit den Gruppen Ereignissen unter bestimmten Aktivitäts-IDs korreliert.</span><span class="sxs-lookup"><span data-stu-id="86fc5-117">By default, ETL files are correlated to group events together under specific activity IDs.</span></span>

<span data-ttu-id="86fc5-118">Weitere Informationen zu Windows-Ereignissen und etw finden Sie unter [Windows-Ereignisse](../events/windows-events.md).</span><span class="sxs-lookup"><span data-stu-id="86fc5-118">For more information about Windows Events and ETW, see [Windows Events](../events/windows-events.md).</span></span>

## <a name="etw-components-in-network-tracing"></a><span data-ttu-id="86fc5-119">Etw-Komponenten in der Netzwerk Ablauf Verfolgung</span><span class="sxs-lookup"><span data-stu-id="86fc5-119">ETW Components in Network Tracing</span></span>

<span data-ttu-id="86fc5-120">Die Netzwerk Ablauf Verfolgung verwendet etw als primären Ablauf Verfolgungs Mechanismus, um Informationen über die Vorgänge der Netzwerk Subsysteme bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="86fc5-120">Network tracing uses ETW as its primary tracing mechanism to provide information about what the networking subsystems are doing.</span></span> <span data-ttu-id="86fc5-121">Etw umfasst vier Hauptkomponenten: Ereignis Ablauf Verfolgungs Sitzungen, Ereignis Anbieter, Ereignis Controller und Ereignisconsumer.</span><span class="sxs-lookup"><span data-stu-id="86fc5-121">There are four main components in ETW: event trace sessions, event providers, event controllers and event consumers.</span></span>

<span data-ttu-id="86fc5-122">Pufferung und Protokollierung erfolgen in *Ereignis Ablauf Verfolgungs Sitzungen*, bei denen Ereignisse von Anbietern akzeptiert und Ablauf Verfolgungs Dateien erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="86fc5-122">Buffering and logging take place in *event trace sessions*, which accept events from providers and creates trace files.</span></span>

<span data-ttu-id="86fc5-123">Ein *Ereignis Anbieter* ist eine logische Entität, die Ereignisse in ETW-Sitzungen schreibt.</span><span class="sxs-lookup"><span data-stu-id="86fc5-123">An *event provider* is a logical entity that writes events to ETW sessions.</span></span> <span data-ttu-id="86fc5-124">Ein Ereignis Anbieter kann eine Benutzermodusanwendung, eine verwaltete Anwendung, ein Treiber oder eine beliebige andere Software Entität sein.</span><span class="sxs-lookup"><span data-stu-id="86fc5-124">An event provider can be a user-mode application, a managed application, a driver, or any other software entity.</span></span> <span data-ttu-id="86fc5-125">Ereignis Anbieter registrieren sich bei etw und schreiben Ereignisse aus verschiedenen Punkten im Code, indem Sie die ETW-Protokollierungs-API aufrufen.</span><span class="sxs-lookup"><span data-stu-id="86fc5-125">Event providers register with ETW and write events from various points in the code by invoking the ETW logging API.</span></span> <span data-ttu-id="86fc5-126">Aufgrund der wachsenden Ereignis Instrumentation in vielen Betriebssystemkomponenten enthält auch eine einfache Anwendung oder ein Szenario in Windows mehrere Komponenten, bei denen es sich um Ereignis Anbieter handelt.</span><span class="sxs-lookup"><span data-stu-id="86fc5-126">Due to the growing event instrumentation in many operating system components, even a simple application or scenario in Windows will contain several components that are event providers.</span></span>

<span data-ttu-id="86fc5-127">Ein *Ereignis Controller* startet und beendet Ereignis Ablauf Verfolgungs Sitzungen und ermöglicht Anbieter.</span><span class="sxs-lookup"><span data-stu-id="86fc5-127">An *event controller* starts and stops event trace sessions and enables providers.</span></span> <span data-ttu-id="86fc5-128">Wenn ein Ereignis Anbieter dynamisch von der Ereignis Controller Anwendung aktiviert wird, sendet der Anbieter Ereignisse an eine bestimmte Ereignis Ablauf Verfolgungs Sitzung, die vom Ereignis Controller festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="86fc5-128">When an event provider is enabled dynamically by the event controller application, the provider sends events to a specific event trace session designated by the event controller.</span></span> <span data-ttu-id="86fc5-129">Jedes Ereignis, das vom Ereignis Anbieter an die Ereignis Ablauf Verfolgungs Sitzung gesendet wird, besteht aus einem Fixed-Header, der Ereignis Metadaten und alle zusätzlichen benutzerdefinierten Daten enthält, die vom Anbieter protokolliert werden.</span><span class="sxs-lookup"><span data-stu-id="86fc5-129">Each event sent by the event provider to the event trace session consists of a fixed header, which includes event metadata and any additional custom data logged by the provider.</span></span>

<span data-ttu-id="86fc5-130">Ein *Ereignisconsumer* ist eine Anwendung, die Protokolldateien liest oder eine Ereignis Ablauf Verfolgungs Sitzung für Echtzeitereignisse abhört und verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="86fc5-130">An *event consumer* is an application that reads log files or that listens to an event trace session for real-time events and processes them.</span></span> <span data-ttu-id="86fc5-131">Ein Beispiel für einen Ereignisconsumer ist Microsoft-Netzwerkmonitor 3,2, der die Fähigkeit zum Lesen und Anzeigen von Protokolldateien enthält, die von der Netzwerk Ablauf Verfolgung in Windows 7 erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="86fc5-131">One example of an event consumer is Microsoft Network Monitor 3.2, which includes the capability to read and display log files produced by network tracing in Windows 7.</span></span>

<span data-ttu-id="86fc5-132">Ereignisse werden in chronologischer Reihenfolge an Ereignisconsumer übermittelt, und es gibt verschiedene ereignisconsumeranwendungen, in denen die Ereignisse in bestimmten Formaten angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="86fc5-132">Events are delivered to event consumers in chronological order, and there are various event consumer applications that display the events in specific formats.</span></span> <span data-ttu-id="86fc5-133">Wenn ein Ereignis in einer Sitzung protokolliert wird, fügt ETW dem Ereignis Header zusätzliche Informationen hinzu, einschließlich Zeitstempel, Prozess-und Thread-ID, Prozessornummer und CPU-Nutzungsdaten des Protokollierungs Threads.</span><span class="sxs-lookup"><span data-stu-id="86fc5-133">When an event is logged to a session, ETW adds additional information to the event header, including the timestamp, process and thread ID, processor number, and CPU usage data of the logging thread.</span></span> <span data-ttu-id="86fc5-134">Diese Daten werden dann zusammen mit allen benutzerdefinierten Daten, die vom Anbieter eingeschlossen werden, an Ereignisconsumer weitergeleitet.</span><span class="sxs-lookup"><span data-stu-id="86fc5-134">This data is then passed on to event consumers, along with any custom data included by the provider.</span></span>

<span data-ttu-id="86fc5-135">Anbieter, die die neuen [Ereignis Protokollierungs-APIs](/windows/win32/api/evntprov/nf-evntprov-eventwrite) verwenden, müssen eine XML-Datei bereitstellen, die als [Ereignis Manifest](../wes/eventschema-schema.md)bezeichnet wird.</span><span class="sxs-lookup"><span data-stu-id="86fc5-135">Providers using the new [Event Logging APIs](/windows/win32/api/evntprov/nf-evntprov-eventwrite) are expected to supply an XML file called the [event manifest](../wes/eventschema-schema.md).</span></span> <span data-ttu-id="86fc5-136">Diese Datei enthält Metadaten, mit denen alle benutzerdefinierten Daten und Layoutinformationen für die vom Anbieter geschriebenen Ereignisse definiert werden.</span><span class="sxs-lookup"><span data-stu-id="86fc5-136">This file provides metadata to define all of the custom data and layout information for the events written by the provider.</span></span> <span data-ttu-id="86fc5-137">Eine allgemeine Consumeranwendung verwendet dann die APIs für das [Trace Data Helper (TDH)](/windows/win32/api/tdh/) , um die Ereignis Metadaten abzurufen, die Ereignisse zu decodieren und anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="86fc5-137">A general purpose consumer application then uses [Trace Data Helper (TDH)](/windows/win32/api/tdh/) APIs to retrieve the event metadata, decode the events, and display them.</span></span>

<span data-ttu-id="86fc5-138">Mit der Netzwerk Ablauf Verfolgung in Windows 7 umfasst die Ereignis Controller-/consumerseite eine End-to-End-szenariobasierte Ablauf Verfolgungs Unterstützung, die in die Windows-Diagnose-und-Support Umgebungen integriert ist</span><span class="sxs-lookup"><span data-stu-id="86fc5-138">With network tracing in Windows 7, the event controller/consumer side includes end-to-end scenario-based tracing support integrated with overall Windows diagnostic and support experiences.</span></span> <span data-ttu-id="86fc5-139">Ein Szenario definiert eine Sammlung von Ereignis Anbietern, die an dem Szenario beteiligt sind.</span><span class="sxs-lookup"><span data-stu-id="86fc5-139">A scenario defines a collection of event providers involved in the scenario.</span></span> <span data-ttu-id="86fc5-140">Die Ereignis Controller/consumerseite definiert die Szenarien (Kontexte), in denen die Ablauf Verfolgung verwendet werden kann, einschließlich der relevanten Anbieter für bestimmte Szenarien über Netzwerkkomponenten hinweg.</span><span class="sxs-lookup"><span data-stu-id="86fc5-140">The event controller/consumer side defines the scenarios (contexts) where tracing can be used, including the relevant providers for given scenarios across network components.</span></span> <span data-ttu-id="86fc5-141">Die Ereignis Anbieterseite enthält standardisierte Netzwerkablaufverfolgungs-Ereignisse aus verschiedenen Komponenten im Netzwerk Stapel, die über etw-Aktivitäts-IDs korreliert werden können.</span><span class="sxs-lookup"><span data-stu-id="86fc5-141">The event provider side includes standardized network tracing events from different components in the network stack, which can be correlated via ETW activity IDs.</span></span> <span data-ttu-id="86fc5-142">Die Anbieter verwenden ein gängiges Netzwerk Schema, das die Verwendung von etw-Konzepten, wie z. b. Schlüsselwörtern, Ebenen, Tasks und Opcodes, standardisiert.</span><span class="sxs-lookup"><span data-stu-id="86fc5-142">The providers use a common network schema that standardizes the use of ETW concepts such as keywords, levels, tasks, and opcodes.</span></span> <span data-ttu-id="86fc5-143">Das Schema definiert auch Ereignisse, die für viele Netzwerkkomponenten (z. b. Fehlerereignisse, Paket Lösch Ereignisse, Schema Ereignisse und Zustands Übergangs Ereignisse) üblich sind.</span><span class="sxs-lookup"><span data-stu-id="86fc5-143">The schema also defines events that are common for many network components such as error events, packet drop events, schema events, and state transition events.</span></span>

 

 