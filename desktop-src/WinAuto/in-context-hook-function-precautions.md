---
title: Vorsichtsmaßnahmen für In-Context Hook-Funktion
description: Aus Leistungsgründen registrieren Client Entwickler kontextbasierte Hook-Funktionen.
ms.assetid: 14b48920-a291-4519-b005-e559263a0e83
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8c0e319037cb1295725548b3361bf076b4b1f760
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/20/2020
ms.locfileid: "106339895"
---
# <a name="in-context-hook-function-precautions"></a><span data-ttu-id="e9582-103">Vorsichtsmaßnahmen für In-Context Hook-Funktion</span><span class="sxs-lookup"><span data-stu-id="e9582-103">In-Context Hook Function Precautions</span></span>

<span data-ttu-id="e9582-104">Aus Leistungsgründen registrieren Client Entwickler kontextbasierte Hook-Funktionen.</span><span class="sxs-lookup"><span data-stu-id="e9582-104">For performance reasons, client developers register in-context hook functions.</span></span> <span data-ttu-id="e9582-105">Da diese Hook-Funktionen jedoch im Adressraum des Servers zugeordnet sind, müssen Client-und Server Entwickler Vorsichtsmaßnahmen treffen, um sicherzustellen, dass die Ereignisverarbeitung reibungslos verläuft.</span><span class="sxs-lookup"><span data-stu-id="e9582-105">However, because these hook functions are mapped into the server's address space, client and server developers must take precautions to ensure that the event processing goes smoothly.</span></span>

## <a name="precautions-for-client-developers"></a><span data-ttu-id="e9582-106">Vorsichtsmaßnahmen für Client Entwickler</span><span class="sxs-lookup"><span data-stu-id="e9582-106">Precautions for Client Developers</span></span>

<span data-ttu-id="e9582-107">Client Entwickler sollten folgende Probleme beachten:</span><span class="sxs-lookup"><span data-stu-id="e9582-107">Client developers should be aware of the following issues:</span></span>

-   <span data-ttu-id="e9582-108">In-context-Hook-Funktionen sollten nicht viel Prozessorzeit verwenden, da die Hook-Funktion zurückgegeben werden muss, bevor die Serveranwendung fortgesetzt wird.</span><span class="sxs-lookup"><span data-stu-id="e9582-108">In-context hook functions should not use a lot of processor time, because the hook function must return before the server application continues.</span></span>
-   <span data-ttu-id="e9582-109">Nachdem ein Ereignis ausgelöst wurde, ist es möglich, dass das Fenster, das einem Ereignis zugeordnet ist, nicht mehr zu dem Zeitpunkt vorhanden ist, zu dem die Hook-Funktion aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="e9582-109">After an event is triggered, it is possible that the window associated with an event no longer exists by the time the hook function is called.</span></span> <span data-ttu-id="e9582-110">Clients müssen überprüfen, ob das einem Ereignis zugeordnete Fenster noch vorhanden ist, bevor Sie eine andere Aktion im Zusammenhang mit dem Ereignis ausführen.</span><span class="sxs-lookup"><span data-stu-id="e9582-110">Clients must verify that the window associated with an event still exists before taking any other action related to the event.</span></span> <span data-ttu-id="e9582-111">Um sicherzustellen, dass noch ein Fenster vorhanden ist, verwenden Clients die Microsoft Win32 [**IsWindow**](/windows/desktop/api/winuser/nf-winuser-iswindow) -Funktion.</span><span class="sxs-lookup"><span data-stu-id="e9582-111">To ensure that a window still exists, clients use the Microsoft Win32 [**IsWindow**](/windows/desktop/api/winuser/nf-winuser-iswindow) function.</span></span>
-   <span data-ttu-id="e9582-112">Wenn die dll, in der die Hook-Funktion definiert ist, mit einer anderen DLL verknüpft ist, müssen Client Entwickler sicherstellen, dass das System die andere dll lädt.</span><span class="sxs-lookup"><span data-stu-id="e9582-112">If the DLL in which the hook function is defined links to another DLL, client developers must ensure that the system loads the other DLL.</span></span> <span data-ttu-id="e9582-113">Wenn Sie implizit (mit DEF-und DEF-Dateien) verknüpfen, muss sich die zusätzliche DLL entweder im Windows-Verzeichnis oder in einem der Systemverzeichnisse befinden, wie z \\ . b. Windows System, Windows \\ system32 oder Windows \\ syswow64.</span><span class="sxs-lookup"><span data-stu-id="e9582-113">If linking implicitly (using .def files and imports), the additional DLL must be in either the Windows directory or one of the system directories such as Windows\\System, Windows\\System32, or Windows\\SysWOW64.</span></span> <span data-ttu-id="e9582-114">Wenn Sie explizit (mithilfe von [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya)) verknüpfen, muss der vollständige Pfad zu dem Verzeichnis, in dem sich die zusätzliche dll befindet, im **LoadLibrary**-Befehl angegeben werden.</span><span class="sxs-lookup"><span data-stu-id="e9582-114">If linking explicitly (using [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya)), the full path to the directory in which the additional DLL resides must be specified in the call to **LoadLibrary**.</span></span>
-   <span data-ttu-id="e9582-115">In-context-Hook-Funktionen können einen Stapelüberlauf verursachen, wenn die dll, die die Hook-Funktion enthält, in eine 16-Bit-Anwendung geladen wird.</span><span class="sxs-lookup"><span data-stu-id="e9582-115">In-context hook functions may cause a stack overflow when the DLL that contains the hook function is loaded into a 16-bit application.</span></span> <span data-ttu-id="e9582-116">Dieses Problem tritt auf, weil 16-Bit-Anwendungen eine festgelegte Stapelgröße verwenden, die nicht groß genug ist, um die Kette von System Funktionsaufrufen zu unterstützen, die zu einem Aufruf der Hook-Funktion führen.</span><span class="sxs-lookup"><span data-stu-id="e9582-116">This problem occurs because 16-bit applications use a fixed stack size that is not large enough to accommodate the chain of system function calls that result in a call to the hook function.</span></span>

## <a name="precautions-for-server-developers"></a><span data-ttu-id="e9582-117">Vorsichtsmaßnahmen für Server Entwickler</span><span class="sxs-lookup"><span data-stu-id="e9582-117">Precautions for Server Developers</span></span>

<span data-ttu-id="e9582-118">Server Entwickler müssen sich bewusst sein, dass Client Anwendungen möglicherweise kontextabhängige Hook-Funktionen registrieren.</span><span class="sxs-lookup"><span data-stu-id="e9582-118">Server developers need to be aware that client applications might register in-context hook functions.</span></span> <span data-ttu-id="e9582-119">Wenn ein Server [**NotifyWinEvent**](/windows/desktop/api/Winuser/nf-winuser-notifywinevent)aufruft, muss er darauf vorbereitet sein, [**WM \_ GetObject**](wm-getobject.md) und andere [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) -Methoden zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="e9582-119">When a server calls [**NotifyWinEvent**](/windows/desktop/api/Winuser/nf-winuser-notifywinevent), it must be prepared to handle [**WM\_GETOBJECT**](wm-getobject.md) and other [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) methods.</span></span>

## <a name="invalid-interface-pointers"></a><span data-ttu-id="e9582-120">Ungültige Schnittstellen Zeiger</span><span class="sxs-lookup"><span data-stu-id="e9582-120">Invalid Interface Pointers</span></span>

<span data-ttu-id="e9582-121">Wenn ein Client [**accessibleobjectfromevent**](/windows/desktop/api/Oleacc/nf-oleacc-accessibleobjectfromevent) innerhalb einer Kontext gebundenen Hook-Funktion aufruft, zeigt der [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) -Schnittstellen Zeiger, der zurückgegeben wird, direkt auf den Code im Adressbereich des Servers.</span><span class="sxs-lookup"><span data-stu-id="e9582-121">When a client calls [**AccessibleObjectFromEvent**](/windows/desktop/api/Oleacc/nf-oleacc-accessibleobjectfromevent) within an in-context hook function, the [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) interface pointer that is returned points directly to code in the server's address space.</span></span> <span data-ttu-id="e9582-122">Wenn der Client eine Schnittstellen Eigenschaft mithilfe dieses Zeigers aufruft, ist die Component Object Model (com)-Bibliothek nicht daran beteiligt, das Marshalling (Verpacken und Senden von Schnittstellenparametern über Prozess Grenzen hinweg) oder das Marshalling (entpacken von Parametern, die über Prozess Grenzen hinweg gesendet wurden) zu verwenden, und erkennt nicht, ob ein Objekt zerstört wird.</span><span class="sxs-lookup"><span data-stu-id="e9582-122">If the client calls an interface property using this pointer, the Component Object Model (COM) library is not involved with marshaling (packaging and sending interface parameters across process boundaries) or unmarshaling (unpackaging parameters that have been sent across process boundaries) and does not detect if an object is destroyed.</span></span>

<span data-ttu-id="e9582-123">Wenn der Client eine Schnittstellen Eigenschaft für ein Objekt aufruft, das zerstört wird, verursacht der ungültige Schnittstellen Zeiger einen allgemeinen Schutz Fehler im Adressraum des Servers, es sei denn, der Server erkennt diese Situation.</span><span class="sxs-lookup"><span data-stu-id="e9582-123">If the client calls an interface property to an object that is destroyed, the invalid interface pointer causes a General Protection fault in the server's address space unless the server detects this situation.</span></span>

<span data-ttu-id="e9582-124">Zum Schutz vor ungültigen Schnittstellen Zeigern [Erstellen Server Proxy Objekte](creating-proxy-objects.md) , die barrierefreie Objekte umschließen und die Lebensdauer von zugänglichen Objekten überwachen.</span><span class="sxs-lookup"><span data-stu-id="e9582-124">To protect against invalid interface pointers, servers [create proxy objects](creating-proxy-objects.md) that wrap accessible objects and monitor the life span of accessible objects.</span></span> <span data-ttu-id="e9582-125">Wenn ein Client beispielsweise eine [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) -Eigenschaft aufruft, um Informationen zu einem Objekt zu erhalten, prüft der Proxy, ob das barrierefreie Objekt weiterhin verfügbar ist, und leitet die Anforderung des Clients an das barrierefreie Objekt weiter, wenn dies der Fall ist.</span><span class="sxs-lookup"><span data-stu-id="e9582-125">For instance, when a client calls an [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) property to get information about an object, the proxy checks whether the accessible object is still available, and if so, forwards the client's request to the accessible object.</span></span> <span data-ttu-id="e9582-126">Wenn das barrierefreie Objekt zerstört wird, gibt der Proxy einen Fehler an den Client zurück.</span><span class="sxs-lookup"><span data-stu-id="e9582-126">If the accessible object is destroyed, the proxy returns an error to the client.</span></span>

 

 