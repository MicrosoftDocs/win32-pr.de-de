---
description: Rufen Sie die pdhopenquery-Funktion auf, um eine neue Abfrage zu erstellen, die Leistungsdaten aus einer echt Zeit Quelle oder einer Protokolldatei sammelt. Die-Funktion gibt ein Handle für die Abfrage zurück, die Sie in nachfolgenden PDH-Funktionsaufrufen verwenden.
ms.assetid: 6fd4716e-b163-47a3-b0cb-5f9599f8681f
title: Erstellen einer Abfrage
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5a9d50ec52966529a3476a6d375606ba3d0b538b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "104131681"
---
# <a name="creating-a-query"></a><span data-ttu-id="826a7-104">Erstellen einer Abfrage</span><span class="sxs-lookup"><span data-stu-id="826a7-104">Creating a Query</span></span>

<span data-ttu-id="826a7-105">Rufen Sie die [**pdhopenquery**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) -Funktion auf, um eine neue Abfrage zu erstellen, die Leistungsdaten aus einer echt Zeit Quelle oder einer Protokolldatei sammelt.</span><span class="sxs-lookup"><span data-stu-id="826a7-105">To create a new query that collects performance data from a real-time source or log file, call the [**PdhOpenQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) function.</span></span> <span data-ttu-id="826a7-106">Die-Funktion gibt ein Handle für die Abfrage zurück, die Sie in nachfolgenden PDH-Funktionsaufrufen verwenden.</span><span class="sxs-lookup"><span data-stu-id="826a7-106">The function returns a handle to the query that you use in subsequent PDH function calls.</span></span>

<span data-ttu-id="826a7-107">Nachdem Sie die Abfrage erstellt haben, nennen Sie die [**pdhaddcounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) -Funktion für jeden Zählers, den Sie der Abfrage hinzufügen möchten.</span><span class="sxs-lookup"><span data-stu-id="826a7-107">After creating the query, call the [**PdhAddCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) function for each counter that you want to add to the query.</span></span> <span data-ttu-id="826a7-108">Sie können eine der folgenden Methoden verwenden, um den voll qualifizierten Counter-Pfad bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="826a7-108">You can use one of the following methods to provide the fully qualified counter path.</span></span>

-   <span data-ttu-id="826a7-109">Definieren Sie den Counter-Pfad als statische Zeichenfolge.</span><span class="sxs-lookup"><span data-stu-id="826a7-109">Define the counter path as a static string.</span></span> <span data-ttu-id="826a7-110">Verwenden Sie diese Methode, wenn Sie den gleichen Wert immer überwachen und wenn Sie mit der korrekten Syntax eines Counter-Pfads vertraut sind.</span><span class="sxs-lookup"><span data-stu-id="826a7-110">Use this method if you always monitor the same counter, and if you are familiar with the correct syntax of a counter path.</span></span> <span data-ttu-id="826a7-111">Informationen zur korrekten Syntax, die zum Angeben eines Zählers verwendet wird, finden Sie unter [Angeben eines Counter-Pfads](specifying-a-counter-path.md).</span><span class="sxs-lookup"><span data-stu-id="826a7-111">For information on the correct syntax used to specify a counter, see [Specifying a Counter Path](specifying-a-counter-path.md).</span></span>
-   <span data-ttu-id="826a7-112">Initialisieren Sie eine [**PDH-Objekt \_ \_ Pfad \_ Element**](/windows/desktop/api/Pdh/ns-pdh-pdh_counter_path_elements_a) -Struktur mit den Namen des Computers, des Objekts, des Zählers und der Instanz.</span><span class="sxs-lookup"><span data-stu-id="826a7-112">Initialize a [**PDH\_COUNTER\_PATH\_ELEMENTS**](/windows/desktop/api/Pdh/ns-pdh-pdh_counter_path_elements_a) structure with the names of the computer, object, counter, and instance.</span></span> <span data-ttu-id="826a7-113">Übergeben Sie diese Struktur an [**pdhmakecounterpath**](/windows/desktop/api/Pdh/nf-pdh-pdhmakecounterpatha) , wodurch ein Indikator Pfad für die angegebenen Elemente zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="826a7-113">Pass this structure to [**PdhMakeCounterPath**](/windows/desktop/api/Pdh/nf-pdh-pdhmakecounterpatha) which will return a counter path for the specified elements.</span></span>
-   <span data-ttu-id="826a7-114">Geben Sie einen Counter-Pfad an, der Platzhalter Zeichen enthält, und nennen Sie [**PdhExpandWildCardPath**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha) , um eine Liste der Namen von Zählern abzurufen, die den Platzhalter Zeichen im Pfad entsprechen.</span><span class="sxs-lookup"><span data-stu-id="826a7-114">Specify a counter path that contains wildcard characters and call [**PdhExpandWildCardPath**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha) to get a list of counter names that match the wildcard characters in the path.</span></span> <span data-ttu-id="826a7-115">Durchsuchen Sie die Liste der Zähler Namen, und fügen Sie der Abfrage die gewünschten Indikatoren aus der Liste hinzu.</span><span class="sxs-lookup"><span data-stu-id="826a7-115">Scan through the list of counter names and add to the query the counters that you want from this list.</span></span>
-   <span data-ttu-id="826a7-116">Rufen Sie die [**pdhbrowscounters**](/windows/desktop/api/Pdh/nf-pdh-pdhbrowsecountersa) -Funktion auf, um ein Dialogfeld anzuzeigen, mit dem der Benutzer Leistungsindikatoren durchsuchen und auswählen kann.</span><span class="sxs-lookup"><span data-stu-id="826a7-116">Call the [**PdhBrowseCounters**](/windows/desktop/api/Pdh/nf-pdh-pdhbrowsecountersa) function to display a dialog box that lets the user browse and select performance counters.</span></span> <span data-ttu-id="826a7-117">Weitere Informationen finden Sie unter durch [Suchen](browsing-counters.md)von Leistungsindikatoren.</span><span class="sxs-lookup"><span data-stu-id="826a7-117">For more information, see [Browsing Counters](browsing-counters.md).</span></span>

<span data-ttu-id="826a7-118">Beachten Sie, dass " [**pdhaddcounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) " keine Fehlerbedingung meldet, wenn eine Instanz angegeben ist, die nicht vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="826a7-118">Note that if a counter instance is specified that does not exist, [**PdhAddCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) does not report an error condition.</span></span> <span data-ttu-id="826a7-119">Stattdessen wird ein Fehler erfolgreich zurückgegeben \_ .</span><span class="sxs-lookup"><span data-stu-id="826a7-119">Instead, it returns ERROR\_SUCCESS.</span></span> <span data-ttu-id="826a7-120">Der Grund für dieses Verhalten ist, dass Sie nicht bekannt ist, wenn eine nicht vorhandene Instanz des Zählers angegeben wurde oder eine vorhanden ist, die zwar vorhanden ist, aber noch nicht erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="826a7-120">The reason for this behavior is that it is not known if a nonexistent counter instance has been specified or one that will exist but has not yet been created.</span></span>

<span data-ttu-id="826a7-121">Die fehlende Indikator Instanz wird entweder von [**pdhcollectquerydata**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata), [**pdhgetrawcountervalue**](/windows/desktop/api/Pdh/nf-pdh-pdhgetrawcountervalue)oder [**pdhgetformattedcountervalue**](/windows/desktop/api/Pdh/nf-pdh-pdhgetformattedcountervalue)gemeldet.</span><span class="sxs-lookup"><span data-stu-id="826a7-121">The missing counter instance will be reported by either [**PdhCollectQueryData**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata), [**PdhGetRawCounterValue**](/windows/desktop/api/Pdh/nf-pdh-pdhgetrawcountervalue), or [**PdhGetFormattedCounterValue**](/windows/desktop/api/Pdh/nf-pdh-pdhgetformattedcountervalue).</span></span> <span data-ttu-id="826a7-122">Wenn Sie **pdhcollectquerydata** nur für eine Objektinstanz aufrufen und die Objektinstanz immer noch nicht vorhanden ist, wird davon ausgegangen, dass die Instanz des Zählers nicht vorhanden ist, und die Funktion gibt PDH \_ keine \_ Daten zurück.</span><span class="sxs-lookup"><span data-stu-id="826a7-122">When calling **PdhCollectQueryData** for one counter instance only, and the counter instance still does not exist, it is assumed that the counter instance will not exist and the function returns PDH\_NO\_DATA.</span></span> <span data-ttu-id="826a7-123">Wenn jedoch mehr als ein-Counter abgefragt wird, gibt **pdhcollectquerydata** möglicherweise trotzdem einen Fehler Erfolg zurück, \_ auch wenn eine der-Objektinstanzen noch nicht vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="826a7-123">However, if more than one counter is queried, **PdhCollectQueryData** may still return ERROR\_SUCCESS even if one of the counter instances does not yet exist.</span></span> <span data-ttu-id="826a7-124">Rufen Sie in diesem Fall " **pdhgetrawcountervalue** " oder " **pdhgetformattedcountervalue** " für jede der relevanten Leistungsindikator Instanzen auf.</span><span class="sxs-lookup"><span data-stu-id="826a7-124">In this case, call **PdhGetRawCounterValue** or **PdhGetFormattedCounterValue** for each of the counter instances of interest.</span></span> <span data-ttu-id="826a7-125">Wenn die Instanz beim Aufrufen von **pdhgetrawcountervalue** nicht vorhanden ist, gibt die Funktion den Fehler \_ Erfolg zurück und legt den **cstatus** -Member des [**PDH- \_ \_ rohindikators**](/windows/desktop/api/Pdh/ns-pdh-pdh_raw_counter) auf PDH- \_ Status \_ keine \_ Instanz fest.</span><span class="sxs-lookup"><span data-stu-id="826a7-125">If the instance does not exist when calling **PdhGetRawCounterValue**, the function returns ERROR\_SUCCESS and sets the **CStatus** member of [**PDH\_RAW\_COUNTER**](/windows/desktop/api/Pdh/ns-pdh-pdh_raw_counter) to PDH\_STATUS\_NO\_INSTANCE.</span></span> <span data-ttu-id="826a7-126">Wenn die Instanz beim Aufrufen von **pdhgetformattedcountervalue** nicht vorhanden ist, gibt die Funktion \_ ungültige PDH \_ -Daten zurück und legt den **cstatus** -Member des [**PDH- \_ fmt- \_ CounterValue**](/windows/desktop/api/Pdh/ns-pdh-pdh_fmt_countervalue) auf PDH \_ cstatus \_ No \_ instance fest.</span><span class="sxs-lookup"><span data-stu-id="826a7-126">If the instance does not exist when calling **PdhGetFormattedCounterValue**, the function returns PDH\_INVALID\_DATA and sets the **CStatus** member of the [**PDH\_FMT\_COUNTERVALUE**](/windows/desktop/api/Pdh/ns-pdh-pdh_fmt_countervalue) to PDH\_CSTATUS\_NO\_INSTANCE.</span></span>

<span data-ttu-id="826a7-127">Beachten Sie, dass der in der [**pdhaddcounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) -Funktion angegebene Counter-Pfad lokalisiert werden muss.</span><span class="sxs-lookup"><span data-stu-id="826a7-127">Note that the counter path specified in the [**PdhAddCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) function must be localized.</span></span> <span data-ttu-id="826a7-128">Die [**pdhaddenglishcounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddenglishcountera) -Funktion stellt eine Gebiets Schema neutrale Methode zum Hinzufügen von Leistungsindikatoren zur Abfrage bereit.</span><span class="sxs-lookup"><span data-stu-id="826a7-128">The [**PdhAddEnglishCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddenglishcountera) function provides a locale-neutral way to add performance counters to the query.</span></span> <span data-ttu-id="826a7-129">Diese Funktion ist die empfohlene Methode zum Hinzufügen von Gebiets Schema neutralen Leistungsindikatoren zu einer Abfrage.</span><span class="sxs-lookup"><span data-stu-id="826a7-129">This function is the recommended way to add locale-neutral counters to a query.</span></span>

<span data-ttu-id="826a7-130">Um einen Counter aus einer Abfrage zu entfernen, nennen Sie die [**PdhRemoveCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhremovecounter) -Funktion.</span><span class="sxs-lookup"><span data-stu-id="826a7-130">To remove a counter from a query, call the [**PdhRemoveCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhremovecounter) function.</span></span>

<span data-ttu-id="826a7-131">Nachdem Sie die Datensammlung für eine Abfrage abgeschlossen haben, können Sie die [**pdhclosequery**](/windows/desktop/api/Pdh/nf-pdh-pdhclosequery) -Funktion zum Schließen der Abfrage und zum Freigeben aller zugeordneten Systemressourcen abrufen.</span><span class="sxs-lookup"><span data-stu-id="826a7-131">After you finish collecting data for a query, call the [**PdhCloseQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhclosequery) function to close the query and release all allocated system resources.</span></span> <span data-ttu-id="826a7-132">**Pdhclosequery** schließt alle gegen Handles, die der Abfrage zugeordnet sind.</span><span class="sxs-lookup"><span data-stu-id="826a7-132">**PdhCloseQuery** closes all counter handles associated with the query.</span></span>

 

 



