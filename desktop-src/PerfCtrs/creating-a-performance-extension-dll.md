---
description: Bei einem Anbieter handelt es sich um eine Leistungs-DLL, die für Consumer Leistungsdaten liefert.
ms.assetid: bbb777fe-b97e-4777-b797-ec8525065610
title: Erstellen einer Leistungs Erweiterungs-DLL
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d397f1581454aca1b25c447b35f250eefd215f57
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "103865124"
---
# <a name="creating-a-performance-extension-dll"></a><span data-ttu-id="97e0e-103">Erstellen einer Leistungs Erweiterungs-DLL</span><span class="sxs-lookup"><span data-stu-id="97e0e-103">Creating a Performance Extension DLL</span></span>

> [!IMPORTANT]
> <span data-ttu-id="97e0e-104">Aufgrund erheblicher Leistungs-und Zuverlässigkeits Beschränkungen ist die Methode zum Bereitstellen von Leistungsdaten, die in diesem Thema beschrieben werden, möglicherweise in Zukunft geändert oder nicht verfügbar.</span><span class="sxs-lookup"><span data-stu-id="97e0e-104">Due to significant performance and reliability limitations, the method for providing performance counter data that this topic describes may be altered or unavailable in the future.</span></span> <span data-ttu-id="97e0e-105">Stattdessen empfiehlt Microsoft die Verwendung der unter [Bereitstellen von Indikator Daten mit Version 2,0](providing-counter-data-using-version-2-0.md) beschriebenen Methode zum Erstellen neuer Leistungsindikatoren und die Migration vorhandener Leistungsindikatoren zur Verwendung dieser Methode.</span><span class="sxs-lookup"><span data-stu-id="97e0e-105">Instead, Microsoft recommends that you use the method described in [Providing Counter Data Using Version 2.0](providing-counter-data-using-version-2-0.md) for creating new performance counters and that you migrate existing performance counters to use that method as well.</span></span>

<span data-ttu-id="97e0e-106">Ein [v1-Anbieter](providing-counter-data.md) verwendet eine Leistungs-DLL, die Leistungsdaten für Consumer bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="97e0e-106">A [V1 provider](providing-counter-data.md) uses a performance DLL that provides counter data to consumers.</span></span> <span data-ttu-id="97e0e-107">Die Leistungs-DLL muss die [**openperformancedata**](/previous-versions/windows/desktop/legacy/aa372200(v=vs.85))-, [**collectperformancedata**](/windows/win32/api/winperf/nc-winperf-pm_collect_proc)-und [**closeperformancedata**](/windows/win32/api/winperf/nc-winperf-pm_close_proc) -Funktionen exportieren.</span><span class="sxs-lookup"><span data-stu-id="97e0e-107">The performance DLL must export the [**OpenPerformanceData**](/previous-versions/windows/desktop/legacy/aa372200(v=vs.85)), [**CollectPerformanceData**](/windows/win32/api/winperf/nc-winperf-pm_collect_proc), and [**ClosePerformanceData**](/windows/win32/api/winperf/nc-winperf-pm_close_proc) functions.</span></span> <span data-ttu-id="97e0e-108">In der Regel verwenden Sie eine Modul Definitionsdatei (. def), um die Funktionen aus der dll zu exportieren.</span><span class="sxs-lookup"><span data-stu-id="97e0e-108">Typically, you use a module definition (.def) file to export the functions from the DLL.</span></span> <span data-ttu-id="97e0e-109">Das System ruft diese Funktionen auf, wenn ein Consumer Leistungsdaten abfragt.</span><span class="sxs-lookup"><span data-stu-id="97e0e-109">The system calls these functions when a consumer queries performance data.</span></span>

<span data-ttu-id="97e0e-110">Wenn ein Consumer zum ersten Mal [**RegQueryValueEx**](/windows/desktop/api/winreg/nf-winreg-regqueryvalueexa)aufruft oder der Consumer die [**RegOpenKey**](/windows/desktop/api/winreg/nf-winreg-regopenkeya) -oder [**regconnectregistry**](/windows/desktop/api/winreg/nf-winreg-regconnectregistrya) -Funktion zum Öffnen verwendet `HKEY_PERFORMANCE_DATA` , ruft das System die [**openperformancedata**](/previous-versions/windows/desktop/legacy/aa372200(v=vs.85)) -Funktion für jeden Anbieter auf, der auf dem Computer [registriert](adding-performance-counters.md) ist.</span><span class="sxs-lookup"><span data-stu-id="97e0e-110">The first time a consumer calls [**RegQueryValueEx**](/windows/desktop/api/winreg/nf-winreg-regqueryvalueexa), or if the consumer uses the [**RegOpenKey**](/windows/desktop/api/winreg/nf-winreg-regopenkeya) or [**RegConnectRegistry**](/windows/desktop/api/winreg/nf-winreg-regconnectregistrya) function to open `HKEY_PERFORMANCE_DATA`, the system calls the [**OpenPerformanceData**](/previous-versions/windows/desktop/legacy/aa372200(v=vs.85)) function for each provider that is [registered](adding-performance-counters.md) on the computer.</span></span> <span data-ttu-id="97e0e-111">Die Ausnahme ist, wenn der Anbieter die Liste der Objekte angibt, die er im- `[objects]` Abschnitt von unterstützt. INI-Datei.</span><span class="sxs-lookup"><span data-stu-id="97e0e-111">The exception is if the provider specifies the list of objects that it supports in the `[objects]` section of the .INI file.</span></span> <span data-ttu-id="97e0e-112">In diesem Fall ruft das System den Anbieter nur auf, wenn eines der abgefragten Objekte mit einem Objekt aus der Liste übereinstimmt.</span><span class="sxs-lookup"><span data-stu-id="97e0e-112">In this case, the system calls the provider only if one of the queried objects matches an object from the list.</span></span>

<span data-ttu-id="97e0e-113">Die [**openperformancedata**](/previous-versions/windows/desktop/legacy/aa372200(v=vs.85)) -Funktion gibt allen Anbietern die Möglichkeit, die Leistungsdaten Strukturen zu initialisieren.</span><span class="sxs-lookup"><span data-stu-id="97e0e-113">The [**OpenPerformanceData**](/previous-versions/windows/desktop/legacy/aa372200(v=vs.85)) function gives each provider an opportunity to initialize its performance data structures.</span></span> <span data-ttu-id="97e0e-114">Wenn die **openperformancedata** -Funktion erfolgreich zurückgegeben wird, ruft das System die [**collectperformancedata**](/windows/win32/api/winperf/nc-winperf-pm_collect_proc) -Funktion des Anbieters auf.</span><span class="sxs-lookup"><span data-stu-id="97e0e-114">Then, if the **OpenPerformanceData** function returns successfully, the system calls the provider's [**CollectPerformanceData**](/windows/win32/api/winperf/nc-winperf-pm_collect_proc) function.</span></span> <span data-ttu-id="97e0e-115">Nachfolgende Aufrufe von [**RegQueryValueEx**](/windows/desktop/api/winreg/nf-winreg-regqueryvalueexa) bewirken, dass das System die **collectperformancedata** -Funktion aufruft.</span><span class="sxs-lookup"><span data-stu-id="97e0e-115">Subsequent calls to [**RegQueryValueEx**](/windows/desktop/api/winreg/nf-winreg-regqueryvalueexa) cause the system to call the **CollectPerformanceData** function.</span></span>

<span data-ttu-id="97e0e-116">Wenn der Consumer die Erfassung von Leistungsdaten abschließt, wird `HKEY_PERFORMANCE_DATA` in einem Rückruf der [**RegCloseKey**](/windows/desktop/api/winreg/nf-winreg-regclosekey) -Funktion angegeben.</span><span class="sxs-lookup"><span data-stu-id="97e0e-116">When the consumer finishes collecting performance data, it specifies `HKEY_PERFORMANCE_DATA` in a call to the [**RegCloseKey**](/windows/desktop/api/winreg/nf-winreg-regclosekey) function.</span></span> <span data-ttu-id="97e0e-117">Dies bewirkt, dass das System die [**closeperformancedata**](/windows/win32/api/winperf/nc-winperf-pm_close_proc) -Funktion für jeden Anbieter aufruft.</span><span class="sxs-lookup"><span data-stu-id="97e0e-117">This causes the system to call the [**ClosePerformanceData**](/windows/win32/api/winperf/nc-winperf-pm_close_proc) function for each provider.</span></span> <span data-ttu-id="97e0e-118">Die Anbieter werden dann entladen.</span><span class="sxs-lookup"><span data-stu-id="97e0e-118">The providers are then unloaded.</span></span>

<span data-ttu-id="97e0e-119">Es ist möglich, dass mehrere Consumer gleichzeitig Leistungsdaten sammeln.</span><span class="sxs-lookup"><span data-stu-id="97e0e-119">It is possible for multiple consumers to collect performance data at the same time.</span></span> <span data-ttu-id="97e0e-120">Das System ruft [**openperformancedata**](/previous-versions/windows/desktop/legacy/aa372200(v=vs.85)) -und [**closeperformancedata**](/windows/win32/api/winperf/nc-winperf-pm_close_proc) -Funktionen nur einmal auf, wenn die dll geladen oder entladen wird.</span><span class="sxs-lookup"><span data-stu-id="97e0e-120">The system calls [**OpenPerformanceData**](/previous-versions/windows/desktop/legacy/aa372200(v=vs.85)) and [**ClosePerformanceData**](/windows/win32/api/winperf/nc-winperf-pm_close_proc) functions only once each time the DLL is loaded or unloaded.</span></span>

> [!Note]
> <span data-ttu-id="97e0e-121">Stellen Sie sicher, dass Sie extern "C" in Ihren C++-Code einschließen, um zu verhindern, dass der Compiler ihren Funktionsnamen Dekorationen hinzufügt. Andernfalls kann das System die Funktionen nicht finden.</span><span class="sxs-lookup"><span data-stu-id="97e0e-121">Be sure to include extern "C" in your C++ code to prevent the compiler from adding decorations to your function names; otherwise, the system may fail to find your functions.</span></span>

> [!Note]
> <span data-ttu-id="97e0e-122">Wenn beim Laden der Leistungs-DLL, beim Suchen der Funktionen oder beim Aufrufen der Funktionen ein Fehler auftritt, wird der Anbieter für nachfolgende Auflistungen innerhalb desselben Prozesses vom System deaktiviert.</span><span class="sxs-lookup"><span data-stu-id="97e0e-122">If an error occurs while loading your performance DLL, finding your functions, or calling your functions, the system will disable the provider for subsequent collections within the same process.</span></span> <span data-ttu-id="97e0e-123">Wenn dieses Problem bei der Ausführung in einem privilegierten Prozess auftritt, fügt das System den Leistungsindikator " **Leistungsindikatoren deaktivieren** " dem **Leistungs** Schlüssel hinzu, um zu verhindern, dass der Anbieter in Zukunft geladen wird.</span><span class="sxs-lookup"><span data-stu-id="97e0e-123">In addition, if this occurs while running in a privileged process, the system adds a **Disable Performance Counters** value to your **Performance** key to prevent the provider from being loaded in the future.</span></span>

<span data-ttu-id="97e0e-124">Weitere Informationen zum Schreiben einer Leistungs-dll finden Sie in den folgenden Themen:</span><span class="sxs-lookup"><span data-stu-id="97e0e-124">For more information on writing a performance DLL, see the following topics:</span></span>

- [<span data-ttu-id="97e0e-125">Implementieren der openperformancedata-Funktion</span><span class="sxs-lookup"><span data-stu-id="97e0e-125">Implementing the OpenPerformanceData function</span></span>](implementing-openperformancedata.md)
- [<span data-ttu-id="97e0e-126">Implementieren der collectperformancedata-Funktion</span><span class="sxs-lookup"><span data-stu-id="97e0e-126">Implementing the CollectPerformanceData function</span></span>](implementing-collectperformancedata.md)
- [<span data-ttu-id="97e0e-127">Fehlerbehandlung in der dll</span><span class="sxs-lookup"><span data-stu-id="97e0e-127">Error Handling in the DLL</span></span>](error-handling-in-the-dll.md)
- [<span data-ttu-id="97e0e-128">Einschränken des Zugriffs auf Leistungs Erweiterungs-DLLs</span><span class="sxs-lookup"><span data-stu-id="97e0e-128">Restricting Access to Performance Extension DLLs</span></span>](restricting-access-to-performance-extension--dlls.md)
- [<span data-ttu-id="97e0e-129">Leistungs-DLL-Beispiele</span><span class="sxs-lookup"><span data-stu-id="97e0e-129">Performance DLL Samples</span></span>](performance-dll-samples.md)
