---
description: Nachdem Sie eine Abfrage erstellt und Leistungsindikatoren hinzugefügt haben, rufen Sie die pdhcollectquerydata-Funktion auf, um die aktuellen Rohdaten für alle Zähler in der Abfrage abzurufen.
ms.assetid: 2534d387-a280-4716-9a9d-3e42f40e2f92
title: Sammeln von Leistungsdaten
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e99bd2c0e22553245e87d3844694051c88c57895
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "104345519"
---
# <a name="collecting-performance-data"></a><span data-ttu-id="44be1-103">Sammeln von Leistungsdaten</span><span class="sxs-lookup"><span data-stu-id="44be1-103">Collecting Performance Data</span></span>

<span data-ttu-id="44be1-104">Nachdem Sie [eine Abfrage erstellt](creating-a-query.md) und Leistungsindikatoren hinzugefügt haben, rufen Sie die [**pdhcollectquerydata**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata) -Funktion auf, um die aktuellen Rohdaten für alle Zähler in der Abfrage abzurufen.</span><span class="sxs-lookup"><span data-stu-id="44be1-104">After [creating a query](creating-a-query.md) and adding counters to it, call the [**PdhCollectQueryData**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata) function to retrieve the current raw data for all counters in the query.</span></span>

<span data-ttu-id="44be1-105">Viele Leistungsindikatoren, wie z. b. Raten Indikatoren, erfordern zwei Daten Beispiele, um einen formatierten Datenwert zu berechnen.</span><span class="sxs-lookup"><span data-stu-id="44be1-105">Many counters, such as rate counters, require two data samples to calculate a formatted data value.</span></span> <span data-ttu-id="44be1-106">PDH verwaltet Daten für das aktuelle Beispiel und das zuvor gesammelte Beispiel.</span><span class="sxs-lookup"><span data-stu-id="44be1-106">PDH maintains data for the current sample and the previously collected sample.</span></span> <span data-ttu-id="44be1-107">Im folgenden Verfahren wird beschrieben, wie Leistungswerte erfasst werden, die zwei Beispiele zum Berechnen eines anzeigbaren Werts erfordern.</span><span class="sxs-lookup"><span data-stu-id="44be1-107">The following procedure describes how to collect counter values that require two samples to calculate a displayable value.</span></span>

<span data-ttu-id="44be1-108">**So erfassen Sie Leistungswerte, die zwei Beispiele zum Berechnen eines anzeigbaren Werts erfordern**</span><span class="sxs-lookup"><span data-stu-id="44be1-108">**To collect counter values that require two samples to calculate a displayable value**</span></span>

1.  <span data-ttu-id="44be1-109">Nennen Sie [**pdhcollectquerydata**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata) , um das erste Beispiel zu erfassen.</span><span class="sxs-lookup"><span data-stu-id="44be1-109">Call [**PdhCollectQueryData**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata) to collect the first sample.</span></span>
2.  <span data-ttu-id="44be1-110">Ruft die [**Standbyfunktion auf**](/windows/desktop/api/synchapi/nf-synchapi-sleep) , um mindestens eine Sekunde zwischen den Auflistungen zu warten.</span><span class="sxs-lookup"><span data-stu-id="44be1-110">Call the [**Sleep**](/windows/desktop/api/synchapi/nf-synchapi-sleep) function to wait a minimum of one second between collections.</span></span>
3.  <span data-ttu-id="44be1-111">Nennen Sie [**pdhcollectquerydata**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata) erneut, um das zweite Beispiel zu erfassen.</span><span class="sxs-lookup"><span data-stu-id="44be1-111">Call [**PdhCollectQueryData**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata) again to collect the second sample.</span></span>
4.  <span data-ttu-id="44be1-112">Rufen Sie die [**pdhgetformattedcountervalue**](/windows/desktop/api/Pdh/nf-pdh-pdhgetformattedcountervalue) -Funktion auf, um einen anzeigbaren Wert zu berechnen.</span><span class="sxs-lookup"><span data-stu-id="44be1-112">Call the [**PdhGetFormattedCounterValue**](/windows/desktop/api/Pdh/nf-pdh-pdhgetformattedcountervalue) function to calculate a displayable value.</span></span>
5.  <span data-ttu-id="44be1-113">Wiederholen Sie die Schritte 2 bis 4.</span><span class="sxs-lookup"><span data-stu-id="44be1-113">Repeat steps 2 through 4.</span></span>

<span data-ttu-id="44be1-114">Als Alternative zur Implementierung einer Wartezeit selbst können Sie die [**pdhcollectquerydataex**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydataex) -Funktion aufrufen, die einen Zeit Steuerungs Thread erstellt, der einen bestimmten Zeitraum wartet, das Beispiel sammelt und dann ein Anwendungs definiertes Ereignis auslöst.</span><span class="sxs-lookup"><span data-stu-id="44be1-114">As an alternative to implementing a wait period yourself, you can call the [**PdhCollectQueryDataEx**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydataex) function, which creates a timing thread that waits a specified amount of time, collects the sample, and then triggers an application-defined event.</span></span>

<span data-ttu-id="44be1-115">Wenn Sie Leistungsdaten aus einer Protokolldatei Abfragen möchten, können Sie auch einen Zeitbereich definieren.</span><span class="sxs-lookup"><span data-stu-id="44be1-115">If you want to query performance data from a log file, you can also define a time range.</span></span> <span data-ttu-id="44be1-116">Der Zeitbereich schränkt die Abfrage auf die Stichproben ein, die im Zeitbereich erfasst wurden (jedes Beispiel enthält einen Zeitstempel für den Zeitpunkt der Erfassung).</span><span class="sxs-lookup"><span data-stu-id="44be1-116">The time range limits the query to those samples that were collected within the time range (each sample contains a time stamp for when it was collected).</span></span> <span data-ttu-id="44be1-117">Weitere Informationen zum Festlegen und Abrufen von Zeit Bereichen finden Sie unter [Festlegen eines Zeit Bereichs für eine Abfrage](setting-a-time-range-for-a-query.md).</span><span class="sxs-lookup"><span data-stu-id="44be1-117">For more information on how to set and retrieve time ranges, see [Setting a Time Range for a Query](setting-a-time-range-for-a-query.md).</span></span>

<span data-ttu-id="44be1-118">Wenn Sie Leistungsdaten erfassen und in eine Protokolldatei schreiben möchten, rufen Sie die [**pdhupdatelog**](/windows/desktop/api/Pdh/nf-pdh-pdhupdateloga) -Funktion auf, anstatt [**pdhcollectquerydata**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata)aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="44be1-118">If you want to collect performance data and write it to a log file, you would call the [**PdhUpdateLog**](/windows/desktop/api/Pdh/nf-pdh-pdhupdateloga) function instead of calling [**PdhCollectQueryData**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata).</span></span> <span data-ttu-id="44be1-119">Weitere Informationen finden Sie unter [Arbeiten mit Protokolldateien](working-with-log-files.md) und [Schreiben von Leistungsdaten in eine Protokolldatei](writing-performance-data-to-a-log-file.md).</span><span class="sxs-lookup"><span data-stu-id="44be1-119">For details, see [Working with Log Files](working-with-log-files.md) and [Writing Performance Data to a Log File](writing-performance-data-to-a-log-file.md).</span></span>

<span data-ttu-id="44be1-120">Ausführliche Informationen zum Berechnen eines anzeigbaren Beispiel Werts finden Sie unter [Anzeigen von Leistungsdaten](displaying-performance-data.md).</span><span class="sxs-lookup"><span data-stu-id="44be1-120">For details on calculating a displayable sample value, see [Displaying Performance Data](displaying-performance-data.md).</span></span>

## <a name="understanding-multiple-processor-counters"></a><span data-ttu-id="44be1-121">Grundlegendes zu mehreren Prozessor Zählern</span><span class="sxs-lookup"><span data-stu-id="44be1-121">Understanding Multiple Processor Counters</span></span>

<span data-ttu-id="44be1-122">Einige Leistungsindikatoren wurden für einzelne Prozessorsysteme entwickelt und sind möglicherweise für Multiprozessorcomputer nicht exakt.</span><span class="sxs-lookup"><span data-stu-id="44be1-122">Some performance counters were designed for single processor systems and might not be accurate for multiprocessor computers.</span></span> <span data-ttu-id="44be1-123">Ein Prozess ist beispielsweise auf 100 Prozent eines einzelnen Prozessors beschränkt. Allerdings können die Threads mehrere Prozessoren verwenden, die insgesamt mehr als 100 Prozent betragen.</span><span class="sxs-lookup"><span data-stu-id="44be1-123">For example, a process is limited to 100 percent of a single processor; however, its threads can use several processors, totaling more than 100 percent.</span></span>

<span data-ttu-id="44be1-124">Der \\ Leistungswert "Prozessor ( \_ gesamt) \\ % Prozessorzeit" ist die durchschnittliche Auslastung aller Prozessoren.</span><span class="sxs-lookup"><span data-stu-id="44be1-124">The "\\Processor(\_Total)\\% Processor Time" counter value is the average usage of all processors.</span></span> <span data-ttu-id="44be1-125">Wenn Sie z. b. über zwei Prozessoren verfügen, eine mit 100 Prozent und eine andere mit 0 Prozent, meldet dieser Wert 50 Prozent.</span><span class="sxs-lookup"><span data-stu-id="44be1-125">For example, if you have two processors, one at 100 percent and another at 0 percent, this counter will report 50 percent.</span></span> <span data-ttu-id="44be1-126">Der Bereich liegt also zwischen 0 und 100.</span><span class="sxs-lookup"><span data-stu-id="44be1-126">So the range is from 0 through 100.</span></span>

<span data-ttu-id="44be1-127">Der \\ Wert "Process (X) \\ % Prozesszeit" ist die Summe der Prozessorauslastung durch alle Threads von Prozess X. Wenn ein Prozess z. b. auf einem Computer mit zwei Prozessoren über zwei Threads verfügt, wobei eine CPU 75 Prozent der CPU und die andere 80 Prozent einer anderen CPU beansprucht, meldet dieser Wert 155 Prozent.</span><span class="sxs-lookup"><span data-stu-id="44be1-127">The "\\Process(X)\\% Process Time" counter value is the sum of the processor usage by all threads of process X. For example, in a computer with two processors, if a process has two threads, one taking up 75 percent of a CPU and the other taking 80 percent of another CPU, this counter will report 155 percent.</span></span> <span data-ttu-id="44be1-128">Der Bereich für diesen Zähler liegt zwischen 0 und 100 \* ProcessorCount.</span><span class="sxs-lookup"><span data-stu-id="44be1-128">The range for this counter is from 0 through 100 \* ProcessorCount.</span></span>

<span data-ttu-id="44be1-129">\* \* Windows Server 2003 und Windows XP: \* \*</span><span class="sxs-lookup"><span data-stu-id="44be1-129">\*\*Windows Server 2003 and Windows XP:  \*\*</span></span>

<span data-ttu-id="44be1-130">Sie können Werte außerhalb des erwarteten Wertebereichs für die CPU-Auslastung erhalten.</span><span class="sxs-lookup"><span data-stu-id="44be1-130">You can receive values outside the expected range of values for CPU usage.</span></span> <span data-ttu-id="44be1-131">Um den Prozentsatz der CPU-Auslastung zu berechnen, benötigt PDH zwei Stichproben (jeweils mit einem Rohwert und einem Zeitstempel).</span><span class="sxs-lookup"><span data-stu-id="44be1-131">To calculate the percentage of CPU usage, PDH needs two samples (each with a raw value and a time stamp).</span></span> <span data-ttu-id="44be1-132">Da PDH nur den Instanznamen verwendet, um die Prozesse abzugleichen, kann manchmal zwei Beispiele aus unterschiedlichen Prozessen verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="44be1-132">Because PDH uses only the instance name to match the processes, it can sometimes use two samples from different processes.</span></span> <span data-ttu-id="44be1-133">Wenn z. b. drei Prozesse erfasst werden und ein Prozess nach dem dritten Beispiel beendet wird, wird ein anderer Prozess in den von diesem beendeten Prozess frei werdenden Slot verschoben.</span><span class="sxs-lookup"><span data-stu-id="44be1-133">For example, if three processes are being sampled and one process is terminated after the third sample, another process will move to the slot vacated by that terminated process.</span></span> <span data-ttu-id="44be1-134">Folglich gibt ein formatierter Leistungs Bewert einen falschen Wert an, wenn Sie das vierte Beispiel formatieren, da er das dritte Beispiel aus dem beendeten Prozess und das vierte Beispiel aus dem Prozess verwendet, der in den Slot des beendeten Prozesses verschoben wurde.</span><span class="sxs-lookup"><span data-stu-id="44be1-134">As a result, a formatted counter will provide an incorrect value when you format the fourth sample, because it’s using the third sample from the terminated process and the fourth sample from the process that moved into the terminated process's slot.</span></span>

<span data-ttu-id="44be1-135">In der folgenden Tabelle wird gezeigt, wie dies auftreten kann, wenn ein Prozess beendet wird, während Daten gesammelt werden.</span><span class="sxs-lookup"><span data-stu-id="44be1-135">The following table shows how this can occur if a process is terminated while data is being collected.</span></span> <span data-ttu-id="44be1-136">In der Tabelle werden fünf Beispiele für Leistungs Proben für drei Instanzen von Prozess X angezeigt. Die Beispiele werden in Intervallen von einer Sekunde gesammelt.</span><span class="sxs-lookup"><span data-stu-id="44be1-136">The table shows five counter value samples for three instances of process X. The samples are collected in one second intervals.</span></span> <span data-ttu-id="44be1-137">Nachdem das dritte Beispiel erfasst wurde, wird Process X in Slot 1 beendet.</span><span class="sxs-lookup"><span data-stu-id="44be1-137">After the third sample is collected, process X in slot 1 is terminated.</span></span> <span data-ttu-id="44be1-138">Wenn Process x in Slot 1 beendet wird, wechselt Process x in Slot 2 in Slot 1.</span><span class="sxs-lookup"><span data-stu-id="44be1-138">When process X in slot 1 is terminated, process X in slot 2 moves to slot 1.</span></span> <span data-ttu-id="44be1-139">Wenn Sie das vierte Beispiel für Process X in Slot 2 erfassen, ist der erste Wert jetzt 20 anstelle von 1.000, und der zweite Wert ist 1.500.</span><span class="sxs-lookup"><span data-stu-id="44be1-139">When you collect the fourth sample for process X in slot 2, the first value is now 20 instead of 1,000, and the second value is 1,500.</span></span> <span data-ttu-id="44be1-140">Wenn Sie den Wert des Zählers formatieren, erhalten Sie 1.480 Millisekunden anstelle der erwarteten 500 Millisekunden.</span><span class="sxs-lookup"><span data-stu-id="44be1-140">When you format the counter value, you get 1,480 milliseconds instead of the expected 500 milliseconds.</span></span> <span data-ttu-id="44be1-141">Wenn Sie den fünften Beispiel Wert formatieren, sollten Sie den erwarteten Wert erhalten.</span><span class="sxs-lookup"><span data-stu-id="44be1-141">When you format the fifth sample value, you should get the expected value.</span></span>

| <span data-ttu-id="44be1-142">Beispiel</span><span class="sxs-lookup"><span data-stu-id="44be1-142">Sample</span></span>   | <span data-ttu-id="44be1-143">Slot 0 für Prozess X</span><span class="sxs-lookup"><span data-stu-id="44be1-143">Slot 0 for process X</span></span> | <span data-ttu-id="44be1-144">Slot 1 für Prozess X</span><span class="sxs-lookup"><span data-stu-id="44be1-144">Slot 1 for process X</span></span>           | <span data-ttu-id="44be1-145">Slot 2 für Prozess X</span><span class="sxs-lookup"><span data-stu-id="44be1-145">Slot 2 for process X</span></span>                     |
|----------|----------------------|--------------------------------|------------------------------------------|
| <span data-ttu-id="44be1-146">Beispiel 1</span><span class="sxs-lookup"><span data-stu-id="44be1-146">Sample 1</span></span> | <span data-ttu-id="44be1-147">0</span><span class="sxs-lookup"><span data-stu-id="44be1-147">0</span></span>                    | <span data-ttu-id="44be1-148">0</span><span class="sxs-lookup"><span data-stu-id="44be1-148">0</span></span>                              | <span data-ttu-id="44be1-149">0</span><span class="sxs-lookup"><span data-stu-id="44be1-149">0</span></span>                                        |
| <span data-ttu-id="44be1-150">Beispiel 2</span><span class="sxs-lookup"><span data-stu-id="44be1-150">Sample 2</span></span> | <span data-ttu-id="44be1-151">20</span><span class="sxs-lookup"><span data-stu-id="44be1-151">20</span></span>                   | <span data-ttu-id="44be1-152">10</span><span class="sxs-lookup"><span data-stu-id="44be1-152">10</span></span>                             | <span data-ttu-id="44be1-153">500</span><span class="sxs-lookup"><span data-stu-id="44be1-153">500</span></span>                                      |
| <span data-ttu-id="44be1-154">Beispiel 3</span><span class="sxs-lookup"><span data-stu-id="44be1-154">Sample 3</span></span> | <span data-ttu-id="44be1-155">40</span><span class="sxs-lookup"><span data-stu-id="44be1-155">40</span></span>                   | <span data-ttu-id="44be1-156">20</span><span class="sxs-lookup"><span data-stu-id="44be1-156">20</span></span>                             | <span data-ttu-id="44be1-157">1\.000</span><span class="sxs-lookup"><span data-stu-id="44be1-157">1,000</span></span>                                    |
| <span data-ttu-id="44be1-158">Beispiel 4</span><span class="sxs-lookup"><span data-stu-id="44be1-158">Sample 4</span></span> | <span data-ttu-id="44be1-159">60</span><span class="sxs-lookup"><span data-stu-id="44be1-159">60</span></span>                   | <span data-ttu-id="44be1-160">1.500 (aus dem ersten Slot 2)</span><span class="sxs-lookup"><span data-stu-id="44be1-160">1,500 (from the former slot 2)</span></span> | <span data-ttu-id="44be1-161">Nicht zutreffend</span><span class="sxs-lookup"><span data-stu-id="44be1-161">Not applicable.</span></span> <span data-ttu-id="44be1-162">Nun in Slot 1 erfasst.</span><span class="sxs-lookup"><span data-stu-id="44be1-162">Now collected in slot 1.</span></span> |
| <span data-ttu-id="44be1-163">Beispiel 5</span><span class="sxs-lookup"><span data-stu-id="44be1-163">Sample 5</span></span> | <span data-ttu-id="44be1-164">80</span><span class="sxs-lookup"><span data-stu-id="44be1-164">80</span></span>                   | <span data-ttu-id="44be1-165">2\.000</span><span class="sxs-lookup"><span data-stu-id="44be1-165">2,000</span></span>                          | <span data-ttu-id="44be1-166">Nicht zutreffend</span><span class="sxs-lookup"><span data-stu-id="44be1-166">Not applicable.</span></span> <span data-ttu-id="44be1-167">Nun in Slot 1 erfasst.</span><span class="sxs-lookup"><span data-stu-id="44be1-167">Now collected in slot 1.</span></span> |



 

 

 
