---
description: Sie können die Registrierungsfunktionen verwenden, um Leistungsdaten zu erfassen.
ms.assetid: feac7b8d-1dee-462c-89dc-bec1ba045da2
title: Verwenden der Registrierungsfunktionen zum Verarbeiten von Counter-Daten
ms.topic: article
ms.date: 08/17/2020
ms.openlocfilehash: ce2a4ba9992510cb296b037cfd98965410c48939
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "106350227"
---
# <a name="using-the-registry-functions-to-consume-counter-data"></a><span data-ttu-id="f14d9-103">Verwenden der Registrierungsfunktionen zum Verarbeiten von Counter-Daten</span><span class="sxs-lookup"><span data-stu-id="f14d9-103">Using the Registry Functions to Consume Counter Data</span></span>

<span data-ttu-id="f14d9-104">Verwenden Sie die [Registrierungsfunktionen](/windows/desktop/SysInfo/registry-functions) , um Leistungsdaten aus dem speziellen `HKEY_PERFORMANCE_DATA` Registrierungsschlüssel zu erfassen.</span><span class="sxs-lookup"><span data-stu-id="f14d9-104">Use the [registry functions](/windows/desktop/SysInfo/registry-functions) to collect performance data from the special `HKEY_PERFORMANCE_DATA` registry key.</span></span>

<span data-ttu-id="f14d9-105">Leistungsdaten werden nicht tatsächlich in der Registrierung gespeichert.</span><span class="sxs-lookup"><span data-stu-id="f14d9-105">Performance data is not actually stored in the registry.</span></span> <span data-ttu-id="f14d9-106">Das Aufrufen der Registrierungsfunktionen bewirkt, dass das System die Daten vom entsprechenden Leistungsdaten Anbieter sammelt.</span><span class="sxs-lookup"><span data-stu-id="f14d9-106">Calling the registry functions causes the system to collect the data from the appropriate performance data provider.</span></span>

> [!Note]
> <span data-ttu-id="f14d9-107">Normalerweise sollten Sie die Registrierungsfunktionen nicht verwenden, um die Daten zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="f14d9-107">You should not normally use the registry functions to consume counter data.</span></span> <span data-ttu-id="f14d9-108">Stattdessen sollten Sie [die Funktionen für das Leistungsdaten-Hilfsprogramm (PDH) verwenden](using-the-pdh-functions-to-consume-counter-data.md).</span><span class="sxs-lookup"><span data-stu-id="f14d9-108">Instead, you should [use the Performance Data Helper (PDH) functions](using-the-pdh-functions-to-consume-counter-data.md).</span></span> <span data-ttu-id="f14d9-109">Die PDH-Funktionen sind einfacher zu verwenden und vermeiden viele Leistungs-und Zuverlässigkeitsprobleme, die durch eine falsche Verwendung der Registrierungsfunktionen auftreten können.</span><span class="sxs-lookup"><span data-stu-id="f14d9-109">The PDH functions are easier to use and avoid many performance and reliability problems that can occur through incorrect use of the registry functions.</span></span>

> [!Note]
> <span data-ttu-id="f14d9-110">Sie können die Registrierungsfunktionen nicht verwenden, wenn Sie Windows onecore-apps schreiben.</span><span class="sxs-lookup"><span data-stu-id="f14d9-110">You cannot use the registry functions if you are writing Windows OneCore apps.</span></span> <span data-ttu-id="f14d9-111">Verwenden Sie stattdessen [Perflib v2-consumerfunktionen](using-the-perflib-functions-to-consume-counter-data.md).</span><span class="sxs-lookup"><span data-stu-id="f14d9-111">Instead, use [PerfLib V2 Consumer functions](using-the-perflib-functions-to-consume-counter-data.md).</span></span>

<span data-ttu-id="f14d9-112">Bei den Registrierungsfunktionen handelt es sich um die Low-Level-API zum Sammeln von Daten von **v1-Anbietern**.</span><span class="sxs-lookup"><span data-stu-id="f14d9-112">The registry functions are the low-level API for collecting data from **V1 providers**.</span></span> <span data-ttu-id="f14d9-113">Die Registrierungsfunktionen unterstützen auch das Sammeln von Daten von **v2-Anbietern** über eine übersetzungsebene, die die [v2-consumerfunktionen](using-the-perflib-functions-to-consume-counter-data.md)aufruft.</span><span class="sxs-lookup"><span data-stu-id="f14d9-113">The registry functions also support collecting data from **V2 providers** via a translation layer that calls into the [V2 Consumer functions](using-the-perflib-functions-to-consume-counter-data.md).</span></span>

<span data-ttu-id="f14d9-114">Um Leistungsdaten vom lokalen System abzurufen, rufen Sie die [**RegQueryValueEx**](/windows/win32/api/winreg/nf-winreg-regqueryvalueexw) -Funktion auf.</span><span class="sxs-lookup"><span data-stu-id="f14d9-114">To obtain performance data from the local system, call the [**RegQueryValueEx**](/windows/win32/api/winreg/nf-winreg-regqueryvalueexw) function.</span></span> <span data-ttu-id="f14d9-115">Verwenden Sie `HKEY_PERFORMANCE_DATA` als Schlüssel.</span><span class="sxs-lookup"><span data-stu-id="f14d9-115">Use `HKEY_PERFORMANCE_DATA` as the key.</span></span> <span data-ttu-id="f14d9-116">Der erste-Befehl öffnet den Schlüssel.</span><span class="sxs-lookup"><span data-stu-id="f14d9-116">The first call opens the key.</span></span> <span data-ttu-id="f14d9-117">Der Schlüssel muss nicht explizit explizit geöffnet werden.</span><span class="sxs-lookup"><span data-stu-id="f14d9-117">You do not need to explicitly open the key first.</span></span>

<span data-ttu-id="f14d9-118">Um Leistungsdaten von einem Remote System zu erhalten, rufen Sie die [**regconnectregistry**](/windows/desktop/api/winreg/nf-winreg-regconnectregistryw) -Funktion auf.</span><span class="sxs-lookup"><span data-stu-id="f14d9-118">To obtain performance data from a remote system, call the [**RegConnectRegistry**](/windows/desktop/api/winreg/nf-winreg-regconnectregistryw) function.</span></span> <span data-ttu-id="f14d9-119">Verwenden Sie den Computernamen des Remote Systems, und verwenden Sie `HKEY_PERFORMANCE_DATA` als Schlüssel.</span><span class="sxs-lookup"><span data-stu-id="f14d9-119">Use the computer name of the remote system and use `HKEY_PERFORMANCE_DATA` as the key.</span></span> <span data-ttu-id="f14d9-120">Dieser Befehl ruft einen Schlüssel ab, der die Leistungsdaten für das Remote System darstellt.</span><span class="sxs-lookup"><span data-stu-id="f14d9-120">This call retrieves a key representing the performance data for the remote system.</span></span> <span data-ttu-id="f14d9-121">Verwenden Sie diesen Schlüssel anstelle `HKEY_PERFORMANCE_DATA` von Key, um die Daten abzurufen.</span><span class="sxs-lookup"><span data-stu-id="f14d9-121">Use this key rather than `HKEY_PERFORMANCE_DATA` key to retrieve the data.</span></span>

<span data-ttu-id="f14d9-122">Stellen Sie sicher, dass Sie die [**RegCloseKey**](/windows/desktop/api/winreg/nf-winreg-regclosekey) -Funktion verwenden, um das Handle für den Schlüssel zu schließen, wenn Sie mit dem Abrufen der Leistungsdaten fertig sind.</span><span class="sxs-lookup"><span data-stu-id="f14d9-122">Be sure to use the [**RegCloseKey**](/windows/desktop/api/winreg/nf-winreg-regclosekey) function to close the handle to the key when you are finished obtaining the performance data.</span></span> <span data-ttu-id="f14d9-123">Dies ist sowohl für lokale als auch für Remote Fälle wichtig:</span><span class="sxs-lookup"><span data-stu-id="f14d9-123">This is important for both the local and remote cases:</span></span>

- <span data-ttu-id="f14d9-124">`RegCloseKey(HKEY_PERFORMANCE_DATA)` schließt ein Registrierungs Handle nicht, sondern löscht alle zwischengespeicherten Daten und gibt die geladenen Leistungs-DLLs frei.</span><span class="sxs-lookup"><span data-stu-id="f14d9-124">`RegCloseKey(HKEY_PERFORMANCE_DATA)` does not actually close a registry handle, but it clears all cached data and frees the loaded performance DLLs.</span></span>
- <span data-ttu-id="f14d9-125">`RegCloseKey(hkeyRemotePerformanceData)` schließt das Handle für die Registrierung des Remote Computers.</span><span class="sxs-lookup"><span data-stu-id="f14d9-125">`RegCloseKey(hkeyRemotePerformanceData)` closes the handle to the remote machine's registry.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="f14d9-126">Während nicht aufzurufen `RegCloseKey(HKEY_PERFORMANCE_DATA)` `DLL_PROCESS_DETACH` .</span><span class="sxs-lookup"><span data-stu-id="f14d9-126">Do not call `RegCloseKey(HKEY_PERFORMANCE_DATA)` during `DLL_PROCESS_DETACH`.</span></span>

<span data-ttu-id="f14d9-127">Sie verwenden den- `lpValueName` Parameter der [**RegQueryValueEx**](/windows/desktop/api/winreg/nf-winreg-regqueryvalueexa) -Funktion, um die abzurufenden Informationen anzugeben.</span><span class="sxs-lookup"><span data-stu-id="f14d9-127">You use the `lpValueName` parameter of the [**RegQueryValueEx**](/windows/desktop/api/winreg/nf-winreg-regqueryvalueexa) function to indicate the information to retrieve.</span></span> <span data-ttu-id="f14d9-128">In der folgenden Tabelle sind die Werte aufgelistet, die Sie für angeben können `lpValueName` .</span><span class="sxs-lookup"><span data-stu-id="f14d9-128">The following table lists the values you can specify for `lpValueName`.</span></span> <span data-ttu-id="f14d9-129">Beachten Sie, dass bei den Wert Zeichenfolgen die Groß-/Kleinschreibung</span><span class="sxs-lookup"><span data-stu-id="f14d9-129">Note that the value strings are not case-sensitive.</span></span>

|<span data-ttu-id="f14d9-130">Wert</span><span class="sxs-lookup"><span data-stu-id="f14d9-130">Value</span></span>|<span data-ttu-id="f14d9-131">BESCHREIBUNG</span><span class="sxs-lookup"><span data-stu-id="f14d9-131">Description</span></span>
|-----|-----------
|`Global`| <span data-ttu-id="f14d9-132">Ruft Leistungsdaten für alle auf dem Computer registrierten Leistungs Objekte ab, mit Ausnahme derjenigen, die in der Kategorie enthalten sind `Costly` .</span><span class="sxs-lookup"><span data-stu-id="f14d9-132">Retrieves performance data for all performance objects registered on the computer except for those included in the `Costly` category.</span></span>
|`OLD_Global`| <span data-ttu-id="f14d9-133">**Windows Vista und höher:** Ruft Leistungsdaten für alle **v1** -Leistungs Objekte ab, die auf dem Computer registriert sind, mit Ausnahme derjenigen, die in der Kategorie enthalten sind `Costly` .</span><span class="sxs-lookup"><span data-stu-id="f14d9-133">**Windows Vista and later:** Retrieves performance data for all **V1** performance objects registered on the computer except for those included in the `Costly` category.</span></span> <span data-ttu-id="f14d9-134">Verwenden Sie diese anstelle von `Global` , um zu vermeiden, dass unnötige v2-Anbieter Daten gesammelt werden, wenn Sie wissen, dass die relevanten Daten von einem v1-Anbieter stammen.</span><span class="sxs-lookup"><span data-stu-id="f14d9-134">Use this instead of `Global` to avoid collecting unnecessary V2 provider data when you know that the data of interest comes from a V1 provider.</span></span>
|`n1 n2 ...`| <span data-ttu-id="f14d9-135">Ruft Leistungsdaten für ein oder mehrere Leistungs Objekte ab.</span><span class="sxs-lookup"><span data-stu-id="f14d9-135">Retrieves performance data for one or more performance objects.</span></span> <span data-ttu-id="f14d9-136">Geben Sie den Decimal-Index an, der den einzelnen Objekten zugeordnet ist, die in einer durch Leerzeichen getrennten Liste abgerufen werden sollen.</span><span class="sxs-lookup"><span data-stu-id="f14d9-136">Specify the decimal index associated with each object that you want to retrieve in a space-separated list.</span></span> <span data-ttu-id="f14d9-137">Wenn Sie z. b. System-und Arbeitsspeicher Objekte abrufen möchten und festgestellt haben, dass die Indizes der entsprechenden namens Zeichenfolgen 2 und 4 sind, geben Sie die Zeichenfolge an `"2 4"` .</span><span class="sxs-lookup"><span data-stu-id="f14d9-137">For example, if you want to retrieve System and Memory objects and you have determined that the indexes of the corresponding name strings are 2 and 4, specify the string `"2 4"`.</span></span> <span data-ttu-id="f14d9-138">Beachten Sie, dass die Abfrage eine andere Anzahl von Objekten zurückgeben kann, als Sie angefordert haben.</span><span class="sxs-lookup"><span data-stu-id="f14d9-138">Note that the query can return a different number of objects than you requested.</span></span> <span data-ttu-id="f14d9-139">Dies kann vorkommen, wenn das angegebene Objekt nicht verfügbar ist, wenn das angegebene Objekt von einem anderen Objekttyp abhängt oder wenn ein Anbieter andernfalls Daten zurückgibt, die nicht direkt angefordert wurden.</span><span class="sxs-lookup"><span data-stu-id="f14d9-139">This can happen if the specified object is unavailable, if the specified object depends on another object type, or if a provider otherwise returns data that was not directly requested.</span></span> <span data-ttu-id="f14d9-140">Threads sind z. b. von Prozessen abhängig. Wenn Sie also Daten aus dem- `Thread` Objekt anfordern, enthalten die Ergebnisse Daten aus dem- `Process` Objekt.</span><span class="sxs-lookup"><span data-stu-id="f14d9-140">For example, threads depend on processes, so if you request data from the `Thread` object, the results will include data from the `Process` object.</span></span>
|`Counter n`| <span data-ttu-id="f14d9-141">Ruft namens Zeichenfolgen für den angegebenen sprach Bezeichner (z. b. `Counter 9` Englisch für) ab.</span><span class="sxs-lookup"><span data-stu-id="f14d9-141">Retrieves name strings for the specified language identifier, e.g. English for `Counter 9`.</span></span> <span data-ttu-id="f14d9-142">Verwenden Sie die zurückgegebenen Namens Zeichenfolgen, um den Index zu suchen, der einem bestimmten Namen entspricht, oder um den Namen zu finden, der einem bestimmten Index entspricht</span><span class="sxs-lookup"><span data-stu-id="f14d9-142">Use the returned name strings to find the index corresponding to a given name or to find the name corresponding to a given index.</span></span> <span data-ttu-id="f14d9-143">Weitere Informationen finden Sie unter [Abrufen von Namen und Hilfe Texten](retrieving-counter-names-and-help-text.md) .</span><span class="sxs-lookup"><span data-stu-id="f14d9-143">See [Retrieving Counter Names and Help Text](retrieving-counter-names-and-help-text.md) for details.</span></span> <span data-ttu-id="f14d9-144">Beachten Sie, dass die zurückgegebene Liste sowohl Objektnamen (CounterSet) als auch Indikator Namen enthält. es gibt keine einfache Möglichkeit, zu bestimmen, ob ein Name ein Objektname oder ein Indikator Name ist.</span><span class="sxs-lookup"><span data-stu-id="f14d9-144">Note that the returned list includes both object (counterset) names and counter names -- there is no simple way to determine whether a name is an object name or a counter name.</span></span>
|`Help n`| <span data-ttu-id="f14d9-145">Ruft Hilfe Zeichenfolgen für den angegebenen sprach Bezeichner (z. b. `Help 9` Englisch für) ab.</span><span class="sxs-lookup"><span data-stu-id="f14d9-145">Retrieves help strings for the specified language identifier, e.g. English for `Help 9`.</span></span> <span data-ttu-id="f14d9-146">Verwenden Sie die zurückgegebenen Hilfe Zeichenfolgen, um Beschreibungen zu den Objekten (Counter Set) oder Indikator Hilfe Indizes zu suchen.</span><span class="sxs-lookup"><span data-stu-id="f14d9-146">Use the returned help strings to find descriptions corresponding to object (counterset) or counter help indexes.</span></span> <span data-ttu-id="f14d9-147">Weitere Informationen finden Sie unter [Abrufen von Namen und Hilfe Texten](retrieving-counter-names-and-help-text.md) .</span><span class="sxs-lookup"><span data-stu-id="f14d9-147">See [Retrieving Counter Names and Help Text](retrieving-counter-names-and-help-text.md) for details.</span></span>
|`Costly`| <span data-ttu-id="f14d9-148">**Veraltet:** Ruft Leistungsdaten für Objekttypen ab, deren Daten im Hinblick auf die Prozessorzeit oder die Speicherauslastung aufwendig erfasst werden.</span><span class="sxs-lookup"><span data-stu-id="f14d9-148">**Deprecated:** Retrieves performance data for object types whose data is expensive to collect in terms of processor time or memory usage.</span></span> <span data-ttu-id="f14d9-149">Diese Sammlung kann auf einem stark geladenen Computer einige Minuten dauern.</span><span class="sxs-lookup"><span data-stu-id="f14d9-149">This collection may take several minutes on a heavily-loaded machine.</span></span> <span data-ttu-id="f14d9-150">Sie sollten die Auflistung in einem Arbeits Thread ausführen, wenn Ihre Anwendung während der Datensammlung an den Benutzer Antworten muss.</span><span class="sxs-lookup"><span data-stu-id="f14d9-150">You should perform the collection on a worker thread if your application needs to respond to the user during this data collection.</span></span>

<span data-ttu-id="f14d9-151">Ausführliche Informationen zum Format der Leistungsdaten, die von der Registrierung zurückgegeben werden, finden Sie unter [Leistungsdaten Format](performance-data-format.md).</span><span class="sxs-lookup"><span data-stu-id="f14d9-151">For details on the format of the performance data that the registry returns, see [Performance Data Format](performance-data-format.md).</span></span>

<span data-ttu-id="f14d9-152">Ein Beispiel, das die Namen und Beschreibungen der registrierten Leistungsindikatoren auf dem Computer abruft, finden Sie unter Abrufen von Indikator [Namen und Hilfetext](retrieving-counter-names-and-help-text.md).</span><span class="sxs-lookup"><span data-stu-id="f14d9-152">For an example that gets the names and descriptions of the registered counters on the computer, see [Retrieving Counter Names and Help Text](retrieving-counter-names-and-help-text.md).</span></span>

<span data-ttu-id="f14d9-153">Ein Beispiel für den Zugriff auf die Komponenten der Leistungsdaten finden Sie unter [Anzeigen von Objekt-, Instanz-und Leistungs Zählers](displaying-object-instance-and-counter-names.md).</span><span class="sxs-lookup"><span data-stu-id="f14d9-153">For an example that accesses the components of the performance data, see [Displaying Object, Instance, and Counter Names](displaying-object-instance-and-counter-names.md).</span></span>

<span data-ttu-id="f14d9-154">Ein Beispiel für das Abrufen, berechnen und Ausgeben von Wert Werten finden Sie unter [Abrufen von Counter-Daten](retrieving-counter-data.md) und [Berechnen von Counter-Werten](calculating-counter-values.md).</span><span class="sxs-lookup"><span data-stu-id="f14d9-154">For an example that retrieves, computes, and prints counter values, see [Retrieving Counter Data](retrieving-counter-data.md) and [Calculating Counter Values](calculating-counter-values.md).</span></span>
