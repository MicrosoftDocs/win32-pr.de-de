---
title: Authentifizierung (Bits)
description: Bits unterstützt die Standard Authentifizierung, die Passport-Authentifizierung und mehrere Challenge/Response-Authentifizierungs Schemas.
ms.assetid: cfd4aec3-79d0-4971-93f8-df797e5c0f75
ms.topic: article
ms.date: 10/09/2018
ms.openlocfilehash: 5d970956676a3348dd4b8c4b420e044bd4714775
ms.sourcegitcommit: 8fa6614b715bddf14648cce36d2df22e5232801a
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 12/10/2020
ms.locfileid: "103949318"
---
# <a name="authentication-bits"></a><span data-ttu-id="74152-103">Authentifizierung (Bits)</span><span class="sxs-lookup"><span data-stu-id="74152-103">Authentication (BITS)</span></span>

<span data-ttu-id="74152-104">Bits unterstützt die Standard Authentifizierung, die Passport-Authentifizierung und mehrere Challenge/Response-Authentifizierungs Schemas.</span><span class="sxs-lookup"><span data-stu-id="74152-104">BITS supports Basic authentication, Passport authentication, and several challenge/response authentication schemes.</span></span> <span data-ttu-id="74152-105">Wenn für den Server oder Proxy eine Benutzerauthentifizierung erforderlich ist, verwenden Sie die Funktion [**IBackgroundCopyJob2:: setanmelde**](/windows/desktop/api/Bits1_5/nf-bits1_5-ibackgroundcopyjob2-setcredentials) Informationen, um die Anmelde Informationen des Benutzers anzugeben.</span><span class="sxs-lookup"><span data-stu-id="74152-105">If the server or proxy requires user authentication, use the [**IBackgroundCopyJob2::SetCredentials**](/windows/desktop/api/Bits1_5/nf-bits1_5-ibackgroundcopyjob2-setcredentials) function to specify the user's credentials.</span></span> <span data-ttu-id="74152-106">Bits verwendet die [CryptoAPI](/windows/desktop/SecCrypto/cryptography-portal) , um die Anmelde Informationen zu schützen.</span><span class="sxs-lookup"><span data-stu-id="74152-106">BITS uses the [CryptoAPI](/windows/desktop/SecCrypto/cryptography-portal) to protect the credentials.</span></span>

<span data-ttu-id="74152-107">Zum Festlegen von Anmelde Informationen für die Standard Authentifizierung verwenden Sie die Funktion " [**setanmelde**](/windows/desktop/api/Bits1_5/nf-bits1_5-ibackgroundcopyjob2-setcredentials) ", um den Benutzernamen und das Kennwort anzugeben</span><span class="sxs-lookup"><span data-stu-id="74152-107">To set credentials for Basic authentication use the [**SetCredentials**](/windows/desktop/api/Bits1_5/nf-bits1_5-ibackgroundcopyjob2-setcredentials) function to specify the user name and password.</span></span> <span data-ttu-id="74152-108">Sie sollten die Standard Authentifizierung nur mit geschützten sicheren Websites von https://verwenden. Andernfalls sind der Benutzername und das Kennwort für Benutzer sichtbar.</span><span class="sxs-lookup"><span data-stu-id="74152-108">You should only use Basic authentication with https:// protected secure websites; otherwise the username and password will be visible to users.</span></span> 

<span data-ttu-id="74152-109">Es ist möglich, den Benutzernamen und das Kennwort in die URL einzubetten.</span><span class="sxs-lookup"><span data-stu-id="74152-109">It's possible to embed the user name and password in the URL.</span></span> <span data-ttu-id="74152-110">Dies gilt nicht als bewährte Sicherheitsmaßnahme und wird in RFC 3986 (Abschnitt 3.2.1) als veraltet eingestuft.</span><span class="sxs-lookup"><span data-stu-id="74152-110">This is not considered a good security practice, and is deprecated in RFC 3986 (section 3.2.1).</span></span>

<span data-ttu-id="74152-111">Bei der [Passport](/windows/desktop/WinHttp/passport-authentication-in-winhttp) -Authentifizierung unterstützt Bits nur explizite Anmelde Informationen, keine impliziten Anmelde Informationen, die mit dem Konto verknüpft sind.</span><span class="sxs-lookup"><span data-stu-id="74152-111">For [Passport](/windows/desktop/WinHttp/passport-authentication-in-winhttp) authentication, BITS supports explicit credentials only, not implicit credentials tied to the account.</span></span>

<span data-ttu-id="74152-112">Bei der Challenge/Response-Authentifizierung nimmt Bits die Identität des Benutzers an und verwendet " [snego](../com/snego.md) ", um zu bestimmen, welche Challenge/Response-Authentifizierung verwendet werden soll, z. b. NTLM oder das Kerberos</span><span class="sxs-lookup"><span data-stu-id="74152-112">For challenge/response authentication, BITS impersonates the user and uses [Snego](../com/snego.md) to determine which challenge/response authentication to use, such as NTLM or the Kerberos protocol.</span></span> <span data-ttu-id="74152-113">Eine Liste der von Bits unterstützten Challenge/Response-Schemas finden Sie unter [**BG \_ auth \_ Scheme**](/windows/desktop/api/Bits1_5/ne-bits1_5-bg_auth_scheme).</span><span class="sxs-lookup"><span data-stu-id="74152-113">For a list of challenge/response schemes that BITS supports, see [**BG\_AUTH\_SCHEME**](/windows/desktop/api/Bits1_5/ne-bits1_5-bg_auth_scheme).</span></span>

<span data-ttu-id="74152-114">BITS-Aufträge können fehlschlagen, wenn das virtuelle Verzeichnis auf dem Server die anonyme Authentifizierung und ein anderes Authentifizierungsschema aktiviert ist und wenn ACLs das virtuelle Verzeichnis schützen oder Dateien herunterladen.</span><span class="sxs-lookup"><span data-stu-id="74152-114">BITS jobs can fail if the virtual directory on the server has anonymous authentication and another authentication scheme enabled and if ACLs protect the virtual directory or download files.</span></span> <span data-ttu-id="74152-115">Ein Auftrag schlägt z. b. mit "Zugriff verweigert" fehl, wenn die anonyme und integrierte Authentifizierung für das virtuelle Verzeichnis aktiviert ist und die Datei eine ACL enthält, mit der nur Ben die Datei lesen kann.</span><span class="sxs-lookup"><span data-stu-id="74152-115">For example, a job fails with "access denied" if the virtual directory has anonymous and integrated authentication enabled and the file contains an ACL that allows only Ben to read the file.</span></span> <span data-ttu-id="74152-116">Dies liegt daran, dass das virtuelle Verzeichnis den anonymen Zugriff zulässt, sodass IIS nicht explizit von Ben authentifiziert wird (die Anmelde Informationen von Ben werden nicht für den Zugriff auf die Datei verwendet, und der Zugriff wird verweigert).</span><span class="sxs-lookup"><span data-stu-id="74152-116">This occurs because the virtual directory allows anonymous access, so IIS does not explicitly authenticate Ben (Ben's credentials are not used to access the file and access is denied).</span></span>

## <a name="using-implicit-credentials"></a><span data-ttu-id="74152-117">Verwenden von impliziten Anmelde Informationen</span><span class="sxs-lookup"><span data-stu-id="74152-117">Using implicit credentials</span></span>

<span data-ttu-id="74152-118">Um die impliziten Anmelde Informationen (Anmelde Informationen) für die NTLM-oder Kerberos-Authentifizierung zu verwenden, müssen Sie die [**IBackgroundCopyJob2:: SetLogon**](/windows/desktop/api/Bits1_5/nf-bits1_5-ibackgroundcopyjob2-setcredentials) -Methode aufrufen und die Member " **username** " und " **Password** " der [**BG- \_ Basis \_ Anmelde**](/windows/desktop/api/Bits1_5/ns-bits1_5-bg_basic_credentials) Informationen auf **null** festlegen.</span><span class="sxs-lookup"><span data-stu-id="74152-118">To use the user's implicit (logon) credentials for NTLM or Kerberos authentication, call the [**IBackgroundCopyJob2::SetCredentials**](/windows/desktop/api/Bits1_5/nf-bits1_5-ibackgroundcopyjob2-setcredentials) method and set the **UserName** and **Password** members of the [**BG\_BASIC\_CREDENTIALS**](/windows/desktop/api/Bits1_5/ns-bits1_5-bg_basic_credentials) structure to **NULL**.</span></span> <span data-ttu-id="74152-119">Wenn Sie implizite Anmelde Informationen für einen Proxy angeben, verwendet Bits auch die impliziten Anmelde Informationen für die Server Authentifizierung, es sei denn, Sie geben explizite Server Anmelde Informationen an.</span><span class="sxs-lookup"><span data-stu-id="74152-119">If you specify implicit credentials for a proxy, BITS will also use the implicit credentials for server authentication unless you specify explicit server credentials.</span></span>

<span data-ttu-id="74152-120">Weitere Informationen zu Diensten finden Sie unter [Dienst Konten und Bits](service-accounts-and-bits.md).</span><span class="sxs-lookup"><span data-stu-id="74152-120">For additional information for services, see [Service Accounts and BITS](service-accounts-and-bits.md).</span></span>

<span data-ttu-id="74152-121">Sie können auch den Registrierungs Wert **LMCompatibilityLevel** oder **UseLmCompat** ändern; Sie sollten diese Werte jedoch nur ändern, wenn Sie eine vorhandene Anwendung haben, die nicht zum Aufrufen der [**setanmelde**](/windows/desktop/api/Bits1_5/nf-bits1_5-ibackgroundcopyjob2-setcredentials) -Methode geändert werden kann.</span><span class="sxs-lookup"><span data-stu-id="74152-121">You could also change the **LMCompatibilityLevel** or **UseLMCompat** registry value; however, you should change these values only if you have an existing application that cannot be changed to call the [**SetCredentials**](/windows/desktop/api/Bits1_5/nf-bits1_5-ibackgroundcopyjob2-setcredentials) method.</span></span>

<span data-ttu-id="74152-122">Bits verwendet implizite Anmelde Informationen für die Authentifizierung, wenn der Registrierungs Wert **LMCompatibilityLevel** zwei oder mehr ist, und Sie haben die [**setanmelde**](/windows/desktop/api/Bits1_5/nf-bits1_5-ibackgroundcopyjob2-setcredentials) -Methode nicht aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="74152-122">BITS will use implicit credentials for authentication if the **LMCompatibilityLevel** registry value is two or greater, and you have not called the [**SetCredentials**](/windows/desktop/api/Bits1_5/nf-bits1_5-ibackgroundcopyjob2-setcredentials) method.</span></span> <span data-ttu-id="74152-123">Der vollständige Pfad zum Registrierungs Wert **LMCompatibilityLevel** ist **HKEY \_ local \_ Machine** \\ **System** \\ **CurrentControlSet** \\ **Control** \\ **LSA** \\ **LMCompatibilityLevel**.</span><span class="sxs-lookup"><span data-stu-id="74152-123">The full path to the **LMCompatibilityLevel** registry value is **HKEY\_LOCAL\_MACHINE**\\**System**\\**CurrentControlSet**\\**Control**\\**LSA**\\**LmCompatibilityLevel**.</span></span>

<span data-ttu-id="74152-124">Beachten Sie, dass sich das Ändern des Registrierungs Werts **LMCompatibilityLevel** auf andere Anwendungen und Dienste auswirken kann, die auf dem Computer ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="74152-124">Note that changing the **LMCompatibilityLevel** registry value can affect other applications and services running on the computer.</span></span> <span data-ttu-id="74152-125">Weitere Informationen zur Verwendung des Registrierungs Werts **LMCompatibilityLevel** finden Sie unter [KB147706](https://support.microsoft.com/kb/147706).</span><span class="sxs-lookup"><span data-stu-id="74152-125">For more information about using the **LMCompatibilityLevel** registry value, see [KB147706](https://support.microsoft.com/kb/147706).</span></span>

<span data-ttu-id="74152-126">Wenn das Festlegen des Registrierungs Werts **LMCompatibilityLevel** ein Problem ist, können Sie den Registrierungs Wert **UseLmCompat** unter **HKEY \_ local \_ Machine** \\ **Software** \\ **Microsoft** \\ **Windows** \\ **CurrentVersion** \\ **Bits** erstellen.</span><span class="sxs-lookup"><span data-stu-id="74152-126">If setting the **LMCompatibilityLevel** registry value is an issue, you can create the **UseLMCompat** registry value under **HKEY\_LOCAL\_MACHINE**\\**Software**\\**Microsoft**\\**Windows**\\**CurrentVersion**\\**BITS**.</span></span> <span data-ttu-id="74152-127">Der Registrierungs Wert ist ein DWORD-Wert.</span><span class="sxs-lookup"><span data-stu-id="74152-127">The registry value is a DWORD.</span></span> <span data-ttu-id="74152-128">In der folgenden Tabelle sind die möglichen Werte für **UseLmCompat** aufgeführt:</span><span class="sxs-lookup"><span data-stu-id="74152-128">The following table lists the possible values for **UseLMCompat**:</span></span>

|<span data-ttu-id="74152-129">Wert</span><span class="sxs-lookup"><span data-stu-id="74152-129">Value</span></span>|<span data-ttu-id="74152-130">BESCHREIBUNG</span><span class="sxs-lookup"><span data-stu-id="74152-130">Description</span></span>|
|-|-|
| <span data-ttu-id="74152-131">0</span><span class="sxs-lookup"><span data-stu-id="74152-131">0</span></span>     | <span data-ttu-id="74152-132">Bits sendet implizite Anmelde Informationen, wenn der Server zur Eingabe von NTLM-oder Kerberos-Anmelde Informationen auffordert.</span><span class="sxs-lookup"><span data-stu-id="74152-132">BITS will send implicit credentials whenever the server prompts for NTLM or Kerberos credentials.</span></span>                                                                                           |
| <span data-ttu-id="74152-133">1</span><span class="sxs-lookup"><span data-stu-id="74152-133">1</span></span>     | <span data-ttu-id="74152-134">Bits sendet implizite Anmelde Informationen nur dann, wenn der **LMCompatibilityLevel** -Registrierungs Wert des Client Computers größer oder gleich 2 ist.</span><span class="sxs-lookup"><span data-stu-id="74152-134">BITS will send implicit credentials only if the client computer's **LMCompatibilityLevel** registry value is greater than or equal to 2.</span></span><br/>     |
| <span data-ttu-id="74152-135">2</span><span class="sxs-lookup"><span data-stu-id="74152-135">2</span></span>     | <span data-ttu-id="74152-136">Bits sendet implizite Anmelde Informationen nur dann, wenn die Anwendung die [**setanmelde**](/windows/desktop/api/Bits1_5/nf-bits1_5-ibackgroundcopyjob2-setcredentials) -Methode aufgerufen hat.</span><span class="sxs-lookup"><span data-stu-id="74152-136">BITS will send implicit credentials only if the application called the [**SetCredentials**](/windows/desktop/api/Bits1_5/nf-bits1_5-ibackgroundcopyjob2-setcredentials) method.</span></span><br/> |

<span data-ttu-id="74152-137">Bits verwendet den Standardwert "2" für den Registrierungs Wert " **UseLmCompat** ", wenn der Registrierungs Wert nicht vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="74152-137">BITS will use a default value of "2" for the **UseLMCompat** registry value if the registry value does not exist.</span></span>

## <a name="using-certificates-for-clientserver-authentication"></a><span data-ttu-id="74152-138">Verwenden von Zertifikaten für die Client-/Serverauthentifizierung</span><span class="sxs-lookup"><span data-stu-id="74152-138">Using certificates for client/server authentication</span></span>

<span data-ttu-id="74152-139">Bei der sicheren Client-/Serverkommunikation können Clients und Server digitale Zertifikate verwenden, um sich gegenseitig zu authentifizieren.</span><span class="sxs-lookup"><span data-stu-id="74152-139">In secure client/server communication, clients and servers can use digital certificates to mutually authenticate each other.</span></span> <span data-ttu-id="74152-140">Bits unterstützt automatisch die Zertifikat basierte Server Authentifizierung für sichere HTTP-Transporte.</span><span class="sxs-lookup"><span data-stu-id="74152-140">BITS automatically supports certificate-based server authentication for secure HTTP transports.</span></span> <span data-ttu-id="74152-141">Um Bits das Client Zertifikat für die gegenseitige Authentifizierung bereitzustellen, müssen Sie entweder die [**ibackgroundcopyjobhttpoptions:: setclientcertificatebyid**](/windows/desktop/api/Bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setclientcertificatebyid) -Methode oder die [**ibackgroundcopyjobhttpoptions:: setclientcertificatebyname**](/windows/desktop/api/Bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setclientcertificatebyname) -Methode aufrufen.</span><span class="sxs-lookup"><span data-stu-id="74152-141">To provide BITS the client certificate needed for mutual authentication, call either the [**IBackgroundCopyJobHttpOptions::SetClientCertificateByID**](/windows/desktop/api/Bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setclientcertificatebyid) or [**IBackgroundCopyJobHttpOptions::SetClientCertificateByName**](/windows/desktop/api/Bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setclientcertificatebyname) method.</span></span>

<span data-ttu-id="74152-142">Wenn eine Website akzeptiert, aber kein SSL-Client Zertifikat benötigt, und der BITS-Auftrag kein Client Zertifikat angibt, schlägt der Auftrag mit dem **Fehler " \_ WinHTTP-Client Authentifizierungszertifikat \_ \_ \_ \_ erforderlich** " (0x80072f0c) fehl.</span><span class="sxs-lookup"><span data-stu-id="74152-142">When a website accepts but does not require an SSL client certificate, and the BITS job does not specify a client certificate, the job will fail with **ERROR\_WINHTTP\_CLIENT\_AUTH\_CERT\_NEEDED** (0x80072f0c).</span></span>

## <a name="how-to-handle-authenticated-proxy-scenarios-that-require-user-specific-settings"></a><span data-ttu-id="74152-143">Behandeln von authentifizierten Proxy Szenarien, die benutzerspezifische Einstellungen erfordern</span><span class="sxs-lookup"><span data-stu-id="74152-143">How to handle authenticated proxy scenarios that require user-specific settings</span></span>

<span data-ttu-id="74152-144">Wenn Sie Bits in einer Umgebung verwenden, die bei Ausführung als Konto ohne verwendbare NTLM-oder Kerberos-Anmelde Informationen in der Netzwerk Domäne des Computers eine Proxy Authentifizierung erfordert, müssen Sie zusätzliche Schritte ausführen, um die Authentifizierung mithilfe der Anmelde Informationen eines anderen Benutzerkontos, das über Anmelde Informationen für die Domäne verfügt, ordnungsgemäß durchführen zu können.</span><span class="sxs-lookup"><span data-stu-id="74152-144">If you are using BITS in an environment that requires proxy authentication while running as an account without usable NTLM or Kerberos credentials in the machine's network domain, you must take extra steps to authenticate properly by using the credentials of another user account that does have credentials on the domain.</span></span> <span data-ttu-id="74152-145">Dies ist ein typisches Szenario, wenn Ihr Bits-Code als Systemdienst wie LocalService, Network Service oder LocalSystem ausgeführt wird, da diese Konten keine verwendbaren NTLM-oder Kerberos-Anmelde Informationen aufweisen.</span><span class="sxs-lookup"><span data-stu-id="74152-145">This is a typical scenario when your BITS code is running as a system service such as LocalService, NetworkService, or LocalSystem, as those accounts do not have usable NTLM or Kerberos credentials.</span></span>

<span data-ttu-id="74152-146">Die in Bits verwendete Proxy Erkennungs Logik führt Folgendes aus, wenn ein Netzwerk-Hilfstoken (BG \_ Token \_ Network) festgelegt ist:</span><span class="sxs-lookup"><span data-stu-id="74152-146">The proxy detection logic used in BITS does the following when a network helper token (BG\_TOKEN\_NETWORK) is set:</span></span>

-   <span data-ttu-id="74152-147">Wenn [**ibackgroundcopyjob:: setproxysettings**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setproxysettings) mit der präconfig-Datei für die **Verwendung von BG- \_ Auftrags \_ Proxys \_ \_** aufgerufen wurde, lesen Sie die lokalen Internet Explorer-Proxy Einstellungen mithilfe von [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser).</span><span class="sxs-lookup"><span data-stu-id="74152-147">If [**IBackgroundCopyJob::SetProxySettings**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setproxysettings) was called with **BG\_JOB\_PROXY\_USAGE\_PRECONFIG**, then read local IE proxy settings using job owner token context impersonation via [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser).</span></span> <span data-ttu-id="74152-148">Ab Windows 10, Version 1809 (10,0; Build 17763), die hilfstokenidentität wird für diesen Schritt verwendet.</span><span class="sxs-lookup"><span data-stu-id="74152-148">Starting in Windows 10, version 1809 (10.0; Build 17763), the helper token identity is used for this step.</span></span>
-   <span data-ttu-id="74152-149">Wenn [**ibackgroundcopyjob:: setproxysettings**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setproxysettings) mit der automatischen **Erkennung der BG- \_ Proxy \_ Verwendung \_** aufgerufen wurde oder wenn die IE-Einstellungen aus dem Fall der **\_ \_ \_ \_ präconfig-Verwendung der BG-Auftrags Proxy Verwendung** die automatische Erkennung oder eine URL für die automatische Konfiguration angeben, führen Sie die automatische Proxy Erkennung oder das WPAD (Web Proxy Autodiscovery Protocol) mithilfe von " [**winhttpgetpro**](/windows/desktop/api/winhttp/nf-winhttp-winhttpgetproxyforurl)</span><span class="sxs-lookup"><span data-stu-id="74152-149">If [**IBackgroundCopyJob::SetProxySettings**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setproxysettings) was called with **BG\_PROXY\_USAGE\_AUTODETECT** or if the IE settings from the **BG\_JOB\_PROXY\_USAGE\_PRECONFIG** case specify auto-detect or an auto-config URL, then conduct auto-proxy detection, or Web Proxy Autodiscovery Protocol (WPAD), using helper token impersonation via [**WinHttpGetProxyForUrl**](/windows/desktop/api/winhttp/nf-winhttp-winhttpgetproxyforurl).</span></span>

<span data-ttu-id="74152-150">Danach wird der Identitätswechsel des hilfstokendiensts für die Proxy-oder Server Authentifizierung verwendet.</span><span class="sxs-lookup"><span data-stu-id="74152-150">After that, helper token impersonation is used for proxy or server authentication throughout.</span></span>

<span data-ttu-id="74152-151">Ab Windows 10, Version 1809 (10,0; Build 17763), das authentifizierte Proxy Szenario mit benutzerspezifischen Anmelde Informationen wird vereinfacht.</span><span class="sxs-lookup"><span data-stu-id="74152-151">Starting in Windows 10, version 1809 (10.0; Build 17763), the authenticated proxy scenario with user-specific credentials is simplified.</span></span>

1.  <span data-ttu-id="74152-152">Aufrufen der [**setanmelde**](/windows/desktop/api/Bits1_5/nf-bits1_5-ibackgroundcopyjob2-setcredentials) -Methode des Bits-Auftrags mit dem **BG \_ auth- \_ Schema \_ aushandeln**, dem auf **null** festgelegten *Benutzernamen* , dem auf **null** festgelegten *Kennwort* und dem *Ziel* auf den **BG \_ auth- \_ Ziel \_ Proxy**.</span><span class="sxs-lookup"><span data-stu-id="74152-152">Call the BITS job's [**SetCredentials**](/windows/desktop/api/Bits1_5/nf-bits1_5-ibackgroundcopyjob2-setcredentials) method with **BG\_AUTH\_SCHEME\_NEGOTIATE**, *UserName* set to **NULL**, *Password* set to **NULL**, and *Target* set to **BG\_AUTH\_TARGET\_PROXY**.</span></span> <span data-ttu-id="74152-153">Dies bewirkt, dass die impliziten Anmelde Informationen des Benutzerkontos für die NTLM-und Kerberos-Authentifizierung mit dem Proxy und dem Server verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="74152-153">This causes the user account's implicit credentials to be used for NTLM and Kerberos authentication with the proxy and server.</span></span>
2.  <span data-ttu-id="74152-154">Rufen Sie [**ibackgroundcopyjob:: setproxysettings**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setproxysettings) mit der **\_ \_ \_ \_ präconfig**-Datei für die Verwendung von BG Job Proxy auf.</span><span class="sxs-lookup"><span data-stu-id="74152-154">Call [**IBackgroundCopyJob::SetProxySettings**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setproxysettings) with **BG\_JOB\_PROXY\_USAGE\_PRECONFIG**.</span></span>
3.  <span data-ttu-id="74152-155">QueryInterface für [**ibitstokenoptions**](/windows/desktop/api/Bits4_0/nn-bits4_0-ibitstokenoptions).</span><span class="sxs-lookup"><span data-stu-id="74152-155">QueryInterface for [**IBitsTokenOptions**](/windows/desktop/api/Bits4_0/nn-bits4_0-ibitstokenoptions).</span></span>
4.  <span data-ttu-id="74152-156">Verwenden Sie die Identität des Benutzerkontos, das Sie für NTLM/Kerberos-Anmelde Informationen verwenden.</span><span class="sxs-lookup"><span data-stu-id="74152-156">Impersonate the user account you're using for NTLM/Kerberos credentials.</span></span>
5.  <span data-ttu-id="74152-157">Ruft [**"**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken)\*" auf.</span><span class="sxs-lookup"><span data-stu-id="74152-157">Call [**SetHelperToken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken).</span></span>
6. <span data-ttu-id="74152-158">Nennen Sie "einstellungsflags" mit dem **BG- \_ \_ tokennetzwerk**. [](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertokenflags)</span><span class="sxs-lookup"><span data-stu-id="74152-158">Call [**SetHelperTokenFlags**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertokenflags) with **BG\_TOKEN\_NETWORK**.</span></span>
7. <span data-ttu-id="74152-159">Identitätswechsel zurücksetzen.</span><span class="sxs-lookup"><span data-stu-id="74152-159">Revert impersonation.</span></span>
8. <span data-ttu-id="74152-160">Auftrags Einrichtung fortsetzen.</span><span class="sxs-lookup"><span data-stu-id="74152-160">Continue job setup.</span></span>
9. <span data-ttu-id="74152-161">Der Vorgang [**wird für den**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-resume) Auftrag fortgesetzt.</span><span class="sxs-lookup"><span data-stu-id="74152-161">Call [**Resume**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-resume) on the job.</span></span>

<span data-ttu-id="74152-162">Vor Windows 10, Version 1809 (10,0; Build 17763), die korrekte Benutzeridentität (die Identität des hilfstokentokens) wird für die netzwerkbasierte Proxy Erkennung (WPAD) und für die Proxy Authentifizierung verwendet, aber die tatsächliche Erkennung der lokalen Proxy Einstellungen erfolgt immer über das Token des Auftrags Besitzers, auch wenn ein Hilfstoken konfiguriert ist.</span><span class="sxs-lookup"><span data-stu-id="74152-162">Before Windows 10, version 1809 (10.0; Build 17763), the correct user identity (the helper token's identity) is used for network-based proxy detection (WPAD) and for proxy authentication, but the actual detection of local (IE) proxy settings is always done using the job owner's token, even when a helper token is configured.</span></span> <span data-ttu-id="74152-163">Um dieses Problem zu umgehen, können Sie die folgenden Schritte ausführen.</span><span class="sxs-lookup"><span data-stu-id="74152-163">To work around this shortcoming, you can follow these steps.</span></span>

1.  <span data-ttu-id="74152-164">Verwenden Sie die Identität des Benutzerkontos, das Sie für NTLM/Kerberos-Anmelde Informationen verwenden.</span><span class="sxs-lookup"><span data-stu-id="74152-164">Impersonate the user account you're using for NTLM/Kerberos credentials.</span></span>
2.  <span data-ttu-id="74152-165">Rufen Sie die Internet Explorer-Proxy Einstellungen des Benutzerkontos durch Aufrufen von [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser)ab.</span><span class="sxs-lookup"><span data-stu-id="74152-165">Retrieve the user account's IE proxy settings by calling [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser).</span></span>
3.  <span data-ttu-id="74152-166">Identitätswechsel zurücksetzen.</span><span class="sxs-lookup"><span data-stu-id="74152-166">Revert impersonation.</span></span>
4.  <span data-ttu-id="74152-167">Aufrufen der [**setanmelde**](/windows/desktop/api/Bits1_5/nf-bits1_5-ibackgroundcopyjob2-setcredentials) -Methode des Bits-Auftrags mit dem **BG \_ auth- \_ Schema \_ aushandeln**, dem auf **null** festgelegten *Benutzernamen* , dem auf **null** festgelegten *Kennwort* und dem *Ziel* auf den **BG \_ auth- \_ Ziel \_ Proxy**.</span><span class="sxs-lookup"><span data-stu-id="74152-167">Call the BITS job's [**SetCredentials**](/windows/desktop/api/Bits1_5/nf-bits1_5-ibackgroundcopyjob2-setcredentials) method with **BG\_AUTH\_SCHEME\_NEGOTIATE**, *UserName* set to **NULL**, *Password* set to **NULL**, and *Target* set to **BG\_AUTH\_TARGET\_PROXY**.</span></span> <span data-ttu-id="74152-168">Dies bewirkt, dass die impliziten Anmelde Informationen des Benutzerkontos für die NTLM-und Kerberos-Authentifizierung mit dem Proxy und dem Server verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="74152-168">This causes the user account's implicit credentials to be used for NTLM and Kerberos authentication with the proxy and server.</span></span>
5.  <span data-ttu-id="74152-169">Wenn Schritt 2 benutzerspezifische Proxy Einstellungen (d. h. *lpszProxy* oder *lpszProxyBypass* sind nicht **null**) zurückgegeben hat, legen Sie die entsprechenden Auftrags Einstellungen manuell fest, indem Sie [**setproxysettings**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setproxysettings) mit der Außerkraftsetzungs Einstellung für die **BG- \_ Auftrags \_ Proxy \_ Verwendung \_** verwenden.</span><span class="sxs-lookup"><span data-stu-id="74152-169">If step 2 yielded any user-specific proxy settings (i.e. *lpszProxy* or *lpszProxyBypass* are not **NULL**), set the corresponding job settings manually, using [**SetProxySettings**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setproxysettings) with the **BG\_JOB\_PROXY\_USAGE\_OVERRIDE** setting.</span></span>
6.  <span data-ttu-id="74152-170">Wenn in Schritt 2 keine benutzerspezifischen Proxy Einstellungen vorhanden sind, rufen Sie [**setproxysettings**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setproxysettings) mit **der \_ \_ \_ Vorkonfiguration der BG-Auftrags Verwendung** auf.</span><span class="sxs-lookup"><span data-stu-id="74152-170">If step 2 did not yield any user-specific proxy settings, call [**SetProxySettings**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setproxysettings) with **BG\_JOB\_USAGE\_PRECONFIG**.</span></span>
7.  <span data-ttu-id="74152-171">QueryInterface für [**ibitstokenoptions**](/windows/desktop/api/Bits4_0/nn-bits4_0-ibitstokenoptions).</span><span class="sxs-lookup"><span data-stu-id="74152-171">QueryInterface for [**IBitsTokenOptions**](/windows/desktop/api/Bits4_0/nn-bits4_0-ibitstokenoptions).</span></span>
8.  <span data-ttu-id="74152-172">Nimmt die Identität des Benutzerkontos erneut an.</span><span class="sxs-lookup"><span data-stu-id="74152-172">Impersonate the user account again.</span></span>
9.  <span data-ttu-id="74152-173">Ruft [**"**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken)\*" auf.</span><span class="sxs-lookup"><span data-stu-id="74152-173">Call [**SetHelperToken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken).</span></span>
10. <span data-ttu-id="74152-174">Nennen Sie "einstellungsflags" mit dem **BG- \_ \_ tokennetzwerk**. [](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertokenflags)</span><span class="sxs-lookup"><span data-stu-id="74152-174">Call [**SetHelperTokenFlags**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertokenflags) with **BG\_TOKEN\_NETWORK**.</span></span>
11. <span data-ttu-id="74152-175">Identitätswechsel zurücksetzen.</span><span class="sxs-lookup"><span data-stu-id="74152-175">Revert impersonation.</span></span>
12. <span data-ttu-id="74152-176">Auftrags Einrichtung fortsetzen.</span><span class="sxs-lookup"><span data-stu-id="74152-176">Continue job setup.</span></span>
13. <span data-ttu-id="74152-177">Der Vorgang [**wird für den**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-resume) Auftrag fortgesetzt.</span><span class="sxs-lookup"><span data-stu-id="74152-177">Call [**Resume**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-resume) on the job.</span></span>
