---
title: Hilfstoken für Bits-Übertragungs Aufträge
description: Hilfstoken für Bits-Übertragungs Aufträge
ms.assetid: f29f9870-e406-472b-9342-203def7453ae
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 52925a6e0d5a9601e21848d514214bfb843f6246
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/20/2020
ms.locfileid: "104474196"
---
# <a name="helper-tokens-for-bits-transfer-jobs"></a><span data-ttu-id="927d2-103">Hilfstoken für Bits-Übertragungs Aufträge</span><span class="sxs-lookup"><span data-stu-id="927d2-103">Helper Tokens for BITS Transfer Jobs</span></span>

<span data-ttu-id="927d2-104">In Windows Vista kann eine Anwendung mit dem Background Intelligent Transfer Service-Dienst (Bits) einem Bits-Übertragungs Auftrag ein einzelnes Sicherheits Token zuordnen.</span><span class="sxs-lookup"><span data-stu-id="927d2-104">In Windows Vista, the Background Intelligent Transfer Service (BITS) service allows an application to associate a single security token to a BITS transfer job.</span></span> <span data-ttu-id="927d2-105">Der Bits-Übertragungs Auftrag verwendet dann dieses Token für die Authentifizierung und für den Zugriff auf lokale Ressourcen und Remote Ressourcen.</span><span class="sxs-lookup"><span data-stu-id="927d2-105">The BITS transfer job then uses this token for authentication and for access to local and remote resources.</span></span>

<span data-ttu-id="927d2-106">In Windows 7 ordnet der BITS-Dienst einem Bits-Übertragungs Auftrag ein zusätzliches Token zu.</span><span class="sxs-lookup"><span data-stu-id="927d2-106">In Windows 7, the BITS service associates an additional token to a BITS transfer job.</span></span> <span data-ttu-id="927d2-107">Der Bits-Übertragungs Auftrag kann mit einem zusätzlichen Sicherheits Token konfiguriert werden, bei dem es sich um ein Identitätswechsel Token handelt, das von einer Anwendung erstellt wird, die die Bits com-API aufrufen</span><span class="sxs-lookup"><span data-stu-id="927d2-107">The BITS transfer job can be configured with an additional security token, which is an impersonation token created by an application calling the BITS COM API.</span></span> <span data-ttu-id="927d2-108">Dieses hilfstokenmodell ermöglicht es Anwendungen, gleichzeitig zwei verschiedene Sicherheits Token für den Zugriff auf lokale Dateien, Client seitige Zertifikate, Remote Dateien und Proxys zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="927d2-108">This helper token model allows applications to simultaneously use two different security tokens to access local files, client-side certificates, remote files, and proxies.</span></span> <span data-ttu-id="927d2-109">Beispielsweise wird ein Bits-Übertragungs Auftrag erstellt, mit dem die heruntergeladenen Daten in ein privilegiertes lokales Verzeichnis geschrieben und dann eine Domänen Identität mit geringen Rechten für den HTTP-Server und den Proxy Server bereitstellt wird.</span><span class="sxs-lookup"><span data-stu-id="927d2-109">For example, a BITS transfer job is created that writes the downloaded data to a privileged local directory, and then it presents a low-rights domain identity to the HTTP server and proxy server.</span></span>

<span data-ttu-id="927d2-110">Eine Anwendung, in der Regel ein Windows-Dienst, gibt mithilfe der neuen Schnittstelle [**ibitstokenoptions**](/windows/desktop/api/Bits4_0/nn-bits4_0-ibitstokenoptions)ein Hilfsobjekt an.</span><span class="sxs-lookup"><span data-stu-id="927d2-110">An application, typically a Windows service, specifies a helper token by using the new interface [**IBitsTokenOptions**](/windows/desktop/api/Bits4_0/nn-bits4_0-ibitstokenoptions).</span></span> <span data-ttu-id="927d2-111">Diese Schnittstelle wird vom Bits-Auftrags Objekt implementiert.</span><span class="sxs-lookup"><span data-stu-id="927d2-111">This interface is implemented by the BITS job object.</span></span> <span data-ttu-id="927d2-112">Die Anwendung ruft [**ibackgroundcopyjob:: QueryInterface**](/windows/desktop/api/Bits/nn-bits-ibackgroundcopyjob) auf, um den Schnittstellen Zeiger zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="927d2-112">The application calls [**IBackgroundCopyJob::QueryInterface**](/windows/desktop/api/Bits/nn-bits-ibackgroundcopyjob) to get the interface pointer.</span></span> <span data-ttu-id="927d2-113">Die Anwendung nimmt die Identität der hilfsidentität an und ruft [**ibitstokenoptions:: sethelpertoken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) auf, um das Token an den Bits-Dienst zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="927d2-113">The application impersonates the helper identity and calls [**IBitsTokenOptions::SetHelperToken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) to pass the token to the BITS service.</span></span> <span data-ttu-id="927d2-114">Anschließend gibt die Anwendung die Ressourcen an, auf die das Token angewendet wird, indem Sie einen Satz von Bitflags mithilfe von [**ibitstokenoptions:: sethelpertokenflags**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertokenflags)übergibt.</span><span class="sxs-lookup"><span data-stu-id="927d2-114">Then the application specifies the resources to which the token applies by passing a set of bit flags using [**IBitsTokenOptions::SetHelperTokenFlags**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertokenflags).</span></span> <span data-ttu-id="927d2-115">Die Anwendung löscht alle Flags (mit **sethelperonkenflags** ), um das Verhalten wiederherzustellen.</span><span class="sxs-lookup"><span data-stu-id="927d2-115">The application clears all the flags (using **SetHelperTokenFlags** again) to revert the behavior.</span></span> <span data-ttu-id="927d2-116">Der BITS-Dienst speichert die Bitflags und das Token im Bits-Übertragungs Auftrag.</span><span class="sxs-lookup"><span data-stu-id="927d2-116">The BITS service stores the bit flags and the token in the BITS transfer job.</span></span>

<span data-ttu-id="927d2-117">Wenn sich der Besitzer der Bits-Übertragungs Aufträge anmeldet, verwirft der BITS-Dienst alle Hilfstoken, die dem Übertragungs Auftrag zugeordnet sind.</span><span class="sxs-lookup"><span data-stu-id="927d2-117">When the owner of the BITS transfer jobs logs off, the BITS service discards any helper tokens that are associated with the transfer job.</span></span> <span data-ttu-id="927d2-118">Wenn die Übertragung nicht durchgeführt wird, versetzt der BITS-Dienst den Auftrag in einen Fehlerzustand, während der Fehlercode für die **BG \_ E- \_ Token \_ erforderlich** ist, und verwirft das Hilfstoken.</span><span class="sxs-lookup"><span data-stu-id="927d2-118">If the transfer is not complete, the BITS service places the job in an error state with the **BG\_E\_TOKEN\_REQUIRED** error code and discards the helper token.</span></span> <span data-ttu-id="927d2-119">Die Client Anwendung kann das Token durch Aufrufen von [**ibitstokenoptions:: sethelpertoken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) aktualisieren und dann den Bits-Übertragungs Auftrag fortsetzen.</span><span class="sxs-lookup"><span data-stu-id="927d2-119">The client application can refresh the token by calling [**IBitsTokenOptions::SetHelperToken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) and can then resume the BITS transfer job.</span></span> <span data-ttu-id="927d2-120">Alternativ kann die Client Anwendung die hilfstokenflags mithilfe von [**ibitstokenoptions:: sethelpertokenflags**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertokenflags) löschen und den Übertragungs Auftrag ohne ein Hilfsobjekt fortsetzen.</span><span class="sxs-lookup"><span data-stu-id="927d2-120">Alternatively, the client application can clear the helper token flags using [**IBitsTokenOptions::SetHelperTokenFlags**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertokenflags) and then resume the transfer job without a helper token.</span></span>

<span data-ttu-id="927d2-121">Wenn sich der Besitzer einer Terminaldienste-Sitzung abmeldet, muss der BITS-Dienst alle Hilfsobjekte dieser Sitzung verwerfen und die betroffenen Übertragungs Aufträge in einem Fehlerzustand mit dem Fehlercode " **BG \_ E \_ Token \_ Required** " platzieren.</span><span class="sxs-lookup"><span data-stu-id="927d2-121">Similarly, when the owner of a terminal services session logs off, the BITS service must discard any helper tokens from that session and place the affected transfer jobs in an error state with the **BG\_E\_TOKEN\_REQUIRED** error code.</span></span>

<span data-ttu-id="927d2-122">Das hilfstokenmodell erfordert eine Änderung an der Bits-Zugriffs Steuerungs Richtlinie.</span><span class="sxs-lookup"><span data-stu-id="927d2-122">The helper token model requires a change to BITS access control policy.</span></span> <span data-ttu-id="927d2-123">In früheren Versionen von Bits wurden Zugriffs Überprüfungen für jeden Methodenaufrufe implementiert.</span><span class="sxs-lookup"><span data-stu-id="927d2-123">Previous versions of BITS implemented access checks on every method call.</span></span> <span data-ttu-id="927d2-124">Ab Windows 7 muss die Zugriffs Überprüfung innerhalb des [**ibackgroundcopyjob:: QueryInterface**](/windows/desktop/api/Bits/nn-bits-ibackgroundcopyjob) -Aufrufes ausgeführt werden. Andernfalls hat das Hilfsobjekt möglicherweise keinen Zugriff auf den Übertragungs Auftrag.</span><span class="sxs-lookup"><span data-stu-id="927d2-124">Starting with Windows 7, the access check must be performed inside the [**IBackgroundCopyJob::QueryInterface**](/windows/desktop/api/Bits/nn-bits-ibackgroundcopyjob) call; otherwise, the helper token might not have access to the transfer job.</span></span>

> [!Note]  
> <span data-ttu-id="927d2-125">Ältere Implementierungen erforderten effektiv, dass Bits-Benutzer über Administratorrechte verfügen, um Hilfstoken festzulegen.</span><span class="sxs-lookup"><span data-stu-id="927d2-125">Older implementations effectively required that BITS users have administrator privileges in order to set helper tokens.</span></span> <span data-ttu-id="927d2-126">Ab Windows 10, Version 1607, können Benutzer, die nicht Administratoren sind, [**ibitstokenoptions:: sethelpertoken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) verwenden, um nicht-Administrator-hilfstokentoken für BITS-Aufträge festzulegen, die Sie besitzen.</span><span class="sxs-lookup"><span data-stu-id="927d2-126">Starting with Windows 10, version 1607, non-administrator BITS users can use [**IBitsTokenOptions::SetHelperToken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) to set non-administrator helper tokens on BITS jobs they own.</span></span> <span data-ttu-id="927d2-127">Diese Änderung ermöglicht es Benutzern, die keine Administratoren sind (z. b. Hintergrund-Download Dienste, die unter dem [Network Service-Konto](/windows/desktop/Services/networkservice-account)ausgeführt werden), Hilfstoken festzulegen.</span><span class="sxs-lookup"><span data-stu-id="927d2-127">This change enables non-administrator BITS users (such as background downloader services running under the [NetworkService account](/windows/desktop/Services/networkservice-account)) to set helper tokens.</span></span>
>
> <span data-ttu-id="927d2-128">Insbesondere wurde die Implementierung so geändert, dass Benutzer ohne Administratorrechte Hilfstoken festlegen können, sofern die folgenden Bedingungen erfüllt sind:</span><span class="sxs-lookup"><span data-stu-id="927d2-128">Specifically, the implementation has been changed to allow users without administrator privileges to set helper tokens, as long as the following conditions are met:</span></span>
>
> -   <span data-ttu-id="927d2-129">während des [**ibackgroundcopyjob:: QueryInterface**](/windows/desktop/api/Bits/nn-bits-ibackgroundcopyjob) -Aufrufes ist die SID des Thread Token des Aufrufers identisch mit der SID des Benutzerkontos des Auftrags Besitzers.</span><span class="sxs-lookup"><span data-stu-id="927d2-129">during the [**IBackgroundCopyJob::QueryInterface**](/windows/desktop/api/Bits/nn-bits-ibackgroundcopyjob) call, the SID of the caller's thread's token is the same as the SID of the job owner's user account, and</span></span>
> -   <span data-ttu-id="927d2-130">beim Aufrufen von [**ibitstokenoptions::**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) "" wird das Hilfsobjekt nicht die Administrator-sid ("**Domänenalias- \_ \_ \_ Admins**") aktiviert.</span><span class="sxs-lookup"><span data-stu-id="927d2-130">when [**IBitsTokenOptions::SetHelperToken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) is called, the helper token does not have the administrator SID (**DOMAIN\_ALIAS\_RID\_ADMINS**) enabled.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="927d2-131">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="927d2-131">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="927d2-132">**Ibitstokenoptions**</span><span class="sxs-lookup"><span data-stu-id="927d2-132">**IBitsTokenOptions**</span></span>](/windows/desktop/api/Bits4_0/nn-bits4_0-ibitstokenoptions)
</dt> </dl>

 

 