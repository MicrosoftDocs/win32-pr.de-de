---
description: Wenn die Anwendung die Funktionen LoadLibrary oder LoadLibraryEx aufruft, versucht das System, die dll zu finden (Weitere Informationen finden Sie unter Dynamic-Link Bibliotheks Such Reihenfolge).
ms.assetid: 81e237a9-3c32-46a5-88d3-c978f43dad54
title: Dynamische Verknüpfung Run-Time
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a9e215ac83ecdc0615b8030e2e215857c67fe6e5
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "106345168"
---
# <a name="run-time-dynamic-linking"></a><span data-ttu-id="7bce6-103">Dynamische Verknüpfung Run-Time</span><span class="sxs-lookup"><span data-stu-id="7bce6-103">Run-Time Dynamic Linking</span></span>

<span data-ttu-id="7bce6-104">Wenn die Anwendung die Funktionen [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) oder [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) aufruft, versucht das System, die dll zu finden (Weitere Informationen finden Sie unter [Dynamic-Link Library Search Order](dynamic-link-library-search-order.md)).</span><span class="sxs-lookup"><span data-stu-id="7bce6-104">When the application calls the [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) functions, the system attempts to locate the DLL (for details, see [Dynamic-Link Library Search Order](dynamic-link-library-search-order.md)).</span></span> <span data-ttu-id="7bce6-105">Wenn die Suche erfolgreich ist, ordnet das System das dll-Modul dem virtuellen Adressraum des Prozesses zu und erhöht den Verweis Zähler.</span><span class="sxs-lookup"><span data-stu-id="7bce6-105">If the search succeeds, the system maps the DLL module into the virtual address space of the process and increments the reference count.</span></span> <span data-ttu-id="7bce6-106">Wenn der Aufruf von **LoadLibrary** oder **LoadLibraryEx** eine DLL angibt, deren Code bereits dem virtuellen Adressraum des aufrufenden Prozesses zugeordnet ist, gibt die Funktion einfach ein Handle für die DLL zurück und erhöht den dll-Verweis Zähler.</span><span class="sxs-lookup"><span data-stu-id="7bce6-106">If the call to **LoadLibrary** or **LoadLibraryEx** specifies a DLL whose code is already mapped into the virtual address space of the calling process, the function simply returns a handle to the DLL and increments the DLL reference count.</span></span> <span data-ttu-id="7bce6-107">Beachten Sie, dass zwei DLLs, die den gleichen Basis Dateinamen und die gleiche Erweiterung aufweisen, aber in verschiedenen Verzeichnissen gefunden werden, nicht als dieselbe dll angesehen werden.</span><span class="sxs-lookup"><span data-stu-id="7bce6-107">Note that two DLLs that have the same base file name and extension but are found in different directories are not considered to be the same DLL.</span></span>

<span data-ttu-id="7bce6-108">Das System ruft die Einstiegspunkt Funktion im Kontext des Threads auf, der [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) oder [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa)aufgerufen hat.</span><span class="sxs-lookup"><span data-stu-id="7bce6-108">The system calls the entry-point function in the context of the thread that called [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa).</span></span> <span data-ttu-id="7bce6-109">Die Einstiegspunkt Funktion wird nicht aufgerufen, wenn die DLL bereits durch einen Aufruf von LoadLibrary oder LoadLibraryEx durch einen Aufruf von **LoadLibrary** oder **LoadLibraryEx** ohne entsprechenden Aufruf an die [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) -Funktion geladen wurde.</span><span class="sxs-lookup"><span data-stu-id="7bce6-109">The entry-point function is not called if the DLL was already loaded by the process through a call to **LoadLibrary** or **LoadLibraryEx** with no corresponding call to the [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) function.</span></span>

<span data-ttu-id="7bce6-110">Wenn das System die dll nicht finden kann oder wenn die Einstiegspunkt Funktion false zurückgibt, gibt [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) oder [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) NULL zurück.</span><span class="sxs-lookup"><span data-stu-id="7bce6-110">If the system cannot find the DLL or if the entry-point function returns FALSE, [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) returns NULL.</span></span> <span data-ttu-id="7bce6-111">Wenn **LoadLibrary** oder **LoadLibraryEx** erfolgreich ist, wird ein Handle an das dll-Modul zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="7bce6-111">If **LoadLibrary** or **LoadLibraryEx** succeeds, it returns a handle to the DLL module.</span></span> <span data-ttu-id="7bce6-112">Der Prozess kann dieses Handle verwenden, um die dll in einem Aufrufen der [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress)-, [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary)-oder [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread) -Funktion zu identifizieren.</span><span class="sxs-lookup"><span data-stu-id="7bce6-112">The process can use this handle to identify the DLL in a call to the [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress), [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary), or [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread) function.</span></span>

<span data-ttu-id="7bce6-113">Die [**GetModuleHandle**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulehandlea) -Funktion gibt ein Handle zurück, das in " [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress)", " [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary)" oder " [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread)" verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="7bce6-113">The [**GetModuleHandle**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulehandlea) function returns a handle used in [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress), [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary), or [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread).</span></span> <span data-ttu-id="7bce6-114">Die **GetModuleHandle** -Funktion ist nur dann erfolgreich, wenn das dll-Modul bereits durch das Laden der Lade Zeit oder durch einen vorherigen Aufruf von [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) oder [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa)dem Adressraum des Prozesses zugeordnet ist.</span><span class="sxs-lookup"><span data-stu-id="7bce6-114">The **GetModuleHandle** function succeeds only if the DLL module is already mapped into the address space of the process by load-time linking or by a previous call to [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa).</span></span> <span data-ttu-id="7bce6-115">Im Gegensatz zu **LoadLibrary** oder **LoadLibraryEx** erhöht **GetModuleHandle** nicht den Modul Verweis Zähler.</span><span class="sxs-lookup"><span data-stu-id="7bce6-115">Unlike **LoadLibrary** or **LoadLibraryEx**, **GetModuleHandle** does not increment the module reference count.</span></span> <span data-ttu-id="7bce6-116">Die [**GetModuleFileName**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) -Funktion Ruft den vollständigen Pfad des Moduls ab, das einem Handle zugeordnet ist, das von **GetModuleHandle**, **LoadLibrary** oder **LoadLibraryEx** zurückgegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="7bce6-116">The [**GetModuleFileName**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) function retrieves the full path of the module associated with a handle returned by **GetModuleHandle**, **LoadLibrary**, or **LoadLibraryEx**.</span></span>

<span data-ttu-id="7bce6-117">Der Prozess kann [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress) verwenden, um die Adresse einer exportierten Funktion in der DLL mithilfe eines von [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) oder [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa), [**GetModuleHandle**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulehandlea)zurückgegebenen dll-Modul Handles zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="7bce6-117">The process can use [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress) to get the address of an exported function in the DLL using a DLL module handle returned by [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa), [**GetModuleHandle**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulehandlea).</span></span>

<span data-ttu-id="7bce6-118">Wenn das dll-Modul nicht mehr benötigt wird, kann der Prozess " [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) " oder " [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread)" aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="7bce6-118">When the DLL module is no longer needed, the process can call [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) or [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread).</span></span> <span data-ttu-id="7bce6-119">Diese Funktionen verringern den Modul Verweis Zähler und entordnen den DLL-Code aus dem virtuellen Adressraum des Prozesses, wenn der Verweis Zähler Null ist.</span><span class="sxs-lookup"><span data-stu-id="7bce6-119">These functions decrement the module reference count and unmap the DLL code from the virtual address space of the process if the reference count is zero.</span></span>

<span data-ttu-id="7bce6-120">Durch die dynamische Verknüpfung zur Laufzeit kann der Prozess weiterhin ausgeführt werden, auch wenn keine DLL verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="7bce6-120">Run-time dynamic linking enables the process to continue running even if a DLL is not available.</span></span> <span data-ttu-id="7bce6-121">Der Prozess kann dann eine alternative Methode verwenden, um das Ziel zu erreichen.</span><span class="sxs-lookup"><span data-stu-id="7bce6-121">The process can then use an alternate method to accomplish its objective.</span></span> <span data-ttu-id="7bce6-122">Wenn ein Prozess z. b. eine DLL nicht finden kann, kann er versuchen, eine andere DLL zu verwenden, oder er kann den Benutzer über einen Fehler benachrichtigen.</span><span class="sxs-lookup"><span data-stu-id="7bce6-122">For example, if a process is unable to locate one DLL, it can try to use another, or it can notify the user of an error.</span></span> <span data-ttu-id="7bce6-123">Wenn der Benutzer den vollständigen Pfad der fehlenden DLL angeben kann, kann der Prozess diese Informationen verwenden, um die dll zu laden, auch wenn Sie sich nicht im normalen Suchpfad befindet.</span><span class="sxs-lookup"><span data-stu-id="7bce6-123">If the user can provide the full path of the missing DLL, the process can use this information to load the DLL even though it is not in the normal search path.</span></span> <span data-ttu-id="7bce6-124">Diese Situation steht im Gegensatz zum Lade Zeit-verknüpfen, bei dem das System einfach den Prozess beendet, wenn die dll nicht gefunden werden kann.</span><span class="sxs-lookup"><span data-stu-id="7bce6-124">This situation contrasts with load-time linking, in which the system simply terminates the process if it cannot find the DLL.</span></span>

<span data-ttu-id="7bce6-125">Die dynamische Verknüpfung zur Laufzeit kann Probleme verursachen, wenn die dll die [**DllMain**](dllmain.md) -Funktion verwendet, um für jeden Thread eines Prozesses eine Initialisierung auszuführen, da der Einstiegspunkt nicht für Threads aufgerufen wird, die vor dem Aufruf von [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) oder [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) vorhanden waren.</span><span class="sxs-lookup"><span data-stu-id="7bce6-125">Run-time dynamic linking can cause problems if the DLL uses the [**DllMain**](dllmain.md) function to perform initialization for each thread of a process, because the entry-point is not called for threads that existed before [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) is called.</span></span> <span data-ttu-id="7bce6-126">Ein Beispiel für das Behandeln dieses Problems finden Sie unter Verwenden von [lokalem Thread Speicher in einer Dynamic-Link-Bibliothek](using-thread-local-storage-in-a-dynamic-link-library.md).</span><span class="sxs-lookup"><span data-stu-id="7bce6-126">For an example showing how to deal with this problem, see [Using Thread Local Storage in a Dynamic-Link Library](using-thread-local-storage-in-a-dynamic-link-library.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="7bce6-127">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="7bce6-127">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="7bce6-128">Verwenden dynamischer Lauf Zeit Verknüpfungen</span><span class="sxs-lookup"><span data-stu-id="7bce6-128">Using Run-time Dynamic Linking</span></span>](using-run-time-dynamic-linking.md)
</dt> </dl>

 

 
