---
description: Eine DLL kann optional eine Einstiegspunkt Funktion angeben.
ms.assetid: ec035fc6-0a6f-4e52-a4cc-8d7a25a94366
title: Entry-Point Funktion der Dynamic-Link-Bibliothek
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b62bff557bfa2aa792b420e8fe1856bbe0726921
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "103753776"
---
# <a name="dynamic-link-library-entry-point-function"></a><span data-ttu-id="324ef-103">Entry-Point Funktion der Dynamic-Link-Bibliothek</span><span class="sxs-lookup"><span data-stu-id="324ef-103">Dynamic-Link Library Entry-Point Function</span></span>

<span data-ttu-id="324ef-104">Eine DLL kann optional eine Einstiegspunkt Funktion angeben.</span><span class="sxs-lookup"><span data-stu-id="324ef-104">A DLL can optionally specify an entry-point function.</span></span> <span data-ttu-id="324ef-105">Falls vorhanden, ruft das System die Einstiegspunkt Funktion immer dann auf, wenn ein Prozess oder Thread die dll lädt oder entlädt.</span><span class="sxs-lookup"><span data-stu-id="324ef-105">If present, the system calls the entry-point function whenever a process or thread loads or unloads the DLL.</span></span> <span data-ttu-id="324ef-106">Sie kann verwendet werden, um einfache Initialisierungs-und Bereinigungs Aufgaben auszuführen.</span><span class="sxs-lookup"><span data-stu-id="324ef-106">It can be used to perform simple initialization and cleanup tasks.</span></span> <span data-ttu-id="324ef-107">So kann beispielsweise ein lokaler Thread Speicher eingerichtet werden, wenn ein neuer Thread erstellt wird, und bereinigt, wenn der Thread beendet wird.</span><span class="sxs-lookup"><span data-stu-id="324ef-107">For example, it can set up thread local storage when a new thread is created, and clean it up when the thread is terminated.</span></span>

<span data-ttu-id="324ef-108">Wenn Sie die DLL mit der C-Lauf Zeit Bibliothek verknüpfen, stellt Sie möglicherweise eine Einstiegspunkt Funktion bereit und ermöglicht es Ihnen, eine separate Initialisierungsfunktion bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="324ef-108">If you are linking your DLL with the C run-time library, it may provide an entry-point function for you, and allow you to provide a separate initialization function.</span></span> <span data-ttu-id="324ef-109">Weitere Informationen finden Sie in der Dokumentation zur Lauf Zeit Bibliothek.</span><span class="sxs-lookup"><span data-stu-id="324ef-109">Check the documentation for your run-time library for more information.</span></span>

<span data-ttu-id="324ef-110">Wenn Sie einen eigenen Einstiegspunkt bereitstellen, finden Sie weitere Informationen unter der [**DllMain**](dllmain.md) -Funktion.</span><span class="sxs-lookup"><span data-stu-id="324ef-110">If you are providing your own entry-point, see the [**DllMain**](dllmain.md) function.</span></span> <span data-ttu-id="324ef-111">Der Name **DllMain** ist ein Platzhalter für eine benutzerdefinierte Funktion.</span><span class="sxs-lookup"><span data-stu-id="324ef-111">The name **DllMain** is a placeholder for a user-defined function.</span></span> <span data-ttu-id="324ef-112">Sie müssen den tatsächlichen Namen angeben, den Sie beim Erstellen der DLL verwenden.</span><span class="sxs-lookup"><span data-stu-id="324ef-112">You must specify the actual name you use when you build your DLL.</span></span> <span data-ttu-id="324ef-113">Weitere Informationen finden Sie in der Dokumentation, die in ihren Entwicklungs Tools enthalten ist.</span><span class="sxs-lookup"><span data-stu-id="324ef-113">For more information, see the documentation included with your development tools.</span></span>

## <a name="calling-the-entry-point-function"></a><span data-ttu-id="324ef-114">Aufrufen der Entry-Point-Funktion</span><span class="sxs-lookup"><span data-stu-id="324ef-114">Calling the Entry-Point Function</span></span>

<span data-ttu-id="324ef-115">Das System ruft die Einstiegspunkt Funktion immer dann auf, wenn eines der folgenden Ereignisse eintritt:</span><span class="sxs-lookup"><span data-stu-id="324ef-115">The system calls the entry-point function whenever any one of the following events occurs:</span></span>

-   <span data-ttu-id="324ef-116">Ein Prozess lädt die dll.</span><span class="sxs-lookup"><span data-stu-id="324ef-116">A process loads the DLL.</span></span> <span data-ttu-id="324ef-117">Für Prozesse, die dynamische Verknüpfungen zur Ladezeit verwenden, wird die dll während der Prozess Initialisierung geladen.</span><span class="sxs-lookup"><span data-stu-id="324ef-117">For processes using load-time dynamic linking, the DLL is loaded during process initialization.</span></span> <span data-ttu-id="324ef-118">Für Prozesse, die Lauf Zeit Verknüpfungen verwenden, wird die dll vor der Rückgabe von [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) oder [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) geladen.</span><span class="sxs-lookup"><span data-stu-id="324ef-118">For processes using run-time linking, the DLL is loaded before [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) returns.</span></span>
-   <span data-ttu-id="324ef-119">Ein Prozess entlädt die dll.</span><span class="sxs-lookup"><span data-stu-id="324ef-119">A process unloads the DLL.</span></span> <span data-ttu-id="324ef-120">Die dll wird entladen, wenn der Prozess beendet wird oder die [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) -Funktion aufruft und der Verweis Zähler 0 (null) ist.</span><span class="sxs-lookup"><span data-stu-id="324ef-120">The DLL is unloaded when the process terminates or calls the [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) function and the reference count becomes zero.</span></span> <span data-ttu-id="324ef-121">Wenn der Prozess aufgrund der [**TerminateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-terminateprocess) -oder [**TerminateThread**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-terminatethread) -Funktion beendet wird, ruft das System die DLL-Einstiegspunkt Funktion nicht auf.</span><span class="sxs-lookup"><span data-stu-id="324ef-121">If the process terminates as a result of the [**TerminateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-terminateprocess) or [**TerminateThread**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-terminatethread) function, the system does not call the DLL entry-point function.</span></span>
-   <span data-ttu-id="324ef-122">Ein neuer Thread wird in einem Prozess erstellt, der die dll geladen hat.</span><span class="sxs-lookup"><span data-stu-id="324ef-122">A new thread is created in a process that has loaded the DLL.</span></span> <span data-ttu-id="324ef-123">Sie können die [**DisableThreadLibraryCalls**](/windows/win32/api/libloaderapi/nf-libloaderapi-disablethreadlibrarycalls) -Funktion verwenden, um die Benachrichtigung zu deaktivieren, wenn Threads erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="324ef-123">You can use the [**DisableThreadLibraryCalls**](/windows/win32/api/libloaderapi/nf-libloaderapi-disablethreadlibrarycalls) function to disable notification when threads are created.</span></span>
-   <span data-ttu-id="324ef-124">Ein Thread eines Prozesses, der die dll geladen hat, wird normal beendet, nicht mithilfe von [**TerminateThread**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-terminatethread) oder [**TerminateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-terminateprocess).</span><span class="sxs-lookup"><span data-stu-id="324ef-124">A thread of a process that has loaded the DLL terminates normally, not using [**TerminateThread**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-terminatethread) or [**TerminateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-terminateprocess).</span></span> <span data-ttu-id="324ef-125">Wenn ein Prozess die dll entlädt, wird die Einstiegspunkt Funktion nur einmal für den gesamten Prozess und nicht für jeden vorhandenen Thread des Prozesses aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="324ef-125">When a process unloads the DLL, the entry-point function is called only once for the entire process, rather than once for each existing thread of the process.</span></span> <span data-ttu-id="324ef-126">Sie können [**DisableThreadLibraryCalls**](/windows/win32/api/libloaderapi/nf-libloaderapi-disablethreadlibrarycalls) verwenden, um die Benachrichtigung zu deaktivieren, wenn Threads beendet werden.</span><span class="sxs-lookup"><span data-stu-id="324ef-126">You can use [**DisableThreadLibraryCalls**](/windows/win32/api/libloaderapi/nf-libloaderapi-disablethreadlibrarycalls) to disable notification when threads are terminated.</span></span>

<span data-ttu-id="324ef-127">Die Einstiegspunkt Funktion kann jeweils nur von einem Thread aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="324ef-127">Only one thread at a time can call the entry-point function.</span></span>

<span data-ttu-id="324ef-128">Das System ruft die Einstiegspunkt Funktion im Kontext des Prozesses oder Threads auf, der bewirkt hat, dass die Funktion aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="324ef-128">The system calls the entry-point function in the context of the process or thread that caused the function to be called.</span></span> <span data-ttu-id="324ef-129">Dadurch kann eine DLL die Einstiegspunkt Funktion verwenden, um Speicher im virtuellen Adressraum des aufrufenden Prozesses zuzuweisen, oder um Handles zu öffnen, auf die der Prozess Zugriff hat.</span><span class="sxs-lookup"><span data-stu-id="324ef-129">This allows a DLL to use its entry-point function for allocating memory in the virtual address space of the calling process or to open handles accessible to the process.</span></span> <span data-ttu-id="324ef-130">Die Einstiegspunkt Funktion kann auch Arbeitsspeicher zuweisen, der einem neuen Thread mithilfe von Thread lokalem Speicher (TLS) privat ist.</span><span class="sxs-lookup"><span data-stu-id="324ef-130">The entry-point function can also allocate memory that is private to a new thread by using thread local storage (TLS).</span></span> <span data-ttu-id="324ef-131">Weitere Informationen zum lokalen Thread Speicher finden Sie unter [Thread lokaler Speicher](/windows/desktop/ProcThread/thread-local-storage).</span><span class="sxs-lookup"><span data-stu-id="324ef-131">For more information about thread local storage, see [Thread Local Storage](/windows/desktop/ProcThread/thread-local-storage).</span></span>

## <a name="entry-point-function-definition"></a><span data-ttu-id="324ef-132">Definition der Entry-Point Funktion</span><span class="sxs-lookup"><span data-stu-id="324ef-132">Entry-Point Function Definition</span></span>

<span data-ttu-id="324ef-133">Die DLL-Einstiegspunkt Funktion muss mit der Standard Aufruf Konvention deklariert werden.</span><span class="sxs-lookup"><span data-stu-id="324ef-133">The DLL entry-point function must be declared with the standard-call calling convention.</span></span> <span data-ttu-id="324ef-134">Wenn der DLL-Einstiegspunkt nicht ordnungsgemäß deklariert ist, wird die dll nicht geladen, und das System zeigt eine Meldung an, die angibt, dass der DLL-Einstiegspunkt mit WinAPI deklariert werden muss.</span><span class="sxs-lookup"><span data-stu-id="324ef-134">If the DLL entry point is not declared correctly, the DLL is not loaded, and the system displays a message indicating that the DLL entry point must be declared with WINAPI.</span></span>

<span data-ttu-id="324ef-135">Im Hauptteil der-Funktion können Sie eine beliebige Kombination der folgenden Szenarien verarbeiten, in denen der DLL-Einstiegspunkt aufgerufen wurde:</span><span class="sxs-lookup"><span data-stu-id="324ef-135">In the body of the function, you may handle any combination of the following scenarios in which the DLL entry point has been called:</span></span>

-   <span data-ttu-id="324ef-136">Ein Prozess lädt die dll (**dll- \_ Prozess \_ Anfügen**).</span><span class="sxs-lookup"><span data-stu-id="324ef-136">A process loads the DLL (**DLL\_PROCESS\_ATTACH**).</span></span>
-   <span data-ttu-id="324ef-137">Der aktuelle Prozess erstellt einen neuen Thread (**\_ \_ Anfügen eines dll-Threads**).</span><span class="sxs-lookup"><span data-stu-id="324ef-137">The current process creates a new thread (**DLL\_THREAD\_ATTACH**).</span></span>
-   <span data-ttu-id="324ef-138">Ein Thread wird normal beendet **( \_ \_ Trennen des dll-Threads**).</span><span class="sxs-lookup"><span data-stu-id="324ef-138">A thread exits normally (**DLL\_THREAD\_DETACH**).</span></span>
-   <span data-ttu-id="324ef-139">Ein Prozess entlädt die dll (**dll \_ - \_ Prozess** Trennung).</span><span class="sxs-lookup"><span data-stu-id="324ef-139">A process unloads the DLL (**DLL\_PROCESS\_DETACH**).</span></span>

<span data-ttu-id="324ef-140">Die Einstiegspunkt Funktion sollte nur einfache Initialisierungs Tasks ausführen.</span><span class="sxs-lookup"><span data-stu-id="324ef-140">The entry-point function should perform only simple initialization tasks.</span></span> <span data-ttu-id="324ef-141">Die [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) -Funktion oder die [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) -Funktion (oder eine Funktion, die diese Funktionen aufruft) darf nicht aufgerufen werden, da dadurch Abhängigkeits Schleifen in der dll-Lade Reihenfolge erstellt werden können.</span><span class="sxs-lookup"><span data-stu-id="324ef-141">It must not call the [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) function (or a function that calls these functions), because this may create dependency loops in the DLL load order.</span></span> <span data-ttu-id="324ef-142">Dies kann dazu führen, dass eine DLL verwendet wird, bevor das System den Initialisierungs Code ausgeführt hat.</span><span class="sxs-lookup"><span data-stu-id="324ef-142">This can result in a DLL being used before the system has executed its initialization code.</span></span> <span data-ttu-id="324ef-143">Ebenso darf die Einstiegspunkt Funktion die [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) -Funktion (oder eine Funktion, die **FreeLibrary** aufruft) während der Prozess Beendigung nicht aufrufen, da dies dazu führen kann, dass eine DLL verwendet wird, nachdem das System den Beendigungs Code ausgeführt hat.</span><span class="sxs-lookup"><span data-stu-id="324ef-143">Similarly, the entry-point function must not call the [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) function (or a function that calls **FreeLibrary**) during process termination, because this can result in a DLL being used after the system has executed its termination code.</span></span>

<span data-ttu-id="324ef-144">Da Kernel32.dll im Prozess Adressraum garantiert geladen wird, wenn die Einstiegspunkt Funktion aufgerufen wird, führt das Aufrufen von Funktionen in Kernel32.dll nicht dazu, dass die dll verwendet wird, bevor Ihr Initialisierungs Code ausgeführt wurde.</span><span class="sxs-lookup"><span data-stu-id="324ef-144">Because Kernel32.dll is guaranteed to be loaded in the process address space when the entry-point function is called, calling functions in Kernel32.dll does not result in the DLL being used before its initialization code has been executed.</span></span> <span data-ttu-id="324ef-145">Daher kann die Einstiegspunkt Funktion [Synchronisierungs Objekte](/windows/desktop/Sync/synchronization-objects) erstellen, z. b. kritische Abschnitte und Mutexen, und TLS verwenden, da sich diese Funktionen in Kernel32.dll befinden.</span><span class="sxs-lookup"><span data-stu-id="324ef-145">Therefore, the entry-point function can create [synchronization objects](/windows/desktop/Sync/synchronization-objects) such as critical sections and mutexes, and use TLS, because these functions are located in Kernel32.dll.</span></span> <span data-ttu-id="324ef-146">Es ist z. b. nicht sicher, die Registrierungsfunktionen aufzurufen, da Sie sich in Advapi32.dll befinden.</span><span class="sxs-lookup"><span data-stu-id="324ef-146">It is not safe to call the registry functions, for example, because they are located in Advapi32.dll.</span></span>

<span data-ttu-id="324ef-147">Das Aufrufen anderer Funktionen kann zu Problemen führen, die schwer zu diagnostizieren sind.</span><span class="sxs-lookup"><span data-stu-id="324ef-147">Calling other functions may result in problems that are difficult to diagnose.</span></span> <span data-ttu-id="324ef-148">Das Aufrufen von Benutzer-, Shell-und com-Funktionen kann z. b. zu Zugriffs Verletzungs Fehlern führen, da einige Funktionen in ihren DLLs [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) aufrufen, um andere Systemkomponenten zu laden.</span><span class="sxs-lookup"><span data-stu-id="324ef-148">For example, calling User, Shell, and COM functions can cause access violation errors, because some functions in their DLLs call [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) to load other system components.</span></span> <span data-ttu-id="324ef-149">Umgekehrt kann das Aufrufen dieser Funktionen während der Beendigung zu Zugriffs Verletzungs Fehlern führen, da die entsprechende Komponente möglicherweise bereits entladen oder nicht initialisiert wurde.</span><span class="sxs-lookup"><span data-stu-id="324ef-149">Conversely, calling those functions during termination can cause access violation errors because the corresponding component may already have been unloaded or uninitialized.</span></span>

<span data-ttu-id="324ef-150">Im folgenden Beispiel wird veranschaulicht, wie die-DLL-Einstiegspunkt Funktion strukturiert wird.</span><span class="sxs-lookup"><span data-stu-id="324ef-150">The following example demonstrates how to structure the DLL entry-point function.</span></span>

``` syntax
BOOL WINAPI DllMain(
    HINSTANCE hinstDLL,  // handle to DLL module
    DWORD fdwReason,     // reason for calling function
    LPVOID lpReserved )  // reserved
{
    // Perform actions based on the reason for calling.
    switch( fdwReason ) 
    { 
        case DLL_PROCESS_ATTACH:
         // Initialize once for each new process.
         // Return FALSE to fail DLL load.
            break;

        case DLL_THREAD_ATTACH:
         // Do thread-specific initialization.
            break;

        case DLL_THREAD_DETACH:
         // Do thread-specific cleanup.
            break;

        case DLL_PROCESS_DETACH:
         // Perform any necessary cleanup.
            break;
    }
    return TRUE;  // Successful DLL_PROCESS_ATTACH.
}
```

## <a name="entry-point-function-return-value"></a><span data-ttu-id="324ef-151">Rückgabewert der Entry-Point Funktion</span><span class="sxs-lookup"><span data-stu-id="324ef-151">Entry-Point Function Return Value</span></span>

<span data-ttu-id="324ef-152">Wenn eine DLL-Einstiegspunkt Funktion aufgerufen wird, weil ein Prozess geladen wird, gibt die Funktion **true** zurück, um den Erfolg anzugeben.</span><span class="sxs-lookup"><span data-stu-id="324ef-152">When a DLL entry-point function is called because a process is loading, the function returns **TRUE** to indicate success.</span></span> <span data-ttu-id="324ef-153">Bei Prozessen, die das Lade Zeit Verknüpfungen verwenden, bewirkt der Rückgabewert **false** , dass die Prozess Initialisierung fehlschlägt und der Prozess beendet wird.</span><span class="sxs-lookup"><span data-stu-id="324ef-153">For processes using load-time linking, a return value of **FALSE** causes the process initialization to fail and the process terminates.</span></span> <span data-ttu-id="324ef-154">Für Prozesse, die Lauf Zeit Verknüpfungen verwenden, bewirkt der Rückgabewert FALSE, dass die [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) -Funktion oder die [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) -Funktion **null** zurückgibt, was auf einen Fehler hinweist.</span><span class="sxs-lookup"><span data-stu-id="324ef-154">For processes using run-time linking, a return value of FALSE causes the [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) function to return **NULL**, indicating failure.</span></span> <span data-ttu-id="324ef-155">(Das System ruft sofort die Einstiegspunkt Funktion mit dem **dll \_ - \_ Prozess** ab und entlädt die dll.) Der Rückgabewert der Einstiegspunkt Funktion wird ignoriert, wenn die Funktion aus einem anderen Grund aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="324ef-155">(The system immediately calls your entry-point function with **DLL\_PROCESS\_DETACH** and unloads the DLL.) The return value of the entry-point function is disregarded when the function is called for any other reason.</span></span>

 

 
