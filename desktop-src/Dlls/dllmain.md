---
description: Ein optionaler Einstiegspunkt in eine Dynamic Link Library (dll). Wenn das System einen Prozess oder Thread startet oder beendet, ruft es die Einstiegspunkt Funktion für jede geladene DLL mit dem ersten Thread des Prozesses auf.
ms.assetid: 0c3e3083-9297-4626-b2a7-0062d1c2cf9e
title: DllMain-Einstiegspunkt (Process. h)
ms.topic: reference
ms.date: 07/22/2020
topic_type:
- APIRef
- kbSyntax
api_name:
- DllMain
api_type:
- UserDefined
api_location:
- process.h
ms.openlocfilehash: ee182fd54f11909e54e98f827904f1da5e46f557
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "106347417"
---
# <a name="dllmain-entry-point"></a><span data-ttu-id="34fc8-104">DllMain-Einstiegspunkt</span><span class="sxs-lookup"><span data-stu-id="34fc8-104">DllMain entry point</span></span>

<span data-ttu-id="34fc8-105">Ein optionaler Einstiegspunkt in eine Dynamic Link Library (dll).</span><span class="sxs-lookup"><span data-stu-id="34fc8-105">An optional entry point into a dynamic-link library (DLL).</span></span> <span data-ttu-id="34fc8-106">Wenn das System einen Prozess oder Thread startet oder beendet, ruft es die Einstiegspunkt Funktion für jede geladene DLL mit dem ersten Thread des Prozesses auf.</span><span class="sxs-lookup"><span data-stu-id="34fc8-106">When the system starts or terminates a process or thread, it calls the entry-point function for each loaded DLL using the first thread of the process.</span></span> <span data-ttu-id="34fc8-107">Das System ruft auch die Einstiegspunkt Funktion für eine DLL auf, wenn Sie mit den Funktionen [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) und [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) geladen oder entladen wird.</span><span class="sxs-lookup"><span data-stu-id="34fc8-107">The system also calls the entry-point function for a DLL when it is loaded or unloaded using the [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) and [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) functions.</span></span>

## <a name="example"></a><span data-ttu-id="34fc8-108">Beispiel</span><span class="sxs-lookup"><span data-stu-id="34fc8-108">Example</span></span>

```cpp
BOOL WINAPI DllMain(
    HINSTANCE hinstDLL,  // handle to DLL module
    DWORD fdwReason,     // reason for calling function
    LPVOID lpReserved )  // reserved
{
    // Perform actions based on the reason for calling.
    switch( fdwReason ) 
    { 
        case DLL_PROCESS_ATTACH:
         // Initialize once for each new process.
         // Return FALSE to fail DLL load.
            break;

        case DLL_THREAD_ATTACH:
         // Do thread-specific initialization.
            break;

        case DLL_THREAD_DETACH:
         // Do thread-specific cleanup.
            break;

        case DLL_PROCESS_DETACH:
         // Perform any necessary cleanup.
            break;
    }
    return TRUE;  // Successful DLL_PROCESS_ATTACH.
}
```

<span data-ttu-id="34fc8-109">Dies ist ein Beispiel aus der [Funktion "Dynamic-Link Library Entry-Point](dynamic-link-library-entry-point-function.md)".</span><span class="sxs-lookup"><span data-stu-id="34fc8-109">This is an example from the [Dynamic-Link Library Entry-Point Function](dynamic-link-library-entry-point-function.md).</span></span>


> [!WARNING]
> <span data-ttu-id="34fc8-110">Es gibt erhebliche Einschränkungen bei den Aktionen, die Sie sicher in einem DLL-Einstiegspunkt durchführen können.</span><span class="sxs-lookup"><span data-stu-id="34fc8-110">There are significant limits on what you can safely do in a DLL entry point.</span></span> <span data-ttu-id="34fc8-111">Weitere Informationen finden Sie unter [allgemeine bewährte Methoden](dynamic-link-library-best-practices.md) für bestimmte Windows-APIs, die in DllMain nicht sicher aufgerufen werden können.</span><span class="sxs-lookup"><span data-stu-id="34fc8-111">See [General Best Practices](dynamic-link-library-best-practices.md) for specific Windows APIs that are unsafe to call in DllMain.</span></span> <span data-ttu-id="34fc8-112">Wenn Sie mehr als nur die einfachste Initialisierung durchführen müssen, führen Sie dies in einer Initialisierungsfunktion für die DLL durch.</span><span class="sxs-lookup"><span data-stu-id="34fc8-112">If you need anything but the simplest initialization then do that in an initialization function for the DLL.</span></span> <span data-ttu-id="34fc8-113">Sie können festlegen, dass Anwendungen die Initialisierungsfunktion nach dem Ausführen von DllMain und vor dem Abrufen anderer Funktionen in der DLL aufruft.</span><span class="sxs-lookup"><span data-stu-id="34fc8-113">You can require applications to call the initialization function after DllMain has run and before they call any other functions in the DLL.</span></span>

 

## <a name="syntax"></a><span data-ttu-id="34fc8-114">Syntax</span><span class="sxs-lookup"><span data-stu-id="34fc8-114">Syntax</span></span>


```C++
BOOL WINAPI DllMain(
  _In_ HINSTANCE hinstDLL,
  _In_ DWORD     fdwReason,
  _In_ LPVOID    lpvReserved
);
```



## <a name="parameters"></a><span data-ttu-id="34fc8-115">Parameter</span><span class="sxs-lookup"><span data-stu-id="34fc8-115">Parameters</span></span>

<dl> <dt>

<span data-ttu-id="34fc8-116">*hinstDll* \[ in\]</span><span class="sxs-lookup"><span data-stu-id="34fc8-116">*hinstDLL* \[in\]</span></span>
</dt> <dd>

<span data-ttu-id="34fc8-117">Ein Handle für das dll-Modul.</span><span class="sxs-lookup"><span data-stu-id="34fc8-117">A handle to the DLL module.</span></span> <span data-ttu-id="34fc8-118">Der Wert ist die Basisadresse der dll.</span><span class="sxs-lookup"><span data-stu-id="34fc8-118">The value is the base address of the DLL.</span></span> <span data-ttu-id="34fc8-119">Die **HINSTANCE** einer dll ist mit dem **HMODULE** der dll identisch, sodass *hinstDll* in Aufrufen von Funktionen verwendet werden kann, die ein Modul handle erfordern.</span><span class="sxs-lookup"><span data-stu-id="34fc8-119">The **HINSTANCE** of a DLL is the same as the **HMODULE** of the DLL, so *hinstDLL* can be used in calls to functions that require a module handle.</span></span>

</dd> <dt>

<span data-ttu-id="34fc8-120">*Grundursache* \[ in\]</span><span class="sxs-lookup"><span data-stu-id="34fc8-120">*fdwReason* \[in\]</span></span>
</dt> <dd>

<span data-ttu-id="34fc8-121">Der Ursachen Code, der angibt, warum die DLL-Einstiegspunkt Funktion aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="34fc8-121">The reason code that indicates why the DLL entry-point function is being called.</span></span> <span data-ttu-id="34fc8-122">Dieser Parameter kann einen der folgenden Werte annehmen.</span><span class="sxs-lookup"><span data-stu-id="34fc8-122">This parameter can be one of the following values.</span></span>



| <span data-ttu-id="34fc8-123">Wert</span><span class="sxs-lookup"><span data-stu-id="34fc8-123">Value</span></span>                                                                                                                                                                                                                                | <span data-ttu-id="34fc8-124">Bedeutung</span><span class="sxs-lookup"><span data-stu-id="34fc8-124">Meaning</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="DLL_PROCESS_ATTACH"></span><span id="dll_process_attach"></span><dl> <span data-ttu-id="34fc8-125"><dt>**Dll \_ Prozess \_ Anfügen**</dt> <dt>1</dt></span><span class="sxs-lookup"><span data-stu-id="34fc8-125"><dt>**DLL\_PROCESS\_ATTACH**</dt> <dt>1</dt></span></span> </dl> | <span data-ttu-id="34fc8-126">Die dll wird in den virtuellen Adressraum des aktuellen Prozesses als Ergebnis des Startvorgangs oder als Ergebnis eines Aufrufes von [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya)geladen.</span><span class="sxs-lookup"><span data-stu-id="34fc8-126">The DLL is being loaded into the virtual address space of the current process as a result of the process starting up or as a result of a call to [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya).</span></span> <span data-ttu-id="34fc8-127">DLLs können diese Gelegenheit nutzen, um beliebige Instanzdaten zu initialisieren oder die [**TlsAlloc**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-tlsalloc) -Funktion zu verwenden, um einen Thread lokalen Speicher (TLS)-Index zuzuordnen.</span><span class="sxs-lookup"><span data-stu-id="34fc8-127">DLLs can use this opportunity to initialize any instance data or to use the [**TlsAlloc**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-tlsalloc) function to allocate a thread local storage (TLS) index.</span></span><br/> <span data-ttu-id="34fc8-128">Der *lbeibehaltene* Parameter gibt an, ob die DLL statisch oder dynamisch geladen wird.</span><span class="sxs-lookup"><span data-stu-id="34fc8-128">The *lpReserved* parameter indicates whether the DLL is being loaded statically or dynamically.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <span id="DLL_PROCESS_DETACH"></span><span id="dll_process_detach"></span><dl> <span data-ttu-id="34fc8-129"><dt>**Dll \_ Prozess \_**</dt> Trennung <dt>0</dt></span><span class="sxs-lookup"><span data-stu-id="34fc8-129"><dt>**DLL\_PROCESS\_DETACH**</dt> <dt>0</dt></span></span> </dl> | <span data-ttu-id="34fc8-130">Die dll wird aus dem virtuellen Adressraum des aufrufenden Prozesses entladen, weil Sie nicht erfolgreich geladen wurde oder der Verweis Zähler Null erreicht hat (die Prozesse wurden entweder für jedes Mal, wenn Sie [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya)aufgerufen haben, entweder beendet oder als " [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) " bezeichnet).</span><span class="sxs-lookup"><span data-stu-id="34fc8-130">The DLL is being unloaded from the virtual address space of the calling process because it was loaded unsuccessfully or the reference count has reached zero (the processes has either terminated or called [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) one time for each time it called [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya)).</span></span><br/> <span data-ttu-id="34fc8-131">Der *lbeibehaltene* Parameter gibt an, ob die dll aufgrund eines [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) -Aufrufes, eines Fehlers beim Laden oder eines Prozess Beendens entladen wird.</span><span class="sxs-lookup"><span data-stu-id="34fc8-131">The *lpReserved* parameter indicates whether the DLL is being unloaded as a result of a [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) call, a failure to load, or process termination.</span></span><br/> <span data-ttu-id="34fc8-132">Die dll kann diese Möglichkeit zum Abrufen der [**TlsFree**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-tlsfree) -Funktion verwenden, um alle TLS-Indizes freizugeben, die mithilfe von [**TlsAlloc**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-tlsalloc) zugeordnet werden, und um beliebige Thread lokale Daten freizugeben.</span><span class="sxs-lookup"><span data-stu-id="34fc8-132">The DLL can use this opportunity to call the [**TlsFree**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-tlsfree) function to free any TLS indices allocated by using [**TlsAlloc**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-tlsalloc) and to free any thread local data.</span></span><br/> <span data-ttu-id="34fc8-133">Beachten Sie, dass der Thread, der die **dll- \_ Prozess \_** Trennungs Benachrichtigung empfängt, nicht notwendigerweise derselbe Thread ist, der die **dll- \_ Prozess \_ Anfüge** Benachrichtigung empfangen hat.</span><span class="sxs-lookup"><span data-stu-id="34fc8-133">Note that the thread that receives the **DLL\_PROCESS\_DETACH** notification is not necessarily the same thread that received the **DLL\_PROCESS\_ATTACH** notification.</span></span><br/> |
| <span id="DLL_THREAD_ATTACH"></span><span id="dll_thread_attach"></span><dl> <span data-ttu-id="34fc8-134"><dt>**Dll \_ Thread \_ Anfügen**</dt> <dt>2</dt></span><span class="sxs-lookup"><span data-stu-id="34fc8-134"><dt>**DLL\_THREAD\_ATTACH**</dt> <dt>2</dt></span></span> </dl>    | <span data-ttu-id="34fc8-135">Beim aktuellen Prozess wird ein neuer Thread erstellt.</span><span class="sxs-lookup"><span data-stu-id="34fc8-135">The current process is creating a new thread.</span></span> <span data-ttu-id="34fc8-136">Wenn dies auftritt, ruft das System die Einstiegspunkt Funktion aller DLLs auf, die derzeit an den Prozess angefügt sind.</span><span class="sxs-lookup"><span data-stu-id="34fc8-136">When this occurs, the system calls the entry-point function of all DLLs currently attached to the process.</span></span> <span data-ttu-id="34fc8-137">Der-Rückruf erfolgt im Kontext des neuen Threads.</span><span class="sxs-lookup"><span data-stu-id="34fc8-137">The call is made in the context of the new thread.</span></span> <span data-ttu-id="34fc8-138">DLLs können diese Gelegenheit nutzen, um einen TLS-Slot für den Thread zu initialisieren.</span><span class="sxs-lookup"><span data-stu-id="34fc8-138">DLLs can use this opportunity to initialize a TLS slot for the thread.</span></span> <span data-ttu-id="34fc8-139">Ein Thread, der die DLL-Einstiegspunkt Funktion mit **dll- \_ Prozess \_ Anfügen** aufruft, ruft die DLL-Einstiegspunkt Funktion nicht mit **dll- \_ Thread \_ Anfügen** auf.</span><span class="sxs-lookup"><span data-stu-id="34fc8-139">A thread calling the DLL entry-point function with **DLL\_PROCESS\_ATTACH** does not call the DLL entry-point function with **DLL\_THREAD\_ATTACH**.</span></span> <br/> <span data-ttu-id="34fc8-140">Beachten Sie, dass die Einstiegspunkt Funktion einer DLL mit diesem Wert nur von Threads aufgerufen wird, die nach dem Laden der dll durch den Prozess erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="34fc8-140">Note that a DLL's entry-point function is called with this value only by threads created after the DLL is loaded by the process.</span></span> <span data-ttu-id="34fc8-141">Wenn eine DLL mit [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya)geladen wird, wird die Einstiegspunkt Funktion der neu geladenen DLL von vorhandenen Threads nicht aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="34fc8-141">When a DLL is loaded using [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya), existing threads do not call the entry-point function of the newly loaded DLL.</span></span><br/>                                                                                                                                                                       |
| <span id="DLL_THREAD_DETACH"></span><span id="dll_thread_detach"></span><dl> <span data-ttu-id="34fc8-142"><dt>**Dll \_ Thread \_**</dt> Trennung <dt>3</dt></span><span class="sxs-lookup"><span data-stu-id="34fc8-142"><dt>**DLL\_THREAD\_DETACH**</dt> <dt>3</dt></span></span> </dl>    | <span data-ttu-id="34fc8-143">Ein Thread wird ordnungsgemäß beendet.</span><span class="sxs-lookup"><span data-stu-id="34fc8-143">A thread is exiting cleanly.</span></span> <span data-ttu-id="34fc8-144">Wenn die dll einen Zeiger auf den zugeordneten Speicher in einem TLS-Slot gespeichert hat, sollte diese Gelegenheit genutzt werden, um den Arbeitsspeicher freizugeben.</span><span class="sxs-lookup"><span data-stu-id="34fc8-144">If the DLL has stored a pointer to allocated memory in a TLS slot, it should use this opportunity to free the memory.</span></span> <span data-ttu-id="34fc8-145">Das System ruft die Einstiegspunkt Funktion aller aktuell geladenen DLLs mit diesem Wert auf.</span><span class="sxs-lookup"><span data-stu-id="34fc8-145">The system calls the entry-point function of all currently loaded DLLs with this value.</span></span> <span data-ttu-id="34fc8-146">Der-Befehl wird im Kontext des enden Threads durchgeführt.</span><span class="sxs-lookup"><span data-stu-id="34fc8-146">The call is made in the context of the exiting thread.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |



 

</dd> <dt>

<span data-ttu-id="34fc8-147">*lpvreserved* \[ in\]</span><span class="sxs-lookup"><span data-stu-id="34fc8-147">*lpvReserved* \[in\]</span></span>
</dt> <dd>

<span data-ttu-id="34fc8-148">Wenn *fdwreason* **dll- \_ Prozess \_ Anfügen** ist, ist *lpvreserved* bei dynamischen Ladevorgängen **null** und ungleich NULL für statische Ladevorgänge.</span><span class="sxs-lookup"><span data-stu-id="34fc8-148">If *fdwReason* is **DLL\_PROCESS\_ATTACH**, *lpvReserved* is **NULL** for dynamic loads and non-NULL for static loads.</span></span>

<span data-ttu-id="34fc8-149">Wenn *fdwreason* eine **dll- \_ Prozess \_** Trennung ist, ist *lpvreserved* **null** , wenn " [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) " aufgerufen wurde oder wenn der dll-Ladevorgang fehlgeschlagen ist und nicht **null** ist, wenn der Prozess beendet wird.</span><span class="sxs-lookup"><span data-stu-id="34fc8-149">If *fdwReason* is **DLL\_PROCESS\_DETACH**, *lpvReserved* is **NULL** if [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) has been called or the DLL load failed and non-**NULL** if the process is terminating.</span></span>

</dd> </dl>

## <a name="return-value"></a><span data-ttu-id="34fc8-150">Rückgabewert</span><span class="sxs-lookup"><span data-stu-id="34fc8-150">Return value</span></span>

<span data-ttu-id="34fc8-151">Wenn das System die **DllMain** -Funktion mit dem **\_ \_ Anfüge** Wert des dll-Prozesses aufruft, gibt die Funktion **true** zurück, wenn Sie erfolgreich ist oder **false** , wenn die Initialisierung fehlschlägt.</span><span class="sxs-lookup"><span data-stu-id="34fc8-151">When the system calls the **DllMain** function with the **DLL\_PROCESS\_ATTACH** value, the function returns **TRUE** if it succeeds or **FALSE** if initialization fails.</span></span> <span data-ttu-id="34fc8-152">Wenn der Rückgabewert **false** ist, wenn **DllMain** aufgerufen wird, da der Prozess die [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) -Funktion verwendet, gibt **LoadLibrary** NULL zurück.</span><span class="sxs-lookup"><span data-stu-id="34fc8-152">If the return value is **FALSE** when **DllMain** is called because the process uses the [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) function, **LoadLibrary** returns NULL.</span></span> <span data-ttu-id="34fc8-153">(Das System ruft sofort die Einstiegspunkt Funktion mit dem **dll \_ - \_ Prozess** ab und entlädt die dll.) Wenn der Rückgabewert **false** ist, wenn **DllMain** während der Prozess Initialisierung aufgerufen wird, wird der Prozess mit einem Fehler beendet.</span><span class="sxs-lookup"><span data-stu-id="34fc8-153">(The system immediately calls your entry-point function with **DLL\_PROCESS\_DETACH** and unloads the DLL.) If the return value is **FALSE** when **DllMain** is called during process initialization, the process terminates with an error.</span></span> <span data-ttu-id="34fc8-154">Um erweiterte Fehlerinformationen zu erhalten, rufen Sie [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) auf.</span><span class="sxs-lookup"><span data-stu-id="34fc8-154">To get extended error information, call [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror).</span></span>

<span data-ttu-id="34fc8-155">Wenn das System die **DllMain** -Funktion mit einem anderen Wert als dem **dll- \_ Prozess \_ Anfügen** aufruft, wird der Rückgabewert ignoriert.</span><span class="sxs-lookup"><span data-stu-id="34fc8-155">When the system calls the **DllMain** function with any value other than **DLL\_PROCESS\_ATTACH**, the return value is ignored.</span></span>

## <a name="remarks"></a><span data-ttu-id="34fc8-156">Bemerkungen</span><span class="sxs-lookup"><span data-stu-id="34fc8-156">Remarks</span></span>

<span data-ttu-id="34fc8-157">**DllMain** ist ein Platzhalter für den Namen der Bibliothek definierten Funktion.</span><span class="sxs-lookup"><span data-stu-id="34fc8-157">**DllMain** is a placeholder for the library-defined function name.</span></span> <span data-ttu-id="34fc8-158">Sie müssen den tatsächlichen Namen angeben, den Sie beim Erstellen der DLL verwenden.</span><span class="sxs-lookup"><span data-stu-id="34fc8-158">You must specify the actual name you use when you build your DLL.</span></span> <span data-ttu-id="34fc8-159">Weitere Informationen finden Sie in der Dokumentation, die in ihren Entwicklungs Tools enthalten ist.</span><span class="sxs-lookup"><span data-stu-id="34fc8-159">For more information, see the documentation included with your development tools.</span></span>

<span data-ttu-id="34fc8-160">Während des anfänglichen Prozess Starts oder nach einem [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya)-Aufrufvorgang scannt das System die Liste der geladenen DLLs für den Prozess.</span><span class="sxs-lookup"><span data-stu-id="34fc8-160">During initial process startup or after a call to [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya), the system scans the list of loaded DLLs for the process.</span></span> <span data-ttu-id="34fc8-161">Für jede DLL, die nicht bereits mit dem **\_ \_ Anfüge** Wert des dll-Prozesses aufgerufen wurde, ruft das System die Einstiegspunkt Funktion der dll auf.</span><span class="sxs-lookup"><span data-stu-id="34fc8-161">For each DLL that has not already been called with the **DLL\_PROCESS\_ATTACH** value, the system calls the DLL's entry-point function.</span></span> <span data-ttu-id="34fc8-162">Dieser Aufruf erfolgt im Kontext des Threads, der bewirkt hat, dass sich der Prozess Adressraum geändert hat, z. b. der primäre Thread des Prozesses oder der Thread, der **LoadLibrary** aufgerufen hat.</span><span class="sxs-lookup"><span data-stu-id="34fc8-162">This call is made in the context of the thread that caused the process address space to change, such as the primary thread of the process or the thread that called **LoadLibrary**.</span></span> <span data-ttu-id="34fc8-163">Der Zugriff auf den Einstiegspunkt wird vom System Prozess weit serialisiert.</span><span class="sxs-lookup"><span data-stu-id="34fc8-163">Access to the entry point is serialized by the system on a process-wide basis.</span></span> <span data-ttu-id="34fc8-164">Threads in *DllMain* enthalten die Loadersperre, sodass keine weiteren DLLs dynamisch geladen oder initialisiert werden können.</span><span class="sxs-lookup"><span data-stu-id="34fc8-164">Threads in *DllMain* hold the loader lock so no additional DLLs can be dynamically loaded or initialized.</span></span>

<span data-ttu-id="34fc8-165">Wenn die Einstiegspunkt Funktion der DLL nach einer **dll- \_ Prozess \_ Anfüge** Benachrichtigung false zurückgibt, empfängt Sie eine **dll- \_ Prozess \_** Trennungs Benachrichtigung, und die dll wird sofort entladen.</span><span class="sxs-lookup"><span data-stu-id="34fc8-165">If the DLL's entry-point function returns FALSE following a **DLL\_PROCESS\_ATTACH** notification, it receives a **DLL\_PROCESS\_DETACH** notification and the DLL is unloaded immediately.</span></span> <span data-ttu-id="34fc8-166">Wenn jedoch der **dll- \_ Prozess \_ Anfüge** Code eine Ausnahme auslöst, empfängt die Einstiegspunkt Funktion nicht die **dll- \_ Prozess- \_ detachbenachrichtigung** .</span><span class="sxs-lookup"><span data-stu-id="34fc8-166">However, if the **DLL\_PROCESS\_ATTACH** code throws an exception, the entry-point function will not receive the **DLL\_PROCESS\_DETACH** notification.</span></span>

<span data-ttu-id="34fc8-167">Es gibt Fälle, in denen die Einstiegspunkt Funktion für einen abschließenden Thread aufgerufen wird, auch wenn die Einstiegspunkt Funktion nie mit dem **dll- \_ Thread \_ Attach** für den Thread aufgerufen wurde:</span><span class="sxs-lookup"><span data-stu-id="34fc8-167">There are cases in which the entry-point function is called for a terminating thread even if the entry-point function was never called with **DLL\_THREAD\_ATTACH** for the thread:</span></span>

-   <span data-ttu-id="34fc8-168">Der Thread war der erste Thread im Prozess, sodass das System die Einstiegspunkt Funktion mit dem **\_ \_ Anfüge** Wert des dll-Prozesses aufgerufen hat.</span><span class="sxs-lookup"><span data-stu-id="34fc8-168">The thread was the initial thread in the process, so the system called the entry-point function with the **DLL\_PROCESS\_ATTACH** value.</span></span>
-   <span data-ttu-id="34fc8-169">Der Thread wurde bereits ausgeführt, als ein Aufruf der [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) -Funktion erfolgt ist, sodass das System nie die Einstiegspunkt Funktion aufgerufen hat.</span><span class="sxs-lookup"><span data-stu-id="34fc8-169">The thread was already running when a call to the [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) function was made, so the system never called the entry-point function for it.</span></span>

<span data-ttu-id="34fc8-170">Wenn eine DLL aus einem Prozess aufgrund einer nicht erfolgreichen Last der dll, Beendigung des Prozesses oder eines Aufrufs von " [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary)" entladen wird, ruft das System die Einstiegspunkt Funktion der dll nicht mit dem **dll- \_ Thread \_** Trennungs Wert für die einzelnen Threads des Prozesses auf.</span><span class="sxs-lookup"><span data-stu-id="34fc8-170">When a DLL is unloaded from a process as a result of an unsuccessful load of the DLL, termination of the process, or a call to [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary), the system does not call the DLL's entry-point function with the **DLL\_THREAD\_DETACH** value for the individual threads of the process.</span></span> <span data-ttu-id="34fc8-171">Der dll wird nur eine **dll- \_ Prozess- \_ Detach** -Benachrichtigung gesendet.</span><span class="sxs-lookup"><span data-stu-id="34fc8-171">The DLL is only sent a **DLL\_PROCESS\_DETACH** notification.</span></span> <span data-ttu-id="34fc8-172">DLLs können diese Gelegenheit nutzen, um alle Ressourcen für alle Threads zu bereinigen, die der dll bekannt sind.</span><span class="sxs-lookup"><span data-stu-id="34fc8-172">DLLs can take this opportunity to clean up all resources for all threads known to the DLL.</span></span>

<span data-ttu-id="34fc8-173">Wenn die DLL- **Prozess Trennung behandelt \_ \_** wird, sollte eine DLL Ressourcen wie z. b. Heap Speicher nur dann freigeben, wenn die DLL dynamisch entladen wird (der *lbeibehaltene* Parameter ist **null**).</span><span class="sxs-lookup"><span data-stu-id="34fc8-173">When handling **DLL\_PROCESS\_DETACH**, a DLL should free resources such as heap memory only if the DLL is being unloaded dynamically (the *lpReserved* parameter is **NULL**).</span></span> <span data-ttu-id="34fc8-174">Wenn der Prozess beendet wird (der *lpvreserved* -Parameter ist nicht **null**), werden alle Threads im Prozess, außer dem aktuellen Thread, entweder bereits beendet oder durch einen Aufrufen der [**ExitProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-exitprocess) -Funktion explizit beendet, was einige Prozess Ressourcen wie Heaps in einem inkonsistenten Zustand belassen kann.</span><span class="sxs-lookup"><span data-stu-id="34fc8-174">If the process is terminating (the *lpvReserved* parameter is non-**NULL**), all threads in the process except the current thread either have exited already or have been explicitly terminated by a call to the [**ExitProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-exitprocess) function, which might leave some process resources such as heaps in an inconsistent state.</span></span> <span data-ttu-id="34fc8-175">In diesem Fall ist es nicht sicher, dass die dll die Ressourcen bereinigen kann.</span><span class="sxs-lookup"><span data-stu-id="34fc8-175">In this case, it is not safe for the DLL to clean up the resources.</span></span> <span data-ttu-id="34fc8-176">Stattdessen sollte die dll dem Betriebssystem ermöglichen, den Speicher freizugeben.</span><span class="sxs-lookup"><span data-stu-id="34fc8-176">Instead, the DLL should allow the operating system to reclaim the memory.</span></span>

<span data-ttu-id="34fc8-177">Wenn Sie einen Prozess beenden, indem Sie [**TerminateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-terminateprocess) oder [**terminatejobobject**](/windows/desktop/api/jobapi2/nf-jobapi2-terminatejobobject)aufrufen, empfangen die DLLs dieses Prozesses keine **dll- \_ Prozess \_** Trennungs Benachrichtigungen.</span><span class="sxs-lookup"><span data-stu-id="34fc8-177">If you terminate a process by calling [**TerminateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-terminateprocess) or [**TerminateJobObject**](/windows/desktop/api/jobapi2/nf-jobapi2-terminatejobobject), the DLLs of that process do not receive **DLL\_PROCESS\_DETACH** notifications.</span></span> <span data-ttu-id="34fc8-178">Wenn Sie einen Thread beenden, indem Sie [**TerminateThread**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-terminatethread)aufrufen, empfangen die DLLs dieses Threads keine **dll- \_ Thread \_** Trennungs Benachrichtigungen.</span><span class="sxs-lookup"><span data-stu-id="34fc8-178">If you terminate a thread by calling [**TerminateThread**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-terminatethread), the DLLs of that thread do not receive **DLL\_THREAD\_DETACH** notifications.</span></span>

<span data-ttu-id="34fc8-179">Die Einstiegspunkt Funktion sollte nur einfache Initialisierungs-oder Beendigungs Aufgaben ausführen.</span><span class="sxs-lookup"><span data-stu-id="34fc8-179">The entry-point function should perform only simple initialization or termination tasks.</span></span> <span data-ttu-id="34fc8-180">Die [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) -Funktion oder die [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) -Funktion (oder eine Funktion, die diese Funktionen aufruft) darf nicht aufgerufen werden, da dadurch Abhängigkeits Schleifen in der dll-Lade Reihenfolge erstellt werden können.</span><span class="sxs-lookup"><span data-stu-id="34fc8-180">It must not call the [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) function (or a function that calls these functions), because this may create dependency loops in the DLL load order.</span></span> <span data-ttu-id="34fc8-181">Dies kann dazu führen, dass eine DLL verwendet wird, bevor das System den Initialisierungs Code ausgeführt hat.</span><span class="sxs-lookup"><span data-stu-id="34fc8-181">This can result in a DLL being used before the system has executed its initialization code.</span></span> <span data-ttu-id="34fc8-182">Ebenso darf die Einstiegspunkt Funktion die [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) -Funktion (oder eine Funktion, die **FreeLibrary** aufruft) während der Prozess Beendigung nicht aufrufen, da dies dazu führen kann, dass eine DLL verwendet wird, nachdem das System den Beendigungs Code ausgeführt hat.</span><span class="sxs-lookup"><span data-stu-id="34fc8-182">Similarly, the entry-point function must not call the [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) function (or a function that calls **FreeLibrary**) during process termination, because this can result in a DLL being used after the system has executed its termination code.</span></span>

<span data-ttu-id="34fc8-183">Da Kernel32.dll im Prozess Adressraum garantiert geladen wird, wenn die Einstiegspunkt Funktion aufgerufen wird, führt das Aufrufen von Funktionen in Kernel32.dll nicht dazu, dass die dll verwendet wird, bevor Ihr Initialisierungs Code ausgeführt wurde.</span><span class="sxs-lookup"><span data-stu-id="34fc8-183">Because Kernel32.dll is guaranteed to be loaded in the process address space when the entry-point function is called, calling functions in Kernel32.dll does not result in the DLL being used before its initialization code has been executed.</span></span> <span data-ttu-id="34fc8-184">Daher kann die Einstiegspunkt Funktion Funktionen in Kernel32.dll aufzurufen, die keine anderen DLLs laden.</span><span class="sxs-lookup"><span data-stu-id="34fc8-184">Therefore, the entry-point function can call functions in Kernel32.dll that do not load other DLLs.</span></span> <span data-ttu-id="34fc8-185">*DllMain* kann z. b. [Synchronisierungs Objekte](/windows/desktop/Sync/synchronization-objects) erstellen, z. b. kritische Abschnitte und Mutexen, und TLS verwenden.</span><span class="sxs-lookup"><span data-stu-id="34fc8-185">For example, *DllMain* can create [synchronization objects](/windows/desktop/Sync/synchronization-objects) such as critical sections and mutexes, and use TLS.</span></span> <span data-ttu-id="34fc8-186">Leider gibt es keine umfassende Liste der sicheren Funktionen in Kernel32.dll.</span><span class="sxs-lookup"><span data-stu-id="34fc8-186">Unfortunately, there is not a comprehensive list of safe functions in Kernel32.dll.</span></span>

<span data-ttu-id="34fc8-187">Das Aufrufen von Funktionen, die andere DLLs als Kernel32.dll erfordern, kann zu Problemen führen, die schwer zu diagnostizieren sind.</span><span class="sxs-lookup"><span data-stu-id="34fc8-187">Calling functions that require DLLs other than Kernel32.dll may result in problems that are difficult to diagnose.</span></span> <span data-ttu-id="34fc8-188">Das Aufrufen von Benutzer-, Shell-und com-Funktionen kann z. b. zu Zugriffs Verletzungs Fehlern führen, da einige Funktionen andere Systemkomponenten laden.</span><span class="sxs-lookup"><span data-stu-id="34fc8-188">For example, calling User, Shell, and COM functions can cause access violation errors, because some functions load other system components.</span></span> <span data-ttu-id="34fc8-189">Umgekehrt kann das Aufrufen von Funktionen wie diesen während der Beendigung zu Zugriffs Verletzungs Fehlern führen, da die entsprechende Komponente möglicherweise bereits entladen oder nicht initialisiert wurde.</span><span class="sxs-lookup"><span data-stu-id="34fc8-189">Conversely, calling functions such as these during termination can cause access violation errors because the corresponding component may already have been unloaded or uninitialized.</span></span>

<span data-ttu-id="34fc8-190">Da dll-Benachrichtigungen serialisiert werden, sollten die Einstiegspunkt Funktionen nicht versuchen, mit anderen Threads oder Prozessen zu kommunizieren.</span><span class="sxs-lookup"><span data-stu-id="34fc8-190">Because DLL notifications are serialized, entry-point functions should not attempt to communicate with other threads or processes.</span></span> <span data-ttu-id="34fc8-191">Deadlocks können als Ergebnis auftreten.</span><span class="sxs-lookup"><span data-stu-id="34fc8-191">Deadlocks may occur as a result.</span></span>

<span data-ttu-id="34fc8-192">Informationen zu bewährten Methoden beim Schreiben einer DLL finden Sie unter https://docs.microsoft.com/windows/win32/dlls/dynamic-link-library-best-practices .</span><span class="sxs-lookup"><span data-stu-id="34fc8-192">For information on best practices when writing a DLL, see https://docs.microsoft.com/windows/win32/dlls/dynamic-link-library-best-practices.</span></span>

<span data-ttu-id="34fc8-193">Wenn die DLL mit der C-Lauf Zeit Bibliothek (CRT) verknüpft ist, ruft der von der CRT bereitgestellte Einstiegspunkt die Konstruktoren und Dekonstruktoren für globale und statische C++-Objekte auf.</span><span class="sxs-lookup"><span data-stu-id="34fc8-193">If your DLL is linked with the C run-time library (CRT), the entry point provided by the CRT calls the constructors and destructors for global and static C++ objects.</span></span> <span data-ttu-id="34fc8-194">Daher gelten diese Einschränkungen für *DllMain* auch für Konstruktoren und decoditoren und sämtlicher Code, der von Ihnen aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="34fc8-194">Therefore, these restrictions for *DllMain* also apply to constructors and destructors and any code that is called from them.</span></span>

<span data-ttu-id="34fc8-195">Wenn die dll nicht mit der statischen C-Lauf Zeit Bibliothek (CRT) verknüpft **ist, sollten \_ \_** Sie den Aufruf von [**DisableThreadLibraryCalls**](/windows/win32/api/libloaderapi/nf-libloaderapi-disablethreadlibrarycalls) in Erwägung erhalten.</span><span class="sxs-lookup"><span data-stu-id="34fc8-195">Consider calling [**DisableThreadLibraryCalls**](/windows/win32/api/libloaderapi/nf-libloaderapi-disablethreadlibrarycalls) when receiving **DLL\_PROCESS\_ATTACH**, unless your DLL is linked with static C run-time library (CRT).</span></span>


## <a name="requirements"></a><span data-ttu-id="34fc8-196">Anforderungen</span><span class="sxs-lookup"><span data-stu-id="34fc8-196">Requirements</span></span>



| <span data-ttu-id="34fc8-197">Anforderung</span><span class="sxs-lookup"><span data-stu-id="34fc8-197">Requirement</span></span> | <span data-ttu-id="34fc8-198">Wert</span><span class="sxs-lookup"><span data-stu-id="34fc8-198">Value</span></span> |
|-------------------------------------|--------------------------------------------------------------------------------------|
| <span data-ttu-id="34fc8-199">Unterstützte Mindestversion (Client)</span><span class="sxs-lookup"><span data-stu-id="34fc8-199">Minimum supported client</span></span><br/> | <span data-ttu-id="34fc8-200">Nur Windows XP \[ -Desktop-Apps\]</span><span class="sxs-lookup"><span data-stu-id="34fc8-200">Windows XP \[desktop apps only\]</span></span><br/>                                          |
| <span data-ttu-id="34fc8-201">Unterstützte Mindestversion (Server)</span><span class="sxs-lookup"><span data-stu-id="34fc8-201">Minimum supported server</span></span><br/> | <span data-ttu-id="34fc8-202">Nur Windows Server 2003 \[ -Desktop-Apps\]</span><span class="sxs-lookup"><span data-stu-id="34fc8-202">Windows Server 2003 \[desktop apps only\]</span></span><br/>                                 |
| <span data-ttu-id="34fc8-203">Header</span><span class="sxs-lookup"><span data-stu-id="34fc8-203">Header</span></span><br/>                   | <dl> <span data-ttu-id="34fc8-204"><dt>Process. h</dt></span><span class="sxs-lookup"><span data-stu-id="34fc8-204"><dt>Process.h</dt></span></span> </dl> |



## <a name="see-also"></a><span data-ttu-id="34fc8-205">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="34fc8-205">See also</span></span>

<dl> <dt>

[<span data-ttu-id="34fc8-206">Dynamic-Link Library Entry-Point-Funktion</span><span class="sxs-lookup"><span data-stu-id="34fc8-206">Dynamic-Link Library Entry-Point Function</span></span>](dynamic-link-library-entry-point-function.md)
</dt> <dt>

[<span data-ttu-id="34fc8-207">Dynamic Link Library-Funktionen</span><span class="sxs-lookup"><span data-stu-id="34fc8-207">Dynamic-Link Library Functions</span></span>](dynamic-link-library-functions.md)
</dt> <dt>

[<span data-ttu-id="34fc8-208">**FreeLibrary**</span><span class="sxs-lookup"><span data-stu-id="34fc8-208">**FreeLibrary**</span></span>](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary)
</dt> <dt>

[<span data-ttu-id="34fc8-209">**Fehler bei GetModuleFileName**</span><span class="sxs-lookup"><span data-stu-id="34fc8-209">**GetModuleFileName**</span></span>](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulefilenamea)
</dt> <dt>

[<span data-ttu-id="34fc8-210">**LoadLibrary**</span><span class="sxs-lookup"><span data-stu-id="34fc8-210">**LoadLibrary**</span></span>](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya)
</dt> <dt>

[<span data-ttu-id="34fc8-211">**TlsAlloc**</span><span class="sxs-lookup"><span data-stu-id="34fc8-211">**TlsAlloc**</span></span>](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-tlsalloc)
</dt> <dt>

[<span data-ttu-id="34fc8-212">**TlsFree**</span><span class="sxs-lookup"><span data-stu-id="34fc8-212">**TlsFree**</span></span>](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-tlsfree)
</dt> <dt>

[<span data-ttu-id="34fc8-213">**DisableThreadLibraryCalls**</span><span class="sxs-lookup"><span data-stu-id="34fc8-213">**DisableThreadLibraryCalls**</span></span>](/windows/win32/api/libloaderapi/nf-libloaderapi-disablethreadlibrarycalls)





</dt> </dl>
