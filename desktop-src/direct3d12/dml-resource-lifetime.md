---
title: Ressourcenlebensdauer und -synchronisierung
description: Um ein nicht definiertes Verhalten zu vermeiden, muss Ihre directml-Anwendung die Objekt Lebensdauer und Synchronisierung zwischen der CPU und der GPU ordnungsgemäß verwalten.
ms.custom: Windows 10 May 2019 Update
ms.localizationpriority: high
ms.topic: article
ms.date: 04/19/2019
ms.openlocfilehash: 6e8ab30c5c87c135ef3bdac0c1bc2a3d64040787
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/16/2019
ms.locfileid: "74103569"
---
# <a name="resource-lifetime-and-synchronization"></a><span data-ttu-id="93fe4-103">Ressourcenlebensdauer und -synchronisierung</span><span class="sxs-lookup"><span data-stu-id="93fe4-103">Resource lifetime and synchronization</span></span>

<span data-ttu-id="93fe4-104">Ebenso wie bei Direct3D 12 muss Ihre directml-Anwendung (um ein nicht definiertes Verhalten zu vermeiden) die Objekt Lebensdauer und die Synchronisierung zwischen der CPU und der GPU ordnungsgemäß verwalten.</span><span class="sxs-lookup"><span data-stu-id="93fe4-104">Just as with Direct3D 12, your DirectML application must (in order to avoid undefined behavior) correctly manage object lifetimes and synchronization between the CPU and the GPU.</span></span> <span data-ttu-id="93fe4-105">Directml folgt einem identischen Modell für die Ressourcen Lebensdauer wie Direct3D 12.</span><span class="sxs-lookup"><span data-stu-id="93fe4-105">DirectML follows an identical resource lifetime model to that of Direct3D 12.</span></span>

- <span data-ttu-id="93fe4-106">Lebensdauer Abhängigkeiten zwischen zwei CPU-Objekten werden von directml mithilfe starker Verweis Zähler verwaltet.</span><span class="sxs-lookup"><span data-stu-id="93fe4-106">Lifetime dependencies between two CPU objects are maintained by DirectML using strong reference counts.</span></span> <span data-ttu-id="93fe4-107">Ihre Anwendung muss die Abhängigkeiten der CPU-Lebensdauer nicht manuell verwalten.</span><span class="sxs-lookup"><span data-stu-id="93fe4-107">Your application needn't manually manage CPU lifetime dependencies.</span></span> <span data-ttu-id="93fe4-108">Beispielsweise enthält jedes untergeordnete Gerät einen starken Verweis auf das übergeordnete Gerät.</span><span class="sxs-lookup"><span data-stu-id="93fe4-108">For example, every device child holds a strong reference to its parent device.</span></span>
- <span data-ttu-id="93fe4-109">Lebensdauer Abhängigkeiten zwischen GPU &mdash; -Objekten oder Abhängigkeiten, die über CPU und GPU spannen, werden &mdash; nicht automatisch verwaltet.</span><span class="sxs-lookup"><span data-stu-id="93fe4-109">Lifetime dependencies between GPU objects&mdash;or dependencies that span across CPU and GPU&mdash;aren't automatically managed.</span></span> <span data-ttu-id="93fe4-110">Es ist Aufgabe Ihrer Anwendung, sicherzustellen, dass GPU-Ressourcen zumindest so lange aktiv sind, bis die gesamte Arbeit, die diese Ressource verwendet, die Ausführung auf der GPU abgeschlossen hat</span><span class="sxs-lookup"><span data-stu-id="93fe4-110">It's your application's responsibility to ensure that GPU resources live at least until all work using that resource has completed execution on the GPU.</span></span>

## <a name="directml-devices"></a><span data-ttu-id="93fe4-111">Directml-Geräte</span><span class="sxs-lookup"><span data-stu-id="93fe4-111">DirectML devices</span></span>

<span data-ttu-id="93fe4-112">Das directml-Gerät ist ein Thread sicheres Zustands Loses Factoryobjekt.</span><span class="sxs-lookup"><span data-stu-id="93fe4-112">The DirectML device is a thread-safe stateless factory object.</span></span> <span data-ttu-id="93fe4-113">Jedes untergeordnete Gerät (siehe [**idmldevicechild**](/windows/desktop/api/directml/nn-directml-idmldevicechild)) enthält einen starken Verweis auf das übergeordnete directml-Gerät (siehe [**idmldevice**](/windows/desktop/api/directml/nn-directml-idmldevice)).</span><span class="sxs-lookup"><span data-stu-id="93fe4-113">Every device child (see [**IDMLDeviceChild**](/windows/desktop/api/directml/nn-directml-idmldevicechild)) holds a strong reference to its parent DirectML device (see [**IDMLDevice**](/windows/desktop/api/directml/nn-directml-idmldevice)).</span></span> <span data-ttu-id="93fe4-114">Dies bedeutet, dass Sie die übergeordnete Geräteschnittstelle jederzeit von einer beliebigen untergeordneten Geräteschnittstelle abrufen können.</span><span class="sxs-lookup"><span data-stu-id="93fe4-114">That means that you can always retrieve the parent device interface from any device child interface.</span></span>

<span data-ttu-id="93fe4-115">Ein directml-Gerät enthält seinerseits einen starken Verweis auf das Direct3D 12-Gerät, das verwendet wurde, um es zu erstellen (siehe [**ID3D12Device**](/windows/desktop/api/d3d12/nn-d3d12-id3d12device)und abgeleitete Schnittstellen).</span><span class="sxs-lookup"><span data-stu-id="93fe4-115">A DirectML device in turn holds a strong reference to the Direct3D 12 device that was used to create it (see [**ID3D12Device**](/windows/desktop/api/d3d12/nn-d3d12-id3d12device), and derived interfaces).</span></span>

<span data-ttu-id="93fe4-116">Da das directml-Gerät zustandslos ist, ist es implizit Thread sicher.</span><span class="sxs-lookup"><span data-stu-id="93fe4-116">Because the DirectML device is stateless, it's implicitly thread-safe.</span></span> <span data-ttu-id="93fe4-117">Sie können Methoden auf dem directml-Gerät gleichzeitig aus mehreren Threads abrufen, ohne dass eine externe Synchronisierung erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="93fe4-117">You may call methods on the DirectML device from multiple threads simultaneously without the need for external synchronization.</span></span>

<span data-ttu-id="93fe4-118">Im Gegensatz zum Direct3D 12-Gerät ist das directml-Gerät jedoch kein Singleton-Objekt.</span><span class="sxs-lookup"><span data-stu-id="93fe4-118">However, unlike the Direct3D 12 device, the DirectML device is not a singleton object.</span></span> <span data-ttu-id="93fe4-119">Sie können beliebig viele directml-Geräte erstellen.</span><span class="sxs-lookup"><span data-stu-id="93fe4-119">You're free to create as many DirectML devices as you wish.</span></span> <span data-ttu-id="93fe4-120">Es ist jedoch möglich, dass Sie die untergeordneten Geräte, die zu verschiedenen Geräten gehören, nicht kombinieren.</span><span class="sxs-lookup"><span data-stu-id="93fe4-120">However, you may not mix and match device children that belong to different devices.</span></span> <span data-ttu-id="93fe4-121">[**Idmlbindingtable**](/windows/desktop/api/directml/nn-directml-idmlbindingtable) und [**idmlcompiledoperator**](/windows/desktop/api/directml/nn-directml-idmlcompiledoperator) sind z. b. zwei Arten von untergeordneten Geräten (beide Schnittstellen werden direkt oder indirekt von **idmldevicechild** abgeleitet).</span><span class="sxs-lookup"><span data-stu-id="93fe4-121">For example, [**IDMLBindingTable**](/windows/desktop/api/directml/nn-directml-idmlbindingtable) and [**IDMLCompiledOperator**](/windows/desktop/api/directml/nn-directml-idmlcompiledoperator) are two kinds of device children (both interfaces derive directly or indirectly from **IDMLDeviceChild**).</span></span> <span data-ttu-id="93fe4-122">Und Sie dürfen keine Bindungs Tabelle (**idmlbindingtable**) verwenden, um eine Bindung für einen Operator (**idmlcompiledoperator**) herzustellen, wenn der Operator und die Bindungs Tabelle zu unterschiedlichen directml-Geräte Instanzen gehören.</span><span class="sxs-lookup"><span data-stu-id="93fe4-122">And you may not use a binding table (**IDMLBindingTable**) to bind for an operator (**IDMLCompiledOperator**) if the operator and the binding table belong to different DirectML device instances.</span></span>

<span data-ttu-id="93fe4-123">Da es sich bei dem directml-Gerät nicht um ein Singleton handelt, erfolgt die Geräte Entfernung auf Gerätebasis und nicht als Prozess weites Ereignis, da es sich um ein Direct3D 12-Gerät handelt.</span><span class="sxs-lookup"><span data-stu-id="93fe4-123">Because the DirectML device is not a singleton, device removal occurs on a per-device basis, rather than being a process-wide event as it is for a Direct3D 12 device.</span></span> <span data-ttu-id="93fe4-124">Weitere Informationen finden Sie unter [Behandeln von Fehlern und Entfernen von Geräten in der directml](dml-errors.md).</span><span class="sxs-lookup"><span data-stu-id="93fe4-124">For more information, see [Handling errors and device removal in DirectML](dml-errors.md).</span></span>

## <a name="lifetime-requirements-of-gpu-resources"></a><span data-ttu-id="93fe4-125">Lebensdauer Anforderungen von GPU-Ressourcen</span><span class="sxs-lookup"><span data-stu-id="93fe4-125">Lifetime requirements of GPU resources</span></span>

<span data-ttu-id="93fe4-126">Wie bei Direct3D 12 wird die directml nicht automatisch zwischen CPU und GPU synchronisiert. Außerdem werden Ressourcen nicht automatisch aktiv, während Sie von der GPU verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="93fe4-126">Like Direct3D 12, DirectML doesn't automatically synchronize between the CPU and GPU; nor does it automatically keep resources alive while they're in use by the GPU.</span></span> <span data-ttu-id="93fe4-127">Stattdessen sind dies Zuständigkeiten ihrer Anwendung.</span><span class="sxs-lookup"><span data-stu-id="93fe4-127">Instead, these are responsibilities of your application.</span></span>

<span data-ttu-id="93fe4-128">Wenn Sie eine Befehlsliste ausführen, die directml-Verteiler enthält, muss Ihre Anwendung sicherstellen, dass GPU-Ressourcen aktiv bleiben, bis die gesamte Arbeit, die diese Ressourcen verwendet, die Ausführung auf der GPU abgeschlossen hat.</span><span class="sxs-lookup"><span data-stu-id="93fe4-128">When executing a command list that contains DirectML dispatches, your application must ensure that GPU resources are kept alive until all work using those resources has completed execution on the GPU.</span></span>

<span data-ttu-id="93fe4-129">Im Fall von [**idmlcommandrecorder:: recorddispatch**](/windows/desktop/api/directml/nf-directml-idmlcommandrecorder-recorddispatch) für einen directml-Operator, der die folgenden Objekte enthält.</span><span class="sxs-lookup"><span data-stu-id="93fe4-129">In the case of [**IDMLCommandRecorder::RecordDispatch**](/windows/desktop/api/directml/nf-directml-idmlcommandrecorder-recorddispatch) for a DirectML operator, that includes the following objects.</span></span>

- <span data-ttu-id="93fe4-130">Der ausgeführte [**idmlcompiledoperator**](/windows/desktop/api/directml/nn-directml-idmlcompiledoperator) (oder [**idmloperatorinitializer**](/windows/desktop/api/directml/nn-directml-idmloperatorinitializer) , wenn die Operator Initialisierung durchgeführt wird).</span><span class="sxs-lookup"><span data-stu-id="93fe4-130">The [**IDMLCompiledOperator**](/windows/desktop/api/directml/nn-directml-idmlcompiledoperator) being executed (or [**IDMLOperatorInitializer**](/windows/desktop/api/directml/nn-directml-idmloperatorinitializer) instead, if performing operator initialization).</span></span>
- <span data-ttu-id="93fe4-131">Der **idmlcompiledoperator** , der die Bindungs Tabelle unterstützt, die zum Binden des Operators verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="93fe4-131">The **IDMLCompiledOperator** backing the binding table being used to bind the operator.</span></span>
- <span data-ttu-id="93fe4-132">Die [**ID3D12Resource**](/windows/desktop/api/d3d12/nn-d3d12-id3d12resource) -Objekte, die als Eingaben/Ausgaben des Operators gebunden sind.</span><span class="sxs-lookup"><span data-stu-id="93fe4-132">The [**ID3D12Resource**](/windows/desktop/api/d3d12/nn-d3d12-id3d12resource) objects bound as the inputs/outputs of the operator.</span></span>
- <span data-ttu-id="93fe4-133">Die **ID3D12Resource** -Objekte, die ggf. als persistente und temporäre Ressourcen gebunden sind.</span><span class="sxs-lookup"><span data-stu-id="93fe4-133">The **ID3D12Resource** objects bound as persistent and temporary resources, if applicable.</span></span>
- <span data-ttu-id="93fe4-134">Der [**ID3D12CommandAllocator**](/windows/desktop/api/d3d12/nn-d3d12-id3d12commandallocator) , der die Befehlsliste selbst unterstützt.</span><span class="sxs-lookup"><span data-stu-id="93fe4-134">The [**ID3D12CommandAllocator**](/windows/desktop/api/d3d12/nn-d3d12-id3d12commandallocator) backing the command list itself.</span></span>

<span data-ttu-id="93fe4-135">Nicht alle directml-Schnittstellen stellen GPU-Ressourcen dar.</span><span class="sxs-lookup"><span data-stu-id="93fe4-135">Not all DirectML interfaces represent GPU resources.</span></span> <span data-ttu-id="93fe4-136">Beispielsweise muss eine Bindungs Tabelle *nicht* aufrechterhalten werden, bis alle mit ihr verwendeten Verteiler die Ausführung auf der GPU abgeschlossen haben.</span><span class="sxs-lookup"><span data-stu-id="93fe4-136">For example, a binding table does *not* need to be kept alive until all dispatches using it have completed execution on the GPU.</span></span> <span data-ttu-id="93fe4-137">Das liegt daran, dass die Bindungs Tabelle selbst keine GPU-Ressourcen besitzt.</span><span class="sxs-lookup"><span data-stu-id="93fe4-137">That's because the binding table itself doesn't own any GPU resources.</span></span> <span data-ttu-id="93fe4-138">Stattdessen wird vom deskriptorheap verwendet.</span><span class="sxs-lookup"><span data-stu-id="93fe4-138">Rather, the descriptor heap does.</span></span> <span data-ttu-id="93fe4-139">Daher ist der zugrunde liegende *deskriptorheap* das Objekt, das beibehalten werden muss, bis die Ausführung abgeschlossen ist, und nicht die Bindungs Tabelle selbst.</span><span class="sxs-lookup"><span data-stu-id="93fe4-139">Therefore, the underlying *descriptor heap* is the object that must be kept alive until execution completes, and not the binding table itself.</span></span>

<span data-ttu-id="93fe4-140">In Direct3D 12 ist ein ähnliches Konzept vorhanden.</span><span class="sxs-lookup"><span data-stu-id="93fe4-140">A similar concept exists in Direct3D 12.</span></span> <span data-ttu-id="93fe4-141">Ein Befehls *Zuweiser* muss aktiv bleiben, bis alle Ausführungen, die ihn verwenden, auf der GPU abgeschlossen sind. Da es den GPU-Speicher besitzt.</span><span class="sxs-lookup"><span data-stu-id="93fe4-141">A command *allocator* must be kept alive until all executions using it have completed on the GPU; since it owns GPU memory.</span></span> <span data-ttu-id="93fe4-142">Aber eine Befehls *Liste* besitzt keinen GPU-Speicher, daher kann Sie zurückgesetzt oder freigegeben werden, sobald Sie zur Ausführung übermittelt wurde.</span><span class="sxs-lookup"><span data-stu-id="93fe4-142">But, a command *list* doesn't own GPU memory, so it can therefore be reset or released as soon as it's been submitted for execution.</span></span>

<span data-ttu-id="93fe4-143">In directml müssen kompilierte Operatoren ([**idmlcompiledoperator**](/windows/desktop/api/directml/nn-directml-idmlcompiledoperator)) und Operator Initialisierer ([**idmloperatorinitializer**](/windows/desktop/api/directml/nn-directml-idmloperatorinitializer)) beide GPU-Ressourcen direkt verwenden, sodass Sie aktiv bleiben, bis alle Verteiler, die Sie verwenden, die Ausführung auf der GPU abgeschlossen haben.</span><span class="sxs-lookup"><span data-stu-id="93fe4-143">In DirectML, compiled operators ([**IDMLCompiledOperator**](/windows/desktop/api/directml/nn-directml-idmlcompiledoperator)) and operator initializers ([**IDMLOperatorInitializer**](/windows/desktop/api/directml/nn-directml-idmloperatorinitializer)) both own GPU resources directly, so they must be kept alive until all dispatches using them have completed execution on the GPU.</span></span> <span data-ttu-id="93fe4-144">Außerdem müssen alle verwendeten Direct3D 12-Ressourcen (Befehls Zuweisungen, deskriptorheaps, Puffer, als Beispiele) auf ähnliche Weise von Ihrer Anwendung aufrechterhalten werden.</span><span class="sxs-lookup"><span data-stu-id="93fe4-144">In addition, any Direct3D 12 resource being used (command allocators, descriptor heaps, buffers, as examples) must similarly be kept alive by your application.</span></span>

<span data-ttu-id="93fe4-145">Wenn Sie ein Objekt vorzeitig freigegeben haben, während es noch von der GPU verwendet wird, ist das Ergebnis nicht definiertes Verhalten, das möglicherweise zum Entfernen von Geräten oder anderen Fehlern führt.</span><span class="sxs-lookup"><span data-stu-id="93fe4-145">If you prematurely release an object while it's still in use by the GPU, the result is undefined behavior, which has the potential to cause device removal or other errors.</span></span>

## <a name="cpu-and-gpu-synchronization"></a><span data-ttu-id="93fe4-146">CPU-und GPU-Synchronisierung</span><span class="sxs-lookup"><span data-stu-id="93fe4-146">CPU and GPU synchronization</span></span>

<span data-ttu-id="93fe4-147">Directml sendet keinerlei Arbeit für die Ausführung auf der GPU.</span><span class="sxs-lookup"><span data-stu-id="93fe4-147">DirectML doesn't itself submit any work for execution on the GPU.</span></span> <span data-ttu-id="93fe4-148">Stattdessen *zeichnet* die [ **idmlcommandrecorder:: recorddispatch** -Methode](/windows/desktop/api/directml/nf-directml-idmlcommandrecorder-recorddispatch) die Verteilung der in einer Befehlsliste zur späteren Ausführung auf.</span><span class="sxs-lookup"><span data-stu-id="93fe4-148">Instead, the [**IDMLCommandRecorder::RecordDispatch** method](/windows/desktop/api/directml/nf-directml-idmlcommandrecorder-recorddispatch) *records* the dispatch of that work into a command list for later execution.</span></span> <span data-ttu-id="93fe4-149">Die Anwendung muss dann die Befehlsliste für die Ausführung schließen und übermitteln, indem [**ID3D12CommandQueue:: executecommandlists**](/windows/desktop/api/d3d12/nf-d3d12-id3d12commandqueue-executecommandlists)aufgerufen wird, wie bei jeder Direct3D 12-Befehlsliste.</span><span class="sxs-lookup"><span data-stu-id="93fe4-149">Your application must then close and submit its command list for execution by calling [**ID3D12CommandQueue::ExecuteCommandLists**](/windows/desktop/api/d3d12/nf-d3d12-id3d12commandqueue-executecommandlists), as with any Direct3D 12 command list.</span></span>

<span data-ttu-id="93fe4-150">Da directml selbst keine Arbeit für die Ausführung auf der GPU absendet, werden auch keine Zäune erstellt, und es wird keine Form der CPU/GPU-Synchronisierung in Ihrem Namen ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="93fe4-150">Because DirectML doesn't itself submit any work for execution on the GPU, it also doesn't create any fences, nor perform any form of CPU/GPU synchronization on your behalf.</span></span> <span data-ttu-id="93fe4-151">Es liegt in der Verantwortung der Anwendung, die entsprechenden Direct3D 12-primitiven zu verwenden, um auf den Abschluss der übermittelten Arbeit auf der GPU zu warten, falls erforderlich.</span><span class="sxs-lookup"><span data-stu-id="93fe4-151">It is the responsibility of your application to use the appropriate Direct3D 12 primitives to wait for submitted work to complete execution on the GPU, if necessary.</span></span> <span data-ttu-id="93fe4-152">Weitere Informationen finden Sie unter [**ID3D12Fence**](/windows/desktop/api/d3d12/nn-d3d12-id3d12fence) und [**ID3D12CommandQueue:: Signal**](/windows/desktop/api/d3d12/nf-d3d12-id3d12commandqueue-signal).</span><span class="sxs-lookup"><span data-stu-id="93fe4-152">For more info, see [**ID3D12Fence**](/windows/desktop/api/d3d12/nn-d3d12-id3d12fence) and [**ID3D12CommandQueue::Signal**](/windows/desktop/api/d3d12/nf-d3d12-id3d12commandqueue-signal).</span></span>

## <a name="see-also"></a><span data-ttu-id="93fe4-153">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="93fe4-153">See also</span></span>

* [<span data-ttu-id="93fe4-154">Ausführen und Synchronisieren von Befehlslisten</span><span class="sxs-lookup"><span data-stu-id="93fe4-154">Executing and synchronizing command lists</span></span>](/windows/desktop/direct3d12/executing-and-synchronizing-command-lists)
* [<span data-ttu-id="93fe4-155">Behandeln von Fehlern und Entfernen von Geräten in der directml</span><span class="sxs-lookup"><span data-stu-id="93fe4-155">Handling errors and device removal in DirectML</span></span>](dml-errors.md)