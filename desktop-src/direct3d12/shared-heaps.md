---
title: Freigegebene Heaps
description: Die Freigabe eignet sich für Multiprozess-und multiadapterarchitekturen.
ms.assetid: 67C6B1D4-BF76-45A9-BADC-7C9520C900EB
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9f4271055f88e38484041c225b6b17c6d75f0d98
ms.sourcegitcommit: d6102d9e2b26368142fe5b006c65acb50c98be65
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/26/2019
ms.locfileid: "74103482"
---
# <a name="shared-heaps"></a><span data-ttu-id="15d58-103">Freigegebene Heaps</span><span class="sxs-lookup"><span data-stu-id="15d58-103">Shared Heaps</span></span>

<span data-ttu-id="15d58-104">Die Freigabe eignet sich für Multiprozess-und multiadapterarchitekturen.</span><span class="sxs-lookup"><span data-stu-id="15d58-104">Sharing is useful for multi-process and multi-adapter architectures.</span></span>

-   [<span data-ttu-id="15d58-105">Übersicht über die Freigabe</span><span class="sxs-lookup"><span data-stu-id="15d58-105">Sharing overview</span></span>](#sharing-overview)
-   [<span data-ttu-id="15d58-106">Freigabe von Heaps für Prozesse</span><span class="sxs-lookup"><span data-stu-id="15d58-106">Sharing heaps across processes</span></span>](#sharing-heaps-across-processes)
-   [<span data-ttu-id="15d58-107">Freigeben von Heaps über Adapter hinweg</span><span class="sxs-lookup"><span data-stu-id="15d58-107">Sharing heaps across adapters</span></span>](#sharing-heaps-across-adapters)
-   [<span data-ttu-id="15d58-108">Verwandte Themen</span><span class="sxs-lookup"><span data-stu-id="15d58-108">Related topics</span></span>](#related-topics)

## <a name="sharing-overview"></a><span data-ttu-id="15d58-109">Übersicht über die Freigabe</span><span class="sxs-lookup"><span data-stu-id="15d58-109">Sharing overview</span></span>

<span data-ttu-id="15d58-110">Freigegebene Heaps ermöglichen zwei Dinge: das Freigeben von Daten in einem Heap über einen oder mehrere Prozesse hinweg und das Ausschließen einer nicht deterministischen Auswahl von nicht definiertem Textur Layout für Ressourcen, die im Heap abgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="15d58-110">Shared heaps enable two things: sharing data in a heap across one or more processes, and precluding a non-deterministic choice of undefined texture layout for resources placed within the heap.</span></span> <span data-ttu-id="15d58-111">Durch die gemeinsame Nutzung von Heaps für Adapter entfällt auch das CPU-Marshalling der Daten.</span><span class="sxs-lookup"><span data-stu-id="15d58-111">Sharing heaps across adapters also removes the need for CPU marshaling of the data.</span></span>

<span data-ttu-id="15d58-112">Sowohl Heaps als auch zugesicherte Ressourcen können freigegeben werden.</span><span class="sxs-lookup"><span data-stu-id="15d58-112">Both heaps and committed resources can be shared.</span></span> <span data-ttu-id="15d58-113">Durch die Freigabe einer zugeordneten Ressource wird der implizite Heap gemeinsam mit der Beschreibung der zugeordneten Ressource gemeinsam genutzt, sodass eine kompatible Ressourcen Beschreibung dem Heap von einem anderen Gerät zugeordnet werden kann.</span><span class="sxs-lookup"><span data-stu-id="15d58-113">Sharing a committed resource actually shares the implicit heap along with the committed resource description, such that a compatible resource description can be mapped to the heap from another device.</span></span>

<span data-ttu-id="15d58-114">Alle Methoden sind frei Thread und erben die vorhandene D3D11-Semantik des Entwurfs Entwurfs für NT-Handles.</span><span class="sxs-lookup"><span data-stu-id="15d58-114">All methods are free-threaded and inherit the existing D3D11 semantics of the NT handle sharing design.</span></span>

-   [<span data-ttu-id="15d58-115">**ID3D12Device:: kreatesharedhandle**</span><span class="sxs-lookup"><span data-stu-id="15d58-115">**ID3D12Device::CreateSharedHandle**</span></span>](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createsharedhandle)
-   [<span data-ttu-id="15d58-116">**ID3D12Device:: opensharedhandle**</span><span class="sxs-lookup"><span data-stu-id="15d58-116">**ID3D12Device::OpenSharedHandle**</span></span>](/windows/win32/api/d3d12/nf-d3d12-id3d12device-opensharedhandle)
-   [<span data-ttu-id="15d58-117">**ID3D12Device:: opensharedlenker byname**</span><span class="sxs-lookup"><span data-stu-id="15d58-117">**ID3D12Device::OpenSharedHandleByName**</span></span>](/windows/win32/api/d3d12/nf-d3d12-id3d12device-opensharedhandlebyname)

## <a name="sharing-heaps-across-processes"></a><span data-ttu-id="15d58-118">Freigabe von Heaps für Prozesse</span><span class="sxs-lookup"><span data-stu-id="15d58-118">Sharing heaps across processes</span></span>

<span data-ttu-id="15d58-119">Freigegebene Heaps werden mit dem D3D12-Heap-Flag-Enumerationsmember der \_ D3D12- \_ \_ [**\_ \_ heapflags**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) -Enumeration angegeben.</span><span class="sxs-lookup"><span data-stu-id="15d58-119">Shared heaps are specified with the D3D12\_HEAP\_FLAG\_SHARED member of the [**D3D12\_HEAP\_FLAGS**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) enum.</span></span>

<span data-ttu-id="15d58-120">Freigegebene Heaps werden für auf CPU zugängliche Heaps nicht unterstützt: D3D12 \_ Heap \_ Type \_ Upload, D3D12 \_ Heap \_ Type Read \_ Back und D3D12 \_ Heap \_ Type \_ Custom ohne D3D12 \_ CPU \_ Page \_ Property \_ Not \_ available.</span><span class="sxs-lookup"><span data-stu-id="15d58-120">Shared heaps are not supported on CPU-accessible heaps: D3D12\_HEAP\_TYPE\_UPLOAD, D3D12\_HEAP\_TYPE\_READBACK, and D3D12\_HEAP\_TYPE\_CUSTOM without D3D12\_CPU\_PAGE\_PROPERTY\_NOT\_AVAILABLE.</span></span>

<span data-ttu-id="15d58-121">Wenn eine nicht deterministische Auswahl von nicht definiertem Textur Layout ausgeschlossen wird, können verzögerte renderingszenarios für einige GPUs erheblich beeinträchtigt werden, sodass es sich nicht um das Standardverhalten für die Platzierung und die zugesicherte Ressourcen handelt.</span><span class="sxs-lookup"><span data-stu-id="15d58-121">Precluding a non-deterministic choice of undefined texture layout can significantly impair deferred rendering scenarios on some GPUs, so it is not the default behavior for placed and committed resources.</span></span> <span data-ttu-id="15d58-122">Verzögerte Renderingvorgänge sind bei einigen GPU-Architekturen beeinträchtigt, da deterministische Textur Layouts die effektive Speicherbandbreite verringern, die beim gleichzeitigen Rendering in mehrere renderzieltexturen desselben Formats und derselben Größe erreicht wird.</span><span class="sxs-lookup"><span data-stu-id="15d58-122">Deferred rendering is impaired on some GPU architectures because deterministic texture layouts decrease the effective memory bandwidth achieved when rendering simultaneously to multiple render target textures of the same format and size.</span></span> <span data-ttu-id="15d58-123">GPU-Architekturen verbrauchen sich von der Nutzung nicht deterministischer Textur Layouts, um standardisierte swidingmuster und standardisierte Layouts für verzögertes Rendering effizient zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="15d58-123">GPU architectures are evolving away from leveraging non-deterministic texture layouts in order to support standardized swizzle patterns and standardized layouts efficiently for deferred rendering.</span></span>

<span data-ttu-id="15d58-124">Freigegebene Heaps sind auch mit anderen geringfügigen Kosten verbunden:</span><span class="sxs-lookup"><span data-stu-id="15d58-124">Shared heaps come with other minor costs as well:</span></span>

-   <span data-ttu-id="15d58-125">Freigegebene Heap Daten können aufgrund von Informationen zur Offenlegung von Informationen nicht so flexibel wie in-Process-Heaps wieder verwendet werden. Daher wird der physische Speicher häufiger in die Warteschlange gestellt.</span><span class="sxs-lookup"><span data-stu-id="15d58-125">Shared heap data cannot be recycled as flexibly as in-process heaps due to information disclosure concerns, so physical memory is zero'ed more often.</span></span>
-   <span data-ttu-id="15d58-126">Bei der Erstellung und Zerstörung von freigegebenen Heaps gibt es einen zusätzlichen CPU-Overhead und eine größere Systemspeicher Auslastung.</span><span class="sxs-lookup"><span data-stu-id="15d58-126">There is a minor additional CPU overhead and increased system memory usage during creation and destruction of shared heaps.</span></span>

## <a name="sharing-heaps-across-adapters"></a><span data-ttu-id="15d58-127">Freigeben von Heaps über Adapter hinweg</span><span class="sxs-lookup"><span data-stu-id="15d58-127">Sharing heaps across adapters</span></span>

<span data-ttu-id="15d58-128">Freigegebene Heaps zwischen Adaptern werden mit dem D3D12 \_ Heap \_ Flag \_ Shared \_ Cross Adapter-Member der Enumeration \_ [**D3D12 \_ Heap \_ Flags**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) festgelegt.</span><span class="sxs-lookup"><span data-stu-id="15d58-128">Shared heaps across adapters is specified with the D3D12\_HEAP\_FLAG\_SHARED\_CROSS\_ADAPTER member of the [**D3D12\_HEAP\_FLAGS**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) enum.</span></span>

<span data-ttu-id="15d58-129">Durch Kreuz Adapter freigegebene Heaps können mehrere Adapter Daten gemeinsam nutzen, ohne dass die CPU zwischen diesen Daten marshallert.</span><span class="sxs-lookup"><span data-stu-id="15d58-129">Cross adapter shared heaps enable multiple adapters to share data without the CPU marshaling the data between them.</span></span> <span data-ttu-id="15d58-130">Die unterschiedlichen Adapter Funktionen bestimmen, wie effiziente Adapter Daten zwischen Ihnen übergeben können. durch das Aktivieren von GPU-Kopien wird die effektive Bandbreite erhöht.</span><span class="sxs-lookup"><span data-stu-id="15d58-130">While varying adapter capabilities determine how efficient adapters can pass data between them, merely enabling GPU copies increases the effective bandwidth achieved.</span></span> <span data-ttu-id="15d58-131">Einige Textur Layouts sind auf Kreuz Adapter Heaps zulässig, um einen Austausch von Textur Daten zu unterstützen, auch wenn solche Textur Layouts nicht anderweitig unterstützt werden.</span><span class="sxs-lookup"><span data-stu-id="15d58-131">Some texture layouts are allowed on cross adapter heaps to support an interchange of texture data, even if such texture layouts are not otherwise supported.</span></span> <span data-ttu-id="15d58-132">Bestimmte Einschränkungen gelten möglicherweise für solche Texturen, z. b. nur das Kopieren.</span><span class="sxs-lookup"><span data-stu-id="15d58-132">Certain restrictions may apply to such textures, such as only supporting copying.</span></span>

<span data-ttu-id="15d58-133">Die Adapter übergreifende Freigabe funktioniert mit Heaps, die durch den Aufruf von [**ID3D12Device:: createheap**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createheap)erstellt wurden.</span><span class="sxs-lookup"><span data-stu-id="15d58-133">Cross-adapter sharing works with heaps created by calling [**ID3D12Device::CreateHeap**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createheap).</span></span> <span data-ttu-id="15d58-134">Anwendungen können dann über [**createplacedresource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createplacedresource)Ressourcen erstellen.</span><span class="sxs-lookup"><span data-stu-id="15d58-134">Applications can then create resources via [**CreatePlacedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createplacedresource).</span></span> <span data-ttu-id="15d58-135">Sie ist auch durch Ressourcen/Heaps zulässig, die von [**createcommittedresource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createcommittedresource) erstellt wurden, aber nur für Row-Major D3D12 \_ Resource \_ Dimension \_ TEXTURE2D Resources (Weitere Informationen finden Sie unter [**D3D12 \_ Resource \_ Dimension**](/windows/win32/api/d3d12/ne-d3d12-d3d12_resource_dimension)).</span><span class="sxs-lookup"><span data-stu-id="15d58-135">It is also allowed by resources/heaps created by [**CreateCommittedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createcommittedresource) but only for row-major D3D12\_RESOURCE\_DIMENSION\_TEXTURE2D resources (refer to [**D3D12\_RESOURCE\_DIMENSION**](/windows/win32/api/d3d12/ne-d3d12-d3d12_resource_dimension)).</span></span> <span data-ttu-id="15d58-136">Die Adapter übergreifende Freigabe funktioniert [**nicht mit "**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createreservedresource)" von "".</span><span class="sxs-lookup"><span data-stu-id="15d58-136">Cross-adapter sharing does not work with [**CreateReservedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createreservedresource).</span></span>

<span data-ttu-id="15d58-137">Bei der Adapter übergreifenden Freigabe gelten alle üblichen Regeln für die Warteschlangen übergreifende Ressourcen Freigabe weiterhin.</span><span class="sxs-lookup"><span data-stu-id="15d58-137">For cross-adapter sharing, all of the usual cross-queue resource sharing rules still apply.</span></span> <span data-ttu-id="15d58-138">Anwendungen müssen die entsprechenden Barrieren ausstellen, um die ordnungsgemäße Synchronisierung und Kohärenz zwischen den beiden Adaptern sicherzustellen.</span><span class="sxs-lookup"><span data-stu-id="15d58-138">Applications must issue the appropriate barriers to ensure proper synchronization and coherence between the two adapters.</span></span> <span data-ttu-id="15d58-139">Anwendungen sollten Adapter übergreifende Zäune verwenden, um die Planung von Befehlslisten zu koordinieren, die an mehrere Adapter übermittelt werden.</span><span class="sxs-lookup"><span data-stu-id="15d58-139">Applications should use cross-adapter fences to coordinate the scheduling of command lists submitted to multiple adapters.</span></span> <span data-ttu-id="15d58-140">Es gibt keinen Mechanismus zum Freigeben von Adapter übergreifenden Ressourcen über D3D-API-Versionen hinweg.</span><span class="sxs-lookup"><span data-stu-id="15d58-140">There is no mechanism to share cross-adapter resources across D3D API versions.</span></span> <span data-ttu-id="15d58-141">Netzwerk übergreifende freigegebene Ressourcen werden nur im Systemspeicher unterstützt.</span><span class="sxs-lookup"><span data-stu-id="15d58-141">Cross-adapter shared resources are only supported in system memory.</span></span> <span data-ttu-id="15d58-142">Netzwerk übergreifende freigegebene Heaps/Ressourcen werden in D3D12 \_ Heap \_ Type- \_ Standard Heaps und D3D12 \_ Heap \_ Type \_ Custom Heaps (mit dem L0-Speicherpool und den Eigenschaften der CPU-Seiten für die Schreib Kombination) unterstützt.</span><span class="sxs-lookup"><span data-stu-id="15d58-142">Cross-adapter shared heaps/resources are supported in D3D12\_HEAP\_TYPE\_DEFAULT heaps and D3D12\_HEAP\_TYPE\_CUSTOM heaps (with the L0 memory pool, and write-combine CPU page properties).</span></span> <span data-ttu-id="15d58-143">Treiber müssen sicher sein, dass GPU-Lese-/Schreibvorgänge für Kreuz Adapter übergreifende freigegebene Heaps mit anderen GPUs auf dem System in Einklang stehen.</span><span class="sxs-lookup"><span data-stu-id="15d58-143">Drivers must be sure that GPU read/write operations to cross-adapter shared heaps are coherent with other GPUs on the system.</span></span> <span data-ttu-id="15d58-144">Beispielsweise muss der Treiber möglicherweise die Heap Daten aus den GPU-Caches ausschließen, die in der Regel nicht geleert werden müssen, wenn die CPU nicht direkt auf die Heap Daten zugreifen kann.</span><span class="sxs-lookup"><span data-stu-id="15d58-144">For example, the driver may need to exclude the heap data from residing in GPU caches that typically don’t need to be flushed when the CPU cannot directly access the heap data.</span></span>

<span data-ttu-id="15d58-145">Anwendungen sollten die Verwendung von Adapter übergreifenden Heaps auf die Szenarien beschränken, die die von Ihnen bereitgestellte Funktionalität erfordern.</span><span class="sxs-lookup"><span data-stu-id="15d58-145">Applications should confine the usage of cross adapter heaps to only those scenarios which require the functionality they provide.</span></span> <span data-ttu-id="15d58-146">Adapter übergreifende Heaps befinden sich im D3D12- \_ Speicher \_ Pool \_ L0. Dies ist nicht immer das, was [**getcustomheapproperties**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-getcustomheapproperties) vorschlägt.</span><span class="sxs-lookup"><span data-stu-id="15d58-146">Cross-adapter heaps are located in D3D12\_MEMORY\_POOL\_L0, which is not always what [**GetCustomHeapProperties**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-getcustomheapproperties) suggests.</span></span> <span data-ttu-id="15d58-147">Dieser Speicherpool ist für diskrete/NUMA-Adapter Architekturen nicht effizient.</span><span class="sxs-lookup"><span data-stu-id="15d58-147">That memory pool is not efficient for discrete/ NUMA adapter architectures.</span></span> <span data-ttu-id="15d58-148">Und die effizientesten Textur Layouts sind nicht immer verfügbar.</span><span class="sxs-lookup"><span data-stu-id="15d58-148">And, the most efficient texture layouts are not always available.</span></span>

<span data-ttu-id="15d58-149">Außerdem gelten die folgenden Einschränkungen:</span><span class="sxs-lookup"><span data-stu-id="15d58-149">The following limitations also apply:</span></span>

-   <span data-ttu-id="15d58-150">Die Heap Kennzeichen im Zusammenhang mit Heap Ebenen müssen das D3D12-Heap Kennzeichen sein, das \_ \_ \_ \_ alle \_ Puffer \_ und \_ Texturen zulässt.</span><span class="sxs-lookup"><span data-stu-id="15d58-150">The heap flags related to heap tiers must be D3D12\_HEAP\_FLAG\_ALLOW\_ALL\_BUFFERS\_AND\_TEXTURES.</span></span>
-   <span data-ttu-id="15d58-151">Das D3D12- \_ Heap- \_ Flag \_ Shared muss ebenfalls festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="15d58-151">D3D12\_HEAP\_FLAG\_SHARED must also be set.</span></span>
-   <span data-ttu-id="15d58-152">Der Standardwert für \_ \_ den D3D12-heaptyp \_ muss festgelegt werden, oder der D3D12 \_ \_ -heaptyp ist für \_ den D3D12 \_ -Speicher Pool L0 festgelegt, \_ \_ und \_ \_ \_ \_ \_ es muss eine D3D12 CPU</span><span class="sxs-lookup"><span data-stu-id="15d58-152">Either D3D12\_HEAP\_TYPE\_DEFAULT must be set or D3D12\_HEAP\_TYPE\_CUSTOM with D3D12\_MEMORY\_POOL\_L0 and D3D12\_CPU\_PAGE\_PROPERTY\_NOT\_AVAILABLE must be set.</span></span>
-   <span data-ttu-id="15d58-153">Nur Ressourcen mit dem D3D12- \_ Ressourcentyp \_ \_ Allow \_ Cross \_ Adapter können auf Adapter übergreifenden Heaps platziert werden.</span><span class="sxs-lookup"><span data-stu-id="15d58-153">Only resources with D3D12\_RESOURCE\_FLAG\_ALLOW\_CROSS\_ADAPTER may be placed on cross-adapter heaps.</span></span>

<span data-ttu-id="15d58-154">Weitere Informationen zur Verwendung mehrerer Adapter finden Sie im Abschnitt [Systeme mit mehreren Adaptern](multi-engine.md) .</span><span class="sxs-lookup"><span data-stu-id="15d58-154">For more information on using multiple adapters, refer to the [Multi-adapter systems](multi-engine.md) section.</span></span>

## <a name="related-topics"></a><span data-ttu-id="15d58-155">Verwandte Themen</span><span class="sxs-lookup"><span data-stu-id="15d58-155">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="15d58-156">Untergeordnete Zuordnung innerhalb von Heaps</span><span class="sxs-lookup"><span data-stu-id="15d58-156">Suballocation Within Heaps</span></span>](suballocation-within-heaps.md)
</dt> </dl>

 

 




