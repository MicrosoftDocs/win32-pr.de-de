---
description: Erfahren Sie, wie Sie eine Cloud Files-Synchronisierungs-Engine erstellen, die Platzhalter Dateien mithilfe der Cloud Files-API verwendet.
title: Erstellen einer Cloud-Synchronisierungs-Engine, die Platzhalter Dateien unterstützt
ms.topic: article
ms.date: 11/12/2020
ms.openlocfilehash: 4f1330285d0c8ef0359639f2be84162f8bc2ef3b
ms.sourcegitcommit: 3bdf30edb314e0fcd17dc4ddbc70e4ec7d3596e6
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 02/10/2021
ms.locfileid: "104561419"
---
# <a name="build-a-cloud-sync-engine-that-supports-placeholder-files"></a><span data-ttu-id="3f3af-103">Erstellen einer Cloud-Synchronisierungs-Engine, die Platzhalter Dateien unterstützt</span><span class="sxs-lookup"><span data-stu-id="3f3af-103">Build a Cloud Sync Engine that Supports Placeholder Files</span></span>

<span data-ttu-id="3f3af-104">Ein Synchronisierungs Modul ist ein Dienst zum Synchronisieren von Dateien, normalerweise zwischen einem Remote Host und einem lokalen Client.</span><span class="sxs-lookup"><span data-stu-id="3f3af-104">A sync engine is a service that syncs files, typically between a remote host and a local client.</span></span> <span data-ttu-id="3f3af-105">Synchronisierungs-Engines unter Windows stellen diese Dateien häufig über das Windows-Dateisystem und den Datei-Explorer für den Benutzer zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="3f3af-105">Sync engines on Windows often present those files to the user through the Windows file system and File Explorer.</span></span> <span data-ttu-id="3f3af-106">Vor Windows 10, Version 1709, wurde die Synchronisierung von Synchronisierungs Modulen in Windows auf szenariounabhängige Ad-hoc-Oberflächen, wie z. b. Navigationsbereich des Datei-Explorers, Windows-Systemleiste und (für weitere technische Anwendungen), als Dateisystem Filter-Treiber beschränkt.</span><span class="sxs-lookup"><span data-stu-id="3f3af-106">Before Windows 10, version 1709, sync engine support in Windows was limited to scenario-agnostic ad-hoc surfaces, such as File Explorer’s navigation pane, the Windows system tray, and (for more technical applications) file system filter drivers.</span></span>

<span data-ttu-id="3f3af-107">In Windows 10, Version 1709 (auch als Fall Creators Update bezeichnet), wurde die *Cloud Files-API* eingeführt.</span><span class="sxs-lookup"><span data-stu-id="3f3af-107">Windows 10 version 1709 (also called the Fall Creators Update) introduced the *cloud files API*.</span></span> <span data-ttu-id="3f3af-108">Diese API ist eine neue Plattform, die die Unterstützung für Synchronisierungs-Engines formalisiert.</span><span class="sxs-lookup"><span data-stu-id="3f3af-108">This API is a new platform that formalizes support for sync engines.</span></span> <span data-ttu-id="3f3af-109">Die Cloud Files-API bietet Unterstützung für Synchronisierungs Module auf eine Weise, die Entwicklern und Endbenutzern viele neue Vorteile bietet.</span><span class="sxs-lookup"><span data-stu-id="3f3af-109">The cloud files API provides support for sync engines in a way that offers many new benefits to developers and end users.</span></span>

<span data-ttu-id="3f3af-110">Die Cloud Files-API enthält die folgenden nativen Win32-APIs und Windows-Runtime (WinRT)-APIs:</span><span class="sxs-lookup"><span data-stu-id="3f3af-110">The cloud files API contains the following native Win32 APIs and Windows Runtime (WinRT) APIs:</span></span>

* <span data-ttu-id="3f3af-111">[Cloud Filter-API](cloud-filter-reference.md): diese Native Win32-API bietet Funktionen an der Grenze zwischen dem Benutzermodus und dem Dateisystem.</span><span class="sxs-lookup"><span data-stu-id="3f3af-111">[Cloud Filter API](cloud-filter-reference.md): This native Win32 API provides functionality at the boundary between the user mode and the file system.</span></span> <span data-ttu-id="3f3af-112">Diese API behandelt die Erstellung und Verwaltung von Platzhalter Dateien und Verzeichnissen.</span><span class="sxs-lookup"><span data-stu-id="3f3af-112">This API handles the creation and management of placeholder files and directories.</span></span>
* <span data-ttu-id="3f3af-113">[Windows. Storage. Provider-Namespace](/uwp/api/windows.storage.provider): Diese WinRT-API ermöglicht es Anwendungen, den cloudspeicheranbieter zu konfigurieren und den Synchronisierungs Stamm beim Betriebssystem zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="3f3af-113">[Windows.Storage.Provider namespace](/uwp/api/windows.storage.provider): This WinRT API enables applications to configure the cloud storage provider and register the sync root with the operating system.</span></span>

> [!NOTE]
> <span data-ttu-id="3f3af-114">Die Cloud Files-API unterstützt derzeit nicht die Implementierung von Cloud Sync Engines in UWP-apps.</span><span class="sxs-lookup"><span data-stu-id="3f3af-114">The cloud files API does not currently support implementing cloud sync engines in UWP apps.</span></span> <span data-ttu-id="3f3af-115">Cloud Sync Engines müssen in Desktop-Apps implementiert werden.</span><span class="sxs-lookup"><span data-stu-id="3f3af-115">Cloud sync engines must be implemented in desktop apps.</span></span>

## <a name="supported-features"></a><span data-ttu-id="3f3af-116">Unterstützte Features</span><span class="sxs-lookup"><span data-stu-id="3f3af-116">Supported features</span></span>

<span data-ttu-id="3f3af-117">Die Cloud Files-API bietet die folgenden Features zum Entwickeln von Cloud-Synchronisierungs Modulen.</span><span class="sxs-lookup"><span data-stu-id="3f3af-117">The cloud files API provides the following features for building cloud sync engines.</span></span>

### <a name="placeholder-files"></a><span data-ttu-id="3f3af-118">Platzhalter Dateien</span><span class="sxs-lookup"><span data-stu-id="3f3af-118">Placeholder files</span></span>

* <span data-ttu-id="3f3af-119">Mithilfe von Synchronisierungs Modulen können Platzhalter Dateien erstellt werden, die für den File System-Header nur 1 KB Speicher beanspruchen und unter normalen Verwendungsbedingungen automatisch in vollständige Dateien unterteilt werden.</span><span class="sxs-lookup"><span data-stu-id="3f3af-119">Sync engines can create placeholder files that consume only 1 KB of storage for the filesystem header, and that automatically hydrate into full files under normal use conditions.</span></span> <span data-ttu-id="3f3af-120">Platzhalter Dateien, die als typische Dateien für apps und Endbenutzer in der Windows-Shell vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="3f3af-120">Placeholder files present as typical files to apps and to end users in the Windows Shell.</span></span>
* <span data-ttu-id="3f3af-121">Platzhalter Dateien sind vertikal aus dem Windows-Kernel in die Windows-Shell integriert, und die APP-Kompatibilität mit Platzhalter Dateien ist in der Regel kein Problem.</span><span class="sxs-lookup"><span data-stu-id="3f3af-121">Placeholder files are vertically integrated from the Windows kernel up to the Windows Shell, and app compatibility with placeholder files is generally a non-issue.</span></span> <span data-ttu-id="3f3af-122">Unabhängig davon, ob Sie Dateisystem-APIs, die Eingabeaufforderung oder eine Desktop-oder UWP-App verwenden, um auf eine Platzhalter Datei zuzugreifen, wird die Datei ohne zusätzliche Codeänderungen einfriert, und die Datei kann normalerweise von der APP verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="3f3af-122">Whether you use file system APIs, the Command Prompt, or a desktop or a UWP app to access a placeholder file, the file will hydrate without additional code changes and that app can use the file normally.</span></span>
* <span data-ttu-id="3f3af-123">Dateien können in drei Zuständen vorhanden sein:</span><span class="sxs-lookup"><span data-stu-id="3f3af-123">Files can exist in three states:</span></span>
  * <span data-ttu-id="3f3af-124">**Platzhalter Datei**: eine leere Darstellung der Datei und nur verfügbar, wenn der Synchronisierungs Dienst verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="3f3af-124">**Placeholder file**: An empty representation of the file and only available if the sync service is available.</span></span>
  * <span data-ttu-id="3f3af-125">**Vollständige Datei**: die Datei wurde implizit in die Datei aufgelöst, und Sie könnte durch das System aufgeschbe werden, wenn Speicherplatz benötigt wird.</span><span class="sxs-lookup"><span data-stu-id="3f3af-125">**Full file**: The file has been hydrated implicitly and could be dehydrated by the system if space is needed.</span></span>
  * <span data-ttu-id="3f3af-126">Angeheftete **vollständige Datei**: die Datei wurde im Datei-Explorer explizit vom Benutzer bereitgestellt und ist garantiert offline verfügbar.</span><span class="sxs-lookup"><span data-stu-id="3f3af-126">**Pinned full file**: The file has been hydrated explicitly by the user through File Explorer and is guaranteed to be available offline.</span></span>

<span data-ttu-id="3f3af-127">In der folgenden Abbildung wird veranschaulicht, wie der Platzhalter, vollständige und angeheftete vollständige Dateistatus im Datei-Explorer angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="3f3af-127">The following image demonstrates how the placeholder, full, and pinned full file states are shown in File Explorer.</span></span>

  ![Beispiel für drei Datei Zustände im Datei-Explorer](images/cloud-file-states-file-explorer.png)

### <a name="standardized-sync-root-registration"></a><span data-ttu-id="3f3af-129">Standardisierte Synchronisierungs Stamm Registrierung</span><span class="sxs-lookup"><span data-stu-id="3f3af-129">Standardized sync root registration</span></span>

* <span data-ttu-id="3f3af-130">Das Registrieren eines Synchronisierungs Stamms ist unkompliziert und standardisiert.</span><span class="sxs-lookup"><span data-stu-id="3f3af-130">Registering a sync root is straightforward and standardized.</span></span> <span data-ttu-id="3f3af-131">Dies schließt die Erstellung eines Branding-Knotens im Navigationsbereich des Datei-Explorers ein, wie im folgenden Screenshot gezeigt.</span><span class="sxs-lookup"><span data-stu-id="3f3af-131">This includes creation of a branded node in the navigation pane of File Explorer, as shown in the following screenshot.</span></span> <span data-ttu-id="3f3af-132">Stämme können entweder als einzelne Einträge der obersten Ebene oder als untergeordnete Elemente einer übergeordneten Gruppierung erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="3f3af-132">Roots can be created either as individual top-level entries, or as children of a parent grouping.</span></span>

  ![Beispiel für einen Synchronisierungs Stamm Eintrag im Datei-Explorer](images/register-sync-root-file-explorer.png)

### <a name="shell-integration"></a><span data-ttu-id="3f3af-134">Shellintegration</span><span class="sxs-lookup"><span data-stu-id="3f3af-134">Shell integration</span></span>

* <span data-ttu-id="3f3af-135">Zustands Symbole:</span><span class="sxs-lookup"><span data-stu-id="3f3af-135">State icons:</span></span>
  * <span data-ttu-id="3f3af-136">Die Cloud Files-API stellt standardisierte, automatische Aktivierungs Zustands Symbole bereit, die im Datei-Explorer und auf dem Windows-Desktop angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="3f3af-136">The cloud files API provides standardized, automatic hydration state icons shown in File Explorer and on the Windows desktop.</span></span>
  * <span data-ttu-id="3f3af-137">Zusätzlich zu den Standardsymbolen für den Windows-Status, die für den Aktivierungszustand verwendet werden, können Sie benutzerdefinierte Zustands Symbole für zusätzliche Dienst spezifische Eigenschaften bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="3f3af-137">In addition to the standard Windows state icons used for hydration state, you can provide custom state icons for additional service-specific properties.</span></span>
  * <span data-ttu-id="3f3af-138">Ersetzt Legacy-Shellerweiterungen für Symbol Überlagerung.</span><span class="sxs-lookup"><span data-stu-id="3f3af-138">Replaces legacy icon overlay Shell extensions.</span></span>
* <span data-ttu-id="3f3af-139">Fortschrittsanzeige:</span><span class="sxs-lookup"><span data-stu-id="3f3af-139">Progress indication:</span></span>
  * <span data-ttu-id="3f3af-140">Wenn Sie eine Platzhalter Datei öffnen, die mehr als ein paar Sekunden für das Hydrat benötigt, wird der Aktivierungs Fortschritt angezeigt.</span><span class="sxs-lookup"><span data-stu-id="3f3af-140">Opening a placeholder file that takes more than a few seconds to hydrate will show hydration progress.</span></span> <span data-ttu-id="3f3af-141">Der Fortschritt wird in Abhängigkeit vom Kontext an einigen Orten angezeigt:</span><span class="sxs-lookup"><span data-stu-id="3f3af-141">Progress is shown in a few locations depending on context:</span></span>
    * <span data-ttu-id="3f3af-142">Im Dialogfenster "Kopier-Engine".</span><span class="sxs-lookup"><span data-stu-id="3f3af-142">In a copy engine dialog window.</span></span>
    * <span data-ttu-id="3f3af-143">Der Inline Fortschritt wird neben der Datei im Datei-Explorer angezeigt.</span><span class="sxs-lookup"><span data-stu-id="3f3af-143">Inline progress is shown next to the file in File Explorer.</span></span>
    * <span data-ttu-id="3f3af-144">Wenn die Datei nicht in der spezifischen Anweisung des Benutzers geöffnet ist, wird eine Popup Benachrichtigung angezeigt, um den Benutzer zu informieren und eine Möglichkeit zur Steuerung der unbeabsichtigten Aktivierungs Aktivität bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="3f3af-144">If the file is not opened at the user’s specific instruction, a toast notification is shown to inform the user and provide a way to control unintended hydration activity.</span></span>
* <span data-ttu-id="3f3af-145">Miniaturansichten und Metadaten:</span><span class="sxs-lookup"><span data-stu-id="3f3af-145">Thumbnails and metadata:</span></span>
  * <span data-ttu-id="3f3af-146">Platzhalter Dateien können über umfangreiche, vom Dienst bereitgestellte Miniaturansichten und erweiterte Datei Metadaten verfügen, um dem Benutzer eine nahtlose Datei-Explorer-Benutzerfunktion bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="3f3af-146">Placeholder files can have rich service-provided thumbnails and extended file metadata to provide the user with a seamless File Explorer experience.</span></span>
* <span data-ttu-id="3f3af-147">Navigationsbereich des Datei-Explorers:</span><span class="sxs-lookup"><span data-stu-id="3f3af-147">File Explorer navigation pane:</span></span>
  * <span data-ttu-id="3f3af-148">Das Registrieren eines Synchronisierungs Stamms mit der Cloud Files-API bewirkt, dass der Synchronisierungs Stamm (mit einem Symbol und einem benutzerdefinierten Namen) im Navigationsbereich des Datei-Explorers angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="3f3af-148">Registering a sync root with the cloud files API causes that sync root (with an icon and custom name) to appear in File Explorer’s navigation pane.</span></span>
* <span data-ttu-id="3f3af-149">Kontextmenüs im Datei-Explorer:</span><span class="sxs-lookup"><span data-stu-id="3f3af-149">File Explorer context menus:</span></span>
  * <span data-ttu-id="3f3af-150">Wenn Sie einen Synchronisierungs Stamm mit der Cloud Files-API registrieren, werden im Kontextmenü des Datei-Explorers automatisch mehrere Verben (Menüeinträge) bereitstellt, mit denen der Benutzer den Aktivierungszustand der Datei steuern können.</span><span class="sxs-lookup"><span data-stu-id="3f3af-150">Registering a sync root with the cloud files API automatically provides several verbs (menu entries) in File Explorer’s context menu that let the user control the hydration state of their file.</span></span>
  * <span data-ttu-id="3f3af-151">Diesem Abschnitt des Kontextmenüs können zusätzliche Verben mithilfe von Desktop Bridge kompatiblen APIs hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="3f3af-151">Additional verbs can be added to this section of the context menu using Desktop Bridge-compatible APIs.</span></span>
* <span data-ttu-id="3f3af-152">Benutzer Steuerelement der Datei Aktivierung:</span><span class="sxs-lookup"><span data-stu-id="3f3af-152">User control of file hydration:</span></span>
  * <span data-ttu-id="3f3af-153">Benutzer haben immer die Kontrolle über die Datei Aktivierung, auch wenn die Dateien nicht explizit vom Benutzer aktiviert werden.</span><span class="sxs-lookup"><span data-stu-id="3f3af-153">Users are always in control of file hydration, even when the files are not hydrated explicitly by the user.</span></span> <span data-ttu-id="3f3af-154">Ein interaktiver Popup wird angezeigt, um den Benutzer zu warnen und Optionen anzugeben.</span><span class="sxs-lookup"><span data-stu-id="3f3af-154">An interactive toast is shown for background hydration to alert the user and provide options.</span></span> <span data-ttu-id="3f3af-155">In der folgenden Abbildung wird eine Popup Benachrichtigung für eine Metadatendatei veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="3f3af-155">The following image demonstrates a toast notification for a hydrating file.</span></span>
    <span data-ttu-id="3f3af-156">![Beispiel für einen interaktiven Toast, der für die Aktivierung der Hintergrund Datei angezeigt wird](images/file-hydration-interactive-toast.png)</span><span class="sxs-lookup"><span data-stu-id="3f3af-156">![Example of an interactive toast shown for background file hydration](images/file-hydration-interactive-toast.png)</span></span>
  * <span data-ttu-id="3f3af-157">Wenn ein Benutzer eine APP daran hindert, Dateien durch einen interaktiven Toast zu durchlaufen, kann er die Blockierung der APP auf der Seite **Automatische Dateidownloads** in den **Einstellungen** entsperren.</span><span class="sxs-lookup"><span data-stu-id="3f3af-157">If a user blocks an app from hydrating files through an interactive toast, they can unblock the app in the **Automatic file downloads** page in **Settings**.</span></span>
    <span data-ttu-id="3f3af-158">![Screenshot der Einstellung zum automatischen Herunterladen von Dateien](images/allow-automatic-file-downloads-setting.png)</span><span class="sxs-lookup"><span data-stu-id="3f3af-158">![Screenshot of the automatic file downloads setting](images/allow-automatic-file-downloads-setting.png)</span></span>
* <span data-ttu-id="3f3af-159">Einbinden von Kopier-Engine-Vorgängen (unterstützt in Windows 10 Insider Preview Build 19624 und höher):</span><span class="sxs-lookup"><span data-stu-id="3f3af-159">Hooking copy engine operations (supported in Windows 10 Insider Preview Build 19624 and later versions):</span></span>
  * <span data-ttu-id="3f3af-160">Cloudspeicheranbieter können einen shellkopierhook zum Überwachen von Datei Vorgängen in Ihrem Synchronisierungs Stamm registrieren.</span><span class="sxs-lookup"><span data-stu-id="3f3af-160">Cloud storage providers can register a shell copy hook for monitoring file operations within their sync root.</span></span>
  * <span data-ttu-id="3f3af-161">Der Anbieter registriert seinen kopierhook, indem er den **copyhook** -Registrierungs Wert unter Ihrem Synchronisierungs Stamm-Registrierungsschlüssel auf eine CLSID seines lokalen com-Server Objekts festlegt.</span><span class="sxs-lookup"><span data-stu-id="3f3af-161">The provider registers their copy hook by setting the **CopyHook** registry value under their sync root registry key to a the CLSID of their COM local server object.</span></span> <span data-ttu-id="3f3af-162">Dieses lokale Server Objekt implementiert die [istorageprovidercopyhook](../shell/nn-shobjidl-istorageprovidercopyhook.md) -Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="3f3af-162">This local server object implements the [IStorageProviderCopyHook](../shell/nn-shobjidl-istorageprovidercopyhook.md) interface.</span></span>

### <a name="desktop-bridge"></a><span data-ttu-id="3f3af-163">Desktop-Brücke</span><span class="sxs-lookup"><span data-stu-id="3f3af-163">Desktop Bridge</span></span>

* <span data-ttu-id="3f3af-164">Synchronisierungs-Engines, die die Cloud Files-APIs verwenden, sind darauf ausgelegt, die [Desktop Bridge](/windows/uwp/porting/desktop-to-uwp-root) als Implementierungs Anforderung zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="3f3af-164">Sync engines using the cloud files APIs are designed to use the [Desktop Bridge](/windows/uwp/porting/desktop-to-uwp-root) as an implementation requirement.</span></span>

## <a name="cloud-mirror-sample"></a><span data-ttu-id="3f3af-165">Cloud-Spiegelungs Beispiel</span><span class="sxs-lookup"><span data-stu-id="3f3af-165">Cloud Mirror sample</span></span>

<span data-ttu-id="3f3af-166">Das [cloudspiegelungs Beispiel](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/CloudMirror) veranschaulicht, wie Sie eine Lösung erstellen, die die Cloud Files-API verwendet.</span><span class="sxs-lookup"><span data-stu-id="3f3af-166">The [Cloud Mirror sample](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/CloudMirror) illustrates how to build a solution that uses the cloud files API.</span></span> <span data-ttu-id="3f3af-167">Sie ist nicht für die Verwendung als Produktionscode vorgesehen.</span><span class="sxs-lookup"><span data-stu-id="3f3af-167">It is not intended to be used as production code.</span></span> <span data-ttu-id="3f3af-168">Es fehlt eine robuste Fehlerbehandlung und wird so geschrieben, dass es so leicht verständlich wie möglich ist.</span><span class="sxs-lookup"><span data-stu-id="3f3af-168">It lacks robust error handling and it is written to be as easily understood as possible.</span></span> <span data-ttu-id="3f3af-169">Es wird als cloudspiegelung bezeichnet, da es einfach einen lokalen Ordner auf dem lokalen Datenträger widerspiegelt.</span><span class="sxs-lookup"><span data-stu-id="3f3af-169">It's called Cloud Mirror because it simply mirrors a local folder on your local disk.</span></span> <span data-ttu-id="3f3af-170">Sie geben einen Server Ordner an, der Ihren clouddateiserver und einen Client Ordner darstellen soll, der den Synchronisierungs Stamm Pfad angeben soll.</span><span class="sxs-lookup"><span data-stu-id="3f3af-170">You specify a server folder that is meant to represent your cloud file server and a client folder that is meant to specify the sync root path.</span></span> <span data-ttu-id="3f3af-171">Ein Knoten der obersten Ebene wird im Navigationsbereich des Datei-Explorers namens **teststorageproviderdisplayname** angezeigt, und dieser Knoten wird dem angegebenen Client Ordner zugeordnet.</span><span class="sxs-lookup"><span data-stu-id="3f3af-171">A top-level node appears in the navigation pane in File Explorer called **TestStorageProviderDisplayName**, and this node maps to the specified client folder.</span></span>

<span data-ttu-id="3f3af-172">Bei der Synchronisierung müssen diese Funktionen von einem vollständig entwickelten clouddateisynchronisierungs-Anbieter implementiert werden:</span><span class="sxs-lookup"><span data-stu-id="3f3af-172">When it comes to syncing, these are the things that a fully-developed cloud files sync provider must implement:</span></span>

* <span data-ttu-id="3f3af-173">Wenn die Synchronisierungs Stammdatei nur ein Platzhalter ist, ist der Dienst dafür verantwortlich, den Inhalt der Datei zur Aktivierung zu kopieren.</span><span class="sxs-lookup"><span data-stu-id="3f3af-173">When the sync root file is just a placeholder, the service is responsible for copying down the contents of the file for hydration.</span></span> <span data-ttu-id="3f3af-174">Dies wird im Beispiel implementiert.</span><span class="sxs-lookup"><span data-stu-id="3f3af-174">This is implemented in the sample.</span></span>
* <span data-ttu-id="3f3af-175">Wenn die Synchronisierungs Stammdatei eine vollständige Datei ist und sich der Inhalt der Datei im clouddienst ändert, ist der Dienst für die Benachrichtigung des lokalen Synchronisierungs Clients der Änderung zuständig, und der lokale Synchronisierungs Client muss Zusammenführungen gemäß ihren eigenen Spezifikationen verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="3f3af-175">When the sync root file is a full file and the contents of the file in the cloud service change, the service is responsible of notifying the local sync client of the change and the local sync client must handle merges according to their own specifications.</span></span> <span data-ttu-id="3f3af-176">Dies ist im Beispiel nicht implementiert.</span><span class="sxs-lookup"><span data-stu-id="3f3af-176">This is not implemented in the sample.</span></span>
* <span data-ttu-id="3f3af-177">Wenn es sich bei der Synchronisierungs Stammdatei um eine vollständige Datei handelt und der Inhalt der Datei im Synchronisierungs Stamm Pfad (der lokale Client) geändert wird, muss der lokale Synchronisierungs Client den clouddienst Benachrichtigen und Zusammenführungen gemäß ihren eigenen Spezifikationen verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="3f3af-177">When the sync root file is a full file and the contents of the file in the sync root path (the local client) change, the local sync client must notify the cloud service and handle merges according to their own specifications.</span></span> <span data-ttu-id="3f3af-178">Die Benachrichtigung über lokale Dateiänderungen ist im Beispiel implementiert, aber es wird nichts unternommen.</span><span class="sxs-lookup"><span data-stu-id="3f3af-178">The local file change notification is implemented in the sample, but it does not do anything.</span></span>

### <a name="use-the-sample"></a><span data-ttu-id="3f3af-179">Verwenden des Beispiels</span><span class="sxs-lookup"><span data-stu-id="3f3af-179">Use the sample</span></span>

1. <span data-ttu-id="3f3af-180">Erstellen Sie zwei Ordner auf der lokalen Festplatte.</span><span class="sxs-lookup"><span data-stu-id="3f3af-180">Create two folders on your local hard drive.</span></span> <span data-ttu-id="3f3af-181">Einer davon fungiert als Server und der andere als Client.</span><span class="sxs-lookup"><span data-stu-id="3f3af-181">One of them will act as the server and the other as the client.</span></span>
2. <span data-ttu-id="3f3af-182">Fügen Sie dem Server Ordner einige Dateien hinzu.</span><span class="sxs-lookup"><span data-stu-id="3f3af-182">Add some files to the server folder.</span></span> <span data-ttu-id="3f3af-183">Stellen Sie sicher, dass der Client Ordner leer ist.</span><span class="sxs-lookup"><span data-stu-id="3f3af-183">Make sure the client folder is empty.</span></span>
3. <span data-ttu-id="3f3af-184">Öffnen Sie das Cloud-Spiegel Beispiel in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="3f3af-184">Open the Cloud Mirror sample in Visual Studio.</span></span> <span data-ttu-id="3f3af-185">Legen Sie das Projekt **cloudmirrorpackage** als Startprojekt fest, und erstellen Sie das Beispiel, und führen Sie es aus.</span><span class="sxs-lookup"><span data-stu-id="3f3af-185">Set the **CloudMirrorPackage** project as your startup project and then build and run the sample.</span></span> <span data-ttu-id="3f3af-186">Wenn Sie durch das Beispiel dazu aufgefordert werden, geben Sie die beiden Pfade zu Ihren Server-und Client Ordnern ein.</span><span class="sxs-lookup"><span data-stu-id="3f3af-186">When prompted by the sample, enter the two paths to your server and client folders.</span></span> <span data-ttu-id="3f3af-187">Anschließend wird ein Konsolenfenster mit Diagnoseinformationen angezeigt.</span><span class="sxs-lookup"><span data-stu-id="3f3af-187">After this you will see a console window with diagnostic information.</span></span>
4. <span data-ttu-id="3f3af-188">Öffnen Sie den Datei-Explorer, und vergewissern Sie sich, dass der Knoten **teststorageproviderdisplayname** und die Platzhalter für alle Dateien angezeigt werden, die Sie in den Server Ordner kopiert haben.</span><span class="sxs-lookup"><span data-stu-id="3f3af-188">Open File Explorer and confirm that you see the **TestStorageProviderDisplayName** node and the placeholders for all the files that you copied into the server folder.</span></span> <span data-ttu-id="3f3af-189">Um eine Anwendung zu simulieren, die versucht, Dateien zu öffnen, ohne die Auswahl zu verwenden, kopieren Sie mehrere Images in den Server Ordner.</span><span class="sxs-lookup"><span data-stu-id="3f3af-189">To simulate an application that tries to open files without using the picker, copy several images to the server folder.</span></span> <span data-ttu-id="3f3af-190">Doppelklicken Sie in ihrem Stamm Ordner für die Synchronisierung auf eine dieser Elemente, und vergewissern Sie sich, dass Sie in der</span><span class="sxs-lookup"><span data-stu-id="3f3af-190">Double-click one of them in your sync root folder and confirm that it hydrates.</span></span> <span data-ttu-id="3f3af-191">Öffnen Sie dann die Fotos-app.</span><span class="sxs-lookup"><span data-stu-id="3f3af-191">Then, open the Photos app.</span></span> <span data-ttu-id="3f3af-192">Die APP lädt benachbarte Dateien vorab in den Hintergrund, um die Wahrscheinlichkeit zu erhöhen, dass der Benutzer bei der Betrachtung der anderen Bilder keine Verzögerungen hat.</span><span class="sxs-lookup"><span data-stu-id="3f3af-192">The app will pre-load adjacent files in the background to make it more likely the user does not experience delays when looking through the other pictures.</span></span> <span data-ttu-id="3f3af-193">Sie können sehen, dass die Hintergrund Aktivierung über ein-oder im Datei-Explorer erfolgt.</span><span class="sxs-lookup"><span data-stu-id="3f3af-193">You can observe the background dehydration happen via toasts or in File Explorer.</span></span>
5. <span data-ttu-id="3f3af-194">Klicken Sie mit der rechten Maustaste auf eine Datei im Datei-Explorer, um ein Kontextmenü anzuzeigen, und vergewissern Sie sich, dass das Menü Element **TestCommand** angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="3f3af-194">Right-click a file in File Explorer to bring up a context menu, and confirm that you see the **TestCommand** menu item.</span></span> <span data-ttu-id="3f3af-195">Wenn Sie auf dieses Menü Element klicken, wird ein Meldungs Feld angezeigt.</span><span class="sxs-lookup"><span data-stu-id="3f3af-195">Clicking this menu item will display a message box.</span></span>
6. <span data-ttu-id="3f3af-196">Um das Beispiel anzuhalten, legen Sie den Fokus auf die Konsolenausgabe fest, und drücken Sie **STRG + C**.</span><span class="sxs-lookup"><span data-stu-id="3f3af-196">To stop the sample, set focus to the console output and press **Ctrl-C**.</span></span> <span data-ttu-id="3f3af-197">Dadurch wird die Synchronisierung der Stamm Registrierung bereinigt, sodass der Anbieter deinstalliert wird.</span><span class="sxs-lookup"><span data-stu-id="3f3af-197">This will cleanup the sync root registration so that the provider is uninstalled.</span></span> <span data-ttu-id="3f3af-198">Wenn das Beispiel abstürzt, ist es möglich, dass der Synchronisierungs Stamm registriert bleibt.</span><span class="sxs-lookup"><span data-stu-id="3f3af-198">If the sample crashes, it’s possible that the sync root will remain registered.</span></span> <span data-ttu-id="3f3af-199">Dies bewirkt, dass der Datei-Explorer jedes Mal neu startet, wenn Sie auf etwas klicken, und Sie werden aufgefordert, die falschen Client-und Server Speicherorte zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="3f3af-199">This will cause File Explorer to relaunch every time you click on anything, and you would get prompted for the fake client and server locations.</span></span> <span data-ttu-id="3f3af-200">Wenn dies der Fall ist, deinstallieren Sie die **cloudmirrorpackage** -Beispielanwendung von Ihrem Computer.</span><span class="sxs-lookup"><span data-stu-id="3f3af-200">If this occurs, uninstall the **CloudMirrorPackage** sample application from your computer.</span></span>

### <a name="sample-architecture"></a><span data-ttu-id="3f3af-201">Beispiel Architektur</span><span class="sxs-lookup"><span data-stu-id="3f3af-201">Sample architecture</span></span>

<span data-ttu-id="3f3af-202">Das Beispiel ist absichtlich einfach.</span><span class="sxs-lookup"><span data-stu-id="3f3af-202">The sample is deliberately simple.</span></span> <span data-ttu-id="3f3af-203">Statische Klassen werden verwendet, um die Übergabe von instanzzeigern unnötig zu machen.</span><span class="sxs-lookup"><span data-stu-id="3f3af-203">It uses static classes to make it unnecessary to pass instance pointers.</span></span> <span data-ttu-id="3f3af-204">Im Beispiel sind die Hauptklassen aufgeführt:</span><span class="sxs-lookup"><span data-stu-id="3f3af-204">Here are the main classes in the sample:</span></span>

* <span data-ttu-id="3f3af-205">**Fakecloudprovider**: Diese Klasse der obersten Ebene steuert die folgenden Workerklassen:</span><span class="sxs-lookup"><span data-stu-id="3f3af-205">**FakeCloudProvider**: This top-level class controls the following worker classes:</span></span>
  * <span data-ttu-id="3f3af-206">**Cloudproviderregistrar**: registriert die Informationen des Synchronisierungs Stamms bei der Windows-Shell.</span><span class="sxs-lookup"><span data-stu-id="3f3af-206">**CloudProviderRegistrar**: Registers the sync root information with the Windows Shell.</span></span>
  * <span data-ttu-id="3f3af-207">**Platz** Halter: generiert die Platzhalter Dateien im Synchronisierungs Stammpfad.</span><span class="sxs-lookup"><span data-stu-id="3f3af-207">**Placeholders**: Generates the placeholder files in the sync root path.</span></span>
  * <span data-ttu-id="3f3af-208">**Shellservices**: erstellt die Windows Shell-Anbieter für das Kontextmenü, die Miniaturansichten und andere Dienste.</span><span class="sxs-lookup"><span data-stu-id="3f3af-208">**ShellServices**: Constructs the Windows Shell providers for the context menu, thumbnails, and other services.</span></span>
  * <span data-ttu-id="3f3af-209">**Cloudprovidersyncrootwatcher**: instanziiert einen Director-Watcher, um Änderungen am Synchronisierungs Stamm Pfad zu überwachen und Änderungen vorzunehmen.</span><span class="sxs-lookup"><span data-stu-id="3f3af-209">**CloudProviderSyncRootWatcher**: Instantiates a DirectoryWatcher to monitor changes to the sync root path and act on changes.</span></span>
  * <span data-ttu-id="3f3af-210">**Filecopierwithprogress**: kopiert Dateien aus dem Server Ordner langsam in den Client Ordner, um das Herunterladen von einem echten cloudserver zu simulieren.</span><span class="sxs-lookup"><span data-stu-id="3f3af-210">**FileCopierWithProgress**: Copies files from the server folder to the client folder slowly in chunks to simulate downloading them from a real cloud server.</span></span> <span data-ttu-id="3f3af-211">Gibt die Statusanzeige an, sodass der Benutzer von den-und Datei-Explorer-Benutzeroberflächen etwas informativ angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="3f3af-211">Provides progress indication so that toasts and File Explorer UI shows the user something informative.</span></span>

<span data-ttu-id="3f3af-212">Zusätzlich zu den oben genannten Klassen bietet das Beispiel auch mehrere Hilfsklassen, um den Benutzer zur Eingabe von Ordnern und einigen Dienstprogrammen aufzufordern.</span><span class="sxs-lookup"><span data-stu-id="3f3af-212">In addition to the classes above, the sample also provides several helper classes to prompt the user for folders and some utilities.</span></span> <span data-ttu-id="3f3af-213">**Testexplorercommandhandler**, **customstateprovider**, **thumbnailprovider** und **UriSource** sind Beispiele für shelldienstanbieter.</span><span class="sxs-lookup"><span data-stu-id="3f3af-213">The **TestExplorerCommandHandler**, **CustomStateProvider**, **ThumbnailProvider**, and **UriSource** are all examples of Shell service providers.</span></span>

## <a name="cloud-files-api-architecture"></a><span data-ttu-id="3f3af-214">Cloud Files-API-Architektur</span><span class="sxs-lookup"><span data-stu-id="3f3af-214">Cloud files API architecture</span></span>

<span data-ttu-id="3f3af-215">Der Kern des Speicher Stapels in der Cloud Files-API ist ein Dateisystem-Minifilter-Treiber namens "cldflt.sys".</span><span class="sxs-lookup"><span data-stu-id="3f3af-215">At the core of the storage stack in the cloud files API is a file system minifilter driver called cldflt.sys.</span></span> <span data-ttu-id="3f3af-216">Dieser Treiber fungiert als Proxy zwischen den Anwendungen des Benutzers und dem Synchronisierungs Modul.</span><span class="sxs-lookup"><span data-stu-id="3f3af-216">This driver acts as a proxy between the user’s applications and your sync engine.</span></span> <span data-ttu-id="3f3af-217">Das Synchronisierungs Modul weiß, wie die Daten bei Bedarf heruntergeladen und hochgeladen werden. in diesem Fall ist es cldflt.sys, mit der Shell zu arbeiten, um Dateien so darzustellen, als wären die clouddaten lokal verfügbar.</span><span class="sxs-lookup"><span data-stu-id="3f3af-217">Your sync engine knows how to download and upload the data on demand while it is responsibility of cldflt.sys to work with the Shell to present files as if the cloud data were locally available.</span></span>

<span data-ttu-id="3f3af-218">Cldflt.sys unterstützt derzeit nur NTFS-Volumes, da es von einigen Features abhängig ist, die für NTFS spezifisch sind.</span><span class="sxs-lookup"><span data-stu-id="3f3af-218">Cldflt.sys currently only supports NTFS volumes because it depends on some features unique to NTFS.</span></span>

<span data-ttu-id="3f3af-219">Es gibt viele Minifilter-Treiber für Dateisysteme in einem System, die auf einem bestimmten Volume gleichzeitig aktiv sein können.</span><span class="sxs-lookup"><span data-stu-id="3f3af-219">There are many file system minifilter drivers in a system and they can be active on a given volume at the same time.</span></span> <span data-ttu-id="3f3af-220">Die Treiber, die für die Cloud Files-API am meisten von Interesse sind, sind die antivirendateisystemfilter.</span><span class="sxs-lookup"><span data-stu-id="3f3af-220">The drivers that are of most interest to the cloud files API are the anti-virus file system filters.</span></span>

<span data-ttu-id="3f3af-221">Minifilter-Treiber für Dateisysteme werden von einer speziellen Kernelmoduskomponente mit dem Namen Filter-Manager verwaltet und unterstützt.</span><span class="sxs-lookup"><span data-stu-id="3f3af-221">File system minifilter drivers are managed and supported by a special kernel-mode component called the filter manager.</span></span> <span data-ttu-id="3f3af-222">Unter vielen anderen Aufgaben ermöglicht der Filter-Manager die ungefilterte Kommunikation zwischen Filtern und Benutzermoduskomponenten über ein Konstrukt, das als filternachrichtenport bezeichnet wird.</span><span class="sxs-lookup"><span data-stu-id="3f3af-222">Among many other duties, the filter manager facilitates unfiltered communication between filters and user mode components via a construct known as filter message port.</span></span>

## <a name="hydration-policies"></a><span data-ttu-id="3f3af-223">Aktivierungs Richtlinien</span><span class="sxs-lookup"><span data-stu-id="3f3af-223">Hydration Policies</span></span>

<span data-ttu-id="3f3af-224">Windows unterstützt eine Vielzahl von [primären Aktivierungs Richtlinien](/windows/desktop/api/cfapi/ne-cfapi-cf_hydration_policy_primary) und die richtlinienmodifiziererer für [sekundäre Maßnahmen](/windows/desktop/api/cfapi/ne-cfapi-cf_hydration_policy_modifier) .</span><span class="sxs-lookup"><span data-stu-id="3f3af-224">Windows supports a variety of [primary hydration policies](/windows/desktop/api/cfapi/ne-cfapi-cf_hydration_policy_primary) and [secondary hydration policy](/windows/desktop/api/cfapi/ne-cfapi-cf_hydration_policy_modifier) modifiers.</span></span> <span data-ttu-id="3f3af-225">Primäre Aktivierungs Richtlinien haben folgende Reihenfolge:</span><span class="sxs-lookup"><span data-stu-id="3f3af-225">Primary hydration policies have this order:</span></span>

  <span data-ttu-id="3f3af-226">**Immer voll > vollständige > Progressive > partiell**</span><span class="sxs-lookup"><span data-stu-id="3f3af-226">**Always full > Full > Progressive > Partial**</span></span>

<span data-ttu-id="3f3af-227">Sowohl Anwendungen als auch Synchronisierungs Module können Ihre bevorzugte primäre Aktivierungs Richtlinie definieren.</span><span class="sxs-lookup"><span data-stu-id="3f3af-227">Both applications and sync engines can define their preferred primary hydration policy.</span></span> <span data-ttu-id="3f3af-228">Wenn nicht angegeben, ist die standardmäßige Aktivierungs Richtlinie für Anwendungen und Synchronisierungs Module progressiv.</span><span class="sxs-lookup"><span data-stu-id="3f3af-228">If not specified, the default hydration policy is progressive for both applications and sync engines.</span></span>

<span data-ttu-id="3f3af-229">Die Richtlinie für die Einlösung einer Cloud-Datei wird durch die folgende Formel am Datei Öffnungs Zeitpunkt bestimmt:</span><span class="sxs-lookup"><span data-stu-id="3f3af-229">The hydration policy of a cloud file is determined at the file open time by this formula:</span></span>

  ```File hydration policy = max(app hydration policy, provider hydration policy)```

<span data-ttu-id="3f3af-230">Nehmen wir beispielsweise an, dass der Benutzer versucht, eine PDF-Datei zu öffnen, die auf dem Fabrikam-cloudlaufwerk mithilfe von "Configuration Manager-Viewer" gespeichert ist, die keine bevorzugte Aktivierungs Richtlinie angibt.</span><span class="sxs-lookup"><span data-stu-id="3f3af-230">For example, let’s say the user is trying to open a PDF file stored on Fabrikam Cloud Drive using Contoso PDF Viewer, which doesn’t specify a preferred hydration policy.</span></span> <span data-ttu-id="3f3af-231">Die Richtlinie zur Anwendungs Aktivierung ist folglich progressiv, in diesem Fall standardmäßig.</span><span class="sxs-lookup"><span data-stu-id="3f3af-231">The application hydration policy is therefore progressive hydration, in this case by default.</span></span> <span data-ttu-id="3f3af-232">Da es sich bei Fabrikam Cloud Drive jedoch um ein vollständiges Synchronisierungs Modul handelt, wird die endgültige Aktivierungs Richtlinie für die Datei vollständig aktiviert, was dazu führt, dass die Datei beim ersten Zugriff vollständig aktiviert wird.</span><span class="sxs-lookup"><span data-stu-id="3f3af-232">However, because Fabrikam Cloud Drive is a full hydration sync engine, the final hydration policy on the file becomes full hydration, which will result in the file being fully hydrated on first access.</span></span> <span data-ttu-id="3f3af-233">Das gleiche Ergebnis tritt in Fällen auf, in denen das Synchronisierungs Modul eine progressive Aktivierung unterstützt, aber die bevorzugte APP ist vollständig.</span><span class="sxs-lookup"><span data-stu-id="3f3af-233">The same outcome happens in cases where the sync engine supports progressive hydration, but the app’s preference is full hydration.</span></span>

<span data-ttu-id="3f3af-234">Beachten Sie, dass die Datei-Aktivierungs Richtlinie nicht geändert werden kann, nachdem die Datei geöffnet wurde.</span><span class="sxs-lookup"><span data-stu-id="3f3af-234">Note that the file hydration policy cannot be changed after the file is opened.</span></span>

## <a name="compatibility-with-applications-that-use-reparse-points"></a><span data-ttu-id="3f3af-235">Kompatibilität mit Anwendungen, die Analyse Punkte verwenden</span><span class="sxs-lookup"><span data-stu-id="3f3af-235">Compatibility with applications that use reparse points</span></span>

<span data-ttu-id="3f3af-236">Die Cloud Files-API implementiert das Platzhalter System mithilfe von Analyse [Punkten](/windows/desktop/FileIO/reparse-points).</span><span class="sxs-lookup"><span data-stu-id="3f3af-236">The cloud files API implements the placeholder system using [reparse points](/windows/desktop/FileIO/reparse-points).</span></span> <span data-ttu-id="3f3af-237">Ein gängiges Missverständnis bei Analyse Punkten ist, dass Sie mit symbolischen Verknüpfungen identisch sind.</span><span class="sxs-lookup"><span data-stu-id="3f3af-237">A common misconception about reparse points is that they are the same as symbolic links.</span></span> <span data-ttu-id="3f3af-238">Dieses fehl Konzept wird gelegentlich in Anwendungs Implementierungen widergespiegelt, und infolgedessen stoßen viele vorhandene Anwendungen beim Auftreten eines Analyse Punkts auf Fehler.</span><span class="sxs-lookup"><span data-stu-id="3f3af-238">This misconception is occasionally reflected in application implementations, and as a result, many existing applications hit errors when encountering any reparse point.</span></span>

<span data-ttu-id="3f3af-239">Um dieses Kompatibilitätsproblem zu mindern, verbirgt die Cloud Files-API immer Ihre Analyse Punkte aus allen Anwendungen, mit Ausnahme von Synchronisierungs Modulen und Prozessen, deren Hauptimage unter **% systemroot%** liegt.</span><span class="sxs-lookup"><span data-stu-id="3f3af-239">To mitigate this compatibility issue, the cloud files API always hides its reparse points from all applications except for sync engines and processes whose main image resides under **%systemroot%**.</span></span> <span data-ttu-id="3f3af-240">Anwendungen, die Analyse Punkte korrekt verstehen, können erzwingen, dass die Plattform clouddateien-API-Analyse Punkte mithilfe von [rtlsetprocessplaceholdercompatibilitymode](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-rtlsetprocessplaceholdercompatibilitymode) oder [rtlsetthreadprocessplaceholdercompatibilitymode](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-rtlsetthreadplaceholdercompatibilitymode)verfügbar macht.</span><span class="sxs-lookup"><span data-stu-id="3f3af-240">Applications that understand reparse points correctly can force the platform to expose cloud files API reparse points using [RtlSetProcessPlaceholderCompatibilityMode](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-rtlsetprocessplaceholdercompatibilitymode) or [RtlSetThreadProcessPlaceholderCompatibilityMode](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-rtlsetthreadplaceholdercompatibilitymode).</span></span>