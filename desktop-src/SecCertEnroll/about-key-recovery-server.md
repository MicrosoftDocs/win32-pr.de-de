---
description: Eine Microsoft-Zertifizierungsstelle (Certification Authority, ca) kann so konfiguriert werden, dass Sie den privaten Schlüssel, der dem öffentlichen Schlüssel zugeordnet ist, der in der Zertifikat Anforderung übermittelt wird
ms.assetid: c6535dbf-c3fe-4f70-9a70-02805253a651
title: Schlüssel Wiederherstellungs Server
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b4e9fd60b7ee6596b98953d382978be64695c035
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "103865028"
---
# <a name="key-recovery-server"></a><span data-ttu-id="28d55-103">Schlüssel Wiederherstellungs Server</span><span class="sxs-lookup"><span data-stu-id="28d55-103">Key Recovery Server</span></span>

<span data-ttu-id="28d55-104">Eine Microsoft-Zertifizierungsstelle (Certification Authority, ca) kann so konfiguriert werden, dass Sie den privaten Schlüssel, der dem öffentlichen Schlüssel zugeordnet ist, der in der Zertifikat Anforderung übermittelt wird</span><span class="sxs-lookup"><span data-stu-id="28d55-104">A Microsoft certification authority (CA) can be configured to archive and recover the private key associated with the public key submitted in the certificate request.</span></span> <span data-ttu-id="28d55-105">Die Wiederherstellung ist nützlich, wenn ein Schlüssel verloren geht.</span><span class="sxs-lookup"><span data-stu-id="28d55-105">Recovery is useful if a key is lost.</span></span> <span data-ttu-id="28d55-106">Standardmäßig können nur Verschlüsselungsschlüssel archiviert werden.</span><span class="sxs-lookup"><span data-stu-id="28d55-106">By default, only encryption keys can be archived.</span></span> <span data-ttu-id="28d55-107">Es ist nicht notwendig, Schlüssel zu archivieren, die nur für die Signierung vorgesehen sind, da nur der öffentliche Schlüssel zum Überprüfen einer Signatur benötigt wird, wenn der private Signatur Schlüssel verloren geht.</span><span class="sxs-lookup"><span data-stu-id="28d55-107">It is not necessary to archive keys intended only for signing because only the public key is needed to verify a signature if the private signing key is lost.</span></span>

<span data-ttu-id="28d55-108">Um einen Schlüssel zu archivieren, muss die Zertifizierungsstelle so konfiguriert werden, dass Sie Schlüssel Wiederherstellungs-Agent-Zertifikate (Kra) ausgibt und bereits mindestens eine ausgegeben hat.</span><span class="sxs-lookup"><span data-stu-id="28d55-108">To archive a key, the CA must be configured to issue key recovery agent (KRA) certificates and to have already issued at least one.</span></span> <span data-ttu-id="28d55-109">Ein Schlüsselwiederherstellungs-Agent ist ein Administrator, der von einer Organisation autorisiert ist, private Schlüssel zu entschlüsseln.</span><span class="sxs-lookup"><span data-stu-id="28d55-109">A key recovery agent is an administrator authorized by an organization to decrypt private keys.</span></span> <span data-ttu-id="28d55-110">Zur Erhöhung der Sicherheit wird empfohlen, dass der Schlüsselwiederherstellungs-Agent und die Zertifikat-Manager-Rollen unterschiedlichen Personen zugewiesen werden, dass der Zertifikat-Manager keine archivierten Schlüssel abrufen, aber nicht entschlüsseln darf und dass der Schlüsselwiederherstellungs-Agent die Schlüssel entschlüsseln, aber nicht abrufen kann.</span><span class="sxs-lookup"><span data-stu-id="28d55-110">To enhance security, we recommend that the key recovery agent and the certificate manager roles be assigned to different individuals, that the certificate manager be permitted to retrieve but not decrypt archived keys, and that the key recovery agent be permitted to decrypt keys but not retrieve them.</span></span>

## <a name="key-archival"></a><span data-ttu-id="28d55-111">Schlüssel Archivierung</span><span class="sxs-lookup"><span data-stu-id="28d55-111">Key Archival</span></span>

<span data-ttu-id="28d55-112">Ein Client fordert ein Zertifikat in der Regel mithilfe einer Vorlage an.</span><span class="sxs-lookup"><span data-stu-id="28d55-112">A client typically requests a certificate by using a template.</span></span> <span data-ttu-id="28d55-113">Wenn die Vorlage erfordert, dass der private Schlüssel archiviert wird, werden die folgenden Schritte vom Client und der Zertifizierungsstelle ausgeführt:</span><span class="sxs-lookup"><span data-stu-id="28d55-113">If the template requires that the private key be archived, the following steps are performed by the client and the CA:</span></span>

1.  <span data-ttu-id="28d55-114">Der Client ruft das Exchange-Zertifikat der Zertifizierungsstelle ab und überprüft es, um zu bestimmen, ob es mit demselben Schlüssel signiert wurde, der zum Signieren des Zertifizierungsstellen-Signatur Zertifikats verwendet wurde.</span><span class="sxs-lookup"><span data-stu-id="28d55-114">The client retrieves and validates the CA exchange certificate to determine whether it has been signed by the same key that was used to sign the CA signing certificate.</span></span> <span data-ttu-id="28d55-115">Dadurch wird sichergestellt, dass die einzige Zertifizierungsstelle, die den privaten Schlüssel entschlüsseln kann, die Zertifizierungsstelle ist, von der ein Zertifikat angefordert wird.</span><span class="sxs-lookup"><span data-stu-id="28d55-115">This ensures that the only CA that can decrypt the private key is the CA from which a certificate is being requested.</span></span>
2.  <span data-ttu-id="28d55-116">Der öffentliche Schlüssel im Zertifikat der Zertifizierungsstelle wird verwendet, um den privaten Schlüssel zu verschlüsseln, der der Zertifikat Anforderung zugeordnet ist, und die Anforderung wird an die Zertifizierungsstelle gesendet.</span><span class="sxs-lookup"><span data-stu-id="28d55-116">The public key in the CA exchange certificate is used to encrypt the private key associated with the certificate request, and the request is sent to the CA.</span></span>
3.  <span data-ttu-id="28d55-117">Die Zertifizierungsstelle verwendet den privaten Schlüssel, der mit dem Exchange-Zertifikat verknüpft ist, um den vom Client gesendeten privaten Schlüssel zu entschlüsseln, und überprüft, ob die öffentlichen und privaten Schlüssel in der Anforderung verknüpft sind.</span><span class="sxs-lookup"><span data-stu-id="28d55-117">The CA uses the private key associated with its exchange certificate to decrypt the private key sent by the client and verifies that the public and private keys in the request are related.</span></span>
4.  <span data-ttu-id="28d55-118">Der private Schlüssel wird von der Zertifizierungsstelle mithilfe des öffentlichen Schlüssels im Kra-Zertifikat verschlüsselt.</span><span class="sxs-lookup"><span data-stu-id="28d55-118">The CA encrypts the private key by using the public key in the KRA certificate.</span></span> <span data-ttu-id="28d55-119">Wenn die Zertifizierungsstelle mehrere KRA-Zertifikate ausgestellt hat, wird der private Schlüssel einmal mit jedem verfügbaren öffentlichen Schlüssel verschlüsselt, sodass jeder autorisierte Schlüsselwiederherstellungs-Agent einen Schlüssel wiederherstellen kann.</span><span class="sxs-lookup"><span data-stu-id="28d55-119">If the CA has issued multiple KRA certificates, it encrypts the private key once with each available public key so that any authorized key recovery agent can recover a key.</span></span> <span data-ttu-id="28d55-120">Die verschlüsselten privaten Schlüssel werden in der Zertifikat Datenbank gespeichert.</span><span class="sxs-lookup"><span data-stu-id="28d55-120">The encrypted private keys are stored in the certificate database.</span></span>
5.  <span data-ttu-id="28d55-121">Die Zertifizierungsstelle gibt alle Verweise auf den privaten Schlüssel frei und gibt den gesamten Arbeitsspeicher, der den Schlüssel enthielt, sicher frei.</span><span class="sxs-lookup"><span data-stu-id="28d55-121">The CA releases all references to the private key and securely frees and zeros all memory that contained the key.</span></span> <span data-ttu-id="28d55-122">Dadurch wird sichergestellt, dass die Zertifizierungsstelle keinen weiteren Zugriff auf den Schlüssel im Klartext-Format hat.</span><span class="sxs-lookup"><span data-stu-id="28d55-122">This ensures that the CA has no further access to the key in clear text format.</span></span>

> [!Note]  
> <span data-ttu-id="28d55-123">Nur eine CMC-Anforderung kann für die Schlüssel Archivierung verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="28d55-123">Only a CMC request can be used for key archival.</span></span> <span data-ttu-id="28d55-124">CMC-Anforderungen werden von der [**IX509CertificateRequestCmc**](/windows/desktop/api/CertEnroll/nn-certenroll-ix509certificaterequestcmc) -Schnittstelle dargestellt.</span><span class="sxs-lookup"><span data-stu-id="28d55-124">CMC requests are represented by the [**IX509CertificateRequestCmc**](/windows/desktop/api/CertEnroll/nn-certenroll-ix509certificaterequestcmc) interface.</span></span>

 

## <a name="key-recovery"></a><span data-ttu-id="28d55-125">Schlüsselwiederherstellung</span><span class="sxs-lookup"><span data-stu-id="28d55-125">Key Recovery</span></span>

<span data-ttu-id="28d55-126">Die Schlüsselwiederherstellung wird von Active Directory Zertifikat Diensten oder der Zertifikatregistrierungs-API nicht direkt unterstützt.</span><span class="sxs-lookup"><span data-stu-id="28d55-126">Key recovery is not directly supported by Active Directory Certificate Services or the Certificate Enrollment API.</span></span> <span data-ttu-id="28d55-127">Microsoft stellt jedoch die folgenden Anwendungen bereit, um den Prozess zu unterstützen:</span><span class="sxs-lookup"><span data-stu-id="28d55-127">Microsoft does, however, provide the following applications to help with the process:</span></span>

-   <span data-ttu-id="28d55-128">Certutil.exe ist ein Befehlszeilenprogramm, das zum Abrufen von ca-Konfigurationsinformationen, zum Überprüfen von Zertifikaten, Schlüsselpaaren und Zertifikat Ketten sowie zum Sichern und Wiederherstellen von Schlüsseln verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="28d55-128">Certutil.exe is a command line program that can be used to retrieve CA configuration information, verify certificates, key pairs, and certificate chains, and back up and restore keys.</span></span> <span data-ttu-id="28d55-129">Es ist in Server Betriebssystemen enthalten, die mit Windows Server 2003 beginnen.</span><span class="sxs-lookup"><span data-stu-id="28d55-129">It is included in server operating systems beginning with Windows Server 2003.</span></span>
-   <span data-ttu-id="28d55-130">Krecover.exe ist ein auf einem Dialogfeld – basierendes Programm, das die Schlüsselwiederherstellung ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="28d55-130">Krecover.exe is a dialog box–based program that enables key recovery.</span></span> <span data-ttu-id="28d55-131">Sie ist im Resource Kit ab Windows Server 2003 enthalten.</span><span class="sxs-lookup"><span data-stu-id="28d55-131">It is included with the Resource Kit beginning with Windows Server 2003.</span></span>

<span data-ttu-id="28d55-132">Die folgenden Schritte werden ausgeführt, um einen privaten Schlüssel wiederherzustellen:</span><span class="sxs-lookup"><span data-stu-id="28d55-132">The following steps are performed to recover a private key:</span></span>

1.  <span data-ttu-id="28d55-133">Der Zertifikat-Manager sucht mögliche Kandidaten für die Schlüsselwiederherstellung in der Zertifikat Datenbank, indem er den Namen des Zertifikats, des Anforderers oder des Benutzers verwendet.</span><span class="sxs-lookup"><span data-stu-id="28d55-133">The certificate manager locates potential candidates for key recovery in the certificate database by using the name of the certificate, requester, or user.</span></span> <span data-ttu-id="28d55-134">Der Befehl " **certutil** **-GetKey** " kann zu diesem Zweck verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="28d55-134">The **Certutil** **-getkey** command can be used for this purpose.</span></span>
2.  <span data-ttu-id="28d55-135">Sobald der Zertifikat-Manager über eine Liste von Zertifikaten verfügt, wird der Befehl " **-GetKey** " erneut mit einer bestimmten Zertifikat Seriennummer oder einem Fingerabdruck aufgerufen, um eine PKCS \# 7-Datei abzurufen, die das Kra-Zertifikat, die Benutzerzertifikat Kette und den privaten Schlüssel enthält, der während der Archivierung mit dem öffentlichen KRA-Schlüssel verschlüsselt wurde.</span><span class="sxs-lookup"><span data-stu-id="28d55-135">Once the certificate manager has a list of certificates, the **-getkey** command is called again with a specific certificate serial number or thumb print to retrieve a PKCS \#7 file that contains the KRA certificate, user certificate chain, and the private key that was encrypted during archival by using the KRA public key.</span></span>
3.  <span data-ttu-id="28d55-136">Der Zertifikat-Manager übergibt die Steuerung des Prozesses an den Schlüsselwiederherstellungs-Agent, dessen privater Schlüssel mit dem im Kra-Zertifikat enthaltenen öffentlichen Schlüssel übereinstimmt.</span><span class="sxs-lookup"><span data-stu-id="28d55-136">The certificate manager passes control of the process to the key recovery agent whose private key matches the public key contained in the KRA certificate.</span></span>
4.  <span data-ttu-id="28d55-137">Der Schlüsselwiederherstellungs-Agent entschlüsselt den archivierten privaten Schlüssel, der in der PKCS 7-Datei zurückgegeben wurde, mit \# dem anderen KRA-Schlüssel.</span><span class="sxs-lookup"><span data-stu-id="28d55-137">The key recovery agent decrypts the archived private key returned in the PKCS \#7 file by using the KRA private key.</span></span> <span data-ttu-id="28d55-138">Dies kann mithilfe des Befehls **certutil** **-recoverkey** erfolgen, der den Schlüssel in einer Kenn Wort geschützten PKCS 12- \# Datei platziert.</span><span class="sxs-lookup"><span data-stu-id="28d55-138">This can be done by using the **Certutil** **-recoverkey** command which places the key in a password-protected PKCS \#12 file.</span></span> <span data-ttu-id="28d55-139">Der Client muss das Kennwort über einen sicheren out-of-Band-Mechanismus erhalten.</span><span class="sxs-lookup"><span data-stu-id="28d55-139">The client must be given the password through a secure out-of-band mechanism.</span></span>
5.  <span data-ttu-id="28d55-140">Der Client importiert die PKCS \# 12-Datei und verwendet das Kennwort zum Abrufen des Schlüssels.</span><span class="sxs-lookup"><span data-stu-id="28d55-140">The client imports the PKCS \#12 file and uses the password to retrieve the key.</span></span>

## <a name="related-topics"></a><span data-ttu-id="28d55-141">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="28d55-141">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="28d55-142">PKI-Elemente</span><span class="sxs-lookup"><span data-stu-id="28d55-142">PKI Elements</span></span>](about-pki-components.md)
</dt> </dl>

 

 



