---
title: Wie AMSI Ihnen hilft, gegen Schadsoftware zu schützen
description: Als Anwendungsentwickler können Sie aktiv an der Abwehr von Schadsoftware teilnehmen. Insbesondere können Sie Ihre Kunden vor dynamischer Skript basierter Schadsoftware und vor nicht herkömmlichen Wege von Cyberangriffen schützen.
ms.topic: article
ms.date: 02/27/2019
ms.openlocfilehash: 0d6aee30034312073123f5ab14b1924fd01e6eac
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/16/2019
ms.locfileid: "103708148"
---
# <a name="how-the-antimalware-scan-interface-amsi-helps-you-defend-against-malware"></a><span data-ttu-id="c62a5-104">Wie die Antimalware-Scan Schnittstelle (AMSI) Sie bei der Verteidigung gegen Schadsoftware unterstützt</span><span class="sxs-lookup"><span data-stu-id="c62a5-104">How the Antimalware Scan Interface (AMSI) helps you defend against malware</span></span>

<span data-ttu-id="c62a5-105">Eine Einführung in die Windows Antimalware Scan Interface (AMSI) finden Sie unter [Antimalware Scan Interface (AMSI)](antimalware-scan-interface-portal.md).</span><span class="sxs-lookup"><span data-stu-id="c62a5-105">For an introduction to the Windows Antimalware Scan Interface (AMSI), see [Antimalware Scan Interface (AMSI)](antimalware-scan-interface-portal.md).</span></span>

<span data-ttu-id="c62a5-106">Als Anwendungsentwickler können Sie aktiv an der Abwehr von Schadsoftware teilnehmen.</span><span class="sxs-lookup"><span data-stu-id="c62a5-106">As an application developer, you can actively participate in malware defense.</span></span> <span data-ttu-id="c62a5-107">Insbesondere können Sie Ihre Kunden vor dynamischer Skript basierter Schadsoftware und vor nicht herkömmlichen Wege von Cyberangriffen schützen.</span><span class="sxs-lookup"><span data-stu-id="c62a5-107">Specifically, you can help protect your customers from dynamic script-based malware, and from non-traditional avenues of cyberattack.</span></span>

<span data-ttu-id="c62a5-108">Angenommen, die Anwendung ist skriptfähig: Sie akzeptiert ein beliebiges Skript und führt Sie über eine Skript-Engine aus.</span><span class="sxs-lookup"><span data-stu-id="c62a5-108">By way of an example, let's say that your application is scriptable: it accepts arbitrary script, and executes it via a scripting engine.</span></span> <span data-ttu-id="c62a5-109">Wenn ein Skript für die Bereitstellung an die Skript-Engine bereit ist, kann die Anwendung die Windows AMSI-APIs aufzurufen, um eine Überprüfung des Inhalts anzufordern.</span><span class="sxs-lookup"><span data-stu-id="c62a5-109">At the point when a script is ready to be supplied to the scripting engine, your application can call the Windows AMSI APIs to request a scan of the content.</span></span> <span data-ttu-id="c62a5-110">Auf diese Weise können Sie sicher ermitteln, ob das Skript bösartig ist, bevor Sie es ausführen.</span><span class="sxs-lookup"><span data-stu-id="c62a5-110">That way, you can safely determine whether or not the script is malicious before you decide to go ahead and execute it.</span></span>

<span data-ttu-id="c62a5-111">Dies gilt auch, wenn das Skript zur Laufzeit generiert wurde.</span><span class="sxs-lookup"><span data-stu-id="c62a5-111">This is true even if the script was generated at runtime.</span></span> <span data-ttu-id="c62a5-112">Skript (bösartig oder anderweitig), kann mehrere Durchgänge von "de-obfuscess" durchlaufen.</span><span class="sxs-lookup"><span data-stu-id="c62a5-112">Script (malicious or otherwise), might go through several passes of de-obfuscation.</span></span> <span data-ttu-id="c62a5-113">Letztendlich müssen Sie die Skript-Engine jedoch mit reinem, nicht verarbeittem Code bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="c62a5-113">But you ultimately need to supply the scripting engine with plain, un-obfuscated code.</span></span> <span data-ttu-id="c62a5-114">Und das ist der Punkt, an dem Sie die AMSI-APIs aufrufen.</span><span class="sxs-lookup"><span data-stu-id="c62a5-114">And that's the point at which you invoke the AMSI APIs.</span></span>

<span data-ttu-id="c62a5-115">Hier sehen Sie eine Abbildung der AMSI-Architektur, bei der Ihre eigene Anwendung durch eines der Felder "andere Anwendung" dargestellt wird.</span><span class="sxs-lookup"><span data-stu-id="c62a5-115">Here's an illustration of the AMSI architecture, where your own application is represented by one of the "Other Application" boxes.</span></span>

![die AMSI-Architektur](images/AMSI7Archi.jpg)

<span data-ttu-id="c62a5-117">Die Windows AMSI-Schnittstelle ist geöffnet.</span><span class="sxs-lookup"><span data-stu-id="c62a5-117">The Windows AMSI interface is open.</span></span> <span data-ttu-id="c62a5-118">Dies bedeutet, dass jede Anwendung Sie anrufen kann. und alle registrierten antischadsoftwaremodule können die an Sie gesendeten Inhalte verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="c62a5-118">Which means that any application can call it; and any registered Antimalware engine can process the content submitted to it.</span></span>

<span data-ttu-id="c62a5-119">Wir dürfen die Diskussion nicht auf die Skript-Engines beschränken.</span><span class="sxs-lookup"><span data-stu-id="c62a5-119">We needn't limit the discussion to scripting engines, either.</span></span> <span data-ttu-id="c62a5-120">Möglicherweise handelt es sich bei Ihrer Anwendung um eine Kommunikations-APP, die sofort Nachrichten auf Viren scannt, bevor Sie Sie Ihren Kunden anzeigt.</span><span class="sxs-lookup"><span data-stu-id="c62a5-120">Perhaps your application is a communication app, and it scans instant messages for viruses before it shows them to your customers.</span></span> <span data-ttu-id="c62a5-121">Oder vielleicht ist Ihre Software ein Spiel, das Plug-ins vor der Installation überprüft.</span><span class="sxs-lookup"><span data-stu-id="c62a5-121">Or maybe your software is a game that validates plugins before installing them.</span></span> <span data-ttu-id="c62a5-122">Es gibt zahlreiche Möglichkeiten und Szenarios für die Verwendung von AMSI.</span><span class="sxs-lookup"><span data-stu-id="c62a5-122">There are plenty of opportunities and scenarios for using AMSI.</span></span>

## <a name="amsi-in-action"></a><span data-ttu-id="c62a5-123">AMSI in Aktion</span><span class="sxs-lookup"><span data-stu-id="c62a5-123">AMSI in action</span></span>

<span data-ttu-id="c62a5-124">Werfen wir einen Blick auf AMSI in Action.</span><span class="sxs-lookup"><span data-stu-id="c62a5-124">Let's take a look at AMSI in action.</span></span> <span data-ttu-id="c62a5-125">In diesem Beispiel ist Windows Defender die Anwendung, die AMSI-APIs aufruft.</span><span class="sxs-lookup"><span data-stu-id="c62a5-125">In this example, Windows Defender is the application that's calling AMSI APIs.</span></span> <span data-ttu-id="c62a5-126">Sie können jedoch dieselben APIs in ihrer eigenen Anwendung abrufen.</span><span class="sxs-lookup"><span data-stu-id="c62a5-126">But you can call the same APIs from within your own application.</span></span>

<span data-ttu-id="c62a5-127">Im folgenden finden Sie ein Beispiel für ein Skript, das die XOR-Encoding-Technik verwendet, um die Absicht auszublenden (ob diese Absicht harmlos ist oder nicht).</span><span class="sxs-lookup"><span data-stu-id="c62a5-127">Here's a sample of a script that uses the XOR-encoding technique to hide its intent (whether that intent is benign or not).</span></span> <span data-ttu-id="c62a5-128">Diese Abbildung zeigt, dass das Skript aus dem Internet heruntergeladen wurde.</span><span class="sxs-lookup"><span data-stu-id="c62a5-128">For this illustration, we can imagine that this script was downloaded from the Internet.</span></span>

![in Base64 codiertes Beispielskript](images/AMSI8.png)

<span data-ttu-id="c62a5-130">Um die Dinge interessanter zu machen, können wir dieses Skript manuell in der Befehlszeile eingeben, damit keine Datei vorhanden ist, die überwacht werden kann.</span><span class="sxs-lookup"><span data-stu-id="c62a5-130">To make things more interesting, we can enter this script manually at the command line so that there is no actual file to monitor.</span></span> <span data-ttu-id="c62a5-131">Dies spiegelt den sogenannten "filless Threat" wider.</span><span class="sxs-lookup"><span data-stu-id="c62a5-131">This mirrors what's known as a "fileless threat".</span></span> <span data-ttu-id="c62a5-132">Es ist nicht so einfach wie das Scannen von Dateien auf dem Datenträger.</span><span class="sxs-lookup"><span data-stu-id="c62a5-132">It's not as simple as scanning files on disk.</span></span> <span data-ttu-id="c62a5-133">Die Bedrohung könnte eine Hintertür sein, die sich nur im Arbeitsspeicher eines Computers befindet.</span><span class="sxs-lookup"><span data-stu-id="c62a5-133">The threat might be a backdoor that lives only in the memory of a machine.</span></span>

<span data-ttu-id="c62a5-134">Im folgenden sehen Sie das Ergebnis der Ausführung des Skripts in Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="c62a5-134">Below, we see the result of running the script in Windows PowerShell.</span></span> <span data-ttu-id="c62a5-135">Sie werden feststellen, dass Windows Defender das AMSI-Testbeispiel in diesem komplizierten Szenario erkennen kann, indem Sie lediglich die standardmäßige AMSI-Testbeispiel Signatur verwenden.</span><span class="sxs-lookup"><span data-stu-id="c62a5-135">You'll see that Windows Defender is able to detect the AMSI test sample in this complicated scenario, merely by using the standard AMSI test sample signature.</span></span>

![Erkennen des AMSI-Test Beispiels durch Windows Defender](images/AMSI9proper.png)

## <a name="amsi-integration-with-javascriptvba"></a><span data-ttu-id="c62a5-137">AMSI-Integration in JavaScript/VBA</span><span class="sxs-lookup"><span data-stu-id="c62a5-137">AMSI integration with JavaScript/VBA</span></span>

<span data-ttu-id="c62a5-138">Der dargestellte Workflow unten beschreibt den End-to-End-Ablauf eines anderen Beispiels, in dem wir die Integration von AMSI in die Makro Ausführung innerhalb Microsoft Office veranschaulichen.</span><span class="sxs-lookup"><span data-stu-id="c62a5-138">The illustrated workflow below describes the end-to-end flow of another example, in which we demonstrate AMSI's integration with macro execution within Microsoft Office.</span></span>

![AMSI-Integration in JavaScript/VBA](images/integ-js-vba.png)

- <span data-ttu-id="c62a5-140">Der Benutzer erhält ein Dokument mit einem (bösartigen) Makro, das statische Antivirussoftware-Scans durch die Verwendung von Techniken wie Verschleierung, Kenn Wort geschützter Dateien oder anderen eingibt.</span><span class="sxs-lookup"><span data-stu-id="c62a5-140">The user receives a document containing a (malicious) macro, which evades static antivirus software scans by employing techniques such as obfuscation, password-protected files, or other.</span></span>
- <span data-ttu-id="c62a5-141">Der Benutzer öffnet dann das Dokument mit dem (bösartigen) Makro.</span><span class="sxs-lookup"><span data-stu-id="c62a5-141">The user then opens the document containing the (malicious) macro.</span></span> <span data-ttu-id="c62a5-142">Wenn das Dokument in der geschützten Ansicht geöffnet wird, klickt der Benutzer auf **Bearbeitung aktivieren** , um die geschützte Ansicht zu beenden.</span><span class="sxs-lookup"><span data-stu-id="c62a5-142">If the document opens in Protected View, then the user clicks **Enable Editing** to exit Protected View.</span></span>
- <span data-ttu-id="c62a5-143">Der Benutzer klickt auf **Makros aktivieren** , um das Ausführen von Makros zuzulassen.</span><span class="sxs-lookup"><span data-stu-id="c62a5-143">The user clicks **Enable Macros** to allow macros to run.</span></span>
- <span data-ttu-id="c62a5-144">Beim Ausführen des Makros verwendet die VBA-Laufzeit einen Zirkel Puffer, um \[ 1 \] Daten und Parameter zu protokollieren, die sich auf Aufrufe von Win32-, com-und VBA-APIs beziehen.</span><span class="sxs-lookup"><span data-stu-id="c62a5-144">As the macro runs, the VBA runtime uses a circular buffer to log \[1\] data and parameters related to calls to Win32, COM, and VBA APIs.</span></span>
- <span data-ttu-id="c62a5-145">Wenn bestimmte Win32-oder COM-APIs, die als ein hohes Risiko angesehen werden (auch als *Trigger* bezeichnet) \[ \] , beobachtet werden, wird die Makro Ausführung angehalten, und der Inhalt des Zirkel Puffers wird an AMSI übermittelt.</span><span class="sxs-lookup"><span data-stu-id="c62a5-145">When specific Win32 or COM APIs that are considered high risk (also known as *triggers*) \[2\] are observed, macro execution is halted, and the contents of the circular buffer are passed to AMSI.</span></span>
- <span data-ttu-id="c62a5-146">Der registrierte AMSI Anti-Malware-Dienstanbieter antwortet mit einem Urteil, um anzugeben, ob das Makro Verhalten bösartig ist.</span><span class="sxs-lookup"><span data-stu-id="c62a5-146">The registered AMSI anti-malware service provider responds with a verdict to indicate whether or not the macro behavior is malicious.</span></span>
- <span data-ttu-id="c62a5-147">Wenn das Verhalten nicht bösartig ist, wird die Makro Ausführung fortgesetzt.</span><span class="sxs-lookup"><span data-stu-id="c62a5-147">If the behavior is non-malicious, then macro execution proceeds.</span></span>
- <span data-ttu-id="c62a5-148">Andernfalls schließt Microsoft Office die Sitzung in Reaktion auf die Warnung \[ 3 \] , und die AV kann die Datei unter Quarantäne stellen, wenn das Verhalten bösartig ist.</span><span class="sxs-lookup"><span data-stu-id="c62a5-148">Otherwise, if the behavior is malicious, then Microsoft Office closes the session in response to the alert \[3\], and the AV can quarantine the file.</span></span>

## <a name="what-does-this-mean-for-you"></a><span data-ttu-id="c62a5-149">Was bedeutet dies für Sie?</span><span class="sxs-lookup"><span data-stu-id="c62a5-149">What does this mean for you?</span></span>

<span data-ttu-id="c62a5-150">Für Windows-Benutzer werden Schadsoftware, die obfuskations-und ausweibungs Techniken auf den integrierten Skripting-Hosts von Windows 10 verwendet, automatisch auf eine viel tiefere Ebene als je zuvor überprüft, was zusätzliche Schutzstufen bietet.</span><span class="sxs-lookup"><span data-stu-id="c62a5-150">For Windows users, any malicious software that uses obfuscation and evasion techniques on Windows 10's built-in scripting hosts is automatically inspected at a much deeper level than ever before, providing additional levels of protection.</span></span>

<span data-ttu-id="c62a5-151">Für Sie als Anwendungsentwickler sollten Sie in Erwägung gezogen haben, dass Ihre Anwendung die Windows AMSI-Schnittstelle aufruft, wenn Sie von der zusätzlichen Überprüfung und Analyse von potenziell schädlichem Inhalt profitieren möchten (und ihre Kunden mit schützen).</span><span class="sxs-lookup"><span data-stu-id="c62a5-151">For you as an application developer, consider having your application call the Windows AMSI interface if you want to benefit from (and protect your customers with) extra scanning and analysis of potentially malicious content.</span></span>

<span data-ttu-id="c62a5-152">Als Antivirussoftware-Anbieter können Sie die Unterstützung für die AMSI-Schnittstelle implementieren.</span><span class="sxs-lookup"><span data-stu-id="c62a5-152">As an antivirus software vendor, you can consider implementing support for the AMSI interface.</span></span> <span data-ttu-id="c62a5-153">Wenn Sie dies tun, bietet die Engine viel tieferen Einblick in die Daten, die Anwendungen (einschließlich integrierter Skript Erstellungs Hosts von Windows 10) potenziell bösartig sind.</span><span class="sxs-lookup"><span data-stu-id="c62a5-153">When you do, your engine will have much deeper insight into the data that applications (including Windows 10's built-in scripting hosts) consider to be potentially malicious.</span></span>

## <a name="more-background-info-about-fileless-threats"></a><span data-ttu-id="c62a5-154">Weitere Hintergrundinformationen zu filterlosen Bedrohungen</span><span class="sxs-lookup"><span data-stu-id="c62a5-154">More background info about fileless threats</span></span>

<span data-ttu-id="c62a5-155">Sie sind möglicherweise neugierig auf Weitere Hintergrundinformationen zu den Arten von Filtern, die von Windows AMSI entwickelt wurden, um Sie Gegenmaßnahmen zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="c62a5-155">You may be curious for more background info about the kinds of fileless threats that Windows AMSI is designed to help you defend against.</span></span> <span data-ttu-id="c62a5-156">In diesem Abschnitt sehen wir uns das herkömmliche Cat-and-Mouse-Spiel an, das sich im Malware Ökosystem abspielt.</span><span class="sxs-lookup"><span data-stu-id="c62a5-156">In this section, we'll take a look at the traditional cat-and-mouse game that plays out in the malware ecosystem.</span></span>

<span data-ttu-id="c62a5-157">Wir verwenden PowerShell als Beispiel.</span><span class="sxs-lookup"><span data-stu-id="c62a5-157">We'll use PowerShell as an example.</span></span> <span data-ttu-id="c62a5-158">Sie können jedoch dieselben Techniken und Prozesse nutzen, die wir mit jeder dynamischen Sprache &mdash; VBScript, Perl, Python, Ruby und mehr veranschaulichen.</span><span class="sxs-lookup"><span data-stu-id="c62a5-158">But you can leverage the same techniques and processes we'll demonstrate with any dynamic language&mdash;VBScript, Perl, Python, Ruby, and more.</span></span>

<span data-ttu-id="c62a5-159">Im folgenden finden Sie ein Beispiel für ein schädliches PowerShell-Skript.</span><span class="sxs-lookup"><span data-stu-id="c62a5-159">Here's an example of a malicious PowerShell script.</span></span>

![Beispiel eines bösartigen PowerShell-Skripts](images/AMSI1.png)

<span data-ttu-id="c62a5-161">Obwohl mit diesem Skript lediglich eine Meldung auf den Bildschirm geschrieben wird, ist Schadsoftware in der Regel eher fehlerfrei.</span><span class="sxs-lookup"><span data-stu-id="c62a5-161">While this script simply writes a message to the screen, malware is typically more nefarious.</span></span> <span data-ttu-id="c62a5-162">Sie können jedoch problemlos eine Signatur schreiben, um diese zu erkennen.</span><span class="sxs-lookup"><span data-stu-id="c62a5-162">But you could easily write a signature to detect this one.</span></span> <span data-ttu-id="c62a5-163">Die Signatur könnte z. b. nach der Zeichenfolge "Write-Host" pwnd! "" suchen.</span><span class="sxs-lookup"><span data-stu-id="c62a5-163">For example, the signature could search for the string "Write-Host 'pwnd!'"</span></span> <span data-ttu-id="c62a5-164">in jeder Datei, die der Benutzer öffnet.</span><span class="sxs-lookup"><span data-stu-id="c62a5-164">in any file that the user opens.</span></span> <span data-ttu-id="c62a5-165">Großartig: Wir haben unsere erste Schadsoftware erkannt!</span><span class="sxs-lookup"><span data-stu-id="c62a5-165">Great: we've detected our first malware!</span></span>

<span data-ttu-id="c62a5-166">Nachdem die erste Signatur erkannt wurde, reagieren die Autoren von Schadsoftware.</span><span class="sxs-lookup"><span data-stu-id="c62a5-166">After being detected by our first signature, though, malware authors will respond.</span></span> <span data-ttu-id="c62a5-167">Sie reagieren, indem Sie dynamische Skripts wie in diesem Beispiel erstellen.</span><span class="sxs-lookup"><span data-stu-id="c62a5-167">They respond by creating dynamic scripts such as this example.</span></span>

![ein Beispiel für ein dynamisches Skript](images/AMSI2.png)

<span data-ttu-id="c62a5-169">In diesem Szenario erstellen Autoren von Schadsoftware eine Zeichenfolge, die das auszuführen PowerShell-Skript darstellt.</span><span class="sxs-lookup"><span data-stu-id="c62a5-169">In that scenario, malware authors create a string representing the PowerShell script to run.</span></span> <span data-ttu-id="c62a5-170">Sie verwenden jedoch eine einfache Verkettung von Zeichen folgen, um die frühere Signatur zu unterbrechen.</span><span class="sxs-lookup"><span data-stu-id="c62a5-170">But they use a simple string concatenation technique to break our earlier signature.</span></span> <span data-ttu-id="c62a5-171">Wenn Sie jemals die Quelle einer AD-geladenen Webseite anzeigen, sehen Sie viele Instanzen dieser Technik, die verwendet werden, um AD-blockierende Software zu vermeiden.</span><span class="sxs-lookup"><span data-stu-id="c62a5-171">If you ever view the source of an ad-laden web page, you'll see many instances of this technique being used to avoid ad-blocking software.</span></span>

<span data-ttu-id="c62a5-172">Schließlich übergibt der Autor der Malware diese verketteten Zeichenfolge an den `Invoke-Expression` &mdash; PowerShell-Cmdlet-Mechanismus, um Skripts auszuwerten, die zur Laufzeit erstellt oder erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="c62a5-172">Finally, the malware author passes this concatenated string to the `Invoke-Expression` cmdlet&mdash;PowerShell's mechanism to evaluate scripts that are composed or created at runtime.</span></span>

<span data-ttu-id="c62a5-173">Als Reaktion auf die Antischadsoftware beginnt eine einfache sprach Emulation.</span><span class="sxs-lookup"><span data-stu-id="c62a5-173">In response, antimalware software starts to do basic language emulation.</span></span> <span data-ttu-id="c62a5-174">Wenn z. b. zwei Zeichen folgen verkettet werden, emulieren wir die Verkettung dieser beiden Zeichen folgen und führen dann unsere Signaturen für das Ergebnis aus.</span><span class="sxs-lookup"><span data-stu-id="c62a5-174">For example, if we see two strings being concatenated, then we emulate the concatenation of those two strings, and then run our signatures on the result.</span></span> <span data-ttu-id="c62a5-175">Leider ist dies ein ziemlich zerbrechlicher Ansatz, da Sprachen in der Regel über viele Möglichkeiten zum darstellen und Verketten von Zeichen folgen verfügen.</span><span class="sxs-lookup"><span data-stu-id="c62a5-175">Unfortunately, this is a fairly fragile approach, because languages tend to have a lot of ways to represent and concatenate strings.</span></span>

<span data-ttu-id="c62a5-176">Nach dem abgefangen durch diese Signatur werden schadsoftwareautoren z. b. zu etwas komplizierteren, &mdash; z. b. zum Codieren von Skript Inhalten in Base64, wie im folgenden Beispiel gezeigt.</span><span class="sxs-lookup"><span data-stu-id="c62a5-176">So, after being caught by this signature, malware authors will move to something more complicated&mdash;for example, encoding script content in Base64, as in this next example.</span></span>

![Beispiel für Skript Inhalt in Base64](images/AMSI3.png)

<span data-ttu-id="c62a5-178">Die meisten antischadsoftwaremodule implementieren auch die Base64-Decodierung, damit Sie ressourcenintensiv sind.</span><span class="sxs-lookup"><span data-stu-id="c62a5-178">Being resourceful, most antimalware engines implement Base64 decoding emulation, as well.</span></span> <span data-ttu-id="c62a5-179">Da wir außerdem eine Base64-Decodierung der Emulation implementieren, sind wir für einen Zeitraum im voraus.</span><span class="sxs-lookup"><span data-stu-id="c62a5-179">So, since we also implement Base64 decoding emulation, we're ahead for a time.</span></span>

<span data-ttu-id="c62a5-180">In der Antwort werden schadsoftwareautoren in algorithmische Verschleierung verschoben, &mdash; z. b. ein einfacher XOR-Codierungs Mechanismus in den Skripts, die Sie ausführen.</span><span class="sxs-lookup"><span data-stu-id="c62a5-180">In response, malware authors move to algorithmic obfuscation&mdash;such as a simple XOR-encoding mechanism in the scripts they run.</span></span>

![Beispiel eines algorithmischen Verschleierung-Skripts](images/AMSI4.png)

<span data-ttu-id="c62a5-182">An diesem Punkt liegt es in der Regel daran, dass Antivirenmodule emuliert oder erkannt werden, sodass wir nicht unbedingt erkennen, was dieses Skript macht.</span><span class="sxs-lookup"><span data-stu-id="c62a5-182">At this point, we're generally past what antivirus engines will emulate or detect, so we won't necessarily detect what this script is doing.</span></span> <span data-ttu-id="c62a5-183">Wir können jedoch mit dem Schreiben von Signaturen für die obfuskations-und Codierungsverfahren beginnen.</span><span class="sxs-lookup"><span data-stu-id="c62a5-183">However, we can start to write signatures against the obfuscation and encoding techniques.</span></span> <span data-ttu-id="c62a5-184">Tatsächlich handelt es sich dabei um die meisten Signaturen für skriptbasierte Schadsoftware.</span><span class="sxs-lookup"><span data-stu-id="c62a5-184">In fact, that's what accounts for the vast majority of signatures for script-based malware.</span></span>

<span data-ttu-id="c62a5-185">Aber was ist, wenn der Obfuscator so trivial ist, dass er viele gut verhaltene Skripts sieht?</span><span class="sxs-lookup"><span data-stu-id="c62a5-185">But what if the obfuscator is so trivial that it looks like many well-behaved scripts?</span></span> <span data-ttu-id="c62a5-186">Eine Signatur dafür würde eine akzeptable Anzahl falsch positiver Ergebnisse generieren.</span><span class="sxs-lookup"><span data-stu-id="c62a5-186">A signature for it would generate an unacceptable number of false positives.</span></span> <span data-ttu-id="c62a5-187">Im folgenden finden Sie ein Beispiel für ein *Stager* -Skript, das zu harmlos ist, um selbst zu erkennen.</span><span class="sxs-lookup"><span data-stu-id="c62a5-187">Here's a sample *stager* script that's too benign to detect on its own.</span></span>

![ein Beispiel für ein Stager-Skript, das zu unschädlich ist, um eigenständig zu erkennen](images/AMSI5.png)

<span data-ttu-id="c62a5-189">In diesem Beispiel wird eine Webseite heruntergeladen und ein Teil des Inhalts aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="c62a5-189">In that example, we're downloading a web page, and invoking some content from it.</span></span> <span data-ttu-id="c62a5-190">Dies ist die Entsprechung in Visual Basic Skripts.</span><span class="sxs-lookup"><span data-stu-id="c62a5-190">Here's the equivalent in Visual Basic script.</span></span>

![die Entsprechung in Visual Basic Skript](images/AMSI6.png)

<span data-ttu-id="c62a5-192">In beiden Beispielen wird durch das Antivirenmodul überprüft, ob Dateien vom Benutzer geöffnet werden.</span><span class="sxs-lookup"><span data-stu-id="c62a5-192">What makes things worse in both of these examples is that the antivirus engine inspects files being opened by the user.</span></span> <span data-ttu-id="c62a5-193">Wenn der schädliche Inhalt nur im Arbeitsspeicher vorhanden ist, kann der Angriff potenziell nicht erkannt werden.</span><span class="sxs-lookup"><span data-stu-id="c62a5-193">If the malicious content lives only in memory, then the attack can potentially go undetected.</span></span>

<span data-ttu-id="c62a5-194">In diesem Abschnitt wurden die Einschränkungen der Erkennung mithilfe herkömmlicher Signaturen aufgezeigt.</span><span class="sxs-lookup"><span data-stu-id="c62a5-194">This section showed the limitations of detection using traditional signatures.</span></span> <span data-ttu-id="c62a5-195">Obwohl ein bösartiges Skript mehrere Durchgänge von "de-obfuscting" durchlaufen kann, muss es letztendlich die Skript-Engine mit reinem, nicht übergreifendem Code bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="c62a5-195">But, while a malicious script might go through several passes of de-obfuscation, it ultimately needs to supply the scripting engine with plain, unobfuscated code.</span></span> <span data-ttu-id="c62a5-196">Und zu diesem Zeitpunkt, &mdash; wie wir im ersten Abschnitt oberhalb der &mdash; von Windows 10 integrierten Skript Hosts beschrieben werden, werden die AMSI-APIs aufgerufen, um eine Überprüfung dieses ungeschützten Inhalts anzufordern.</span><span class="sxs-lookup"><span data-stu-id="c62a5-196">And at that point&mdash;as we described in the first section above&mdash;Windows 10's built-in scripting hosts call the AMSI APIs to request a scan of this unprotected content.</span></span> <span data-ttu-id="c62a5-197">Und Ihre Anwendung kann dasselbe tun.</span><span class="sxs-lookup"><span data-stu-id="c62a5-197">And your application can do the same thing.</span></span>

## <a name="related-resources"></a><span data-ttu-id="c62a5-198">Zugehörige Ressourcen</span><span class="sxs-lookup"><span data-stu-id="c62a5-198">Related resources</span></span>

* [<span data-ttu-id="c62a5-199">Filterlose Bedrohungen</span><span class="sxs-lookup"><span data-stu-id="c62a5-199">Fileless threats</span></span>](/windows/security/threat-protection/intelligence/fileless-threats)
* [<span data-ttu-id="c62a5-200">Office VBA + AMSI: der Schleier wird bei bösartigen Makros getrennt</span><span class="sxs-lookup"><span data-stu-id="c62a5-200">Office VBA + AMSI: Parting the veil on malicious macros</span></span>](https://cloudblogs.microsoft.com/microsoftsecure/2018/09/12/office-vba-amsi-parting-the-veil-on-malicious-macros/)
* [<span data-ttu-id="c62a5-201">Nicht sichtbar, aber nicht unsichtbar: Bekämpfung von nicht sichtbaren Schadsoftware mit Verhaltens Überwachung, AMSI und Next-Gen-AV</span><span class="sxs-lookup"><span data-stu-id="c62a5-201">Out of sight but not invisible: Defeating fileless malware with behavior monitoring, AMSI, and next-gen AV</span></span>](https://cloudblogs.microsoft.com/microsoftsecure/2018/09/27/out-of-sight-but-not-invisible-defeating-fileless-malware-with-behavior-monitoring-amsi-and-next-gen-av/)
