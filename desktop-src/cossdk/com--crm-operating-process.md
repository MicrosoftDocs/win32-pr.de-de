---
description: Com+-CRM-Betriebs Prozess
ms.assetid: be50912e-b9fd-4ef7-b81a-e37617a96955
title: Com+-CRM-Betriebs Prozess
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d39dba3dedcbdefebe0f62144547ebb6985fa51f
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "103861636"
---
# <a name="com-crm-operating-process"></a><span data-ttu-id="2abc0-103">Com+-CRM-Betriebs Prozess</span><span class="sxs-lookup"><span data-stu-id="2abc0-103">COM+ CRM Operating Process</span></span>

<span data-ttu-id="2abc0-104">Im normalen Betrieb würde eine Anwendungs Komponente, die in einem Server Anwendungsprozess ausgeführt wird, ein com+-CRM verwenden, indem ein CRM-Worker erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="2abc0-104">In normal operation, an application component running in a server application process would use a COM+ CRM by creating a CRM worker.</span></span> <span data-ttu-id="2abc0-105">Der CRM-Worker implementiert eine spezifische com-Schnittstelle für den Task, der durchgeführt werden soll.</span><span class="sxs-lookup"><span data-stu-id="2abc0-105">The CRM worker implements a COM interface specific to the task it is designed to perform.</span></span> <span data-ttu-id="2abc0-106">Die Anwendungs Komponente muss unter einer Transaktion ausgeführt werden, damit der CRM-Worker die Transaktion der Anwendungs Komponente erbt.</span><span class="sxs-lookup"><span data-stu-id="2abc0-106">The application component must be running under a transaction so that the CRM worker inherits the transaction of the application component.</span></span> <span data-ttu-id="2abc0-107">CRM-Worker benötigen immer eine Transaktion.</span><span class="sxs-lookup"><span data-stu-id="2abc0-107">CRM workers always require a transaction.</span></span>

<span data-ttu-id="2abc0-108">Für den Zugriff auf com+ CRM erhält der CRM-Worker zunächst die [**icrmlogcontrol**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmlogcontrol) -Schnittstelle, die es dem CRM-Worker ermöglicht, Datensätze in das permanente Protokoll zu schreiben.</span><span class="sxs-lookup"><span data-stu-id="2abc0-108">To access the COM+ CRM, the CRM worker first obtains the [**ICrmLogControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmlogcontrol) interface, which allows the CRM worker to write records to the durable log.</span></span> <span data-ttu-id="2abc0-109">Der CRM-Worker erhält diese Schnittstelle, indem er eine CRM Clerk-Komponente erstellt.</span><span class="sxs-lookup"><span data-stu-id="2abc0-109">The CRM worker obtains this interface by creating a CRM clerk component.</span></span>

<span data-ttu-id="2abc0-110">Als nächstes muss der CRM-Worker dem CRM-Clerk den Namen des CRM-kompenators mitteilen, den er verwenden möchte.</span><span class="sxs-lookup"><span data-stu-id="2abc0-110">Next the CRM worker must tell the CRM clerk the name of the CRM Compensator it wants to use.</span></span> <span data-ttu-id="2abc0-111">Dies erfolgt durch Aufrufen der [**icrmlogcontrol:: RegisterCompensator**](/windows/desktop/api/ComSvcs/nf-comsvcs-icrmlogcontrol-registercompensator) -Methode.</span><span class="sxs-lookup"><span data-stu-id="2abc0-111">It does this by calling the [**ICrmLogControl::RegisterCompensator**](/windows/desktop/api/ComSvcs/nf-comsvcs-icrmlogcontrol-registercompensator) method.</span></span> <span data-ttu-id="2abc0-112">Nachdem diese Methode aufgerufen wurde, wird der CRM-Compensator von der CRM-Infrastruktur erstellt, wenn die Transaktion abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="2abc0-112">After this method is called, the CRM Compensator is created by the CRM infrastructure when the transaction completes.</span></span>

<span data-ttu-id="2abc0-113">Nachdem der CRM-Worker seinen CRM-Kompensierungs Dienst registriert hat, kann er mithilfe von [**icrmlogcontrol**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmlogcontrol)Datensätze in das CRM-Protokoll schreiben.</span><span class="sxs-lookup"><span data-stu-id="2abc0-113">After the CRM worker has registered its CRM Compensator, it can write records to the CRM log using [**ICrmLogControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmlogcontrol).</span></span> <span data-ttu-id="2abc0-114">Der CRM-Worker muss in den *Schreibvorgang schreiben*. Das heißt, es muss einen Datensatz in das Protokoll schreiben, der eine Aktion beschreibt, bevor die Aktion ausgeführt wird, falls ein Absturz unmittelbar nach dem Abschließen der Aktion auftritt.</span><span class="sxs-lookup"><span data-stu-id="2abc0-114">The CRM worker must *write ahead*; that is, it must write a record to the log describing an action before it actually performs the action, in case a crash occurs immediately after completing the action.</span></span> <span data-ttu-id="2abc0-115">Ohne diese Write-Ahead-Protokolldaten Sätze gibt es keine Möglichkeit, für die Aktion zu korrigieren.</span><span class="sxs-lookup"><span data-stu-id="2abc0-115">Without these write-ahead log records, there is no way to correct for the action.</span></span>

<span data-ttu-id="2abc0-116">Außerdem bedeutet Write Ahead, dass der CRM-Compensator, der die Komponente ist, die die Protokolldaten Sätze bei der Wiederherstellung empfängt, den Fall behandeln muss, in dem die Protokolldaten Sätze geschrieben wurden, aber die Aktion nicht tatsächlich durchgeführt wurde.</span><span class="sxs-lookup"><span data-stu-id="2abc0-116">Also, write ahead means that the CRM Compensator, which is the component that receives the log records on recovery, must deal with the case where the log records were written but the action did not in fact occur.</span></span> <span data-ttu-id="2abc0-117">Aktionen durch den CRM-kompenerer müssen *idempotent* sein. Das heißt, Sie sollten in der Lage sein, mehrmals ausgeführt zu werden, sollten aber zu demselben Ergebnis führen.</span><span class="sxs-lookup"><span data-stu-id="2abc0-117">Actions by the CRM Compensator must be *idempotent*; that is, they should be capable of being performed more than once but should lead to the same outcome.</span></span> <span data-ttu-id="2abc0-118">Beispielsweise ist das Festlegen eines Konto Ausgleichs auf den Wert $100 eine idempotente Aktion. das Hinzufügen von $100 zum Konto Saldo ist nicht.</span><span class="sxs-lookup"><span data-stu-id="2abc0-118">For example, setting an account balance to the value of $100 is an idempotent action; adding $100 to the account balance is not.</span></span>

<span data-ttu-id="2abc0-119">Die [**icrmlogcontrol**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmlogcontrol) -Schnittstelle stellt die folgenden beiden Methoden zum Schreiben von Protokolldaten Sätzen bereit:</span><span class="sxs-lookup"><span data-stu-id="2abc0-119">The [**ICrmLogControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmlogcontrol) interface provides the following two methods for writing log records:</span></span>

-   <span data-ttu-id="2abc0-120">[**Writelogrecordvariant**](/windows/desktop/api/ComSvcs/nf-comsvcs-icrmlogcontrol-writelogrecordvariants) wird zum Schreiben eines strukturierten Protokolldaten Satzes verwendet, der als eine Sammlung von Varianten erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="2abc0-120">[**WriteLogRecordVariants**](/windows/desktop/api/ComSvcs/nf-comsvcs-icrmlogcontrol-writelogrecordvariants) is used for writing a structured log record that is built up as a collection of Variants.</span></span> <span data-ttu-id="2abc0-121">Dies ist in erster Linie für die Verwendung bei der Entwicklung von CRMs in Microsoft Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="2abc0-121">It is primarily for use when developing CRMs in Microsoft Visual Basic.</span></span>
-   <span data-ttu-id="2abc0-122">[**Writelogrecord**](/windows/desktop/api/ComSvcs/nf-comsvcs-icrmlogcontrol-writelogrecord) wird zum Schreiben eines unstrukturierten Protokolldaten Satzes als blobbyte verwendet.</span><span class="sxs-lookup"><span data-stu-id="2abc0-122">[**WriteLogRecord**](/windows/desktop/api/ComSvcs/nf-comsvcs-icrmlogcontrol-writelogrecord) is used for writing an unstructured log record as BLOBs of bytes.</span></span> <span data-ttu-id="2abc0-123">Dies ist in erster Linie für die Verwendung bei der Entwicklung von CRMs in Microsoft Visual C++.</span><span class="sxs-lookup"><span data-stu-id="2abc0-123">It is primarily for use when developing CRMs in Microsoft Visual C++.</span></span> <span data-ttu-id="2abc0-124">Da Datensatzstrukturen in C häufig aus einem Satz von Headern und Feldern bestehen, die möglicherweise im Speicher verstreut sind, implementiert die Methode " **Write telogrecord** " eine Sammel Funktion, die das Kopieren von Daten reduziert.</span><span class="sxs-lookup"><span data-stu-id="2abc0-124">Because record structures in C are often made up of a set of headers and fields that may be scattered in memory, the **WriteLogRecord** method implements a gather capability that reduces the copying of data.</span></span>

> [!Note]  
> <span data-ttu-id="2abc0-125">Sie sollten keine Zeiger Typen innerhalb von Datenstrukturen in einem Protokolldaten Satz finden.</span><span class="sxs-lookup"><span data-stu-id="2abc0-125">You should not user pointer types within data structures in a log record.</span></span> <span data-ttu-id="2abc0-126">Zeiger sind während der Wiederherstellungs Phase nicht mehr gültig, da der CRM-Compensator in einem anderen Prozess als der CRM-Worker ausgeführt wird, der den Protokolldaten Satz geschrieben hat.</span><span class="sxs-lookup"><span data-stu-id="2abc0-126">Pointers are no longer valid during recovery phase because the CRM Compensator runs in a different process than that of the CRM worker that wrote the log record.</span></span> <span data-ttu-id="2abc0-127">Das Einschließen von Zeiger Typen in einen Protokolldaten Satz kann dazu führen, dass eine Anwendung während der Wiederherstellung abstürzt oder beschädigt wird.</span><span class="sxs-lookup"><span data-stu-id="2abc0-127">Including pointer types in a log record might cause an application to crash or corrupt itself during recovery.</span></span>

 

<span data-ttu-id="2abc0-128">Beide Schreib Methoden schreiben einen Protokolldaten Satz auf den Datenträger, gewährleisten aber nicht die Dauerhaftigkeit des Datensatzes.</span><span class="sxs-lookup"><span data-stu-id="2abc0-128">Both of these write methods write a log record to disk but do not guarantee the record's durability.</span></span> <span data-ttu-id="2abc0-129">Obwohl das Zulassen von verzögerten Schreibvorgängen vor dem erzwingen auf die Festplatte die Leistung verbessern kann, können Sie stattdessen die [**icrmlogcontrol:: ForceLog**](/windows/desktop/api/ComSvcs/nf-comsvcs-icrmlogcontrol-forcelog) -Methode verwenden, um sicherzustellen, dass alle vom CRM ausgeführten Schreibvorgänge auf dem Datenträger dauerhaft sind.</span><span class="sxs-lookup"><span data-stu-id="2abc0-129">While allowing lazy writes to accumulate before forcing to disk can improve performance, you can use the [**ICrmLogControl::ForceLog**](/windows/desktop/api/ComSvcs/nf-comsvcs-icrmlogcontrol-forcelog) method instead to guarantee that all writes done by the CRM are durable on disk, which is important for failure recovery.</span></span>

<span data-ttu-id="2abc0-130">Wenn der CRM-Worker mit seinen Aktionen fertig ist und das Schreiben und Erzwingen von Datensätzen im Protokoll abgeschlossen hat, muss er [**icrmlogcontrol**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmlogcontrol)freigeben.</span><span class="sxs-lookup"><span data-stu-id="2abc0-130">When the CRM worker is done with its actions and has finished writing and forcing records to the log, it must release [**ICrmLogControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmlogcontrol).</span></span> <span data-ttu-id="2abc0-131">Wenn die Transaktion abgeschlossen ist (in der Regel aufgrund der Anwendungs Komponente [**SetComplete**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setcomplete) oder [**SetAbort**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setabort)), erstellt die CRM-Infrastruktur die CRM-compensatorkomponente, die entweder die [**icrmcompensator**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmcompensator) -Schnittstelle oder die [**icrmcompensatorvarianten**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmcompensatorvariants) -Schnittstelle implementiert.</span><span class="sxs-lookup"><span data-stu-id="2abc0-131">When the transaction completes (typically due to the application component calling [**SetComplete**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setcomplete) or [**SetAbort**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setabort)), the CRM infrastructure creates the CRM Compensator component, which implements either the [**ICrmCompensator**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmcompensator) interface or the [**ICrmCompensatorVariants**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmcompensatorvariants) interface.</span></span> <span data-ttu-id="2abc0-132">Diese Schnittstellen werden verwendet, um die unstrukturierten (Visual C++) oder strukturierten (Visual Basic) Datensätze zusammen mit den Transaktions Ergebnis Benachrichtigungen an den CRM-kompenerer zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="2abc0-132">These interfaces are used to pass the unstructured (Visual C++) or structured (Visual Basic) records to the CRM Compensator along with the transaction outcome notifications.</span></span>

<span data-ttu-id="2abc0-133">Der CRM-kompenerer wird zuerst über die Vorbereitungsphase des Transaktions Abschlusses benachrichtigt und kann für die Vorbereitungs Anforderung entweder yes oder No abstimmen.</span><span class="sxs-lookup"><span data-stu-id="2abc0-133">The CRM Compensator is first notified of the prepare phase of the transaction completion and can vote either yes or no to the prepare request.</span></span> <span data-ttu-id="2abc0-134">Wenn der CRM-Compensator die Stimme Nein abbricht, empfängt er keine weiteren Abbruch Benachrichtigungen.</span><span class="sxs-lookup"><span data-stu-id="2abc0-134">If the CRM Compensator votes no, it does not receive any further abort notifications.</span></span> <span data-ttu-id="2abc0-135">Wenn ja für die Prepare-Anforderung Stimmen, empfängt es entweder die Commit-oder Abbruch Benachrichtigungen.</span><span class="sxs-lookup"><span data-stu-id="2abc0-135">If it votes yes to the prepare request, it receives either the commit or abort notifications.</span></span> <span data-ttu-id="2abc0-136">Bei einem Client Abbruch werden keine Vorbereitungs Benachrichtigungen empfangen, sondern nur Abbruch Benachrichtigungen.</span><span class="sxs-lookup"><span data-stu-id="2abc0-136">In the case of a client abort, no prepare notifications are received, only abort notifications.</span></span> <span data-ttu-id="2abc0-137">Der CRM-kompenerer muss darauf vorbereitet sein, alle diese Fälle zu verarbeiten, und er muss auch den Fall behandeln, in dem keine Protokolldaten Sätze erfolgreich vom CRM-Worker geschrieben wurden.</span><span class="sxs-lookup"><span data-stu-id="2abc0-137">The CRM Compensator must be prepared to handle all these cases, and it also must handle the case where no log records were successfully written by the CRM worker.</span></span> <span data-ttu-id="2abc0-138">Der CRM-Compensator darf nicht davon ausgehen, dass dieselbe CRM-kompenatorinstanz die Benachrichtigungen Phase 1 (Vorbereitung) und Phase 2 (Commit oder Abbruch) empfängt, da diese durch die Wiederherstellung unterbrochen werden könnten.</span><span class="sxs-lookup"><span data-stu-id="2abc0-138">The CRM Compensator must not assume that the same CRM Compensator instance will receive both the phase 1 (prepare) and the phase 2 (commit or abort) notifications, as these could be interrupted by recovery.</span></span>

<span data-ttu-id="2abc0-139">In der Regel verwendet ein CRM-Compensator die Abbruch Benachrichtigung, um die vom CRM-Worker ausgeführte Aktion umzukehren.</span><span class="sxs-lookup"><span data-stu-id="2abc0-139">Typically, a CRM Compensator uses the abort notification to reverse the action that was performed by the CRM worker.</span></span> <span data-ttu-id="2abc0-140">Der CRM-Worker kann einen Zustand verfügbar machen, wenn er seine Aktion umkehren muss.</span><span class="sxs-lookup"><span data-stu-id="2abc0-140">The CRM worker might leave some state available in case it needs to reverse its action.</span></span> <span data-ttu-id="2abc0-141">Dieser Zustand ist möglicherweise vollständig in den Protokolldaten Sätzen enthalten. andernfalls muss der CRM-Compensator diesen Zustand bereinigen, wenn für die Transaktion ein Commit ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="2abc0-141">That state might be fully contained in the log records, and if not, the CRM Compensator needs to clean up that state if the transaction commits.</span></span> <span data-ttu-id="2abc0-142">Dies ist der Grund, warum der CRM-Compensator die Commit-Benachrichtigung empfängt.</span><span class="sxs-lookup"><span data-stu-id="2abc0-142">This is the reason why the CRM Compensator receives the commit notification.</span></span> <span data-ttu-id="2abc0-143">Der CRM-kompenerer wird nicht unter einer DTC-Transaktion ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="2abc0-143">The CRM Compensator does not run under a DTC transaction.</span></span>

<span data-ttu-id="2abc0-144">Der CRM-Kompensierungs Dienst kann bei Bedarf neue Datensätze protokollieren, indem er [**icrmlogcontrol**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmlogcontrol)verwendet, der während der Erstellung empfangen wird.</span><span class="sxs-lookup"><span data-stu-id="2abc0-144">The CRM Compensator can log new records if required by using [**ICrmLogControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmlogcontrol), which it receives as it is created.</span></span> <span data-ttu-id="2abc0-145">Der CRM-Worker und der CRM-kompenerer können auch den letzten Protokolldaten Satz vergessen, den Sie geschrieben haben. Dies kann erforderlich sein, um eine unnötige Wiederherstellung zu vermeiden</span><span class="sxs-lookup"><span data-stu-id="2abc0-145">Both the CRM worker and CRM Compensator can also forget the last log record they wrote, which might be required to avoid unnecessary recovery.</span></span>

## <a name="related-topics"></a><span data-ttu-id="2abc0-146">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="2abc0-146">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="2abc0-147">Kompensierende com+-Ressourcen-Manager Konzepte</span><span class="sxs-lookup"><span data-stu-id="2abc0-147">COM+ Compensating Resource Manager Concepts</span></span>](com--compensating-resource-manager-concepts.md)
</dt> <dt>

[<span data-ttu-id="2abc0-148">Com+-CRM-Start und-Wiederherstellung</span><span class="sxs-lookup"><span data-stu-id="2abc0-148">COM+ CRM Startup and Recovery</span></span>](com--crm-startup-and-recovery.md)
</dt> </dl>

 

 



