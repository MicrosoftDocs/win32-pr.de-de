---
title: WOW64-Implementierungs Details
description: Der WOW64-Emulator wird im Benutzermodus ausgeführt.
ms.assetid: 93daf9d0-dfdb-42c3-8c3d-397b21991e83
keywords:
- WOW64 64-Bit-Windows-Programmierung, Umgebungsvariablen
- WOW64 64-Bit-Windows-Programmierung, Implementierung
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4c7d095369b883171e39bffd4dc629b7f80a7f39
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/20/2020
ms.locfileid: "104101827"
---
# <a name="wow64-implementation-details"></a><span data-ttu-id="670da-105">WOW64-Implementierungs Details</span><span class="sxs-lookup"><span data-stu-id="670da-105">WOW64 Implementation Details</span></span>

<span data-ttu-id="670da-106">Der WOW64-Emulator wird im Benutzermodus ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="670da-106">The WOW64 emulator runs in user mode.</span></span> <span data-ttu-id="670da-107">Sie stellt eine Schnittstelle zwischen der 32-Bit-Version von Ntdll.dll und dem Kernel des Prozessors bereit und fängt Kernel Aufrufe ab.</span><span class="sxs-lookup"><span data-stu-id="670da-107">It provides an interface between the 32-bit version of Ntdll.dll and the kernel of the processor, and it intercepts kernel calls.</span></span> <span data-ttu-id="670da-108">Der WOW64-Emulator besteht aus den folgenden DLLs:</span><span class="sxs-lookup"><span data-stu-id="670da-108">The WOW64 emulator consists of the following DLLs:</span></span>

-   <span data-ttu-id="670da-109">Wow64.dll stellt die Kern Emulations Infrastruktur und die thunge für die Ntoskrnl.exe-Einstiegspunkt Funktionen bereit.</span><span class="sxs-lookup"><span data-stu-id="670da-109">Wow64.dll provides the core emulation infrastructure and the thunks for the Ntoskrnl.exe entry-point functions.</span></span>
-   <span data-ttu-id="670da-110">Wow64Win.dll stellt thunas für die Win32k.sys-Einstiegspunkt Funktionen bereit.</span><span class="sxs-lookup"><span data-stu-id="670da-110">Wow64Win.dll provides thunks for the Win32k.sys entry-point functions.</span></span>
-   <span data-ttu-id="670da-111">(nur x64) Wow64Cpu.dll bietet Unterstützung für die Ausführung von x86-Programmen auf x64.</span><span class="sxs-lookup"><span data-stu-id="670da-111">(x64 only) Wow64Cpu.dll provides support for running x86 programs on x64.</span></span>
-   <span data-ttu-id="670da-112">(Nur Intel Itanium) IA32Exec. bin enthält den x86-Software Emulator.</span><span class="sxs-lookup"><span data-stu-id="670da-112">(Intel Itanium only) IA32Exec.bin contains the x86 software emulator.</span></span>
-   <span data-ttu-id="670da-113">(Nur Intel Itanium) Wowia32x.dll die Schnittstelle zwischen IA32Exec. bin und WOW64 bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="670da-113">(Intel Itanium only) Wowia32x.dll provides the interface between IA32Exec.bin and WOW64.</span></span>
-   <span data-ttu-id="670da-114">(Nur ARM64) xtajit.dll enthält den x86-Software Emulator.</span><span class="sxs-lookup"><span data-stu-id="670da-114">(ARM64 only) xtajit.dll contains the x86 software emulator.</span></span>
-   <span data-ttu-id="670da-115">(Nur ARM64) wowarmw.dll bietet Unterstützung für die Ausführung von ARM32-Programmen auf ARM64.</span><span class="sxs-lookup"><span data-stu-id="670da-115">(ARM64 only) wowarmw.dll provides support for running ARM32 programs on ARM64.</span></span>

<span data-ttu-id="670da-116">Diese DLLs sind zusammen mit der 64-Bit-Version von Ntdll.dll die einzigen 64-Bit-Binärdateien, die in einen 32-Bit-Prozess geladen werden können.</span><span class="sxs-lookup"><span data-stu-id="670da-116">These DLLs, along with the 64-bit version of Ntdll.dll, are the only 64-bit binaries that can be loaded into a 32-bit process.</span></span> <span data-ttu-id="670da-117">Unter Windows 10 auf ARM können auch CHPE-Binärdateien (kompilierte hybride portable ausführbare Dateien) in einen x86 32-Bit-Prozess geladen werden.</span><span class="sxs-lookup"><span data-stu-id="670da-117">On Windows 10 on ARM, CHPE (Compiled Hybrid Portable Executable) binaries may also be loaded into an x86 32-bit process.</span></span>

<span data-ttu-id="670da-118">Beim Start lädt Wow64.dll die x86-Version von Ntdll.dll (oder die CHPE-Version, sofern aktiviert) und führt den Initialisierungs Code aus, der alle erforderlichen 32-Bit-DLLs lädt.</span><span class="sxs-lookup"><span data-stu-id="670da-118">At startup, Wow64.dll loads the x86 version of Ntdll.dll (or the CHPE version, if enabled) and runs its initialization code, which loads all necessary 32-bit DLLs.</span></span> <span data-ttu-id="670da-119">Fast alle 32-Bit-DLLs sind nicht geänderte Kopien 32 von 32-Bit-Windows-Binärdateien, obwohl einige aus Leistungsgründen als CHPE geladen werden.</span><span class="sxs-lookup"><span data-stu-id="670da-119">Almost all 32-bit DLLs are unmodified copies of 32-bit Windows binaries, though some are loaded as CHPE for performance reasons.</span></span> <span data-ttu-id="670da-120">Einige dieser DLLs unterscheiden sich auf WOW64 anders als bei 32-Bit-Fenstern, in der Regel, weil Sie Arbeitsspeicher mit 64-Bit-Systemkomponenten gemeinsam nutzen.</span><span class="sxs-lookup"><span data-stu-id="670da-120">Some of these DLLs are written to behave differently on WOW64 than they do on 32-bit Windows, usually because they share memory with 64-bit system components.</span></span> <span data-ttu-id="670da-121">Der gesamte Benutzermodus-Adressraum über dem 32-Bit-Limit ist vom System reserviert.</span><span class="sxs-lookup"><span data-stu-id="670da-121">All user-mode address space above the 32-bit limit is reserved by the system.</span></span> <span data-ttu-id="670da-122">Weitere Informationen finden Sie [unterleistung und Arbeitsspeicher Nutzung unter WOW64](performance-and-memory-consumption.md).</span><span class="sxs-lookup"><span data-stu-id="670da-122">For more information, see [Performance and Memory Consumption under WOW64](performance-and-memory-consumption.md).</span></span>

<span data-ttu-id="670da-123">Anstatt die x86-Systemdienst-Aufruf Sequenz zu verwenden, werden 32-Bit-Binärdateien, die Systemaufrufe ausführen, neu erstellt, um eine benutzerdefinierte Aufruf Sequenz zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="670da-123">Instead of using the x86 system-service call sequence, 32-bit binaries that make system calls are rebuilt to use a custom calling sequence.</span></span> <span data-ttu-id="670da-124">Diese Aufruf Sequenz ist preiswert, damit WOW64 abgefangen wird, da Sie vollständig im Benutzermodus bleibt.</span><span class="sxs-lookup"><span data-stu-id="670da-124">This calling sequence is inexpensive for WOW64 to intercept because it remains entirely in user mode.</span></span> <span data-ttu-id="670da-125">Wenn die benutzerdefinierte Aufruf Sequenz erkannt wird, wechselt die WOW64-CPU zurück in den nativen 64-Bit-Modus und ruft Wow64.dll auf.</span><span class="sxs-lookup"><span data-stu-id="670da-125">When the custom calling sequence is detected, the WOW64 CPU transitions back to native 64-bit mode and calls into Wow64.dll.</span></span> <span data-ttu-id="670da-126">Thunking wird im Benutzermodus durchgeführt, um die Auswirkung auf den 64-Bit-Kernel zu verringern und das Risiko eines Fehlers im Thunk zu verringern, der einen Absturz des Kernelmodus, eine Beschädigung von Daten oder eine Sicherheitslücke verursachen kann.</span><span class="sxs-lookup"><span data-stu-id="670da-126">Thunking is done in user mode to reduce the impact on the 64-bit kernel and to reduce the risk of a bug in the thunk that might cause a kernel-mode crash, data corruption, or a security hole.</span></span> <span data-ttu-id="670da-127">Die thungs extrahieren Argumente aus dem 32-Bit-Stapel, erweitern Sie auf 64 Bits und führen dann den systemeigenen System Rückruf aus.</span><span class="sxs-lookup"><span data-stu-id="670da-127">The thunks extract arguments from the 32-bit stack, extend them to 64 bits, then make the native system call.</span></span>

## <a name="environment-variables"></a><span data-ttu-id="670da-128">Umgebungsvariablen</span><span class="sxs-lookup"><span data-stu-id="670da-128">Environment Variables</span></span>

<span data-ttu-id="670da-129">Wenn ein 32-Bit-Prozess von einem 64-Bit-Prozess erstellt wird oder ein 64-Bit-Prozess von einem 32-Bit-Prozess erstellt wird, legt WOW64 die Umgebungsvariablen für den erstellten Prozess fest, wie in der folgenden Tabelle gezeigt.</span><span class="sxs-lookup"><span data-stu-id="670da-129">When a 32-bit process is created by a 64-bit process, or when a 64-bit process is created by a 32-bit process, WOW64 sets the environment variables for the created process as shown in the following table.</span></span>



| <span data-ttu-id="670da-130">Prozess</span><span class="sxs-lookup"><span data-stu-id="670da-130">Process</span></span>                   | <span data-ttu-id="670da-131">Umgebungsvariablen</span><span class="sxs-lookup"><span data-stu-id="670da-131">Environment variables</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|---------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="670da-132">64-Bit-Prozess</span><span class="sxs-lookup"><span data-stu-id="670da-132">64-bit process</span></span><br/> | <span data-ttu-id="670da-133">Prozessor \_ Architektur = amd64 oder Prozessor \_ Architektur = ia64 oder Prozessor \_ Architektur = ARM64</span><span class="sxs-lookup"><span data-stu-id="670da-133">PROCESSOR\_ARCHITECTURE=AMD64 or PROCESSOR\_ARCHITECTURE=IA64 or PROCESSOR\_ARCHITECTURE=ARM64</span></span><br/> <span data-ttu-id="670da-134">Program Files =% Program Files%</span><span class="sxs-lookup"><span data-stu-id="670da-134">ProgramFiles=%ProgramFiles%</span></span><br/> <span data-ttu-id="670da-135">ProgramW6432 =% Program Files%</span><span class="sxs-lookup"><span data-stu-id="670da-135">ProgramW6432=%ProgramFiles%</span></span><br/> <span data-ttu-id="670da-136">COMMONPROGRAM files =% COMMONPROGRAMFILES%</span><span class="sxs-lookup"><span data-stu-id="670da-136">CommonProgramFiles=%CommonProgramFiles%</span></span><br/> <span data-ttu-id="670da-137">CommonProgramW6432 =% COMMONPROGRAMFILES%</span><span class="sxs-lookup"><span data-stu-id="670da-137">CommonProgramW6432=%CommonProgramFiles%</span></span><br/> <span data-ttu-id="670da-138">**Windows Server 2008, Windows Vista, Windows Server 2003 und Windows XP:** Die Umgebungsvariablen ProgramW6432 und CommonProgramW6432 wurden ab Windows 7 und Windows Server 2008 R2 hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="670da-138">**Windows Server 2008, Windows Vista, Windows Server 2003 and Windows XP:** The ProgramW6432 and CommonProgramW6432 environment variables were added starting with Windows 7 and Windows Server 2008 R2.</span></span> <br/> |
| <span data-ttu-id="670da-139">32-Bit-Prozess</span><span class="sxs-lookup"><span data-stu-id="670da-139">32-bit process</span></span><br/> | <span data-ttu-id="670da-140">Prozessor \_ Architektur = x86</span><span class="sxs-lookup"><span data-stu-id="670da-140">PROCESSOR\_ARCHITECTURE=x86</span></span><br/> <span data-ttu-id="670da-141">Prozessor \_ ARCHITEW6432 =% Prozessor \_ Architektur%</span><span class="sxs-lookup"><span data-stu-id="670da-141">PROCESSOR\_ARCHITEW6432=%PROCESSOR\_ARCHITECTURE%</span></span><br/> <span data-ttu-id="670da-142">Program Files =% Program Files (x86)%</span><span class="sxs-lookup"><span data-stu-id="670da-142">ProgramFiles=%ProgramFiles(x86)%</span></span><br/> <span data-ttu-id="670da-143">ProgramW6432 =% Program Files%</span><span class="sxs-lookup"><span data-stu-id="670da-143">ProgramW6432=%ProgramFiles%</span></span><br/> <span data-ttu-id="670da-144">COMMONPROGRAM files =% COMMONPROGRAMFILES (x86)%</span><span class="sxs-lookup"><span data-stu-id="670da-144">CommonProgramFiles=%CommonProgramFiles(x86)%</span></span><br/> <span data-ttu-id="670da-145">CommonProgramW6432 =% COMMONPROGRAMFILES%</span><span class="sxs-lookup"><span data-stu-id="670da-145">CommonProgramW6432=%CommonProgramFiles%</span></span><br/>                                                                                                                                                                                                                  |



 

## <a name="global-hooks"></a><span data-ttu-id="670da-146">Globale Hooks</span><span class="sxs-lookup"><span data-stu-id="670da-146">Global Hooks</span></span>

<span data-ttu-id="670da-147">Die Funktion " [**SetWindowsHookEx**](/windows/win32/api/winuser/nf-winuser-setwindowshookexa) " kann verwendet werden, um eine DLL in einen anderen Prozess einzufügen, wenn die folgenden Bedingungen erfüllt sind:</span><span class="sxs-lookup"><span data-stu-id="670da-147">The [**SetWindowsHookEx**](/windows/win32/api/winuser/nf-winuser-setwindowshookexa) function can be used to inject a DLL into another process if the following conditions are met:</span></span>

-   <span data-ttu-id="670da-148">Eine 32-Bit-DLL kann nur in einen 32-Bit-Prozess eingefügt werden, und eine 64-Bit-DLL kann nur in einen 64-Bit-Prozess eingefügt werden.</span><span class="sxs-lookup"><span data-stu-id="670da-148">A 32-bit DLL can be injected only into a 32-bit process, and a 64-bit DLL can be injected only into a 64-bit process.</span></span> <span data-ttu-id="670da-149">Es ist nicht möglich, eine 32-Bit-DLL in einen 64-Bit-Prozess einzufügen oder umgekehrt.</span><span class="sxs-lookup"><span data-stu-id="670da-149">It is not possible to inject a 32-bit DLL into a 64-bit process or vice versa.</span></span>
-   <span data-ttu-id="670da-150">Die 32-Bit-und 64-Bit-DLLs müssen unterschiedliche Namen aufweisen.</span><span class="sxs-lookup"><span data-stu-id="670da-150">The 32-bit and 64-bit DLLs must have different names.</span></span>
-   <span data-ttu-id="670da-151">Die Architekturen der dll und der Prozess müssen mit identisch sein.</span><span class="sxs-lookup"><span data-stu-id="670da-151">The architectures of the DLL and the process must match.</span></span> <span data-ttu-id="670da-152">Beispielsweise können Sie eine 32-Bit-x86-dll nicht in einen 32-Bit-ARM-Prozess einfügen.</span><span class="sxs-lookup"><span data-stu-id="670da-152">For instance, you cannot inject a 32-bit x86 DLL into a 32-bit ARM process.</span></span>

<span data-ttu-id="670da-153">Weitere Informationen finden Sie unter [**SetWindowsHookEx**](/windows/win32/api/winuser/nf-winuser-setwindowshookexa).</span><span class="sxs-lookup"><span data-stu-id="670da-153">For more information, see [**SetWindowsHookEx**](/windows/win32/api/winuser/nf-winuser-setwindowshookexa).</span></span>

<span data-ttu-id="670da-154">Beachten Sie, dass die " **WH \_ Mouse**", " **WH \_ Keyboard**", " **WH \_ Journal \***", " **WH \_ Shell**" und "Low-Level Hooks" für den Thread aufgerufen werden können, der den Hook installiert hat, anstatt den Thread, der den Hook</span><span class="sxs-lookup"><span data-stu-id="670da-154">Be aware that the **WH\_MOUSE**, **WH\_KEYBOARD**, **WH\_JOURNAL\***, **WH\_SHELL**, and low-level hooks can be called on the thread that installed the hook rather than the thread processing the hook.</span></span> <span data-ttu-id="670da-155">Für diese Hooks ist es möglich, dass sowohl die 32-Bit-als auch die 64-Bit-Hooks aufgerufen werden, wenn ein 32-Bit-Hook vor einem 64-Bit-Hook in der Hook-Kette liegt.</span><span class="sxs-lookup"><span data-stu-id="670da-155">For these hooks, it is possible that both the 32-bit and 64-bit hooks will be called if a 32-bit hook is ahead of a 64-bit hook in the hook chain.</span></span> <span data-ttu-id="670da-156">Weitere Informationen finden Sie unter [Verwenden von Hooks](../winmsg/using-hooks.md).</span><span class="sxs-lookup"><span data-stu-id="670da-156">For more information, see [Using Hooks](../winmsg/using-hooks.md).</span></span>

 

