---
title: Treiber Instanzen
description: Treiber Instanzen
ms.assetid: 93dba9e8-bfb3-4714-9466-cf5c78babcf2
keywords:
- installierbare Treiber, Instanzen
- installierbare Treiber, mehrere Instanzen
- mehrere Treiber Instanzen
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 37148dcb12fbfa2984d4e55424102b5985165d9d
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/16/2019
ms.locfileid: "103709588"
---
# <a name="driver-instances"></a><span data-ttu-id="fa02c-106">Treiber Instanzen</span><span class="sxs-lookup"><span data-stu-id="fa02c-106">Driver Instances</span></span>

<span data-ttu-id="fa02c-107">Windows ermöglicht mehrfaches Instanzen eines installierbaren Treibers.</span><span class="sxs-lookup"><span data-stu-id="fa02c-107">Windows allows for multiples instances of an installable driver.</span></span> <span data-ttu-id="fa02c-108">Das System erstellt jedes Mal, wenn der Treiber geöffnet wird, eine Instanz des Treibers und zerstört die Instanz, wenn der Treiber geschlossen wird.</span><span class="sxs-lookup"><span data-stu-id="fa02c-108">The system creates an instance of the driver each time the driver is opened and destroys the instance when the driver is closed.</span></span> <span data-ttu-id="fa02c-109">Treiber Instanzen sind besonders nützlich für installierbare Treiber, die mehrere Geräte unterstützen oder die von mehreren Anwendungen oder von der gleichen Anwendung mehrmals geöffnet werden.</span><span class="sxs-lookup"><span data-stu-id="fa02c-109">Driver instances are especially useful for installable drivers that support multiple devices or that are opened by multiple applications or by the same application multiple times.</span></span>

<span data-ttu-id="fa02c-110">Um dem Treiber beim Nachverfolgen der Instanzen zu helfen, sendet das System einen treiberinstanzhandle mit jeder Treiber Nachricht, nachdem die Instanz erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="fa02c-110">To help the driver keep track of the instances, the system sends a driver instance handle with each driver message after the instance has been created.</span></span> <span data-ttu-id="fa02c-111">Da dieses Handle die Instanz eindeutig identifiziert, ordnen installierbare Treiber das Handle häufig dem Arbeitsspeicher und anderen Ressourcen zu, die Sie speziell für die Instanz zugeordnet haben.</span><span class="sxs-lookup"><span data-stu-id="fa02c-111">Because this handle uniquely identifies the instance, installable drivers often associate the handle with memory and other resources that they have specifically allocated for the instance.</span></span>

<span data-ttu-id="fa02c-112">Wenn die erste Instanz geöffnet wird, sendet das System die Nachrichten [**drv \_ Load**](drv-load.md), [**drv \_ enable**](drv-enable.md)und [**drv \_ Open**](drv-open.md) an den Treiber in dieser Reihenfolge.</span><span class="sxs-lookup"><span data-stu-id="fa02c-112">When the first instance is opened, the system sends the [**DRV\_LOAD**](drv-load.md), [**DRV\_ENABLE**](drv-enable.md), and [**DRV\_OPEN**](drv-open.md) messages to the driver in that order.</span></span> <span data-ttu-id="fa02c-113">Der drv \_ -Lade-und drv- \_ Aktivierungs Nachrichten benachrichtigen den Treiber, dass er sich nun im Arbeitsspeicher befindet und für den Betrieb aktiviert ist.</span><span class="sxs-lookup"><span data-stu-id="fa02c-113">The DRV\_LOAD and DRV\_ENABLE messages notify the driver that it is now in memory and is enabled for operation.</span></span> <span data-ttu-id="fa02c-114">Die "drv \_ Open"-Meldung identifiziert das Instanzhandle und kann Konfigurationsinformationen für die Instanz enthalten.</span><span class="sxs-lookup"><span data-stu-id="fa02c-114">The DRV\_OPEN message identifies the instance handle and may include configuration information for the instance.</span></span> <span data-ttu-id="fa02c-115">Bei jedem nachfolgenden Öffnen einer Instanz desselben Treibers sendet das System nur eine vom drv \_ geöffnete Nachricht.</span><span class="sxs-lookup"><span data-stu-id="fa02c-115">On each subsequent opening of an instance of the same driver, the system sends only a DRV\_OPEN message.</span></span>

<span data-ttu-id="fa02c-116">Bei der Verarbeitung einer drv \_ -Lade Nachricht liest ein Treiber in der Regel Konfigurationseinstellungen aus der Registrierung, konfiguriert den Treiber und alle zugeordneten Hardware und ordnet Speicher für die Verwendung durch alle Instanzen des Treibers zu.</span><span class="sxs-lookup"><span data-stu-id="fa02c-116">When processing a DRV\_LOAD message, a driver typically reads configuration settings from the registry, configures the driver and any associated hardware, and allocates memory for use by all instances of the driver.</span></span> <span data-ttu-id="fa02c-117">Wenn ein Treiber die Konfiguration nicht ausführen kann oder Arbeitsspeicher belegt, wird NULL zurückgegeben, damit das System den Treiber sofort aus dem Arbeitsspeicher entfernt und verhindert, dass nachfolgende Nachrichten gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="fa02c-117">If a driver cannot complete the configuration or allocate memory, it returns zero to direct the system to immediately remove the driver from memory and prevent any subsequent messages from being sent.</span></span> <span data-ttu-id="fa02c-118">Beim Verarbeiten der drv- \_ Aktivierungs Nachricht bereitet der Treiber die Hardware für das empfangen und Verarbeiten von Eingabe-und Ausgabeanforderungen (e/a) vor.</span><span class="sxs-lookup"><span data-stu-id="fa02c-118">When processing the DRV\_ENABLE message, the driver prepares the hardware to receive and process input and output (I/O) requests.</span></span> <span data-ttu-id="fa02c-119">Die Vorbereitung kann die Installation von Interrupt-Handlern einschließen.</span><span class="sxs-lookup"><span data-stu-id="fa02c-119">The preparation may include installing interrupt handlers.</span></span>

<span data-ttu-id="fa02c-120">Bei der Verarbeitung der \_ vom drv geöffneten Nachricht weist der Treiber Speicher oder Ressourcen zu, die für die angegebene Instanz des Treibers erforderlich sind, und gibt dann einen Wert ungleich 0 (null) zurück.</span><span class="sxs-lookup"><span data-stu-id="fa02c-120">When processing the DRV\_OPEN message, the driver allocates memory or resources required by the given instance of the driver and then returns a nonzero value.</span></span> <span data-ttu-id="fa02c-121">Das System verwendet diesen Wert ungleich 0 (null) als *Treiber Bezeichner* in nachfolgenden Treiber Meldungen für die Instanz.</span><span class="sxs-lookup"><span data-stu-id="fa02c-121">The system uses this nonzero value as the *driver identifier* in subsequent driver messages for the instance.</span></span> <span data-ttu-id="fa02c-122">Dieser Bezeichner kann vom Treiber für beliebige Zwecke verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="fa02c-122">The driver can use this identifier for any purpose.</span></span> <span data-ttu-id="fa02c-123">Einige Treiber verwenden z. b. ein Speicher Handle für den Bezeichner, um schnellen Zugriff auf den Arbeitsspeicher zu erhalten, der Informationen über die angegebene Instanz enthält.</span><span class="sxs-lookup"><span data-stu-id="fa02c-123">For example, some drivers use a memory handle for the identifier to gain quick access to memory containing information about the given instance.</span></span>

<span data-ttu-id="fa02c-124">Viele installierbare Treiber verarbeiten den zweiten Parameter der drv-Nachricht vom Typ "drv" \_ , sodass das System und die Anwendungen beim Öffnen einer Instanz die Möglichkeit haben, zusätzliche Informationen an den Treiber zu senden.</span><span class="sxs-lookup"><span data-stu-id="fa02c-124">Many installable drivers process the second parameter of the DRV\_OPEN message, giving the system and applications the means to send additional information to the driver when opening an instance.</span></span> <span data-ttu-id="fa02c-125">Der-Parameter kann ein einzelner Wert oder eine Adresse einer Struktur sein, die einen Satz von Werten enthält.</span><span class="sxs-lookup"><span data-stu-id="fa02c-125">The parameter can be a single value or an address of a structure containing a set of values.</span></span> <span data-ttu-id="fa02c-126">Bei der Verarbeitung von drv wird der- \_ Parameter vom Treiber überprüft, um zu bestimmen, ob es sich um einen Wert handelt, und verwendet die angegebenen Werte (sofern vorhanden), um die Erstellung der Instanz abzuschließen.</span><span class="sxs-lookup"><span data-stu-id="fa02c-126">When processing DRV\_OPEN, the driver checks the parameter to determine whether it is a value and uses the given values, if any, to complete the creation of the instance.</span></span>

<span data-ttu-id="fa02c-127">Das System sendet immer dann eine [**drv- \_ Close**](drv-close.md) -Nachricht, wenn eine Instanz geschlossen wird.</span><span class="sxs-lookup"><span data-stu-id="fa02c-127">The system sends a [**DRV\_CLOSE**](drv-close.md) message each time an instance is closed.</span></span> <span data-ttu-id="fa02c-128">Das mit der Meldung gesendete Instanzhandle identifiziert, welche Instanz geschlossen werden soll.</span><span class="sxs-lookup"><span data-stu-id="fa02c-128">The instance handle sent with the message identifies which instance to close.</span></span> <span data-ttu-id="fa02c-129">Wenn die letzte verbleibende Instanz geschlossen ist, sendet das System die \_ [**\_ freien**](drv-free.md) drv-Nachrichten vom Typ drv Close, [**drv \_ Deaktivieren**](drv-disable.md)und drv in dieser Reihenfolge.</span><span class="sxs-lookup"><span data-stu-id="fa02c-129">When the last remaining instance is closed, the system sends the DRV\_CLOSE, [**DRV\_DISABLE**](drv-disable.md), and [**DRV\_FREE**](drv-free.md) messages in that order.</span></span> <span data-ttu-id="fa02c-130">Die drv- \_ Schließen-Nachricht weist den Treiber an, die Instanz zu schließen, und die \_ kostenlosen drv-und drv- \_ Nachrichten benachrichtigen den Treiber, dass er nun deaktiviert ist und sofort aus dem Speicher freigegeben wird.</span><span class="sxs-lookup"><span data-stu-id="fa02c-130">The DRV\_CLOSE message directs the driver to close the instance, and the DRV\_DISABLE and DRV\_FREE messages notify the driver that it is now disabled and will be immediately freed from memory.</span></span>

<span data-ttu-id="fa02c-131">Beim Verarbeiten der drv- \_ Schließen-Nachricht gibt der Treiber in der Regel den Arbeitsspeicher oder die Ressourcen frei, die der Instanz zugeordnet sind.</span><span class="sxs-lookup"><span data-stu-id="fa02c-131">When processing the DRV\_CLOSE message, the driver typically frees any memory or resources allocated for the instance.</span></span> <span data-ttu-id="fa02c-132">Wenn die drv-Deaktivierungs \_ Nachricht verarbeitet wird, versetzt der Treiber alle Hardware in einen inaktiven Zustand. Dies kann das Entfernen von Interrupt-Handlern einschließen.</span><span class="sxs-lookup"><span data-stu-id="fa02c-132">When processing the DRV\_DISABLE message, the driver places any hardware in an inactive state, which may include the removal of interrupt handlers.</span></span> <span data-ttu-id="fa02c-133">Bei der Verarbeitung der \_ freien drv-Nachricht gibt der Treiber Speicher oder Ressourcen frei, die noch zugeordnet sind.</span><span class="sxs-lookup"><span data-stu-id="fa02c-133">When processing the DRV\_FREE message, the driver frees any memory or resources that are still allocated.</span></span>

<span data-ttu-id="fa02c-134">Installierbare Treiber sind nicht erforderlich, um mehrere Instanzen zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="fa02c-134">Installable drivers are not required to support multiple instances.</span></span> <span data-ttu-id="fa02c-135">Ein Treiber kann verhindern, dass eine Instanz erstellt wird, indem er für die [**drv- \_ Open**](drv-open.md) -Nachricht 0 zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="fa02c-135">A driver can prevent any instance from being created by returning zero for the [**DRV\_OPEN**](drv-open.md) message.</span></span>

 

 




