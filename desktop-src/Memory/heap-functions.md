---
description: Jeder Prozess verfügt über einen Standard Heap, der vom System bereitgestellt wird. Anwendungen, die häufige Zuordnungen aus dem Heap vornehmen, können die Leistung mithilfe privater Heaps verbessern.
ms.assetid: cfb683fa-4f46-48b5-9a28-f4625a9cb8cd
title: Heap Funktionen
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d0e591c1e349ed6806cbebe00a178a99e63bb412
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "103864860"
---
# <a name="heap-functions"></a><span data-ttu-id="dd781-104">Heap Funktionen</span><span class="sxs-lookup"><span data-stu-id="dd781-104">Heap Functions</span></span>

<span data-ttu-id="dd781-105">Jeder Prozess verfügt über einen Standard Heap, der vom System bereitgestellt wird.</span><span class="sxs-lookup"><span data-stu-id="dd781-105">Each process has a default heap provided by the system.</span></span> <span data-ttu-id="dd781-106">Anwendungen, die häufige Zuordnungen aus dem Heap vornehmen, können die Leistung mithilfe privater Heaps verbessern.</span><span class="sxs-lookup"><span data-stu-id="dd781-106">Applications that make frequent allocations from the heap can improve performance by using private heaps.</span></span>

<span data-ttu-id="dd781-107">Ein privater Heap ist ein Block von einer oder mehreren Seiten im Adressraum des aufrufenden Prozesses.</span><span class="sxs-lookup"><span data-stu-id="dd781-107">A private heap is a block of one or more pages in the address space of the calling process.</span></span> <span data-ttu-id="dd781-108">Nachdem der private Heap erstellt wurde, verwendet der Prozessfunktionen wie [**heapbelegc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) und [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree) , um den Arbeitsspeicher in diesem Heap zu verwalten.</span><span class="sxs-lookup"><span data-stu-id="dd781-108">After creating the private heap, the process uses functions such as [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) and [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree) to manage the memory in that heap.</span></span>

<span data-ttu-id="dd781-109">Die Heap Funktionen können auch verwendet werden, um Arbeitsspeicher im Standard Heap des Prozesses zu verwalten, wobei das von der [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) -Funktion zurückgegebene Handle verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="dd781-109">The heap functions can also be used to manage memory in the process's default heap, using the handle returned by the [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) function.</span></span> <span data-ttu-id="dd781-110">Neue Anwendungen sollten zu diesem Zweck die Heap Funktionen anstelle der [globalen und lokalen Funktionen](global-and-local-functions.md) verwenden.</span><span class="sxs-lookup"><span data-stu-id="dd781-110">New applications should use the heap functions instead of the [global and local functions](global-and-local-functions.md) for this purpose.</span></span>

<span data-ttu-id="dd781-111">Es gibt keinen Unterschied zwischen einem von einem privaten Heap zugewiesenen Arbeitsspeicher, der mithilfe der anderen Speicher Belegungs Funktionen zugeordnet wurde.</span><span class="sxs-lookup"><span data-stu-id="dd781-111">There is no difference between memory allocated from a private heap and that allocated by using the other memory allocation functions.</span></span> <span data-ttu-id="dd781-112">Eine umfassende Liste der Funktionen finden Sie in der Tabelle unter [Speicherverwaltungsfunktionen](memory-management-functions.md).</span><span class="sxs-lookup"><span data-stu-id="dd781-112">For a complete list of functions, see the table in [Memory Management Functions](memory-management-functions.md).</span></span>

> [!Note]  
> <span data-ttu-id="dd781-113">Ein Thread sollte Heap Funktionen nur für den Standard Heap des Prozesses und private Heaps aufrufen, die der Thread erstellt und verwaltet, mithilfe von Handles, die von der [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) -Funktion oder der [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) -Funktion zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="dd781-113">A thread should call heap functions only for the process's default heap and private heaps that the thread creates and manages, using handles returned by the [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) or [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) function.</span></span>

 

<span data-ttu-id="dd781-114">Die [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) -Funktion erstellt ein privates Heap Objekt, aus dem der aufrufenden Prozess Speicherblöcke mithilfe der [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) -Funktion zuordnen kann.</span><span class="sxs-lookup"><span data-stu-id="dd781-114">The [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) function creates a private heap object from which the calling process can allocate memory blocks by using the [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) function.</span></span> <span data-ttu-id="dd781-115">**HeapCreate** gibt sowohl eine Anfangs Größe als auch eine maximale Größe für den Heap an.</span><span class="sxs-lookup"><span data-stu-id="dd781-115">**HeapCreate** specifies both an initial size and a maximum size for the heap.</span></span> <span data-ttu-id="dd781-116">Die Anfangs Größe bestimmt die Anzahl der zugeordneten, Lese-/Schreibseiten, die anfänglich für den Heap reserviert wurden.</span><span class="sxs-lookup"><span data-stu-id="dd781-116">The initial size determines the number of committed, read/write pages initially allocated for the heap.</span></span> <span data-ttu-id="dd781-117">Die maximale Größe bestimmt die Gesamtzahl der reservierten Seiten.</span><span class="sxs-lookup"><span data-stu-id="dd781-117">The maximum size determines the total number of reserved pages.</span></span> <span data-ttu-id="dd781-118">Auf diesen Seiten wird ein zusammenhängender Block im virtuellen Adressraum eines Prozesses erstellt, in den der Heap vergrößert werden kann.</span><span class="sxs-lookup"><span data-stu-id="dd781-118">These pages create a contiguous block in the virtual address space of a process into which the heap can grow.</span></span> <span data-ttu-id="dd781-119">Der reservierte Speicherplatz für weitere Seiten wird automatisch zugesichert, wenn die Anforderungen von **heapbelegc** die aktuelle Größe der Seiten mit ausgeführtem Commit überschreiten, vorausgesetzt, dass der physische Speicher für Sie verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="dd781-119">Additional pages are automatically committed from this reserved space if requests by **HeapAlloc** exceed the current size of committed pages, assuming that the physical storage for it is available.</span></span> <span data-ttu-id="dd781-120">Nachdem für die Seiten ein Commit ausgeführt wurde, wird Sie erst dann decommittet, wenn der Prozess beendet oder der Heap zerstört wurde, indem die [**HeapDestroy**](/windows/desktop/api/HeapApi/nf-heapapi-heapdestroy) -Funktion aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="dd781-120">Once the pages are committed, they are not decommitted until the process is terminated or until the heap is destroyed by calling the [**HeapDestroy**](/windows/desktop/api/HeapApi/nf-heapapi-heapdestroy) function.</span></span>

<span data-ttu-id="dd781-121">Der Speicher eines privaten Heap Objekts ist nur für den Prozess zugänglich, der ihn erstellt hat.</span><span class="sxs-lookup"><span data-stu-id="dd781-121">The memory of a private heap object is accessible only to the process that created it.</span></span> <span data-ttu-id="dd781-122">Wenn eine Dynamic Link Library (dll) einen privaten Heap erstellt, erfolgt dies im Adressraum des Prozesses, der die dll aufgerufen hat.</span><span class="sxs-lookup"><span data-stu-id="dd781-122">If a dynamic-link library (DLL) creates a private heap, it does so in the address space of the process that called the DLL.</span></span> <span data-ttu-id="dd781-123">Dieser Vorgang ist nur für diesen Prozess zugänglich.</span><span class="sxs-lookup"><span data-stu-id="dd781-123">It is accessible only to that process.</span></span>

<span data-ttu-id="dd781-124">Die [**heapzugewiesc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) -Funktion ordnet eine angegebene Anzahl von Bytes aus einem privaten Heap zu und gibt einen Zeiger auf den zugeordneten-Block zurück.</span><span class="sxs-lookup"><span data-stu-id="dd781-124">The [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) function allocates a specified number of bytes from a private heap and returns a pointer to the allocated block.</span></span> <span data-ttu-id="dd781-125">Dieser Zeiger kann in den Funktionen [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree), [**heaprezuzuordc**](/windows/desktop/api/HeapApi/nf-heapapi-heaprealloc), [**HEAPSIZE**](/windows/desktop/api/HeapApi/nf-heapapi-heapsize)und [**heapvalidate**](/windows/desktop/api/HeapApi/nf-heapapi-heapvalidate) verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="dd781-125">This pointer can be used in the [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree), [**HeapReAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heaprealloc), [**HeapSize**](/windows/desktop/api/HeapApi/nf-heapapi-heapsize), and [**HeapValidate**](/windows/desktop/api/HeapApi/nf-heapapi-heapvalidate) functions.</span></span>

<span data-ttu-id="dd781-126">Der von [**heapbelegc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) zugeordnete Arbeitsspeicher ist nicht verschiebbar.</span><span class="sxs-lookup"><span data-stu-id="dd781-126">Memory allocated by [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) is not movable.</span></span> <span data-ttu-id="dd781-127">Die von **heapbelegc** zurückgegebene Adresse ist gültig, bis der Speicherblock freigegeben oder neu zugewiesen wurde. der Speicherblock muss nicht gesperrt werden.</span><span class="sxs-lookup"><span data-stu-id="dd781-127">The address returned by **HeapAlloc** is valid until the memory block is freed or reallocated; the memory block does not need to be locked.</span></span>

<span data-ttu-id="dd781-128">Da das System einen privaten Heap nicht komprimieren kann, kann es fragmentiert werden.</span><span class="sxs-lookup"><span data-stu-id="dd781-128">Because the system cannot compact a private heap, it can become fragmented.</span></span> <span data-ttu-id="dd781-129">Anwendungen, die große Mengen an Arbeitsspeicher in verschiedenen Zuordnungs Größen belegen, können den [Heap mit niedriger Fragmentierung](low-fragmentation-heap.md) verwenden, um die Heap Fragmentierung zu verringern.</span><span class="sxs-lookup"><span data-stu-id="dd781-129">Applications that allocate large amounts of memory in various allocation sizes can use the [low-fragmentation heap](low-fragmentation-heap.md) to reduce heap fragmentation.</span></span>

<span data-ttu-id="dd781-130">Eine Möglichkeit, die Heap Funktionen zu verwenden, besteht darin, einen privaten Heap zu erstellen, wenn ein Prozess gestartet wird. dabei wird eine anfängliche Größe angegeben, die ausreicht, um die Arbeitsspeicher Anforderungen des Prozesses zu erfüllen.</span><span class="sxs-lookup"><span data-stu-id="dd781-130">A possible use for the heap functions is to create a private heap when a process starts up, specifying an initial size sufficient to satisfy the memory requirements of the process.</span></span> <span data-ttu-id="dd781-131">Wenn bei dem [**aufheapcreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) -Funktion ein Fehler auftritt, kann der Prozess den Benutzer beenden oder den Speichermangel benachrichtigen. Wenn dies der Fall ist, ist der Prozess jedoch sicher, dass er über den benötigten Arbeitsspeicher verfügt.</span><span class="sxs-lookup"><span data-stu-id="dd781-131">If the call to the [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) function fails, the process can terminate or notify the user of the memory shortage; if it succeeds, however, the process is assured of having the memory it needs.</span></span>

<span data-ttu-id="dd781-132">Der von [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) angeforderte Arbeitsspeicher kann zusammenhängend sein.</span><span class="sxs-lookup"><span data-stu-id="dd781-132">Memory requested by [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) may or may not be contiguous.</span></span> <span data-ttu-id="dd781-133">Der Arbeitsspeicher, der von [**heapbelegc innerhalb eines Heaps**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) zugeordnet wird, ist zusammenhängend.</span><span class="sxs-lookup"><span data-stu-id="dd781-133">Memory allocated within a heap by [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) is contiguous.</span></span> <span data-ttu-id="dd781-134">Sie sollten nicht in einen Heap schreiben oder aus dem Arbeitsspeicher lesen, außer der von **heapbelegc** zugeordnete. Sie sollten auch keine Beziehung zwischen zwei Bereichen des Arbeitsspeichers annehmen, die von **heapbelegc** zugeordnet werden.</span><span class="sxs-lookup"><span data-stu-id="dd781-134">You should not write to or read from memory in a heap except that allocated by **HeapAlloc**, nor should you assume any relationship between two areas of memory allocated by **HeapAlloc**.</span></span>

<span data-ttu-id="dd781-135">Sie sollten in keiner Weise auf Arbeitsspeicher verweisen, der von [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree)freigegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="dd781-135">You should not refer in any way to memory that has been freed by [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree).</span></span> <span data-ttu-id="dd781-136">Nachdem der Arbeitsspeicher freigegeben wurde, sind alle Informationen, die möglicherweise darin enthalten waren, nicht mehr verfügbar.</span><span class="sxs-lookup"><span data-stu-id="dd781-136">After the memory is freed, any information that may have been in it is gone forever.</span></span> <span data-ttu-id="dd781-137">Wenn Sie Informationen benötigen, dürfen Sie keinen Speicher freigeben, der die Informationen enthält.</span><span class="sxs-lookup"><span data-stu-id="dd781-137">If you require information, do not free memory containing the information.</span></span> <span data-ttu-id="dd781-138">Funktionsaufrufe, die Informationen über den Arbeitsspeicher zurückgeben (z. b. [**HEAPSIZE**](/windows/desktop/api/HeapApi/nf-heapapi-heapsize)), dürfen nicht mit frei gegebenes Speicher verwendet werden, da Sie möglicherweise falsche Daten zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="dd781-138">Function calls that return information about memory (such as [**HeapSize**](/windows/desktop/api/HeapApi/nf-heapapi-heapsize)) may not be used with freed memory, as they may return bogus data.</span></span>

<span data-ttu-id="dd781-139">Die [**HeapDestroy**](/windows/desktop/api/HeapApi/nf-heapapi-heapdestroy) -Funktion zerstört ein privates Heap Objekt.</span><span class="sxs-lookup"><span data-stu-id="dd781-139">The [**HeapDestroy**](/windows/desktop/api/HeapApi/nf-heapapi-heapdestroy) function destroys a private heap object.</span></span> <span data-ttu-id="dd781-140">Er führt einen Commit für alle Seiten des Heap Objekts aus und gibt Sie frei, wodurch das Handle für den Heap ungültig wird.</span><span class="sxs-lookup"><span data-stu-id="dd781-140">It decommits and releases all the pages of the heap object, and it invalidates the handle to the heap.</span></span>

## <a name="related-topics"></a><span data-ttu-id="dd781-141">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="dd781-141">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="dd781-142">Vergleichen von Speicher Belegungs Methoden</span><span class="sxs-lookup"><span data-stu-id="dd781-142">Comparing Memory Allocation Methods</span></span>](comparing-memory-allocation-methods.md)
</dt> </dl>

 

 



