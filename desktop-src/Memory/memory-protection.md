---
description: Arbeitsspeicher, der zu einem Prozess gehört, wird implizit durch den privaten virtuellen Adressraum geschützt.
ms.assetid: 70ded07a-7be6-4189-a1ae-281917f42a1e
title: Arbeitsspeicherschutz
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bd30df8084c91a62c28414f4a8142397ee777e52
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "104132036"
---
# <a name="memory-protection"></a><span data-ttu-id="255cf-103">Arbeitsspeicherschutz</span><span class="sxs-lookup"><span data-stu-id="255cf-103">Memory Protection</span></span>

<span data-ttu-id="255cf-104">Arbeitsspeicher, der zu einem Prozess gehört, wird implizit durch den privaten virtuellen Adressraum geschützt.</span><span class="sxs-lookup"><span data-stu-id="255cf-104">Memory that belongs to a process is implicitly protected by its private virtual address space.</span></span> <span data-ttu-id="255cf-105">Außerdem bietet Windows Speicherschutz mithilfe der Hardware des virtuellen Speichers an.</span><span class="sxs-lookup"><span data-stu-id="255cf-105">In addition, Windows provides memory protection by using the virtual memory hardware.</span></span> <span data-ttu-id="255cf-106">Die Implementierung dieses Schutzes variiert je nach Prozessor, z. b. können Codepages im Adressraum eines Prozesses als schreibgeschützt gekennzeichnet und vor Änderungen durch benutzermodusthreads geschützt werden.</span><span class="sxs-lookup"><span data-stu-id="255cf-106">The implementation of this protection varies with the processor, for example, code pages in the address space of a process can be marked read-only and protected from modification by user-mode threads.</span></span>

<span data-ttu-id="255cf-107">Eine umfassende Liste der Attribute finden Sie unter [Speicherschutz Konstanten](memory-protection-constants.md).</span><span class="sxs-lookup"><span data-stu-id="255cf-107">For the complete list of attributes, see [Memory Protection Constants](memory-protection-constants.md).</span></span>

## <a name="copy-on-write-protection"></a><span data-ttu-id="255cf-108">Copy-on-Write-Schutz</span><span class="sxs-lookup"><span data-stu-id="255cf-108">Copy-on-Write Protection</span></span>

<span data-ttu-id="255cf-109">Der Kopier-/Schreibschutz ist eine Optimierung, die es mehreren Prozessen ermöglicht, Ihre virtuellen Adressräume so zuzuordnen, dass Sie eine physische Seite gemeinsam verwenden, bis einer der Prozesse die Seite ändert.</span><span class="sxs-lookup"><span data-stu-id="255cf-109">Copy-on-write protection is an optimization that allows multiple processes to map their virtual address spaces such that they share a physical page until one of the processes modifies the page.</span></span> <span data-ttu-id="255cf-110">Dies ist Teil einer Technik namens " *Lazy Evaluation*", die es dem System ermöglicht, physischen Arbeitsspeicher und Zeit zu sparen, indem Sie einen Vorgang erst ausführen, wenn dies unbedingt erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="255cf-110">This is part of a technique called *lazy evaluation*, which allows the system to conserve physical memory and time by not performing an operation until absolutely necessary.</span></span>

<span data-ttu-id="255cf-111">Nehmen Sie beispielsweise an, dass zwei Prozesse Seiten aus derselben DLL in Ihre virtuellen Speicherplätze laden.</span><span class="sxs-lookup"><span data-stu-id="255cf-111">For example, suppose two processes load pages from the same DLL into their virtual memory spaces.</span></span> <span data-ttu-id="255cf-112">Diese virtuellen Speicherseiten werden den gleichen physischen Speicherseiten für beide Prozesse zugeordnet.</span><span class="sxs-lookup"><span data-stu-id="255cf-112">These virtual memory pages are mapped to the same physical memory pages for both processes.</span></span> <span data-ttu-id="255cf-113">Solange keine Prozesse auf diese Seiten schreiben, können Sie die gleichen physischen Seiten zuordnen und freigeben, wie im folgenden Diagramm dargestellt.</span><span class="sxs-lookup"><span data-stu-id="255cf-113">As long as neither process writes to these pages, they can map to and share, the same physical pages, as shown in the following diagram.</span></span>

![Felder und Pfeile von Prozess 1 und 2 Seiten, die demselben physischen Speicher zugeordnet sind](images/mem1.png)

<span data-ttu-id="255cf-115">Wenn Prozess 1 auf eine dieser Seiten schreibt, wird der Inhalt der physischen Seite auf eine andere physische Seite kopiert, und die virtuelle Arbeitsspeicher Zuordnung wird für Prozess 1 aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="255cf-115">If Process 1 writes to one of these pages, the contents of the physical page are copied to another physical page and the virtual memory map is updated for Process 1.</span></span> <span data-ttu-id="255cf-116">Beide Prozesse verfügen nun über eine eigene Instanz der Seite im physischen Arbeitsspeicher.</span><span class="sxs-lookup"><span data-stu-id="255cf-116">Both processes now have their own instance of the page in physical memory.</span></span> <span data-ttu-id="255cf-117">Daher ist es nicht möglich, dass ein Prozess auf eine freigegebene physische Seite schreibt und der andere Prozess die Änderungen sieht.</span><span class="sxs-lookup"><span data-stu-id="255cf-117">Therefore, it is not possible for one process to write to a shared physical page and for the other process to see the changes.</span></span>

![Felder und Pfeile von Prozessen und Neuzuordnung physischer Speicher](images/mem2.png)

## <a name="loading-applications-and-dlls"></a><span data-ttu-id="255cf-119">Laden von Anwendungen und DLLs</span><span class="sxs-lookup"><span data-stu-id="255cf-119">Loading Applications and DLLs</span></span>

<span data-ttu-id="255cf-120">Wenn mehrere Instanzen derselben Windows-basierten Anwendung geladen werden, wird jede Instanz in einem eigenen geschützten virtuellen Adressbereich ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="255cf-120">When multiple instances of the same Windows-based application are loaded, each instance is run in its own protected virtual address space.</span></span> <span data-ttu-id="255cf-121">Ihre Instanzhandles (*HINSTANCE*) weisen jedoch in der Regel den gleichen Wert auf.</span><span class="sxs-lookup"><span data-stu-id="255cf-121">However, their instance handles (*hInstance*) typically have the same value.</span></span> <span data-ttu-id="255cf-122">Dieser Wert stellt die Basisadresse der Anwendung im virtuellen Adressraum dar.</span><span class="sxs-lookup"><span data-stu-id="255cf-122">This value represents the base address of the application in its virtual address space.</span></span> <span data-ttu-id="255cf-123">Wenn jede Instanz in die Standardbasis Adresse geladen werden kann, kann Sie mithilfe von Copy-on-Write-Schutz die gleichen physischen Seiten mit den anderen Instanzen zuordnen und freigeben.</span><span class="sxs-lookup"><span data-stu-id="255cf-123">If each instance can be loaded into its default base address, it can map to and share the same physical pages with the other instances, using copy-on-write protection.</span></span> <span data-ttu-id="255cf-124">Das System ermöglicht es diesen Instanzen, die gleichen physischen Seiten gemeinsam zu verwenden, bis einer von Ihnen eine Seite ändert.</span><span class="sxs-lookup"><span data-stu-id="255cf-124">The system allows these instances to share the same physical pages until one of them modifies a page.</span></span> <span data-ttu-id="255cf-125">Wenn eine dieser Instanzen aus irgendeinem Grund nicht in die gewünschte Basisadresse geladen werden kann, erhält Sie Ihre eigenen physischen Seiten.</span><span class="sxs-lookup"><span data-stu-id="255cf-125">If for some reason one of these instances cannot be loaded in the desired base address, it receives its own physical pages.</span></span>

<span data-ttu-id="255cf-126">DLLs werden mit einer Standardbasis Adresse erstellt.</span><span class="sxs-lookup"><span data-stu-id="255cf-126">DLLs are created with a default base address.</span></span> <span data-ttu-id="255cf-127">Jeder Prozess, der eine DLL verwendet, versucht, die dll in Ihrem eigenen Adressraum an der virtuellen Standardadresse für die dll zu laden.</span><span class="sxs-lookup"><span data-stu-id="255cf-127">Every process that uses a DLL will try to load the DLL within its own address space at the default virtual address for the DLL.</span></span> <span data-ttu-id="255cf-128">Wenn mehrere Anwendungen eine DLL an der virtuellen Standardadresse laden können, können Sie die gleichen physischen Seiten für die DLL verwenden.</span><span class="sxs-lookup"><span data-stu-id="255cf-128">If multiple applications can load a DLL at its default virtual address, they can share the same physical pages for the DLL.</span></span> <span data-ttu-id="255cf-129">Wenn die dll aus irgendeinem Grund von einem Prozess nicht in der Standardadresse geladen werden kann, wird die dll an einen anderen Speicherort geladen.</span><span class="sxs-lookup"><span data-stu-id="255cf-129">If for some reason a process cannot load the DLL at the default address, it loads the DLL elsewhere.</span></span> <span data-ttu-id="255cf-130">Bei einem Kopier-/Schreibschutz müssen einige der dll-Seiten für diesen Prozess auf verschiedene physische Seiten kopiert werden, da die Korrekturen für Jump-Anweisungen auf den Seiten der dll geschrieben werden und für diesen Prozess unterschiedlich sind.</span><span class="sxs-lookup"><span data-stu-id="255cf-130">Copy-on-write protection forces some of the DLL's pages to be copied into different physical pages for this process, because the fixes for jump instructions are written within the DLL's pages, and they will be different for this process.</span></span> <span data-ttu-id="255cf-131">Wenn der Code Abschnitt viele Verweise auf den Daten Abschnitt enthält, kann dies dazu führen, dass der gesamte Code Abschnitt auf neue physische Seiten kopiert wird.</span><span class="sxs-lookup"><span data-stu-id="255cf-131">If the code section contains many references to the data section, this can cause the entire code section to be copied to new physical pages.</span></span>

 

 



