---
description: Der erste Schritt beim Mapping einer Datei besteht darin, die Datei zu öffnen, indem Sie die CreateFile-Funktion aufrufen.
ms.assetid: e00d8742-b717-419c-902c-9a286d75d8aa
title: Erstellen eines Datei Mapping-Objekts
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 65badc2af8aed5211c2f5c590fc0998019dae264
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "104345368"
---
# <a name="creating-a-file-mapping-object"></a><span data-ttu-id="d3874-103">Erstellen eines Datei Mapping-Objekts</span><span class="sxs-lookup"><span data-stu-id="d3874-103">Creating a File Mapping Object</span></span>

<span data-ttu-id="d3874-104">Der erste Schritt beim Mapping einer Datei besteht darin, die Datei zu öffnen, indem Sie die [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) -Funktion aufrufen.</span><span class="sxs-lookup"><span data-stu-id="d3874-104">The first step in mapping a file is to open the file by calling the [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) function.</span></span> <span data-ttu-id="d3874-105">Um sicherzustellen, dass andere Prozesse nicht in den Teil der Datei schreiben können, der zugeordnet ist, sollten Sie die Datei mit exklusiven Zugriffsberechtigungen öffnen.</span><span class="sxs-lookup"><span data-stu-id="d3874-105">To ensure that other processes cannot write to the portion of the file that is mapped, you should open the file with exclusive access.</span></span> <span data-ttu-id="d3874-106">Außerdem sollte das Datei Handle geöffnet bleiben, bis der Prozess das Datei Zuordnungsobjekt nicht mehr benötigt.</span><span class="sxs-lookup"><span data-stu-id="d3874-106">In addition, the file handle should remain open until the process no longer needs the file mapping object.</span></span> <span data-ttu-id="d3874-107">Eine einfache Möglichkeit, exklusiven Zugriff zu erhalten, ist die Angabe von 0 (null) im *fdwsharemode* -Parameter von " **kreatefile**".</span><span class="sxs-lookup"><span data-stu-id="d3874-107">An easy way to obtain exclusive access is to specify zero in the *fdwShareMode* parameter of **CreateFile**.</span></span> <span data-ttu-id="d3874-108">Das von " **kreatefile** " zurückgegebene Handle wird von der Funktion "Create [**FileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) " verwendet, um ein Datei Zuordnung-Objekt zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="d3874-108">The handle returned by **CreateFile** is used by the [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function to create a file mapping object.</span></span>

<span data-ttu-id="d3874-109">Die Funktion " [**fiatefilemapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) " gibt ein Handle für das Datei-Mapping-Objekt zurück.</span><span class="sxs-lookup"><span data-stu-id="d3874-109">The [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function returns a handle to the file mapping object.</span></span> <span data-ttu-id="d3874-110">Dieses Handle wird verwendet, wenn [eine Dateiansicht erstellt](creating-a-file-view.md) wird, sodass Sie auf den freigegebenen Speicher zugreifen können.</span><span class="sxs-lookup"><span data-stu-id="d3874-110">This handle will be used when [creating a file view](creating-a-file-view.md) so that you can access the shared memory.</span></span> <span data-ttu-id="d3874-111">Wenn Sie " **kreatefilemapping**" aufrufen, geben Sie einen Objektnamen, die Anzahl der Bytes, die der Datei zugeordnet werden sollen, und die Lese-/Schreibberechtigung für den zugeordneten Speicher an.</span><span class="sxs-lookup"><span data-stu-id="d3874-111">When you call **CreateFileMapping**, you specify an object name, the number of bytes to be mapped from the file, and the read/write permission for the mapped memory.</span></span> <span data-ttu-id="d3874-112">Der erste Prozess, der " **kreatefilemapping** " aufruft, erstellt das Datei Zuordnung-Objekt.</span><span class="sxs-lookup"><span data-stu-id="d3874-112">The first process that calls **CreateFileMapping** creates the file mapping object.</span></span> <span data-ttu-id="d3874-113">Prozesse, die **CreateFileMapping** für ein vorhandenes Objekt aufrufen, erhalten ein Handle für das vorhandene Objekt.</span><span class="sxs-lookup"><span data-stu-id="d3874-113">Processes calling **CreateFileMapping** for an existing object receive a handle to the existing object.</span></span> <span data-ttu-id="d3874-114">Sie können feststellen, ob ein erfolgreicher Aufruf von **CreateFileMapping** das Datei Zuordnung-Objekt erstellt oder geöffnet hat, indem Sie die [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror) -Funktion aufrufen.</span><span class="sxs-lookup"><span data-stu-id="d3874-114">You can tell whether or not a successful call to **CreateFileMapping** created or opened the file mapping object by calling the [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror) function.</span></span> <span data-ttu-id="d3874-115">**GetLastError** gibt **keinen \_ Fehler** an den Erstellungsprozess zurück, und der Fehler ist für nachfolgende Prozesse **\_ bereits \_ vorhanden** .</span><span class="sxs-lookup"><span data-stu-id="d3874-115">**GetLastError** returns **NO\_ERROR** to the creating process and **ERROR\_ALREADY\_EXISTS** to subsequent processes.</span></span>

<span data-ttu-id="d3874-116">Die Funktion "Funktion für die Funktion" schlägt fehl, wenn die Zugriffsflags [**mit den beim**](/windows/win32/api/fileapi/nf-fileapi-createfilea) Öffnen der Datei [**angegebenen Funktionen in**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) Konflikt stehen.</span><span class="sxs-lookup"><span data-stu-id="d3874-116">The [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function fails if the access flags conflict with those specified when the [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) function opened the file.</span></span> <span data-ttu-id="d3874-117">Beispielsweise zum Lesen und Schreiben in die Datei:</span><span class="sxs-lookup"><span data-stu-id="d3874-117">For example, to read and write to the file:</span></span>

-   <span data-ttu-id="d3874-118">Geben **Sie die generischen \_ Lese** -und **generischen \_ Schreib** Werte im Parameter " *bdwaccess* " von " [**kreatefile**](/windows/win32/api/fileapi/nf-fileapi-createfilea)" an.</span><span class="sxs-lookup"><span data-stu-id="d3874-118">Specify the **GENERIC\_READ** and **GENERIC\_WRITE** values in the *fdwAccess* parameter of [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea).</span></span>
-   <span data-ttu-id="d3874-119">Geben Sie den Wert für die **Seiten \_ Lese** Vorgänge im Parameter " *sdwprotect* " von " [**kreatefilemapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga)" an.</span><span class="sxs-lookup"><span data-stu-id="d3874-119">Specify the **PAGE\_READWRITE** value in the *fdwProtect* parameter of [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga).</span></span>

<span data-ttu-id="d3874-120">Beim Erstellen eines Datei Zuordnungsobjekts wird kein Commit für den physischen Speicher durchführt, sondern nur reserviert.</span><span class="sxs-lookup"><span data-stu-id="d3874-120">Creating a file mapping object does not commit physical memory, it only reserves it.</span></span>

## <a name="file-mapping-size"></a><span data-ttu-id="d3874-121">Größe der Datei Zuordnung</span><span class="sxs-lookup"><span data-stu-id="d3874-121">File Mapping Size</span></span>

<span data-ttu-id="d3874-122">Die Größe des Datei Zuordnungsobjekts ist unabhängig von der Größe der Datei, die zugeordnet wird.</span><span class="sxs-lookup"><span data-stu-id="d3874-122">The size of the file mapping object is independent of the size of the file being mapped.</span></span> <span data-ttu-id="d3874-123">Wenn das Datei Zuordnungsobjekt jedoch größer als die Datei ist, erweitert das System die Datei [](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) , bevor die Datei zuordnet.</span><span class="sxs-lookup"><span data-stu-id="d3874-123">However, if the file mapping object is larger than the file, the system expands the file before [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) returns.</span></span> <span data-ttu-id="d3874-124">Wenn das Datei Zuordnungs Objekt kleiner als die Datei ist, ordnet das System nur die angegebene Anzahl von Bytes aus der Datei zu.</span><span class="sxs-lookup"><span data-stu-id="d3874-124">If the file mapping object is smaller than the file, the system maps only the specified number of bytes from the file.</span></span>

<span data-ttu-id="d3874-125">Mit den Parametern *dwmaximumsizehigh* und *dwmaximumsizelow* von " [**kreatefilemapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) " können Sie die Anzahl der Bytes angeben, die aus der Datei zugeordnet werden sollen:</span><span class="sxs-lookup"><span data-stu-id="d3874-125">The *dwMaximumSizeHigh* and *dwMaximumSizeLow* parameters of [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) allow you to specify the number of bytes to be mapped from the file:</span></span>

-   <span data-ttu-id="d3874-126">Wenn Sie nicht möchten, dass die Datei geändert wird (z. b. bei der Zuordnung Schreib geschützter Dateien), müssen Sie für " *dwmaximumsizehigh* [**" und "**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) *dwmaximumsizelow*" den Wert "0" aufrufen und NULL angeben.</span><span class="sxs-lookup"><span data-stu-id="d3874-126">When you do not want the size of the file to change (for example, when mapping read-only files), call [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) and specify zero for both *dwMaximumSizeHigh* and *dwMaximumSizeLow*.</span></span> <span data-ttu-id="d3874-127">Dadurch wird ein Datei Mapping-Objekt erstellt, das exakt der Größe der Datei entspricht.</span><span class="sxs-lookup"><span data-stu-id="d3874-127">Doing this creates a file mapping object that is exactly the same size as the file.</span></span> <span data-ttu-id="d3874-128">Andernfalls müssen Sie die Größe der fertigen Datei berechnen oder schätzen, da die Größe der Datei Zuordnung von Objekten statisch ist. nach der Erstellung kann die Größe nicht mehr gesteigert oder verringert werden.</span><span class="sxs-lookup"><span data-stu-id="d3874-128">Otherwise, you must calculate or estimate the size of the finished file because file mapping objects are static in size; once created, their size cannot be increased or decreased.</span></span> <span data-ttu-id="d3874-129">Der Versuch, eine Datei mit einer Länge von NULL auf diese Weise zuzuordnen, schlägt mit dem Fehlercode **" \_ \_ ungültige Fehler Datei**" fehl.</span><span class="sxs-lookup"><span data-stu-id="d3874-129">An attempt to map a file with a length of zero in this manner fails with an error code of **ERROR\_FILE\_INVALID**.</span></span> <span data-ttu-id="d3874-130">Programme sollten auf Dateien mit einer Länge von 0 (null) testen und solche Dateien ablehnen.</span><span class="sxs-lookup"><span data-stu-id="d3874-130">Programs should test for files with a length of zero and reject such files.</span></span>

-   <span data-ttu-id="d3874-131">Die Größe eines Datei Mapping-Objekts, das von einer benannten Datei unterstützt wird, ist durch Speicherplatz beschränkt.</span><span class="sxs-lookup"><span data-stu-id="d3874-131">The size of a file mapping object that is backed by a named file is limited by disk space.</span></span> <span data-ttu-id="d3874-132">Die Größe einer Dateiansicht ist auf den größten verfügbaren zusammenhängenden Block des nicht reservierten virtuellen Speichers beschränkt.</span><span class="sxs-lookup"><span data-stu-id="d3874-132">The size of a file view is limited to the largest available contiguous block of unreserved virtual memory.</span></span> <span data-ttu-id="d3874-133">Dies liegt höchstens bei 2 GB minus dem virtuellen Arbeitsspeicher, der vom Prozess bereits reserviert wurde.</span><span class="sxs-lookup"><span data-stu-id="d3874-133">This is at most 2 GB minus the virtual memory already reserved by the process.</span></span>

<span data-ttu-id="d3874-134">Die Größe des von Ihnen ausgewählten Datei Mapping-Objekts steuert, wie weit die Datei, die Sie anzeigen können, mit der Speicher Zuordnung angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="d3874-134">The size of the file mapping object that you select controls how far into the file you can "see" with memory mapping.</span></span> <span data-ttu-id="d3874-135">Wenn Sie ein Datei Zuordnungsobjekt erstellen, das 500 KB groß ist, haben Sie nur Zugriff auf die ersten 500 KB der Datei, unabhängig von der Größe der Datei.</span><span class="sxs-lookup"><span data-stu-id="d3874-135">If you create a file mapping object that is 500 Kb in size, you have access only to the first 500 Kb of the file, regardless of the size of the file.</span></span> <span data-ttu-id="d3874-136">Da Sie keine Systemressourcen für die Erstellung eines größeren Datei Zuordnungs Objekts Kosten, erstellen Sie ein Datei Zuordnungs Objekt, bei dem es sich um die Größe der Datei handelt (legen Sie die Parameter *dwmaximumsizehigh* und *dwmaximumsizelow* von [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) auf NULL fest), auch wenn Sie nicht erwarten, dass Sie die gesamte Datei anzeigen.</span><span class="sxs-lookup"><span data-stu-id="d3874-136">Since it does not cost you any system resources to create a larger file mapping object, create a file mapping object that is the size of the file (set the *dwMaximumSizeHigh* and *dwMaximumSizeLow* parameters of [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) both to zero) even if you do not expect to view the entire file.</span></span> <span data-ttu-id="d3874-137">Die Kosten für Systemressourcen entstehen in der Erstellung der Sichten und des Zugriffs auf diese.</span><span class="sxs-lookup"><span data-stu-id="d3874-137">The cost in system resources comes in creating the views and accessing them.</span></span>

<span data-ttu-id="d3874-138">Wenn Sie einen Teil der Datei anzeigen möchten, der nicht am Anfang der Datei beginnt, müssen Sie ein Datei Zuordnungsobjekt erstellen.</span><span class="sxs-lookup"><span data-stu-id="d3874-138">If you want to view a portion of the file that does not start at the beginning of the file, you must create a file mapping object.</span></span> <span data-ttu-id="d3874-139">Bei diesem Objekt handelt es sich um die Größe des Teils der Datei, die Sie anzeigen möchten, sowie um den Offset in der Datei.</span><span class="sxs-lookup"><span data-stu-id="d3874-139">This object is the size of the portion of the file that you want to view plus the offset into the file.</span></span>

## <a name="related-topics"></a><span data-ttu-id="d3874-140">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="d3874-140">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d3874-141">Erstellen einer Ansicht in einer Datei</span><span class="sxs-lookup"><span data-stu-id="d3874-141">Creating a View Within a File</span></span>](creating-a-view-within-a-file.md)
</dt> </dl>

 

 
