---
description: Der erste Schritt beim Zuordnen einer Datei besteht darin, die Datei durch Aufrufen der CreateFile-Funktion zu öffnen.
ms.assetid: e00d8742-b717-419c-902c-9a286d75d8aa
title: Erstellen eines Dateizuordnungsobjekts
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b502c484dd0466b47a87f4db205d1da5499bf5ef
ms.sourcegitcommit: c3f669dc1d52278432bf75ad9fddba3257d26aa2
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 06/04/2021
ms.locfileid: "111432502"
---
# <a name="creating-a-file-mapping-object"></a><span data-ttu-id="59601-103">Erstellen eines Dateizuordnungsobjekts</span><span class="sxs-lookup"><span data-stu-id="59601-103">Creating a File Mapping Object</span></span>

<span data-ttu-id="59601-104">Der erste Schritt beim Zuordnen einer Datei besteht darin, die Datei durch Aufrufen der [**CreateFile-Funktion**](/windows/win32/api/fileapi/nf-fileapi-createfilea) zu öffnen.</span><span class="sxs-lookup"><span data-stu-id="59601-104">The first step in mapping a file is to open the file by calling the [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) function.</span></span> <span data-ttu-id="59601-105">Um sicherzustellen, dass andere Prozesse nicht in den Teil der zugeordneten Datei schreiben können, sollten Sie die Datei mit exklusivem Zugriff öffnen.</span><span class="sxs-lookup"><span data-stu-id="59601-105">To ensure that other processes cannot write to the portion of the file that is mapped, you should open the file with exclusive access.</span></span> <span data-ttu-id="59601-106">Darüber hinaus sollte das Dateihandle geöffnet bleiben, bis der Prozess das Dateizuordnungsobjekt nicht mehr benötigt.</span><span class="sxs-lookup"><span data-stu-id="59601-106">In addition, the file handle should remain open until the process no longer needs the file mapping object.</span></span> <span data-ttu-id="59601-107">Eine einfache Möglichkeit, exklusiven Zugriff zu erhalten, besteht darin, 0 (null) im *fdwShareMode-Parameter* von **CreateFile** anzugeben.</span><span class="sxs-lookup"><span data-stu-id="59601-107">An easy way to obtain exclusive access is to specify zero in the *fdwShareMode* parameter of **CreateFile**.</span></span> <span data-ttu-id="59601-108">Das von **CreateFile** zurückgegebene Handle wird von der [**CreateFileMapping-Funktion**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) verwendet, um ein Dateizuordnungsobjekt zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="59601-108">The handle returned by **CreateFile** is used by the [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function to create a file mapping object.</span></span>

<span data-ttu-id="59601-109">Die [**CreateFileMapping-Funktion**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) gibt ein Handle für das Dateizuordnungsobjekt zurück.</span><span class="sxs-lookup"><span data-stu-id="59601-109">The [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function returns a handle to the file mapping object.</span></span> <span data-ttu-id="59601-110">Dieses Handle wird beim [Erstellen einer Dateiansicht](creating-a-file-view.md) verwendet, damit Sie auf den freigegebenen Arbeitsspeicher zugreifen können.</span><span class="sxs-lookup"><span data-stu-id="59601-110">This handle will be used when [creating a file view](creating-a-file-view.md) so that you can access the shared memory.</span></span> <span data-ttu-id="59601-111">Wenn Sie **CreateFileMapping** aufrufen, geben Sie einen Objektnamen, die Anzahl der aus der Datei zuzuordnenden Bytes und die Lese-/Schreibberechtigung für den zugeordneten Speicher an.</span><span class="sxs-lookup"><span data-stu-id="59601-111">When you call **CreateFileMapping**, you specify an object name, the number of bytes to be mapped from the file, and the read/write permission for the mapped memory.</span></span> <span data-ttu-id="59601-112">Der erste Prozess, der **CreateFileMapping** aufruft, erstellt das Dateizuordnungsobjekt.</span><span class="sxs-lookup"><span data-stu-id="59601-112">The first process that calls **CreateFileMapping** creates the file mapping object.</span></span> <span data-ttu-id="59601-113">Prozesse, die **CreateFileMapping** für ein vorhandenes Objekt aufrufen, empfangen ein Handle für das vorhandene Objekt.</span><span class="sxs-lookup"><span data-stu-id="59601-113">Processes calling **CreateFileMapping** for an existing object receive a handle to the existing object.</span></span> <span data-ttu-id="59601-114">Sie können feststellen, ob ein erfolgreicher Aufruf von **CreateFileMapping** das Dateizuordnungsobjekt erstellt oder geöffnet hat, indem Sie die [**GetLastError-Funktion**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror) aufrufen.</span><span class="sxs-lookup"><span data-stu-id="59601-114">You can tell whether or not a successful call to **CreateFileMapping** created or opened the file mapping object by calling the [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror) function.</span></span> <span data-ttu-id="59601-115">**GetLastError** gibt **NO \_ ERROR** an den Erstellungsprozess und **ERROR ALREADY \_ \_ EXISTS** an nachfolgende Prozesse zurück.</span><span class="sxs-lookup"><span data-stu-id="59601-115">**GetLastError** returns **NO\_ERROR** to the creating process and **ERROR\_ALREADY\_EXISTS** to subsequent processes.</span></span>

<span data-ttu-id="59601-116">Die [**CreateFileMapping-Funktion**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) schlägt fehl, wenn die Zugriffsflags mit denen in Konflikt geraten, die beim Öffnen der Datei durch die [**CreateFile-Funktion**](/windows/win32/api/fileapi/nf-fileapi-createfilea) angegeben wurden.</span><span class="sxs-lookup"><span data-stu-id="59601-116">The [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function fails if the access flags conflict with those specified when the [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) function opened the file.</span></span> <span data-ttu-id="59601-117">Um z. B. die Datei zu lesen und in sie zu schreiben:</span><span class="sxs-lookup"><span data-stu-id="59601-117">For example, to read and write to the file:</span></span>

-   <span data-ttu-id="59601-118">Geben Sie die Werte **GENERIC \_ READ** und **GENERIC \_ WRITE** im *fdwAccess-Parameter* von [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea)an.</span><span class="sxs-lookup"><span data-stu-id="59601-118">Specify the **GENERIC\_READ** and **GENERIC\_WRITE** values in the *fdwAccess* parameter of [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea).</span></span>
-   <span data-ttu-id="59601-119">Geben Sie den **PAGE \_ READWRITE-Wert** im *fdwProtect-Parameter* von [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga)an.</span><span class="sxs-lookup"><span data-stu-id="59601-119">Specify the **PAGE\_READWRITE** value in the *fdwProtect* parameter of [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga).</span></span>

<span data-ttu-id="59601-120">Beim Erstellen eines Dateizuordnungsobjekts wird kein physischer Arbeitsspeicher committen, sondern nur reserviert.</span><span class="sxs-lookup"><span data-stu-id="59601-120">Creating a file mapping object does not commit physical memory, it only reserves it.</span></span>

## <a name="file-mapping-size"></a><span data-ttu-id="59601-121">Dateizuordnungsgröße</span><span class="sxs-lookup"><span data-stu-id="59601-121">File Mapping Size</span></span>

<span data-ttu-id="59601-122">Die Größe des Dateizuordnungsobjekts ist unabhängig von der Größe der zuzuordnenden Datei.</span><span class="sxs-lookup"><span data-stu-id="59601-122">The size of the file mapping object is independent of the size of the file being mapped.</span></span> <span data-ttu-id="59601-123">Wenn das Dateizuordnungsobjekt jedoch größer als die Datei ist, erweitert das System die Datei, bevor [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="59601-123">However, if the file mapping object is larger than the file, the system expands the file before [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) returns.</span></span> <span data-ttu-id="59601-124">Wenn das Dateizuordnungsobjekt kleiner als die Datei ist, ordnet das System nur die angegebene Anzahl von Bytes aus der Datei zu.</span><span class="sxs-lookup"><span data-stu-id="59601-124">If the file mapping object is smaller than the file, the system maps only the specified number of bytes from the file.</span></span>

<span data-ttu-id="59601-125">Mit *den Parametern dwMaximumSizeHigh* und *dwMaximumSizeLow* von [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) können Sie die Anzahl der Bytes angeben, die aus der Datei zugeordnet werden sollen:</span><span class="sxs-lookup"><span data-stu-id="59601-125">The *dwMaximumSizeHigh* and *dwMaximumSizeLow* parameters of [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) allow you to specify the number of bytes to be mapped from the file:</span></span>

-   <span data-ttu-id="59601-126">Wenn Sie nicht möchten, dass sich die Größe der Datei ändert (z. B. beim Zuordnen schreibgeschützter Dateien), rufen [**Sie CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) auf, und geben Sie 0 (null) für *dwMaximumSizeHigh* und *dwMaximumSizeLow* an.</span><span class="sxs-lookup"><span data-stu-id="59601-126">When you do not want the size of the file to change (for example, when mapping read-only files), call [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) and specify zero for both *dwMaximumSizeHigh* and *dwMaximumSizeLow*.</span></span> <span data-ttu-id="59601-127">Dadurch wird ein Dateizuordnungsobjekt erstellt, das genau die gleiche Größe wie die Datei hat.</span><span class="sxs-lookup"><span data-stu-id="59601-127">Doing this creates a file mapping object that is exactly the same size as the file.</span></span> <span data-ttu-id="59601-128">Andernfalls müssen Sie die Größe der fertig gestellten Datei berechnen oder schätzen, da Dateizuordnungsobjekte statisch sind. Nach der Erstellung kann die Größe nicht mehr erhöht oder verringert werden.</span><span class="sxs-lookup"><span data-stu-id="59601-128">Otherwise, you must calculate or estimate the size of the finished file because file mapping objects are static in size; once created, their size cannot be increased or decreased.</span></span> <span data-ttu-id="59601-129">Der Versuch, eine Datei mit der Länge 0 (null) auf diese Weise zuzuordnen, schlägt mit dem Fehlercode **ERROR \_ FILE INVALID \_ fehl.**</span><span class="sxs-lookup"><span data-stu-id="59601-129">An attempt to map a file with a length of zero in this manner fails with an error code of **ERROR\_FILE\_INVALID**.</span></span> <span data-ttu-id="59601-130">Programme sollten auf Dateien mit einer Länge von 0 (null) testen und solche Dateien ablehnen.</span><span class="sxs-lookup"><span data-stu-id="59601-130">Programs should test for files with a length of zero and reject such files.</span></span>

-   <span data-ttu-id="59601-131">Die Größe eines Dateizuordnungsobjekts, das durch eine benannte Datei gesichert wird, ist durch den Speicherplatz beschränkt.</span><span class="sxs-lookup"><span data-stu-id="59601-131">The size of a file mapping object that is backed by a named file is limited by disk space.</span></span> <span data-ttu-id="59601-132">Die Größe einer Dateiansicht ist auf den größten verfügbaren zusammenhängenden Block nicht bereitgestellten virtuellen Arbeitsspeichers beschränkt.</span><span class="sxs-lookup"><span data-stu-id="59601-132">The size of a file view is limited to the largest available contiguous block of unreserved virtual memory.</span></span> <span data-ttu-id="59601-133">Dies beträgt höchstens 2 GB abzüglich des virtuellen Arbeitsspeichers, der bereits vom Prozess reserviert wurde.</span><span class="sxs-lookup"><span data-stu-id="59601-133">This is at most 2 GB minus the virtual memory already reserved by the process.</span></span>

<span data-ttu-id="59601-134">Die Größe des ausgewählten Dateizuordnungsobjekts steuert, wie weit die Datei mit der Speicherzuordnung "angezeigt" werden kann.</span><span class="sxs-lookup"><span data-stu-id="59601-134">The size of the file mapping object that you select controls how far into the file you can "see" with memory mapping.</span></span> <span data-ttu-id="59601-135">Wenn Sie ein Dateizuordnungsobjekt mit einer Größe von 500 KB erstellen, haben Sie unabhängig von der Größe der Datei nur Zugriff auf die ersten 500 KB der Datei.</span><span class="sxs-lookup"><span data-stu-id="59601-135">If you create a file mapping object that is 500 Kb in size, you have access only to the first 500 Kb of the file, regardless of the size of the file.</span></span> <span data-ttu-id="59601-136">Da die Erstellung eines größeren Dateizuordnungsobjekts keine Systemressourcen kostet, erstellen Sie ein Dateizuordnungsobjekt, das der Größe der Datei entspricht (legen Sie die Parameter *dwMaximumSizeHigh* und *dwMaximumSizeLow* von [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) auf 0 fest), auch wenn Sie nicht erwarten, die gesamte Datei anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="59601-136">Since it does not cost you any system resources to create a larger file mapping object, create a file mapping object that is the size of the file (set the *dwMaximumSizeHigh* and *dwMaximumSizeLow* parameters of [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) both to zero) even if you do not expect to view the entire file.</span></span> <span data-ttu-id="59601-137">Die Kosten für Systemressourcen entstehen durch das Erstellen der Ansichten und den Zugriff darauf.</span><span class="sxs-lookup"><span data-stu-id="59601-137">The cost in system resources comes in creating the views and accessing them.</span></span>

<span data-ttu-id="59601-138">Sie können einen Teil der Datei anzeigen, der nicht am Anfang der Datei beginnt.</span><span class="sxs-lookup"><span data-stu-id="59601-138">You can view a portion of the file that does not start at the beginning of the file.</span></span> <span data-ttu-id="59601-139">Weitere Informationen finden Sie unter [Erstellen einer Ansicht in einer Datei.](creating-a-view-within-a-file.md)</span><span class="sxs-lookup"><span data-stu-id="59601-139">For more information, see [Creating a View Within a File](creating-a-view-within-a-file.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="59601-140">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="59601-140">Related topics</span></span>

<dl> <span data-ttu-id="59601-141"><dt>
[Erstellen einer Dateiansicht](creating-a-file-view.md)
</dt> <dt> 
[Erstellen einer Ansicht in einer Datei](creating-a-view-within-a-file.md)
</dt> </span><span class="sxs-lookup"><span data-stu-id="59601-141"><dt>
[Creating a File View](creating-a-file-view.md)
</dt> <dt>
[Creating a View Within a File](creating-a-view-within-a-file.md)
</dt> </span></span></dl>


 
