---
title: Momentaufnahmen des Systems
description: Momentaufnahmen sind das Kernstück der Tool Hilfefunktionen. Eine Momentaufnahme ist eine schreibgeschützte Kopie des aktuellen Status einer oder mehrerer der folgenden Listen, die sich in Systemspeicher Prozessen, Threads, Modulen und Heaps befinden.
ms.assetid: a8122960-f078-4efb-8e01-bf6fb69ee0dd
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6ab6f9a45ad2e12eda53d3143e43c9234c20aae3
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/20/2020
ms.locfileid: "103858350"
---
# <a name="snapshots-of-the-system"></a><span data-ttu-id="fca78-104">Momentaufnahmen des Systems</span><span class="sxs-lookup"><span data-stu-id="fca78-104">Snapshots of the System</span></span>

<span data-ttu-id="fca78-105">Momentaufnahmen sind das Kernstück der Tool Hilfefunktionen.</span><span class="sxs-lookup"><span data-stu-id="fca78-105">Snapshots are at the core of the tool help functions.</span></span> <span data-ttu-id="fca78-106">Eine Momentaufnahme ist eine schreibgeschützte Kopie des aktuellen Status einer oder mehrerer der folgenden Listen, die sich im Systemspeicher befinden: Prozesse, Threads, Module und Heaps.</span><span class="sxs-lookup"><span data-stu-id="fca78-106">A snapshot is a read-only copy of the current state of one or more of the following lists that reside in system memory: processes, threads, modules, and heaps.</span></span>

<span data-ttu-id="fca78-107">Prozesse, die Tool Hilfefunktionen verwenden, greifen auf diese Listen von Momentaufnahmen anstatt direkt vom Betriebssystem aus zu.</span><span class="sxs-lookup"><span data-stu-id="fca78-107">Processes that use tool help functions access these lists from snapshots instead of directly from the operating system.</span></span> <span data-ttu-id="fca78-108">Die Listen im Systemspeicher ändern sich, wenn Prozesse gestartet und beendet werden, Threads erstellt und zerstört werden, ausführbare Module geladen und aus dem Systemspeicher entladen werden und Heaps erstellt und zerstört werden.</span><span class="sxs-lookup"><span data-stu-id="fca78-108">The lists in system memory change when processes are started and ended, threads are created and destroyed, executable modules are loaded and unloaded from system memory, and heaps are created and destroyed.</span></span> <span data-ttu-id="fca78-109">Die Verwendung von Informationen aus einer Momentaufnahme verhindert Inkonsistenzen.</span><span class="sxs-lookup"><span data-stu-id="fca78-109">The use of information from a snapshot prevents inconsistencies.</span></span> <span data-ttu-id="fca78-110">Andernfalls können Änderungen an einer Liste möglicherweise bewirken, dass ein Thread die Liste fälschlicherweise durchläuft oder eine Zugriffsverletzung verursacht (ein GP-Fehler).</span><span class="sxs-lookup"><span data-stu-id="fca78-110">Otherwise, changes to a list could possibly cause a thread to incorrectly traverse the list or cause an access violation (a GP fault).</span></span> <span data-ttu-id="fca78-111">Wenn eine Anwendung z. b. die Thread Liste durchläuft, während andere Threads erstellt oder beendet werden, kann es vorkommen, dass die von der Anwendung zum Durchlaufen der Thread Liste verwendeten Informationen veraltet sind und einen Fehler für die Anwendung verursachen können, die die Liste durchläuft.</span><span class="sxs-lookup"><span data-stu-id="fca78-111">For example, if an application traverses the thread list while other threads are created or terminated, information that the application is using to traverse the thread list might become outdated and could cause an error for the application traversing the list.</span></span>

<span data-ttu-id="fca78-112">Verwenden Sie die [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) -Funktion, um eine Momentaufnahme des System Speichers zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="fca78-112">To take a snapshot of the system memory, use the [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) function.</span></span> <span data-ttu-id="fca78-113">Wenn Sie diese Funktion aufrufen, können Sie den Inhalt einer Momentaufnahme steuern, indem Sie einen oder mehrere der folgenden Werte angeben:</span><span class="sxs-lookup"><span data-stu-id="fca78-113">You can control the content of a snapshot by specifying one or more of the following values when calling this function:</span></span>

-   <span data-ttu-id="fca78-114">**TH32CS \_ snapheaplist**</span><span class="sxs-lookup"><span data-stu-id="fca78-114">**TH32CS\_SNAPHEAPLIST**</span></span>
-   <span data-ttu-id="fca78-115">**TH32CS \_ snapmodule**</span><span class="sxs-lookup"><span data-stu-id="fca78-115">**TH32CS\_SNAPMODULE**</span></span>
-   <span data-ttu-id="fca78-116">**TH32CS \_ snapprocess**</span><span class="sxs-lookup"><span data-stu-id="fca78-116">**TH32CS\_SNAPPROCESS**</span></span>
-   <span data-ttu-id="fca78-117">**TH32CS \_ snapthreadthread**</span><span class="sxs-lookup"><span data-stu-id="fca78-117">**TH32CS\_SNAPTHREAD**</span></span>

<span data-ttu-id="fca78-118">Die **TH32CS \_ snapheaplist** -und **TH32CS \_ snapmodule** -Werte sind Prozess spezifisch.</span><span class="sxs-lookup"><span data-stu-id="fca78-118">The **TH32CS\_SNAPHEAPLIST** and **TH32CS\_SNAPMODULE** values are process specific.</span></span> <span data-ttu-id="fca78-119">Wenn diese Werte angegeben werden, sind die Heap-und Modul Listen des angegebenen Prozesses in der Momentaufnahme enthalten.</span><span class="sxs-lookup"><span data-stu-id="fca78-119">When these values are specified, the heap and module lists of the specified process are included in the snapshot.</span></span> <span data-ttu-id="fca78-120">Wenn Sie NULL als Prozess-ID angeben, wird der aktuelle Prozess verwendet.</span><span class="sxs-lookup"><span data-stu-id="fca78-120">If you specify zero as the process identifier, the current process is used.</span></span> <span data-ttu-id="fca78-121">Der **TH32CS \_ snapthread** -Wert erstellt immer eine systemweite Momentaufnahme, auch wenn eine Prozess-ID an [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot)weitergegeben wird.</span><span class="sxs-lookup"><span data-stu-id="fca78-121">The **TH32CS\_SNAPTHREAD** value always creates a system-wide snapshot even if a process identifier is passed to [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot).</span></span>

<span data-ttu-id="fca78-122">Um den Heap-oder Modul Zustand für alle Prozesse aufzulisten, geben Sie den **TH32CS \_ snapall** -Wert und den Prozess Bezeichner des aktuellen Prozesses an.</span><span class="sxs-lookup"><span data-stu-id="fca78-122">To enumerate the heap or module state for all processes, specify the **TH32CS\_SNAPALL** value and the process identifier of the current process.</span></span> <span data-ttu-id="fca78-123">Anschließend wird für jeden zusätzlichen Prozess in der Momentaufnahme [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) erneut aufgerufen. dabei werden die Prozess-ID und der **TH32CS \_ snapheaplist** -oder **TH32CS \_ snapmodule** -Wert angegeben.</span><span class="sxs-lookup"><span data-stu-id="fca78-123">Then, for each additional process in the snapshot, call [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) again, specifying its process identifier and the **TH32CS\_SNAPHEAPLIST** or **TH32CS\_SNAPMODULE** value.</span></span>

<span data-ttu-id="fca78-124">Mit der [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) -Funktion können Sie einen erweiterten Fehlerstatus Code für [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) abrufen.</span><span class="sxs-lookup"><span data-stu-id="fca78-124">You can retrieve an extended error status code for [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) by using the [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function.</span></span>

<span data-ttu-id="fca78-125">Wenn der Prozess mit einer Momentaufnahme abgeschlossen ist, zerstören Sie ihn mithilfe der [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) -Funktion.</span><span class="sxs-lookup"><span data-stu-id="fca78-125">When your process finishes using a snapshot, destroy it using the [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) function.</span></span> <span data-ttu-id="fca78-126">Wenn Sie eine Momentaufnahme nicht zerstören, wird der Arbeitsspeicher vom Prozess bis zum Ende des Vorgangs nicht mehr zurückgegeben. zu diesem Zeitpunkt gibt das System den Speicher frei.</span><span class="sxs-lookup"><span data-stu-id="fca78-126">If you do not destroy a snapshot, the process will leak memory until the it exits, at which time the system reclaims the memory.</span></span>

> [!Note]  
> <span data-ttu-id="fca78-127">Das Momentaufnahme handle verhält sich wie ein Datei Handle und unterliegt den gleichen Regeln bezüglich der Prozesse und Threads, in denen es verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="fca78-127">The snapshot handle acts like a file handle and is subject to the same rules regarding the processes and threads in which it can be used.</span></span> <span data-ttu-id="fca78-128">Um anzugeben, dass das Handle vererbbar ist, erstellen Sie die Momentaufnahme mithilfe des **TH32CS \_ erben** -Werts.</span><span class="sxs-lookup"><span data-stu-id="fca78-128">To specify that the handle is inheritable, create the snapshot using the **TH32CS\_INHERIT** value.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="fca78-129">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="fca78-129">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="fca78-130">Erstellen von Momentaufnahmen und Anzeigen von Prozessen</span><span class="sxs-lookup"><span data-stu-id="fca78-130">Taking a Snapshot and Viewing Processes</span></span>](taking-a-snapshot-and-viewing-processes.md)
</dt> </dl>

 

 