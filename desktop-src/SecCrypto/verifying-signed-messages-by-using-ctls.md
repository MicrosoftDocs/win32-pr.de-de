---
description: Einer der Vorteile der Verwendung von Zertifikat Vertrauens Listen (Certificate Trust Lists, CTLs) besteht darin, dass Anwendungen entworfen werden können, die signierte Nachrichten anhand vertrauenswürdiger Zertifikate automatisch verifizieren können, ohne den Benutzer mit Dialogfeldern zu stören.
ms.assetid: e45ea3ae-52bc-49d3-8144-f3becc254f53
title: Überprüfen von signierten Nachrichten mithilfe von CTLs
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a660bcd7e17a168b25048e61684aabc2d3ef3124
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "106373069"
---
# <a name="verifying-signed-messages-by-using-ctls"></a><span data-ttu-id="4ad36-103">Überprüfen von signierten Nachrichten mithilfe von CTLs</span><span class="sxs-lookup"><span data-stu-id="4ad36-103">Verifying Signed Messages by Using CTLs</span></span>

<span data-ttu-id="4ad36-104">Einer der Vorteile der Verwendung von [*Zertifikat Vertrauens Listen (Certificate Trust Lists*](../secgloss/c-gly.md) , CTLs) besteht darin, dass Anwendungen entworfen werden können, die signierte Nachrichten anhand vertrauenswürdiger Zertifikate automatisch verifizieren können, ohne den Benutzer mit Dialogfeldern zu stören.</span><span class="sxs-lookup"><span data-stu-id="4ad36-104">One of the advantages of using [*certificate trust lists*](../secgloss/c-gly.md) (CTLs) is that applications can be designed that can automatically verify signed messages against trusted certificates without bothering the user with dialog boxes.</span></span> <span data-ttu-id="4ad36-105">Außerdem werden einem Netzwerkadministrator Steuerungs Quellen als vertrauenswürdig eingestuft.</span><span class="sxs-lookup"><span data-stu-id="4ad36-105">It also gives a network administrator control sources to be trusted.</span></span>

<span data-ttu-id="4ad36-106">Das folgende Verfahren kann verwendet werden, um die Signatur einer signierten Nachricht mithilfe einer CTL zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="4ad36-106">The following procedure can be used to verify the signature of a signed message by using a CTL.</span></span>

<span data-ttu-id="4ad36-107">**So überprüfen Sie eine signierte Nachricht mithilfe einer CTL**</span><span class="sxs-lookup"><span data-stu-id="4ad36-107">**To verify a signed message by using a CTL**</span></span>

1.  <span data-ttu-id="4ad36-108">Decodieren Sie die Nachricht wie folgt:</span><span class="sxs-lookup"><span data-stu-id="4ad36-108">Decode the message as follows:</span></span>

    1.  <span data-ttu-id="4ad36-109">Einen Zeiger auf die empfangene Meldung (das codierte [*BLOB*](../secgloss/b-gly.md)) erhalten.</span><span class="sxs-lookup"><span data-stu-id="4ad36-109">Get a pointer to the received message (the encoded [*BLOB*](../secgloss/b-gly.md)).</span></span>
    2.  <span data-ttu-id="4ad36-110">Nennen Sie [**cryptmsgopentodecode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentodecode), und übergeben Sie die erforderlichen Argumente.</span><span class="sxs-lookup"><span data-stu-id="4ad36-110">Call [**CryptMsgOpenToDecode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentodecode), passing the necessary arguments.</span></span>
    3.  <span data-ttu-id="4ad36-111">Nennen Sie [**cryptmsgupdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) einmal, und übergeben Sie dabei das in Schritt b abgerufene Handle und einen Zeiger auf die Daten, die decodiert werden sollen.</span><span class="sxs-lookup"><span data-stu-id="4ad36-111">Call [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) once, passing in the handle retrieved in step b and a pointer to the data that is to be decoded.</span></span> <span data-ttu-id="4ad36-112">Dies bewirkt, dass die entsprechenden Aktionen für die Nachricht durchgeführt werden, abhängig vom Nachrichtentyp.</span><span class="sxs-lookup"><span data-stu-id="4ad36-112">This causes the appropriate actions to be taken on the message, depending on the message type.</span></span>

2.  <span data-ttu-id="4ad36-113">Überprüfen Sie die Signatur der decodierten, signierten Nachricht, und erhalten Sie einen Zeiger auf den [**CERT- \_ Kontext**](/windows/desktop/api/Wincrypt/ns-wincrypt-cert_context)des Signatur Gebers.</span><span class="sxs-lookup"><span data-stu-id="4ad36-113">Verify the signature of the decoded, signed message, and get a pointer to the signer's [**CERT\_CONTEXT**](/windows/desktop/api/Wincrypt/ns-wincrypt-cert_context).</span></span>

    <span data-ttu-id="4ad36-114">Dies kann durch Aufrufen von [**cryptmsggetandverifysigner**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetandverifysigner)erfolgen, indem das in Schritt 1C abgerufene Nachrichten Handle als *hcryptmsg* -Parameter übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="4ad36-114">This can be done by calling [**CryptMsgGetAndVerifySigner**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetandverifysigner), passing the message handle retrieved in step 1c as the *hCryptMsg* parameter.</span></span> <span data-ttu-id="4ad36-115">Wenn der Funktions Aufrufwert **true** zurückgibt, wurde die Signatur überprüft, und ein Zeiger auf den [**pccert- \_ Kontext**](/windows/desktop/api/Wincrypt/ns-wincrypt-cert_context) des Signatur Gebers wird im *ppsigner* -Parameter zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="4ad36-115">If the function call returns **TRUE**, the signature was verified, and a pointer to the signer's [**PCCERT\_CONTEXT**](/windows/desktop/api/Wincrypt/ns-wincrypt-cert_context) is returned in the *ppSigner* parameter.</span></span>

3.  <span data-ttu-id="4ad36-116">Vergewissern Sie sich, dass der Signatur Geber wie folgt eine vertrauenswürdige Quelle ist:</span><span class="sxs-lookup"><span data-stu-id="4ad36-116">Confirm that the signer is a trusted source as follows:</span></span>

    1.  <span data-ttu-id="4ad36-117">Öffnen Sie den Zertifikat Speicher, der die entsprechende CTL enthält.</span><span class="sxs-lookup"><span data-stu-id="4ad36-117">Open the certificate store containing the appropriate CTL.</span></span>
    2.  <span data-ttu-id="4ad36-118">Abrufen eines Zeigers auf den [**CTL- \_ Kontext**](/windows/desktop/api/Wincrypt/ns-wincrypt-ctl_context) durch Aufrufen von " [**certfindctlinstore**](/windows/desktop/api/Wincrypt/nf-wincrypt-certfindctlinstore)".</span><span class="sxs-lookup"><span data-stu-id="4ad36-118">Get a pointer to the [**CTL\_CONTEXT**](/windows/desktop/api/Wincrypt/ns-wincrypt-ctl_context) by calling [**CertFindCTLInStore**](/windows/desktop/api/Wincrypt/nf-wincrypt-certfindctlinstore).</span></span>
    3.  <span data-ttu-id="4ad36-119">Um zu bestätigen, dass der Signatur Geber eine vertrauenswürdige Quelle ist, müssen Sie [**certfindsubjetinctl**](/windows/desktop/api/Wincrypt/nf-wincrypt-certfindsubjectinctl)aufrufen und dabei den im vorherigen Schritt abgerufenen Zeiger im *pctlcontext* -Parameter, CTL \_ CERT \_ Subject \_ Type im Parameter *dwsubjettype* und den Zeiger auf den in Schritt 2 im Parameter *pvsubject* abgerufenen [**Zertifikat \_ Kontext**](/windows/desktop/api/Wincrypt/ns-wincrypt-cert_context) übergeben.</span><span class="sxs-lookup"><span data-stu-id="4ad36-119">To confirm that the signer is a trusted source, call [**CertFindSubjectInCTL**](/windows/desktop/api/Wincrypt/nf-wincrypt-certfindsubjectinctl), passing the pointer retrieved in the previous step in the *pCtlContext* parameter, CTL\_CERT\_SUBJECT\_TYPE in the *dwSubjectType* parameter, and the pointer to the [**CERT\_CONTEXT**](/windows/desktop/api/Wincrypt/ns-wincrypt-cert_context) retrieved in step 2 in the *pvSubject* parameter.</span></span> <span data-ttu-id="4ad36-120">Wenn der Funktions Rückruf **true** zurückgibt, ist der an die Funktion über gegebene **CERT- \_ Kontext** eine vertrauenswürdige Quelle in der CTL.</span><span class="sxs-lookup"><span data-stu-id="4ad36-120">If the function call returns **TRUE**, the **CERT\_CONTEXT** passed to the function is a trusted source in the CTL.</span></span>

 

 
