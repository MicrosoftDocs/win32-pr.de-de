---
description: Stellt die Prozedur zum Codieren einer signierten Nachricht dar.
ms.assetid: 40d1c417-6d88-4421-920f-8b40d88d28ce
title: Codieren signierter Daten
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: be4a542fe0890a6ee9d51ebc1a5ee6b98bab4242
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "104217433"
---
# <a name="encoding-signed-data"></a><span data-ttu-id="5fc0a-103">Codieren signierter Daten</span><span class="sxs-lookup"><span data-stu-id="5fc0a-103">Encoding Signed Data</span></span>

<span data-ttu-id="5fc0a-104">[*Signierte Daten*](../secgloss/s-gly.md) bestehen aus dem Inhalt eines beliebigen Typs und verschlüsselten [*Nachrichtenhashes*](../secgloss/h-gly.md) des Inhalts durch Null oder mehr Signatur Geber.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-104">[*Signed data*](../secgloss/s-gly.md) consists of content of any type and encrypted message [*hashes*](../secgloss/h-gly.md) of the content by zero or more signers.</span></span> <span data-ttu-id="5fc0a-105">Mit dem resultierenden Hash kann bestätigt werden, dass die ursprüngliche Nachricht seit der Signierung nicht geändert wurde und dass die Daten von den jeweiligen Personen oder Entitäten signiert wurden.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-105">The resulting hash can confirm that the original message has not been modified since signing and that particular persons or entities signed the data.</span></span>

<span data-ttu-id="5fc0a-106">In der folgenden Abbildung wird die Vorgehensweise zum Codieren einer signierten Nachricht veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-106">The following illustration depicts the procedure for encoding a signed message.</span></span> <span data-ttu-id="5fc0a-107">In der Liste, die der Abbildung folgt, werden die Schritte beschrieben.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-107">The list following the illustration describes the steps.</span></span>

<span data-ttu-id="5fc0a-108">Eine Nachricht kann mehrere Signatur Geber, Hash Algorithmen und Zertifikate enthalten.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-108">A message may have multiple signers, hashing algorithms, and certificates.</span></span> <span data-ttu-id="5fc0a-109">Während in der Abbildung nur Zertifikate, [*CRLs*](../secgloss/c-gly.md)und [*CTLs*](../secgloss/c-gly.md) angezeigt werden, kann der gleiche Prozess verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-109">While the illustration shows only certificates, [*CRLs*](../secgloss/c-gly.md), and [*CTLs*](../secgloss/c-gly.md) can use the same process.</span></span> <span data-ttu-id="5fc0a-110">Diese werden in die Abbildung eingefügt, wo Zertifikate angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-110">They would fit into the illustration wherever certificates are shown.</span></span>

![Codieren einer signierten Nachricht](images/signmsg2.png)

<span data-ttu-id="5fc0a-112">Der allgemeine Prozess zum Codieren [*signierter Daten*](../secgloss/s-gly.md) ist wie folgt.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-112">The general process for encoding [*Signed data*](../secgloss/s-gly.md) is as follows.</span></span>

<span data-ttu-id="5fc0a-113">**So codieren Sie signierte Daten**</span><span class="sxs-lookup"><span data-stu-id="5fc0a-113">**To encode signed data**</span></span>

1.  <span data-ttu-id="5fc0a-114">Die Daten werden (falls erforderlich) erstellt, und es wird ein Zeiger darauf abgerufen.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-114">The data is created (if necessary), and a pointer to it is retrieved.</span></span>
2.  <span data-ttu-id="5fc0a-115">Es wird ein [*Zertifikat Speicher*](../secgloss/c-gly.md) geöffnet, der das Zertifikat des Signatur Gebers enthält.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-115">A [*certificate store*](../secgloss/c-gly.md) is opened that contains the signer's certificate.</span></span>
3.  <span data-ttu-id="5fc0a-116">Der private Schlüssel für das Zertifikat wird abgerufen.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-116">The private key for the certificate is retrieved.</span></span> <span data-ttu-id="5fc0a-117">Es gibt zwei Eigenschaften, die für das Zertifikat festgelegt werden müssen, bevor es verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-117">There are two properties that must be set on the certificate before using it.</span></span> <span data-ttu-id="5fc0a-118">Eine wird verwendet, um ein Zertifikat mit einem bestimmten CSP und innerhalb dieses CSP an einen bestimmten privaten [*Schlüssel Container*](../secgloss/k-gly.md)zu binden.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-118">One is used to tie a certificate to a particular CSP and, within that CSP, to a particular private [*key container*](../secgloss/k-gly.md).</span></span> <span data-ttu-id="5fc0a-119">Der andere Wert wird verwendet, um anzugeben, welcher Hash Algorithmus verwendet werden soll, wenn ein [*Hash*](../secgloss/h-gly.md) Vorgang aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-119">The other is used to indicate which hashing algorithm is to be used when a [*hash*](../secgloss/h-gly.md) operation is called.</span></span> <span data-ttu-id="5fc0a-120">Diese müssen nur einmal festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-120">These need only be set once.</span></span>
4.  <span data-ttu-id="5fc0a-121">Die-Eigenschaft eines Zertifikats bestimmt den Hash Algorithmus.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-121">A certificate's property determines the hash algorithm.</span></span>
5.  <span data-ttu-id="5fc0a-122">Ein Hash der Daten wird erstellt, indem die Daten über die Hash Funktion gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-122">A hash of the data is created by sending the data through the hashing function.</span></span>
6.  <span data-ttu-id="5fc0a-123">Die Signatur wird erstellt, indem der Hash mithilfe des privaten Schlüssels verschlüsselt wird, der über eine Eigenschaft im Zertifikat abgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-123">The signature is created by encrypting the hash using the private key, obtained through a property on the certificate.</span></span>
7.  <span data-ttu-id="5fc0a-124">Die fertige, signierte Nachricht enthält die folgenden Daten:</span><span class="sxs-lookup"><span data-stu-id="5fc0a-124">The following data is included in the finished, signed message:</span></span>
    -   <span data-ttu-id="5fc0a-125">Die zu Signier enden ursprünglichen Daten</span><span class="sxs-lookup"><span data-stu-id="5fc0a-125">The original data to be signed</span></span>
    -   <span data-ttu-id="5fc0a-126">Die Hash Algorithmen</span><span class="sxs-lookup"><span data-stu-id="5fc0a-126">The hash algorithms</span></span>
    -   <span data-ttu-id="5fc0a-127">Die Signaturen</span><span class="sxs-lookup"><span data-stu-id="5fc0a-127">The signatures</span></span>
    -   <span data-ttu-id="5fc0a-128">Die Signatur Geber Info-Strukturen, die den Signatur Geber Bezeichner (Zertifikat Aussteller und Seriennummer) enthalten.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-128">The signer info structures, which includes the signer identifier (certificate issuer and serial number)</span></span>
    -   <span data-ttu-id="5fc0a-129">Die Zertifikate des Signatur Gebers (optional)</span><span class="sxs-lookup"><span data-stu-id="5fc0a-129">The signer's certificates (optional)</span></span>

<span data-ttu-id="5fc0a-130">Diese Prozedur veranschaulicht einen einfachen Fall.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-130">This procedure illustrates a simple case.</span></span> <span data-ttu-id="5fc0a-131">Komplexere Fälle umfassen authentifizierte Attribute, die in der Nachricht enthalten sind.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-131">More complex cases involve authenticated attributes included in the message.</span></span> <span data-ttu-id="5fc0a-132">Wenn der Inhaltstyp etwas anderes als eine **Byte** Zeichenfolge ist oder mindestens ein authentifiziertes Attribut zusammen mit einem beliebigen Datentyp vorhanden ist, sind zwei authentifizierte Standard Attribute erforderlich: der Inhalt (Daten) und der Hash des Inhalts.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-132">When the content type is anything but a **BYTE** string, or there is at least one authenticated attribute along with any data type, there are two standard authenticated attributes required: the content (data) type, and the hash of the content.</span></span> <span data-ttu-id="5fc0a-133">Unter diesen Umständen stellt die [*CryptoAPI*](../secgloss/c-gly.md) diese beiden erforderlichen Attribute automatisch bereit.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-133">Under these circumstances, the [*CryptoAPI*](../secgloss/c-gly.md) automatically provides these two required attributes.</span></span> <span data-ttu-id="5fc0a-134">Die Nachrichten Funktionen auf niedriger Ebene hashten die authentifizierten Attribute, verschlüsseln den Hash mit dem privaten Schlüssel und stellen diesen als Signatur bereit.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-134">The low-level message functions hash the authenticated attributes, encrypt the hash with the private key, and provide this as the signature.</span></span>

<span data-ttu-id="5fc0a-135">Verwenden Sie die Meldungs Funktionen auf niedriger Ebene, um die gerade aufgelisteten Aufgaben durchzuführen. gehen Sie hierzu wie folgt vor.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-135">Use the low-level message functions to accomplish the tasks just listed, by using the following procedure.</span></span>

<span data-ttu-id="5fc0a-136">**So codieren Sie eine signierte Nachricht**</span><span class="sxs-lookup"><span data-stu-id="5fc0a-136">**To encode a signed message**</span></span>

1.  <span data-ttu-id="5fc0a-137">Erstellen oder Abrufen des Inhalts.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-137">Create or retrieve the content.</span></span>
2.  <span data-ttu-id="5fc0a-138">Verschaffen Sie sich einen Kryptografieanbieter.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-138">Get a cryptographic provider.</span></span>
3.  <span data-ttu-id="5fc0a-139">Holen Sie sich die Signatur Geber Zertifikate.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-139">Get the signer certificates.</span></span>
4.  <span data-ttu-id="5fc0a-140">Initialisieren Sie die [**CMSG-Signatur Geber- \_ \_ \_ Informations**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_signer_encode_info) Struktur.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-140">Initialize the [**CMSG\_SIGNER\_ENCODE\_INFO**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_signer_encode_info) structure.</span></span>
5.  <span data-ttu-id="5fc0a-141">Initialisieren Sie die [**CMSG- \_ signierte \_ \_ Informations**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_signed_encode_info) Struktur mit Vorzeichen.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-141">Initialize the [**CMSG\_SIGNED\_ENCODE\_INFO**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_signed_encode_info) structure.</span></span>
6.  <span data-ttu-id="5fc0a-142">Sie können [**cryptmsgcalculateencodedlength**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcalculateencodedlength) aufrufen, um die Größe des codierten nachrichtenblobs zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-142">Call [**CryptMsgCalculateEncodedLength**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcalculateencodedlength) to get the size of the encoded message BLOB.</span></span> <span data-ttu-id="5fc0a-143">Arbeitsspeicher zuweisen.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-143">Allocate memory for it.</span></span>
7.  <span data-ttu-id="5fc0a-144">Nennen Sie [**cryptmsgopentoencode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentoencode), und übergeben Sie \_ für " *dwmsgtype* " signierte CMSG und einen Zeiger auf [**CMSG- \_ signierte \_ codierinformationen \_**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_signed_encode_info) für " *pvmsgencodeinfo* ", um ein Handle für die geöffnete Nachricht zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-144">Call [**CryptMsgOpenToEncode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentoencode), passing in CMSG\_SIGNED for *dwMsgType* and a pointer to [**CMSG\_SIGNED\_ENCODE\_INFO**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_signed_encode_info) for *pvMsgEncodeInfo* to get a handle to the opened message.</span></span>
8.  <span data-ttu-id="5fc0a-145">Nennen Sie [**cryptmsgupdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate), und übergeben Sie das in Schritt 7 abgerufene Handle und einen Zeiger auf die Daten, die signiert und codiert werden sollen.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-145">Call [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate), passing in the handle retrieved in step 7, and a pointer to the data that is to be signed and encoded.</span></span> <span data-ttu-id="5fc0a-146">Diese Funktion kann so oft wie nötig aufgerufen werden, um den Codierungsprozess abzuschließen.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-146">This function can be called as many times as necessary to complete the encoding process.</span></span>
9.  <span data-ttu-id="5fc0a-147">Aufrufen von [**cryptmsggetparam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), übergeben des in Schritt 7 abgerufenen Handles und der entsprechenden Parametertypen für den Zugriff auf die gewünschten, codierten Daten.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-147">Call [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), passing in the handle retrieved in step 7 and the appropriate parameter types to access the desired, encoded data.</span></span> <span data-ttu-id="5fc0a-148">Übergeben Sie z. b. CMSG \_ Content \_ param, um einen Zeiger auf die gesamte [*PKCS \# 7*](../secgloss/p-gly.md) -Nachricht zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-148">For example, pass in CMSG\_CONTENT\_PARAM to get a pointer to the entire [*PKCS \#7*](../secgloss/p-gly.md) message.</span></span>

    <span data-ttu-id="5fc0a-149">Wenn das Ergebnis dieser Codierung als [*innere Daten*](../secgloss/i-gly.md) für eine andere codierte Nachricht verwendet werden soll, z. b. eine eingeschlossene Nachricht, muss der CMSG-Parameter für den \_ Bare-Content- \_ \_ Parameter übergeben werden.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-149">If the result of this encoding is to be used as the [*inner data*](../secgloss/i-gly.md) for another encoded message, such as an enveloped message, the CMSG\_BARE\_CONTENT\_PARAM parameter must be passed.</span></span> <span data-ttu-id="5fc0a-150">Ein Beispiel, das dies veranschaulicht, finden Sie unter [alternativer Code zum Codieren einer](alternate-code-for-encoding-an-enveloped-message.md)eingeschlossenen Nachricht.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-150">For an example showing this, see [Alternate Code for Encoding an Enveloped Message](alternate-code-for-encoding-an-enveloped-message.md).</span></span>

10. <span data-ttu-id="5fc0a-151">Schließen Sie die Nachricht, indem Sie [**cryptmsgclose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose)aufrufen.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-151">Close the message by calling [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose).</span></span>

<span data-ttu-id="5fc0a-152">Das Ergebnis dieser Prozedur ist eine codierte Nachricht, die die ursprünglichen Daten, den verschlüsselten Hash der Daten (Signatur) und die Signatur Geber Informationen enthält.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-152">The result of this procedure is an encoded message that contains the original data, the encrypted hash of that data (signature), and the signer information.</span></span> <span data-ttu-id="5fc0a-153">Es ist auch ein Zeiger auf das gewünschte, codierte BLOB vorhanden.</span><span class="sxs-lookup"><span data-stu-id="5fc0a-153">There is also a pointer to the desired, encoded BLOB.</span></span>

<span data-ttu-id="5fc0a-154">Weitere Informationen zur C-Codierung finden Sie [unter Beispiel c-Programm: Signieren, codieren, decodieren und Überprüfen einer Nachricht](example-c-program-signing-encoding-decoding-and-verifying-a-message.md).</span><span class="sxs-lookup"><span data-stu-id="5fc0a-154">For C coding details, see [Example C Program: Signing, Encoding, Decoding, and Verifying a Message](example-c-program-signing-encoding-decoding-and-verifying-a-message.md).</span></span>

 

 
