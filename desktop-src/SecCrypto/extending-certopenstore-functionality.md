---
description: Der Zertifikat Speicher ist für alle Zertifikat Verwaltungsvorgänge von zentraler Bedeutung.
ms.assetid: e5c7c882-cbfc-4343-952c-b13c67326756
title: Erweitern der certopsstore-Funktionalität
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4cce198578cc482ba0488bd97ae0f1d7f923511b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "104564224"
---
# <a name="extending-certopenstore-functionality"></a><span data-ttu-id="0f088-103">Erweitern der certopsstore-Funktionalität</span><span class="sxs-lookup"><span data-stu-id="0f088-103">Extending CertOpenStore Functionality</span></span>

<span data-ttu-id="0f088-104">Der [*Zertifikat Speicher*](../secgloss/c-gly.md) ist für alle Zertifikat Verwaltungsvorgänge von zentraler Bedeutung.</span><span class="sxs-lookup"><span data-stu-id="0f088-104">The [*certificate store*](../secgloss/c-gly.md) is central to all certificate management operations.</span></span> <span data-ttu-id="0f088-105">Die Funktionalität der [**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) -Funktion kann durch die Verwendung einer installierbaren (oder registrierten) Zertifikat Speicher Anbieter-Funktion erweitert werden.</span><span class="sxs-lookup"><span data-stu-id="0f088-105">The functionality of the [**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) function can be extended through the use of an installable (or registered) certificate-store-provider function.</span></span> <span data-ttu-id="0f088-106">Eine Übersicht über das Installieren oder Registrieren von Funktionen für die Verwendung mit der CryptoAPI finden Sie unter [OID Overview](oid-overview.md).</span><span class="sxs-lookup"><span data-stu-id="0f088-106">For an overview of how to install or register functions for use with the CryptoAPI, see [OID Overview](oid-overview.md).</span></span>

> [!Note]  
> <span data-ttu-id="0f088-107">Benutzerdefinierte Zertifikat Speicher werden beim Ausführen automatisierter bereit Stellungen nicht automatisch migriert.</span><span class="sxs-lookup"><span data-stu-id="0f088-107">Custom certificate stores are not automatically migrated when performing automated deployments.</span></span> <span data-ttu-id="0f088-108">Wenn Sie benutzerdefinierte Zertifikat Speicher migrieren möchten, müssen Sie ein Manifest erstellen, um die benutzerdefinierten Speicher zu migrieren und die Windows-Migrationstool für den Benutzerstatus (Anwendungs-) zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="0f088-108">To migrate custom certificate stores, you must create a manifest for migrating the custom stores and use the Windows User State Migration Tool (USMT).</span></span> <span data-ttu-id="0f088-109">Das Windows-Tool steht im Microsoft Download Center unter zum Download zur Verfügung <https://www.microsoft.com/download/details.aspx?id=10837> .</span><span class="sxs-lookup"><span data-stu-id="0f088-109">The USMT is available for download from the Microsoft Download Center at <https://www.microsoft.com/download/details.aspx?id=10837>.</span></span>

 

<span data-ttu-id="0f088-110">[**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) öffnet einen leeren Speicher im Arbeitsspeicher und ruft die Speicher Anbieter Funktion (sofern Sie registriert oder installiert ist) mithilfe des [*Objekt Bezeichners*](../secgloss/o-gly.md) (OID) auf, der im *lpszstoreprovider* -Parameter übergeben wurde.</span><span class="sxs-lookup"><span data-stu-id="0f088-110">[**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) opens an empty store in memory and calls the store provider function (if it is registered or installed) by using the [*object identifier*](../secgloss/o-gly.md) (OID) that was passed in the *lpszStoreProvider* parameter.</span></span> <span data-ttu-id="0f088-111">Eine Liste der vordefinierten Anbieter Typen, die mit der CryptoAPI bereitgestellt werden, finden Sie unter **CertOpenStore**.</span><span class="sxs-lookup"><span data-stu-id="0f088-111">For a list of the predefined provider types that are supplied with the CryptoAPI, see **CertOpenStore**.</span></span>

<span data-ttu-id="0f088-112">Die Speicher Anbieter Funktion kopiert die Zertifikate und [*Zertifikat Sperr Listen*](../secgloss/c-gly.md) (CRLs) in den Speicher internen Speicher, der durch das an Sie übergebenen *HCERTSTORE* -handle angegeben wird.</span><span class="sxs-lookup"><span data-stu-id="0f088-112">The store provider function copies its certificates and [*certificate revocation lists*](../secgloss/c-gly.md) (CRLs) to the in-memory store specified by the *hCertStore* handle passed to it.</span></span> <span data-ttu-id="0f088-113">Die neue Speicher Anbieter Funktion kann jede der kryptoapi-Zertifikat Speicherfunktionen, wie z. b. [**certaddcertificr econtexttostore**](/windows/win32/api/Wincrypt/nf-wincrypt-certaddcertificatecontexttostore) oder [**certaddserializedelta**](/windows/win32/api/Wincrypt/nf-wincrypt-certaddserializedelementtostore)Token, zum Hinzufügen der Zertifikate und CRLs zum Speicher internen Speicher verwenden.</span><span class="sxs-lookup"><span data-stu-id="0f088-113">The new store provider function can use any of the CryptoAPI certificate store functions, such as, [**CertAddCertificateContextToStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certaddcertificatecontexttostore) or [**CertAddSerializedElementToStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certaddserializedelementtostore), to add its certificates and CRLs to the in-memory store.</span></span> <span data-ttu-id="0f088-114">Außerdem gibt die Store-Provider-Funktion optional Werte für alle Datenmember der [**Zertifikat \_ Speicher- \_ Prov- \_ Informations**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) Struktur zurück.</span><span class="sxs-lookup"><span data-stu-id="0f088-114">In addition, the store-provider function optionally returns values for all of the data members of the [**CERT\_STORE\_PROV\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) structure.</span></span> <span data-ttu-id="0f088-115">Die Funktion muss diese Struktur nur aktualisieren, wenn Sie zusätzliche Rückruf Funktionen unterstützt.</span><span class="sxs-lookup"><span data-stu-id="0f088-115">The function only needs to update this structure if it supports additional callback functions.</span></span> <span data-ttu-id="0f088-116">Wenn der Speicher z. b. ein Schreib geschützter Speicher wäre, wäre die Unterstützung anderer Rückruf Funktionen wahrscheinlich nicht erforderlich.</span><span class="sxs-lookup"><span data-stu-id="0f088-116">For example, if the store was to be a read-only store, the support of other callback functions probably would not be needed.</span></span> <span data-ttu-id="0f088-117">Ausführliche Informationen und Prototypen der möglichen Rückruf Funktionen finden Sie unter [Rückruf Funktionen für Zertifikat Speicher Anbieter](cryptography-functions.md).</span><span class="sxs-lookup"><span data-stu-id="0f088-117">For details and prototypes of the possible callback functions, see [Certificate Store Provider Callback Functions](cryptography-functions.md).</span></span>

<span data-ttu-id="0f088-118">Der Speicher pro Benutzer-Treuhänder ist auf vordefinierte physische Speicher beschränkt.</span><span class="sxs-lookup"><span data-stu-id="0f088-118">The per user TrustedPeople store is restricted to predefined physical stores.</span></span> <span data-ttu-id="0f088-119">Sie können den Trust dpeople-Speicher pro Benutzer nicht erweitern.</span><span class="sxs-lookup"><span data-stu-id="0f088-119">You cannot extend the per user TrustedPeople store.</span></span> <span data-ttu-id="0f088-120">Sie können jedoch den Trust dpeople-Speicher des lokalen Computers erweitern.</span><span class="sxs-lookup"><span data-stu-id="0f088-120">However, you can extend the local machine TrustedPeople store.</span></span>

<span data-ttu-id="0f088-121">**Windows XP und Windows Server 2003:** Der Trust-People-Speicher pro Benutzer ist nicht auf vordefinierte physische Speicher beschränkt.</span><span class="sxs-lookup"><span data-stu-id="0f088-121">**Windows XP and Windows Server 2003:** The per user TrustedPeople store is not restricted to predefined physical stores.</span></span>

<span data-ttu-id="0f088-122">Eines der Datenmember der [**CERT \_ Store \_ Prov \_ Info**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) -Struktur ist das *rgpvstoreprovfunc* -Array.</span><span class="sxs-lookup"><span data-stu-id="0f088-122">One of the data members of the [**CERT\_STORE\_PROV\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) structure is the *rgpvStoreProvFunc* array.</span></span> <span data-ttu-id="0f088-123">Wenn die Speicher Anbieter Funktion eine oder mehrere der Rückruf Funktionen unterstützen muss, muss Sie Zeiger für dieses Array bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="0f088-123">If the store provider function needs to support one or more of the callback functions, it must provide pointers for this array.</span></span> <span data-ttu-id="0f088-124">Diese Zeiger müssen auf die Rückruf Funktionen verweisen, die für andere Zertifikat Speicher Aktivitäten verwendet werden sollen (z. b. das Schließen des Stores).</span><span class="sxs-lookup"><span data-stu-id="0f088-124">These pointers must point to the callback functions that are to be used for other certificate-store activities (such as closing the store).</span></span> <span data-ttu-id="0f088-125">Die folgende Abbildung zeigt den Ablauf dieses Prozesses.</span><span class="sxs-lookup"><span data-stu-id="0f088-125">The following illustration shows the flow of this process.</span></span>

![certopendstore-Funktionalität](images/openstor.png)

<span data-ttu-id="0f088-127">Wie in der folgenden Abbildung gezeigt, verwenden andere CryptoAPI-Funktionen (z. [**b. certclosestore**](/windows/win32/api/Wincrypt/nf-wincrypt-certclosestore)), nachdem der Speicher geöffnet wurde, das Array von Zeigern für den Zugriff auf die Rückruf Funktionen, die die beabsichtigte Aufgabe ausführen.</span><span class="sxs-lookup"><span data-stu-id="0f088-127">As shown in the following illustration, after the store has been opened, other CryptoAPI functions (such as [**CertCloseStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certclosestore)) use the array of pointers to access the callback functions that perform the intended task.</span></span> <span data-ttu-id="0f088-128">Die Definition der [**CERT \_ Store \_ Prov- \_ Informations**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) Struktur und die Prototypen der Standard Rückruf Funktionen, die mit der CryptoAPI bereitgestellt werden, werden in den [Rückruf Funktionen des Zertifikat Speicher Anbieters](cryptography-functions.md)angezeigt.</span><span class="sxs-lookup"><span data-stu-id="0f088-128">The definition of the [**CERT\_STORE\_PROV\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) structure and the prototypes of the default callback functions that are supplied with the CryptoAPI are shown in [Certificate Store Provider Callback Functions](cryptography-functions.md).</span></span>

![certclosestore-Funktionalität](images/closstor.png)

<span data-ttu-id="0f088-130">Die Store-APIs ermöglichen es einem Speicher Anbieter, die Zertifikate, CRLs und [*Zertifikat Vertrauens Listen*](../secgloss/c-gly.md) (CTLs) außerhalb des Cache Speichers des Speichers zu verwalten (z. b. eine externe Datenbank von Zertifikaten, z. b. von der Microsoft Certificate Server-Datenbank bereitgestellt).</span><span class="sxs-lookup"><span data-stu-id="0f088-130">The store APIs allow a store provider to maintain the certificates, CRLs, and [*certificate trust lists*](../secgloss/c-gly.md) (CTLs) outside the cache of the store (for example, an external database of certificates, such as provided by the Microsoft Certificate Server Database).</span></span>

<span data-ttu-id="0f088-131">[**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) sendet den *pszstoreprovider* -Parameter an die entsprechende installierbare [**certdllopenstoreprov**](/windows/win32/api/Wincrypt/nc-wincrypt-pfn_cert_dll_open_store_prov_func) -Anbieter Funktion.</span><span class="sxs-lookup"><span data-stu-id="0f088-131">[**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) dispatches through the *pszStoreProvider* parameter to the appropriate [**CertDllOpenStoreProv**](/windows/win32/api/Wincrypt/nc-wincrypt-pfn_cert_dll_open_store_prov_func) installable provider function.</span></span> <span data-ttu-id="0f088-132">Der Anbieter gibt Informationen im *pstoreprovinfo* -Parameter zurück, der auf eine [**Zertifikat \_ Speicher- \_ Prov- \_ Informations**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) Struktur verweist.</span><span class="sxs-lookup"><span data-stu-id="0f088-132">The provider returns information in the *pStoreProvInfo* parameter that points to a [**CERT\_STORE\_PROV\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) structure.</span></span> <span data-ttu-id="0f088-133">Die **CERT \_ Store \_ Prov \_ Info** -Struktur enthält einen **dwstoreprovflags** -Member.</span><span class="sxs-lookup"><span data-stu-id="0f088-133">The **CERT\_STORE\_PROV\_INFO** structure contains a **dwStoreProvFlags** member.</span></span> <span data-ttu-id="0f088-134">Das Flag für das \_ externe Flag "cert store \_ Prov" \_ \_ wurde hinzugefügt, damit der Anbieter angeben kann, dass die Zertifikate, CRLs und CTLs für den Cache des Speichers extern sind.</span><span class="sxs-lookup"><span data-stu-id="0f088-134">The CERT\_STORE\_PROV\_EXTERNAL\_FLAG flag was added to allow the provider to indicate that the certificates, CRLs, and CTLs are external to the cache of the store.</span></span>

<span data-ttu-id="0f088-135">[**Certdllopenstoreprov**](/windows/win32/api/Wincrypt/nc-wincrypt-pfn_cert_dll_open_store_prov_func) gibt ein Array von Rückruf Funktionen zurück.</span><span class="sxs-lookup"><span data-stu-id="0f088-135">[**CertDllOpenStoreProv**](/windows/win32/api/Wincrypt/nc-wincrypt-pfn_cert_dll_open_store_prov_func) returns an array of callback functions.</span></span> <span data-ttu-id="0f088-136">Ein Anbieter kann die folgenden Rückruf Funktionen implementieren:</span><span class="sxs-lookup"><span data-stu-id="0f088-136">A provider can implement the following callback functions:</span></span>

-   <span data-ttu-id="0f088-137">CERT \_ Store \_ Prov \_ Close \_ Func</span><span class="sxs-lookup"><span data-stu-id="0f088-137">CERT\_STORE\_PROV\_CLOSE\_FUNC</span></span>
-   <span data-ttu-id="0f088-138">CERT \_ Store \_ Prov \_ Read \_ CERT \_ Func</span><span class="sxs-lookup"><span data-stu-id="0f088-138">CERT\_STORE\_PROV\_READ\_CERT\_FUNC</span></span>
-   <span data-ttu-id="0f088-139">CERT \_ Store \_ Prov \_ Write \_ CERT \_ Func</span><span class="sxs-lookup"><span data-stu-id="0f088-139">CERT\_STORE\_PROV\_WRITE\_CERT\_FUNC</span></span>
-   <span data-ttu-id="0f088-140">CERT \_ Store \_ Prov \_ Delete \_ CERT \_ Func</span><span class="sxs-lookup"><span data-stu-id="0f088-140">CERT\_STORE\_PROV\_DELETE\_CERT\_FUNC</span></span>
-   <span data-ttu-id="0f088-141">CERT \_ Store \_ Prov \_ Set \_ CERT- \_ Eigenschaft \_ Func</span><span class="sxs-lookup"><span data-stu-id="0f088-141">CERT\_STORE\_PROV\_SET\_CERT\_PROPERTY\_FUNC</span></span>
-   <span data-ttu-id="0f088-142">CERT \_ Store \_ Prov \_ Read \_ CRL \_ Func</span><span class="sxs-lookup"><span data-stu-id="0f088-142">CERT\_STORE\_PROV\_READ\_CRL\_FUNC</span></span>
-   <span data-ttu-id="0f088-143">CERT \_ Store \_ Prov \_ Write \_ CRL \_ Func</span><span class="sxs-lookup"><span data-stu-id="0f088-143">CERT\_STORE\_PROV\_WRITE\_CRL\_FUNC</span></span>
-   <span data-ttu-id="0f088-144">CERT \_ Store \_ Prov \_ Delete \_ CRL \_ Func</span><span class="sxs-lookup"><span data-stu-id="0f088-144">CERT\_STORE\_PROV\_DELETE\_CRL\_FUNC</span></span>
-   <span data-ttu-id="0f088-145">Zertifikat Sperr Listen-Eigenschaft (CRL) für Zertifikat \_ Speicher \_ Prov \_ festlegen \_ \_ \_</span><span class="sxs-lookup"><span data-stu-id="0f088-145">CERT\_STORE\_PROV\_SET\_CRL\_PROPERTY\_FUNC</span></span>
-   <span data-ttu-id="0f088-146">CERT \_ Store \_ Prov \_ Read \_ CTL \_ Func</span><span class="sxs-lookup"><span data-stu-id="0f088-146">CERT\_STORE\_PROV\_READ\_CTL\_FUNC</span></span>
-   <span data-ttu-id="0f088-147">CERT \_ Store \_ Prov \_ Write \_ CTL \_ Func</span><span class="sxs-lookup"><span data-stu-id="0f088-147">CERT\_STORE\_PROV\_WRITE\_CTL\_FUNC</span></span>
-   <span data-ttu-id="0f088-148">CERT \_ Store \_ Prov \_ Delete \_ CTL \_ Func</span><span class="sxs-lookup"><span data-stu-id="0f088-148">CERT\_STORE\_PROV\_DELETE\_CTL\_FUNC</span></span>
-   <span data-ttu-id="0f088-149">Zertifikat \_ Speicher \_ Prov \_ Set \_ CTL- \_ Eigenschaft \_ Func</span><span class="sxs-lookup"><span data-stu-id="0f088-149">CERT\_STORE\_PROV\_SET\_CTL\_PROPERTY\_FUNC</span></span>

<span data-ttu-id="0f088-150">Bei Aufrufen von "Write \_ CERT", "Write \_ CRL" und "Write \_ CTL Callback"-Funktionen beim Festlegen des "CERT \_ Store \_ Prov \_ Write Add"- \_ \_ Flags enthalten die oberen 16 Bits des *dwFlags* -Parameters den *dwadddisposition* -Wert.</span><span class="sxs-lookup"><span data-stu-id="0f088-150">On calls to the WRITE\_CERT, WRITE\_CRL, and WRITE\_CTL callback functions when the CERT\_STORE\_PROV\_WRITE\_ADD\_FLAG is set, the upper 16 bits of the *dwFlags* parameter contains the *dwAddDisposition* value.</span></span> <span data-ttu-id="0f088-151">Um externe Speicher zu unterstützen, kann ein Anbieter die folgenden Rückruf Funktionen implementieren:</span><span class="sxs-lookup"><span data-stu-id="0f088-151">To support external stores, a provider can implement the following callback functions:</span></span>

-   <span data-ttu-id="0f088-152">CERT \_ Store \_ Prov \_ Find \_ CERT \_ Func</span><span class="sxs-lookup"><span data-stu-id="0f088-152">CERT\_STORE\_PROV\_FIND\_CERT\_FUNC</span></span>
-   <span data-ttu-id="0f088-153">Zertifikat \_ Speicher \_ Prov \_ Free \_ Find \_ CERT \_ Func</span><span class="sxs-lookup"><span data-stu-id="0f088-153">CERT\_STORE\_PROV\_FREE\_FIND\_CERT\_FUNC</span></span>
-   <span data-ttu-id="0f088-154">Zertifikat \_ Speicher \_ Prov \_ get \_ CERT- \_ Eigenschaft \_ Func</span><span class="sxs-lookup"><span data-stu-id="0f088-154">CERT\_STORE\_PROV\_GET\_CERT\_PROPERTY\_FUNC</span></span>
-   <span data-ttu-id="0f088-155">CERT \_ Store \_ Prov \_ Find \_ CRL \_ Func</span><span class="sxs-lookup"><span data-stu-id="0f088-155">CERT\_STORE\_PROV\_FIND\_CRL\_FUNC</span></span>
-   <span data-ttu-id="0f088-156">CERT \_ Store \_ Prov \_ Free \_ Find \_ CRL \_ Func</span><span class="sxs-lookup"><span data-stu-id="0f088-156">CERT\_STORE\_PROV\_FREE\_FIND\_CRL\_FUNC</span></span>
-   <span data-ttu-id="0f088-157">Zertifikat \_ Speicher \_ Prov \_ get \_ CRL- \_ Eigenschaft \_ Func</span><span class="sxs-lookup"><span data-stu-id="0f088-157">CERT\_STORE\_PROV\_GET\_CRL\_PROPERTY\_FUNC</span></span>
-   <span data-ttu-id="0f088-158">Zertifikat \_ Speicher- \_ Prov \_ Find \_ CTL \_ Func</span><span class="sxs-lookup"><span data-stu-id="0f088-158">CERT\_STORE\_PROV\_FIND\_CTL\_FUNC</span></span>
-   <span data-ttu-id="0f088-159">Zertifikat \_ Speicher \_ Prov \_ Free \_ Find \_ CTL \_ Func</span><span class="sxs-lookup"><span data-stu-id="0f088-159">CERT\_STORE\_PROV\_FREE\_FIND\_CTL\_FUNC</span></span>
-   <span data-ttu-id="0f088-160">Zertifikat \_ Speicher \_ Prov \_ get \_ CTL- \_ Eigenschaft \_ Func</span><span class="sxs-lookup"><span data-stu-id="0f088-160">CERT\_STORE\_PROV\_GET\_CTL\_PROPERTY\_FUNC</span></span>

<span data-ttu-id="0f088-161">Die Zertifikat Rückruf Funktionen verfügen über die folgenden Signaturen:</span><span class="sxs-lookup"><span data-stu-id="0f088-161">The certificate callback functions have the following signatures:</span></span>

``` syntax
typedef struct _CERT_STORE_PROV_FIND_INFO {
    DWORD               cbSize;
    DWORD               dwMsgAndCertEncodingType;
    DWORD               dwFindFlags;
    DWORD               dwFindType;
    const void          *pvFindPara;
} CERT_STORE_PROV_FIND_INFO, *PCERT_STORE_PROV_FIND_INFO;
typedef const CERT_STORE_PROV_FIND_INFO CCERT_STORE_PROV_FIND_INFO,
    *PCCERT_STORE_PROV_FIND_INFO;

typedef BOOL (WINAPI *PFN_CERT_STORE_PROV_FIND_CERT)(
        IN HCERTSTOREPROV hStoreProv,
        IN PCCERT_STORE_PROV_FIND_INFO pFindInfo,
        IN PCCERT_CONTEXT pPrevCertContext,
        IN DWORD dwFlags,
        IN OUT void **ppvStoreProvFindInfo,
        OUT PCCERT_CONTEXT *ppProvCertContext
        );

typedef BOOL (WINAPI *PFN_CERT_STORE_PROV_FREE_FIND_CERT)(
        IN HCERTSTOREPROV hStoreProv,
        IN PCCERT_CONTEXT pCertContext,
        IN void *pvStoreProvFindInfo,
        IN DWORD dwFlags
        );

typedef BOOL (WINAPI *PFN_CERT_STORE_PROV_GET_CERT_PROPERTY)(
        IN HCERTSTOREPROV hStoreProv,
        IN PCCERT_CONTEXT pCertContext,
        IN DWORD dwPropId,
        IN DWORD dwFlags,
        OUT void *pvData,
        IN OUT DWORD *pcbData
        );
```

<span data-ttu-id="0f088-162">Die Signaturen für die CRL-und CTL-Rückruf Funktionen sind identisch mit dem obigen, wobei der Zeiger auf den [**CERT- \_ Kontext**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) durch einen Zeiger auf einen [**CRL- \_ Kontext**](/windows/win32/api/Wincrypt/ns-wincrypt-crl_context) oder einen [**CTL- \_ Kontext**](/windows/win32/api/Wincrypt/ns-wincrypt-ctl_context)ersetzt wurde.</span><span class="sxs-lookup"><span data-stu-id="0f088-162">The signatures for the CRL and CTL callback functions are identical to the above with the pointer to the [**CERT\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) replaced with a pointer to a [**CRL\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-crl_context) or [**CTL\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-ctl_context).</span></span>

<span data-ttu-id="0f088-163">Der Rückruf "Zertifikat suchen" \_ wird aufgerufen, wenn die Store-APIs Zertifikate aufzählen, suchen oder hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="0f088-163">The FIND\_CERT callback is called when the store APIs enumerate, find, or add certificates.</span></span> <span data-ttu-id="0f088-164">*pprevcertcontext* und *ppvstoreprovfindinfo* sind auf **null** festgelegt, um eine neue Suche zu initiieren.</span><span class="sxs-lookup"><span data-stu-id="0f088-164">*pPrevCertContext* and *ppvStoreProvFindInfo* are set to **NULL** to initiate a new FIND.</span></span> <span data-ttu-id="0f088-165">Die zurückgegebene *ppvstoreprovfindinfo* wird bei der nächsten Suche zurückgegeben, ab der Sie vom Anbieter freigegeben werden kann.</span><span class="sxs-lookup"><span data-stu-id="0f088-165">The returned *ppvStoreProvFindInfo* is passed back on the next find at which time it may be freed by the provider.</span></span> <span data-ttu-id="0f088-166">Der Anbieter kann alle, einige oder keine der Zertifikat Eigenschaften festlegen.</span><span class="sxs-lookup"><span data-stu-id="0f088-166">The provider may set all, some, or none of the certificate properties.</span></span> <span data-ttu-id="0f088-167">Der Anbieter kann die Option zum Zurückstellen des Zertifikats aufrufen, bis der get \_ CERT- \_ Eigenschafts Rückruf aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="0f088-167">The provider has the option to defer until the GET\_CERT\_PROPERTY callback is called.</span></span> <span data-ttu-id="0f088-168">Es wird empfohlen, dass Anbieter so viele Eigenschaften wie möglich festlegen, um das Kopieren in einen anderen Speicher zuzulassen.</span><span class="sxs-lookup"><span data-stu-id="0f088-168">It is recommended for providers to set as many properties as possible to allow copying to another store.</span></span>

<span data-ttu-id="0f088-169">Die folgenden Typen von Zertifikat suchen werden in [**certfindcertifikateinstore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindcertificateinstore)unterstützt:</span><span class="sxs-lookup"><span data-stu-id="0f088-169">The following certificate find types are supported in [**CertFindCertificateInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindcertificateinstore):</span></span>

-   <span data-ttu-id="0f088-170">CERT \_ Find \_ Any</span><span class="sxs-lookup"><span data-stu-id="0f088-170">CERT\_FIND\_ANY</span></span>
-   <span data-ttu-id="0f088-171">Zertifikat \_ Suche \_ SHA1- \_ Hash</span><span class="sxs-lookup"><span data-stu-id="0f088-171">CERT\_FIND\_SHA1\_HASH</span></span>
-   <span data-ttu-id="0f088-172">Zertifikat \_ Suche \_ MD5- \_ Hash</span><span class="sxs-lookup"><span data-stu-id="0f088-172">CERT\_FIND\_MD5\_HASH</span></span>
-   <span data-ttu-id="0f088-173">CERT \_ Find- \_ Eigenschaft</span><span class="sxs-lookup"><span data-stu-id="0f088-173">CERT\_FIND\_PROPERTY</span></span>
-   <span data-ttu-id="0f088-174">\_ \_ öffentlicher \_ Schlüssel für Zertifikat Suche</span><span class="sxs-lookup"><span data-stu-id="0f088-174">CERT\_FIND\_PUBLIC\_KEY</span></span>
-   <span data-ttu-id="0f088-175">Zertifikat suchantrags Teller \_ \_ \_ Name</span><span class="sxs-lookup"><span data-stu-id="0f088-175">CERT\_FIND\_SUBJECT\_NAME</span></span>
-   <span data-ttu-id="0f088-176">CERT \_ Find \_ Subject \_ attr</span><span class="sxs-lookup"><span data-stu-id="0f088-176">CERT\_FIND\_SUBJECT\_ATTR</span></span>
-   <span data-ttu-id="0f088-177">Zertifikat \_ \_ \_ Suchname suchen</span><span class="sxs-lookup"><span data-stu-id="0f088-177">CERT\_FIND\_ISSUER\_NAME</span></span>
-   <span data-ttu-id="0f088-178">Zertifikat \_ Suche \_ Aussteller \_ attr</span><span class="sxs-lookup"><span data-stu-id="0f088-178">CERT\_FIND\_ISSUER\_ATTR</span></span>
-   <span data-ttu-id="0f088-179">CERT \_ Find \_ Subject \_ Str \_ A</span><span class="sxs-lookup"><span data-stu-id="0f088-179">CERT\_FIND\_SUBJECT\_STR\_A</span></span>
-   <span data-ttu-id="0f088-180">CERT \_ Find \_ Subject \_ Str \_ W</span><span class="sxs-lookup"><span data-stu-id="0f088-180">CERT\_FIND\_SUBJECT\_STR\_W</span></span>
-   <span data-ttu-id="0f088-181">CERT \_ Find \_ Aussteller \_ Str \_ A</span><span class="sxs-lookup"><span data-stu-id="0f088-181">CERT\_FIND\_ISSUER\_STR\_A</span></span>
-   <span data-ttu-id="0f088-182">Zertifikat \_ Suche \_ Aussteller \_ Str \_ W</span><span class="sxs-lookup"><span data-stu-id="0f088-182">CERT\_FIND\_ISSUER\_STR\_W</span></span>
-   <span data-ttu-id="0f088-183">Zertifikat \_ Suche- \_ Schlüssel \_ Spezifikation</span><span class="sxs-lookup"><span data-stu-id="0f088-183">CERT\_FIND\_KEY\_SPEC</span></span>
-   <span data-ttu-id="0f088-184">CERT \_ Find \_ enhkey- \_ Verwendung</span><span class="sxs-lookup"><span data-stu-id="0f088-184">CERT\_FIND\_ENHKEY\_USAGE</span></span>

<span data-ttu-id="0f088-185">Der Rückruf "Zertifikat suchen" \_ wird für jeden der obigen Suchtypen aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="0f088-185">The FIND\_CERT callback is called for each of the above find types.</span></span> <span data-ttu-id="0f088-186">Die an " [**certfindcertifikateinstore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindcertificateinstore) " übergebenen Parameter werden direkt in die "CERT \_ Store \_ Prov Find Info"-Struktur kopiert, \_ bevor der Befehl " \_ Zertifikat suchen" \_ aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="0f088-186">The parameters passed to [**CertFindCertificateInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindcertificateinstore) are copied directly to the CERT\_STORE\_PROV\_FIND\_INFO structure before the FIND\_CERT callback is called.</span></span> <span data-ttu-id="0f088-187">Ausführliche Informationen zu den Feldwerten für die verschiedenen Suchtypen der CERT \_ Store \_ Prov Find Info-Struktur finden Sie unter \_ \_ **certfindcertifikateinstore**.</span><span class="sxs-lookup"><span data-stu-id="0f088-187">For details about the field values for the different find types of the CERT\_STORE\_PROV\_FIND\_INFO structure, see **CertFindCertificateInStore**.</span></span>

<span data-ttu-id="0f088-188">Die folgenden Typen von Zertifikat suchen unterstützen die Zertifikate [**certgetsubjetcertifipeefromstore**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetsubjectcertificatefromstore) und [**CertGetIssuerCertificateFromStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetissuercertificatefromstore) und helfen, zu bestimmen, ob das Zertifikat bereits im Speicher vorhanden ist, bevor Sie Folgendes hinzufügen:</span><span class="sxs-lookup"><span data-stu-id="0f088-188">The following certificate find types support the [**CertGetSubjectCertificateFromStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetsubjectcertificatefromstore) and [**CertGetIssuerCertificateFromStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetissuercertificatefromstore) APIs and help determine whether the certificate already exists in the store before adding:</span></span>

-   <span data-ttu-id="0f088-189">CERT \_ Find \_ Subject \_ CERT</span><span class="sxs-lookup"><span data-stu-id="0f088-189">CERT\_FIND\_SUBJECT\_CERT</span></span>
-   <span data-ttu-id="0f088-190">Zertifikat \_ Suche \_ Aussteller \_ von</span><span class="sxs-lookup"><span data-stu-id="0f088-190">CERT\_FIND\_ISSUER\_OF</span></span>
-   <span data-ttu-id="0f088-191">Zertifikat \_ Suche \_ vorhanden</span><span class="sxs-lookup"><span data-stu-id="0f088-191">CERT\_FIND\_EXISTING</span></span>

<span data-ttu-id="0f088-192">Für CERT \_ Find \_ Subject \_ CERT zeigt der *pvfindpara* -Parameter auf eine [**CERT \_ Info**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_info) -Struktur, die den Aussteller und die serialNumber des Subjekts enthält.</span><span class="sxs-lookup"><span data-stu-id="0f088-192">For CERT\_FIND\_SUBJECT\_CERT, the *pvFindPara* parameter points to a [**CERT\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_info) structure that contains the Issuer and SerialNumber of the subject.</span></span> <span data-ttu-id="0f088-193">Für \_ den Zertifikat \_ suchaussteller \_ von verweist *pvfindpara* auf eine [**CERT- \_ Kontext**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) Struktur des Subjekts.</span><span class="sxs-lookup"><span data-stu-id="0f088-193">For CERT\_FIND\_ISSUER\_OF, *pvFindPara* points to a [**CERT\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) structure, of the subject.</span></span> <span data-ttu-id="0f088-194">Für \_ \_ ein vorhandenes Zertifikat suchen zeigt *pvfindpara* auf einen Zertifikat **\_ Kontext** des Zertifikats, um zu überprüfen, ob es im Speicher vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="0f088-194">For CERT\_FIND\_EXISTING, *pvFindPara* points to a **CERT\_CONTEXT** of the certificate to check for its existence in the store.</span></span>

<span data-ttu-id="0f088-195">Der kostenlose \_ Find \_ CERT-Rückruf wird aufgerufen, wenn das vom Zertifikat "Find CERT" zurückgegebene Zertifikat \_ nicht freigegeben wurde, indem es in einem nachfolgenden nächsten Such Zertifikat verwendet wird, sodass der \_ [*Verweis Zähler*](../secgloss/r-gly.md) auf NULL dekrementiert wurde oder durch einen Aufruf von " [**certclosestore**](/windows/win32/api/Wincrypt/nf-wincrypt-certclosestore)" freigegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="0f088-195">The FREE\_FIND\_CERT callback is called when the certificate returned by the FIND\_CERT callback was not released by being used in a subsequent next FIND\_CERT, thus having its [*reference count*](../secgloss/r-gly.md) decremented to zero, or by being released by a call to [**CertCloseStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certclosestore).</span></span> <span data-ttu-id="0f088-196">Vor dem Aufruf des schließenden Rückrufs sollten alle vom Zertifikat suchen-Rückruf zurückgegebenen Zertifikate \_ für den Anbieter freigegeben werden, indem Sie an einen Aufruf des Zertifikats zum Suchen von \_ CERT oder einen Aufruf des kostenlosen c#-Zertifikats-Rückrufs übermittelt werden \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="0f088-196">Before the CLOSE callback is called, all certificates returned by the FIND\_CERT callback should be released to the provider by being passed to a call to the FIND\_CERT callback or a call to the FREE\_FIND\_CERT callback.</span></span> <span data-ttu-id="0f088-197">Das gleiche gilt für die CRL-und CTL-Rückrufe.</span><span class="sxs-lookup"><span data-stu-id="0f088-197">The same applies to the CRL and CTL callbacks.</span></span>

<span data-ttu-id="0f088-198">Der get \_ CERT- \_ Eigenschafts Rückruf wird von [**certgetcertifierecontextproperty**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetcertificatecontextproperty) aufgerufen, wenn er die angegebene Eigenschaft für den *pcertcontext* -Parameter nicht finden kann.</span><span class="sxs-lookup"><span data-stu-id="0f088-198">The GET\_CERT\_PROPERTY callback is called by [**CertGetCertificateContextProperty**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetcertificatecontextproperty) if it cannot find the specified property for the *pCertContext* parameter.</span></span> <span data-ttu-id="0f088-199">Das gleiche gilt für die get \_ CRL \_ -Eigenschaft und die get \_ CTL- \_ Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="0f088-199">The same is true for GET\_CRL\_PROPERTY and GET\_CTL\_PROPERTY.</span></span>

<span data-ttu-id="0f088-200">Der get \_ CRL-Rückruf wird aufgerufen, wenn die Store-APIs CRLs aufzählen oder Abrufen und bevor Sie eine Zertifikat Sperr Liste hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="0f088-200">The FIND\_CRL callback is called when the store APIs enumerate or get CRLs and before adding a CRL.</span></span> <span data-ttu-id="0f088-201">Die folgenden Arten von CRL-suchen werden definiert:</span><span class="sxs-lookup"><span data-stu-id="0f088-201">The following CRL find types will be defined:</span></span>

<span data-ttu-id="0f088-202">Bei \_ der von ausgegebenen CRL-Suche \_ \_ von ist *pvfindpara* ein Zeiger auf einen [**CERT- \_ Kontext**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) des Zertifikats der CRL.</span><span class="sxs-lookup"><span data-stu-id="0f088-202">For CRL\_FIND\_ISSUED\_BY, *pvFindPara* is a pointer to a [**CERT\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) of the CRL issuer.</span></span> <span data-ttu-id="0f088-203">Wenn die CRL- \_ Suche \_ vorhanden ist, ist *pvfindpara* ein Zeiger auf einen [**CRL- \_ Kontext**](/windows/win32/api/Wincrypt/ns-wincrypt-crl_context) der CRL, um zu bestimmen, ob er bereits im Speicher vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="0f088-203">For CRL\_FIND\_EXISTING, *pvFindPara* is a pointer to a [**CRL\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-crl_context) of the CRL to determine whether it already exists in the store.</span></span>

<span data-ttu-id="0f088-204">Der CTL-Rückruf "Find" \_ wird aufgerufen, wenn die Store-APIs CTLs aufzählen oder suchen.</span><span class="sxs-lookup"><span data-stu-id="0f088-204">The FIND\_CTL callback is called when the store APIs enumerate or find CTLs.</span></span> <span data-ttu-id="0f088-205">Die folgenden Typen von CTL-suchen werden in [**certfindctlinstore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindctlinstore)unterstützt:</span><span class="sxs-lookup"><span data-stu-id="0f088-205">The following CTL find types are supported in [**CertFindCTLInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindctlinstore):</span></span>

-   <span data-ttu-id="0f088-206">CTL- \_ Suche \_</span><span class="sxs-lookup"><span data-stu-id="0f088-206">CTL\_FIND\_ANY</span></span>
-   <span data-ttu-id="0f088-207">CTL- \_ Suche \_ SHA1- \_ Hash</span><span class="sxs-lookup"><span data-stu-id="0f088-207">CTL\_FIND\_SHA1\_HASH</span></span>
-   <span data-ttu-id="0f088-208">CTL- \_ Suche \_ MD5- \_ Hash</span><span class="sxs-lookup"><span data-stu-id="0f088-208">CTL\_FIND\_MD5\_HASH</span></span>
-   <span data-ttu-id="0f088-209">Verwendung der CTL- \_ Suche \_</span><span class="sxs-lookup"><span data-stu-id="0f088-209">CTL\_FIND\_USAGE</span></span>
-   <span data-ttu-id="0f088-210">CTL-Such \_ \_ Betreff</span><span class="sxs-lookup"><span data-stu-id="0f088-210">CTL\_FIND\_SUBJECT</span></span>
-   <span data-ttu-id="0f088-211">CTL- \_ Suche \_ vorhanden</span><span class="sxs-lookup"><span data-stu-id="0f088-211">CTL\_FIND\_EXISTING</span></span>

<span data-ttu-id="0f088-212">Der CTL-Rückruf "Find" \_ wird für jeden der obigen Suchtypen aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="0f088-212">The FIND\_CTL callback is called for each of the above find types.</span></span> <span data-ttu-id="0f088-213">Die an [**certfindctlinstore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindctlinstore) übergebenen Parameter werden direkt in die "CERT \_ Store \_ Prov Find Info"-Struktur kopiert, \_ \_ bevor der CTL-Rückruf "Find" \_ aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="0f088-213">The parameters passed to [**CertFindCTLInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindctlinstore) are copied directly to the CERT\_STORE\_PROV\_FIND\_INFO structure before the FIND\_CTL callback is called.</span></span> <span data-ttu-id="0f088-214">Ausführliche Informationen zu den Feldwerten für die verschiedenen Suchtypen der CERT \_ Store \_ Prov Find Info-Struktur finden Sie unter \_ \_ **certfindctlinstore**.</span><span class="sxs-lookup"><span data-stu-id="0f088-214">For details about the field values for the different find types of the CERT\_STORE\_PROV\_FIND\_INFO structure, see **CertFindCTLInStore**.</span></span>

<span data-ttu-id="0f088-215">Mit dem CTL- \_ \_ Suchtyp "vorhandene CTL suchen" können Sie ermitteln, ob die CTL bereits im Speicher vorhanden ist, bevor Sie ein CTL-Add-in</span><span class="sxs-lookup"><span data-stu-id="0f088-215">The CTL\_FIND\_EXISTING CTL find type helps determine whether the CTL already exists in the store before doing a CTL add.</span></span>

<span data-ttu-id="0f088-216">Für die CTL- \_ Suche \_ ist " *pvfindpara* " ein Zeiger auf die [**CTL- \_ Kontext**](/windows/win32/api/Wincrypt/ns-wincrypt-ctl_context) Struktur der CTL, um zu bestimmen, ob Sie bereits im Speicher vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="0f088-216">For CTL\_FIND\_EXISTING, *pvFindPara* is a pointer to the [**CTL\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-ctl_context) structure of the CTL to determine whether it already exists in the store.</span></span>

 

 
