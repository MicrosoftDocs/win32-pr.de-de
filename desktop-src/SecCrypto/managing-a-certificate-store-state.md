---
description: Mehrere Funktionen stellen Dienste zum Verwalten eines Zertifikat Speicher Zustands bereit.
ms.assetid: bae3d693-31b3-4c1d-9a8f-0dafa8bb6897
title: Verwalten eines Zertifikat Speicher Zustands
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 53d66e40817f0f92f48e8841455998eff4dbffd6
ms.sourcegitcommit: de72a1294df274b0a71dc0fdc42d757e5f6df0f3
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/05/2021
ms.locfileid: "103961240"
---
# <a name="managing-a-certificate-store-state"></a><span data-ttu-id="e2f7f-103">Verwalten eines Zertifikat Speicher Zustands</span><span class="sxs-lookup"><span data-stu-id="e2f7f-103">Managing a Certificate Store State</span></span>

<span data-ttu-id="e2f7f-104">Mehrere Funktionen stellen Dienste zum Verwalten eines [*Zertifikat Speicher*](../secgloss/c-gly.md) [*Zustands*](../secgloss/s-gly.md)bereit.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-104">Several functions provide services for managing a [*certificate store*](../secgloss/c-gly.md) [*state*](../secgloss/s-gly.md).</span></span>

<span data-ttu-id="e2f7f-105">Um Zugriff auf Zertifikate zu erhalten, muss der Zertifikat Speicher, in dem Sie gespeichert werden, durch einen Rückruf von " [**certopatstore**](/windows/desktop/api/Wincrypt/nf-wincrypt-certopenstore) " oder " [**certopssystemstore**](/windows/desktop/api/Wincrypt/nf-wincrypt-certopensystemstorea)" geöffnet werden.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-105">To gain access to certificates, the certificate store in which they are stored must be opened through a call to [**CertOpenStore**](/windows/desktop/api/Wincrypt/nf-wincrypt-certopenstore) or [**CertOpenSystemStore**](/windows/desktop/api/Wincrypt/nf-wincrypt-certopensystemstorea).</span></span>

<span data-ttu-id="e2f7f-106">In der Regel wird ein Zertifikat Speicher im zwischengespeicherten Speicher geöffnet.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-106">Usually a certificate store is opened in cached memory.</span></span> <span data-ttu-id="e2f7f-107">Dabei kann es sich um einen neuen Speicher handeln, oder der Inhalt kann aus der lokalen Registrierung, der Registrierung auf einem Remote Computer, einer Datenträger Datei, einer PKCS \# 7-Nachricht oder einer anderen Quelle geladen werden.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-107">It can be a new store or its contents can be loaded from the local registry, the registry on a remote computer, a disk file, a PKCS \#7 message, or some other source.</span></span>

<span data-ttu-id="e2f7f-108">Kryptoapi-Zertifikat Speicherfunktionen ermöglichen einem Speicher auch das Verwalten von Zertifikaten außerhalb des zwischengespeicherten Speichers in, z. b. eine externe Datenbank von Zertifikaten, z. b. die von der Microsoft Certificate Server-Datenbank bereitgestellte.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-108">CryptoAPI certificate store functions also allow a store to maintain certificates outside cached memory in, for example, an external database of certificates such as the one provided by the Microsoft Certificate Server Database.</span></span>

<span data-ttu-id="e2f7f-109">Einer der Parameter der [**CertOpenStore**](/windows/desktop/api/Wincrypt/nf-wincrypt-certopenstore) -Funktion, *lpszstoreprovider,* bestimmt den Typ des geöffneten Stores und den Anbieter, mit dem dieser Speicher geöffnet wird.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-109">One of the parameters of the [**CertOpenStore**](/windows/desktop/api/Wincrypt/nf-wincrypt-certopenstore) function, *lpszStoreProvider,* determines the type of store opened and the provider used to open that store.</span></span> <span data-ttu-id="e2f7f-110">Beispiele zum Öffnen von Zertifikat speichern mithilfe verschiedener Anbieter finden Sie unter [Beispiel C-Code zum Öffnen von Zertifikat speichern](example-c-code-for-opening-certificate-stores.md).</span><span class="sxs-lookup"><span data-stu-id="e2f7f-110">For examples of opening certificate stores using various providers, see [Example C Code for Opening Certificate Stores](example-c-code-for-opening-certificate-stores.md).</span></span>

<span data-ttu-id="e2f7f-111">[**Certclosestore**](/windows/desktop/api/Wincrypt/nf-wincrypt-certclosestore) schließt einen Zertifikat Speicher.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-111">[**CertCloseStore**](/windows/desktop/api/Wincrypt/nf-wincrypt-certclosestore) closes a certificate store.</span></span> <span data-ttu-id="e2f7f-112">Wenn ein Zertifikat Speicher geschlossen wird, wird für jeden der Zertifikat Kontexte in diesem Speicher der [*Verweis Zähler*](../secgloss/r-gly.md) um 1 reduziert.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-112">When a certificate store is closed, each of the certificate contexts in that store has its [*reference count*](../secgloss/r-gly.md) reduced by one.</span></span> <span data-ttu-id="e2f7f-113">Der Arbeitsspeicher wird für Zertifikate freigegeben, deren Verweis Zähler Null ist.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-113">Memory is freed for certificates whose reference count goes to zero.</span></span>

<span data-ttu-id="e2f7f-114">Wenn Sie \_ das Flag "CERT close \_ Store \_ Force" mit " \_ [**certclosestore**](/windows/desktop/api/Wincrypt/nf-wincrypt-certclosestore) " festlegen, wird der Zertifikat Speicher geschlossen, und es wird unabhängig von der Verweis Anzahl Speicher für alle Zertifikat Kontexte freigegeben</span><span class="sxs-lookup"><span data-stu-id="e2f7f-114">Setting CERT\_CLOSE\_STORE\_FORCE\_FLAG with [**CertCloseStore**](/windows/desktop/api/Wincrypt/nf-wincrypt-certclosestore) closes the certificate store and frees memory for all of its certificate contexts regardless of their reference count.</span></span> <span data-ttu-id="e2f7f-115">In einigen Fällen, wie z. b. in Multithreadprogrammen, ist dies nicht wünschenswert.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-115">In some cases, such as in multithreaded programs, this cannot be desirable.</span></span> <span data-ttu-id="e2f7f-116">Wenn \_ \_ \_ das Häkchen \_ des Zertifikats zum Schließen des Speichers festgelegt ist, wird der Speicher geschlossen, aber von der Funktion wird ein Warnungs Wert zurückgegeben, wenn noch Speicher für Zertifikate zugewiesen ist, deren Verweis Zähler nicht auf 0 (null) reduziert wurden.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-116">If CERT\_CLOSE\_STORE\_CHECK\_FLAG is set, the store is closed, but a warning value is returned by the function if memory is still allocated for certificates whose reference counts have not been reduced to zero.</span></span> <span data-ttu-id="e2f7f-117">Wenn der Verweis Zähler eines Zertifikats größer als 0 (null) ist, wurde kein Duplikat dieses Zertifikat Kontexts freigegeben.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-117">If a certificate's reference count is greater than zero, a duplicate of that certificate context has not been freed.</span></span> <span data-ttu-id="e2f7f-118">Verwenden Sie [**certfreecertifiingecontext**](/windows/desktop/api/Wincrypt/nf-wincrypt-certfreecertificatecontext), [**certfreecrlcontext**](/windows/desktop/api/Wincrypt/nf-wincrypt-certfreecrlcontext)und [**certfreectlcontext**](/windows/desktop/api/Wincrypt/nf-wincrypt-certfreectlcontext) , um alle Zertifikate freizugeben, die offen bleiben.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-118">Use [**CertFreeCertificateContext**](/windows/desktop/api/Wincrypt/nf-wincrypt-certfreecertificatecontext), [**CertFreeCRLContext**](/windows/desktop/api/Wincrypt/nf-wincrypt-certfreecrlcontext), and [**CertFreeCTLContext**](/windows/desktop/api/Wincrypt/nf-wincrypt-certfreectlcontext) to free any certificates left open.</span></span>

> [!Note]
> <span data-ttu-id="e2f7f-119">Bei einem [*Zertifikat Kontext*](../secgloss/c-gly.md) handelt es sich um eine Struktur vom Typ [**CERT- \_ Kontext**](/windows/desktop/api/Wincrypt/ns-wincrypt-cert_context) , bei der es sich unter anderem um einen Zeiger auf das codierte [*zertifikatblob*](../secgloss/c-gly.md) und einen Zeiger auf eine [**CERT \_ Info**](/windows/desktop/api/Wincrypt/ns-wincrypt-cert_info) -Struktur handelt.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-119">A [*certificate context*](../secgloss/c-gly.md) is a structure of type [**CERT\_CONTEXT**](/windows/desktop/api/Wincrypt/ns-wincrypt-cert_context) that has, among other members, a pointer to the encoded [*certificate BLOB*](../secgloss/c-gly.md) and a pointer to a [**CERT\_INFO**](/windows/desktop/api/Wincrypt/ns-wincrypt-cert_info) structure.</span></span> <span data-ttu-id="e2f7f-120">Die **CERT \_ Info** -Struktur enthält die wichtigsten Zertifikat Daten.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-120">The **CERT\_INFO** structure contains the most significant certificate data.</span></span> <span data-ttu-id="e2f7f-121">Weitere Informationen zu [*Zertifikaten*](../secgloss/c-gly.md), Zertifikats Sperr [*Listen*](../secgloss/c-gly.md) (CRL) und CTL-Kontext Strukturen ( [*Certificate Trust List*](../secgloss/c-gly.md) ) finden Sie unter [Codieren und Decodieren eines Zertifikat Kontexts](encoding-and-decoding-a-certificate-context.md).</span><span class="sxs-lookup"><span data-stu-id="e2f7f-121">For more information about [*certificate*](../secgloss/c-gly.md), [*certificate revocation list*](../secgloss/c-gly.md) (CRL), and [*certificate trust list*](../secgloss/c-gly.md) (CTL) context structures, see [Encoding and Decoding a Certificate Context](encoding-and-decoding-a-certificate-context.md).</span></span>
> 
> <span data-ttu-id="e2f7f-122">Jeder Zertifikat Kontext enthält auch einen [*Verweis Zähler*](../secgloss/r-gly.md) , der die Anzahl der Kopien der zugewiesenen Kontext Adresse angibt.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-122">Each certificate context also contains a [*reference count*](../secgloss/r-gly.md) indicating the number of copies of the context's address that have been assigned.</span></span> <span data-ttu-id="e2f7f-123">Jedes Mal, wenn ein Zertifikat Kontext in irgendeiner Weise dupliziert wird, wird der zugehörige Verweis Zähler um eins erhöht.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-123">Each time a certificate context is duplicated in any way, its reference count is incremented by one.</span></span> <span data-ttu-id="e2f7f-124">Jedes Mal, wenn ein Zeiger auf einen Zertifikat kontextfrei gegeben wird, wird der Verweis Zähler im Zertifikat Kontext um 1 dekrementiert.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-124">Each time a pointer to a certificate context is freed, the reference count in the certificate context is decremented by one.</span></span> <span data-ttu-id="e2f7f-125">Wenn der Verweis Zähler in einem Zertifikat Kontext 0 (null) erreicht, wird der Arbeitsspeicher, der den Kontext enthält, nicht mehr zugeordnet.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-125">When the reference count on a certificate context reaches zero, the memory holding the context is de-allocated.</span></span> <span data-ttu-id="e2f7f-126">Der für einen Zertifikat Kontext zugewiesene Arbeitsspeicher wird ebenfalls aufgehoben, wenn sich dieser Kontext in einem Speicher befindet und der Speicher mit dem Zertifikat " \_ Close Store Force" geschlossen wird \_ \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="e2f7f-126">Memory allocated for a certificate context is also de-allocated when that context is in a store and the store is closed using CERT\_CLOSE\_STORE\_FORCE\_FLAG.</span></span> <span data-ttu-id="e2f7f-127">Wenn die Zuordnung des Arbeitsspeichers für einen Kontext aufgehoben wird und Zeiger auf diesen Kontext weiterhin verwendet werden, sind diese Zeiger nicht mehr gültig.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-127">If the memory for a context is de-allocated and pointers to that context are still in use, those pointers are no longer valid.</span></span>

 

<span data-ttu-id="e2f7f-128">[**Certduplikatestore**](/windows/desktop/api/Wincrypt/nf-wincrypt-certduplicatestore) erhöht den [*Verweis Zähler*](../secgloss/r-gly.md) für den Speicher.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-128">[**CertDuplicateStore**](/windows/desktop/api/Wincrypt/nf-wincrypt-certduplicatestore) increases the [*reference count*](../secgloss/r-gly.md) on the store.</span></span>

<span data-ttu-id="e2f7f-129">[**Certsavestore**](/windows/desktop/api/Wincrypt/nf-wincrypt-certsavestore) speichert den Inhalt eines Speichers in einer Datenträger Datei oder einem Speicherort.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-129">[**CertSaveStore**](/windows/desktop/api/Wincrypt/nf-wincrypt-certsavestore) saves the contents of a store to a disk file or a memory location, and</span></span>

<span data-ttu-id="e2f7f-130">[**Certcontrolstore**](/windows/desktop/api/Wincrypt/nf-wincrypt-certcontrolstore) verwaltet einen Speicher, während er geöffnet ist.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-130">[**CertControlStore**](/windows/desktop/api/Wincrypt/nf-wincrypt-certcontrolstore) manages a store while it is open.</span></span> <span data-ttu-id="e2f7f-131">Eine Anwendung mit einem geöffneten Speicher kann benachrichtigt werden, wenn der beibehaltene Zustand dieses Stores von einem anderen Prozess geändert wurde.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-131">An application with an open store can be notified when the persisted state of that store has changed by some other process.</span></span> <span data-ttu-id="e2f7f-132">Dies kann der Fall sein, wenn neue Zertifikate von einem Domänen Steuerungscomputer in den lokalen Computerspeicher kopiert wurden.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-132">This could happen if new certificates were copied to the local computer store from a domain control computer.</span></span>

<span data-ttu-id="e2f7f-133">Wenn Änderungen erkannt werden, kann der zwischengespeicherte Speicher seinen zwischengespeicherten Speicher neu synchronisieren, sodass er dem beibehaltenen Zustand des Speicher entspricht.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-133">When changes are discovered, the cached store can re-synchronize its cached store to match the persisted state of the store.</span></span> <span data-ttu-id="e2f7f-134">[**Certcontrolstore**](/windows/desktop/api/Wincrypt/nf-wincrypt-certcontrolstore) unterstützt auch einen Prozess, bei dem zwischengespeicherte Speicher Änderungen in einen permanenten Speicher kopiert werden, wenn diese Änderungen im zwischengespeicherten Speicher nicht automatisch gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-134">[**CertControlStore**](/windows/desktop/api/Wincrypt/nf-wincrypt-certcontrolstore) also supports a process that copies cached store changes to permanent storage when these changes in the cached store are not automatically saved.</span></span>

<span data-ttu-id="e2f7f-135">Zertifikat Speicher ähnliche Zertifikat Kontexte können erweiterte Eigenschaften haben.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-135">Certificate store-like certificate contexts can have extended properties.</span></span> <span data-ttu-id="e2f7f-136">[**Certsetstoreproperty**](/windows/desktop/api/Wincrypt/nf-wincrypt-certsetstoreproperty) fügt einem Zertifikat Speicher erweiterte Eigenschaften hinzu.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-136">[**CertSetStoreProperty**](/windows/desktop/api/Wincrypt/nf-wincrypt-certsetstoreproperty) adds extended properties to a certificate store.</span></span> <span data-ttu-id="e2f7f-137">[**Certgetstoreproperty**](/windows/desktop/api/Wincrypt/nf-wincrypt-certgetstoreproperty) Ruft alle Eigenschaften ab, die in einem Zertifikat Speicher festgelegt sind.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-137">[**CertGetStoreProperty**](/windows/desktop/api/Wincrypt/nf-wincrypt-certgetstoreproperty) retrieves any properties set on a certificate store.</span></span> <span data-ttu-id="e2f7f-138">Derzeit ist die einzige vordefinierte Zertifikat Speicher Eigenschaft ein lokalisierter Name eines Stores.</span><span class="sxs-lookup"><span data-stu-id="e2f7f-138">Currently, the only predefined certificate store property is a store's localized name.</span></span>

 

 
