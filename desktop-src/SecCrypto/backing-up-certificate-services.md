---
description: Verwenden der Sicherungsfunktionen für Zertifikat Dienste zum Sichern einer Zertifikat Dienst Datenbank und der zugehörigen Dateien.
ms.assetid: f5c9c9f9-5211-4151-b8e0-3351d462c71b
title: Sichern von Zertifikat Diensten
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d1be929fcf3bd9b8b9655b48758a97d19af7abc7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "103868807"
---
# <a name="backing-up-certificate-services"></a><span data-ttu-id="c7367-103">Sichern von Zertifikat Diensten</span><span class="sxs-lookup"><span data-stu-id="c7367-103">Backing Up Certificate Services</span></span>

<span data-ttu-id="c7367-104">Im folgenden Szenario wird veranschaulicht, wie Sie die Sicherungsfunktionen der Zertifikat Dienste verwenden können, um eine Zertifikat Dienst-Datenbank und die zugehörigen Dateien zu sichern.</span><span class="sxs-lookup"><span data-stu-id="c7367-104">The following is a scenario showing how you can use the Certificate Services backup functions to back up a Certificate Services database and its associated files.</span></span>

1.  <span data-ttu-id="c7367-105">Laden Sie die Certadm.dll Bibliothek in den Arbeitsspeicher (durch Aufrufen von [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya)).</span><span class="sxs-lookup"><span data-stu-id="c7367-105">Load the Certadm.dll library into memory (by calling [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya)).</span></span>
2.  <span data-ttu-id="c7367-106">Rufen Sie die Adresse der einzelnen erforderlichen Funktionen in Certadm.dll (über [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress)) ab.</span><span class="sxs-lookup"><span data-stu-id="c7367-106">Retrieve the address of each of the necessary functions in Certadm.dll (by means of [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress)).</span></span> <span data-ttu-id="c7367-107">Verwenden Sie diese Adressen, wenn Sie die Funktionen in den verbleibenden Schritten aufrufen.</span><span class="sxs-lookup"><span data-stu-id="c7367-107">Use these addresses when calling the functions in the remaining steps.</span></span>
3.  <span data-ttu-id="c7367-108">Wenden Sie [**cerzrvisserveronline**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvisserveronlinew) an, um zu bestimmen, ob die Zertifikat Dienste online sind.</span><span class="sxs-lookup"><span data-stu-id="c7367-108">Call [**CertSrvIsServerOnline**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvisserveronlinew) to determine whether Certificate Services is online.</span></span> <span data-ttu-id="c7367-109">Die Zertifikat Dienste müssen online sein, damit die Sicherungs Vorgänge erfolgreich ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="c7367-109">Certificate Services must be online for the backup operations to be successful.</span></span>
4.  <span data-ttu-id="c7367-110">Nennen Sie [**cerzrvbackupprepare**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackuppreparew) , um eine Sicherungs Sitzung zu starten.</span><span class="sxs-lookup"><span data-stu-id="c7367-110">Call [**CertSrvBackupPrepare**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackuppreparew) to start a backup session.</span></span> <span data-ttu-id="c7367-111">Das resultierende Sicherungs Kontext Handle der Zertifikat Dienste wird von vielen der anderen Sicherungsfunktionen verwendet.</span><span class="sxs-lookup"><span data-stu-id="c7367-111">The resulting Certificate Services backup context handle will be used by many of the other backup functions.</span></span>
5.  <span data-ttu-id="c7367-112">Nennen Sie [**cerzrvrestoregetdatabaselocations**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvrestoregetdatabaselocationsw) , um die Wiederherstellungs Zuordnung zu bestimmen.</span><span class="sxs-lookup"><span data-stu-id="c7367-112">Call [**CertSrvRestoreGetDatabaseLocations**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvrestoregetdatabaselocationsw) to determine the restore map.</span></span> <span data-ttu-id="c7367-113">Die Restore Map enthält die Pfade, die beim Wiederherstellen der Sicherung verwendet werden sollen.</span><span class="sxs-lookup"><span data-stu-id="c7367-113">The restore map contains the paths to be used when restoring the backup.</span></span> <span data-ttu-id="c7367-114">Speichern Sie die von " **certsrvrestoregetdatabaselocations** " abgerufenen Informationen an einem anwendungsspezifischen Speicherort.</span><span class="sxs-lookup"><span data-stu-id="c7367-114">Save the information retrieved by **CertSrvRestoreGetDatabaseLocations** to an application-specific location.</span></span>
6.  <span data-ttu-id="c7367-115">Nennen Sie [**cerzrvbackupgetdatabasenames**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdatabasenamesw) , um die Namen der zu sichernden Datenbankdateien zu bestimmen.</span><span class="sxs-lookup"><span data-stu-id="c7367-115">Call [**CertSrvBackupGetDatabaseNames**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdatabasenamesw) to determine the names of the database files to backup.</span></span> <span data-ttu-id="c7367-116">Führen Sie für jede dieser Dateien die Schritte 7 bis 9 aus.</span><span class="sxs-lookup"><span data-stu-id="c7367-116">For each of these files, execute steps 7 through 9.</span></span>
7.  <span data-ttu-id="c7367-117">Nennen Sie [**cerzrvbackupopenfile**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupopenfilew) , um die Datei für die Sicherung zu öffnen.</span><span class="sxs-lookup"><span data-stu-id="c7367-117">Call [**CertSrvBackupOpenFile**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupopenfilew) to open the file for backup.</span></span>
8.  <span data-ttu-id="c7367-118">Rufen Sie [**cerzrvbackupread**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupread) auf, um einen Teil der Bytes aus der Datei zu lesen, und rufen Sie dann eine anwendungsspezifische Routine auf, um die Bytes auf einem Sicherungsmedium zu speichern.</span><span class="sxs-lookup"><span data-stu-id="c7367-118">Call [**CertSrvBackupRead**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupread) to read a portion of bytes from the file, then call an application-specific routine to store the bytes on a backup medium.</span></span> <span data-ttu-id="c7367-119">Wiederholen Sie diesen Schritt, bis alle Bytes in der Datei gesichert wurden.</span><span class="sxs-lookup"><span data-stu-id="c7367-119">Repeat this step until all of the bytes in the file are backed up.</span></span>
9.  <span data-ttu-id="c7367-120">Nennen Sie [**cerzrvbackupclose**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupclose) , um die Datei zu schließen.</span><span class="sxs-lookup"><span data-stu-id="c7367-120">Call [**CertSrvBackupClose**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupclose) to close the file.</span></span>
10. <span data-ttu-id="c7367-121">Nennen Sie [**cergs rvbackupgetbackuplogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetbackuplogsw) , um die Namen der zu sichernden Protokolldateien zu bestimmen.</span><span class="sxs-lookup"><span data-stu-id="c7367-121">Call [**CertSrvBackupGetBackupLogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetbackuplogsw) to determine the names of the log files to backup.</span></span> <span data-ttu-id="c7367-122">Führen Sie für jede dieser Dateien die Schritte 7 bis 9 aus.</span><span class="sxs-lookup"><span data-stu-id="c7367-122">For each of these files, execute steps 7 through 9.</span></span>
11. <span data-ttu-id="c7367-123">Nennen Sie [**cergs rvbackuptrunkatelogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackuptruncatelogs) , um die in den Schritten 6 und 10 gesicherten Protokolldateien abzuschneiden.</span><span class="sxs-lookup"><span data-stu-id="c7367-123">Call [**CertSrvBackupTruncateLogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackuptruncatelogs) to truncate the log files which were backed up in steps 6 and 10.</span></span> <span data-ttu-id="c7367-124">Dieser Schritt ist optional. Allerdings wird **certrvbackuptrunerelogs** nur aufgerufen, wenn alle von [**certrvbackupgetdatabasenames**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdatabasenamesw) und [**certrvbackupgetbackuplogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetbackuplogsw) zurückgegebenen Dateien gesichert wurden (andernfalls schlägt der Wiederherstellungs Vorgang fehl).</span><span class="sxs-lookup"><span data-stu-id="c7367-124">This step is optional; however, call **CertSrvBackupTruncateLogs** only if all files returned by [**CertSrvBackupGetDatabaseNames**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdatabasenamesw) and [**CertSrvBackupGetBackupLogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetbackuplogsw) have been backed up (otherwise, the restore operation will fail).</span></span> <span data-ttu-id="c7367-125">Weitere Informationen finden Sie auf der Referenzseite zu **certrvbackuptruneurelogs** .</span><span class="sxs-lookup"><span data-stu-id="c7367-125">Consult the **CertSrvBackupTruncateLogs** reference page for details.</span></span>
12. <span data-ttu-id="c7367-126">Nennen Sie [**cerzrvbackupgetdynamicfilelist**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdynamicfilelistw) , um die Namen der zu sichernden nicht-Datenbankdateien zu bestimmen.</span><span class="sxs-lookup"><span data-stu-id="c7367-126">Call [**CertSrvBackupGetDynamicFileList**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdynamicfilelistw) to determine the names of the non-database files to backup.</span></span> <span data-ttu-id="c7367-127">Diese Dateien werden nur von der-Funktion identifiziert und müssen auf andere Weise gesichert werden.</span><span class="sxs-lookup"><span data-stu-id="c7367-127">These files are only identified by the function, and must be backed up by some other means.</span></span>
13. <span data-ttu-id="c7367-128">Sichern Sie die in Schritt 12 identifizierten dynamischen Dateien mithilfe von Routinen, die von Certadm.dll getrennt sind.</span><span class="sxs-lookup"><span data-stu-id="c7367-128">Backup the dynamic files identified in step 12, using routines separate from Certadm.dll.</span></span>
14. <span data-ttu-id="c7367-129">Nennen Sie [**cerzrvbackupend**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupend) , um die Sicherungs Sitzung zu beenden.</span><span class="sxs-lookup"><span data-stu-id="c7367-129">Call [**CertSrvBackupEnd**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupend) to end the backup session.</span></span>
15. <span data-ttu-id="c7367-130">Nennen Sie [**cerzrvbackupfree**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupfree) nach Bedarf, um Puffer freizugeben, die von bestimmten Sicherungsfunktionen für Zertifikat Dienste zugeordnet werden.</span><span class="sxs-lookup"><span data-stu-id="c7367-130">Call [**CertSrvBackupFree**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupfree) as needed to release buffers allocated by certain Certificate Services backup functions.</span></span> <span data-ttu-id="c7367-131">Aufrufe von " [**cerzrvbackupgetbackuplogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetbackuplogsw)", " [**cerzrvbackupgetdatabasenames**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdatabasenamesw)" und " [**cerzrvbackupgetdynamicfilelist**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdynamicfilelistw) " weisen Puffer zu, die durch einen Aufruf von " **cerzrvbackupfree**" freigegeben werden können.</span><span class="sxs-lookup"><span data-stu-id="c7367-131">Calls to [**CertSrvBackupGetBackupLogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetbackuplogsw), [**CertSrvBackupGetDatabaseNames**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdatabasenamesw), and [**CertSrvBackupGetDynamicFileList**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdynamicfilelistw) will allocate buffers that can be freed by a call to **CertSrvBackupFree**.</span></span>
16. <span data-ttu-id="c7367-132">Geben Sie die Certadm.dll Ressourcen frei, indem Sie [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary)aufrufen.</span><span class="sxs-lookup"><span data-stu-id="c7367-132">Release the Certadm.dll resources by calling [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary).</span></span>

<span data-ttu-id="c7367-133">Informationen zu den Berechtigungen, die zum Sichern der Zertifikat Dienst Datenbank und der zugehörigen Dateien erforderlich sind, finden Sie unter [Festlegen der Sicherungs-und Wiederherstellungs Berechtigungen](setting-the-backup-and-restore-privileges.md).</span><span class="sxs-lookup"><span data-stu-id="c7367-133">For information about the privileges required to back up the Certificate Services database and associated files, see [Setting the Backup and Restore Privileges](setting-the-backup-and-restore-privileges.md).</span></span>

 

 
