---
description: Erläutert, wie ein HMAC erstellt wird.
ms.assetid: b1747b7e-a505-4b23-93bc-cef4e77bf825
title: Erstellen eines HMAC
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 364314081bd1d84d6d9bfff889c234470cc6775c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "106368022"
---
# <a name="creating-an-hmac"></a><span data-ttu-id="36141-103">Erstellen eines HMAC</span><span class="sxs-lookup"><span data-stu-id="36141-103">Creating an HMAC</span></span>

<span data-ttu-id="36141-104">**So berechnen Sie einen HMAC**</span><span class="sxs-lookup"><span data-stu-id="36141-104">**To compute an HMAC**</span></span>

1.  <span data-ttu-id="36141-105">Rufen Sie einen Zeiger auf den Microsoft [*Kryptografiedienstanbieter*](../secgloss/c-gly.md) (CSP) ab, indem Sie [**CryptAcquireContext**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptacquirecontexta)aufrufen.</span><span class="sxs-lookup"><span data-stu-id="36141-105">Get a pointer to the Microsoft [*Cryptographic Service Provider*](../secgloss/c-gly.md) (CSP) by calling [**CryptAcquireContext**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptacquirecontexta).</span></span>
2.  <span data-ttu-id="36141-106">Erstellen Sie ein Handle für ein [*HMAC*](../secgloss/h-gly.md)-[*Hash Objekt*](../secgloss/h-gly.md) , indem Sie [**cryptcreatehash**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptcreatehash)aufrufen.</span><span class="sxs-lookup"><span data-stu-id="36141-106">Create a handle to an [*HMAC*](../secgloss/h-gly.md)[*hash object*](../secgloss/h-gly.md) by calling [**CryptCreateHash**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptcreatehash).</span></span> <span data-ttu-id="36141-107">Übergeben Sie den calg- \_ HMAC im *algid* -Parameter.</span><span class="sxs-lookup"><span data-stu-id="36141-107">Pass CALG\_HMAC in the *Algid* parameter.</span></span> <span data-ttu-id="36141-108">Übergeben Sie das Handle eines [*symmetrischen Schlüssels*](../secgloss/s-gly.md) im *HKEY* -Parameter.</span><span class="sxs-lookup"><span data-stu-id="36141-108">Pass the handle of a [*symmetric key*](../secgloss/s-gly.md) in the *hKey* parameter.</span></span> <span data-ttu-id="36141-109">Dieser symmetrische Schlüssel ist der Schlüssel, der verwendet wird, um den HMAC zu berechnen.</span><span class="sxs-lookup"><span data-stu-id="36141-109">This symmetric key is the key used to compute the HMAC.</span></span>
3.  <span data-ttu-id="36141-110">Geben Sie den zu verwendenden Hashtyp an, indem Sie [**cryptsethashparam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptsethashparam) mit dem Parameter *dwparam* auf den Wert HP \_ HMAC \_ Info festlegen.</span><span class="sxs-lookup"><span data-stu-id="36141-110">Specify the type of hash to be used by calling [**CryptSetHashParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptsethashparam) with the *dwParam* parameter set to the value HP\_HMAC\_INFO.</span></span> <span data-ttu-id="36141-111">Der *pbData* -Parameter muss auf eine initialisierte [**HMAC- \_ Informations**](/windows/desktop/api/Wincrypt/ns-wincrypt-hmac_info) Struktur zeigen.</span><span class="sxs-lookup"><span data-stu-id="36141-111">The *pbData* parameter must point to an initialized [**HMAC\_INFO**](/windows/desktop/api/Wincrypt/ns-wincrypt-hmac_info) structure.</span></span>
4.  <span data-ttu-id="36141-112">Wenden Sie [**CryptHashData**](/windows/desktop/api/Wincrypt/nf-wincrypt-crypthashdata) an, um mit dem Berechnen des HMACs der Daten zu beginnen.</span><span class="sxs-lookup"><span data-stu-id="36141-112">Call [**CryptHashData**](/windows/desktop/api/Wincrypt/nf-wincrypt-crypthashdata) to begin computing the HMAC of the data.</span></span> <span data-ttu-id="36141-113">Der erste Rückruf von **CryptHashData** bewirkt, dass der Schlüsselwert mit dem XOR-Operator mit der inneren Zeichenfolge und den Daten kombiniert wird.</span><span class="sxs-lookup"><span data-stu-id="36141-113">The first call to **CryptHashData** causes the key value to be combined using the XOR operator with the inner string and the data.</span></span> <span data-ttu-id="36141-114">Das Ergebnis der XOR-Operation wird als Hash verwendet, und dann werden die Zieldaten für den HMAC (auf den der *pbData* -Parameter verweist, der im Rückruf von **CryptHashData** übergeben wird) mit Hash versehen.</span><span class="sxs-lookup"><span data-stu-id="36141-114">The result of the XOR operation is hashed, and then the target data for the HMAC (pointed to by the *pbData* parameter passed in the call to **CryptHashData**) is hashed.</span></span> <span data-ttu-id="36141-115">Ggf. können nachfolgende Aufrufe von **CryptHashData** erfolgen, um das hashup der Zieldaten abzuschließen.</span><span class="sxs-lookup"><span data-stu-id="36141-115">If necessary, subsequent calls to **CryptHashData** may then be made to finish the hashing of the target data.</span></span>
5.  <span data-ttu-id="36141-116">Nennen Sie [**cryptgethashparam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptgethashparam) mit dem Parameter *dwparam* , der auf HP hashval festgelegt ist \_ .</span><span class="sxs-lookup"><span data-stu-id="36141-116">Call [**CryptGetHashParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptgethashparam) with the *dwParam* parameter set to HP\_HASHVAL.</span></span> <span data-ttu-id="36141-117">Dieser Befehl bewirkt, dass der innere Hash abgeschlossen ist und die äußere Zeichenfolge mithilfe von XOR mit dem Schlüssel kombiniert wird.</span><span class="sxs-lookup"><span data-stu-id="36141-117">This call causes the inner hash to be finished and the outer string to be combined using XOR with the key.</span></span> <span data-ttu-id="36141-118">Das Ergebnis der XOR-Operation wird als Hash verwendet, und anschließend wird das Ergebnis des inneren Hashs (im vorherigen Schritt abgeschlossen) als Hash verwendet.</span><span class="sxs-lookup"><span data-stu-id="36141-118">The result of the XOR operation is hashed, and then the result of the inner hash (completed in the previous step) is hashed.</span></span> <span data-ttu-id="36141-119">Der äußere Hash wird dann beendet und im *pbData* -Parameter und der Länge im *dwdatalen* -Parameter zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="36141-119">The outer hash is then finished and returned in the *pbData* parameter and the length in the *dwDataLen* parameter.</span></span>

> [!Note]  
> <span data-ttu-id="36141-120">Verwenden Sie nicht denselben [*symmetrischen*](../secgloss/s-gly.md) ([*Sitzungs*](../secgloss/s-gly.md)-) Schlüssel sowohl für die Nachrichten Verschlüsselung als auch für die [*Nachrichtenauthentifizierungscode*](../secgloss/m-gly.md) (Mac)-Generierung.</span><span class="sxs-lookup"><span data-stu-id="36141-120">Do not use the same [*symmetric*](../secgloss/s-gly.md) ([*session*](../secgloss/s-gly.md)) key for both message encryption and [*Message Authentication Code*](../secgloss/m-gly.md) (MAC) generation.</span></span> <span data-ttu-id="36141-121">Wenn Sie den gleichen Schlüssel für beides verwenden, erhöht sich das Risiko, dass Nachrichten von Angreifern decodiert werden.</span><span class="sxs-lookup"><span data-stu-id="36141-121">Using the same key for both greatly increases the risk of messages being decoded by attackers.</span></span>

 

 

 
