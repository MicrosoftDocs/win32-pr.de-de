---
description: Stellt die Aufgaben dar, die zum Codieren einer Hash Nachricht erforderlich sind.
ms.assetid: c1a65452-c634-4cc6-9afe-d6bf11d999d1
title: Codieren und Decodieren einer Hash Nachricht
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d91d165634c1ae00a59f2c77b1fc5a36b53dbd96
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "106360733"
---
# <a name="encoding-and-decoding-a-hashed-message"></a><span data-ttu-id="2a819-103">Codieren und Decodieren einer Hash Nachricht</span><span class="sxs-lookup"><span data-stu-id="2a819-103">Encoding and Decoding a Hashed Message</span></span>

<span data-ttu-id="2a819-104">Hash Daten bestehen aus Inhalten eines beliebigen Typs und einem [*Hash*](../secgloss/h-gly.md) des Inhalts.</span><span class="sxs-lookup"><span data-stu-id="2a819-104">Hashed data consists of content of any type and a [*hash*](../secgloss/h-gly.md) of the content.</span></span> <span data-ttu-id="2a819-105">Sie kann verwendet werden, wenn nur sichergestellt werden muss, dass der Nachrichten Inhalt seit der Hash Erstellung nicht geändert wurde.</span><span class="sxs-lookup"><span data-stu-id="2a819-105">It can be used when it is only necessary to confirm that the message content has not been modified since the hash was created.</span></span>

<span data-ttu-id="2a819-106">Beim Erstellen einer Hash Nachricht können mehrere Hash Algorithmen und mehrere Hashes vorhanden sein.</span><span class="sxs-lookup"><span data-stu-id="2a819-106">When creating a hashed message, there can be multiple hash algorithms and multiple hashes.</span></span> <span data-ttu-id="2a819-107">Die folgende Abbildung zeigt die Aufgaben, die zum Codieren einer Hash Nachricht erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="2a819-107">The following illustration depicts the tasks required to encode a hashed message.</span></span> <span data-ttu-id="2a819-108">Die Prozedur wird in dem Text beschrieben, der der Abbildung folgt.</span><span class="sxs-lookup"><span data-stu-id="2a819-108">The procedure is described in the text that follows the illustration.</span></span>

![Erstellen einer Hash Nachricht](images/hashmsg.png)

<span data-ttu-id="2a819-110">**So erstellen Sie eine Hash Nachricht**</span><span class="sxs-lookup"><span data-stu-id="2a819-110">**To create a hashed message**</span></span>

1.  <span data-ttu-id="2a819-111">Einen Zeiger auf die Daten, für die ein Hashwert erstellt werden soll.</span><span class="sxs-lookup"><span data-stu-id="2a819-111">Get a pointer to the data to be hashed.</span></span>
2.  <span data-ttu-id="2a819-112">Wählen Sie den zu verwendenden Hash Algorithmus aus.</span><span class="sxs-lookup"><span data-stu-id="2a819-112">Select the hash algorithm to be used.</span></span>
3.  <span data-ttu-id="2a819-113">Fügen Sie die Daten mithilfe des Hash Algorithmus über eine Hash Funktion ein.</span><span class="sxs-lookup"><span data-stu-id="2a819-113">Put the data through a hashing function using the hash algorithm.</span></span>
4.  <span data-ttu-id="2a819-114">Fügen Sie die ursprünglichen Daten ein, die in den Hash Hash eingefügt werden sollen, die Hash Algorithmen und die Hashes in der codierten Nachricht.</span><span class="sxs-lookup"><span data-stu-id="2a819-114">Include the original data to be hashed, the hashing algorithms, and the hashes in the encoded message.</span></span>

<span data-ttu-id="2a819-115">Verwenden Sie das folgende Verfahren, wenn Sie Nachrichten Funktionen auf niedriger Ebene verwenden möchten, um die gerade beschriebenen Aufgaben auszuführen.</span><span class="sxs-lookup"><span data-stu-id="2a819-115">To use low-level message functions to accomplish the tasks just outlined, use the following procedure.</span></span>

<span data-ttu-id="2a819-116">**So können Sie eine Nachricht mithilfe von Nachrichten Funktionen auf niedriger Ebene mit Hash-und Codieren**</span><span class="sxs-lookup"><span data-stu-id="2a819-116">**To hash and encode a message using low-level message functions**</span></span>

1.  <span data-ttu-id="2a819-117">Hiermit wird der zu hashende Inhalt erstellt oder abgerufen.</span><span class="sxs-lookup"><span data-stu-id="2a819-117">Create or retrieve the content to be hashed.</span></span>
2.  <span data-ttu-id="2a819-118">Verschaffen Sie sich einen Kryptografieanbieter.</span><span class="sxs-lookup"><span data-stu-id="2a819-118">Get a cryptographic provider.</span></span>
3.  <span data-ttu-id="2a819-119">Initialisieren Sie die CMSG-Hash Struktur zum [**\_ \_ Codieren von \_ Informationen**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_hashed_encode_info) .</span><span class="sxs-lookup"><span data-stu-id="2a819-119">Initialize the [**CMSG\_HASHED\_ENCODE\_INFO**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_hashed_encode_info) structure.</span></span>
4.  <span data-ttu-id="2a819-120">Sie können [**cryptmsgcalculateencodedlength**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcalculateencodedlength) aufrufen, um die Größe des codierten nachrichtenblobs zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="2a819-120">Call [**CryptMsgCalculateEncodedLength**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcalculateencodedlength) to get the size of the encoded message BLOB.</span></span> <span data-ttu-id="2a819-121">Arbeitsspeicher zuweisen.</span><span class="sxs-lookup"><span data-stu-id="2a819-121">Allocate memory for it.</span></span>
5.  <span data-ttu-id="2a819-122">Nennen Sie " [**cryptmsgopentoencode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentoencode)", und übergeben Sie für den Parameter " \_ *dwmsgtype* " den Parameter "CMSG Hashed" und einen Zeiger auf " [**CMSG \_ Hashed \_ encode \_**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_hashed_encode_info) " für den Parameter " *pvmsgencodeinfo* ".</span><span class="sxs-lookup"><span data-stu-id="2a819-122">Call [**CryptMsgOpenToEncode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentoencode), passing in CMSG\_HASHED for the *dwMsgType* parameter and a pointer to [**CMSG\_HASHED\_ENCODE\_INFO**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_hashed_encode_info) for the *pvMsgEncodeInfo* parameter.</span></span> <span data-ttu-id="2a819-123">Als Ergebnis dieses Aufrufes wird ein Handle für die geöffnete Nachricht angezeigt.</span><span class="sxs-lookup"><span data-stu-id="2a819-123">As a result of this call, you get a handle to the opened message.</span></span>
6.  <span data-ttu-id="2a819-124">Nennen Sie [**cryptmsgupdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate), und übergeben Sie das in Schritt 5 abgerufene Handle und einen Zeiger auf die Daten, für die ein Hashwert erstellt und codiert werden soll.</span><span class="sxs-lookup"><span data-stu-id="2a819-124">Call [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate), passing in the handle retrieved in step 5 and a pointer to the data that is to be hashed and encoded.</span></span> <span data-ttu-id="2a819-125">Diese Funktion kann so oft wie nötig aufgerufen werden, um den Codierungsprozess abzuschließen.</span><span class="sxs-lookup"><span data-stu-id="2a819-125">This function can be called as many times as necessary to complete the encoding process.</span></span>
7.  <span data-ttu-id="2a819-126">Aufrufen von [**cryptmsggetparam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), übergeben des in Schritt 5 abgerufenen Handles und der entsprechenden Parametertypen für den Zugriff auf die gewünschten, codierten Daten.</span><span class="sxs-lookup"><span data-stu-id="2a819-126">Call [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), passing in the handle retrieved in step 5 and the appropriate parameter types to access the desired, encoded data.</span></span> <span data-ttu-id="2a819-127">Übergeben Sie z. b. CMSG \_ Content \_ param, um einen Zeiger auf die gesamte [*PKCS \# 7*](../secgloss/p-gly.md) -Nachricht zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="2a819-127">For example, pass in CMSG\_CONTENT\_PARAM to get a pointer to the entire [*PKCS \#7*](../secgloss/p-gly.md) message.</span></span>

    <span data-ttu-id="2a819-128">Wenn das Ergebnis dieser Codierung als [*innere Daten*](../secgloss/i-gly.md) für eine andere codierte Nachricht verwendet werden soll, z. b. eine eingeschlossene Nachricht, muss CMSG-Bare-Content-Parameter \_ \_ \_ übergeben werden.</span><span class="sxs-lookup"><span data-stu-id="2a819-128">If the result of this encoding is to be used as the [*inner data*](../secgloss/i-gly.md) for another encoded message, such as an enveloped message, CMSG\_BARE\_CONTENT\_PARAM must be passed.</span></span> <span data-ttu-id="2a819-129">Ein Beispiel, das dies veranschaulicht, finden Sie unter [alternativer Code zum Codieren einer](alternate-code-for-encoding-an-enveloped-message.md)eingeschlossenen Nachricht.</span><span class="sxs-lookup"><span data-stu-id="2a819-129">For an example showing this, see [Alternate Code for Encoding an Enveloped Message](alternate-code-for-encoding-an-enveloped-message.md).</span></span>

8.  <span data-ttu-id="2a819-130">Schließen Sie die Nachricht, indem Sie [**cryptmsgclose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose)aufrufen.</span><span class="sxs-lookup"><span data-stu-id="2a819-130">Close the message by calling [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose).</span></span>

<span data-ttu-id="2a819-131">Das Ergebnis dieser Prozedur ist eine codierte Nachricht, die die ursprünglichen Daten, die Hash Algorithmen und den [*Hash*](../secgloss/h-gly.md) der Daten enthält.</span><span class="sxs-lookup"><span data-stu-id="2a819-131">The result of this procedure is an encoded message that contains the original data, the hashing algorithms, and the [*hash*](../secgloss/h-gly.md) of that data.</span></span> <span data-ttu-id="2a819-132">Ein Zeiger auf das codierte [*nachrichtenblob*](../secgloss/b-gly.md) wird in Schritt 7 abgerufen.</span><span class="sxs-lookup"><span data-stu-id="2a819-132">A pointer to the encoded message [*BLOB*](../secgloss/b-gly.md) is obtained in step 7.</span></span>

<span data-ttu-id="2a819-133">Die folgenden zwei Prozeduren decodieren und überprüfen dann Hashdaten.</span><span class="sxs-lookup"><span data-stu-id="2a819-133">The following two procedures decode and then verify hashed data.</span></span>

<span data-ttu-id="2a819-134">**So decodieren Sie Daten mit Hash**</span><span class="sxs-lookup"><span data-stu-id="2a819-134">**To decode hashed data**</span></span>

1.  <span data-ttu-id="2a819-135">Einen Zeiger auf das codierte BLOB erhalten.</span><span class="sxs-lookup"><span data-stu-id="2a819-135">Get a pointer to the encoded BLOB.</span></span>
2.  <span data-ttu-id="2a819-136">Nennen Sie [**cryptmsgopentodecode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentodecode), und übergeben Sie die erforderlichen Argumente.</span><span class="sxs-lookup"><span data-stu-id="2a819-136">Call [**CryptMsgOpenToDecode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentodecode), passing the necessary arguments.</span></span>
3.  <span data-ttu-id="2a819-137">Nennen Sie [**cryptmsgupdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) einmal, und übergeben Sie dabei das in Schritt 2 abgerufene Handle und einen Zeiger auf die Daten, die decodiert werden sollen.</span><span class="sxs-lookup"><span data-stu-id="2a819-137">Call [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) once, passing in the handle retrieved in step 2 and a pointer to the data that is to be decoded.</span></span> <span data-ttu-id="2a819-138">Dies bewirkt, dass die entsprechenden Aktionen für die Nachricht durchgeführt werden, abhängig vom Nachrichtentyp.</span><span class="sxs-lookup"><span data-stu-id="2a819-138">This causes the appropriate actions to be taken on the message, depending on the message type.</span></span>
4.  <span data-ttu-id="2a819-139">Aufrufen von [**cryptmsggetparam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), übergeben des in Schritt 2 abgerufenen Handles und der entsprechenden Parametertypen für den Zugriff auf die gewünschten, decodierten Daten.</span><span class="sxs-lookup"><span data-stu-id="2a819-139">Call [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), passing in the handle retrieved in step 2, and the appropriate parameter types to access the desired, decoded data.</span></span> <span data-ttu-id="2a819-140">Übergeben Sie z. b. CMSG \_ Content \_ param, um einen Zeiger auf den decodierten Inhalt zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="2a819-140">For example, pass in CMSG\_CONTENT\_PARAM to get a pointer to the decoded content.</span></span>

<span data-ttu-id="2a819-141">**So überprüfen Sie den Hash**</span><span class="sxs-lookup"><span data-stu-id="2a819-141">**To verify the hash**</span></span>

1.  <span data-ttu-id="2a819-142">Nennen Sie [**cryptmsgcontrol**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcontrol), und übergeben \_ Sie den Hash der CMSG STRG-Taste, \_ \_ um die Hashwerte zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="2a819-142">Call [**CryptMsgControl**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcontrol), passing in CMSG\_CTRL\_VERIFY\_HASH to verify the hashes.</span></span>
2.  <span data-ttu-id="2a819-143">" [**Cryptmsgclose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose) " aufrufen, um die Nachricht zu schließen.</span><span class="sxs-lookup"><span data-stu-id="2a819-143">Call [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose) to close the message.</span></span>

<span data-ttu-id="2a819-144">Ein Beispielprogramm finden Sie unter [Beispiel C-Programm: Codieren und Decodieren einer Hash Nachricht](example-c-program-encoding-and-decoding-a-hashed-message.md).</span><span class="sxs-lookup"><span data-stu-id="2a819-144">For an example program, see [Example C Program: Encoding and Decoding a Hashed Message](example-c-program-encoding-and-decoding-a-hashed-message.md).</span></span>

 

 
