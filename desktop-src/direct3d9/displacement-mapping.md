---
description: Verschiebungs Zuordnungen ähneln Textur Karten, aber der Vertex-Engine wird darauf zugreifen.
ms.assetid: d6f16ff2-5a66-48a3-82c4-523faaafa6ae
title: Verschiebungs Zuordnung (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b687583b0109223d8c2dac807425e235ddf280e4
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/06/2021
ms.locfileid: "104482078"
---
# <a name="displacement-mapping-direct3d-9"></a><span data-ttu-id="f20a2-103">Verschiebungs Zuordnung (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="f20a2-103">Displacement Mapping (Direct3D 9)</span></span>

<span data-ttu-id="f20a2-104">Verschiebungs Zuordnungen ähneln Textur Karten, aber der Vertex-Engine wird darauf zugreifen.</span><span class="sxs-lookup"><span data-stu-id="f20a2-104">Displacement maps are similar to texture maps but are accessed by the vertex engine.</span></span>

## <a name="block-diagram"></a><span data-ttu-id="f20a2-105">Block Diagramm</span><span class="sxs-lookup"><span data-stu-id="f20a2-105">Block Diagram</span></span>

<span data-ttu-id="f20a2-106">Eine zusätzliche Samplingphase ist im frühen Teil der vertexpipe vorhanden, wie im folgenden Diagramm gezeigt, das eine Verschiebungs Zuordnung zum Bereitstellen von Scheitelpunkt Verschiebungs Daten darstellen kann.</span><span class="sxs-lookup"><span data-stu-id="f20a2-106">An additional sampler stage is present in the early part of the vertex pipe, as shown in the following diagram, which can sample a displacement map to provide vertex displacement data.</span></span>

![Diagramm der Samplingphase in der Scheitelpunkt Pipe](images/tessellatordx9.png)

<span data-ttu-id="f20a2-108">Der Status des Verschiebungs Karten Samplers kann von [**setsamplerstate**](/windows/desktop/api) mithilfe der Phasen Nummer 256 festgelegt werden. dabei handelt es sich um eine neue Stufen Nummer.</span><span class="sxs-lookup"><span data-stu-id="f20a2-108">The displacement map sampler state can be set by the [**SetSamplerState**](/windows/desktop/api) using stage number 256, which is a new stage number.</span></span> <span data-ttu-id="f20a2-109">Die Struktur der Verschiebungs Zuordnung wird von [**SetTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-settexture)festgelegt.</span><span class="sxs-lookup"><span data-stu-id="f20a2-109">The displacement map texture is set by [**SetTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-settexture).</span></span>

<span data-ttu-id="f20a2-110">Die Zuordnung kann vorab erstellt werden, d. h., Sie kann so angeordnet werden, dass die Suche nach den Verschiebungs Werten ohne Filterung ermöglicht wird.</span><span class="sxs-lookup"><span data-stu-id="f20a2-110">The map can be presampled or not, which means that it can be ordered in a way that enables the lookup of the displacement values without filtering.</span></span>

-   <span data-ttu-id="f20a2-111">Verschiebungs Zuordnungen entsprechen Textur Zuordnungen, auf die Vertex-Engine wird jedoch zugegriffen.</span><span class="sxs-lookup"><span data-stu-id="f20a2-111">Displacement maps are analogous to texture maps but are accessed by the vertex engine.</span></span>
-   <span data-ttu-id="f20a2-112">Eine zusätzliche Samplingphase ist im frühen Teil der vertexpipe vorhanden, die eine Verschiebungs Karte enthalten kann.</span><span class="sxs-lookup"><span data-stu-id="f20a2-112">An additional sampler stage is present in the early part of the vertex pipe that can sample a displacement map.</span></span> <span data-ttu-id="f20a2-113">Auf diese Stufe wird über die übliche setsamplerstate-API zugegriffen, aber die Stufen Nummer ist D3DDMAPSAMPLER = 256.</span><span class="sxs-lookup"><span data-stu-id="f20a2-113">This stage is accessed by the usual SetSamplerState API but the stage number is D3DDMAPSAMPLER = 256.</span></span>
-   <span data-ttu-id="f20a2-114">Der Status des Verschiebungs Karten Samplers kann durch setsamplerstate (D3DDMAPSAMPLER,...) festgelegt werden. Found.</span><span class="sxs-lookup"><span data-stu-id="f20a2-114">The displacement map sampler state can be set by the SetSamplerState(D3DDMAPSAMPLER, ...) API.</span></span>
-   <span data-ttu-id="f20a2-115">Die Struktur der Verschiebungs Zuordnung wird von der SetTexture-API (D3DDMAPSAMPLER, Texture) festgelegt.</span><span class="sxs-lookup"><span data-stu-id="f20a2-115">The displacement map texture is set by the SetTexture(D3DDMAPSAMPLER, texture) API.</span></span>
-   <span data-ttu-id="f20a2-116">Die Zuordnung kann vorab abgetastet werden.</span><span class="sxs-lookup"><span data-stu-id="f20a2-116">The map can be pre-sampled or not.</span></span> <span data-ttu-id="f20a2-117">Dies bedeutet, dass Sie auf eine bestimmte Weise angeordnet werden kann, die die Suche nach Verschiebungs Werten ohne Filterung ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="f20a2-117">This means that it can be ordered in a particular way that enables the lookup of the displacement values without filtering.</span></span>
-   <span data-ttu-id="f20a2-118">Die Änderungen in der Deklarations Struktur ermöglichen die Angabe der Textur Koordinate, die verwendet wird, um die Textur Zuordnung zu suchen.</span><span class="sxs-lookup"><span data-stu-id="f20a2-118">The changes in the declaration structure allow the specification of the texture coordinate used to look up the texture map.</span></span> <span data-ttu-id="f20a2-119">Beispielsweise Stream0, Offset, FLOAT2, Lookup, Verschiebungs \_ Wert.</span><span class="sxs-lookup"><span data-stu-id="f20a2-119">For example, Stream0, Offset, FLOAT2, LOOKUP, Displacement\_value.</span></span> <span data-ttu-id="f20a2-120">Dadurch wird der Mosaik Dienst aufgefordert, den 2D-float-Vektor in stream0 an einem bestimmten Offset als Textur Koordinate zu verwenden, um die Verschiebungs Zuordnung zu suchen und die \_ Verwendungs Semantik der Verschiebungs Werte zuzuordnen.</span><span class="sxs-lookup"><span data-stu-id="f20a2-120">This tells the tessellator to use the 2D float vector in stream0 at a certain offset as a texture coordinate to look up the displacement map and associate the Displacement\_value usage semantic to it.</span></span> <span data-ttu-id="f20a2-121">Die Vertex-Shader-Deklaration enthält eine Zeile ähnlich "{DCL \_ Texture0, v0}", die angibt, dass die Texture0-Semantik dem Register "v0 Input" zugeordnet werden soll.</span><span class="sxs-lookup"><span data-stu-id="f20a2-121">The vertex shader declaration would contain a line similar to {dcl\_texture0, v0} indicating that the texture0 semantic is to be associated with the v0 input register.</span></span> <span data-ttu-id="f20a2-122">Der ersuchte Verschiebungs Wert wird in das Eingabe Register "v0" kopiert.</span><span class="sxs-lookup"><span data-stu-id="f20a2-122">The displacement value looked up is copied into input register v0.</span></span>
-   <span data-ttu-id="f20a2-123">Es gibt eine besondere Art von Verschiebungs Zuordnung, wenn die Textur Zuordnung vorab abgetippt wird.</span><span class="sxs-lookup"><span data-stu-id="f20a2-123">There is a special type of displacement mapping, when the texture map is pre-sampled.</span></span> <span data-ttu-id="f20a2-124">Ein sequenzieller Index generierter Vertices wird als Textur Koordinate für eine Textur Zuordnung verwendet.</span><span class="sxs-lookup"><span data-stu-id="f20a2-124">Sequential index of generated vertices is used as a texture coordinate to a texture map.</span></span> <span data-ttu-id="f20a2-125">Beispiel: 0, 0, (D3DDECLTYPE) 0, D3DDECLMETHOD \_ lookuppresampling, Usage, US-Index.</span><span class="sxs-lookup"><span data-stu-id="f20a2-125">For example, 0,0,(D3DDECLTYPE)0,D3DDECLMETHOD\_LOOKUPPRESAMPLED, Usage, UsageIndex.</span></span>
-   <span data-ttu-id="f20a2-126">Die Ausgabe der Suche ist 4 Gleit Komma Zahlen.</span><span class="sxs-lookup"><span data-stu-id="f20a2-126">The output of the lookup is 4 floats.</span></span>
-   <span data-ttu-id="f20a2-127">Die Verschiebungs Zuordnung wird nur mit N-Patches unterstützt.</span><span class="sxs-lookup"><span data-stu-id="f20a2-127">Displacement mapping is supported only with N-patches.</span></span>
-   <span data-ttu-id="f20a2-128">Treiber müssen D3DDMAPSAMPLER in settexturestagestate ignorieren, wenn Sie keine Verschiebungs Zuordnungen verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="f20a2-128">Drivers need to ignore D3DDMAPSAMPLER in SetTextureStageState if they do not handle displacement maps.</span></span>
-   <span data-ttu-id="f20a2-129">Der D3DTEXF \_ anisotrope-Filter Modus wird nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="f20a2-129">D3DTEXF\_ANISOTROPIC filter mode is not supported.</span></span>
-   <span data-ttu-id="f20a2-130">Wenn D3DSAMP \_ MipFilter im Verschiebungs Karten-Sampler nicht D3DTEXF \_ None ist, wird die Detailebene wie folgt berechnet (Beachten Sie, dass der Adaptive Mosaik Zustand auch dann verwendet wird, wenn D3DRS \_ enableadaptivetesellation **false** ist): TMAX = Rendering State D3DRS \_ maxtmeellationlevel.</span><span class="sxs-lookup"><span data-stu-id="f20a2-130">When D3DSAMP\_MIPFILTER in the displacement map sampler is not D3DTEXF\_NONE, the level of detail is computed as follows (Note that the adaptive tessellation state is used even if the D3DRS\_ENABLEADAPTIVETESSELLATION is **FALSE**): Tmax = render state D3DRS\_MAXTESSELLATIONLEVEL</span></span>
-   <span data-ttu-id="f20a2-131">Compute-Mosaik Ebene für einen Vertex VI: (XI, Yi, Zi) auf die gleiche Weise wie im Abschnitt "Adaptive Mosaik" beschrieben.</span><span class="sxs-lookup"><span data-stu-id="f20a2-131">Compute tessellation level Te for a vertex Vi: (Xi, Yi, Zi) the same way as described in the "Adaptive tessellation" section.</span></span> <span data-ttu-id="f20a2-132">Detailebene L = log2 (TMAX)-log2 (TE).</span><span class="sxs-lookup"><span data-stu-id="f20a2-132">Level of detail L = log2(Tmax) - log2 (Te).</span></span>
-   <span data-ttu-id="f20a2-133">Bei der Textur Filterung und bei Samplings werden die gleichen Regeln befolgt wie für die Pixel Pipeline (detailsgrads (Grad)).</span><span class="sxs-lookup"><span data-stu-id="f20a2-133">Texture filtering and sampling operations follow the same rules as the pixel pipeline (level of detail (LOD) bias is applied, etc.).</span></span>
-   <span data-ttu-id="f20a2-134">Nicht alle Formate können als Verschiebungs Zuordnungen verwendet werden, aber nur diejenigen, die die D3DUSAGE- \_ dmap unterstützen.</span><span class="sxs-lookup"><span data-stu-id="f20a2-134">Not all formats can be used as displacement maps but only those that support the D3DUSAGE\_DMAP.</span></span> <span data-ttu-id="f20a2-135">Die Anwendung kann das CheckDeviceFormat mit CheckDeviceFormat [**Abfragen.**](/windows/win32/api/d3d9/nf-d3d9-idirect3d9-checkdeviceformat)</span><span class="sxs-lookup"><span data-stu-id="f20a2-135">The application can query that with the CheckDeviceFormat [**CheckDeviceFormat**](/windows/win32/api/d3d9/nf-d3d9-idirect3d9-checkdeviceformat).</span></span>
-   <span data-ttu-id="f20a2-136">D3DUSAGE \_ dmap muss in " [**kreatetexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createtexture) " angegeben werden, um den Treiber zu benachrichtigen, dass diese Textur als Verschiebungs Zuordnung verwendet werden soll.</span><span class="sxs-lookup"><span data-stu-id="f20a2-136">D3DUSAGE\_DMAP must be specified in [**CreateTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createtexture) to notify the driver that this texture is to be used as a displacement map.</span></span>
-   <span data-ttu-id="f20a2-137">D3DUSAGE \_ dmap kann nur mit Texturen verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="f20a2-137">D3DUSAGE\_DMAP can only be used with textures.</span></span> <span data-ttu-id="f20a2-138">Sie kann nicht mit Cubemaps oder Volumes verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="f20a2-138">It cannot be used with cube maps or volumes.</span></span>
-   <span data-ttu-id="f20a2-139">Texturen und Renderziele, die mit D3DUSAGE dmap erstellt wurden, \_ können in regulären samplingstufen und als Renderziele festgelegt werden</span><span class="sxs-lookup"><span data-stu-id="f20a2-139">Textures and render targets created with D3DUSAGE\_DMAP can be set at regular sampler stages and as render targets.</span></span>
-   <span data-ttu-id="f20a2-140">Die renderzustände, um den Umbruch Modus für die Texturkoordinaten festzulegen, werden bei der Verschiebungs Zuordnung ignoriert.</span><span class="sxs-lookup"><span data-stu-id="f20a2-140">The render states to set the wrap mode for the texture coordinates are ignored in displacement mapping.</span></span> <span data-ttu-id="f20a2-141">Im Allgemeinen gibt es keine Wrap-Modi für die Mosaik-Engine.</span><span class="sxs-lookup"><span data-stu-id="f20a2-141">In general, there are no wrap modes for the tessellator engine.</span></span>
-   <span data-ttu-id="f20a2-142">Ein Verschiebungs kartensampler weist ein Verhalten auf, das mit dem des Pixel Textur Samplers identisch ist.</span><span class="sxs-lookup"><span data-stu-id="f20a2-142">A displacement map sampler has behavior identical to that of the pixel texture samplers.</span></span> <span data-ttu-id="f20a2-143">Wenn eine Textur mit weniger als vier Kanälen (z. b. R32f) gesucht wird, werden die nach-oben-Werte in den entsprechenden Kanälen des Ziel Registers (dem Vertex-Shader-Eingabe Register, das mit der \_ Beispiel Semantik gekennzeichnet ist) angezeigt, während die anderen Kanäle standardmäßig auf (1, 1, 1) eingestellt sind.</span><span class="sxs-lookup"><span data-stu-id="f20a2-143">If a texture with less than four channels (like R32f) is looked up, the looked-up values go to the appropriate channels of the destination register (the vertex shader input register tagged with the \_sample semantic), while the other channels default to (1, 1, 1).</span></span> <span data-ttu-id="f20a2-144">Bei der Suche wird D3DFMT \_ L8 in die R-, G-, B-Kanäle und standardmäßig auf 1 übertragen.</span><span class="sxs-lookup"><span data-stu-id="f20a2-144">When looked up, D3DFMT\_L8 gets broadcast into the R, G, B channels and A defaults to 1.</span></span> <span data-ttu-id="f20a2-145">Der Verweis Raster verfügt über die vollständigen Implementierungsdetails.</span><span class="sxs-lookup"><span data-stu-id="f20a2-145">The reference rasterizer has the full implementation details.</span></span>

## <a name="pre-sampled-displacement-mapping"></a><span data-ttu-id="f20a2-146">Verschiebungs Zuordnung vor Stichproben</span><span class="sxs-lookup"><span data-stu-id="f20a2-146">Pre-Sampled Displacement Mapping</span></span>

-   <span data-ttu-id="f20a2-147">Der neue samplerstatus wurde eingeführt: D3DSAMP \_ dmapoffset (DWORD)-Offset (in Scheitel Punkten) in einer vorab komprimierten Verschiebungs Zuordnung.</span><span class="sxs-lookup"><span data-stu-id="f20a2-147">New sampler state is introduced: D3DSAMP\_DMAPOFFSET (DWORD) - offset (in vertices) in a pre-sampled displacement map.</span></span>
-   <span data-ttu-id="f20a2-148">Die neue Deklarations Methode wurde eingeführt: D3DDECLMETHOD \_ lookuppresampling.</span><span class="sxs-lookup"><span data-stu-id="f20a2-148">New declaration method is introduced: D3DDECLMETHOD\_LOOKUPPRESAMPLED.</span></span>
-   <span data-ttu-id="f20a2-149">Das Adaptive Mosaik sollte deaktiviert werden.</span><span class="sxs-lookup"><span data-stu-id="f20a2-149">Adaptive tessellation should be disabled.</span></span>
-   <span data-ttu-id="f20a2-150">Textur Filtereinstellungen werden ignoriert.</span><span class="sxs-lookup"><span data-stu-id="f20a2-150">Texture filter settings are ignored.</span></span> <span data-ttu-id="f20a2-151">Die Punkt Stichprobe ist abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="f20a2-151">Point sampling is done.</span></span> <span data-ttu-id="f20a2-152">Es wird angenommen, dass der MIP-Textur Filter D3DTEXF \_ None ist.</span><span class="sxs-lookup"><span data-stu-id="f20a2-152">The mip texture filter is assumed to be D3DTEXF\_NONE.</span></span> <span data-ttu-id="f20a2-153">Alle anderen Textur Filtermodi werden als D3DTEXF Punkt angenommen \_ .</span><span class="sxs-lookup"><span data-stu-id="f20a2-153">All other texture filter modes are assumed to be D3DTEXF\_POINT.</span></span>
-   <span data-ttu-id="f20a2-154">Texturkoordinaten werden wie folgt berechnet: U = (Index% texturewidthinpixeles)/(float) (texturewidthinpixeles) V = (Index/texturewidthinpixeles)/(float) (textureturetinpixeles), wobei Index ein sequenzieller Index generierter Vertices Plus TSS \[ D3DSAMP \_ dmapoffset ist \] .</span><span class="sxs-lookup"><span data-stu-id="f20a2-154">Texture coordinates are computed as: U = (Index % TextureWidthInPixeles) / (float)(TextureWidthInPixeles) V = (Index / TextureWidthInPixeles) / (float)(TextureHeightInPixeles) where Index is a sequential index of generated vertices plus TSS\[D3DSAMP\_DMAPOFFSET\].</span></span> <span data-ttu-id="f20a2-155">Der sequenzielle Index wird am Anfang der einzelnen primitiven auf NULL festgelegt und nach der Generierung eines Scheitel Punkts erweitert.</span><span class="sxs-lookup"><span data-stu-id="f20a2-155">The sequential index is set to zero at the start of each primitive and is increased after a vertex is generated.</span></span>

<span data-ttu-id="f20a2-156">Dies sind die API-Änderungen, die die Verschiebungs Zuordnung unterstützen.</span><span class="sxs-lookup"><span data-stu-id="f20a2-156">These are the API changes that support displacement mapping.</span></span>

-   <span data-ttu-id="f20a2-157">Es wurde ein einzelnes Kanal Format hinzugefügt, D3DFMT \_ L16.</span><span class="sxs-lookup"><span data-stu-id="f20a2-157">A single channel format added, D3DFMT\_L16.</span></span>
-   <span data-ttu-id="f20a2-158">Ein neues nutzungsflag, D3DUSAGE \_ dmap.</span><span class="sxs-lookup"><span data-stu-id="f20a2-158">A new usage flag, D3DUSAGE\_DMAP.</span></span>
-   <span data-ttu-id="f20a2-159">Eine spezielle Textur Phase, mit der eine Verschiebungs Karten Textur, D3DDMAPSAMPLER, festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="f20a2-159">A special texture stage, used to set a displacement map texture, D3DDMAPSAMPLER.</span></span>
-   <span data-ttu-id="f20a2-160">Es wurden neue Hardware Obergrenzen hinzugefügt, D3DDEVCAPS2 \_ dmapnpatch und D3DDEVCAPS2 \_ presampleddmapnpatch.</span><span class="sxs-lookup"><span data-stu-id="f20a2-160">New hardware caps have been added, D3DDEVCAPS2\_DMAPNPATCH and D3DDEVCAPS2\_PRESAMPLEDDMAPNPATCH.</span></span> <span data-ttu-id="f20a2-161">Siehe [D3DDEVCAPS2](d3ddevcaps2.md).</span><span class="sxs-lookup"><span data-stu-id="f20a2-161">See [D3DDEVCAPS2](d3ddevcaps2.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="f20a2-162">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="f20a2-162">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f20a2-163">Scheitelpunkt Pipeline</span><span class="sxs-lookup"><span data-stu-id="f20a2-163">Vertex Pipeline</span></span>](vertex-pipeline.md)
</dt> </dl>

 

 
