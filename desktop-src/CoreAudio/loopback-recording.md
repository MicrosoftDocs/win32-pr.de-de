---
description: Loopback Aufzeichnung
ms.assetid: 71c567f7-fffa-4b75-897a-63ed30c4c9b0
title: Loopback Aufzeichnung
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 374da7497096118905f5e4c79bbacda832a42a7b
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "103958504"
---
# <a name="loopback-recording"></a><span data-ttu-id="a517f-103">Loopback Aufzeichnung</span><span class="sxs-lookup"><span data-stu-id="a517f-103">Loopback Recording</span></span>

<span data-ttu-id="a517f-104">Im Loopback Modus kann ein Client von WASAPI den Audiostream erfassen, der von einem renderingendpunktgerät abgespielt wird.</span><span class="sxs-lookup"><span data-stu-id="a517f-104">In loopback mode, a client of WASAPI can capture the audio stream that is being played by a rendering endpoint device.</span></span> <span data-ttu-id="a517f-105">Um einen Stream im Loopback Modus zu öffnen, muss der Client folgende Aktionen ausführen:</span><span class="sxs-lookup"><span data-stu-id="a517f-105">To open a stream in loopback mode, the client must:</span></span>

-   <span data-ttu-id="a517f-106">Abrufen einer [**immdevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) -Schnittstelle für das renderingendpunktgerät.</span><span class="sxs-lookup"><span data-stu-id="a517f-106">Obtain an [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) interface for the rendering endpoint device.</span></span>
-   <span data-ttu-id="a517f-107">Initialisieren eines Aufzeichnungsdaten Stroms im Loopback Modus auf dem Rendering-Endpunkt Gerät.</span><span class="sxs-lookup"><span data-stu-id="a517f-107">Initialize a capture stream in loopback mode on the rendering endpoint device.</span></span>

<span data-ttu-id="a517f-108">Nachdem Sie diese Schritte ausgeführt haben, kann der Client die [**iaudioclient:: GetService**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-getservice) -Methode aufrufen, um eine [**iaudiocaptureclient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudiocaptureclient) -Schnittstelle auf dem renderingendpunktgerät zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="a517f-108">After following these steps, the client can call the [**IAudioClient::GetService**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-getservice) method to obtain an [**IAudioCaptureClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudiocaptureclient) interface on the rendering endpoint device.</span></span>

<span data-ttu-id="a517f-109">WASAPI bietet den Loopback Modus hauptsächlich zur Unterstützung von akustischem Echo Abbruch (AEC).</span><span class="sxs-lookup"><span data-stu-id="a517f-109">WASAPI provides loopback mode primarily to support acoustic echo cancellation (AEC).</span></span> <span data-ttu-id="a517f-110">Andere Arten von Audioanwendungen können jedoch den Loopback Modus für die Erfassung der System Mischung, die von der Audioengine abgespielt wird, nützlich finden.</span><span class="sxs-lookup"><span data-stu-id="a517f-110">However, other types of audio applications might find loopback mode useful for capturing the system mix that is being played by the audio engine.</span></span>

<span data-ttu-id="a517f-111">Im Codebeispiel zum [Erfassen eines Streams](capturing-a-stream.md)kann die recordaudiostream-Funktion problemlos geändert werden, um einen Aufzeichnungsdaten Strom im Loopback Modus zu konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="a517f-111">In the code example in [Capturing a Stream](capturing-a-stream.md), the RecordAudioStream function can be easily modified to configure a loopback-mode capture stream.</span></span> <span data-ttu-id="a517f-112">Folgende Änderungen sind erforderlich:</span><span class="sxs-lookup"><span data-stu-id="a517f-112">The required modifications are:</span></span>

-   <span data-ttu-id="a517f-113">Ändern Sie im Aufrufen der Methode [**immdeviceenumerator:: getdefaultaudioendpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint) den ersten Parameter (*DataFlow*) von ecapture in.</span><span class="sxs-lookup"><span data-stu-id="a517f-113">In the call to the [**IMMDeviceEnumerator::GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint) method, change the first parameter (*dataFlow*) from eCapture to eRender.</span></span>
-   <span data-ttu-id="a517f-114">Ändern Sie im Aufrufen der [**iaudioclient:: Initialize**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-initialize) -Methode den Wert des zweiten Parameters (*StreamFlags*) von 0 in das audclnt \_ StreamFlags- \_ Loopback.</span><span class="sxs-lookup"><span data-stu-id="a517f-114">In the call to the [**IAudioClient::Initialize**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-initialize) method, change the value of the second parameter (*StreamFlags*) from 0 to AUDCLNT\_STREAMFLAGS\_LOOPBACK.</span></span>

<span data-ttu-id="a517f-115">In Windows-Versionen vor Windows 10 1703 empfängt der Pull-Modus-Erfassungs Client keine Ereignisse, wenn ein Stream mit Ereignis gesteuerter Pufferung initialisiert wird und Loopback aktiviert ist.</span><span class="sxs-lookup"><span data-stu-id="a517f-115">In versions of Windows prior to Windows 10 1703, pull-mode capture client does not receive any events when a stream is initialized with event-driven buffering and is loopback-enabled.</span></span> <span data-ttu-id="a517f-116">Um dieses Problem zu umgehen, initialisieren Sie einen renderingstream im ereignisgesteuerten Modus.</span><span class="sxs-lookup"><span data-stu-id="a517f-116">To work around this, initialize a render stream in event-driven mode.</span></span> <span data-ttu-id="a517f-117">Jedes Mal, wenn der Client ein Ereignis für den RenderStream empfängt, muss er dem Erfassungs Client signalisieren, den Erfassungs Thread auszuführen, der den nächsten Satz von Beispielen aus dem Erfassungs Endpunkt Puffer liest.</span><span class="sxs-lookup"><span data-stu-id="a517f-117">Each time the client receives an event for the render stream, it must signal the capture client to run the capture thread that reads the next set of samples from the capture endpoint buffer.</span></span> <span data-ttu-id="a517f-118">In Windows 10, Version 1703 und höher, werden ereignisgesteuerte Loopback Clients unterstützt und benötigen nicht mehr die Problem Umgehung, die den Rendering-Stream einschließt.</span><span class="sxs-lookup"><span data-stu-id="a517f-118">In Windows 10 versions 1703 and higher, event-driven loopback clients are supported, and no longer need the workaround involving the render stream.</span></span>  

<span data-ttu-id="a517f-119">Ein Client kann den Loopback Modus nur für einen Datenstrom im freigegebenen Modus aktivieren ("audclnt \_ sharemode \_ Shared").</span><span class="sxs-lookup"><span data-stu-id="a517f-119">A client can enable loopback mode only for a shared-mode stream (AUDCLNT\_SHAREMODE\_SHARED).</span></span> <span data-ttu-id="a517f-120">Stream im exklusiven Modus kann nicht im Loopback Modus verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="a517f-120">Exclusive-mode streams cannot operate in loopback mode.</span></span>

<span data-ttu-id="a517f-121">Die Implementierung von Loopback durch WASAPI hängt von den Funktionen der Hardware ab.</span><span class="sxs-lookup"><span data-stu-id="a517f-121">The implementation of loopback by WASAPI depend on the capabilities of the hardware.</span></span> <span data-ttu-id="a517f-122">Wenn die Hardware eine Loopback-PIN auf dem Rendering-Endpunkt unterstützt, verwendet WASAPI die Audiodaten, die in dieser PIN für den Loopback-Stream bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="a517f-122">If the hardware supports a loopback pin on the render endpoint, WASAPI uses the audio provided on this pin for the loopback stream.</span></span> <span data-ttu-id="a517f-123">Wenn die Hardware keine Loopback-Pin unterstützt, kopiert WASAPI den Ausgabedatenstrom aus der Audioengine in den Erfassungs Puffer der Loopback Anwendung, zusätzlich zum Kopieren der Audiodaten in die renderpin der Hardware.</span><span class="sxs-lookup"><span data-stu-id="a517f-123">When the hardware does not support a loopback pin, WASAPI copies the output stream from the audio engine into the loopback application's capture buffer, in addition to copying the audio data to the hardware's render pin.</span></span>

<span data-ttu-id="a517f-124">Einige Hardwarehersteller implementieren in ihren audioadaptern Loopback Geräte (im Gegensatz zur PIN-Instanzen auf rendergeräten).</span><span class="sxs-lookup"><span data-stu-id="a517f-124">Some hardware vendors implement loopback devices (as opposed to pin instances on render devices) in their audio adapters.</span></span> <span data-ttu-id="a517f-125">Obwohl sich Hardware-Loopback-Geräte im Betrieb des WASAPI-Loopback Modus ähneln, können Sie schwieriger zu verwenden sein.</span><span class="sxs-lookup"><span data-stu-id="a517f-125">Although hardware loopback devices are similar in operation to the WASAPI loopback mode, they can be more difficult to use.</span></span>

<span data-ttu-id="a517f-126">Hardware-Loopback Geräte haben folgende Nachteile für Audioanwendungen:</span><span class="sxs-lookup"><span data-stu-id="a517f-126">Hardware loopback devices have the following disadvantages for audio applications:</span></span>

-   <span data-ttu-id="a517f-127">Nicht alle Audioadapter haben Loopback-Geräte.</span><span class="sxs-lookup"><span data-stu-id="a517f-127">Not all audio adapters have loopback devices.</span></span> <span data-ttu-id="a517f-128">Daher können Anwendungen, die von ihnen abhängen, nicht auf allen Systemen ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="a517f-128">Thus, applications that depend on them will not work on all systems.</span></span>
-   <span data-ttu-id="a517f-129">Bevor eine Anwendung von einem Loopback Gerät aufzeichnen kann, muss der Benutzer das Loopback Gerät identifizieren und für die Verwendung aktivieren.</span><span class="sxs-lookup"><span data-stu-id="a517f-129">Before an application can record from a loopback device, the user must identify the loopback device and enable it for use.</span></span>

<span data-ttu-id="a517f-130">Verschiedene Lieferanten weisen den Hardware-Loopback Geräten verschiedene Namen zu.</span><span class="sxs-lookup"><span data-stu-id="a517f-130">Different vendors assign different names to their hardware loopback devices.</span></span> <span data-ttu-id="a517f-131">Die folgenden Namen sind Beispiele:</span><span class="sxs-lookup"><span data-stu-id="a517f-131">The following names are examples:</span></span>

-   <span data-ttu-id="a517f-132">Stereo Mischung</span><span class="sxs-lookup"><span data-stu-id="a517f-132">Stereo Mix</span></span>
-   <span data-ttu-id="a517f-133">Waveout-Mischung</span><span class="sxs-lookup"><span data-stu-id="a517f-133">Waveout Mix</span></span>
-   <span data-ttu-id="a517f-134">Gemischte Ausgabe</span><span class="sxs-lookup"><span data-stu-id="a517f-134">Mixed Output</span></span>
-   <span data-ttu-id="a517f-135">Was Sie hören</span><span class="sxs-lookup"><span data-stu-id="a517f-135">What You Hear</span></span>

<span data-ttu-id="a517f-136">Der Mangel an standardisierten Namen kann dazu führen, dass Benutzer Schwierigkeiten haben, ein Loopback Gerät in einer Liste von Gerätenamen zu identifizieren.</span><span class="sxs-lookup"><span data-stu-id="a517f-136">The lack of standardized names might cause users to have difficulty identifying a loopback device in a list of device names.</span></span>

<span data-ttu-id="a517f-137">Ein Hardware Loopback Gerät ist ein Erfassungsgerät.</span><span class="sxs-lookup"><span data-stu-id="a517f-137">A hardware loopback device is a capture device.</span></span> <span data-ttu-id="a517f-138">Wenn ein Adapter also ein Loopback Gerät unterstützt, kann eine Audioanwendung vom Gerät auf die gleiche Weise aufzeichnen, wie Sie von einem beliebigen anderen Erfassungsgerät aus erfasst wird.</span><span class="sxs-lookup"><span data-stu-id="a517f-138">Thus, if an adapter supports a loopback device, an audio application can record from the device in the same way that it records from any other capture device.</span></span>

<span data-ttu-id="a517f-139">Wenn Sie z. b. ein Hardware-Loopback Gerät als Standard Erfassungsgerät auswählen, können Sie die Funktion recordaudiostream (ohne Änderung) im Codebeispiel zum erfassen [eines Streams](capturing-a-stream.md) verwenden, um den Datenstrom vom Gerät zu erfassen.</span><span class="sxs-lookup"><span data-stu-id="a517f-139">For example, if you select a hardware loopback device to be the default capture device, you can use the RecordAudioStream function (without modification) in the code example in [Capturing a Stream](capturing-a-stream.md) to capture the stream from the device.</span></span> <span data-ttu-id="a517f-140">(Sie können auch eine Legacy-audioapi verwenden, wie z. b. die Windows Multimedia **waveinxxx** -Funktionen, um den Stream vom Gerät zu erfassen.)</span><span class="sxs-lookup"><span data-stu-id="a517f-140">(You can also use a legacy audio API, such as the Windows multimedia **waveInXxx** functions, to capture the stream from the device.)</span></span>

<span data-ttu-id="a517f-141">Wenn Ihr Audioadapter ein Hardware Loopback-Gerät enthält, können Sie die Windows-Multimedia-Systemsteuerung (Mmsys.cpl) verwenden, um das Gerät als Standard Erfassungsgerät festzulegen.</span><span class="sxs-lookup"><span data-stu-id="a517f-141">If your audio adapter contains a hardware loopback device, you can use the Windows multimedia control panel, Mmsys.cpl, to designate the device as the default capture device.</span></span> <span data-ttu-id="a517f-142">Die Schritte lauten wie folgt:</span><span class="sxs-lookup"><span data-stu-id="a517f-142">The steps are as follows:</span></span>

1.  <span data-ttu-id="a517f-143">Öffnen Sie zum Ausführen Mmsys.cpl ein Eingabe Aufforderungs Fenster, und geben Sie den folgenden Befehl ein:</span><span class="sxs-lookup"><span data-stu-id="a517f-143">To run Mmsys.cpl, open a Command Prompt window and enter the following command:</span></span>

    ```C++
    control mmsys.cpl,,1
    ```

    

    <span data-ttu-id="a517f-144">Alternativ dazu können Sie Mmsys.cpl ausführen, indem Sie mit der rechten Maustaste auf das Redner Symbol im Benachrichtigungsbereich klicken, der sich auf der rechten Seite der Taskleiste befindet, und **Geräte aufzeichnen** auswählen.</span><span class="sxs-lookup"><span data-stu-id="a517f-144">Alternatively, you can run Mmsys.cpl by right-clicking the speaker icon in the notification area, which is located on the right side of the taskbar, and selecting **Recording Devices**.</span></span>

2.  <span data-ttu-id="a517f-145">Nachdem das Mmsys.cpl Fenster geöffnet wurde, klicken Sie mit der rechten Maustaste auf eine beliebige Stelle in der Liste der Aufzeichnungsgeräte, und vergewissern Sie sich, dass die Option **deaktivierte Geräte**</span><span class="sxs-lookup"><span data-stu-id="a517f-145">After the Mmsys.cpl window opens, right-click anywhere in the list of recording devices and verify that the **Show Disabled Devices** option is checked.</span></span> <span data-ttu-id="a517f-146">(Andernfalls, wenn das Loopback Gerät deaktiviert ist, wird es nicht in der Liste angezeigt.)</span><span class="sxs-lookup"><span data-stu-id="a517f-146">(Otherwise, if the loopback device is disabled, it will not appear in the list.)</span></span>
3.  <span data-ttu-id="a517f-147">Durchsuchen Sie die Liste der Aufzeichnungsgeräte, um das Loopback Gerät zu finden (sofern vorhanden).</span><span class="sxs-lookup"><span data-stu-id="a517f-147">Browse the list of recording devices to locate the loopback device (if it exists).</span></span> <span data-ttu-id="a517f-148">Wenn das Loopback Gerät deaktiviert ist, aktivieren Sie es, indem Sie mit der rechten Maustaste auf das Gerät klicken und dann auf **aktivieren** klicken.</span><span class="sxs-lookup"><span data-stu-id="a517f-148">If the loopback device is disabled, enable it by right-clicking the device and clicking **Enable**.</span></span>
4.  <span data-ttu-id="a517f-149">Klicken Sie abschließend mit der rechten Maustaste auf das Gerät, und klicken Sie auf **als Standardgerät festlegen**, um das Loopback Gerät als Standard Erfassungsgerät auszuwählen.</span><span class="sxs-lookup"><span data-stu-id="a517f-149">Finally, to select the loopback device to be the default capture device, right-click the device and click **Set as Default Device**.</span></span>

<span data-ttu-id="a517f-150">WASAPI unterstützt Loopback Aufzeichnung, unabhängig davon, ob die Audiohardware ein Loopback Gerät enthält oder ob der Benutzer das Gerät aktiviert hat.</span><span class="sxs-lookup"><span data-stu-id="a517f-150">WASAPI supports loopback recording regardless of whether the audio hardware contains a loopback device, or whether the user has enabled the device.</span></span>

<span data-ttu-id="a517f-151">Windows Vista bietet Digital Rights Management (DRM).</span><span class="sxs-lookup"><span data-stu-id="a517f-151">Windows Vista provides digital rights management (DRM).</span></span> <span data-ttu-id="a517f-152">Inhaltsanbieter verwenden DRM, um proprietäre Musik oder andere Inhalte vor nicht autorisiertem kopieren und anderen unzulässigen Verwendungen zu schützen.</span><span class="sxs-lookup"><span data-stu-id="a517f-152">Content providers rely on DRM to protect their proprietary music or other content from unauthorized copying and other illegal uses.</span></span> <span data-ttu-id="a517f-153">Ebenso lässt ein vertrauenswürdiger Audiotreiber nicht zu, dass ein Loopback Gerät digitale Streams erfasst, die geschützte Inhalte enthalten.</span><span class="sxs-lookup"><span data-stu-id="a517f-153">Similarly, a trusted audio driver does not permit a loopback device to capture digital streams that contain protected content.</span></span> <span data-ttu-id="a517f-154">Mit Windows Vista können nur vertrauenswürdige Treiber geschützte Inhalte wiedergeben.</span><span class="sxs-lookup"><span data-stu-id="a517f-154">Windows Vista allows only trusted drivers to play protected content.</span></span> <span data-ttu-id="a517f-155">Weitere Informationen zu vertrauenswürdigen Treibern und DRM finden Sie in der Windows-DDK-Dokumentation.</span><span class="sxs-lookup"><span data-stu-id="a517f-155">For more information about trusted drivers and DRM, see the Windows DDK documentation.</span></span>

<span data-ttu-id="a517f-156">WASAPI-Loopback enthält die Mischung aus sämtlichen Audiofunktionen, die unabhängig von der Terminal Dienste-Sitzung, von der das Audiomaterial stammt, abgespielt werden.</span><span class="sxs-lookup"><span data-stu-id="a517f-156">WASAPI loopback contains the mix of all audio being played, regardless of the Terminal Services session the audio originated from.</span></span> <span data-ttu-id="a517f-157">Sie können z. b. einen Loopback Client in einem Dienst ausführen, der in Sitzung 0 ausgeführt wird, und Audiodaten aus allen Benutzersitzungen erfassen, sowie Audiodaten, die in Sitzung 0 abgespielt werden.</span><span class="sxs-lookup"><span data-stu-id="a517f-157">For example, you can run a loopback client in a service running in session 0 and capture audio from all user sessions, as well as audio being played from session 0.</span></span>

<span data-ttu-id="a517f-158">Remotedesktop ermöglicht das Umleiten von Audiodaten an den Client.</span><span class="sxs-lookup"><span data-stu-id="a517f-158">Remote Desktop allows redirecting audio to the client.</span></span> <span data-ttu-id="a517f-159">Dies wird durch das Erstellen neuer Audiogeräte implementiert, die nur für diese Sitzung angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="a517f-159">This is implemented by creating new audio devices that only appear for that session.</span></span>

## <a name="related-topics"></a><span data-ttu-id="a517f-160">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="a517f-160">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a517f-161">Datenstrom Verwaltung</span><span class="sxs-lookup"><span data-stu-id="a517f-161">Stream Management</span></span>](stream-management.md)
</dt> </dl>

 

 



