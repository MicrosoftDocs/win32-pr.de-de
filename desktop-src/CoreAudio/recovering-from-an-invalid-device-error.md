---
description: Wiederherstellen nach einem Invalid-Device Fehler
ms.assetid: 1f5c3458-70ca-45ba-ac33-5c7b9f092320
title: Wiederherstellen nach einem Invalid-Device Fehler
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ca20c32be46367f53a14ce26c39f980e3649b652
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "104127421"
---
# <a name="recovering-from-an-invalid-device-error"></a><span data-ttu-id="1e06b-103">Wiederherstellen nach einem Invalid-Device Fehler</span><span class="sxs-lookup"><span data-stu-id="1e06b-103">Recovering from an Invalid-Device Error</span></span>

<span data-ttu-id="1e06b-104">Viele der Methoden in der WASAPI geben Fehlercode "audclnt \_ E \_ Device" ungültig aus \_ , wenn das audioendpunktgerät, das von der Client Anwendung verwendet wird, ungültig wird.</span><span class="sxs-lookup"><span data-stu-id="1e06b-104">Many of the methods in WASAPI return error code AUDCLNT\_E\_DEVICE\_INVALIDATED if the audio endpoint device that the client application is using becomes invalid.</span></span> <span data-ttu-id="1e06b-105">Dieser Fehlercode gibt an, dass das Endpunkt Gerät getrennt wurde oder dass die Audiohardware oder die zugehörigen Hardware Ressourcen neu konfiguriert, deaktiviert, entfernt oder anderweitig zur Verwendung nicht verfügbar gemacht wurden.</span><span class="sxs-lookup"><span data-stu-id="1e06b-105">This error code indicates that the endpoint device has been unplugged, or that the audio hardware or associated hardware resources have been reconfigured, disabled, removed, or otherwise made unavailable for use.</span></span> <span data-ttu-id="1e06b-106">Häufig kann die Anwendung nach diesem Fehler wieder hergestellt werden.</span><span class="sxs-lookup"><span data-stu-id="1e06b-106">Frequently, the application can recover from this error.</span></span>

>[!NOTE]
> <span data-ttu-id="1e06b-107">Informationen zum Wiederherstellen von Fehlern bei ungültigen Geräten bei Verwendung von Spatial Audio APIs (Isac) finden Sie unter wieder [herstellen nach einem Invalid-Device Fehlers (räumlicher Sound)](recovering-from-an-invalid-device-error-spatial-sound.md) .</span><span class="sxs-lookup"><span data-stu-id="1e06b-107">For information on recovering from invalid device errors when using spatial audio APIs (ISAC), see [Recovering from an Invalid-Device Error (Spatial Sound)](recovering-from-an-invalid-device-error-spatial-sound.md)</span></span>

<span data-ttu-id="1e06b-108">Die Strategie, die eine Anwendung für die Wiederherstellung nach einem ungültigen Fehler vom Typ "audclnt E" verwendet, \_ \_ \_ hängt davon ab, welche der folgenden Techniken von der Anwendung zum Auswählen eines audioendpunktgeräts verwendet wird:</span><span class="sxs-lookup"><span data-stu-id="1e06b-108">The strategy that an application should use to recover from an AUDCLNT\_E\_DEVICE\_INVALIDATED error depends on which of the following techniques the application uses to select an audio endpoint device:</span></span>

-   <span data-ttu-id="1e06b-109">Wählen Sie immer das standardmäßige audiorendering oder das Erfassungsgerät aus.</span><span class="sxs-lookup"><span data-stu-id="1e06b-109">Always select the default audio rendering or capture device.</span></span>
-   <span data-ttu-id="1e06b-110">Wählen Sie ein bestimmtes audioendpunktgerät aus.</span><span class="sxs-lookup"><span data-stu-id="1e06b-110">Select a specific audio endpoint device.</span></span>

<span data-ttu-id="1e06b-111">Im letzteren Fall wählt die Anwendung automatisch ein bestimmtes Gerät basierend auf den internen Anforderungen aus oder ermöglicht dem Benutzer, ein Gerät explizit aus einer Liste der verfügbaren Geräte auszuwählen.</span><span class="sxs-lookup"><span data-stu-id="1e06b-111">In the latter case, either the application automatically selects a specific device based on internal requirements or it allows the user to explicitly select a device from a list of available devices.</span></span>

<span data-ttu-id="1e06b-112">Eine Anwendung, die das Standardgerät verwendet, kann versuchen, einen Fehler mit ungültigen Fehlern von "audclnt \_ E \_ Device" \_ wie folgt wiederherzustellen:</span><span class="sxs-lookup"><span data-stu-id="1e06b-112">An application that uses the default device can attempt to recover from an AUDCLNT\_E\_DEVICE\_INVALIDATED error as follows:</span></span>

1.  <span data-ttu-id="1e06b-113">Geben Sie die [**iaudioclient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) -Schnittstelle und alle anderen WASAPI-Schnittstellen frei, die Sie auf dem Gerät erworben haben.</span><span class="sxs-lookup"><span data-stu-id="1e06b-113">Release the [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) interface and any other WASAPI interfaces that it has acquired on the device.</span></span>
2.  <span data-ttu-id="1e06b-114">Aufrufen der [**immdeviceenumerator:: getdefaultaudioendpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint) -Methode, um das aktuelle Standardaudiogerät zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="1e06b-114">Call the [**IMMDeviceEnumerator::GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint) method to get the current default audio device.</span></span>
3.  <span data-ttu-id="1e06b-115">Versuchen Sie, [**iaudioclient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) auf dem Standardaudiogerät zu aktivieren.</span><span class="sxs-lookup"><span data-stu-id="1e06b-115">Attempt to activate [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) on the default audio device.</span></span>

<span data-ttu-id="1e06b-116">Wenn Sie die obigen Schritte ausführen, reagiert die Anwendung in der Regel entsprechend, unabhängig von der Ursache des \_ \_ \_ ungültigen Fehlers "audclnt E Device".</span><span class="sxs-lookup"><span data-stu-id="1e06b-116">By following the preceding steps, the application tends to respond appropriately regardless of the cause of the AUDCLNT\_E\_DEVICE\_INVALIDATED error.</span></span> <span data-ttu-id="1e06b-117">Wenn die Neukonfiguration des Standard Geräts den Fehler verursacht hat (z. b. wenn der Benutzer das vom Gerät verwendete Streamformat geändert hat), können diese Schritte, wenn Sie erfolgreich ausgeführt werden, es der Anwendung ermöglichen, das gleiche Gerät weiterhin zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="1e06b-117">If reconfiguration of the default device caused the error (for example, if the user changed the stream format used by the device), then these steps, if they succeed, enable the application to continue to use the same device.</span></span> <span data-ttu-id="1e06b-118">Wenn der Benutzer das Gerät, das von der Anwendung verwendet wurde, deaktiviert oder entfernt hat und ein anderes Gerät zur Annahme der Rolle des Standard Geräts verfügbar ist, kann die Anwendung mit dem neuen Standardgerät fortgesetzt werden.</span><span class="sxs-lookup"><span data-stu-id="1e06b-118">If the user disabled or removed the device that the application was using and another device is available to assume the role of default device, then the application can continue by using the new default device.</span></span> <span data-ttu-id="1e06b-119">In beiden Fällen wird die Anwendung automatisch angepasst, ohne dass ein Eingreifen des Benutzers erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="1e06b-119">In either case, the application adapts automatically without requiring intervention by the user.</span></span>

<span data-ttu-id="1e06b-120">Eine Anwendung, die ein bestimmtes Gerät auswählt, kann versuchen, eine Wiederherstellung mit einem \_ \_ ungültigen Fehler des Typs "audclnt E" durchführen \_ :</span><span class="sxs-lookup"><span data-stu-id="1e06b-120">An application that selects a specific device can attempt to recover from the AUDCLNT\_E\_DEVICE\_INVALIDATED error as follows:</span></span>

1.  <span data-ttu-id="1e06b-121">Geben Sie die [**iaudioclient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) -Schnittstelle und alle anderen WASAPI-Schnittstellen frei, die Sie auf dem Gerät erworben haben.</span><span class="sxs-lookup"><span data-stu-id="1e06b-121">Release the [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) interface and any other WASAPI interfaces that it has acquired on the device.</span></span>
2.  <span data-ttu-id="1e06b-122">Versuchen Sie, eine [**iaudioclient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) -Schnittstelle auf demselben Gerät zu aktivieren.</span><span class="sxs-lookup"><span data-stu-id="1e06b-122">Attempt to activate an [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) interface on the same device.</span></span>
3.  <span data-ttu-id="1e06b-123">Wenn Schritt 2 fehlschlägt, kann die Anwendung als Option den Benutzer auffordern, ein anderes Gerät auszuwählen.</span><span class="sxs-lookup"><span data-stu-id="1e06b-123">If step 2 fails, then the application can, as an option, prompt the user to select another device.</span></span>

<span data-ttu-id="1e06b-124">Schritt 2 kann erfolgreich ausgeführt werden, wenn das Gerät, das von der Anwendung verwendet wird, neu konfiguriert, aber nicht deaktiviert oder entfernt wurde.</span><span class="sxs-lookup"><span data-stu-id="1e06b-124">Step 2 can succeed if the device being used by the application was reconfigured but not disabled or removed.</span></span> <span data-ttu-id="1e06b-125">Bei erfolgreicher Ausführung ermöglicht Schritt 2 der Anwendung, das gleiche Gerät automatisch weiter zu verwenden, ohne dass ein Eingreifen des Benutzers erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="1e06b-125">If successful, step 2 enables the application to automatically continue to use the same device without requiring intervention by the user.</span></span> <span data-ttu-id="1e06b-126">Schritt 3 ist geeignet, wenn die Anwendung es dem Benutzer ermöglicht, ein anderes Gerät explizit auszuwählen, nachdem der Benutzer das zuvor verwendete Gerät deaktiviert oder entfernt hat.</span><span class="sxs-lookup"><span data-stu-id="1e06b-126">Step 3 is appropriate if the application allows the user to explicitly select another device after the user has disabled or removed the previously used device.</span></span>

<span data-ttu-id="1e06b-127">Eine Anwendung kann die Ursache eines ungültigen Geräte Fehlers genauer ermitteln, indem registriert wird, um eine Benachrichtigung zu erhalten, wenn eine Sitzung die Verbindung zu einem Gerät verliert.</span><span class="sxs-lookup"><span data-stu-id="1e06b-127">An application can determine more precisely the cause of an invalid-device error by registering to receive a notification when a session loses its connection to a device.</span></span> <span data-ttu-id="1e06b-128">Um diese Benachrichtigung zu aktivieren, implementiert die Anwendung eine [**iaudiosessionevents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) -Schnittstelle und ruft die [**iaudiosessioncontrol:: registeraudiosessionnotification**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessioncontrol-registeraudiosessionnotification) -Methode auf, um die Schnittstelle zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="1e06b-128">To enable this notification, the application implements an [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) interface and calls the [**IAudioSessionControl::RegisterAudioSessionNotification**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessioncontrol-registeraudiosessionnotification) method to register the interface.</span></span> <span data-ttu-id="1e06b-129">Wenn ein ungültiger Gerätefehler bewirkt, dass die Sitzung getrennt wird, ruft WASAPI die [**iaudiosessionevents:: onsessiongetrennte**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected) -Methode in der registrierten Schnittstelle auf.</span><span class="sxs-lookup"><span data-stu-id="1e06b-129">When an invalid-device error causes the session to be disconnected, WASAPI calls the [**IAudioSessionEvents::OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected) method in the registered interface.</span></span> <span data-ttu-id="1e06b-130">Über diese Methode informiert WASAPI die Anwendung über den Grund für die Trennung der Verbindung.</span><span class="sxs-lookup"><span data-stu-id="1e06b-130">Through this method, WASAPI informs the application of the reason for the disconnection.</span></span> <span data-ttu-id="1e06b-131">In Windows Vista identifiziert der **onsessiongetrennte** -Befehl die folgenden Gründe:</span><span class="sxs-lookup"><span data-stu-id="1e06b-131">In Windows Vista, the **OnSessionDisconnected** call identifies the following reasons:</span></span>

-   <span data-ttu-id="1e06b-132">Der Benutzer hat das audioendpunktgerät entfernt.</span><span class="sxs-lookup"><span data-stu-id="1e06b-132">The user removed the audio endpoint device.</span></span>
-   <span data-ttu-id="1e06b-133">Der Windows-Audiodienst wurde heruntergefahren.</span><span class="sxs-lookup"><span data-stu-id="1e06b-133">The Windows audio service has shut down.</span></span>
-   <span data-ttu-id="1e06b-134">Das bevorzugte Streamformat wurde für das Gerät geändert, mit dem die Audiositzung verbunden ist.</span><span class="sxs-lookup"><span data-stu-id="1e06b-134">The preferred stream format changed for the device that the audio session is connected to.</span></span>
-   <span data-ttu-id="1e06b-135">Der Benutzer hat die Sitzung der Windows-Terminal Dienste (WTS) protokolliert, in der die Audiositzung ausgeführt wurde.</span><span class="sxs-lookup"><span data-stu-id="1e06b-135">The user logged off the Windows Terminal Services (WTS) session that the audio session was running in.</span></span> <span data-ttu-id="1e06b-136">Weitere Informationen zu WTS-Sitzungen finden Sie in der Windows SDK-Dokumentation.</span><span class="sxs-lookup"><span data-stu-id="1e06b-136">For more information about WTS sessions, see the Windows SDK documentation.</span></span>
-   <span data-ttu-id="1e06b-137">Die WTS-Sitzung, in der die Audiositzung ausgeführt wurde, wurde getrennt.</span><span class="sxs-lookup"><span data-stu-id="1e06b-137">The WTS session that the audio session was running in was disconnected.</span></span>
-   <span data-ttu-id="1e06b-138">Die (Shared-Mode)-Audiositzung wurde getrennt, um das audioendpunktgerät für eine Verbindung im exklusiven Modus verfügbar zu machen.</span><span class="sxs-lookup"><span data-stu-id="1e06b-138">The (shared-mode) audio session was disconnected to make the audio endpoint device available for an exclusive-mode connection.</span></span>

<span data-ttu-id="1e06b-139">Als Reaktion auf das Ereignis zum Trennen der Verbindung schließt WASAPI alle Streams, die zur Sitzung gehören.</span><span class="sxs-lookup"><span data-stu-id="1e06b-139">In response to the disconnection event, WASAPI closes all of the streams that belong to the session.</span></span> <span data-ttu-id="1e06b-140">Wenn eine Anwendung anschließend versucht, über eine WASAPI-Methode wie [**iaudioclient:: getcurrentpadding**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-getcurrentpadding)auf einen geschlossenen Datenstrom zuzugreifen, schlägt die Methode fehl und gibt den Fehlercode "audclnt \_ E \_ Device \_ invalidiert" zurück.</span><span class="sxs-lookup"><span data-stu-id="1e06b-140">If an application subsequently attempts to access a closed stream through a WASAPI method such as [**IAudioClient::GetCurrentPadding**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-getcurrentpadding), then the method fails and returns error code AUDCLNT\_E\_DEVICE\_INVALIDATED.</span></span>

<span data-ttu-id="1e06b-141">Ein zusätzlicher Vorteil beim Empfang von Benachrichtigungen über die [**iaudiosessionevents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) -Schnittstelle besteht darin, dass die Benachrichtigungen asynchron eintreffen.</span><span class="sxs-lookup"><span data-stu-id="1e06b-141">An additional benefit to receiving notifications through the [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) interface is that the notifications arrive asynchronously.</span></span> <span data-ttu-id="1e06b-142">Folglich erhält die Anwendung auch dann, wenn der Stream nicht ausgeführt wird, eine rechtzeitige Benachrichtigung über Fehler aufgrund ungültiger Geräte, die die Ausführung des Streams verhindern können.</span><span class="sxs-lookup"><span data-stu-id="1e06b-142">Thus, even when the stream is not running, the application will still receive timely notification of invalid-device errors that can prevent the stream from running.</span></span>

## <a name="related-topics"></a><span data-ttu-id="1e06b-143">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="1e06b-143">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="1e06b-144">Datenstrom Verwaltung</span><span class="sxs-lookup"><span data-stu-id="1e06b-144">Stream Management</span></span>](stream-management.md)
</dt> </dl>

 

 



