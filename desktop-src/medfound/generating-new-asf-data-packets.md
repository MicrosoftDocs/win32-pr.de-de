---
description: Erstellen neuer ASF-Datenpakete
ms.assetid: 7afa9694-c965-40e2-8549-e32ff48def2a
title: Erstellen neuer ASF-Datenpakete
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 78f3432ecf34c58247a1533adb202b75f59d770c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "104484070"
---
# <a name="generating-new-asf-data-packets"></a><span data-ttu-id="b01c9-103">Erstellen neuer ASF-Datenpakete</span><span class="sxs-lookup"><span data-stu-id="b01c9-103">Generating New ASF Data Packets</span></span>

<span data-ttu-id="b01c9-104">Der ASF *Multiplexer* ist eine wmcontainer-Ebenenkomponente, die mit dem [ASF-Datenobjekt](asf-file-structure.md) zusammenarbeitet und einer Anwendung die Möglichkeit bietet, für einen Stream, der den im ContentInfo-Objekt definierten Anforderungen entspricht, ASF-Datenpakete zu generieren.</span><span class="sxs-lookup"><span data-stu-id="b01c9-104">The ASF *multiplexer* is a WMContainer layer component that works with the [ASF Data Object](asf-file-structure.md) and gives an application the ability to generate ASF data packets for a stream that match the requirements defined in the ContentInfo object.</span></span>

<span data-ttu-id="b01c9-105">Der Multiplexer verfügt über eine Eingabe und eine Ausgabe.</span><span class="sxs-lookup"><span data-stu-id="b01c9-105">The multiplexer has one input and one output.</span></span> <span data-ttu-id="b01c9-106">Er empfängt ein streambeispiel, das digitale Mediendaten enthält, und erstellt ein oder mehrere Datenpakete, die in einen ASF-Container geschrieben werden können.</span><span class="sxs-lookup"><span data-stu-id="b01c9-106">It receives a stream sample that contains digital media data and produces one or more data packet that can be written to an ASF container.</span></span>

<span data-ttu-id="b01c9-107">In der folgenden Liste wird der Vorgang zum Erstellen von ASF-Datenpaketen zusammengefasst:</span><span class="sxs-lookup"><span data-stu-id="b01c9-107">The following list summarizes the process of generating ASF data packets:</span></span>

1.  <span data-ttu-id="b01c9-108">Übergeben von Eingabedaten an den Multiplexer in [**imfasfmultiplexer::P rocesssample**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-processsample).</span><span class="sxs-lookup"><span data-stu-id="b01c9-108">Pass input data to the multiplexer in [**IMFASFMultiplexer::ProcessSample**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-processsample).</span></span>
2.  <span data-ttu-id="b01c9-109">Erfassen Sie die Datenpakete, indem Sie [**imfasfmultiplexer:: getnextpacket**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-getnextpacket) in einer Schleife aufrufen, bis alle vollständigen Pakete abgerufen wurden.</span><span class="sxs-lookup"><span data-stu-id="b01c9-109">Collect the data packets by calling [**IMFASFMultiplexer::GetNextPacket**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-getnextpacket) in a loop until all the complete packets have been retrieved.</span></span>
3.  <span data-ttu-id="b01c9-110">Nachdem die Eingabedaten in komplette Pakete konvertiert wurden, sind möglicherweise einige ausstehende Daten im Multiplexer vorhanden, die nicht von [**getnextpacket**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-getnextpacket)abgerufen wurden.</span><span class="sxs-lookup"><span data-stu-id="b01c9-110">After the input data has been converted into complete packets there might be some pending data in the multiplexer, which was not retrieved by [**GetNextPacket**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-getnextpacket).</span></span> <span data-ttu-id="b01c9-111">Rufen Sie [**imfasfmultiplexer:: Flush**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-flush) auf, um die ausstehenden Beispiele zu packeonieren, und erfassen Sie diese aus dem Multiplexer, indem Sie **getnextpacket** erneut aufrufen.</span><span class="sxs-lookup"><span data-stu-id="b01c9-111">Call [**IMFASFMultiplexer::Flush**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-flush) to packetize the pending samples and collect them from the multiplexer by calling **GetNextPacket** again.</span></span>
4.  <span data-ttu-id="b01c9-112">Aktualisieren Sie die zugeordneten ASF-Header Objekte durch Aufrufen von [**imfasfmultiplexer:: End**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-end) , um Änderungen widerzuspiegeln, die von Multiplexer während der Generierung von Datenpaketen vorgenommen wurden</span><span class="sxs-lookup"><span data-stu-id="b01c9-112">Update the associated ASF Header Objects by calling [**IMFASFMultiplexer::End**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-end) to reflect changes made by the multiplexer during data packet generation.</span></span>

<span data-ttu-id="b01c9-113">Das folgende Diagramm veranschaulicht die Generierung von Datenpaketen für eine ASF-Datei über den Multiplexer.</span><span class="sxs-lookup"><span data-stu-id="b01c9-113">The following diagram illustrates data packet generation for an ASF file through the multiplexer.</span></span>

![Diagramm, das die Generierung von Datenpaketen für eine ASF-Datei anzeigt](images/packet.gif)

## <a name="asf-data-packet-creation"></a><span data-ttu-id="b01c9-115">Erstellung des ASF-Datenpakets</span><span class="sxs-lookup"><span data-stu-id="b01c9-115">ASF Data Packet Creation</span></span>

<span data-ttu-id="b01c9-116">Nachdem Sie den Multiplexer erstellt und initialisiert haben, wie unter [Erstellen des Multiplexer-Objekts](creating-the-multiplexer-object.md)beschrieben, nennen Sie [**imfasfmultiplexer::P rocesssample**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-processsample) , um Eingabedaten für die Verarbeitung in Datenpakete an den Multiplexer zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="b01c9-116">After creating and initializing the multiplexer as described in [Creating the Multiplexer Object](creating-the-multiplexer-object.md), call [**IMFASFMultiplexer::ProcessSample**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-processsample) to pass input data to the multiplexer for processing into data packets.</span></span> <span data-ttu-id="b01c9-117">Die angegebene Eingabe muss ein Medien Beispiel ([**imfsample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) -Schnittstelle) sein, das einen oder mehrere Medien Puffer ([**imfmediabuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediabuffer) -Schnittstelle) enthalten kann, die die Daten für einen Stream enthalten.</span><span class="sxs-lookup"><span data-stu-id="b01c9-117">The specified input must be in a media sample ([**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) interface) that can have one or more media buffers ([**IMFMediaBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediabuffer) interface) containing the data for a stream.</span></span> <span data-ttu-id="b01c9-118">Im Fall einer ASF-zu-ASF-Transcodierung kann das Eingabemedien Beispiel aus dem Splitter generiert werden, der packesierte streambeispiele erstellt.</span><span class="sxs-lookup"><span data-stu-id="b01c9-118">In case of ASF-to-ASF transcoding, the input media sample can be generated from the splitter that creates packetized stream samples.</span></span> <span data-ttu-id="b01c9-119">Weitere Informationen finden Sie unter [ASF-Splitter](asf-splitter.md).</span><span class="sxs-lookup"><span data-stu-id="b01c9-119">For more information, see [ASF Splitter](asf-splitter.md).</span></span>

<span data-ttu-id="b01c9-120">Stellen Sie vor dem Aufrufen von [**processsample**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-processsample)sicher, dass der Zeitstempel des Eingabemedien Beispiels eine gültige Präsentationszeit ist. Andernfalls schlägt " **processsample** " fehl und gibt den "MF \_ E \_ No Sample"- \_ \_ Zeitstempel Code zurück.</span><span class="sxs-lookup"><span data-stu-id="b01c9-120">Before calling [**ProcessSample**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-processsample), make sure that the time stamp of the input media sample is a valid presentation time; otherwise **ProcessSample** fails and returns the MF\_E\_NO\_SAMPLE\_TIMESTAMP code.</span></span>

<span data-ttu-id="b01c9-121">Der Multiplexer kann Eingaben als komprimierte oder nicht komprimierte Medien Beispiele über [**processsample**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-processsample)akzeptieren.</span><span class="sxs-lookup"><span data-stu-id="b01c9-121">The multiplexer can accept input as compressed or uncompressed media samples through [**ProcessSample**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-processsample).</span></span> <span data-ttu-id="b01c9-122">Der Multiplexer weist diesen Beispielen abhängig von der Bandbreitennutzung des Streams Sendezeiten zu.</span><span class="sxs-lookup"><span data-stu-id="b01c9-122">The multiplexer assigns send times to these samples depending on the bandwidth usage of the stream.</span></span> <span data-ttu-id="b01c9-123">Während dieses Vorgangs überprüft der Multiplexer die Parameter für den Leaky-Bucket (Bitrate und Puffer Fenster Verwendung) und kann Beispiele ablehnen, die diese Werte nicht einhalten.</span><span class="sxs-lookup"><span data-stu-id="b01c9-123">During this process, the multiplexer checks the leaky bucket parameters (bit rate and buffer window utilization) and can reject samples that do not adhere to those values.</span></span> <span data-ttu-id="b01c9-124">Bei der Bandbreiten Prüfung kann für das Eingabemedien Beispiel aus einem der folgenden Gründe ein Fehler auftreten:</span><span class="sxs-lookup"><span data-stu-id="b01c9-124">The input media sample can fail the bandwidth check for either of the following reasons:</span></span>

-   <span data-ttu-id="b01c9-125">Wenn das Beispiel für ein Eingabe Medium zu spät eingetroffen ist, weil die zuletzt zugewiesene Sendezeit größer ist als der Zeitstempel in diesem Medien Beispiel.</span><span class="sxs-lookup"><span data-stu-id="b01c9-125">If the input media sample arrived late because the last-assigned send time is greater than the time stamp on this media sample.</span></span> <span data-ttu-id="b01c9-126">[**Processsample**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-processsample) schlägt fehl und gibt den Fehlercode für das **MF- \_ E- \_ Ende \_** zurück.</span><span class="sxs-lookup"><span data-stu-id="b01c9-126">[**ProcessSample**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-processsample) fails and returns the **MF\_E\_LATE\_SAMPLE** error code.</span></span>
-   <span data-ttu-id="b01c9-127">, Wenn der Zeitstempel für das Eingabemedien Beispiel vor der zugewiesenen Sendezeit liegt (Dies deutet auf einen Pufferüberlauf hin).</span><span class="sxs-lookup"><span data-stu-id="b01c9-127">If the time stamp on the input media sample is earlier than the assigned send time (this indicates buffer overflow).</span></span> <span data-ttu-id="b01c9-128">Der Multiplexer kann diese Situation ignorieren, wenn er zur Anpassung der Bitrate konfiguriert ist, indem er während der Multiplexer-Initialisierung das Flag für die **\_ \_ Automatische Anpassung \_ von mfasf Multiplexer** festlegt.</span><span class="sxs-lookup"><span data-stu-id="b01c9-128">The multiplexer can ignore this situation if it is configured to adjust the bit rate by setting the **MFASF\_MULTIPLEXER\_AUTOADJUST\_BITRATE** flag during multiplexer initialization.</span></span> <span data-ttu-id="b01c9-129">Weitere Informationen finden Sie unter "Multiplexer-Initialisierung und undichte Bucket-Einstellungen" unter [Erstellen des Multiplexer-Objekts](creating-the-multiplexer-object.md).</span><span class="sxs-lookup"><span data-stu-id="b01c9-129">For more information, see "Multiplexer Initialization and Leaky Bucket Settings" in [Creating the Multiplexer Object](creating-the-multiplexer-object.md).</span></span> <span data-ttu-id="b01c9-130">Wenn dieses Flag nicht festgelegt ist und der Multiplexer einen Bandbreiten Überlauf feststellt, schlägt [**processsample**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-processsample) fehl und gibt den Fehlercode für die **MF-E- \_ \_ Bandbreite \_** zurück.</span><span class="sxs-lookup"><span data-stu-id="b01c9-130">If this flag is not set and the multiplexer encounters bandwidth overrun, [**ProcessSample**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-processsample) fails and returns the **MF\_E\_BANDWIDTH\_OVERRUN** error code.</span></span>

<span data-ttu-id="b01c9-131">Nachdem der Multiplexer die Sendezeit zugewiesen hat, wird das Beispiel für Eingabemedien dem *Sendefenster* hinzugefügt – eine Liste mit Eingabemedien Beispielen, geordnet nach Sendezeiten und bereit für die Verarbeitung in Datenpakete.</span><span class="sxs-lookup"><span data-stu-id="b01c9-131">After the multiplexer assigns the send time, the input media sample is added to the *send window*—a list of input media samples ordered by send times and ready to be processed into data packets.</span></span> <span data-ttu-id="b01c9-132">Während der Datenpaket Erstellung wird das Beispiel für Eingabemedien analysiert, und relevante Daten werden als Nutzlast in ein Datenpaket geschrieben.</span><span class="sxs-lookup"><span data-stu-id="b01c9-132">During data packet construction, the input media sample is parsed and relevant data is written to a data packet as payload.</span></span> <span data-ttu-id="b01c9-133">Ein umfassendes Datenpaket kann Daten aus einem oder mehreren Eingabemedien Beispielen enthalten.</span><span class="sxs-lookup"><span data-stu-id="b01c9-133">A complete data packet can contain data from one or more input media samples.</span></span>

<span data-ttu-id="b01c9-134">Wenn neue Eingabemedien Beispiele im Sendefenster eintreffen, werden Sie zu einer Warteschlange hinzugefügt, bis ausreichend Medien Beispiele vorhanden sind, um ein umfassendes Paket zu bilden.</span><span class="sxs-lookup"><span data-stu-id="b01c9-134">When new input media samples arrive in the send window, they are added to a queue until there are enough media samples to form one complete packet.</span></span> <span data-ttu-id="b01c9-135">Die Daten in Medien Puffern, die im Eingabemedien Beispiel enthalten sind, werden nicht in das generierte Datenpaket kopiert.</span><span class="sxs-lookup"><span data-stu-id="b01c9-135">The data in media buffers contained by the input media sample are not copied to the generated data packet.</span></span> <span data-ttu-id="b01c9-136">Das Datenpaket enthält Verweise auf die Eingabemedien Puffer, bis das Eingabemedien Beispiel vollständig verpackt wurde und das vollständige Paket vom Multiplexer gesammelt wurde.</span><span class="sxs-lookup"><span data-stu-id="b01c9-136">The data packet hold references to the input media buffers until the input media sample has been fully packetized and the complete packet have been collected from the multiplexer.</span></span>

<span data-ttu-id="b01c9-137">Wenn ein umfassendes Datenpaket verfügbar ist, kann es durch Aufrufen von [**imfasfmultiplexer:: getnextpacket**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-getnextpacket)abgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="b01c9-137">When a complete data packet is available, it can be retrieved by calling [**IMFASFMultiplexer::GetNextPacket**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-getnextpacket).</span></span> <span data-ttu-id="b01c9-138">Wenn Sie [**processsample**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-processsample) aufrufen, während fertige Pakete zum Abrufen bereit sind, tritt ein Fehler auf, und es wird der Fehlercode " **MF \_ E \_ notannahme** " zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="b01c9-138">If you call [**ProcessSample**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-processsample) while there are complete packets ready for retrieval, it fails and returns the **MF\_E\_NOTACCEPTING** error code.</span></span> <span data-ttu-id="b01c9-139">Dies deutet darauf hin, dass der Multiplexer nicht mehr Eingaben akzeptieren kann, und Sie müssen **getnextpacket** aufrufen, um die wartenden Pakete abzurufen.</span><span class="sxs-lookup"><span data-stu-id="b01c9-139">This indicates that the multiplexer cannot accept more input and you must call **GetNextPacket** to retrieve the waiting packets.</span></span> <span data-ttu-id="b01c9-140">Im Idealfall sollte jedem **processsample** -Aufruf mindestens ein **getnextpacket** -Aufruf folgen, um die gesamten Datenpakete abzurufen.</span><span class="sxs-lookup"><span data-stu-id="b01c9-140">Ideally, every **ProcessSample** call should be followed by one or more **GetNextPacket** calls to get the complete data packets.</span></span> <span data-ttu-id="b01c9-141">Es kann mehr als ein Eingabemedien Beispiel dauern, um ein umfassendes Datenpaket zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="b01c9-141">It may take more than one input media sample to create a complete data packet.</span></span> <span data-ttu-id="b01c9-142">Im Gegensatz dazu können Daten in einem Eingabemedien Beispiel mehrere Pakete umfassen.</span><span class="sxs-lookup"><span data-stu-id="b01c9-142">Conversely, data in one input media sample might span multiple packets.</span></span> <span data-ttu-id="b01c9-143">Daher ergeben nicht alle Aufrufe von **processsample** Ausgabemedien Beispiele.</span><span class="sxs-lookup"><span data-stu-id="b01c9-143">Therefore, not all calls to **ProcessSample** will yield output media samples.</span></span>

<span data-ttu-id="b01c9-144">Wenn das Eingabemedien Beispiel einen Keyframe enthält, der durch das [**\_ Cleanpoint-Attribut "mfsampleextension**](mfsampleextension-cleanpoint-attribute.md) " angegeben wird, kopiert der Multiplexer das Attribut in das Paket.</span><span class="sxs-lookup"><span data-stu-id="b01c9-144">If the input media sample contains a key frame indicated by the [**MFSampleExtension\_CleanPoint**](mfsampleextension-cleanpoint-attribute.md) attribute, the multiplexer copies the attribute to the packet.</span></span>

## <a name="getting-asf-data-packets"></a><span data-ttu-id="b01c9-145">Erhalten von ASF-Datenpaketen</span><span class="sxs-lookup"><span data-stu-id="b01c9-145">Getting ASF Data Packets</span></span>

<span data-ttu-id="b01c9-146">Um die Ausgabemedien Beispiele für ein vom Multiplexer generiertes, vom Multiplexer generiertes Datenpaket zu erfassen, müssen Sie [**imfasfmultiplexer:: getnextpacket**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-getnextpacket) in einer Schleife aufrufen, bis keine weiteren Ausgabemedien Beispiele für das Paket vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="b01c9-146">To collect the output media samples for a complete data packet generated by the multiplexer, call [**IMFASFMultiplexer::GetNextPacket**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-getnextpacket) in a loop until there are no more output media samples left for the packet.</span></span> <span data-ttu-id="b01c9-147">In der folgenden Liste sind die Erfolgsfälle aufgeführt:</span><span class="sxs-lookup"><span data-stu-id="b01c9-147">The following lists the success cases:</span></span>

-   <span data-ttu-id="b01c9-148">Wenn ein vollständiges Datenpaket verfügbar ist, empfängt [**getnextpacket**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-getnextpacket) im *pdwstatusflags* -Parameter das Flag " **ASF-Status Kennzeichen \_ \_ \_ unvollständig** ". der *ppipacket* -Parameter empfängt einen Zeiger auf das erste Datenpaket.</span><span class="sxs-lookup"><span data-stu-id="b01c9-148">If there is a complete data packet available, [**GetNextPacket**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-getnextpacket) receives the **ASF\_STATUS\_FLAGS\_INCOMPLETE** flag in the *pdwStatusFlags* parameter; the *ppIPacket* parameter receives a pointer to the first data packet.</span></span> <span data-ttu-id="b01c9-149">Diese Methode muss aufgerufen werden, solange Sie dieses Flag empfängt.</span><span class="sxs-lookup"><span data-stu-id="b01c9-149">You must call this method as long it receives this flag.</span></span> <span data-ttu-id="b01c9-150">Bei jeder iterierung verweist *ppipacket* auf das nächste Paket in der Warteschlange.</span><span class="sxs-lookup"><span data-stu-id="b01c9-150">With every iteration, *ppIPacket* points to the next packet in the queue.</span></span>
-   <span data-ttu-id="b01c9-151">Wenn nur ein Datenpaket vorhanden ist, verweist *ppipacket* darauf, und das Flag für das **unvollständige ASF- \_ Statusflags \_ \_** wird in *pdwstatusflags* nicht empfangen.</span><span class="sxs-lookup"><span data-stu-id="b01c9-151">If there is only one data packet, *ppIPacket* points to it and the **ASF\_STATUS\_FLAGS\_INCOMPLETE** flag is not received in *pdwStatusFlags*.</span></span>
-   <span data-ttu-id="b01c9-152">[**Getnextpacket**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-getnextpacket) kann erfolgreich sein, ohne Datenpakete bereit zu lassen, wenn sich der Multiplexer noch im Prozess der packetisierung und dem Hinzufügen von Datenpaketen befindet.</span><span class="sxs-lookup"><span data-stu-id="b01c9-152">[**GetNextPacket**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-getnextpacket) can succeed without yielding any data packets if the multiplexer is still in the process of packetizing and adding data packets.</span></span> <span data-ttu-id="b01c9-153">In diesem Fall verweist *ppipacket* auf **null**.</span><span class="sxs-lookup"><span data-stu-id="b01c9-153">In this case, *ppIPacket* points to **NULL**.</span></span> <span data-ttu-id="b01c9-154">Um den Vorgang fortzusetzen, müssen Sie dem Multiplexer weitere Eingabemedien Beispiele hinzugefügt werden, indem Sie [**processsample**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-processsample)aufrufen.</span><span class="sxs-lookup"><span data-stu-id="b01c9-154">To proceed, you must provide the multiplexer with more input media samples by calling [**ProcessSample**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-processsample).</span></span>

<span data-ttu-id="b01c9-155">Der folgende Beispielcode zeigt eine Funktion, die Datenpakete mithilfe des Multiplexers generiert.</span><span class="sxs-lookup"><span data-stu-id="b01c9-155">The following example code shows a function that generates data packets by using the multiplexer.</span></span> <span data-ttu-id="b01c9-156">Der generierte Datenpaket Inhalt wird in den vom Aufrufer zugeordneten Daten Byte Datenstrom geschrieben.</span><span class="sxs-lookup"><span data-stu-id="b01c9-156">The generated data packet contents will be written to the data byte stream allocated by the caller.</span></span>


```C++
//-------------------------------------------------------------------
// GenerateASFDataPackets
// 
// Gets data packets from the mux. This function is called after 
// calling IMFASFMultiplexer::ProcessSample. 
//-------------------------------------------------------------------

HRESULT GenerateASFDataPackets( 
    IMFASFMultiplexer *pMux, 
    IMFByteStream *pDataStream
    )
{
    HRESULT hr = S_OK;

    IMFSample *pOutputSample = NULL;
    IMFMediaBuffer *pDataPacketBuffer = NULL;

    DWORD dwMuxStatus = ASF_STATUSFLAGS_INCOMPLETE;

    while (dwMuxStatus & ASF_STATUSFLAGS_INCOMPLETE)
    {
        hr = pMux->GetNextPacket(&dwMuxStatus, &pOutputSample);

        if (FAILED(hr))
        {
            break;
        }

        if (pOutputSample)
        {
            //Convert to contiguous buffer
            hr = pOutputSample->ConvertToContiguousBuffer(&pDataPacketBuffer);
            
            if (FAILED(hr))
            {
                break;
            }

            //Write buffer to byte stream
            hr = WriteBufferToByteStream(pDataStream, pDataPacketBuffer, NULL);

            if (FAILED(hr))
            {
                break;
            }
        }

        SafeRelease(&pDataPacketBuffer);
        SafeRelease(&pOutputSample);
    }

    SafeRelease(&pOutputSample);
    SafeRelease(&pDataPacketBuffer);
    return hr;
}
```



<span data-ttu-id="b01c9-157">Die- `WriteBufferToByteStream` Funktion wird im Thema [**IMF Bytestream:: Write**](/windows/desktop/api/mfobjects/nf-mfobjects-imfbytestream-write)angezeigt.</span><span class="sxs-lookup"><span data-stu-id="b01c9-157">The `WriteBufferToByteStream` function is shown in the topic [**IMFByteStream::Write**](/windows/desktop/api/mfobjects/nf-mfobjects-imfbytestream-write).</span></span>

<span data-ttu-id="b01c9-158">Eine komplette Anwendung, die dieses Codebeispiel verwendet, finden Sie unter [Tutorial: Kopieren von ASF-Streams aus einer Datei in eine andere](tutorial--copying-asf-streams-from-one-file-to-another.md).</span><span class="sxs-lookup"><span data-stu-id="b01c9-158">To see a complete application that uses this code example, see [Tutorial: Copying ASF Streams from One File to Another](tutorial--copying-asf-streams-from-one-file-to-another.md).</span></span>

## <a name="post-packet-generation-calls"></a><span data-ttu-id="b01c9-159">Post Packet-Generation-Aufrufe</span><span class="sxs-lookup"><span data-stu-id="b01c9-159">Post Packet-Generation Calls</span></span>

<span data-ttu-id="b01c9-160">Um sicherzustellen, dass im Multiplexer keine kompletten Datenpakete gewartet werden, wird [**imfasfmultiplexer:: Flush**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-flush)aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="b01c9-160">To make sure that there are no complete data packets waiting in the multiplexer, call [**IMFASFMultiplexer::Flush**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-flush).</span></span> <span data-ttu-id="b01c9-161">Dadurch wird erzwungen, dass der Multiplexer alle ausgeführten Medien Beispiele packetisiert.</span><span class="sxs-lookup"><span data-stu-id="b01c9-161">This forces the multiplexer to packetize all the media samples that are in progress.</span></span> <span data-ttu-id="b01c9-162">Diese Pakete können von der Anwendung in Form von Medien Beispielen über **getnextpacket** in einer Schleife gesammelt werden, bis keine weiteren Pakete mehr abgerufen werden können.</span><span class="sxs-lookup"><span data-stu-id="b01c9-162">The application can collect these packets in form of media samples through **GetNextPacket** in a loop until there are no more packets left to be retrieved.</span></span>

<span data-ttu-id="b01c9-163">Nachdem alle Medien Beispiele generiert wurden, wird [**imfasfmultiplexer:: End**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-end) aufgerufen, um das mit diesen Datenpaketen verknüpfte ASF-Header Objekt zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="b01c9-163">After all the media samples are generated, call [**IMFASFMultiplexer::End**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-end) to update the ASF Header Object that is associated with these data packets.</span></span> <span data-ttu-id="b01c9-164">Das Header Objekt wird durch Übergeben des ContentInfo-Objekts angegeben, das zum Initialisieren des Multiplexers verwendet wurde.</span><span class="sxs-lookup"><span data-stu-id="b01c9-164">The Header Object is specified by passing the ContentInfo object that was used to initialize the multiplexer.</span></span> <span data-ttu-id="b01c9-165">Mit diesem Aufruf werden verschiedene Header Objekte aktualisiert, um Änderungen widerzuspiegeln, die während der Generierung des Datenpakets vom Multiplexer vorgenommen wurden</span><span class="sxs-lookup"><span data-stu-id="b01c9-165">This call updates various Header Objects to reflect changes made by the multiplexer during data packet generation.</span></span> <span data-ttu-id="b01c9-166">Diese Informationen umfassen die Paket Anzahl, sende Dauer, Wiedergabedauer und streamnummern aller Streams.</span><span class="sxs-lookup"><span data-stu-id="b01c9-166">This information includes packet count, send duration, play duration, and stream numbers of all the streams.</span></span> <span data-ttu-id="b01c9-167">Die gesamte Header Größe wird ebenfalls aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="b01c9-167">The overall header size is also updated.</span></span>

<span data-ttu-id="b01c9-168">Sie müssen sicherstellen, dass [**End**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-end) aufgerufen wird, nachdem alle Datenpakete abgerufen wurden.</span><span class="sxs-lookup"><span data-stu-id="b01c9-168">You must ensure that [**End**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-end) is called after all the data packets have been retrieved.</span></span> <span data-ttu-id="b01c9-169">Wenn Pakete auf den Multiplexer warten, schlägt **End** fehl, und es wird der Fehlercode für den **MF \_ E \_ Flush \_** -Vorgang zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="b01c9-169">If there are any packets waiting in the multiplexer, **End** will fail and return the **MF\_E\_FLUSH\_NEEDED** error code.</span></span> <span data-ttu-id="b01c9-170">Rufen Sie in diesem Fall das wartende Paket ab, indem Sie " [**Flush**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-flush) " und " [**getnextpacket**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-getnextpacket) " in einer Schleife aufrufen.</span><span class="sxs-lookup"><span data-stu-id="b01c9-170">In this case, get the waiting packet by calling [**Flush**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-flush) and [**GetNextPacket**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmultiplexer-getnextpacket) in a loop.</span></span>

> [!Note]  
> <span data-ttu-id="b01c9-171">Bei der VBR-Codierung müssen Sie nach dem Aufrufen von **End** die Codierungs Statistik in den Codierungs Eigenschaften des ContentInfo-Objekts festlegen.</span><span class="sxs-lookup"><span data-stu-id="b01c9-171">For VBR encoding, after calling **End**, you must set the encoding statistics in the ContentInfo object's encoding properties.</span></span> <span data-ttu-id="b01c9-172">Weitere Informationen zu diesem Prozess finden Sie unter "Konfigurieren des ContentInfo-Objekts mit Encodereinstellungen" unter [Festlegen von Eigenschaften im ContentInfo-Objekt](setting-properties-in-the-contentinfo-object.md).</span><span class="sxs-lookup"><span data-stu-id="b01c9-172">For information about this process, see "Configuring the ContentInfo Object with Encoder Settings" in [Setting Properties in the ContentInfo Object](setting-properties-in-the-contentinfo-object.md).</span></span> <span data-ttu-id="b01c9-173">In der folgenden Liste sind die festzulegenden spezifischen Eigenschaften aufgeführt:</span><span class="sxs-lookup"><span data-stu-id="b01c9-173">The following list shows the specific properties to set:</span></span>
>
> -   <span data-ttu-id="b01c9-174">[**Mfpkey \_ Ravg**](mfpkey-ravgproperty.md) ist die durchschnittliche Bitrate des VBR-Inhalts.</span><span class="sxs-lookup"><span data-stu-id="b01c9-174">[**MFPKEY\_RAVG**](mfpkey-ravgproperty.md) is the average bit rate of the VBR content.</span></span>
> -   <span data-ttu-id="b01c9-175">[**Mfpkey \_ Bavg**](mfpkey-bavgproperty.md) ist das Puffer Fenster für die durchschnittliche Bitrate.</span><span class="sxs-lookup"><span data-stu-id="b01c9-175">[**MFPKEY\_BAVG**](mfpkey-bavgproperty.md) is the buffer window for the average bit rate.</span></span>
> -   <span data-ttu-id="b01c9-176">[**Mfpkey \_ Rmax**](mfpkey-rmaxproperty.md) ist die Spitzen Bitrate der VBR-Inhalte.</span><span class="sxs-lookup"><span data-stu-id="b01c9-176">[**MFPKEY\_RMAX**](mfpkey-rmaxproperty.md) is the peak bit rate of the VBR content.</span></span>
> -   <span data-ttu-id="b01c9-177">[**Mfpkey \_ Bmax**](mfpkey-bmaxproperty.md) ist das Hauptpuffer Fenster.</span><span class="sxs-lookup"><span data-stu-id="b01c9-177">[**MFPKEY\_BMAX**](mfpkey-bmaxproperty.md) is the peak buffer window.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="b01c9-178">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="b01c9-178">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="b01c9-179">ASF Multiplexer</span><span class="sxs-lookup"><span data-stu-id="b01c9-179">ASF Multiplexer</span></span>](asf-multiplexer.md)
</dt> <dt>

[<span data-ttu-id="b01c9-180">Tutorial: Kopieren von ASF-Streams aus einer Datei in eine andere</span><span class="sxs-lookup"><span data-stu-id="b01c9-180">Tutorial: Copying ASF Streams from One File to Another</span></span>](tutorial--copying-asf-streams-from-one-file-to-another.md)
</dt> <dt>

[<span data-ttu-id="b01c9-181">Tutorial: Schreiben einer WMA-Datei mithilfe der CBR-Codierung</span><span class="sxs-lookup"><span data-stu-id="b01c9-181">Tutorial: Writing a WMA File by Using CBR Encoding</span></span>](tutorial--writing-a-wma-file-by-using-cbr-encoding.md)
</dt> </dl>

 

 



