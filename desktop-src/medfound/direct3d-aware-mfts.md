---
description: In diesem Thema wird beschrieben, wie eine Direct3D-fähige Media Foundation Transformation (MFT) für Video implementiert wird.
ms.assetid: 8ec7e678-8477-41fa-9726-54df5ed187cd
title: Direct3D-Aware-MFTs
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ad50438250c0ee1627cc20aebb49262ec8eec9ac
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "104524560"
---
# <a name="direct3d-aware-mfts"></a><span data-ttu-id="3d5e7-103">Direct3D-Aware-MFTs</span><span class="sxs-lookup"><span data-stu-id="3d5e7-103">Direct3D-Aware MFTs</span></span>

<span data-ttu-id="3d5e7-104">In diesem Thema wird beschrieben, wie eine *Direct3D-fähige* Media Foundation Transformation (MFT) für Video implementiert wird.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-104">This topic describes how to implement a *Direct3D-aware* Media Foundation transform (MFT) for video.</span></span>

<span data-ttu-id="3d5e7-105">Ein Video-MFT wird als *Direct3D* angesehen, wenn er Beispiele verarbeiten kann, die Direct3D-Oberflächen enthalten.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-105">An video MFT is considered *Direct3D-aware* if it can process samples that contain Direct3D surfaces.</span></span> <span data-ttu-id="3d5e7-106">Der typische Grund für die Unterstützung von Direct3D in einer Video-MFT besteht darin, die hardwarebeschleunigte Decodierung mithilfe der DirectX-Videobeschleunigung (DXVA) zu ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-106">The typical reason for supporting Direct3D in a video MFT is to enable hardware-accelerated decoding, using DirectX Video Acceleration (DXVA).</span></span>

<span data-ttu-id="3d5e7-107">In diesem Thema werden die Schritte beschrieben, die erforderlich sind, um die MFT-Direct3D zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-107">This topic describes the steps that are required to make your MFT Direct3D-aware.</span></span> <span data-ttu-id="3d5e7-108">Dieses Thema behandelt nicht die Mechanismen der DXVA-Decodierung.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-108">This topic does not cover the mechanics of DXVA decoding.</span></span> <span data-ttu-id="3d5e7-109">Weitere Informationen zu DXVA finden Sie unter [DirectX-Video Beschleunigung 2,0](directx-video-acceleration-2-0.md).</span><span class="sxs-lookup"><span data-stu-id="3d5e7-109">For information about DXVA, see [DirectX Video Acceleration 2.0](directx-video-acceleration-2-0.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="3d5e7-110">Ab Windows 8 kann [**imsdxgidevicemanager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) anstelle von [**IDirect3DDeviceManager9**](/windows/desktop/api/dxva2api/nn-dxva2api-idirect3ddevicemanager9)verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-110">Beginning in Windows 8, [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) can be used instead of the [**IDirect3DDeviceManager9**](/windows/desktop/api/dxva2api/nn-dxva2api-idirect3ddevicemanager9).</span></span> <span data-ttu-id="3d5e7-111">Für Windows Store-Apps müssen Sie **IMF dxgidevicemanager** und Microsoft Direct3D 11 verwenden.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-111">For Windows Store apps, you must use **IMFDXGIDeviceManager** and Microsoft Direct3D 11.</span></span> <span data-ttu-id="3d5e7-112">Weitere Informationen finden Sie in den [Video-APIs Direct3D 11](direct3d-11-video-apis.md).</span><span class="sxs-lookup"><span data-stu-id="3d5e7-112">For more info, see the [Direct3D 11 Video APIs](direct3d-11-video-apis.md).</span></span>

 

1.  <span data-ttu-id="3d5e7-113">Implementieren Sie die [**IMF Transform:: GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) -Methode.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-113">Implement the [**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) method.</span></span> <span data-ttu-id="3d5e7-114">Diese Methode gibt einen Zeiger auf einen Attribut Speicher zurück.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-114">This method returns a pointer to an attribute store.</span></span>
2.  <span data-ttu-id="3d5e7-115">Der MFT muss den Wert des [**\_ \_ D3D \_**](mf-sa-d3d-aware-attribute.md) -Attributs der MF-Eigenschaft auf " **true** " in seinem eigenen Attribut Speicher festlegen.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-115">The MFT must set the value of the [**MF\_SA\_D3D\_AWARE**](mf-sa-d3d-aware-attribute.md) attribute to **TRUE** on its own attribute store.</span></span> <span data-ttu-id="3d5e7-116">Bei Verwendung von Direct3D 11 wird ab Windows 8 die Verwendung von [MF \_ sa \_ D3D11 \_ ](mf-sa-d3d11-aware.md)unterstützt.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-116">Beginning in Windows 8, if using Direct3D 11 use [MF\_SA\_D3D11\_AWARE](mf-sa-d3d11-aware.md).</span></span>
3.  <span data-ttu-id="3d5e7-117">Wenn beim Formatieren von Formaten das Attribut [**MF \_ sa \_ D3D \_ Aware**](mf-sa-d3d-aware-attribute.md) (oder [MF \_ sa \_ D3D11 \_ Aware](mf-sa-d3d11-aware.md) If using Direct3D 11) den Wert **true** hat, sendet der Client möglicherweise die [**MFT- \_ Nachrichten \_ Satz \_ D3D \_ Manager**](mft-message-set-d3d-manager.md) -Nachricht an die MFT.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-117">During format negotiation, if the [**MF\_SA\_D3D\_AWARE**](mf-sa-d3d-aware-attribute.md) (or [MF\_SA\_D3D11\_AWARE](mf-sa-d3d11-aware.md) if using Direct3D 11) attribute is **TRUE**, the client may send the [**MFT\_MESSAGE\_SET\_D3D\_MANAGER**](mft-message-set-d3d-manager.md) message to the MFT.</span></span> <span data-ttu-id="3d5e7-118">Der *ulparam* -Ereignis Parameter ist ein Zeiger auf die [**IDirect3DDeviceManager9**](/windows/desktop/api/dxva2api/nn-dxva2api-idirect3ddevicemanager9) -Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-118">The *ulParam* event parameter is a pointer to the [**IDirect3DDeviceManager9**](/windows/desktop/api/dxva2api/nn-dxva2api-idirect3ddevicemanager9) interface.</span></span> <span data-ttu-id="3d5e7-119">Ab Windows 8 können Sie [**IMF dxgidevicemanager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) anstelle von **IDirect3DDeviceManager9** verwenden.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-119">Beginning in Windows 8, you can use [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) instead of **IDirect3DDeviceManager9**.</span></span> <span data-ttu-id="3d5e7-120">Der Client muss diese Nachricht nicht senden.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-120">The client is not required to send this message.</span></span>
4.  <span data-ttu-id="3d5e7-121">Der MFT ruft [**IDirect3DDeviceManager9:: getvideoservice**](/windows/desktop/api/dxva2api/nf-dxva2api-idirect3ddevicemanager9-getvideoservice) auf, um den benötigten DXVA-Dienst abzufragen.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-121">The MFT calls [**IDirect3DDeviceManager9::GetVideoService**](/windows/desktop/api/dxva2api/nf-dxva2api-idirect3ddevicemanager9-getvideoservice) to query for the DXVA service it needs.</span></span> <span data-ttu-id="3d5e7-122">Ab Windows 8, wenn [**imfdxgidevicemanager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) verwendet wurde, ruft der MFT [**imfdxgidevicemanager:: getvideoservice**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-getvideoservice)auf.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-122">Beginning in Windows 8, if [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) was used the MFT calls [**IMFDXGIDeviceManager::GetVideoService**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-getvideoservice).</span></span> <span data-ttu-id="3d5e7-123">In der Regel würde ein Decoder [**idirectxvideodecoderservice**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideodecoderservice)Abfragen, und ein Videoprozessor würde [**idirectxvideoprocess orservice**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideoprocessorservice)Abfragen.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-123">Typically a decoder would query for [**IDirectXVideoDecoderService**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideodecoderservice), and a video processor would query for [**IDirectXVideoProcessorService**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideoprocessorservice).</span></span>
5.  <span data-ttu-id="3d5e7-124">Wenn der vorherige Schritt erfolgreich ausgeführt wurde, müssen die Methoden [**imftransform:: getinputavailabletype**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) und [**imftransform:: getoutputavailabletype**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) DXVA-kompatible Formate zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-124">Assuming the previous step is successful, the [**IMFTransform::GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) and [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) methods must return DXVA-compatible formats.</span></span>
6.  <span data-ttu-id="3d5e7-125">Der Client konfiguriert die Medientypen auf dem MFT.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-125">The client configures the media types on the MFT.</span></span> <span data-ttu-id="3d5e7-126">Wenn ein Medientyp nicht mit DXVA kompatibel ist, muss der MFT den Fehlercode **MF \_ E \_ nicht unterstützten \_ D3D- \_ Typ** zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-126">If a media type is not compatible with DXVA, the MFT must return the error code **MF\_E\_UNSUPPORTED\_D3D\_TYPE**.</span></span>
7.  <span data-ttu-id="3d5e7-127">Zu diesem Zeitpunkt gibt es zwei Optionen, abhängig davon, ob der Client ein geeignetes DXVA-Format findet.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-127">At this point, there are two options, depending on whether the client finds a suitable DXVA format.</span></span>
    -   <span data-ttu-id="3d5e7-128">Wenn der Client ein DXVA-Format erfolgreich konfiguriert hat, kann er mit der Verarbeitung beginnen.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-128">If the client successfully configures a DXVA format, it may begin processing.</span></span> <span data-ttu-id="3d5e7-129">An diesem Punkt kann die MFT DXVA zur Verarbeitung verwenden oder auf die Software Verarbeitung zurückgreifen.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-129">At this point, the MFT can use DXVA for processing, or fall back to software processing.</span></span>
    -   <span data-ttu-id="3d5e7-130">Wenn der Client jedoch kein akzeptables DXVA-Format findet, sendet der Client möglicherweise eine weitere [**MFT \_ Message \_ Set \_ D3D \_ Manager**](mft-message-set-d3d-manager.md) -Nachricht, bei der *ulparam* auf **null** festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-130">Alternatively, if the client does not find an acceptable DXVA format, the client may send another [**MFT\_MESSAGE\_SET\_D3D\_MANAGER**](mft-message-set-d3d-manager.md) message, this time setting *ulParam* to **NULL**.</span></span> <span data-ttu-id="3d5e7-131">Der MFT muss den [**IDirect3DDeviceManager9**](/windows/desktop/api/dxva2api/nn-dxva2api-idirect3ddevicemanager9) -Zeiger ( [**imfdxgidevicemanager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) -Zeiger, wenn **imfdxgidevicemanager** verwendet wurde) und alle anderen DXVA-Schnittstellen freigeben und die Software Verarbeitung wiederherstellen.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-131">The MFT must release the [**IDirect3DDeviceManager9**](/windows/desktop/api/dxva2api/nn-dxva2api-idirect3ddevicemanager9) pointer (the [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) pointer, if **IMFDXGIDeviceManager** was used) and any other DXVA interfaces, and revert to software processing.</span></span> <span data-ttu-id="3d5e7-132">An diesem Punkt darf die MFT die DXVA-Verarbeitung nicht verwenden.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-132">At this point, the MFT must not use DXVA processing.</span></span>

<span data-ttu-id="3d5e7-133">Ein Direct3D-MFT muss darauf vorbereitet sein, Beispiele zu verarbeiten, die eine Direct3D-Oberfläche enthalten.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-133">A Direct3D-aware MFT must be prepared to handle samples that contain a Direct3D surface.</span></span> <span data-ttu-id="3d5e7-134">Das Beispiel enthält genau einen Medien Puffer.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-134">The sample will contain exactly one media buffer.</span></span> <span data-ttu-id="3d5e7-135">Um die Direct3D-Oberfläche aus dem Puffer abzurufen, müssen Sie die [**mfgetservice**](/windows/desktop/api/mfidl/nf-mfidl-mfgetservice) -Funktion aufrufen und den Dienst " **Mr- \_ Puffer \_ Dienst** " angeben.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-135">To get the Direct3D surface from the buffer, call the [**MFGetService**](/windows/desktop/api/mfidl/nf-mfidl-mfgetservice) function and specify the **MR\_BUFFER\_SERVICE** service.</span></span> <span data-ttu-id="3d5e7-136">Weitere Informationen finden Sie unter [DirectX-Oberflächen Puffer](directx-surface-buffer.md).</span><span class="sxs-lookup"><span data-stu-id="3d5e7-136">For more information, see [DirectX Surface Buffer](directx-surface-buffer.md).</span></span>

<span data-ttu-id="3d5e7-137">Ein MFT, der DXVA verwendet, muss seine eigenen Ausgabe Beispiele wie folgt zuordnen:</span><span class="sxs-lookup"><span data-stu-id="3d5e7-137">An MFT that uses DXVA must allocate its own output samples, as follows:</span></span>

1.  <span data-ttu-id="3d5e7-138">Legen Sie in der [**imftransform:: getoutputstreaminfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) -Methode fest, dass der **MFT- \_ Ausgabestream ein \_ \_ \_ Samples** -Flag enthält.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-138">In the [**IMFTransform::GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method, set the **MFT\_OUTPUT\_STREAM\_PROVIDES\_SAMPLES** flag.</span></span>
2.  <span data-ttu-id="3d5e7-139">Erstellen Sie einen Pool mit DXVA-Oberflächen, wie in der DXVA-Spezifikation beschrieben.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-139">Create a pool of DXVA surfaces, as described in the DXVA specification.</span></span>
3.  <span data-ttu-id="3d5e7-140">Erstellen Sie Medien Beispiele, indem Sie [**mfcreatevideosamplefromsurface**](/windows/desktop/api/evr/nc-evr-mfcreatevideosamplefromsurface)aufrufen.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-140">Create media samples by calling [**MFCreateVideoSampleFromSurface**](/windows/desktop/api/evr/nc-evr-mfcreatevideosamplefromsurface).</span></span>

<span data-ttu-id="3d5e7-141">Die MFT sollte die Software Verarbeitung immer als Fallback unterstützen, da die DXVA-Verarbeitung möglicherweise aus verschiedenen Gründen nicht verfügbar ist:</span><span class="sxs-lookup"><span data-stu-id="3d5e7-141">The MFT should always support software processing as a fallback, because DXVA processing might not available, for several reasons:</span></span>

-   <span data-ttu-id="3d5e7-142">DXVA wird von der GPU möglicherweise nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-142">The GPU might not support DXVA.</span></span>
-   <span data-ttu-id="3d5e7-143">Der Client verwendet möglicherweise nicht Direct3D.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-143">The client might not use Direct3D.</span></span>
-   <span data-ttu-id="3d5e7-144">DXVA-Profile sind nicht für jedes Videoformat definiert.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-144">DXVA profiles are not defined for every video format.</span></span>

<span data-ttu-id="3d5e7-145">Ein Direct3D-MFT muss über einen einzelnen Ausgabestream verfügen.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-145">A Direct3D-aware MFT must have a single output stream.</span></span> <span data-ttu-id="3d5e7-146">Es können nicht mehrere Ausgaben vorhanden sein.</span><span class="sxs-lookup"><span data-stu-id="3d5e7-146">It cannot have multiple outputs.</span></span>

## <a name="related-topics"></a><span data-ttu-id="3d5e7-147">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="3d5e7-147">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3d5e7-148">Schreiben eines benutzerdefinierten MFT</span><span class="sxs-lookup"><span data-stu-id="3d5e7-148">Writing a Custom MFT</span></span>](writing-a-custom-mft.md)
</dt> </dl>

 

 



