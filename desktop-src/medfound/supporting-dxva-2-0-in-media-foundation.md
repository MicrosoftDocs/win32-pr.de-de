---
description: Unterstützung von DXVA 2,0 in Media Foundation
ms.assetid: d7330370-adb3-4c6a-962a-7b46c344500c
title: Unterstützung von DXVA 2,0 in Media Foundation
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ce144c24a1aeeda6281ddb423757f3e339903440
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/03/2021
ms.locfileid: "106364999"
---
# <a name="supporting-dxva-20-in-media-foundation"></a><span data-ttu-id="2a9a9-103">Unterstützung von DXVA 2,0 in Media Foundation</span><span class="sxs-lookup"><span data-stu-id="2a9a9-103">Supporting DXVA 2.0 in Media Foundation</span></span>

<span data-ttu-id="2a9a9-104">In diesem Thema wird beschrieben, wie Sie die DirectX-Video Beschleunigung (DXVA) 2,0 in einer Media Foundation Transformation (MFT) mit Microsoft Direct3D 9 unterstützen, insbesondere die Kommunikation zwischen dem Decoder und dem Videorenderer, der vom topologielader vermittelt wird.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-104">This topic describes how to support DirectX Video Acceleration (DXVA) 2.0 in a Media Foundation transform (MFT) using Microsoft Direct3D 9 Specifically, it describes the communication between the decoder and the video renderer, which is mediated by the topology loader.</span></span> <span data-ttu-id="2a9a9-105">In diesem Thema wird nicht beschrieben, wie DXVA-Decodierung implementiert wird.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-105">This topic does not describe how to implement DXVA decoding.</span></span>

<span data-ttu-id="2a9a9-106">Im restlichen Teil dieses Themas verweist der Begriff " *Decoder* " auf den Decoder-MFT, der komprimierte Videos empfängt und unkomprimierte Videos ausgibt.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-106">In the remainder of this topic, the term *decoder* refers to the decoder MFT, which receives compressed video and outputs uncompressed video.</span></span> <span data-ttu-id="2a9a9-107">Der Begriff " *Decoder-Gerät* " bezieht sich auf einen Hardware-Video Beschleuniger, der vom Grafiktreiber implementiert wird.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-107">The term *decoder device* refers to a hardware video accelerator implemented by the graphics driver.</span></span>

> [!TIP]
> <span data-ttu-id="2a9a9-108">Weitere Informationen zur Video Decodierung von Microsoft Direct3D 11 finden Sie unter [Unterstützung von Direct3D 11 Video Decodierung in Media Foundation](supporting-direct3d-11-video-decoding-in-media-foundation.md).</span><span class="sxs-lookup"><span data-stu-id="2a9a9-108">For info on Microsoft Direct3D 11 video decoding see, [Supporting Direct3D 11 Video Decoding in Media Foundation](supporting-direct3d-11-video-decoding-in-media-foundation.md).</span></span>

 

> [!Note]  
> <span data-ttu-id="2a9a9-109">Für Windows Store-Apps muss Direct3D 11 verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-109">Windows Store apps must use Direct3D 11.</span></span>

 

<span data-ttu-id="2a9a9-110">Im folgenden finden Sie die grundlegenden Schritte, die ein Decoder ausführen muss, um DXVA 2,0 in Media Foundation zu unterstützen:</span><span class="sxs-lookup"><span data-stu-id="2a9a9-110">Here are the basic steps that a decoder must perform to support DXVA 2.0 in Media Foundation:</span></span>

1.  <span data-ttu-id="2a9a9-111">Öffnen Sie ein Handle für das Gerät Direct3D 9.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-111">Open a handle to the Direct3D 9 device.</span></span>
2.  <span data-ttu-id="2a9a9-112">Suchen Sie die Konfiguration des DXVA-Decoders.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-112">Find a DXVA decoder configuration.</span></span>
3.  <span data-ttu-id="2a9a9-113">Nicht komprimierte Puffer zuordnen.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-113">Allocate uncompressed Buffers.</span></span>
4.  <span data-ttu-id="2a9a9-114">Decodieren von Frames.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-114">Decode frames.</span></span>

<span data-ttu-id="2a9a9-115">Diese Schritte werden im weiteren Verlauf dieses Themas ausführlicher beschrieben.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-115">These steps are described in more detail in the remainder of this topic.</span></span>

## <a name="opening-a-direct3d-device-handle"></a><span data-ttu-id="2a9a9-116">Öffnen eines Direct3D-Geräte Handles</span><span class="sxs-lookup"><span data-stu-id="2a9a9-116">Opening a Direct3D Device Handle</span></span>

<span data-ttu-id="2a9a9-117">Der MFT verwendet den Microsoft Direct3D-Geräte-Manager, um ein Handle für das Direct3D 9-Gerät zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-117">The MFT uses the Microsoft Direct3D device manager to get a handle to the Direct3D 9 device.</span></span> <span data-ttu-id="2a9a9-118">Führen Sie die folgenden Schritte aus, um das Geräte Handle zu öffnen:</span><span class="sxs-lookup"><span data-stu-id="2a9a9-118">To open the device handle, perform the following steps:</span></span>

1.  <span data-ttu-id="2a9a9-119">Machen Sie das Attribut [MF \_ sa \_ D3D \_ Aware](mf-sa-d3d-aware-attribute.md) mit dem Wert **true** verfügbar.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-119">Expose the [MF\_SA\_D3D\_AWARE](mf-sa-d3d-aware-attribute.md) attribute with the value **TRUE**.</span></span> <span data-ttu-id="2a9a9-120">Das topologielader fragt dieses Attribut durch Aufrufen von [**imftransform:: GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes)ab.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-120">The topology loader queries this attribute by calling [**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes).</span></span> <span data-ttu-id="2a9a9-121">Wenn das-Attribut auf **true** festgelegt wird, wird der topologielader benachrichtigt, dass der MFT DXVA unterstützt.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-121">Setting the attribute to **TRUE** notifies the topology loader that the MFT supports DXVA.</span></span>
2.  <span data-ttu-id="2a9a9-122">Wenn die Format Aushandlung beginnt, ruft das topologieloader " [**imftransform::P rocess Message**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) " mit der Meldung " [**MFT \_ Message \_ Set \_ D3D \_ Manager**](mft-message-set-d3d-manager.md) " auf.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-122">When format negotiation begins, the topology loader calls [**IMFTransform::ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_SET\_D3D\_MANAGER**](mft-message-set-d3d-manager.md) message.</span></span> <span data-ttu-id="2a9a9-123">Der *ulparam* -Parameter ist ein **IUnknown** -Zeiger auf den Direct3D-Geräte-Manager des Video-Renderers.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-123">The *ulParam* parameter is an **IUnknown** pointer to the video renderer's Direct3D device manager.</span></span> <span data-ttu-id="2a9a9-124">Fragen Sie diesen Zeiger auf die [**IDirect3DDeviceManager9**](/windows/desktop/api/dxva2api/nn-dxva2api-idirect3ddevicemanager9) -Schnittstelle ab.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-124">Query this pointer for the [**IDirect3DDeviceManager9**](/windows/desktop/api/dxva2api/nn-dxva2api-idirect3ddevicemanager9) interface.</span></span>
3.  <span data-ttu-id="2a9a9-125">Wenn Sie [**IDirect3DDeviceManager9:: opentovicehandle**](/windows/desktop/api/dxva2api/nf-dxva2api-idirect3ddevicemanager9-opendevicehandle) aufzurufen, erhalten Sie ein Handle für das Direct3D-Gerät des Renderers.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-125">Call [**IDirect3DDeviceManager9::OpenDeviceHandle**](/windows/desktop/api/dxva2api/nf-dxva2api-idirect3ddevicemanager9-opendevicehandle) to get a handle to the renderer's Direct3D device.</span></span>
4.  <span data-ttu-id="2a9a9-126">Aufrufen von [**IDirect3DDeviceManager9:: getvideoservice**](/windows/desktop/api/dxva2api/nf-dxva2api-idirect3ddevicemanager9-getvideoservice) und übergeben des Geräte Handles.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-126">Call [**IDirect3DDeviceManager9::GetVideoService**](/windows/desktop/api/dxva2api/nf-dxva2api-idirect3ddevicemanager9-getvideoservice) and pass in the device handle.</span></span> <span data-ttu-id="2a9a9-127">Diese Methode gibt einen Zeiger auf die [**idirectxvideodecoderservice**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideodecoderservice) -Schnittstelle zurück.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-127">This method returns a pointer to the [**IDirectXVideoDecoderService**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideodecoderservice) interface.</span></span>
5.  <span data-ttu-id="2a9a9-128">Zwischenspeichern der Zeiger und des Geräte Handles.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-128">Cache the pointers and the device handle.</span></span>

## <a name="finding-a-decoder-configuration"></a><span data-ttu-id="2a9a9-129">Suchen einer decoderkonfiguration</span><span class="sxs-lookup"><span data-stu-id="2a9a9-129">Finding a Decoder Configuration</span></span>

<span data-ttu-id="2a9a9-130">Der MFT muss eine kompatible Konfiguration für das DXVA-Decodergerät finden.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-130">The MFT must find a compatible configuration for the DXVA decoder device.</span></span> <span data-ttu-id="2a9a9-131">Führen Sie nach der Überprüfung des Eingabe Typs die folgenden Schritte innerhalb der [**IMF Transform:: abktinputtype**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) -Methode aus:</span><span class="sxs-lookup"><span data-stu-id="2a9a9-131">Perform the following steps inside the [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) method, after validating the input type:</span></span>

1.  <span data-ttu-id="2a9a9-132">Aufrufen von [**idirectxvideodecoderservice:: getdecoderdeviceguids**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoderservice-getdecoderdeviceguids).</span><span class="sxs-lookup"><span data-stu-id="2a9a9-132">Call [**IDirectXVideoDecoderService::GetDecoderDeviceGuids**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoderservice-getdecoderdeviceguids).</span></span> <span data-ttu-id="2a9a9-133">Diese Methode gibt ein Array von Decoder-Geräte-GUIDs zurück.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-133">This method returns an array of decoder device GUIDs.</span></span>
2.  <span data-ttu-id="2a9a9-134">Durchlaufen Sie das Array von decoderguids, um diejenigen zu finden, die der Decoder unterstützt.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-134">Loop through the array of decoder GUIDs to find the ones that the decoder supports.</span></span> <span data-ttu-id="2a9a9-135">Für einen MPEG-2-Decoder würden Sie z. b. nach **DXVA2 \_ ModeMPEG2 \_ mucomp**, **DXVA2 \_ ModeMPEG2 \_ IDCT** oder **DXVA2 \_ ModeMPEG2 \_ VLD** suchen.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-135">For example, for an MPEG-2 decoder, you would look for **DXVA2\_ModeMPEG2\_MOCOMP**, **DXVA2\_ModeMPEG2\_IDCT**, or **DXVA2\_ModeMPEG2\_VLD**.</span></span>

3.  <span data-ttu-id="2a9a9-136">Wenn Sie eine Geräte-GUID für den Kandidaten Decoder finden, übergeben Sie die GUID an die [**idirectxvideodecoderservice:: getdecoderrendertargets**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoderservice-getdecoderrendertargets) -Methode.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-136">When you find a candidate decoder device GUID, pass the GUID to the [**IDirectXVideoDecoderService::GetDecoderRenderTargets**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoderservice-getdecoderrendertargets) method.</span></span> <span data-ttu-id="2a9a9-137">Diese Methode gibt ein Array von renderzielformaten zurück, die als **D3DFORMAT** -Werte angegeben werden.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-137">This method returns an array of render target formats, specified as **D3DFORMAT** values.</span></span>
4.  <span data-ttu-id="2a9a9-138">Durchlaufen Sie die renderzielformate, und suchen Sie nach einem Format, das vom Decoder unterstützt wird.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-138">Loop through the render target formats and look for a format supported by the decoder.</span></span>
5.  <span data-ttu-id="2a9a9-139">Aufrufen von [**idirectxvideodecoderservice:: getdecoderkonfigurationen**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoderservice-getdecoderconfigurations).</span><span class="sxs-lookup"><span data-stu-id="2a9a9-139">Call [**IDirectXVideoDecoderService::GetDecoderConfigurations**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoderservice-getdecoderconfigurations).</span></span> <span data-ttu-id="2a9a9-140">Übergeben Sie dieselbe Decoder-Geräte-GUID, zusammen mit einer [**DXVA2 \_ videodesc**](/windows/desktop/api/dxva2api/ns-dxva2api-dxva2_videodesc) -Struktur, die das vorgeschlagene Ausgabeformat beschreibt.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-140">Pass in the same decoder device GUID, along with a [**DXVA2\_VideoDesc**](/windows/desktop/api/dxva2api/ns-dxva2api-dxva2_videodesc) structure that describes the proposed output format.</span></span> <span data-ttu-id="2a9a9-141">Die-Methode gibt ein Array von [**DXVA2 \_ configpicturedecode**](/windows/desktop/api/dxva2api/ns-dxva2api-dxva2_configpicturedecode) -Strukturen zurück.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-141">The method returns an array of [**DXVA2\_ConfigPictureDecode**](/windows/desktop/api/dxva2api/ns-dxva2api-dxva2_configpicturedecode) structures.</span></span> <span data-ttu-id="2a9a9-142">Jede Struktur beschreibt eine mögliche Konfiguration für das Decoder-Gerät.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-142">Each structure describes one possible configuration for the decoder device.</span></span> <span data-ttu-id="2a9a9-143">Suchen Sie nach einer Konfiguration, die vom Decoder unterstützt wird.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-143">Look for a configuration that the decoder supports.</span></span>
6.  <span data-ttu-id="2a9a9-144">Speichert das renderzielformat und die Konfiguration.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-144">Store the render target format and configuration.</span></span>

<span data-ttu-id="2a9a9-145">Geben Sie in der [**imftransform:: getoutputavailabletype**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) -Methode basierend auf dem vorgeschlagenen renderzielformat ein unkomprimiertes Videoformat zurück.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-145">In the [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) method, return an uncompressed video format, based on the proposed render target format.</span></span>

<span data-ttu-id="2a9a9-146">Überprüfen Sie in der [**IMF Transform:: setoutputtype**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) -Methode den Medientyp auf das renderzielformat.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-146">In the [**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) method, check the media type against the render target format.</span></span>

### <a name="fallback-to-software-decoding"></a><span data-ttu-id="2a9a9-147">Fallback auf Software Decodierung</span><span class="sxs-lookup"><span data-stu-id="2a9a9-147">Fallback to Software Decoding</span></span>

<span data-ttu-id="2a9a9-148">Wenn die MFT eine DXVA-Konfiguration nicht finden kann (z. b. wenn der Grafiktreiber nicht über die richtigen Funktionen verfügt), sollte der Fehlercode **MF \_ E \_ nicht unterstützter \_ D3D- \_ Typ** aus den Methoden [**setinputtype**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) und [**setoutputtype**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-148">If the MFT cannot find a DXVA configuration (for example, if the graphics driver does not have the right capabilities), it should return the error code **MF\_E\_UNSUPPORTED\_D3D\_TYPE** from the [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) and [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) methods.</span></span> <span data-ttu-id="2a9a9-149">Das topologielader antwortet, indem er die [**MFT \_ Message \_ Set \_ D3D \_ Manager**](mft-message-set-d3d-manager.md) -Nachricht mit dem Wert **null** für den *ulparam* -Parameter sendet.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-149">The topology loader will respond by sending the [**MFT\_MESSAGE\_SET\_D3D\_MANAGER**](mft-message-set-d3d-manager.md) message with the value **NULL** for the *ulParam* parameter.</span></span> <span data-ttu-id="2a9a9-150">Der MFT sollte seinen Zeiger auf die [**IDirect3DDeviceManager9**](/windows/desktop/api/dxva2api/nn-dxva2api-idirect3ddevicemanager9) -Schnittstelle freigeben.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-150">The MFT should release its pointer to the [**IDirect3DDeviceManager9**](/windows/desktop/api/dxva2api/nn-dxva2api-idirect3ddevicemanager9) interface.</span></span> <span data-ttu-id="2a9a9-151">Das topologielader wird dann den Medientyp erneut aushandeln, und die MFT kann Software Decodierung verwenden.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-151">The topology loader will then renegotiate the media type, and the MFT can use software decoding.</span></span>

## <a name="allocating-uncompressed-buffers"></a><span data-ttu-id="2a9a9-152">Zuordnen von nicht komprimierten Puffern</span><span class="sxs-lookup"><span data-stu-id="2a9a9-152">Allocating Uncompressed Buffers</span></span>

<span data-ttu-id="2a9a9-153">In DXVA 2,0 ist der Decoder für das Zuordnen von Direct3D-Oberflächen zur Verwendung als nicht komprimierte Video Puffer verantwortlich.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-153">In DXVA 2.0, the decoder is responsible for allocating Direct3D surfaces to use as uncompressed video buffers.</span></span> <span data-ttu-id="2a9a9-154">Der Decoder sollte drei Oberflächen zuordnen, die der EVR für Deinterlacing verwenden soll.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-154">The decoder should allocate 3 surfaces for the EVR to use for deinterlacing.</span></span> <span data-ttu-id="2a9a9-155">Diese Zahl ist korrigiert, da Media Foundation keine Möglichkeit bietet, den EVR anzugeben, wie viele Oberflächen der Grafiktreiber für Deinterlacing benötigt.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-155">This number is fixed, because Media Foundation does not provide a way for the EVR to specify how many surfaces the graphics driver requires for deinterlacing.</span></span> <span data-ttu-id="2a9a9-156">Für jeden Treiber sollten drei Oberflächen ausreichen.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-156">Three surfaces should be sufficient for any driver.</span></span>

<span data-ttu-id="2a9a9-157">Legen Sie in der [**imftransform:: getoutputstreaminfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) -Methode den **MFT- \_ Ausgabestream \_ \_ enthält \_** ein beispielflag in der [**MFT- \_ Ausgabestream- \_ \_ Informations**](/windows/desktop/api/mftransform/ns-mftransform-mft_output_stream_info) Struktur fest.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-157">In the [**IMFTransform::GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method, set the **MFT\_OUTPUT\_STREAM\_PROVIDES\_SAMPLES** flag in the [**MFT\_OUTPUT\_STREAM\_INFO**](/windows/desktop/api/mftransform/ns-mftransform-mft_output_stream_info) structure.</span></span> <span data-ttu-id="2a9a9-158">Dieses Flag benachrichtigt die Medien Sitzung, dass der MFT seine eigenen Ausgabe Beispiele zuweist.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-158">This flag notifies the Media Session that the MFT allocates its own output samples.</span></span>

<span data-ttu-id="2a9a9-159">Rufen Sie zum Erstellen der Oberflächen [**idirectxvideoaccelerationservice:: CreateSurface**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideoaccelerationservice-createsurface)auf.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-159">To create the surfaces, call [**IDirectXVideoAccelerationService::CreateSurface**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideoaccelerationservice-createsurface).</span></span> <span data-ttu-id="2a9a9-160">(Die [**idirectxvideodecoderservice**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideodecoderservice) -Schnittstelle erbt diese Methode von [**idirectxvideoaccelerationservice**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideoaccelerationservice).) Sie können dies in [**setinputtype**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype)tun, nachdem Sie das renderzielformat gefunden haben.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-160">(The [**IDirectXVideoDecoderService**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideodecoderservice) interface inherits this method from [**IDirectXVideoAccelerationService**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideoaccelerationservice).) You can do this in [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype), after finding the render target format.</span></span>

<span data-ttu-id="2a9a9-161">Rufen Sie für jede Oberfläche [**mfcreatevideosamplefromsurface**](/windows/desktop/api/evr/nc-evr-mfcreatevideosamplefromsurface) auf, um ein Medien Beispiel zu erstellen, das die Oberfläche enthält.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-161">For each surface, call [**MFCreateVideoSampleFromSurface**](/windows/desktop/api/evr/nc-evr-mfcreatevideosamplefromsurface) to create a media sample to hold the surface.</span></span> <span data-ttu-id="2a9a9-162">Die-Methode gibt einen Zeiger auf die [**imfsample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) -Schnittstelle zurück.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-162">The method returns a pointer to the [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) interface.</span></span>

## <a name="decoding"></a><span data-ttu-id="2a9a9-163">Decodierung</span><span class="sxs-lookup"><span data-stu-id="2a9a9-163">Decoding</span></span>

<span data-ttu-id="2a9a9-164">Um das Decoder-Gerät zu erstellen, rufen Sie [**idirectxvideodecoderservice:: createvideodecoder**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoderservice-createvideodecoder)auf.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-164">To create the decoder device, call [**IDirectXVideoDecoderService::CreateVideoDecoder**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoderservice-createvideodecoder).</span></span> <span data-ttu-id="2a9a9-165">Die-Methode gibt einen Zeiger auf die [**idirectxvideodecoder**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideodecoder) -Schnittstelle des Decoder-Geräts zurück.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-165">The method returns a pointer to the [**IDirectXVideoDecoder**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideodecoder) interface of the decoder device.</span></span>

<span data-ttu-id="2a9a9-166">Die Decodierung sollte in der [**IMF Transform::P rocess Output**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) -Methode erfolgen.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-166">Decoding should occur inside the [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method.</span></span> <span data-ttu-id="2a9a9-167">Bei jedem Frame wird [**IDirect3DDeviceManager9:: testdevice**](/windows/desktop/api/dxva2api/nf-dxva2api-idirect3ddevicemanager9-testdevice) aufgerufen, um das Geräte Handle zu testen.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-167">On each frame, call [**IDirect3DDeviceManager9::TestDevice**](/windows/desktop/api/dxva2api/nf-dxva2api-idirect3ddevicemanager9-testdevice) to test the device handle.</span></span> <span data-ttu-id="2a9a9-168">Wenn sich das Gerät geändert hat, gibt die Methode **DXVA2 \_ E \_ New \_ Video \_ Device** zurück.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-168">If the device has changed, the method returns **DXVA2\_E\_NEW\_VIDEO\_DEVICE**.</span></span> <span data-ttu-id="2a9a9-169">Wenn dies der Fall ist, gehen Sie wie folgt vor:</span><span class="sxs-lookup"><span data-stu-id="2a9a9-169">If this occurs, do the following:</span></span>

1.  <span data-ttu-id="2a9a9-170">Schließen Sie das Geräte Handle durch Aufrufen von [**IDirect3DDeviceManager9:: closedevicehandle**](/windows/desktop/api/dxva2api/nf-dxva2api-idirect3ddevicemanager9-closedevicehandle).</span><span class="sxs-lookup"><span data-stu-id="2a9a9-170">Close the device handle by calling [**IDirect3DDeviceManager9::CloseDeviceHandle**](/windows/desktop/api/dxva2api/nf-dxva2api-idirect3ddevicemanager9-closedevicehandle).</span></span>
2.  <span data-ttu-id="2a9a9-171">Geben Sie die Zeiger [**idirectxvideodecoderservice**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideodecoderservice) und [**idirectxvideodecoder**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideodecoder) frei.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-171">Release the [**IDirectXVideoDecoderService**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideodecoderservice) and [**IDirectXVideoDecoder**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideodecoder) pointers.</span></span>
3.  <span data-ttu-id="2a9a9-172">Öffnen Sie ein neues Geräte handle.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-172">Open a new device handle.</span></span>
4.  <span data-ttu-id="2a9a9-173">Aushandeln Sie eine neue decoderkonfiguration, wie unter "Suchen einer decoderkonfiguration" weiter oben auf dieser Seite beschrieben.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-173">Negotiate a new decoder configuration, as described in "Finding a Decoder Configuration" earlier on this page.</span></span>
5.  <span data-ttu-id="2a9a9-174">Erstellen Sie ein neues Decoder-Gerät.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-174">Create a new decoder device.</span></span>

<span data-ttu-id="2a9a9-175">Wenn das Geräte Handle gültig ist, funktioniert der Decodierungs Prozess wie folgt:</span><span class="sxs-lookup"><span data-stu-id="2a9a9-175">Assuming that the device handle is valid, the decoding process works as follows:</span></span>

1.  <span data-ttu-id="2a9a9-176">Sie erhalten eine verfügbare Oberfläche, die derzeit nicht verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-176">Get an available surface that is not currently in use.</span></span> <span data-ttu-id="2a9a9-177">(Anfänglich sind alle Oberflächen verfügbar.)</span><span class="sxs-lookup"><span data-stu-id="2a9a9-177">(Initially all of the surfaces are available.)</span></span>
2.  <span data-ttu-id="2a9a9-178">Fragen Sie das Medien Beispiel nach der [**IMF trackedsample**](/windows/win32/api/mfidl/nn-mfidl-imftrackedsample) -Schnittstelle ab.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-178">Query the media sample for the [**IMFTrackedSample**](/windows/win32/api/mfidl/nn-mfidl-imftrackedsample) interface.</span></span>
3.  <span data-ttu-id="2a9a9-179">Aufrufen von [**imftrackedsample:: abtallocator**](/windows/win32/api/mfidl/nf-mfidl-imftrackedsample-setallocator) und Bereitstellen eines Zeigers auf die [**imfasynccallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) -Schnittstelle, die vom Decoder implementiert wird.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-179">Call [**IMFTrackedSample::SetAllocator**](/windows/win32/api/mfidl/nf-mfidl-imftrackedsample-setallocator) and provide a pointer to the [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) interface, implemented by the decoder.</span></span> <span data-ttu-id="2a9a9-180">Wenn der Videorenderer das Beispiel freigibt, wird der Rückruf des Decoders aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-180">When the video renderer releases the sample, the decoder's callback will be invoked.</span></span>
4.  <span data-ttu-id="2a9a9-181">Aufrufen von [**idirectxvideodecoder:: beginFrame**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-beginframe).</span><span class="sxs-lookup"><span data-stu-id="2a9a9-181">Call [**IDirectXVideoDecoder::BeginFrame**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-beginframe).</span></span>
5.  <span data-ttu-id="2a9a9-182">Führen Sie die folgenden Schritte aus:</span><span class="sxs-lookup"><span data-stu-id="2a9a9-182">Do the following one or more times:</span></span>
    1.  <span data-ttu-id="2a9a9-183">Aufrufen von [**idirectxvideodecoder:: GetBuffer**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-getbuffer) zum Abrufen eines DXVA-decoderpuffers.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-183">Call [**IDirectXVideoDecoder::GetBuffer**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-getbuffer) to get a DXVA decoder buffer.</span></span>
    2.  <span data-ttu-id="2a9a9-184">Füllen Sie den Puffer aus.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-184">Fill the buffer.</span></span>
    3.  <span data-ttu-id="2a9a9-185">Nennen Sie [**idirectxvideodecoder:: ReleaseBuffer**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-releasebuffer).</span><span class="sxs-lookup"><span data-stu-id="2a9a9-185">Call [**IDirectXVideoDecoder::ReleaseBuffer**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-releasebuffer).</span></span>
    4.  <span data-ttu-id="2a9a9-186">Nennen Sie [**idirectxvideodecoder:: Execute**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-execute) , um die Decodierungs Vorgänge für den Frame auszuführen.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-186">Call [**IDirectXVideoDecoder::Execute**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-execute) to perform the decoding operations on the frame.</span></span>

<span data-ttu-id="2a9a9-187">DXVA 2,0 verwendet die gleichen Datenstrukturen wie DXVA 1,0 für Decodierungs Vorgänge.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-187">DXVA 2.0 uses the same data structures as DXVA 1.0 for decoding operations.</span></span> <span data-ttu-id="2a9a9-188">Für den ursprünglichen Satz von DXVA-Profilen (für h. 261, h. 263 und MPEG-2) werden diese Datenstrukturen in der [Spezifikation DXVA 1,0](/windows-hardware/drivers/display/directx-video-acceleration)beschrieben.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-188">For the original set of DXVA profiles (for H.261, H.263, and MPEG-2), these data structures are described in the [DXVA 1.0 specification](/windows-hardware/drivers/display/directx-video-acceleration).</span></span>

<span data-ttu-id="2a9a9-189">In jedem Paar von [**beginFrame**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-beginframe)- / [**Execute**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-execute) -aufrufen können Sie [**GetBuffer**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-getbuffer) mehrmals aufrufen, aber nur einmal für jeden DXVA-Puffer.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-189">Within each pair of [**BeginFrame**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-beginframe)/[**Execute**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-execute) calls, you may call [**GetBuffer**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-getbuffer) multiple times, but only once for each type of DXVA buffer.</span></span> <span data-ttu-id="2a9a9-190">Wenn Sie es zweimal mit dem gleichen Puffertyp aufzurufen, überschreiben Sie die Daten.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-190">If you call it twice with the same buffer type, you will overwrite the data.</span></span>

<span data-ttu-id="2a9a9-191">Verwenden [**Sie den Rückruf der Methode "**](/windows/win32/api/mfidl/nf-mfidl-imftrackedsample-setallocator) -Methode" (Schritt 3), um nachzuverfolgen, welche Beispiele derzeit verfügbar sind und welche verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="2a9a9-191">Use the callback from the [**SetAllocator**](/windows/win32/api/mfidl/nf-mfidl-imftrackedsample-setallocator) method (step 3) to keep track of which samples are currently available and which are in use.</span></span>

## <a name="related-topics"></a><span data-ttu-id="2a9a9-192">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="2a9a9-192">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="2a9a9-193">DirectX-Video Beschleunigung 2,0</span><span class="sxs-lookup"><span data-stu-id="2a9a9-193">DirectX Video Acceleration 2.0</span></span>](directx-video-acceleration-2-0.md)
</dt> <dt>

[<span data-ttu-id="2a9a9-194">Media Foundation Transformationen</span><span class="sxs-lookup"><span data-stu-id="2a9a9-194">Media Foundation Transforms</span></span>](media-foundation-transforms.md)
</dt> </dl>

 

 
