---
description: 'In diesem Thema werden drei miteinander verbundene Themen erläutert: geschützte Umgebung, Medien Interoperabilitäts Gateway und Sperrung und Verlängerung.'
ms.assetid: e88806ae-0041-4b4a-a8df-69718a651e82
title: Geschützter Medien Pfad
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7304edadf1623d41bc2f1f5c6b2b4cda2dd5f598
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/03/2021
ms.locfileid: "104555414"
---
# <a name="protected-media-path"></a><span data-ttu-id="c5d6a-103">Geschützter Medien Pfad</span><span class="sxs-lookup"><span data-stu-id="c5d6a-103">Protected Media Path</span></span>

<span data-ttu-id="c5d6a-104">In diesem Thema werden drei miteinander verbundene Themen erläutert: geschützte Umgebung, Medien Interoperabilitäts Gateway und Sperrung und Verlängerung.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-104">This topic discusses three interrelated topics: protected environment, media interoperability gateway, and revocation and renewal.</span></span>

-   <span data-ttu-id="c5d6a-105">Bei einer geschützten Umgebung (PE) handelt es sich um eine Reihe von Technologien, mit denen geschützte Inhalte auf geschützte Weise von und in Windows Vista übertragen werden können.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-105">A protected environment (PE) is a set of technologies that enables protected content to flow from and through Windows Vista in a protected fashion.</span></span> <span data-ttu-id="c5d6a-106">Alle Komponenten in einer geschützten Umgebung werden als vertrauenswürdig eingestuft, und der Prozess wird vor Manipulationen geschützt.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-106">All components inside a protected environment are trusted and the process is protected against tampering.</span></span>
-   <span data-ttu-id="c5d6a-107">Der geschützte Medien Pfad (PMP) ist eine ausführbare Datei, die in einer geschützten Umgebung ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-107">The protected media path (PMP) is an executable that runs in a protected environment.</span></span>
-   <span data-ttu-id="c5d6a-108">Wenn eine vertrauenswürdige Komponente im PE kompromittiert wird, wird Sie nach der fälligen Verarbeitung widerrufen.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-108">If a trusted component in the PE becomes compromised, after due process it will be revoked.</span></span> <span data-ttu-id="c5d6a-109">Microsoft bietet jedoch einen Erneuerungs Mechanismus, mit dem eine neuere vertrauenswürdige Version der Komponente installiert wird, sobald eine verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-109">However, Microsoft provides a renewal mechanism to install a newer trusted version of the component when one becomes available.</span></span>

<span data-ttu-id="c5d6a-110">Weitere Informationen zur Code Signierung geschützter Medienkomponenten finden Sie im Whitepaper [Code Signing for Protected Media Components in Windows Vista](/windows-hardware/test/hlk/).</span><span class="sxs-lookup"><span data-stu-id="c5d6a-110">For information about code signing protected media components, see the white paper [Code Signing for Protected Media Components in Windows Vista](/windows-hardware/test/hlk/).</span></span>

<span data-ttu-id="c5d6a-111">Dieses Thema enthält folgende Abschnitte:</span><span class="sxs-lookup"><span data-stu-id="c5d6a-111">This topic contains the following sections:</span></span>

-   [<span data-ttu-id="c5d6a-112">Geschützte Umgebung</span><span class="sxs-lookup"><span data-stu-id="c5d6a-112">Protected Environment</span></span>](#protected-environment)
-   [<span data-ttu-id="c5d6a-113">Entwurf der geschützten Umgebung</span><span class="sxs-lookup"><span data-stu-id="c5d6a-113">Design of the Protected Environment</span></span>](#design-of-the-protected-environment)
-   [<span data-ttu-id="c5d6a-114">Geschützter Medien Pfad</span><span class="sxs-lookup"><span data-stu-id="c5d6a-114">Protected Media Path</span></span>](#protected-media-path)
    -   [<span data-ttu-id="c5d6a-115">Eingabe Vertrauensstellungs Autorität</span><span class="sxs-lookup"><span data-stu-id="c5d6a-115">Input Trust Authorities</span></span>](#input-trust-authorities)
    -   [<span data-ttu-id="c5d6a-116">Ausgabe Vertrauensstellungs Behörden</span><span class="sxs-lookup"><span data-stu-id="c5d6a-116">Output Trust Authorities</span></span>](#output-trust-authorities)
    -   [<span data-ttu-id="c5d6a-117">Richtlinien Objekte</span><span class="sxs-lookup"><span data-stu-id="c5d6a-117">Policy Objects</span></span>](#policy-objects)
    -   [<span data-ttu-id="c5d6a-118">Erstellen von Objekten im PMP</span><span class="sxs-lookup"><span data-stu-id="c5d6a-118">Creating Objects in the PMP</span></span>](#creating-objects-in-the-pmp)
-   [<span data-ttu-id="c5d6a-119">Übersicht über die Richtlinien Aushandlung</span><span class="sxs-lookup"><span data-stu-id="c5d6a-119">Overview of Policy Negotiation</span></span>](#overview-of-policy-negotiation)
-   [<span data-ttu-id="c5d6a-120">Sperrung und Verlängerung</span><span class="sxs-lookup"><span data-stu-id="c5d6a-120">Revocation and Renewal</span></span>](#revocation-and-renewal)
-   [<span data-ttu-id="c5d6a-121">Ausgabe Link Schutz</span><span class="sxs-lookup"><span data-stu-id="c5d6a-121">Output Link Protection</span></span>](#output-link-protection)
-   [<span data-ttu-id="c5d6a-122">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="c5d6a-122">Related topics</span></span>](#related-topics)

## <a name="protected-environment"></a><span data-ttu-id="c5d6a-123">Geschützte Umgebung</span><span class="sxs-lookup"><span data-stu-id="c5d6a-123">Protected Environment</span></span>

<span data-ttu-id="c5d6a-124">Der Inhalts Schutz umfasst mehrere Technologien, von denen jede versucht, sicherzustellen, dass Inhalte nicht in einer Weise verwendet werden können, die nicht mit der Absicht des Inhalts Besitzers oder-Anbieters konsistent ist.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-124">Content protection encompasses multiple technologies, each of which attempts to ensure that content cannot be used in a way that is inconsistent with the intent of the content owner or provider.</span></span> <span data-ttu-id="c5d6a-125">Diese Technologien umfassen den Kopierschutz, den Link Schutz, den bedingten Zugriff und Digital Rights Management (DRM).</span><span class="sxs-lookup"><span data-stu-id="c5d6a-125">These technologies include copy protection, link protection, conditional access, and digital rights management (DRM).</span></span> <span data-ttu-id="c5d6a-126">Die Grundlage der einzelnen Vertrauens Stellungen besteht darin, dass der Zugriff auf den Inhalt nur Softwarekomponenten gewährt wird, die den Nutzungsbedingungen entsprechen, die diesem Inhalt zugewiesen sind.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-126">The foundation of each is trust: Access to the content is granted only to software components that adhere to the terms of use assigned to that content.</span></span>

<span data-ttu-id="c5d6a-127">Um Bedrohungen gegen geschützte Inhalte zu minimieren, ermöglichen Windows Vista und Media Foundation Software vertrauenswürdigen Code, der in einer geschützten Umgebung ausgeführt werden kann.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-127">To minimize threats against protected content, Windows Vista and Media Foundation Software enable trusted code to run in a protected environment.</span></span> <span data-ttu-id="c5d6a-128">Ein PE besteht aus einer Reihe von Komponenten, Richtlinien und Tools, mit denen der Schutz gegen Inhalts Piraterie erhöht werden kann.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-128">A PE is a set of components, guidelines, and tools designed to increase protection against content piracy.</span></span>

<span data-ttu-id="c5d6a-129">Bevor Sie die PE genauer untersuchen, ist es wichtig, die Bedrohungen zu verstehen, die für eine Minimierung entwickelt wurden.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-129">Before examining the PE more closely, it is important to understand the threats it is designed to minimize.</span></span> <span data-ttu-id="c5d6a-130">Angenommen, Sie führen eine Medien Anwendung in einem Benutzermodusprozess aus.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-130">Suppose you are running a media application in a user-mode process.</span></span> <span data-ttu-id="c5d6a-131">Die Anwendung ist mit den verschiedenen DLLs (Dynamic Link Libraries) verknüpft, die Medien-Plug-ins (z. b. Decoders) enthalten.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-131">The application is linked to the various dynamic link libraries (DLLs) that contain media plug-ins, such as decoders.</span></span> <span data-ttu-id="c5d6a-132">Andere Prozesse werden ebenfalls im Benutzermodus ausgeführt, und verschiedene Treiber werden in den Kernel geladen.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-132">Other processes are also running in user mode, and various drivers are loaded in the kernel.</span></span> <span data-ttu-id="c5d6a-133">Wenn kein Vertrauens Mechanismus vorhanden ist, sind die folgenden Bedrohungen vorhanden:</span><span class="sxs-lookup"><span data-stu-id="c5d6a-133">If no trust mechanism is in place, the following threats exist:</span></span>

-   <span data-ttu-id="c5d6a-134">Die Anwendung kann direkt auf geschützte Medien zugreifen oder den Prozess Speicher hacken.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-134">The application can access protected media directly or hack the process memory.</span></span>
-   <span data-ttu-id="c5d6a-135">Plug-Ins können direkt auf den Inhalt zugreifen oder den Prozess Speicher hacken.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-135">Plug-ins can access the content directly or hack the process memory.</span></span>
-   <span data-ttu-id="c5d6a-136">Andere Prozesse können den Medien Prozess Speicher entweder direkt oder durch Einfügen von Code hacken.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-136">Other processes can hack the media process memory either directly or by injecting code.</span></span>
-   <span data-ttu-id="c5d6a-137">Kernel Treiber können den Medien Prozess Speicher hacken.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-137">Kernel drivers can hack the media process memory.</span></span>
-   <span data-ttu-id="c5d6a-138">Der Inhalt kann über ein ungeschütztes Medium außerhalb des Systems gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-138">Content might be sent outside the system over an unprotected medium.</span></span> <span data-ttu-id="c5d6a-139">(Der Link Schutz ist dafür ausgelegt, diese Bedrohung zu mindern.)</span><span class="sxs-lookup"><span data-stu-id="c5d6a-139">(Link protection is designed to mitigate against this threat.)</span></span>

## <a name="design-of-the-protected-environment"></a><span data-ttu-id="c5d6a-140">Entwurf der geschützten Umgebung</span><span class="sxs-lookup"><span data-stu-id="c5d6a-140">Design of the Protected Environment</span></span>

<span data-ttu-id="c5d6a-141">Eine geschützte Umgebung wird in einem separaten geschützten Prozess von der Medien Anwendung ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-141">A protected environment runs in a separate protected process from the media application.</span></span> <span data-ttu-id="c5d6a-142">Mit dem geschützten Prozess Feature von Windows Vista wird verhindert, dass andere Prozesse auf den geschützten Prozess zugreifen.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-142">The protected process feature of Windows Vista stops other processes from accessing the protected process.</span></span>

<span data-ttu-id="c5d6a-143">Wenn ein geschützter Prozess erstellt wird, identifizieren Kern-Kernel Komponenten nicht vertrauenswürdige Komponenten und Plug-ins, sodass Sie von der geschützten Umgebung nicht geladen werden können.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-143">When a protected process is created, core kernel components identify untrusted components and plug-ins so that the protected environment can refuse to load them.</span></span> <span data-ttu-id="c5d6a-144">Eine vertrauenswürdige Komponente wurde von Microsoft entsprechend signiert.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-144">A trusted component is one that has been appropriately signed by Microsoft.</span></span> <span data-ttu-id="c5d6a-145">Der Kernel verfolgt auch Module, die darin geladen werden, sodass die geschützte Umgebung die Wiedergabe geschützter Inhalte nicht beenden kann, wenn ein nicht vertrauenswürdiges Modul geladen wird.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-145">The kernel also tracks modules that load into it, enabling the protected environment to stop playback of protected content if an untrusted module is loaded.</span></span> <span data-ttu-id="c5d6a-146">Bevor eine Kernel Komponente geladen wird, überprüft der Kernel, ob er vertrauenswürdig ist.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-146">Before a kernel component is loaded, the kernel checks to determine whether it is trusted.</span></span> <span data-ttu-id="c5d6a-147">Wenn dies nicht der Fall ist, lehnen vertrauenswürdige Komponenten, die bereits in der PE vorhanden sind, geschützte Inhalte ab.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-147">If it is not, trusted components already in the PE refuse to process protected content.</span></span> <span data-ttu-id="c5d6a-148">Um dies zu ermöglichen, führen PE-Komponenten in regelmäßigen Abständen einen kryptografisch geschützten Handshake mit dem Kernel aus.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-148">To enable this, PE components periodically perform a cryptographically-protected handshake with the kernel.</span></span> <span data-ttu-id="c5d6a-149">Wenn eine nicht vertrauenswürdige Kernelmoduskomponente vorhanden ist, schlägt der Handshake fehl und gibt dem PE an, dass eine nicht vertrauenswürdige Komponente vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-149">If an untrusted kernel mode component is present, the handshake fails and indicates to the PE that an untrusted component exists.</span></span>

<span data-ttu-id="c5d6a-150">Wenn eine vertrauenswürdige Komponente kompromittiert wird, kann Sie nach dem Fälligkeits Vorgang widerrufen werden.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-150">If a trusted component becomes compromised, after due process it can be revoked.</span></span> <span data-ttu-id="c5d6a-151">Microsoft bietet einen Erneuerungs Mechanismus zur Installation einer neueren vertrauenswürdigen Version, falls verfügbar.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-151">Microsoft provides a renewal mechanism to install a newer trusted version when available.</span></span>

## <a name="protected-media-path"></a><span data-ttu-id="c5d6a-152">Geschützter Medien Pfad</span><span class="sxs-lookup"><span data-stu-id="c5d6a-152">Protected Media Path</span></span>

<span data-ttu-id="c5d6a-153">Der geschützte Medien Pfad (PMP) ist die primäre ausführbare PE-Datei für Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-153">The protected media path (PMP) is the primary PE executable for Media Foundation.</span></span> <span data-ttu-id="c5d6a-154">Das PMP ist erweiterbar, sodass Schutzmechanismen von Drittanbietern unterstützt werden können.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-154">The PMP is extensible, so that third-party content protection mechanisms can be supported.</span></span>

<span data-ttu-id="c5d6a-155">Das PMP akzeptiert geschützte Inhalte und zugehörige Richtlinien aus beliebigen Media Foundation Quellen unter Verwendung eines beliebigen Inhalts Schutzsystems, einschließlich derjenigen, die von Drittanbietern bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-155">The PMP accepts protected content and associated policies from any Media Foundation source using any content protection system, including those provided by third parties.</span></span> <span data-ttu-id="c5d6a-156">Der Inhalt wird an alle Media Foundation Senke gesendet, solange die Senke den von der Quelle angegebenen Richtlinien entspricht.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-156">It sends content to any Media Foundation sink, as long as the sink complies with the policies specified by the source.</span></span> <span data-ttu-id="c5d6a-157">Außerdem werden Transformationen zwischen der Quelle und der Senke unterstützt, einschließlich Transformationen von Drittanbietern, solange Sie vertrauenswürdig sind.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-157">It also supports transforms between the source and the sink, including third-party transforms, as long as they are trusted.</span></span>

<span data-ttu-id="c5d6a-158">Das PMP wird in einem geschützten Prozess ausgeführt, der von der Medien Anwendung isoliert ist.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-158">The PMP runs in a protected process isolated from the media application.</span></span> <span data-ttu-id="c5d6a-159">Die Anwendung kann nur Befehls-und Steuerungs Meldungen mit dem PMP austauschen, hat aber keinen Zugriff auf Inhalte, nachdem Sie an das PMP übergeben wurde.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-159">The application only has the ability to exchange command and control messages with the PMP, but does not have access to content after it is passed to the PMP.</span></span> <span data-ttu-id="c5d6a-160">Dieser Prozess wird anhand des folgenden Diagramms veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-160">The following diagram illustrates this process.</span></span>

![Diagramm des Pfads geschützter Medien](images/pmp04.png)

<span data-ttu-id="c5d6a-162">Schattierte Felder stellen Komponenten dar, die von Drittanbietern bereitgestellt werden können.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-162">Shaded boxes represent components that might be provided by third parties.</span></span> <span data-ttu-id="c5d6a-163">Alle Komponenten, die im geschützten Prozess erstellt werden, müssen signiert und vertrauenswürdig sein.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-163">All components created inside the protected process must be signed and trusted.</span></span>

<span data-ttu-id="c5d6a-164">Die Anwendung erstellt eine Instanz der Medien Sitzung innerhalb des geschützten Prozesses und empfängt einen Zeiger auf eine Proxy Medien Sitzung, die Schnittstellen Zeiger über die Prozess Grenze hinweg marshunkt.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-164">The application creates an instance of the Media Session inside the protected process and receives a pointer to a proxy Media Session, which marshals interface pointers across the process boundary.</span></span>

<span data-ttu-id="c5d6a-165">Die Medienquelle kann entweder innerhalb des Anwendungsprozesses, wie hier gezeigt, oder innerhalb des geschützten Prozesses erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-165">The media source can be created either within the application process, as shown here, or inside the protected process.</span></span> <span data-ttu-id="c5d6a-166">Wenn die Medienquelle innerhalb des Anwendungsprozesses erstellt wird, erstellt die Quelle im geschützten Prozess einen Proxy für sich selbst.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-166">If the media source is created inside the application process, the source creates a proxy for itself in the protected process.</span></span>

<span data-ttu-id="c5d6a-167">Alle anderen Pipeline Komponenten, z. b. Decoder und Medien senken, werden im geschützten Prozess erstellt.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-167">All other pipeline components, such as decoders and media sinks, are created in the protected process.</span></span> <span data-ttu-id="c5d6a-168">Wenn diese Objekte benutzerdefinierte Schnittstellen für Anwendungen verfügbar machen, müssen Sie einen DCOM-Proxy/Stub bereitstellen, um die Schnittstelle zu Mars Hallen.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-168">If these objects expose any custom interfaces for applications, they must provide a DCOM proxy/stub to marshal the interface.</span></span>

<span data-ttu-id="c5d6a-169">Zum Erzwingen einer Richtlinie für geschützte Inhalte beim Durchlaufen der Pipeline verwendet das PMP drei Arten von Komponenten: Input Trust Autoritäten (ITAs), Output Trust Autoritäten (OTAS) und Policy Objects.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-169">To enforce policy on protected content as it flows through the pipeline, the PMP uses three types of components: input trust authorities (ITAs), output trust authorities (OTAs), and policy objects.</span></span> <span data-ttu-id="c5d6a-170">Diese Komponenten arbeiten zusammen, um Rechte zur Verwendung von Inhalten zu erteilen oder einzuschränken sowie um die Link Schutzmaßnahmen anzugeben, die bei der Wiedergabe von Inhalten verwendet werden müssen, z. b. HDCP (High-Bandwidth Digital Content Protection).</span><span class="sxs-lookup"><span data-stu-id="c5d6a-170">These components work together to grant or restrict rights to use content, and to specify the link protections that must be employed when playing content, such as High-bandwidth Digital Content Protection (HDCP).</span></span>

### <a name="input-trust-authorities"></a><span data-ttu-id="c5d6a-171">Eingabe Vertrauensstellungs Autorität</span><span class="sxs-lookup"><span data-stu-id="c5d6a-171">Input Trust Authorities</span></span>

<span data-ttu-id="c5d6a-172">Eine ITA wird von einer vertrauenswürdigen Medienquelle erstellt und führt mehrere Funktionen aus:</span><span class="sxs-lookup"><span data-stu-id="c5d6a-172">An ITA is created by a trusted media source, and performs several functions:</span></span>

-   <span data-ttu-id="c5d6a-173">Gibt die Rechte für die Verwendung von Inhalten an.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-173">Specifies rights to use content.</span></span> <span data-ttu-id="c5d6a-174">Rechte können das Recht enthalten, Inhalte wiederzugeben, auf ein Gerät zu übertragen usw.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-174">Rights can include the right to play content, transfer it to a device, and so on.</span></span> <span data-ttu-id="c5d6a-175">Es definiert eine geordnete Liste genehmigter Ausgabe Schutzsysteme und die entsprechenden Ausgabe Richtlinien für jedes System.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-175">It defines an ordered list of approved output protection systems and the corresponding output policies for each system.</span></span> <span data-ttu-id="c5d6a-176">Die ITA speichert diese Informationen in einem Richtlinien Objekt.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-176">The ITA stores this information in a policy object.</span></span>
-   <span data-ttu-id="c5d6a-177">Stellt den entschlüsselten zum Entschlüsseln des Inhalts bereit.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-177">Provides the decryptor needed to decrypt the content.</span></span>
-   <span data-ttu-id="c5d6a-178">Stellt eine Vertrauensstellung mit dem Kernelmodul in der geschützten Umgebung her, um sicherzustellen, dass die ITA in einer vertrauenswürdigen Umgebung ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-178">Establishes trust with the kernel module in the protected environment, to ensure that the ITA is running inside a trusted environment.</span></span>

<span data-ttu-id="c5d6a-179">Eine ITA ist einem einzelnen Stream zugeordnet, der geschützte Inhalte enthält.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-179">An ITA is associated with an individual stream containing protected content.</span></span> <span data-ttu-id="c5d6a-180">Ein Datenstrom kann nur über eine ITA verfügen, und eine Instanz einer ITA kann nur einem Stream zugeordnet werden.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-180">A stream can have only one ITA, and an instance of an ITA can be associated with only one stream.</span></span>

### <a name="output-trust-authorities"></a><span data-ttu-id="c5d6a-181">Ausgabe Vertrauensstellungs Behörden</span><span class="sxs-lookup"><span data-stu-id="c5d6a-181">Output Trust Authorities</span></span>

<span data-ttu-id="c5d6a-182">Eine OTA ist einer vertrauenswürdigen Ausgabe zugeordnet.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-182">An OTA is associated with a trusted output.</span></span> <span data-ttu-id="c5d6a-183">Die OTA macht eine Aktion verfügbar, die von der vertrauenswürdigen Ausgabe für den Inhalt ausgeführt werden kann, z. b. Wiedergabe oder kopieren.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-183">The OTA exposes an action that the trusted output can perform on the content, such as playback or copying.</span></span> <span data-ttu-id="c5d6a-184">Seine Rolle besteht darin, ein oder mehrere für die ITA erforderliche Ausgabe Schutzsysteme zu erzwingen.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-184">Its role is to enforce one or more output protection systems that are required by the ITA.</span></span> <span data-ttu-id="c5d6a-185">Das OTA fragt das von ITA bereitgestellte Richtlinien Objekt ab, um zu bestimmen, welches Schutzsystem es erzwingen muss.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-185">The OTA queries the policy object provided by ITA to determine which protection system it must enforce.</span></span>

### <a name="policy-objects"></a><span data-ttu-id="c5d6a-186">Richtlinien Objekte</span><span class="sxs-lookup"><span data-stu-id="c5d6a-186">Policy Objects</span></span>

<span data-ttu-id="c5d6a-187">Ein Richtlinien Objekt kapselt die Inhalts Schutzanforderungen einer ITA.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-187">A policy object encapsulates the content protection requirements of an ITA.</span></span> <span data-ttu-id="c5d6a-188">Sie wird von der-Richtlinien-Engine verwendet, um die Unterstützung von Inhalts Schutz mit einer OTA auszuhandeln.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-188">It is used by the policy engine to negotiate content protection support with an OTA.</span></span> <span data-ttu-id="c5d6a-189">OTAS-Abfrage Richtlinien Objekte, um zu bestimmen, welche Schutzsysteme Sie für die einzelnen Ausgaben des aktuellen Inhalts erzwingen müssen.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-189">OTAs query policy objects to determine what protection systems they must enforce on each output of the current content.</span></span>

### <a name="creating-objects-in-the-pmp"></a><span data-ttu-id="c5d6a-190">Erstellen von Objekten im PMP</span><span class="sxs-lookup"><span data-stu-id="c5d6a-190">Creating Objects in the PMP</span></span>

<span data-ttu-id="c5d6a-191">Zum Erstellen eines Objekts im geschützten Medien Pfad (PMP) ruft [**imfmediasource**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasource) [**imfpmphostapp:: activateclassbyid**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphostapp-activateclassbyid)auf, wobei die angegebene Eingabe- **IStream** wie folgt formatiert ist:</span><span class="sxs-lookup"><span data-stu-id="c5d6a-191">To create an object in the protected media path (PMP), the [**IMFMediaSource**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasource) calls [**IMFPMPHostApp::ActivateClassById**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphostapp-activateclassbyid), with the specified input **IStream** formatted in the following way:</span></span>

``` syntax
Format: (All DWORD values are serialized in little-endian order)
[GUID (content protection system guid, obtained from Windows.Media.Protection.MediaProtectionSystemId)]
[DWORD (track count, use the actual track count even if all tracks are encrypted using the same data, note that zero is invalid)]
[DWORD (next track ID, use -1 if all remaining tracks are encrypted using the same data)]
[DWORD (next track's binary data size)]
[BYTE* (next track's binary data)]
{ Repeat from "next track ID" above for each stream }
```

## <a name="overview-of-policy-negotiation"></a><span data-ttu-id="c5d6a-192">Übersicht über die Richtlinien Aushandlung</span><span class="sxs-lookup"><span data-stu-id="c5d6a-192">Overview of Policy Negotiation</span></span>

<span data-ttu-id="c5d6a-193">Es gibt drei grundlegende Anforderungen, die erfüllt sein müssen, damit geschützte Inhalte im PMP verarbeitet werden können.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-193">There are three fundamental requirements that must be met before protected content can be processed in the PMP.</span></span> <span data-ttu-id="c5d6a-194">Zunächst muss geschützter Inhalt nur an vertrauenswürdige Ausgaben gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-194">First, protected content must be sent only to trusted outputs.</span></span> <span data-ttu-id="c5d6a-195">Zweitens müssen nur zulässige Aktionen auf einen Stream angewendet werden.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-195">Second, only permitted actions must be applied to a stream.</span></span> <span data-ttu-id="c5d6a-196">Drittens müssen nur genehmigte Ausgabe Schutzsysteme verwendet werden, um einen Stream wiederzugeben.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-196">Third, only approved output protection systems must be used to play a stream.</span></span> <span data-ttu-id="c5d6a-197">Die Richtlinien-Engine koordiniert zwischen ITAs und OTAS, um sicherzustellen, dass diese Anforderungen erfüllt werden.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-197">The policy engine coordinates between ITAs and OTAs to ensure that these requirements are met.</span></span>

<span data-ttu-id="c5d6a-198">Die einfachste Möglichkeit, den Prozess zu verstehen, ist die exemplarische Vorgehensweise für ein vereinfachtes Beispiel, das die erforderlichen Schritte zur Wiedergabe von durch Windows Media Digital Rights Management (WMDRM) geschützten Inhalt von erweiterten System Formaten (Windows Media Digital)</span><span class="sxs-lookup"><span data-stu-id="c5d6a-198">The easiest way to understand process is to walk through a simplified example that identifies the steps necessary to play Advanced System Format (ASF) content protected by Windows Media Digital Rights Management (WMDRM).</span></span>

<span data-ttu-id="c5d6a-199">Wenn ein Benutzer eine Player Anwendung gestartet und eine ASF-Datei mit einem geschützten Audiostream und einem geschützten Videostream öffnet, müssen die folgenden Schritte ausgeführt werden:</span><span class="sxs-lookup"><span data-stu-id="c5d6a-199">When a user launches a player application and opens an ASF file that has a protected audio stream and a protected video stream, the following steps must be performed:</span></span>

1.  <span data-ttu-id="c5d6a-200">Die Anwendung erstellt die ASF-Medienquelle und die PMP-Sitzung (Protected Media Path).</span><span class="sxs-lookup"><span data-stu-id="c5d6a-200">The application creates the ASF media source and the protected media path (PMP) session.</span></span> <span data-ttu-id="c5d6a-201">Media Foundation erstellt einen PMP-Prozess.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-201">Media Foundation creates a PMP process.</span></span>
2.  <span data-ttu-id="c5d6a-202">Die Anwendung erstellt eine partielle Topologie, die einen audioquellknoten enthält, der mit dem audiorenderer verbunden ist, sowie einen mit dem erweiterten Videorenderer (EVR) verbundenen Video Quellknoten.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-202">The application creates a partial topology that contains an audio source node connected to the audio renderer, and a video source node connected to the enhanced video renderer (EVR).</span></span> <span data-ttu-id="c5d6a-203">Bei den Renderers erstellt die Anwendung den Renderer nicht direkt.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-203">For the renderers, the application does not directly create the renderer.</span></span> <span data-ttu-id="c5d6a-204">Stattdessen erstellt die Anwendung im ungeschützten Prozess ein Objekt, das als *Aktivierungs Objekt* bezeichnet wird.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-204">Instead, the application creates in the unprotected process an object known as an *activation object*.</span></span> <span data-ttu-id="c5d6a-205">Das PMP verwendet das Activation-Objekt, um die Renderer im geschützten Prozess zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-205">The PMP uses the activation object to create the renderers in the protected process.</span></span> <span data-ttu-id="c5d6a-206">(Weitere Informationen zu Aktivierungs Objekten finden Sie unter [Activation Objects](activation-objects.md).)</span><span class="sxs-lookup"><span data-stu-id="c5d6a-206">(For more information about activation objects, see [Activation Objects](activation-objects.md).)</span></span>
3.  <span data-ttu-id="c5d6a-207">Die Anwendung legt die partielle Topologie für die PMP-Sitzung fest.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-207">The application sets the partial topology on the PMP session.</span></span>
4.  <span data-ttu-id="c5d6a-208">Die PMP-Sitzung serialisiert die Topologie und übergibt Sie im geschützten Prozess an den PMP-Host.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-208">The PMP session serializes the topology and passes it to the PMP host in the protected process.</span></span> <span data-ttu-id="c5d6a-209">Der PMP-Host sendet die Topologie an die Richtlinien-Engine.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-209">The PMP host sends the topology to the policy engine.</span></span>
5.  <span data-ttu-id="c5d6a-210">Das topologielade Programm ruft [**imfinputtrustauthority:: getdecrypter**](/windows/desktop/api/mfidl/nf-mfidl-imfinputtrustauthority-getdecrypter) auf der ITAs-Instanz auf und fügt die entschlüsselungssätze in die Topologie direkt nach unten der entsprechenden Quellknoten ein.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-210">The topology loader calls [**IMFInputTrustAuthority::GetDecrypter**](/windows/desktop/api/mfidl/nf-mfidl-imfinputtrustauthority-getdecrypter) on the ITAs and inserts the decrypters into the topology immediately downstream of the corresponding source nodes.</span></span>
6.  <span data-ttu-id="c5d6a-211">Das topologielader fügt die Audio-und Video-decoderer in den entschlüsselungsknoten ein.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-211">The topology loader inserts the audio and video decoders downstream of the decrypter nodes.</span></span>
7.  <span data-ttu-id="c5d6a-212">Die Richtlinien-Engine scannt die eingefügten Knoten, um zu bestimmen, ob die [**imftreudoutput**](/windows/desktop/api/mfidl/nn-mfidl-imftrustedoutput) -Schnittstelle implementiert.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-212">The policy engine scans the inserted nodes to determine whether any implement the [**IMFTrustedOutput**](/windows/desktop/api/mfidl/nn-mfidl-imftrustedoutput) interface.</span></span> <span data-ttu-id="c5d6a-213">Der EVR und der audiorenderer implementieren " **IMF Treuhänder doutput**", da Sie Daten außerhalb des PMP senden.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-213">The EVR and the audio renderer both implement **IMFTrustedOutput**, because they send data outside the PMP.</span></span>
8.  <span data-ttu-id="c5d6a-214">Jede ITA bestätigt, dass Sie innerhalb eines geschützten Prozesses ausgeführt wird, indem Sie einen kryptografischen Handshake mit einem Kernelmodul der geschützten Umgebung ausführt.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-214">Each ITA confirms that it is running inside a protected process by performing a cryptographic handshake with a protected environment kernel module.</span></span>
9.  <span data-ttu-id="c5d6a-215">Für jeden Stream aushandiert das Richtlinien Modul die Richtlinie, indem es ein Richtlinien Objekt aus der ITA erhält und es an die OTA übergibt.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-215">For each stream, the policy engine negotiates policy by getting a policy object from the ITA and passing it to the OTA.</span></span> <span data-ttu-id="c5d6a-216">Die OTA bietet eine Liste der Schutzsysteme, die von ihr unterstützt werden, und das Richtlinien Objekt gibt an, welche Schutzsysteme zusammen mit den richtigen Einstellungen angewendet werden müssen.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-216">The OTA provides a list of the protection systems that it supports, and the policy object indicates which protection systems must be applied, along with the correct settings.</span></span> <span data-ttu-id="c5d6a-217">Die OTA wendet dann diese Einstellungen an.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-217">The OTA then applies these settings.</span></span> <span data-ttu-id="c5d6a-218">Wenn dies nicht möglich ist, wird der Inhalt blockiert.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-218">If it cannot do so, the content is blocked.</span></span>

## <a name="revocation-and-renewal"></a><span data-ttu-id="c5d6a-219">Sperrung und Verlängerung</span><span class="sxs-lookup"><span data-stu-id="c5d6a-219">Revocation and Renewal</span></span>

<span data-ttu-id="c5d6a-220">Eine vertrauenswürdige Komponente kann widerrufen werden, wenn Sie kompromittiert wird oder ermittelt wird, dass Sie gegen die Lizenzverträge verstößt, denen Sie anfänglich vertraut war.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-220">A trusted component can be revoked if it becomes compromised or is discovered to be violating the license agreements under which it was initially trusted.</span></span> <span data-ttu-id="c5d6a-221">Ein Erneuerungs Mechanismus ist vorhanden, um eine neuere, vertrauenswürdigere Version der Komponente zu installieren.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-221">A renewal mechanism exists to install a newer, more trusted version of the component.</span></span>

<span data-ttu-id="c5d6a-222">Vertrauenswürdige Komponenten werden mithilfe eines kryptografiezertifikats signiert.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-222">Trusted components are signed using a cryptographic certificate.</span></span> <span data-ttu-id="c5d6a-223">Microsoft veröffentlicht eine globale Sperr Liste (GRL), mit der nicht wider sperrte Komponenten identifiziert werden.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-223">Microsoft publishes a global revocation list (GRL) which identifies components that have been revoked.</span></span> <span data-ttu-id="c5d6a-224">Die GRL ist digital signiert, um ihre Echtheit sicherzustellen.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-224">The GRL is digitally signed to ensure its authenticity.</span></span> <span data-ttu-id="c5d6a-225">Inhalts Besitzer können über den Richtlinien Mechanismus sicherstellen, dass die aktuelle Version der GRL auf dem Computer des Benutzers vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-225">Content owners can ensure, through the policy mechanism, that the current version of the GRL is present on the user's computer.</span></span>

## <a name="output-link-protection"></a><span data-ttu-id="c5d6a-226">Ausgabe Link Schutz</span><span class="sxs-lookup"><span data-stu-id="c5d6a-226">Output Link Protection</span></span>

<span data-ttu-id="c5d6a-227">Wenn hochwertige Videoinhalte angezeigt werden, werden die entschlüsselten, nicht komprimierten Frames über einen physischen Connector auf das Anzeigegerät übertragen.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-227">When premium video content is viewed, the decrypted, uncompressed frames travel across a physical connector to the display device.</span></span> <span data-ttu-id="c5d6a-228">Bei Inhaltsanbietern ist es möglicherweise erforderlich, dass die Videorahmen an dieser Stelle geschützt werden, da Sie über den physischen Connector übertragen werden.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-228">Content providers may require the video frames to be protected at this point, as they travel across the physical connector.</span></span> <span data-ttu-id="c5d6a-229">Zu diesem Zweck gibt es verschiedene Schutzmechanismen, einschließlich High-Bandwidth Digital Content Protection (HDCP) und DisplayPort Content Protection (dpcp).</span><span class="sxs-lookup"><span data-stu-id="c5d6a-229">Various protection mechanisms exist for this purpose, including High-Bandwidth Digital Content Protection (HDCP) and DisplayPort Content Protection (DPCP).</span></span> <span data-ttu-id="c5d6a-230">Die Video-OTA erzwingt diese Schutzmaßnahmen mithilfe des [Output Protection Managers](output-protection-manager.md) (OPM).</span><span class="sxs-lookup"><span data-stu-id="c5d6a-230">The video OTA enforces these protections by using the [Output Protection Manager](output-protection-manager.md) (OPM).</span></span> <span data-ttu-id="c5d6a-231">Der Output Protection Manager sendet Befehle an den Grafiktreiber, und der Grafiktreiber erzwingt, welche Schutzmechanismen für die Richtlinie erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="c5d6a-231">The Output Protection Manager sends commands to the graphics driver, and the graphics driver enforces whatever link protection mechanisms are required by the policy.</span></span>

![ein Diagramm, das die Beziehung zwischen der Video-OTA und OPM anzeigt.](images/pmp05.png)

## <a name="related-topics"></a><span data-ttu-id="c5d6a-233">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="c5d6a-233">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="c5d6a-234">Info über Media Foundation</span><span class="sxs-lookup"><span data-stu-id="c5d6a-234">About Media Foundation</span></span>](about-the-media-foundation-sdk.md)
</dt> <dt>

[<span data-ttu-id="c5d6a-235">Media Foundation-Architektur</span><span class="sxs-lookup"><span data-stu-id="c5d6a-235">Media Foundation Architecture</span></span>](media-foundation-architecture.md)
</dt> <dt>

[<span data-ttu-id="c5d6a-236">GPU-basiertes Content Protection</span><span class="sxs-lookup"><span data-stu-id="c5d6a-236">GPU-Based Content Protection</span></span>](gpu-based-content-protection.md)
</dt> <dt>

[<span data-ttu-id="c5d6a-237">Output Protection Manager</span><span class="sxs-lookup"><span data-stu-id="c5d6a-237">Output Protection Manager</span></span>](output-protection-manager.md)
</dt> <dt>

[<span data-ttu-id="c5d6a-238">PMP-Medien Sitzung</span><span class="sxs-lookup"><span data-stu-id="c5d6a-238">PMP Media Session</span></span>](pmp-media-session.md)
</dt> </dl>

 

 
