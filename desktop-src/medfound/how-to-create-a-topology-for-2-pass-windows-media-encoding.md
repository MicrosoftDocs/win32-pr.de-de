---
description: Zwei-Pass-Codierungs Modi werden von bestimmten Windows Media Encoder und Media Foundation auf der Pipeline Ebene unterstützt.
ms.assetid: 3fd5baff-142f-453e-bb97-b355ee6678fc
title: Erstellen einer Topologie für Two-Pass Windows-Medien Codierung
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7c813b9a3c31fafaa3efbea83180c997bc46079d
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/03/2021
ms.locfileid: "103961135"
---
# <a name="how-to-create-a-topology-for-two-pass-windows-media-encoding"></a><span data-ttu-id="cfd1f-103">Erstellen einer Topologie für Two-Pass Windows-Medien Codierung</span><span class="sxs-lookup"><span data-stu-id="cfd1f-103">How to Create a Topology for Two-Pass Windows Media Encoding</span></span>

<span data-ttu-id="cfd1f-104">Zwei-Pass-Codierungs Modi werden von bestimmten Windows Media Encoder und Media Foundation auf der Pipeline Ebene unterstützt.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-104">Two-pass encoding modes are supported by certain Windows Media encoders and Media Foundation at the pipeline layer.</span></span> <span data-ttu-id="cfd1f-105">Die Anwendung muss die Codierungs Topologie konfigurieren und einrichten, ähnlich wie bei der Codierung mit nur einem Durchlauf, aber im 2-Pass-Codierungs Modus muss die Anwendung die Codierungs Sitzung zweimal ausführen.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-105">The application must configure and set up the encoding topology similar to that in single-pass encoding but in the 2-pass encoding mode, the application must run the encoding session twice.</span></span> <span data-ttu-id="cfd1f-106">Beim ersten Durchlauf sammelt der Encoder Informationen zum Inhalt des Streams.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-106">On the first pass, the encoder gathers information about the content of the stream.</span></span> <span data-ttu-id="cfd1f-107">Beim zweiten Durchlauf wird die endgültige Ausgabedatei generiert, indem die beim ersten Durchlauf gesammelten Informationen verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-107">On the second pass, by using the information gathered on the first pass, the final output file is generated.</span></span> <span data-ttu-id="cfd1f-108">Durch die zweimalige Verarbeitung der Stichproben für den Stream wird der Codierungsprozess durch die zwei-Pass-Codierung optimiert und qualitativ hochwertige codierte Dateien erstellt.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-108">By processing the samples for the stream twice, two-pass encoding optimizes the encoding process and produces higher quality encoded files.</span></span> <span data-ttu-id="cfd1f-109">Die zwei-Pass-Codierungs Modi können nicht für Livestreams verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-109">Two-pass encoding modes cannot be used on live streams.</span></span>

<span data-ttu-id="cfd1f-110">Media Foundation unterstützt die folgenden zwei-Durchlauf-Codierungs Modi:</span><span class="sxs-lookup"><span data-stu-id="cfd1f-110">Media Foundation supports the following two-pass encoding modes:</span></span>

-   [<span data-ttu-id="cfd1f-111">Unbeschränkte Variablen Bitrate-Codierung</span><span class="sxs-lookup"><span data-stu-id="cfd1f-111">Unconstrained Variable Bit Rate Encoding</span></span>](unconstrained-variable-bit-rate--vbr--encoding.md)
-   [<span data-ttu-id="cfd1f-112">Mit Spitzenwerten beschränkte Variable Bitrate-Codierung</span><span class="sxs-lookup"><span data-stu-id="cfd1f-112">Peak-Constrained Variable Bit Rate Encoding</span></span>](peak-constrained-variable-bit-rate--vbr--encoding.md)

<span data-ttu-id="cfd1f-113">Das Entwickeln einer Codierungs Topologie für die zwei-Pass-Codierung ähnelt den einzelnen Pass Modi.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-113">Building an encoding topology for two-pass encoding is similar to single pass modes.</span></span> <span data-ttu-id="cfd1f-114">In der folgenden Liste sind die wichtigsten Unterschiede aufgeführt.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-114">The following list shows the key differences.</span></span>

-   <span data-ttu-id="cfd1f-115">Die Encoderkonfiguration muss die Eigenschaft " [**mfpkey \_ passesused**](mfpkey-passesusedproperty.md) " enthalten, die auf 2 festgelegt ist, und die Eigenschaft " [**mfpkey \_ vbrenabled**](mfpkey-vbrenabledproperty.md) " auf Variant \_ true.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-115">Encoder configuration must include the [**MFPKEY\_PASSESUSED**](mfpkey-passesusedproperty.md) property that is set to 2 and the [**MFPKEY\_VBRENABLED**](mfpkey-vbrenabledproperty.md) property to VARIANT\_TRUE.</span></span> <span data-ttu-id="cfd1f-116">Dadurch werden die Funktionen des Encoders auf zweistufige Modi gefiltert.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-116">This filters the encoder’s capabilities to two-pass modes.</span></span> <span data-ttu-id="cfd1f-117">Wenn Sie Aktivierungs Objekte verwenden, übergeben Sie diese Eigenschaften an [**mfkreatewmaencoderactivation**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmaencoderactivate) oder [**mfkreatewmvencoderactivation**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmvencoderactivate).</span><span class="sxs-lookup"><span data-stu-id="cfd1f-117">If you are using activation objects, pass these properties to [**MFCreateWMAEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmaencoderactivate) or [**MFCreateWMVEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmvencoderactivate).</span></span>
-   <span data-ttu-id="cfd1f-118">Verwenden Sie für den ersten Durchlauf eine Pseudo Medien-Senke im Ausgabe Knoten, da die in diesem Durchlauf generierten Beispiele nicht der endgültigen Datei hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-118">For the first pass, use a dummy media sink in the output node because the samples that are generated in this pass are not added to the final file.</span></span>
-   <span data-ttu-id="cfd1f-119">Fragen Sie für den zweiten Durchlauf den Encoder nach den erforderlichen nach Codierungs Eigenschaften ab, und ersetzen Sie den Knoten für den Dummy-Medien Sink durch die ASF-Medien Senke, wobei diese Eigenschaften festgelegt sind.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-119">For the second pass, query the encoder for the required post-encoding properties and replace the dummy media sink node with the ASF media sink with these properties set.</span></span>

<span data-ttu-id="cfd1f-120">Weitere Informationen zum Einrichten einer Codierungs Topologie finden Sie unter [Tutorial: Single Pass Windows Media Encoding](tutorial--1-pass-windows-media-encoding.md).</span><span class="sxs-lookup"><span data-stu-id="cfd1f-120">For more information about setting up an encoding topology see, [Tutorial: Single Pass Windows Media Encoding](tutorial--1-pass-windows-media-encoding.md).</span></span>

<span data-ttu-id="cfd1f-121">Im folgenden Verfahren werden die Schritte zum Codieren von Windows Media-Inhalten in einem ASF-Container mithilfe eines zwei-Pass-Codierungs Modus zusammengefasst.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-121">The following procedure summarizes the steps for encoding Windows Media content in an ASF container by using a two-pass encoding mode.</span></span>

1.  <span data-ttu-id="cfd1f-122">Erstellen Sie eine Medienquelle für die angegebene mithilfe des Quell Resolvers.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-122">Create a media source for the specified by using the source resolver.</span></span>
2.  <span data-ttu-id="cfd1f-123">Listet die Streams in der Medienquelle auf.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-123">Enumerate the streams in the media source.</span></span>
3.  <span data-ttu-id="cfd1f-124">Erstellen Sie die ASF-Medien Senke, und fügen Sie in Abhängigkeit von den Streams in der Medienquelle, die codiert werden müssen, streamsenken hinzu.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-124">Create the ASF media sink and add stream sinks depending on the streams in the media source that need to be encoded.</span></span>
4.  <span data-ttu-id="cfd1f-125">Erstellen Sie die Medien Senke.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-125">Create the media sink.</span></span>
5.  <span data-ttu-id="cfd1f-126">Erstellen Sie die Windows Media Encoder für die Streams in der Ausgabedatei.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-126">Create the Windows Media encoders for the streams in the output file.</span></span>
6.  <span data-ttu-id="cfd1f-127">Konfigurieren Sie die Encoder mit den 2-Pass-Codierungs Eigenschaften.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-127">Configure the encoders with the 2-pass encoding properties.</span></span>
7.  <span data-ttu-id="cfd1f-128">Erstellen Sie eine partielle Codierungs Topologie, indem Sie die Quelle, die Encoder und die Medien Senke verbinden.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-128">Build a partial encoding topology by connecting the source, encoders, and the media sink.</span></span>
8.  <span data-ttu-id="cfd1f-129">Instanziieren Sie die Medien Sitzung, und legen Sie die Topologie für die Medien Sitzung fest.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-129">Instantiate the Media Session and set the topology on the Media Session.</span></span>
9.  <span data-ttu-id="cfd1f-130">Führen Sie den ersten Codierungs Durchlauf aus, indem Sie die Medien Sitzung Steuern und alle relevanten Ereignisse aus der Medien Sitzung erhalten.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-130">Run the first encoding pass by controlling the Media Session and getting all the relevant events from the Media Session.</span></span>
10. <span data-ttu-id="cfd1f-131">Schließen und beenden Sie die Codierungs Sitzung.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-131">Close and shutdown the encoding session.</span></span>
11. <span data-ttu-id="cfd1f-132">Fragen Sie den Encoder abhängig vom Codierungstyp nach den folgenden Eigenschaften ab:</span><span class="sxs-lookup"><span data-stu-id="cfd1f-132">Query the encoder for the following properties depending on the type of encoding:</span></span> 

    | <span data-ttu-id="cfd1f-133">Codierungstyp</span><span class="sxs-lookup"><span data-stu-id="cfd1f-133">Encoding type</span></span>                                                                                        | <span data-ttu-id="cfd1f-134">Eigenschaftenname</span><span class="sxs-lookup"><span data-stu-id="cfd1f-134">Property name</span></span>                                                                                                                                                                                                                                                                                                                                                     |
    |------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
    | [<span data-ttu-id="cfd1f-135">Unbeschränkte Variablen Bitrate-Codierung</span><span class="sxs-lookup"><span data-stu-id="cfd1f-135">Unconstrained Variable Bit Rate Encoding</span></span>](unconstrained-variable-bit-rate--vbr--encoding.md)       | [<span data-ttu-id="cfd1f-136">**mfpkey- \_ passesused**</span><span class="sxs-lookup"><span data-stu-id="cfd1f-136">**MFPKEY\_PASSESUSED**</span></span>](mfpkey-passesusedproperty.md)<br/> [<span data-ttu-id="cfd1f-137">**mfpkey \_ vbrenabled**</span><span class="sxs-lookup"><span data-stu-id="cfd1f-137">**MFPKEY\_VBRENABLED**</span></span>](mfpkey-vbrenabledproperty.md)<br/> [<span data-ttu-id="cfd1f-138">**mfpkey \_ bavg**</span><span class="sxs-lookup"><span data-stu-id="cfd1f-138">**MFPKEY\_BAVG**</span></span>](mfpkey-bavgproperty.md)<br/> [<span data-ttu-id="cfd1f-139">**mfpkey \_ Ravg**</span><span class="sxs-lookup"><span data-stu-id="cfd1f-139">**MFPKEY\_RAVG**</span></span>](mfpkey-ravgproperty.md)<br/>                                                                                                               |
    | [<span data-ttu-id="cfd1f-140">Mit Spitzenwerten beschränkte Variable Bitrate-Codierung</span><span class="sxs-lookup"><span data-stu-id="cfd1f-140">Peak-Constrained Variable Bit Rate Encoding</span></span>](peak-constrained-variable-bit-rate--vbr--encoding.md) | [<span data-ttu-id="cfd1f-141">**mfpkey- \_ passesused**</span><span class="sxs-lookup"><span data-stu-id="cfd1f-141">**MFPKEY\_PASSESUSED**</span></span>](mfpkey-passesusedproperty.md)<br/> [<span data-ttu-id="cfd1f-142">**mfpkey \_ vbrenabled**</span><span class="sxs-lookup"><span data-stu-id="cfd1f-142">**MFPKEY\_VBRENABLED**</span></span>](mfpkey-vbrenabledproperty.md)<br/> [<span data-ttu-id="cfd1f-143">**mfpkey \_ bavg**</span><span class="sxs-lookup"><span data-stu-id="cfd1f-143">**MFPKEY\_BAVG**</span></span>](mfpkey-bavgproperty.md)<br/> [<span data-ttu-id="cfd1f-144">**mfpkey \_ Ravg**</span><span class="sxs-lookup"><span data-stu-id="cfd1f-144">**MFPKEY\_RAVG**</span></span>](mfpkey-ravgproperty.md)<br/> [<span data-ttu-id="cfd1f-145">**mfpkey ( \_ bmax)**</span><span class="sxs-lookup"><span data-stu-id="cfd1f-145">**MFPKEY\_BMAX**</span></span>](mfpkey-bmaxproperty.md)<br/> [<span data-ttu-id="cfd1f-146">**mfpkey- \_ Rmax**</span><span class="sxs-lookup"><span data-stu-id="cfd1f-146">**MFPKEY\_RMAX**</span></span>](mfpkey-rmaxproperty.md)<br/> |

    

     

12. <span data-ttu-id="cfd1f-147">Erstellen Sie die ASF-Datei Senke, und fügen Sie abhängig von den Datenströmen, die Sie in die endgültige Ausgabedatei einschließen möchten, die erforderlichen streamsenken hinzu.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-147">Create the ASF file sink and add the required stream sinks depending on the streams you want to include in the final output file.</span></span>
13. <span data-ttu-id="cfd1f-148">Legen Sie die in Schritt 11 abgerufenen Codierungs Eigenschaften in der Datei Senke fest.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-148">Set the encoder properties retrieved in step 11 on the file sink.</span></span>
14. <span data-ttu-id="cfd1f-149">Ersetzen Sie die Medien Senke im Ausgabe Knoten durch die neu erstellte dateisenke.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-149">Replace the media sink in the output node with the newly created file sink.</span></span>
15. <span data-ttu-id="cfd1f-150">Instanziieren Sie die Medien Sitzung, und legen Sie die aktualisierte Topologie für die Medien Sitzung fest.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-150">Instantiate the Media Session and set the updated topology on the Media Session.</span></span>
16. <span data-ttu-id="cfd1f-151">Führen Sie einen zweiten Codierungs Durchlauf aus, indem Sie die Medien Sitzung Steuern und alle relevanten Ereignisse aus der Medien Sitzung erhalten.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-151">Run second encoding pass by controlling the Media Session and getting all the relevant events from the Media Session.</span></span>
17. <span data-ttu-id="cfd1f-152">Warten Sie auf das [meendof Presentation](meendofpresentation.md) -Ereignis aus der Medien Sitzung, und legen Sie im Ereignishandler die Codierungs Eigenschaftswerte aus dem Encoder ab, und legen Sie Sie auf die Datei Senke fest.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-152">Wait for the [MEEndOfPresentation](meendofpresentation.md) event from the Media Session and in the event handler get the encoding property values from the encoder and set them on the file sink.</span></span> <span data-ttu-id="cfd1f-153">Weitere Informationen finden Sie unter "Aktualisieren von Codierungs Eigenschaften in der Datei Senke" in [Tutorial: Single Pass Windows Media Encoding](tutorial--1-pass-windows-media-encoding.md).</span><span class="sxs-lookup"><span data-stu-id="cfd1f-153">For more information, see "Update Encoding Properties in the File Sink" in [Tutorial: Single Pass Windows Media Encoding](tutorial--1-pass-windows-media-encoding.md).</span></span>
18. <span data-ttu-id="cfd1f-154">Schließen und beenden Sie die Codierungs Sitzung.</span><span class="sxs-lookup"><span data-stu-id="cfd1f-154">Close and shutdown the encoding session.</span></span>

## <a name="related-topics"></a><span data-ttu-id="cfd1f-155">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="cfd1f-155">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="cfd1f-156">Komponenten der Pipeline Schicht-ASF</span><span class="sxs-lookup"><span data-stu-id="cfd1f-156">Pipeline Layer ASF Components</span></span>](pipeline-layer-asf-components.md)
</dt> </dl>

 

 




