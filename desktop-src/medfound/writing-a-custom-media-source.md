---
description: In diesem Thema wird beschrieben, wie eine benutzerdefinierte Medienquelle in Microsoft Media Foundation implementiert wird.
ms.assetid: 82db6f32-ad94-4563-b8bd-8a5072c5b221
title: Schreiben einer benutzerdefinierten Medienquelle
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8769fa16d4dcbfd3438b66f9a9e78c34274735a5
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/03/2021
ms.locfileid: "106353627"
---
# <a name="writing-a-custom-media-source"></a><span data-ttu-id="d5330-103">Schreiben einer benutzerdefinierten Medienquelle</span><span class="sxs-lookup"><span data-stu-id="d5330-103">Writing a Custom Media Source</span></span>

<span data-ttu-id="d5330-104">In diesem Thema wird beschrieben, wie eine benutzerdefinierte Medienquelle in Microsoft Media Foundation implementiert wird.</span><span class="sxs-lookup"><span data-stu-id="d5330-104">This topic describes how to implement a custom media source in Microsoft Media Foundation.</span></span> <span data-ttu-id="d5330-105">Sie enthält die folgenden Abschnitte:</span><span class="sxs-lookup"><span data-stu-id="d5330-105">It contains the following sections:</span></span>

-   [<span data-ttu-id="d5330-106">Erstellen des Präsentations Deskriptors</span><span class="sxs-lookup"><span data-stu-id="d5330-106">Creating the Presentation Descriptor</span></span>](#creating-the-presentation-descriptor)
-   [<span data-ttu-id="d5330-107">Starten der Medienquelle</span><span class="sxs-lookup"><span data-stu-id="d5330-107">Starting the Media Source</span></span>](#starting-the-media-source)
    -   [<span data-ttu-id="d5330-108">Diejenigen</span><span class="sxs-lookup"><span data-stu-id="d5330-108">Seeking</span></span>](#seeking)
-   [<span data-ttu-id="d5330-109">Anhalten der Medienquelle</span><span class="sxs-lookup"><span data-stu-id="d5330-109">Pausing the Media Source</span></span>](#pausing-the-media-source)
-   [<span data-ttu-id="d5330-110">Quelldaten werden erzeugt.</span><span class="sxs-lookup"><span data-stu-id="d5330-110">Generating Source Data</span></span>](#generating-source-data)
    -   [<span data-ttu-id="d5330-111">Beispiel Anforderungen</span><span class="sxs-lookup"><span data-stu-id="d5330-111">Sample Requests</span></span>](#sample-requests)
    -   [<span data-ttu-id="d5330-112">Zuordnen von Beispielen</span><span class="sxs-lookup"><span data-stu-id="d5330-112">Allocating Samples</span></span>](#allocating-samples)
    -   [<span data-ttu-id="d5330-113">Lücken im Stream</span><span class="sxs-lookup"><span data-stu-id="d5330-113">Gaps in the Stream</span></span>](#gaps-in-the-stream)
-   [<span data-ttu-id="d5330-114">Die Medienquelle wird heruntergefahren.</span><span class="sxs-lookup"><span data-stu-id="d5330-114">Shutting Down the Media Source</span></span>](#shutting-down-the-media-source)
-   [<span data-ttu-id="d5330-115">Live Quellen</span><span class="sxs-lookup"><span data-stu-id="d5330-115">Live Sources</span></span>](#live-sources)
-   [<span data-ttu-id="d5330-116">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="d5330-116">Related topics</span></span>](#related-topics)

## <a name="creating-the-presentation-descriptor"></a><span data-ttu-id="d5330-117">Erstellen des Präsentations Deskriptors</span><span class="sxs-lookup"><span data-stu-id="d5330-117">Creating the Presentation Descriptor</span></span>

<span data-ttu-id="d5330-118">Die [**imfmediasource:: foratepresentationdescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) -Methode gibt eine Kopie des Präsentations Deskriptors der Quelle zurück.</span><span class="sxs-lookup"><span data-stu-id="d5330-118">The [**IMFMediaSource::CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) method returns a copy of the source's presentation descriptor.</span></span> <span data-ttu-id="d5330-119">Um den Präsentations Deskriptor zu erstellen, müssen Sie die Anzahl der Streams im Quell Inhalt und die möglichen Formate jedes Streams kennen.</span><span class="sxs-lookup"><span data-stu-id="d5330-119">To create the presentation descriptor, you must know the number of streams in the source content, and the possible formats of each stream.</span></span> <span data-ttu-id="d5330-120">Erstellen Sie für jeden Stream einen Datenstrom Deskriptor wie folgt:</span><span class="sxs-lookup"><span data-stu-id="d5330-120">For each stream, create a stream descriptor as follows:</span></span>

1.  <span data-ttu-id="d5330-121">Erstellen Sie ein Array von Medientypen.</span><span class="sxs-lookup"><span data-stu-id="d5330-121">Create an array of media types.</span></span> <span data-ttu-id="d5330-122">Jeder Medientyp im Array stellt ein mögliches Format für den Stream dar.</span><span class="sxs-lookup"><span data-stu-id="d5330-122">Each media type in the array represents a possible format for the stream.</span></span> <span data-ttu-id="d5330-123">Weitere Informationen zum Erstellen von Medientypen finden Sie unter [Medientypen](media-types.md).</span><span class="sxs-lookup"><span data-stu-id="d5330-123">For more information about creating media types, see [Media Types](media-types.md).</span></span>
2.  <span data-ttu-id="d5330-124">Rufen Sie [**mfkreatestreamdescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatestreamdescriptor) auf, um den Datenstrom Deskriptor zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="d5330-124">Call [**MFCreateStreamDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatestreamdescriptor) to create the stream descriptor.</span></span> <span data-ttu-id="d5330-125">Übergeben Sie das Array von Medientypen.</span><span class="sxs-lookup"><span data-stu-id="d5330-125">Pass in the array of media types.</span></span> <span data-ttu-id="d5330-126">Die-Funktion gibt einen [**IMF streamdescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfstreamdescriptor) -Zeiger zurück.</span><span class="sxs-lookup"><span data-stu-id="d5330-126">The function returns an [**IMFStreamDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfstreamdescriptor) pointer.</span></span>
3.  <span data-ttu-id="d5330-127">Aufrufen von [**imfstreamdescriptor:: getmediatyphandler**](/windows/desktop/api/mfidl/nf-mfidl-imfstreamdescriptor-getmediatypehandler) zum Abrufen des Medientyp Handlers für den Datenstrom Deskriptor.</span><span class="sxs-lookup"><span data-stu-id="d5330-127">Call [**IMFStreamDescriptor::GetMediaTypeHandler**](/windows/desktop/api/mfidl/nf-mfidl-imfstreamdescriptor-getmediatypehandler) to get the stream descriptor's media type handler.</span></span>
4.  <span data-ttu-id="d5330-128">Aufrufen von [**imfmediatyphandler:: setcurrentmediatype**](/windows/desktop/api/mfidl/nf-mfidl-imfmediatypehandler-setcurrentmediatype) zum Festlegen des standardmäßigen streamformats.</span><span class="sxs-lookup"><span data-stu-id="d5330-128">Call [**IMFMediaTypeHandler::SetCurrentMediaType**](/windows/desktop/api/mfidl/nf-mfidl-imfmediatypehandler-setcurrentmediatype) to set the default stream format.</span></span> <span data-ttu-id="d5330-129">Verwenden Sie einen der Medientypen, die Sie in Schritt 1 erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="d5330-129">Use one of the media types that you created in step 1.</span></span> <span data-ttu-id="d5330-130">Im Allgemeinen sollten Sie das Format mit der höchsten Qualität verwenden.</span><span class="sxs-lookup"><span data-stu-id="d5330-130">Generally, you should use the format with the highest quality.</span></span>
5.  <span data-ttu-id="d5330-131">Legen Sie optional Attribute für den Datenstrom Deskriptor fest.</span><span class="sxs-lookup"><span data-stu-id="d5330-131">Optionally, set attributes on the stream descriptor.</span></span> <span data-ttu-id="d5330-132">Eine Liste der Attribute, die für streamdeskriptoren gelten, finden Sie unter [streamdeskriptorattribute](stream-descriptor-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="d5330-132">For a list of attributes that apply to stream descriptors, see [Stream Descriptor Attributes](stream-descriptor-attributes.md).</span></span>

<span data-ttu-id="d5330-133">Erstellen Sie nun den Präsentations Deskriptor:</span><span class="sxs-lookup"><span data-stu-id="d5330-133">Now create the presentation descriptor:</span></span>

1.  <span data-ttu-id="d5330-134">Aufrufen von [**mfkreatepresentationdescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepresentationdescriptor) und übergeben des Arrays der streamdeskriptoren.</span><span class="sxs-lookup"><span data-stu-id="d5330-134">Call [**MFCreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepresentationdescriptor) and pass in the array of stream descriptors.</span></span> <span data-ttu-id="d5330-135">Die-Funktion gibt einen [**IMF presentationdescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationdescriptor) -Zeiger zurück.</span><span class="sxs-lookup"><span data-stu-id="d5330-135">The function returns an [**IMFPresentationDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationdescriptor) pointer.</span></span>
2.  <span data-ttu-id="d5330-136">Wählen Sie die standardstreamauswahl aus, indem Sie [**imfpresentationdescriptor:: selectstream**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-selectstream) aufrufen, um einen oder mehrere Streams auszuwählen.</span><span class="sxs-lookup"><span data-stu-id="d5330-136">Choose the default stream selection by calling [**IMFPresentationDescriptor::SelectStream**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-selectstream) to select one or more streams.</span></span> <span data-ttu-id="d5330-137">In der Standardkonfiguration muss mindestens ein Stream ausgewählt werden.</span><span class="sxs-lookup"><span data-stu-id="d5330-137">At least one stream must be selected in the default configuration.</span></span>
3.  <span data-ttu-id="d5330-138">Legen Sie optional Attribute für den Präsentations Deskriptor fest.</span><span class="sxs-lookup"><span data-stu-id="d5330-138">Optionally, set attributes on the presentation descriptor.</span></span> <span data-ttu-id="d5330-139">Eine Liste der Attribute, die für streamdeskriptoren gelten, finden Sie unter [Präsentations deskriptorattribute](presentation-descriptor-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="d5330-139">For a list of attributes that apply to stream descriptors, see [Presentation Descriptor Attributes](presentation-descriptor-attributes.md).</span></span>

<span data-ttu-id="d5330-140">Sie sollten den Präsentations Deskriptor einmal erstellen, entweder beim Start oder nachdem die Quelle genug Quelldaten analysiert hat, um den Inhalt zu ermitteln.</span><span class="sxs-lookup"><span data-stu-id="d5330-140">You should create the presentation descriptor once, either at startup or after the source has parsed enough of the source data to determine the contents.</span></span> <span data-ttu-id="d5330-141">Die Methode " [**kreatepresentationdescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) " sollte eine Kopie des Präsentations Deskriptors zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="d5330-141">The [**CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) method should return a copy of presentation descriptor.</span></span> <span data-ttu-id="d5330-142">Rufen Sie zum Erstellen der Kopie [**imfpresentationdescriptor:: Clone**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-clone)auf.</span><span class="sxs-lookup"><span data-stu-id="d5330-142">To create the copy, call [**IMFPresentationDescriptor::Clone**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-clone).</span></span> <span data-ttu-id="d5330-143">Durch das Zurückgeben einer Kopie wird verhindert, dass der Client den Status des ursprünglichen Präsentations Deskriptors ändert, z. b. die Attribute oder die Datenstrom Auswahl.</span><span class="sxs-lookup"><span data-stu-id="d5330-143">Returning a copy prevents the client from modifying the state of the original presentation descriptor, such as the attributes or the stream selection.</span></span> <span data-ttu-id="d5330-144">Beachten Sie jedoch, dass der **Klon** eine flache Kopie erstellt, sodass der Client die zugrunde liegenden streamdeskriptoren potenziell ändern kann.</span><span class="sxs-lookup"><span data-stu-id="d5330-144">However, be aware that **Clone** creates a shallow copy, so the client can potentially modify the underlying stream descriptors.</span></span>

## <a name="starting-the-media-source"></a><span data-ttu-id="d5330-145">Starten der Medienquelle</span><span class="sxs-lookup"><span data-stu-id="d5330-145">Starting the Media Source</span></span>

<span data-ttu-id="d5330-146">Die [**imfmediasource:: Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) -Methode startet die Medienquelle oder sucht an einer neuen Position.</span><span class="sxs-lookup"><span data-stu-id="d5330-146">The [**IMFMediaSource::Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method starts the media source or seeks to a new position.</span></span> <span data-ttu-id="d5330-147">Ein Aufruf von **Start** bewirkt eine *Suche* , wenn der vorherige Zustand entweder angehalten oder ausgeführt wurde und eine neue Startzeit angegeben wird.</span><span class="sxs-lookup"><span data-stu-id="d5330-147">A call to **Start** causes a *seek* when the previous state was either paused or running, and a new start time is specified.</span></span> <span data-ttu-id="d5330-148">Andernfalls verursacht die **Start** -Methode einen *Start* Vorgang.</span><span class="sxs-lookup"><span data-stu-id="d5330-148">Otherwise, the **Start** method causes a *start*.</span></span> <span data-ttu-id="d5330-149">Wenn der **Start** Vorgang abgeschlossen ist, senden Sie die folgenden Ereignisse.</span><span class="sxs-lookup"><span data-stu-id="d5330-149">When the **Start** operation completes, send the following events.</span></span>

1.  <span data-ttu-id="d5330-150">Senden Sie ein [menewstream](menewstream.md) -Ereignis für jeden neuen Stream – d. h. jeden Datenstrom, der zuvor deaktiviert wurde und nun ausgewählt ist.</span><span class="sxs-lookup"><span data-stu-id="d5330-150">Send an [MENewStream](menewstream.md) event for each new stream—that is, each stream that was previously deselected and is now selected.</span></span> <span data-ttu-id="d5330-151">Bei den Ereignisdaten handelt es sich um einen Zeiger auf den Stream.</span><span class="sxs-lookup"><span data-stu-id="d5330-151">The event data is a pointer to the stream.</span></span>
2.  <span data-ttu-id="d5330-152">Senden Sie ein [meupdatedstream](meupdatedstream.md) -Ereignis für jeden Datenstrom, der zuvor ausgewählt wurde und noch ausgewählt ist.</span><span class="sxs-lookup"><span data-stu-id="d5330-152">Send an [MEUpdatedStream](meupdatedstream.md) event for each stream that was previously selected and is still selected.</span></span> <span data-ttu-id="d5330-153">Bei den Ereignisdaten handelt es sich um einen Zeiger auf den Stream.</span><span class="sxs-lookup"><span data-stu-id="d5330-153">The event data is a pointer to the stream.</span></span> <span data-ttu-id="d5330-154">(Senden Sie kein Ereignis für nicht ausgewählte Streams.)</span><span class="sxs-lookup"><span data-stu-id="d5330-154">(Do not send an event for deselected streams.)</span></span>
3.  <span data-ttu-id="d5330-155">Wenn die Quelle sucht, senden Sie ein [mesourceseeked](mesourceseeked.md) -Ereignis.</span><span class="sxs-lookup"><span data-stu-id="d5330-155">If the source is seeking, send an [MESourceSeeked](mesourceseeked.md) event.</span></span> <span data-ttu-id="d5330-156">Andernfalls wird ein [mesourcestarted](mesourcestarted.md) -Ereignis gesendet.</span><span class="sxs-lookup"><span data-stu-id="d5330-156">Otherwise, send an [MESourceStarted](mesourcestarted.md) event.</span></span> <span data-ttu-id="d5330-157">Bei den Ereignisdaten handelt es sich um die Startzeit, die in der [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) -Methode angegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="d5330-157">The event data is the start time that was specified in the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method.</span></span> <span data-ttu-id="d5330-158">Legen Sie für das mesourcestarted-Ereignis, wenn die Startzeit VT \_ leer ist, das [**\_ \_ \_ tatsächliche \_ Start**](mf-event-source-actual-start-attribute.md) -Attribut der MF-Ereignis Quelle für das Ereignis fest.</span><span class="sxs-lookup"><span data-stu-id="d5330-158">For the MESourceStarted event, if the start time is VT\_EMPTY, set the [**MF\_EVENT\_SOURCE\_ACTUAL\_START**](mf-event-source-actual-start-attribute.md) attribute on the event.</span></span> <span data-ttu-id="d5330-159">Der Attribut Wert ist die tatsächliche Startzeit.</span><span class="sxs-lookup"><span data-stu-id="d5330-159">The attribute value is the actual start time.</span></span>
4.  <span data-ttu-id="d5330-160">Senden Sie für jeden Stream, wenn die Quelle sucht, ein [mestreamseeked](mestreamseeked.md) -Ereignis.</span><span class="sxs-lookup"><span data-stu-id="d5330-160">For each stream, if the source is seeking, send an [MEStreamSeeked](mestreamseeked.md) event.</span></span> <span data-ttu-id="d5330-161">Andernfalls senden Sie ein [mestreamstarted](mestreamstarted.md) -Ereignis.</span><span class="sxs-lookup"><span data-stu-id="d5330-161">Otherwise, send an [MEStreamStarted](mestreamstarted.md) event.</span></span> <span data-ttu-id="d5330-162">Die Ereignisdaten sind die Startzeit.</span><span class="sxs-lookup"><span data-stu-id="d5330-162">The event data is the start time.</span></span> <span data-ttu-id="d5330-163">(Die Medienquelle kann ein Ereignis im Stream durch Aufrufen der [**imfmediaeventgenerator:: queueevent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-queueevent) -Methode des Streams in die Warteschlange stellen.)</span><span class="sxs-lookup"><span data-stu-id="d5330-163">(The media source can queue an event on the stream by calling the stream's [**IMFMediaEventGenerator::QueueEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-queueevent) method.)</span></span>

<span data-ttu-id="d5330-164">Wenn ein Datenstrom deaktiviert wird, fahren Sie den Datenstrom herunter.</span><span class="sxs-lookup"><span data-stu-id="d5330-164">When a stream is deselected, shut down the stream.</span></span> <span data-ttu-id="d5330-165">Der Stream sollte an diesem Punkt keine weiteren Ereignisse in die Warteschlange stellen.</span><span class="sxs-lookup"><span data-stu-id="d5330-165">The stream should not queue any more events at that point.</span></span>

<span data-ttu-id="d5330-166">Das Zeitformat für die [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) Methode wird im *pguidtimeformat* -Parameter angegeben.</span><span class="sxs-lookup"><span data-stu-id="d5330-166">The time format for the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method is given in the *pguidTimeFormat* parameter.</span></span> <span data-ttu-id="d5330-167">Das Standardzeit Format (angegeben durch **GUID \_ null**) ist 100-Nanosecond-Einheiten.</span><span class="sxs-lookup"><span data-stu-id="d5330-167">The standard time format, indicated by **GUID\_NULL**, is 100-nanosecond units.</span></span> <span data-ttu-id="d5330-168">Eine Medienquelle muss dieses Zeitformat unterstützen.</span><span class="sxs-lookup"><span data-stu-id="d5330-168">A media source must support this time format.</span></span>

### <a name="seeking"></a><span data-ttu-id="d5330-169">Diejenigen</span><span class="sxs-lookup"><span data-stu-id="d5330-169">Seeking</span></span>

<span data-ttu-id="d5330-170">Bei der Suche wird die angeforderte Anfangsposition möglicherweise nicht auf eine exakte Stichproben Grenze zurückgegriffen.</span><span class="sxs-lookup"><span data-stu-id="d5330-170">When seeking, the requested start position might not fall on an exact sample boundary.</span></span> <span data-ttu-id="d5330-171">Außerdem kann die Startposition für komprimierten Inhalt zwischen Keyframes liegen.</span><span class="sxs-lookup"><span data-stu-id="d5330-171">Also, for compressed content, the start position might fall between key frames.</span></span> <span data-ttu-id="d5330-172">Ein Datenstrom sollte Beispiele aus dem frühesten Punkt liefern, der erforderlich ist, um ein unkomprimiertes Beispiel an der angeforderten Startposition zu liefern.</span><span class="sxs-lookup"><span data-stu-id="d5330-172">A stream should deliver samples from the earliest point needed to produce an uncompressed sample at the requested start position.</span></span> <span data-ttu-id="d5330-173">Für Video bedeutet das, dass Sie mit dem vorherigen Keyframe beginnen.</span><span class="sxs-lookup"><span data-stu-id="d5330-173">For video, that means starting from the previous key frame.</span></span> <span data-ttu-id="d5330-174">Die Pipeline ist dafür verantwortlich, die zusätzlichen Frames aus dem Decoder abzulegen, sodass die Wiedergabe zum angeforderten Zeitpunkt beginnt.</span><span class="sxs-lookup"><span data-stu-id="d5330-174">The pipeline is responsible for dropping the extra frames from the decoder, so that playback starts at the requested time.</span></span>

<span data-ttu-id="d5330-175">Die in den Quell Ereignissen angegebene Startzeit ([mesourcestarted](mesourcestarted.md), [mesourceseeked](mesourceseeked.md), [mestreamstarted](mestreamstarted.md)und [mestreamseeked](mestreamseeked.md)) ist die angeforderte Startzeit (der Wert, der in der [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) Methode angegeben ist), unabhängig von der tatsächlichen Startposition.</span><span class="sxs-lookup"><span data-stu-id="d5330-175">The starting time given in the source events ([MESourceStarted](mesourcestarted.md), [MESourceSeeked](mesourceseeked.md), [MEStreamStarted](mestreamstarted.md), and [MEStreamSeeked](mestreamseeked.md)) is the requested starting time (the value given in the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method), regardless of the actual start position.</span></span>

<span data-ttu-id="d5330-176">Nehmen wir beispielsweise an, dass die ersten Frames eines Videodaten Stroms die folgenden Eigenschaften aufweisen:</span><span class="sxs-lookup"><span data-stu-id="d5330-176">For example, suppose the first few frames of a video stream have the following characteristics:</span></span>



| <span data-ttu-id="d5330-177">Beispiel</span><span class="sxs-lookup"><span data-stu-id="d5330-177">Sample</span></span>     | <span data-ttu-id="d5330-178">1</span><span class="sxs-lookup"><span data-stu-id="d5330-178">1</span></span>       | <span data-ttu-id="d5330-179">2</span><span class="sxs-lookup"><span data-stu-id="d5330-179">2</span></span>       | <span data-ttu-id="d5330-180">3</span><span class="sxs-lookup"><span data-stu-id="d5330-180">3</span></span>        | <span data-ttu-id="d5330-181">4</span><span class="sxs-lookup"><span data-stu-id="d5330-181">4</span></span>        |
|------------|---------|---------|----------|----------|
| <span data-ttu-id="d5330-182">Time</span><span class="sxs-lookup"><span data-stu-id="d5330-182">Time</span></span>       | <span data-ttu-id="d5330-183">33 MS</span><span class="sxs-lookup"><span data-stu-id="d5330-183">33 msec</span></span> | <span data-ttu-id="d5330-184">66 MS</span><span class="sxs-lookup"><span data-stu-id="d5330-184">66 msec</span></span> | <span data-ttu-id="d5330-185">100 MS</span><span class="sxs-lookup"><span data-stu-id="d5330-185">100 msec</span></span> | <span data-ttu-id="d5330-186">133 MS</span><span class="sxs-lookup"><span data-stu-id="d5330-186">133 msec</span></span> |
| <span data-ttu-id="d5330-187">Keyframe?</span><span class="sxs-lookup"><span data-stu-id="d5330-187">Key frame?</span></span> | <span data-ttu-id="d5330-188">Ja</span><span class="sxs-lookup"><span data-stu-id="d5330-188">Yes</span></span>     | <span data-ttu-id="d5330-189">Nein</span><span class="sxs-lookup"><span data-stu-id="d5330-189">No</span></span>      | <span data-ttu-id="d5330-190">Nein</span><span class="sxs-lookup"><span data-stu-id="d5330-190">No</span></span>       | <span data-ttu-id="d5330-191">Ja</span><span class="sxs-lookup"><span data-stu-id="d5330-191">Yes</span></span>      |



 

<span data-ttu-id="d5330-192">Wenn die [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) -Methode mit einem Wert von 100 Millisekunden aufgerufen wird, muss die Quelle Videos aus dem Frame 1, dem ersten Keyframe vor diesem Zeitpunkt, ausgeben.</span><span class="sxs-lookup"><span data-stu-id="d5330-192">If the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method is called with a value of 100 milliseconds, the source needs to output video starting from frame 1, the first key frame prior to this time.</span></span> <span data-ttu-id="d5330-193">Das Start Ereignis gibt weiterhin 100 Millisekunden in den Ereignisdaten an.</span><span class="sxs-lookup"><span data-stu-id="d5330-193">The start event will still indicate 100 milliseconds in the event data.</span></span>

## <a name="pausing-the-media-source"></a><span data-ttu-id="d5330-194">Anhalten der Medienquelle</span><span class="sxs-lookup"><span data-stu-id="d5330-194">Pausing the Media Source</span></span>

<span data-ttu-id="d5330-195">Die [**imfmediasource::P ause**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) -Methode hält die Medienquelle an.</span><span class="sxs-lookup"><span data-stu-id="d5330-195">The [**IMFMediaSource::Pause**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) method pauses the media source.</span></span>

<span data-ttu-id="d5330-196">Während die Quelle angehalten ist, kann ein Stream neue Beispiele erstellen und diese in einer Warteschlange speichern, aber der Stream liefert die Beispiele nicht.</span><span class="sxs-lookup"><span data-stu-id="d5330-196">While the source is paused, a stream can create new samples and store them on a queue, but the stream does not deliver the samples.</span></span> <span data-ttu-id="d5330-197">Hier sind einige Ausnahmen zu dieser Regel:</span><span class="sxs-lookup"><span data-stu-id="d5330-197">Here are some exceptions to this rule:</span></span>

-   <span data-ttu-id="d5330-198">Live Quellen sollten Daten bei angehaltenen Daten löschen.</span><span class="sxs-lookup"><span data-stu-id="d5330-198">Live sources should drop data while paused.</span></span>
-   <span data-ttu-id="d5330-199">Wenn die Quelle Daten aus einem Netzwerk abruft, wird der Server möglicherweise angehalten.</span><span class="sxs-lookup"><span data-stu-id="d5330-199">If the source gets data from a network, it might pause the server.</span></span>

<span data-ttu-id="d5330-200">Wenn der Client [**IMF Mediastream:: requestsample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) aufruft, während die Quelle angehalten ist, wird die Anforderung auch in die Warteschlange eingereiht, bis die Quelle erneut gestartet wird.</span><span class="sxs-lookup"><span data-stu-id="d5330-200">If the client calls [**IMFMediaStream::RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) while the source is paused, the request is also queued until the source is started again.</span></span> <span data-ttu-id="d5330-201">Anforderungen dürfen nicht gelöscht werden.</span><span class="sxs-lookup"><span data-stu-id="d5330-201">Requests should not be dropped.</span></span>

<span data-ttu-id="d5330-202">Das Anhalten ist nur im Zustand "gestartet" zulässig.</span><span class="sxs-lookup"><span data-stu-id="d5330-202">Pausing is allowed only from the started state.</span></span> <span data-ttu-id="d5330-203">Andernfalls sollte die [**Pause**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) einen **\_ \_ ungültigen \_ Status \_ Übergang von MF E** zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="d5330-203">Otherwise, [**Pause**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) should return **MF\_E\_INVALID\_STATE\_TRANSITION**.</span></span>

## <a name="generating-source-data"></a><span data-ttu-id="d5330-204">Quelldaten werden erzeugt.</span><span class="sxs-lookup"><span data-stu-id="d5330-204">Generating Source Data</span></span>

<span data-ttu-id="d5330-205">Media Foundation verwendet ein *Pull-Modell*, d. h., dass Streams als Reaktion auf Anforderungen von der Pipeline Stichproben generieren und bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="d5330-205">Media Foundation uses a *pull model*, meaning that streams generate and deliver samples in response to requests from the pipeline.</span></span> <span data-ttu-id="d5330-206">Ein Datenstrom kann Beispiele liefern, wenn die Medienquelle ausgeführt wird und der Stream ausgewählt ist.</span><span class="sxs-lookup"><span data-stu-id="d5330-206">A stream can deliver samples when the media source is running and the stream is selected.</span></span> <span data-ttu-id="d5330-207">Ein Datenstrom liefert nur Daten, wenn der Client ein neues Beispiel anfordert.</span><span class="sxs-lookup"><span data-stu-id="d5330-207">A stream delivers data only when the client requests a new sample.</span></span>

### <a name="sample-requests"></a><span data-ttu-id="d5330-208">Beispielanforderungen</span><span class="sxs-lookup"><span data-stu-id="d5330-208">Sample Requests</span></span>

<span data-ttu-id="d5330-209">Der Client fordert ein neues Beispiel durch Aufrufen von [**imfmediastream:: requestsample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample)an.</span><span class="sxs-lookup"><span data-stu-id="d5330-209">The client requests a new sample by calling [**IMFMediaStream::RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span></span> <span data-ttu-id="d5330-210">Dies ist die Abfolge der Vorgänge:</span><span class="sxs-lookup"><span data-stu-id="d5330-210">Here is the sequence of operations:</span></span>

1.  <span data-ttu-id="d5330-211">Der Client ruft [**IMF Mediastream:: requestsample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample)auf.</span><span class="sxs-lookup"><span data-stu-id="d5330-211">The client calls [**IMFMediaStream::RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span></span> <span data-ttu-id="d5330-212">Das-Argument ist ein Zeiger auf ein optionales *Tokenobjekt* , das der Client zum Nachverfolgen der Anforderung verwendet.</span><span class="sxs-lookup"><span data-stu-id="d5330-212">The argument is a pointer to an optional *token* object that the client uses to track the request.</span></span> <span data-ttu-id="d5330-213">Der Client implementiert das Token.</span><span class="sxs-lookup"><span data-stu-id="d5330-213">The client implements the token.</span></span> <span data-ttu-id="d5330-214">Token müssen die **IUnknown** -Schnittstelle verfügbar machen.</span><span class="sxs-lookup"><span data-stu-id="d5330-214">Tokens must expose the **IUnknown** interface.</span></span> <span data-ttu-id="d5330-215">Der Client kann auch einen NULL-Zeiger anstelle eines Tokens übergeben.</span><span class="sxs-lookup"><span data-stu-id="d5330-215">The client can also pass in a NULL pointer instead of a token.</span></span>
2.  <span data-ttu-id="d5330-216">Wenn der Client ein Token bereitgestellt hat, ruft der Medienstrom die **adressf** für das Token auf und platziert das Token in einer First-in-First-Out-Warteschlange.</span><span class="sxs-lookup"><span data-stu-id="d5330-216">If the client provided a token, the media stream calls **AddRef** on the token and places the token in a first-in, first-out queue.</span></span> <span data-ttu-id="d5330-217">Die-Methode gibt zurück, und die restlichen Schritte werden asynchron ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="d5330-217">The method returns, and the remaining steps occur asynchronously.</span></span>

3.  <span data-ttu-id="d5330-218">Wenn weitere Daten verfügbar sind, erstellt der Mediendaten Strom ein neues Beispiel.</span><span class="sxs-lookup"><span data-stu-id="d5330-218">When more data is available, the media stream creates a new sample.</span></span> <span data-ttu-id="d5330-219">(Dieser Schritt wird im nächsten Abschnitt ausführlicher beschrieben.)</span><span class="sxs-lookup"><span data-stu-id="d5330-219">(This step is described in more detail in the next section.)</span></span>
4.  <span data-ttu-id="d5330-220">Der Mediendaten Strom Ruft das erste Token aus der Warteschlange ab.</span><span class="sxs-lookup"><span data-stu-id="d5330-220">The media stream pulls the first token from the queue.</span></span>
5.  <span data-ttu-id="d5330-221">Wenn das Token nicht **null** ist, legt der Medienstrom das [**MF SampleExtension- \_ tokenattribut**](mfsampleextension-token-attribute.md) für das Medien Beispiel fest.</span><span class="sxs-lookup"><span data-stu-id="d5330-221">If the token is not **NULL**, the media stream sets the [**MFSampleExtension\_Token**](mfsampleextension-token-attribute.md) attribute on the media sample.</span></span> <span data-ttu-id="d5330-222">Der Wert des-Attributs ist ein Zeiger auf das Token.</span><span class="sxs-lookup"><span data-stu-id="d5330-222">The value of the attribute is a pointer to the token.</span></span>
6.  <span data-ttu-id="d5330-223">Der Mediendaten Strom sendet ein [memediasample](memediasample.md) -Ereignis.</span><span class="sxs-lookup"><span data-stu-id="d5330-223">The media stream sends an [MEMediaSample](memediasample.md) event.</span></span> <span data-ttu-id="d5330-224">Die Ereignisdaten sind ein Zeiger auf die [**imfsample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) -Schnittstelle des Beispiels.</span><span class="sxs-lookup"><span data-stu-id="d5330-224">The event data is a pointer to the sample's [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) interface.</span></span>
7.  <span data-ttu-id="d5330-225">Wenn der Client ein Token bereitgestellt hat, ruft der Medienstrom die **Freigabe** für das Tokenobjekt auf.</span><span class="sxs-lookup"><span data-stu-id="d5330-225">If the client provided a token, the media stream calls **Release** on the token object.</span></span>

<span data-ttu-id="d5330-226">Wenn der Mediendaten Strom die [**requestsample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) -Anforderung des Clients nicht erfüllen kann, ruft er das Token aus der Warteschlange ab und ruft die **Freigabe** für das Token auf, sendet jedoch kein [memediasample](memediasample.md) -Ereignis.</span><span class="sxs-lookup"><span data-stu-id="d5330-226">If the media stream cannot fulfill the client's [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) request, it pulls the token from the queue and calls **Release** on the token, but does not send an [MEMediaSample](memediasample.md) event.</span></span>

<span data-ttu-id="d5330-227">Der Client kann das Token verwenden, um den Status der Anforderung zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="d5330-227">The client can use the token to track the status of the request.</span></span> <span data-ttu-id="d5330-228">Wenn der Client das [memediasample](memediasample.md) -Ereignis empfängt, kann er das Token aus dem Beispiel erhalten und mit der ursprünglichen Anforderung vergleichen.</span><span class="sxs-lookup"><span data-stu-id="d5330-228">When the client receives the [MEMediaSample](memediasample.md) event, it can get the token from the sample and match it against the original request.</span></span> <span data-ttu-id="d5330-229">Der Client kann auch das Token verwenden, um zu ermitteln, ob die Medienquelle die Anforderung gelöscht hat.</span><span class="sxs-lookup"><span data-stu-id="d5330-229">The client can also use the token to detect if the media source dropped the request.</span></span> <span data-ttu-id="d5330-230">Wenn der Verweis Zähler des Tokens auf Null fällt und der Mediendaten Strom kein memediasample-Ereignis sendet, bedeutet dies, dass die Anforderung gelöscht wurde.</span><span class="sxs-lookup"><span data-stu-id="d5330-230">If the token's reference count falls to zero and the media stream does not send an MEMediaSample event, it means that the request was dropped.</span></span>

<span data-ttu-id="d5330-231">In den folgenden Schritten wird davon ausgegangen, dass die [**requestsample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) -Methode als asynchroner Vorgang implementiert ist.</span><span class="sxs-lookup"><span data-stu-id="d5330-231">The steps listed here assume that [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) method is implemented as an asynchronous operation.</span></span> <span data-ttu-id="d5330-232">Wenn die Methode synchron ist, müssen Sie das Anforderungs Token nicht in eine Warteschlange einfügen.</span><span class="sxs-lookup"><span data-stu-id="d5330-232">If the method is synchronous, you do not need to put the request token on a queue.</span></span> <span data-ttu-id="d5330-233">Wenn das Erstellen von Daten eine beträchtliche Zeitspanne benötigt, wird jedoch ein asynchroner Ansatz empfohlen – beispielsweise, wenn die Quelle Daten aus einem Bytestream liest.</span><span class="sxs-lookup"><span data-stu-id="d5330-233">However, if generating data takes any significant amount of time, an asynchronous approach is recommended—for example, if the source reads data from a byte stream.</span></span>

<span data-ttu-id="d5330-234">Der Stream ist für das Puffern von Daten verantwortlich, die zwischen Aufrufen von [**requestsample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample)akkumuliert werden.</span><span class="sxs-lookup"><span data-stu-id="d5330-234">The stream is responsible for buffering any data that accumulates between calls to [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span></span>

<span data-ttu-id="d5330-235">Wenn der Mediendaten Strom das Ende des Streams erreicht, sendet er ein [meendof Stream](meendofstream.md) -Ereignis nach dem letzten Beispiel.</span><span class="sxs-lookup"><span data-stu-id="d5330-235">When the media stream reaches the end of the stream, it sends an [MEEndOfStream](meendofstream.md) event after the last sample.</span></span> <span data-ttu-id="d5330-236">Nachdem jeder Stream beendet wurde, sendet die Medienquelle ein [meendof Presentation](meendofpresentation.md) -Ereignis.</span><span class="sxs-lookup"><span data-stu-id="d5330-236">After every stream has ended, the media source sends an [MEEndOfPresentation](meendofpresentation.md) event.</span></span> <span data-ttu-id="d5330-237">Nachdem ein Mediendaten Strom das meendof Stream-Ereignis gesendet hat, gibt die [**requestsample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) -Methode das **\_ \_ Ende \_ des Daten \_ Stroms von MF E** zurück, bis die Quelle neu gestartet wird.</span><span class="sxs-lookup"><span data-stu-id="d5330-237">After a media stream sends the MEEndOfStream event, the [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) method returns **MF\_E\_END\_OF\_STREAM** until the source is restarted.</span></span>

### <a name="allocating-samples"></a><span data-ttu-id="d5330-238">Zuordnen von Beispielen</span><span class="sxs-lookup"><span data-stu-id="d5330-238">Allocating Samples</span></span>

<span data-ttu-id="d5330-239">Wenn der Stream zum Ausfüllen einer ausstehenden Beispiel Anforderung bereit ist, wird ein neues Beispiel erstellt, dem ein oder mehrere Medien Puffer hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="d5330-239">When the stream is ready to fill a pending sample request, it creates a new sample and adds one or more media buffers to the sample.</span></span> <span data-ttu-id="d5330-240">Weitere Informationen zum Erstellen von Medien Puffern finden Sie unter [Medien Puffer](media-buffers.md).</span><span class="sxs-lookup"><span data-stu-id="d5330-240">For more information about creating media buffers, see [Media Buffers](media-buffers.md).</span></span>

<span data-ttu-id="d5330-241">Der Stream muss den Zeitstempel und die Dauer, sofern bekannt, festlegen.</span><span class="sxs-lookup"><span data-stu-id="d5330-241">The stream must set the time stamp and the duration, if known.</span></span> <span data-ttu-id="d5330-242">Der Zeitstempel ist relativ zur Quelle.</span><span class="sxs-lookup"><span data-stu-id="d5330-242">The time stamp is relative to the source.</span></span> <span data-ttu-id="d5330-243">In den meisten Fällen entspricht der Anfang des Inhalts einem Zeitstempel von NULL.</span><span class="sxs-lookup"><span data-stu-id="d5330-243">In most cases, the start of the content corresponds to a time stamp of zero.</span></span> <span data-ttu-id="d5330-244">Wenn die Quelle beispielsweise aus einer Mediendatei liest, hat der Start der Datei den Zeitstempel NULL.</span><span class="sxs-lookup"><span data-stu-id="d5330-244">For example, if the source reads from a media file, the start of the file would have a time stamp of zero.</span></span>

<span data-ttu-id="d5330-245">Der Zeitstempel im Beispiel entspricht nicht notwendigerweise der Präsentationszeit.</span><span class="sxs-lookup"><span data-stu-id="d5330-245">The time stamp on the sample does not necessarily equal the presentation time.</span></span> <span data-ttu-id="d5330-246">Die Medien Sitzung wird aus der Quell Zeit in die Präsentationszeit übersetzt.</span><span class="sxs-lookup"><span data-stu-id="d5330-246">The Media Session translates from source time to presentation time.</span></span> <span data-ttu-id="d5330-247">Bei komprimierten Daten sollte der Stream Daten generieren, beginnend mit dem nächsten Keyframe vor der Startzeit.</span><span class="sxs-lookup"><span data-stu-id="d5330-247">For compressed data, the stream should generate data starting from the nearest key frame before the start time.</span></span> <span data-ttu-id="d5330-248">Dadurch kann der Decoder den Frame übermitteln, der zum angeforderten Startzeitpunkt angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="d5330-248">This enables the decoder to deliver the frame that appears at the requested start time.</span></span> <span data-ttu-id="d5330-249">(Andernfalls muss der Decoder bis zum folgenden Keyframe warten.)</span><span class="sxs-lookup"><span data-stu-id="d5330-249">(Otherwise, the decoder would need to wait until the following key frame.)</span></span>

<span data-ttu-id="d5330-250">Wenn die Wiedergabe Rate schneller oder langsamer als 1,0 ist, passt die Pipeline die Rate der Präsentations Uhr an.</span><span class="sxs-lookup"><span data-stu-id="d5330-250">If the playback rate is faster or slower than 1.0, the pipeline adjusts the rate of the presentation clock.</span></span> <span data-ttu-id="d5330-251">Die Quelle passt die Zeitstempel für Stichproben nicht an.</span><span class="sxs-lookup"><span data-stu-id="d5330-251">The source does not adjust the time stamps on samples.</span></span>

<span data-ttu-id="d5330-252">Die Quelle kann zusätzliche Informationen über das Beispiel festlegen, indem Attribute festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="d5330-252">The source can set additional information on the sample by setting attributes.</span></span> <span data-ttu-id="d5330-253">Eine Liste der Beispiel Attribute finden Sie unter [Beispiel Attribute](sample-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="d5330-253">For a list of sample attributes, see [Sample Attributes](sample-attributes.md).</span></span>

### <a name="gaps-in-the-stream"></a><span data-ttu-id="d5330-254">Lücken im Stream</span><span class="sxs-lookup"><span data-stu-id="d5330-254">Gaps in the Stream</span></span>

<span data-ttu-id="d5330-255">Wenn ein Datenstrom eine Lücke mit signifikanter Länge aufweist, wird empfohlen, dass der Stream ein [mestreamtick](mestreamtick.md) -Ereignis sendet.</span><span class="sxs-lookup"><span data-stu-id="d5330-255">If a stream contains a gap of significant length, it is recommended that the stream send an [MEStreamTick](mestreamtick.md) event.</span></span> <span data-ttu-id="d5330-256">Dieses Ereignis benachrichtigt den Client, dass ein Beispiel fehlt.</span><span class="sxs-lookup"><span data-stu-id="d5330-256">This event notifies the client that a sample is missing.</span></span> <span data-ttu-id="d5330-257">Bei den Ereignisdaten handelt es sich um den Zeitstempel des fehlenden Beispiels in 100-Nanosecond-Einheiten (**VT \_ I8**).</span><span class="sxs-lookup"><span data-stu-id="d5330-257">The event data is the time stamp of the missing sample, in 100-nanosecond units (**VT\_I8**).</span></span> <span data-ttu-id="d5330-258">Dieses Ereignis kann dazu führt, dass Downstreamkomponenten auf nicht eingehende Beispiele warten.</span><span class="sxs-lookup"><span data-stu-id="d5330-258">This event can save downstream components from waiting for samples that will not arrive.</span></span> <span data-ttu-id="d5330-259">Der Stream kann beliebig viele mestreamtick-Ereignisse senden, um die Lücke im Stream zu überspannen.</span><span class="sxs-lookup"><span data-stu-id="d5330-259">The stream can send as many MEStreamTick events as needed to span the gap in the stream.</span></span>

## <a name="shutting-down-the-media-source"></a><span data-ttu-id="d5330-260">Die Medienquelle wird heruntergefahren.</span><span class="sxs-lookup"><span data-stu-id="d5330-260">Shutting Down the Media Source</span></span>

<span data-ttu-id="d5330-261">Wenn der Client mithilfe der Medienquelle ausgeführt wird, wird [**imfmediasource:: Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-shutdown)aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="d5330-261">When the client is done using the media source, it calls [**IMFMediaSource::Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-shutdown).</span></span> <span data-ttu-id="d5330-262">Innerhalb dieser Methode sollte die Medienquelle alle Zirkel Verweis Zählungen unterbrechen.</span><span class="sxs-lookup"><span data-stu-id="d5330-262">Inside this method, the media source should break any circular reference counts.</span></span> <span data-ttu-id="d5330-263">In der Regel gibt es zirkuläre Verweise zwischen der Medienquelle und den Mediendaten strömen.</span><span class="sxs-lookup"><span data-stu-id="d5330-263">Typically, there will be circular references between the media source and the media streams.</span></span>

<span data-ttu-id="d5330-264">Wenn Sie [**imfmediaeventgenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator)mithilfe der Ereignis Warteschlange implementieren, müssen Sie [**imfmediaeventqueue:: Shutdown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventqueue-shutdown) für die Ereignis Warteschlange abrufen.</span><span class="sxs-lookup"><span data-stu-id="d5330-264">If you are using the event queue to implement [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator), call [**IMFMediaEventQueue::Shutdown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventqueue-shutdown) on the event queue.</span></span> <span data-ttu-id="d5330-265">Diese Methode beendet die Ereignis Warteschlange und signalisiert jedem Aufrufer, der zurzeit auf ein Ereignis wartet.</span><span class="sxs-lookup"><span data-stu-id="d5330-265">This method shuts down the event queue and signals any caller that is currently waiting for an event.</span></span>

<span data-ttu-id="d5330-266">Nach dem Herunterfahren geben alle Methoden der Quelle **das \_ \_ Herunterfahren von MF E** zurück, mit Ausnahme von **IUnknown** -Methoden.</span><span class="sxs-lookup"><span data-stu-id="d5330-266">After shutdown, all methods on the source return **MF\_E\_SHUTDOWN**, with the exception of **IUnknown** methods.</span></span>

## <a name="live-sources"></a><span data-ttu-id="d5330-267">Live Quellen</span><span class="sxs-lookup"><span data-stu-id="d5330-267">Live Sources</span></span>

<span data-ttu-id="d5330-268">Ab Windows 7 werden von Media Foundation automatisch Audiogeräte und Video Erfassungsgeräte unterstützt.</span><span class="sxs-lookup"><span data-stu-id="d5330-268">Starting in Windows 7, Media Foundation automatically supports audio and video capture devices.</span></span> <span data-ttu-id="d5330-269">Für das Video muss das Gerät in der Kategorie Video Erfassung einen "Kernel Streaming"-Mini Treiber ("") bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="d5330-269">For video, the device must provide a kernel streaming (KS) minidriver in the video capture category.</span></span> <span data-ttu-id="d5330-270">Media Foundation verwendet den PNP-Pfad zum Aufzählen des Geräts.</span><span class="sxs-lookup"><span data-stu-id="d5330-270">Media Foundation uses the PnP path to enumerate the device.</span></span> <span data-ttu-id="d5330-271">Für Audiodaten verwendet Media Foundation die Windows-Multimedia-Geräte-API (mmdevice), um audioendpunktgeräte aufzuzählen.</span><span class="sxs-lookup"><span data-stu-id="d5330-271">For audio, Media Foundation uses the Windows Multimedia Device (MMDevice) API to enumerate audio endpoint devices.</span></span> <span data-ttu-id="d5330-272">Wenn das Gerät diese Kriterien erfüllt, muss keine benutzerdefinierte Medienquelle implementiert werden.</span><span class="sxs-lookup"><span data-stu-id="d5330-272">If the device meets these criteria, there is no need to implement a custom media source.</span></span>

<span data-ttu-id="d5330-273">Möglicherweise möchten Sie jedoch eine benutzerdefinierte Medienquelle für einen anderen Gerätetyp oder eine andere Live Datenquelle implementieren.</span><span class="sxs-lookup"><span data-stu-id="d5330-273">However, you might want to implement a custom media source for some other type of device or other live data source.</span></span> <span data-ttu-id="d5330-274">Es gibt nur wenige Unterschiede zwischen einer Live Quelle und anderen Medienquellen:</span><span class="sxs-lookup"><span data-stu-id="d5330-274">There are only a few differences between a live source and other media sources:</span></span>

-   <span data-ttu-id="d5330-275">Geben Sie in der [**imfmediasource:: getcharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-getcharacteristics) -Methode das Flag " **mfmediasource \_ is \_ Live** " zurück.</span><span class="sxs-lookup"><span data-stu-id="d5330-275">In the [**IMFMediaSource::GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-getcharacteristics) method, return the **MFMEDIASOURCE\_IS\_LIVE** flag.</span></span>
-   <span data-ttu-id="d5330-276">Das erste Beispiel sollte einen Zeitstempel von NULL aufweisen.</span><span class="sxs-lookup"><span data-stu-id="d5330-276">The first sample should have a time stamp of zero.</span></span>
-   <span data-ttu-id="d5330-277">Ereignisse und streamingzustände werden wie Medienquellen behandelt, mit Ausnahme des angehaltenen Zustands.</span><span class="sxs-lookup"><span data-stu-id="d5330-277">Events and streaming states are handled the same as media sources, with the exception of the paused state.</span></span>
-   <span data-ttu-id="d5330-278">Bei angehaltenen Warteschlangen nicht in die Warteschlange.</span><span class="sxs-lookup"><span data-stu-id="d5330-278">While paused, do not queue samples.</span></span> <span data-ttu-id="d5330-279">Löschen Sie alle Daten, die während der Unterbrechung generiert werden.</span><span class="sxs-lookup"><span data-stu-id="d5330-279">Drop any data that is generated while paused.</span></span>
-   <span data-ttu-id="d5330-280">Live Quellen unterstützen in der Regel nicht das suchen, umkehren von spielen oder Raten Kontrolle.</span><span class="sxs-lookup"><span data-stu-id="d5330-280">Live sources typically do not support seeking, reverse play, or rate control.</span></span>

## <a name="related-topics"></a><span data-ttu-id="d5330-281">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="d5330-281">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d5330-282">Medienquellen</span><span class="sxs-lookup"><span data-stu-id="d5330-282">Media Sources</span></span>](media-sources.md)
</dt> <dt>

[<span data-ttu-id="d5330-283">Tutorial: Schreiben einer benutzerdefinierten Medienquelle</span><span class="sxs-lookup"><span data-stu-id="d5330-283">Tutorial: Writing a Custom Media Source</span></span>](tutorial--writing-a-custom-media-source.md)
</dt> </dl>

 

 



