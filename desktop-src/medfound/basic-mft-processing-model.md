---
description: In diesem Thema wird beschrieben, wie ein Client eine Media Foundation Transformation (MFT) verwendet, um Daten zu verarbeiten. Der Client ist alles, was Methoden auf dem MFT direkt aufruft. Dies kann die Anwendung oder die Media Foundation Pipeline sein.
ms.assetid: be977d75-999e-4e57-9672-00a89246a2c1
title: Einfaches MFT-Verarbeitungsmodell
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9ca54df6d9765aaf54456c3d9dc4461a82a93d41
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "104041569"
---
# <a name="basic-mft-processing-model"></a><span data-ttu-id="a3370-105">Einfaches MFT-Verarbeitungsmodell</span><span class="sxs-lookup"><span data-stu-id="a3370-105">Basic MFT Processing Model</span></span>

<span data-ttu-id="a3370-106">In diesem Thema wird beschrieben, wie ein Client eine Media Foundation Transformation (MFT) verwendet, um Daten zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="a3370-106">This topic describes how a client uses a Media Foundation transform (MFT) to process data.</span></span> <span data-ttu-id="a3370-107">Der *Client* ist alles, was Methoden auf dem MFT direkt aufruft.</span><span class="sxs-lookup"><span data-stu-id="a3370-107">The *client* is anything that directly calls methods on the MFT.</span></span> <span data-ttu-id="a3370-108">Dies kann die Anwendung oder die Media Foundation Pipeline sein.</span><span class="sxs-lookup"><span data-stu-id="a3370-108">This might be the application or the Media Foundation pipeline.</span></span>

<span data-ttu-id="a3370-109">Lesen Sie dieses Thema, wenn Sie Folgendes tun:</span><span class="sxs-lookup"><span data-stu-id="a3370-109">Read this topic if you are:</span></span>

-   <span data-ttu-id="a3370-110">Schreiben einer Anwendung, die direkte Aufrufe an eine oder mehrere MFTs durchführt.</span><span class="sxs-lookup"><span data-stu-id="a3370-110">Writing an application that makes direct calls to one or more MFTs.</span></span>
-   <span data-ttu-id="a3370-111">Schreiben eines benutzerdefinierten MFT-Vorgangs, um das erwartete Verhalten einer MFT zu verstehen.</span><span class="sxs-lookup"><span data-stu-id="a3370-111">Writing a custom MFT and want to understand the expected behavior of an MFT.</span></span>

<span data-ttu-id="a3370-112">In diesem Thema wird ein *synchrones* Verarbeitungsmodell beschrieben.</span><span class="sxs-lookup"><span data-stu-id="a3370-112">This topic describes a *synchronous* processing model.</span></span> <span data-ttu-id="a3370-113">In diesem Modell blockieren alle Datenverarbeitungsmethoden, bis Sie beendet werden.</span><span class="sxs-lookup"><span data-stu-id="a3370-113">In this model, all data-processing methods block until they complete.</span></span> <span data-ttu-id="a3370-114">MFTs können auch ein *asynchrones* Modell unterstützen, das im Thema [asynchrone MFTs](asynchronous-mfts.md)beschrieben wird.</span><span class="sxs-lookup"><span data-stu-id="a3370-114">MFTs can also support an *asynchronous* model, which is described in the topic [Asynchronous MFTs](asynchronous-mfts.md).</span></span>

-   [<span data-ttu-id="a3370-115">Grundlegendes Verarbeitungsmodell</span><span class="sxs-lookup"><span data-stu-id="a3370-115">Basic Processing Model</span></span>](#basic-processing-model)
    -   [<span data-ttu-id="a3370-116">Erstellen der MFT</span><span class="sxs-lookup"><span data-stu-id="a3370-116">Create the MFT</span></span>](#create-the-mft)
    -   [<span data-ttu-id="a3370-117">Stream-IDs erhalten</span><span class="sxs-lookup"><span data-stu-id="a3370-117">Get Stream Identifiers</span></span>](#get-stream-identifiers)
    -   [<span data-ttu-id="a3370-118">Medientypen festlegen</span><span class="sxs-lookup"><span data-stu-id="a3370-118">Set Media Types</span></span>](#set-media-types)
    -   [<span data-ttu-id="a3370-119">Puffer Anforderungen erhalten</span><span class="sxs-lookup"><span data-stu-id="a3370-119">Get Buffer Requirements</span></span>](#get-buffer-requirements)
    -   [<span data-ttu-id="a3370-120">Verarbeiten von Daten</span><span class="sxs-lookup"><span data-stu-id="a3370-120">Process Data</span></span>](#process-data)
-   [<span data-ttu-id="a3370-121">Erweiterungen für das Basismodell</span><span class="sxs-lookup"><span data-stu-id="a3370-121">Extensions to the Basic Model</span></span>](#extensions-to-the-basic-model)
-   [<span data-ttu-id="a3370-122">IMF2DBuffer</span><span class="sxs-lookup"><span data-stu-id="a3370-122">IMF2DBuffer</span></span>](#imf2dbuffer)
-   [<span data-ttu-id="a3370-123">Leeren eines MFT</span><span class="sxs-lookup"><span data-stu-id="a3370-123">Flushing an MFT</span></span>](#flushing-an-mft)
-   [<span data-ttu-id="a3370-124">Entleeren eines MFT</span><span class="sxs-lookup"><span data-stu-id="a3370-124">Draining an MFT</span></span>](#draining-an-mft)
-   [<span data-ttu-id="a3370-125">Beispiel Attribute</span><span class="sxs-lookup"><span data-stu-id="a3370-125">Sample Attributes</span></span>](#sample-attributes)
-   [<span data-ttu-id="a3370-126">Unterbrechungen</span><span class="sxs-lookup"><span data-stu-id="a3370-126">Discontinuities</span></span>](#discontinuities)
-   [<span data-ttu-id="a3370-127">Dynamische Format Änderungen</span><span class="sxs-lookup"><span data-stu-id="a3370-127">Dynamic Format Changes</span></span>](#dynamic-format-changes)
-   [<span data-ttu-id="a3370-128">Streamereignisse</span><span class="sxs-lookup"><span data-stu-id="a3370-128">Stream Events</span></span>](#stream-events)
-   [<span data-ttu-id="a3370-129">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="a3370-129">Related topics</span></span>](#related-topics)

## <a name="basic-processing-model"></a><span data-ttu-id="a3370-130">Grundlegendes Verarbeitungsmodell</span><span class="sxs-lookup"><span data-stu-id="a3370-130">Basic Processing Model</span></span>

### <a name="create-the-mft"></a><span data-ttu-id="a3370-131">Erstellen der MFT</span><span class="sxs-lookup"><span data-stu-id="a3370-131">Create the MFT</span></span>

<span data-ttu-id="a3370-132">Es gibt mehrere Möglichkeiten, eine MFT zu erstellen:</span><span class="sxs-lookup"><span data-stu-id="a3370-132">There are several ways to create an MFT:</span></span>

-   <span data-ttu-id="a3370-133">Ruft die [**mftenum**](/windows/desktop/api/mfapi/nf-mfapi-mftenum) -Funktion auf.</span><span class="sxs-lookup"><span data-stu-id="a3370-133">Call the [**MFTEnum**](/windows/desktop/api/mfapi/nf-mfapi-mftenum) function.</span></span>
-   <span data-ttu-id="a3370-134">Ruft die [**mftenumex**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex) -Funktion auf.</span><span class="sxs-lookup"><span data-stu-id="a3370-134">Call the [**MFTEnumEx**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex) function.</span></span>
-   <span data-ttu-id="a3370-135">Wenn Sie die CLSID der MFT bereits kennen, können Sie einfach **cokreateinstance** aufrufen.</span><span class="sxs-lookup"><span data-stu-id="a3370-135">If you already know the CLSID of the MFT, simply call **CoCreateInstance**.</span></span>

<span data-ttu-id="a3370-136">Einige MFTs können andere Optionen bereitstellen, z. b. eine spezialisierte Erstellungs Funktion.</span><span class="sxs-lookup"><span data-stu-id="a3370-136">Some MFTs might provide other options, such as a specialized creation function.</span></span>

### <a name="get-stream-identifiers"></a><span data-ttu-id="a3370-137">Stream-IDs erhalten</span><span class="sxs-lookup"><span data-stu-id="a3370-137">Get Stream Identifiers</span></span>

<span data-ttu-id="a3370-138">Ein MFT verfügt über einen oder mehrere Daten *Ströme*.</span><span class="sxs-lookup"><span data-stu-id="a3370-138">An MFT has one or more *streams*.</span></span> <span data-ttu-id="a3370-139">Eingabedaten Ströme empfangen Eingabedaten, und Ausgabedaten Ströme generieren Ausgabedaten.</span><span class="sxs-lookup"><span data-stu-id="a3370-139">Input streams receive input data, and output streams generate output data.</span></span> <span data-ttu-id="a3370-140">Streams werden nicht als unterschiedliche Objekte dargestellt.</span><span class="sxs-lookup"><span data-stu-id="a3370-140">Streams are not represented as distinct objects.</span></span> <span data-ttu-id="a3370-141">Stattdessen übernehmen verschiedene MFT-Methoden Datenstrom-IDs als Parameter.</span><span class="sxs-lookup"><span data-stu-id="a3370-141">Instead, various MFT methods take stream identifiers as parameters.</span></span>

<span data-ttu-id="a3370-142">Einige MFTs ermöglichen dem Client das Hinzufügen oder Entfernen von Eingabedaten strömen.</span><span class="sxs-lookup"><span data-stu-id="a3370-142">Some MFTs allow the client to add or remove input streams.</span></span> <span data-ttu-id="a3370-143">Beim Streaming kann ein MFT Ausgabedaten Ströme hinzufügen oder entfernen.</span><span class="sxs-lookup"><span data-stu-id="a3370-143">During streaming, an MFT can add or remove output streams.</span></span> <span data-ttu-id="a3370-144">(Der Client kann keine Ausgabedaten Ströme hinzufügen oder entfernen.)</span><span class="sxs-lookup"><span data-stu-id="a3370-144">(The client cannot add or remove output streams.)</span></span>

1.  <span data-ttu-id="a3370-145">(Optional) Wenn Sie [**imftransform:: getstreamlimits**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamlimits) aufrufen, erhalten Sie die minimale und maximale Anzahl von Datenströmen, die von der MFT unterstützt werden können.</span><span class="sxs-lookup"><span data-stu-id="a3370-145">(Optional.) Call [**IMFTransform::GetStreamLimits**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamlimits) to get the minimum and maximum number of streams that the MFT can support.</span></span> <span data-ttu-id="a3370-146">Wenn der Minimalwert und der Höchstwert identisch sind, verfügt die MFT über eine Fixed Anzahl von Streams.</span><span class="sxs-lookup"><span data-stu-id="a3370-146">If the minimum and maximum are the same, the MFT has a fixed number of streams.</span></span>
2.  <span data-ttu-id="a3370-147">Aufrufen von [**imftransform:: getstreamcount**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamcount) , um die anfängliche Anzahl von Streams zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="a3370-147">Call [**IMFTransform::GetStreamCount**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamcount) to get the initial number of streams.</span></span>
3.  <span data-ttu-id="a3370-148">Aufrufen von [**imftransform:: getstreamids**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamids) zum Abrufen der Datenstrom Bezeichner.</span><span class="sxs-lookup"><span data-stu-id="a3370-148">Call [**IMFTransform::GetStreamIDs**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamids) to get the stream identifiers.</span></span> <span data-ttu-id="a3370-149">Wenn diese Methode E \_ notimpl zurückgibt, bedeutet dies, dass die MFT über eine Fixed Anzahl von Streams verfügt und die Datenstrom Bezeichner aufeinander folgen, beginnend bei Null.</span><span class="sxs-lookup"><span data-stu-id="a3370-149">If this method returns E\_NOTIMPL, it means the MFT has a fixed number of streams, and the stream identifiers are consecutive starting from zero.</span></span>
4.  <span data-ttu-id="a3370-150">(Optional) Wenn die MFT nicht über eine festgelegte Anzahl von Streams verfügt, müssen Sie [**imftransform:: addinputstreams**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-addinputstreams) zum Hinzufügen von weiteren Eingabedaten Strömen oder [**imftransform::D eleteinputstream**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-deleteinputstream) zum Entfernen von Eingabedaten strömen aufruft.</span><span class="sxs-lookup"><span data-stu-id="a3370-150">(Optional.) If the MFT does not have a fixed number of streams, call [**IMFTransform::AddInputStreams**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-addinputstreams) to add more input streams, or [**IMFTransform::DeleteInputStream**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-deleteinputstream) to remove input streams.</span></span> <span data-ttu-id="a3370-151">(Sie können keine Ausgabedaten Ströme hinzufügen oder entfernen.)</span><span class="sxs-lookup"><span data-stu-id="a3370-151">(You cannot add or remove output streams.)</span></span>

### <a name="set-media-types"></a><span data-ttu-id="a3370-152">Medientypen festlegen</span><span class="sxs-lookup"><span data-stu-id="a3370-152">Set Media Types</span></span>

<span data-ttu-id="a3370-153">Bevor Daten vom MFT verarbeitet werden können, muss der Client für jeden Stream der MFT einen Medientypen festlegen.</span><span class="sxs-lookup"><span data-stu-id="a3370-153">Before an MFT can process data, the client must set a media types for each of the streams of the MFT.</span></span> <span data-ttu-id="a3370-154">Eine MFT erfordert möglicherweise, dass der Client die Eingabetypen festlegt, bevor die Ausgabetypen festgelegt werden, oder erfordert möglicherweise die umgekehrte Reihenfolge (zuerst Ausgabetypen).</span><span class="sxs-lookup"><span data-stu-id="a3370-154">An MFT might require that the client set the input types before setting the output types, or might require the opposite order (output types first).</span></span> <span data-ttu-id="a3370-155">Einige MFTs haben keine Voraussetzung für die Reihenfolge.</span><span class="sxs-lookup"><span data-stu-id="a3370-155">Some MFTs do not have a requirement on the order.</span></span>

<span data-ttu-id="a3370-156">Eine MFT kann eine Liste der bevorzugten Medientypen für einen Stream bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="a3370-156">An MFT can provide a list of preferred media types for a stream.</span></span> <span data-ttu-id="a3370-157">Außerdem können MFTs die allgemeinen Formate angeben, die Sie unterstützen, indem diese Informationen der Registrierung hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="a3370-157">Also, MFTs can indicate the general formats that they support by adding this information to the registry.</span></span>

<span data-ttu-id="a3370-158">Gehen Sie folgendermaßen vor, um die Medientypen festzulegen:</span><span class="sxs-lookup"><span data-stu-id="a3370-158">To set the media types, do the following:</span></span>

1.  <span data-ttu-id="a3370-159">(Optional) Aufrufen Sie für jeden Eingabestream [**imftransform:: getinputavailabletype**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) , um die Liste der bevorzugten Typen für diesen Stream abzurufen.</span><span class="sxs-lookup"><span data-stu-id="a3370-159">(Optional.) For each input stream, call [**IMFTransform::GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) to get the list of preferred types for that stream.</span></span>
    -   <span data-ttu-id="a3370-160">Wenn diese Methode den von \_ MF \_ E \_ transformierentyp \_ nicht \_ festgelegt zurückgibt, müssen Sie zuerst die Ausgabetypen festlegen; fahren Sie mit Schritt 3 fort.</span><span class="sxs-lookup"><span data-stu-id="a3370-160">If this method returns MF\_E\_TRANSFORM\_TYPE\_NOT\_SET, you must set the output types first; skip to step 3.</span></span>
    -   <span data-ttu-id="a3370-161">Wenn die Methode E \_ notimpl zurückgibt, verfügt die MFT nicht über eine Liste der bevorzugten Eingabetypen; fahren Sie mit Schritt 2 fort.</span><span class="sxs-lookup"><span data-stu-id="a3370-161">If the method returns E\_NOTIMPL, the MFT does not have a list of preferred input types; skip to step 2.</span></span>
2.  <span data-ttu-id="a3370-162">Für jeden Eingabestream wird [**imftransform:: setinputtype**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) aufgerufen, um den Eingabetyp festzulegen.</span><span class="sxs-lookup"><span data-stu-id="a3370-162">For each input stream, call [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) to set the input type.</span></span> <span data-ttu-id="a3370-163">Sie können einen Medientyp aus Schritt 1 oder einen Typ verwenden, der Ihre Eingabedaten beschreibt.</span><span class="sxs-lookup"><span data-stu-id="a3370-163">You can use a media type from step 1, or a type that describes your input data.</span></span> <span data-ttu-id="a3370-164">Wenn ein Stream einen \_ nicht festgelegten MF-E- \_ \_ Transformationstyp zurückgibt \_ \_ , springen Sie zu Schritt 3.</span><span class="sxs-lookup"><span data-stu-id="a3370-164">If any stream returns MF\_E\_TRANSFORM\_TYPE\_NOT\_SET, skip to step 3.</span></span>
3.  <span data-ttu-id="a3370-165">(Optional) Für jeden Ausgabestream müssen Sie [**imftransform:: getoutputavailabletype**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) aufrufen, um eine Liste der bevorzugten Typen für diesen Stream abzurufen.</span><span class="sxs-lookup"><span data-stu-id="a3370-165">(Optional.) For each output stream, call [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) to get a list of preferred types for that stream.</span></span>
    -   <span data-ttu-id="a3370-166">Wenn diese Methode den MF- \_ E- \_ \_ Transformationstyp \_ nicht festgelegt zurückgibt \_ , müssen Sie zuerst die Eingabetypen festlegen, sondern zu Schritt 1 zurückkehren.</span><span class="sxs-lookup"><span data-stu-id="a3370-166">If this method returns MF\_E\_TRANSFORM\_TYPE\_NOT\_SET, you must set the input types first; go back to step 1.</span></span>
    -   <span data-ttu-id="a3370-167">Wenn ein Datenstrom E \_ notimpl zurückgibt, verfügt die MFT nicht über eine Liste der bevorzugten Ausgabetypen; fahren Sie mit Schritt 4 fort.</span><span class="sxs-lookup"><span data-stu-id="a3370-167">If any stream returns E\_NOTIMPL, the MFT does not have a list of preferred output types; skip to step 4.</span></span>
4.  <span data-ttu-id="a3370-168">Für jeden Ausgabestream müssen Sie [**imftransform:: setoutputtype**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) aufrufen, um den Ausgabetyp festzulegen.</span><span class="sxs-lookup"><span data-stu-id="a3370-168">For each output stream, call [**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) to set the output type.</span></span> <span data-ttu-id="a3370-169">Sie können einen Medientyp aus Schritt 3 oder einen Typ verwenden, der das erforderliche Ausgabeformat beschreibt.</span><span class="sxs-lookup"><span data-stu-id="a3370-169">You can use a media type from step 3, or a type that describes your required output format.</span></span>
5.  <span data-ttu-id="a3370-170">Wenn Eingabedaten Ströme keinen Medientyp aufweisen, gehen Sie zurück zu Schritt 1.</span><span class="sxs-lookup"><span data-stu-id="a3370-170">If any input streams do not have a media type, go back to step 1.</span></span>

### <a name="get-buffer-requirements"></a><span data-ttu-id="a3370-171">Puffer Anforderungen erhalten</span><span class="sxs-lookup"><span data-stu-id="a3370-171">Get Buffer Requirements</span></span>

<span data-ttu-id="a3370-172">Nachdem der Client die Medientypen festgelegt hat, sollte er die Puffer Anforderungen für jeden Stream erhalten:</span><span class="sxs-lookup"><span data-stu-id="a3370-172">After the client sets the media types, it should get the buffer requirements for each stream:</span></span>

-   <span data-ttu-id="a3370-173">Aufrufen Sie für jeden Eingabestream [**imftransform:: getinputstreaminfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreaminfo).</span><span class="sxs-lookup"><span data-stu-id="a3370-173">For each input stream, call [**IMFTransform::GetInputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreaminfo).</span></span>
-   <span data-ttu-id="a3370-174">Aufrufen Sie für jeden Ausgabestream [**imftransform:: getoutputstreaminfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo).</span><span class="sxs-lookup"><span data-stu-id="a3370-174">For each output stream, call [**IMFTransform::GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo).</span></span>

### <a name="process-data"></a><span data-ttu-id="a3370-175">Daten verarbeiten</span><span class="sxs-lookup"><span data-stu-id="a3370-175">Process Data</span></span>

<span data-ttu-id="a3370-176">Eine MFT ist als zuverlässiger Zustands Automat konzipiert.</span><span class="sxs-lookup"><span data-stu-id="a3370-176">An MFT is designed to be a reliable state machine.</span></span> <span data-ttu-id="a3370-177">Es werden keine Aufrufe an den Client zurück gemacht.</span><span class="sxs-lookup"><span data-stu-id="a3370-177">It does not make any calls back to the client.</span></span>

1.  <span data-ttu-id="a3370-178">" [**Imftransform::P rocess Message**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) " mit der Meldung "Meldung zum [**Starten von MFT- \_ Nachricht \_ Benachrichtigen \_ \_**](mft-message-notify-begin-streaming.md) ".</span><span class="sxs-lookup"><span data-stu-id="a3370-178">Call [**IMFTransform::ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_NOTIFY\_BEGIN\_STREAMING**](mft-message-notify-begin-streaming.md) message.</span></span> <span data-ttu-id="a3370-179">Mit dieser Meldung wird die MFT aufgefordert, alle Ressourcen zuzuordnen, die während des Streamings benötigt werden.</span><span class="sxs-lookup"><span data-stu-id="a3370-179">This message requests the MFT to allocate any resources it needs during streaming.</span></span>
2.  <span data-ttu-id="a3370-180">Aufrufen von [**imftransform::P rocessinput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) in mindestens einem Eingabedaten Strom, um eine Eingabe Stichprobe für die MFT bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="a3370-180">Call [**IMFTransform::ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) on at least one input stream to deliver an input sample to the MFT.</span></span>
3.  <span data-ttu-id="a3370-181">(Optional) Rufen Sie [**imftransform:: getoutputstatus**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstatus) auf, um abzufragen, ob der MFT eine Ausgabe Stichprobe generieren kann.</span><span class="sxs-lookup"><span data-stu-id="a3370-181">(Optional.) Call [**IMFTransform::GetOutputStatus**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstatus) to query whether the MFT can generate an output sample.</span></span> <span data-ttu-id="a3370-182">Wenn die Methode S OK zurückgibt \_ , überprüfen Sie den *pdwflags* -Parameter.</span><span class="sxs-lookup"><span data-stu-id="a3370-182">If the method returns S\_OK, check the *pdwFlags* parameter.</span></span> <span data-ttu-id="a3370-183">Wenn *pdwflags* den **MFT- \_ Ausgabe \_ Status \_ Sample \_ Ready** -Flag enthält, fahren Sie mit Schritt 4 fort.</span><span class="sxs-lookup"><span data-stu-id="a3370-183">If *pdwFlags* contains the **MFT\_OUTPUT\_STATUS\_SAMPLE\_READY** flag, go to step 4.</span></span> <span data-ttu-id="a3370-184">Wenn *pdwflags* gleich NULL ist, wechseln Sie zurück zu Schritt 2.</span><span class="sxs-lookup"><span data-stu-id="a3370-184">If *pdwFlags* is zero, go back to step 2.</span></span> <span data-ttu-id="a3370-185">Wenn die Methode E \_ notimpl zurückgibt, fahren Sie mit Schritt 4 fort.</span><span class="sxs-lookup"><span data-stu-id="a3370-185">If the method returns E\_NOTIMPL, go to step 4.</span></span>
4.  <span data-ttu-id="a3370-186">[**Imftransform::P rocess Output**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) zum Abrufen von Ausgabedaten.</span><span class="sxs-lookup"><span data-stu-id="a3370-186">Call [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) to get output data.</span></span>
    -   <span data-ttu-id="a3370-187">Wenn die Methode " **MF E Transform" zurückgibt, \_ benötigen Sie \_ \_ \_ mehr \_ Eingaben**. Dies bedeutet, dass der MFT mehr Eingabedaten erfordert. wechseln Sie zurück zu Schritt 2.</span><span class="sxs-lookup"><span data-stu-id="a3370-187">If the method returns **MF\_E\_TRANSFORM\_NEED\_MORE\_INPUT**, it means the MFT requires more input data; go back to step 2.</span></span>
    -   <span data-ttu-id="a3370-188">Wenn die Methode die **Änderung von MF \_ E \_ Transform \_ Stream \_** zurückgibt, bedeutet dies, dass sich die Anzahl der Ausgabestreams geändert hat oder sich das Ausgabeformat geändert hat.</span><span class="sxs-lookup"><span data-stu-id="a3370-188">If the method returns **MF\_E\_TRANSFORM\_STREAM\_CHANGE**, it means the number of output streams has changed, or the output format has changed.</span></span> <span data-ttu-id="a3370-189">Möglicherweise muss der Client neue Datenstrom Bezeichner Abfragen oder neue Medientypen festlegen.</span><span class="sxs-lookup"><span data-stu-id="a3370-189">The client might need to query for new stream identifiers or set new media types.</span></span> <span data-ttu-id="a3370-190">Weitere Informationen finden Sie in der Dokumentation zu [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="a3370-190">For more information, see the documentation for [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>
5.  <span data-ttu-id="a3370-191">Wenn noch Eingabedaten verarbeitet werden müssen, fahren Sie mit Schritt 2 fort.</span><span class="sxs-lookup"><span data-stu-id="a3370-191">If there is still input data to process, go to step 2.</span></span> <span data-ttu-id="a3370-192">Wenn die MFT alle verfügbaren Eingabedaten verbraucht hat, fahren Sie mit Schritt 6 fort.</span><span class="sxs-lookup"><span data-stu-id="a3370-192">If the MFT has consumed all of the available input data, proceed to step 6.</span></span>
6.  <span data-ttu-id="a3370-193">Wenden Sie [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) mit der Nachricht Nachrichten [**\_ \_ \_ Ende der \_ \_ Nachricht benachrichtigen an**](mft-message-notify-end-of-stream.md) .</span><span class="sxs-lookup"><span data-stu-id="a3370-193">Call [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_NOTIFY\_END\_OF\_STREAM**](mft-message-notify-end-of-stream.md) message.</span></span>
7.  <span data-ttu-id="a3370-194">Wenden Sie [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) mit der [**MFT- \_ Nachrichten \_ Befehls \_**](mft-message-command-drain.md) Ausgleichs Meldung an.</span><span class="sxs-lookup"><span data-stu-id="a3370-194">Call [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_COMMAND\_DRAIN**](mft-message-command-drain.md) message.</span></span>
8.  <span data-ttu-id="a3370-195">Wenden Sie [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) an, um die verbleibende Ausgabe abzurufen.</span><span class="sxs-lookup"><span data-stu-id="a3370-195">Call [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) to get the remaining output.</span></span> <span data-ttu-id="a3370-196">Wiederholen Sie diesen Schritt, bis die Methode " **MF \_ E \_ Transform" \_ \_ mehr \_ Eingaben benötigt**.</span><span class="sxs-lookup"><span data-stu-id="a3370-196">Repeat this step until the method returns **MF\_E\_TRANSFORM\_NEED\_MORE\_INPUT**.</span></span> <span data-ttu-id="a3370-197">Dieser Rückgabewert gibt an, dass die gesamte Ausgabe aus dem MFT entladen wurde.</span><span class="sxs-lookup"><span data-stu-id="a3370-197">This return value signals that all of the output has been drained from the MFT.</span></span> <span data-ttu-id="a3370-198">(Behandeln Sie dies nicht als Fehlerbedingung.)</span><span class="sxs-lookup"><span data-stu-id="a3370-198">(Do not treat this as an error condition.)</span></span>

<span data-ttu-id="a3370-199">Die hier beschriebene Sequenz speichert so wenig Daten wie möglich in der MFT.</span><span class="sxs-lookup"><span data-stu-id="a3370-199">The sequence described here keeps as little data as possible in the MFT.</span></span> <span data-ttu-id="a3370-200">Nach jedem Aufrufen von [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput)versucht der Client, die Ausgabe abzurufen.</span><span class="sxs-lookup"><span data-stu-id="a3370-200">After every call to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput), the client attempts to get output.</span></span> <span data-ttu-id="a3370-201">Möglicherweise sind mehrere Eingabe Beispiele erforderlich, um ein Ausgabe Beispiel zu erzeugen, oder eine einzelne Eingabe Stichprobe generiert möglicherweise mehrere Ausgabe Beispiele.</span><span class="sxs-lookup"><span data-stu-id="a3370-201">Several input samples might be needed to produce one output sample, or a single input sample might generate several output samples.</span></span> <span data-ttu-id="a3370-202">Das optimale Verhalten für den Client besteht darin, Ausgabe Beispiele aus dem MFT abzurufen, bis die MFT mehr Eingaben erfordert.</span><span class="sxs-lookup"><span data-stu-id="a3370-202">The optimal behavior for the client is to pull output samples from the MFT until the MFT requires more input.</span></span>

<span data-ttu-id="a3370-203">Die MFT sollte jedoch in der Lage sein, eine andere Reihenfolge von Methoden aufrufen durch den Client zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="a3370-203">However, the MFT should be able to handle a different order of method calls by the client.</span></span> <span data-ttu-id="a3370-204">Beispielsweise kann der Client einfach zwischen den Aufrufen von [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) und [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput)wechseln.</span><span class="sxs-lookup"><span data-stu-id="a3370-204">For example, the client might simply alternate between calls to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) and [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="a3370-205">Der MFT sollte die Menge der eingegebenen Eingaben einschränken, indem er von **ProcessInput** eine Ausgabe von **MF \_ E \_ notannimmt** , wenn eine Ausgabe erzeugt wird.</span><span class="sxs-lookup"><span data-stu-id="a3370-205">The MFT should restrict the amount of input that it gets by returning **MF\_E\_NOTACCEPTING** from **ProcessInput** whenever it has some output to produce.</span></span>

<span data-ttu-id="a3370-206">Die hier beschriebene Reihenfolge der Methodenaufrufe ist nicht die einzige gültige Abfolge von Ereignissen.</span><span class="sxs-lookup"><span data-stu-id="a3370-206">The order of method calls described here is not the only valid sequence of events.</span></span> <span data-ttu-id="a3370-207">Bei den Schritten 3 und 4 wird z. b. davon ausgegangen, dass der Client mit den Eingabetypen beginnt und dann die Ausgabetypen ausprobiert.</span><span class="sxs-lookup"><span data-stu-id="a3370-207">For example, steps 3 and 4 assume that the client starts with the input types and then tries the output types.</span></span> <span data-ttu-id="a3370-208">Der Client kann diese Reihenfolge ebenfalls umkehren und mit den Ausgabetypen beginnen.</span><span class="sxs-lookup"><span data-stu-id="a3370-208">The client can also reverse this order and start with the output types.</span></span> <span data-ttu-id="a3370-209">Wenn für die MFT in beiden Fällen die umgekehrte Reihenfolge erforderlich ist, sollte der Fehlercode MF \_ E \_ \_ \_ nicht \_ festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="a3370-209">In either case, if the MFT requires the opposite order, it should return the error code MF\_E\_TRANSFORM\_TYPE\_NOT\_SET.</span></span>

<span data-ttu-id="a3370-210">Der Client kann während des Streamings jederzeit Informationsmethoden, z. b. [**getinputcurrenttype**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputcurrenttype) und [**getoutputstreaminfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo), aufrufen.</span><span class="sxs-lookup"><span data-stu-id="a3370-210">The client can call informational methods, such as [**GetInputCurrentType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputcurrenttype) and [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo), at any time during streaming.</span></span> <span data-ttu-id="a3370-211">Der Client kann auch versuchen, die Medientypen jederzeit zu ändern.</span><span class="sxs-lookup"><span data-stu-id="a3370-211">The client can also attempt to change the media types at any time.</span></span> <span data-ttu-id="a3370-212">Der MFT sollte einen Fehlercode zurückgeben, wenn dies kein gültiger Vorgang ist.</span><span class="sxs-lookup"><span data-stu-id="a3370-212">The MFT should return an error code if this is not a valid operation.</span></span> <span data-ttu-id="a3370-213">Kurz gesagt, die MFTs sollten nur sehr wenig von der Reihenfolge der Vorgänge ausgehen, außer den in den Aufrufen selbst dokumentierten.</span><span class="sxs-lookup"><span data-stu-id="a3370-213">In short, MFTs should assume very little about the order of operations, other than what is documented in the calls themselves.</span></span>

<span data-ttu-id="a3370-214">Das folgende Diagramm zeigt ein Flussdiagramm der in diesem Thema beschriebenen Prozeduren.</span><span class="sxs-lookup"><span data-stu-id="a3370-214">The following diagram shows a flow chart of the procedures described in this topic.</span></span>

![Flussdiagramm, das aus Get Stream-bezeichlern durch Schleifen führt, die Eingabetypen festlegen, Eingaben erhalten und die Ausgabe verarbeiten.](images/mft-processing.gif)

## <a name="extensions-to-the-basic-model"></a><span data-ttu-id="a3370-216">Erweiterungen für das Basismodell</span><span class="sxs-lookup"><span data-stu-id="a3370-216">Extensions to the Basic Model</span></span>

<span data-ttu-id="a3370-217">Optional kann ein MFT einige Erweiterungen für das grundlegende Streamingmodell unterstützen.</span><span class="sxs-lookup"><span data-stu-id="a3370-217">Optionally, an MFT can support some extensions to the basic streaming model.</span></span>

-   <span data-ttu-id="a3370-218">Träge gelesene Datenströme.</span><span class="sxs-lookup"><span data-stu-id="a3370-218">Lazy-read streams.</span></span> <span data-ttu-id="a3370-219">Wenn die [**imftransform:: getoutputstreaminfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) -Methode den **MFT \_ - \_ \_ Ausgabestream Lazy \_ Read** -Flag für einen Ausgabestream zurückgibt, muss der Client keine Daten aus diesem Ausgabestream sammeln.</span><span class="sxs-lookup"><span data-stu-id="a3370-219">If the [**IMFTransform::GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method returns the **MFT\_OUTPUT\_STREAM\_LAZY\_READ** flag for an output stream, the client does not have to collect data from that output stream.</span></span> <span data-ttu-id="a3370-220">Der MFT akzeptiert weiterhin Eingaben, und die MFT verwirft die Ausgabedaten aus diesem Stream zu einem bestimmten Zeitpunkt.</span><span class="sxs-lookup"><span data-stu-id="a3370-220">The MFT continues to accept input, and at some point the MFT will discard the output data from that stream.</span></span> <span data-ttu-id="a3370-221">Wenn alle Ausgabedaten Ströme über dieses Flag verfügen, wird die Eingabe von der MFT niemals akzeptiert.</span><span class="sxs-lookup"><span data-stu-id="a3370-221">If all of the output streams have this flag, the MFT will never fail to accept input.</span></span> <span data-ttu-id="a3370-222">Ein Beispiel hierfür ist eine Visualisierungs Transformation, bei der der Client die Ausgabe nur dann abruft, wenn er über freie CPU-Zyklen zum Zeichnen der Visualisierung verfügt.</span><span class="sxs-lookup"><span data-stu-id="a3370-222">An example might be a visualization transform, where the client gets the output only when it has spare CPU cycles to draw the visualization.</span></span>
-   <span data-ttu-id="a3370-223">Ververwerfbare Streams.</span><span class="sxs-lookup"><span data-stu-id="a3370-223">Discardable streams.</span></span> <span data-ttu-id="a3370-224">Wenn die [**getoutputstreaminfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) -Methode das Flag zum **verwerfen des MFT- \_ Ausgabestreams \_ \_** für einen Ausgabestream zurückgibt, kann der Client den MFT zum Verwerfen der Ausgabe anfordern, aber die MFT verwirft keine Ausgabe, sofern Sie nicht angefordert wurde.</span><span class="sxs-lookup"><span data-stu-id="a3370-224">If the [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method returns the **MFT\_OUTPUT\_STREAM\_DISCARDABLE** flag for an output stream, the client can request the MFT to discard output, but the MFT will not discard any output unless requested.</span></span> <span data-ttu-id="a3370-225">Wenn der MFT den maximalen Eingabepuffer erreicht, muss der Client entweder einige Ausgabedaten sammeln oder den MFT anfordern, um die Ausgabe zu verwerfen.</span><span class="sxs-lookup"><span data-stu-id="a3370-225">When the MFT reaches its maximum input buffer, the client must either collect some output data or request the MFT to discard the output.</span></span>
-   <span data-ttu-id="a3370-226">Optionale Streams.</span><span class="sxs-lookup"><span data-stu-id="a3370-226">Optional streams.</span></span> <span data-ttu-id="a3370-227">Wenn die [**getoutputstreaminfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) -Methode das **optionale Flag des MFT- \_ Ausgabestreams \_ \_** für einen Ausgabestream zurückgibt oder die [**imftransform:: getinputstreaminfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreaminfo) -Methode das optionale Flag des **MFT- \_ Eingabedaten \_ Stroms \_** für einen Eingabestream zurückgibt, ist dieser Stream optional.</span><span class="sxs-lookup"><span data-stu-id="a3370-227">If the [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method returns the **MFT\_OUTPUT\_STREAM\_OPTIONAL** flag for an output stream, or the [**IMFTransform::GetInputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreaminfo) method returns the **MFT\_INPUT\_STREAM\_OPTIONAL** flag for an input stream, that stream is optional.</span></span> <span data-ttu-id="a3370-228">Der Client muss keinen Medientyp für den Stream festlegen.</span><span class="sxs-lookup"><span data-stu-id="a3370-228">The client does not have to set a media type on the stream.</span></span> <span data-ttu-id="a3370-229">Wenn der Client den Typ nicht festgelegt, wird der Stream deaktiviert.</span><span class="sxs-lookup"><span data-stu-id="a3370-229">If the client does not set the type, the stream is deselected.</span></span> <span data-ttu-id="a3370-230">Ein deaktivierter Ausgabedatenstrom erzeugt keine Beispiele, und der Client stellt keinen Puffer für den Datenstrom bereit, wenn [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput)aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="a3370-230">A deselected output stream does not produce samples, and the client does not provide a buffer for the stream when it calls [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="a3370-231">Ein deaktivierter Eingabedaten Strom akzeptiert keine Eingabedaten.</span><span class="sxs-lookup"><span data-stu-id="a3370-231">A deselected input stream does not accept input data.</span></span> <span data-ttu-id="a3370-232">Ein MFT kann alle seine Eingabe-und Ausgabedaten Ströme als optional markieren.</span><span class="sxs-lookup"><span data-stu-id="a3370-232">An MFT can mark all of its input and output streams as optional.</span></span> <span data-ttu-id="a3370-233">Es wird jedoch erwartet, dass mindestens eine Eingabe und eine Ausgabe ausgewählt werden müssen, damit der MFT funktioniert.</span><span class="sxs-lookup"><span data-stu-id="a3370-233">However, it is expected that at least one input and one output must be selected for the MFT to work.</span></span>
-   <span data-ttu-id="a3370-234">Asynchrone Verarbeitung.</span><span class="sxs-lookup"><span data-stu-id="a3370-234">Asynchronous processing.</span></span> <span data-ttu-id="a3370-235">Das asynchrone Verarbeitungsmodell wurde in Windows 7 eingeführt.</span><span class="sxs-lookup"><span data-stu-id="a3370-235">The asynchronous processing model was introduced in Windows 7.</span></span> <span data-ttu-id="a3370-236">Dies wird im Thema [asynchrone MFTs](asynchronous-mfts.md)beschrieben.</span><span class="sxs-lookup"><span data-stu-id="a3370-236">It is described in the topic [Asynchronous MFTs](asynchronous-mfts.md).</span></span>

## <a name="imf2dbuffer"></a><span data-ttu-id="a3370-237">IMF2DBuffer</span><span class="sxs-lookup"><span data-stu-id="a3370-237">IMF2DBuffer</span></span>

<span data-ttu-id="a3370-238">Wenn eine MFT unkomprimierte Videodaten verarbeitet, sollte Sie die [**IMF2DBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imf2dbuffer) -Schnittstelle verwenden, um die Beispiel Puffer zu bearbeiten.</span><span class="sxs-lookup"><span data-stu-id="a3370-238">If an MFT processes uncompressed video data, it should use the [**IMF2DBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imf2dbuffer) interface to manipulate the sample buffers.</span></span> <span data-ttu-id="a3370-239">Um diese Schnittstelle zu erhalten, Fragen Sie die [**imfmediabuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediabuffer) -Schnittstelle in einem beliebigen Eingabe-oder Ausgabepuffer ab.</span><span class="sxs-lookup"><span data-stu-id="a3370-239">To get this interface, query the [**IMFMediaBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediabuffer) interface on any input or output buffer.</span></span> <span data-ttu-id="a3370-240">Wenn diese Schnittstelle nicht verwendet wird, wenn Sie verfügbar ist, kann dies zu zusätzlichen Puffer Kopien führen.</span><span class="sxs-lookup"><span data-stu-id="a3370-240">Not using this interface when it is available may result in additional buffer copies.</span></span> <span data-ttu-id="a3370-241">Um diese Schnittstelle ordnungsgemäß zu verwenden, sollte die Transformation den Puffer nicht mithilfe der **imfmediabuffer** -Schnittstelle sperren, wenn **IMF2DBuffer** verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="a3370-241">To make proper use of this interface, the transform should not lock the buffer using the **IMFMediaBuffer** interface when **IMF2DBuffer** is available.</span></span>

<span data-ttu-id="a3370-242">Weitere Informationen zum Verarbeiten von Videodaten finden Sie unter [nicht komprimierte Video Puffer](uncompressed-video-buffers.md).</span><span class="sxs-lookup"><span data-stu-id="a3370-242">For more information about processing video data, see [Uncompressed Video Buffers](uncompressed-video-buffers.md).</span></span>

## <a name="flushing-an-mft"></a><span data-ttu-id="a3370-243">Leeren eines MFT</span><span class="sxs-lookup"><span data-stu-id="a3370-243">Flushing an MFT</span></span>

<span data-ttu-id="a3370-244">Das *leeren eines* MFT bewirkt, dass der MFT alle Eingabedaten verworfen hat.</span><span class="sxs-lookup"><span data-stu-id="a3370-244">*Flushing* an MFT causes the MFT to discard all of its input data.</span></span> <span data-ttu-id="a3370-245">Dies kann zu einer Unterbrechung im Ausgabestream führen.</span><span class="sxs-lookup"><span data-stu-id="a3370-245">This can cause a break in the output stream.</span></span> <span data-ttu-id="a3370-246">Ein Client würde in der Regel eine MFT leeren, bevor er einen neuen Punkt im Eingabestream sucht oder zu einem neuen Eingabestream wechselt, wenn der Client keinen Datenverlust berücksichtigt.</span><span class="sxs-lookup"><span data-stu-id="a3370-246">A client would typically flush an MFT before seeking to a new point in the input stream or switching to a new input stream, when the client does not care about losing data.</span></span>

<span data-ttu-id="a3370-247">Um einen MFT zu leeren, wenden Sie [**imftransform::P rocess Message**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) mit der [**MFT- \_ Nachrichten \_ Befehls \_**](mft-message-command-flush.md) Leerungs Meldung an.</span><span class="sxs-lookup"><span data-stu-id="a3370-247">To flush an MFT, call [**IMFTransform::ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_COMMAND\_FLUSH**](mft-message-command-flush.md) message.</span></span>

## <a name="draining-an-mft"></a><span data-ttu-id="a3370-248">Entleeren eines MFT</span><span class="sxs-lookup"><span data-stu-id="a3370-248">Draining an MFT</span></span>

<span data-ttu-id="a3370-249">Das *entleeren* eines MFT bewirkt, dass der MFT so viele Ausgaben erzeugt, wie er von den bereits gesendeten Eingabedaten möglich ist.</span><span class="sxs-lookup"><span data-stu-id="a3370-249">*Draining* an MFT causes the MFT to produce as much output as it can from whatever input data has already been sent.</span></span> <span data-ttu-id="a3370-250">Wenn die MFT kein vollständiges Ausgabe Beispiel aus der verfügbaren Eingabe erzeugt, werden die Eingabedaten gelöscht.</span><span class="sxs-lookup"><span data-stu-id="a3370-250">If the MFT cannot produce a complete output sample from the available input, it will drop input data.</span></span> <span data-ttu-id="a3370-251">Ein Client würde in der Regel eine MFT beim Erreichen des Endes des Quelldaten Stroms oder unmittelbar vor einer Formatänderung im Quellstream entleeren.</span><span class="sxs-lookup"><span data-stu-id="a3370-251">A client would typically drain an MFT when it reached the end of the source stream, or immediately before a format change in the source stream.</span></span> <span data-ttu-id="a3370-252">Gehen Sie folgendermaßen vor, um ein MFT zu entfernen:</span><span class="sxs-lookup"><span data-stu-id="a3370-252">To drain an MFT, do the following:</span></span>

1.  <span data-ttu-id="a3370-253">Wenden Sie [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) mit der [**MFT- \_ Nachrichten \_ Befehls \_**](mft-message-command-drain.md) Ausgleichs Meldung an.</span><span class="sxs-lookup"><span data-stu-id="a3370-253">Call [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_COMMAND\_DRAIN**](mft-message-command-drain.md) message.</span></span> <span data-ttu-id="a3370-254">Diese Meldung benachrichtigt die MFT, dass Sie so viele Ausgabedaten wie möglich aus den bereits gesendeten Eingabedaten bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="a3370-254">This message notifies the MFT that it should deliver as much output data as it can from the input data that has already been sent.</span></span>
2.  <span data-ttu-id="a3370-255">Ruft [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) auf, um Ausgabedaten zu erhalten, bis die Methode die MF E-Transformation zurückgibt, **\_ \_ \_ benötigt \_ mehr \_ Eingaben**.</span><span class="sxs-lookup"><span data-stu-id="a3370-255">Call [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) to get output data, until the method returns **MF\_E\_TRANSFORM\_NEED\_MORE\_INPUT**.</span></span>

<span data-ttu-id="a3370-256">Während der MFT-Vorgang wird die Eingabe nicht mehr akzeptiert.</span><span class="sxs-lookup"><span data-stu-id="a3370-256">While the MFT is being drained, it will not accept any more input.</span></span>

## <a name="sample-attributes"></a><span data-ttu-id="a3370-257">Beispiel Attribute</span><span class="sxs-lookup"><span data-stu-id="a3370-257">Sample Attributes</span></span>

<span data-ttu-id="a3370-258">Die Eingabe Beispiele können Attribute enthalten, die in die entsprechenden Ausgabe Beispiele kopiert werden müssen.</span><span class="sxs-lookup"><span data-stu-id="a3370-258">The input samples might have attributes that must be copied to the corresponding output samples.</span></span>

-   <span data-ttu-id="a3370-259">Wenn die MFT **Variant \_ true** für die [**\_ \_ unterstützte Eigenschaft mfpkey exattribute**](mfpkey-exattribute-supported-property.md) zurückgibt, muss die MFT die Attribute kopieren.</span><span class="sxs-lookup"><span data-stu-id="a3370-259">If the MFT returns **VARIANT\_TRUE** for the [**MFPKEY\_EXATTRIBUTE\_SUPPORTED**](mfpkey-exattribute-supported-property.md) property, the MFT must copy the attributes.</span></span>
-   <span data-ttu-id="a3370-260">Wenn die [**\_ \_ unterstützte mfpkey exattribute**](mfpkey-exattribute-supported-property.md) -Eigenschaft entweder **Variant \_ false** ist oder nicht festgelegt ist, muss der Client die Attribute kopieren.</span><span class="sxs-lookup"><span data-stu-id="a3370-260">If the [**MFPKEY\_EXATTRIBUTE\_SUPPORTED**](mfpkey-exattribute-supported-property.md) property is either **VARIANT\_FALSE** or is not set, the client must copy the attributes.</span></span>

<span data-ttu-id="a3370-261">Für eine MFT mit einer Eingabe und einer Ausgabe können Sie die folgende allgemeine Regel verwenden:</span><span class="sxs-lookup"><span data-stu-id="a3370-261">For an MFT with one input and one output, you can use the following general rule:</span></span>

-   <span data-ttu-id="a3370-262">Wenn jedes Eingabe Beispiel genau ein Ausgabe Beispiel erzeugt, können Sie den Client die Attribute kopieren lassen.</span><span class="sxs-lookup"><span data-stu-id="a3370-262">If each input sample produces exactly one output sample, you can let the client copy the attributes.</span></span> <span data-ttu-id="a3370-263">Lassen Sie die [**\_ \_ unterstützte Eigenschaft "mfpkey exattribute**](mfpkey-exattribute-supported-property.md) " nicht festgelegt.</span><span class="sxs-lookup"><span data-stu-id="a3370-263">Leave the [**MFPKEY\_EXATTRIBUTE\_SUPPORTED**](mfpkey-exattribute-supported-property.md) property unset.</span></span>
-   <span data-ttu-id="a3370-264">Wenn keine 1:1-Entsprechung zwischen Eingabe Beispielen und Ausgabe Beispielen vorhanden ist, muss der MFT die richtigen Attribute für Ausgabe Beispiele ermitteln.</span><span class="sxs-lookup"><span data-stu-id="a3370-264">If there is not a one-to-one correspondence between input samples and output samples, the MFT must determine the correct attributes for output samples.</span></span> <span data-ttu-id="a3370-265">Legen Sie die Eigenschaft [**mfpkey \_ exattribute \_ unterstützt**](mfpkey-exattribute-supported-property.md) auf **Variant \_ true** fest.</span><span class="sxs-lookup"><span data-stu-id="a3370-265">Set the [**MFPKEY\_EXATTRIBUTE\_SUPPORTED**](mfpkey-exattribute-supported-property.md) property to **VARIANT\_TRUE**.</span></span>

## <a name="discontinuities"></a><span data-ttu-id="a3370-266">Unterbrechungen</span><span class="sxs-lookup"><span data-stu-id="a3370-266">Discontinuities</span></span>

<span data-ttu-id="a3370-267">Eine Diskontinuität ist eine Unterbrechung in einem Audiostream oder Videostream.</span><span class="sxs-lookup"><span data-stu-id="a3370-267">A discontinuity is a break in an audio or video stream.</span></span> <span data-ttu-id="a3370-268">Diskontinuitäten können durch gelöschte Pakete in einer Netzwerkverbindung, beschädigte Datei Daten, einen Wechsel von einem Quelldaten Strom zu einem anderen oder eine Vielzahl anderer Ursachen verursacht werden.</span><span class="sxs-lookup"><span data-stu-id="a3370-268">Discontinuities can be caused by dropped packets on a network connection, corrupt file data, a switch from one source stream to another, or a wide range of other causes.</span></span> <span data-ttu-id="a3370-269">Diskontinuitäten werden signalisiert, indem das " [**MF SampleExtension \_ discontinuity**](mfsampleextension-discontinuity-attribute.md) "-Attribut im ersten Beispiel nach der Diskontinuität festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="a3370-269">Discontinuities are signaled by setting the [**MFSampleExtension\_Discontinuity**](mfsampleextension-discontinuity-attribute.md) attribute on the first sample after the discontinuity.</span></span> <span data-ttu-id="a3370-270">Es ist nicht möglich, eine Diskontinuität in der Mitte eines Beispiels zu signalisieren.</span><span class="sxs-lookup"><span data-stu-id="a3370-270">It is not possible to signal a discontinuity in the middle of a sample.</span></span> <span data-ttu-id="a3370-271">Daher sollten alle diskontinuierlichen Daten in separaten Beispielen gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="a3370-271">Therefore, any discontinuous data should be sent in separate samples.</span></span>

<span data-ttu-id="a3370-272">Einige Transformationen, insbesondere solche, die nicht komprimierte Daten verarbeiten, z. b. Audio-und Video Effekte, sollten Diskontinuitäten ignorieren, wenn Sie Eingabedaten verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="a3370-272">Some transforms, especially those that handle uncompressed data, such as audio and video effects, should ignore discontinuities when they process input data.</span></span> <span data-ttu-id="a3370-273">Diese MFTs sind in der Regel so konzipiert, dass kontinuierliche Daten verarbeitet werden, und sollten alle Daten, die Sie als kontinuierlich empfangen, auch nach einer Diskontinuität behandeln.</span><span class="sxs-lookup"><span data-stu-id="a3370-273">These MFTs are generally designed to handle continuous data, and should treat any data they receive as continuous, even after a discontinuity.</span></span>

<span data-ttu-id="a3370-274">Wenn eine MFT eine Diskontinuität der Eingabedaten ignoriert, sollte Sie trotzdem das Diskontinuität-Flag für das Ausgabe Beispiel festlegen, wenn die Ausgabe Stichprobe denselben Zeitstempel wie das Eingabe Beispiel aufweist.</span><span class="sxs-lookup"><span data-stu-id="a3370-274">If an MFT ignores a discontinuity on input data, it should still set the discontinuity flag on the output sample, if the output sample has the same time stamp as the input sample.</span></span> <span data-ttu-id="a3370-275">Wenn die Ausgabe Stichprobe jedoch einen anderen Zeitstempel aufweist, sollte der MFT die Diskontinuität nicht weitergeben.</span><span class="sxs-lookup"><span data-stu-id="a3370-275">If the output sample has a different time stamp, however, the MFT should not propagate the discontinuity.</span></span> <span data-ttu-id="a3370-276">(Dies wäre z. b. bei einigen audioresamplern der Fall.) Eine Diskontinuität an der falschen Stelle im Stream ist schlechter als keine Diskontinuität.</span><span class="sxs-lookup"><span data-stu-id="a3370-276">(This would be the case in some audio resamplers, for example.) A discontinuity at the wrong place in the stream is worse than no discontinuity.</span></span>

<span data-ttu-id="a3370-277">Die meisten Decoder können Diskontinuitäten nicht ignorieren, da eine Diskontinuität sich auf die Interpretation des nächsten Beispiels auswirkt.</span><span class="sxs-lookup"><span data-stu-id="a3370-277">Most decoders cannot ignore discontinuities, because a discontinuity affects the interpretation of the next sample.</span></span> <span data-ttu-id="a3370-278">Alle Codierungstechnologien, die eine Frame übergreifende Komprimierung verwenden (z. b. MPEG-2), fallen in diese Kategorie.</span><span class="sxs-lookup"><span data-stu-id="a3370-278">Any encoding technology that uses inter-frame compression, such as MPEG-2, falls into this category.</span></span> <span data-ttu-id="a3370-279">Einige Codierungs Schemas verwenden nur die interne Komprimierung, wie z. b. DV und MJPEG.</span><span class="sxs-lookup"><span data-stu-id="a3370-279">Some encoding schemes use only intra-frame compression, such as DV and MJPEG.</span></span> <span data-ttu-id="a3370-280">Diese Decoder können Diskontinuitäten gefahrlos ignorieren.</span><span class="sxs-lookup"><span data-stu-id="a3370-280">These decoders can safely ignore discontinuities.</span></span>

<span data-ttu-id="a3370-281">Transformationen, die auf Diskontinuitäten reagieren, sollten in der Regel so viele Daten wie möglich vor der Diskontinuität ausgeben und den Rest verwerfen.</span><span class="sxs-lookup"><span data-stu-id="a3370-281">Transforms that respond to discontinuities should generally output as much of the data before the discontinuity as they can, and discard the rest.</span></span> <span data-ttu-id="a3370-282">Das Eingabe Beispiel mit dem Diskontinuität-Flag sollte so verarbeitet werden, als wäre es das erste Beispiel im Stream.</span><span class="sxs-lookup"><span data-stu-id="a3370-282">The input sample with the discontinuity flag should be processed as though it were the first sample in the stream.</span></span> <span data-ttu-id="a3370-283">(Dieses Verhalten entspricht dem, was für die [**MFT \_ - \_ Nachrichten \_ Befehls**](mft-message-command-drain.md) Ausgleichs Meldung angegeben wird.) Die genauen Details hängen jedoch vom Medienformat ab.</span><span class="sxs-lookup"><span data-stu-id="a3370-283">(This behavior matches what is specified for the [**MFT\_MESSAGE\_COMMAND\_DRAIN**](mft-message-command-drain.md) message.) However, the exact details will depend on the media format.</span></span>

<span data-ttu-id="a3370-284">Wenn ein Decoder keine Diskontinuität mindern kann, sollte das Flag für die Diskontinuität in die Ausgabedaten kopiert werden.</span><span class="sxs-lookup"><span data-stu-id="a3370-284">If a decoder does nothing to mitigate a discontinuity, it should copy the discontinuity flag to the output data.</span></span> <span data-ttu-id="a3370-285">Demultiplexer und andere MFTs, die vollständig mit komprimierten Daten arbeiten, müssen alle Diskontinuitäten in Ihre Ausgabedaten Ströme kopieren.</span><span class="sxs-lookup"><span data-stu-id="a3370-285">Demultiplexers and other MFTs that work entirely with compressed data must copy any discontinuities to their output streams.</span></span> <span data-ttu-id="a3370-286">Andernfalls können die Downstreamkomponenten die komprimierten Daten möglicherweise nicht ordnungsgemäß decodieren.</span><span class="sxs-lookup"><span data-stu-id="a3370-286">Otherwise, the downstream components may not be able to decode the compressed data correctly.</span></span> <span data-ttu-id="a3370-287">Im Allgemeinen ist es fast immer korrekt, Diskontinuitäten nachgelagert zu übergeben, es sei denn, der MFT enthält expliziten Code zum Glätten von Diskontinuitäten.</span><span class="sxs-lookup"><span data-stu-id="a3370-287">In general, it is almost always correct to pass discontinuities downstream, unless the MFT contains explicit code to smooth out discontinuities.</span></span>

## <a name="dynamic-format-changes"></a><span data-ttu-id="a3370-288">Dynamische Format Änderungen</span><span class="sxs-lookup"><span data-stu-id="a3370-288">Dynamic Format Changes</span></span>

<span data-ttu-id="a3370-289">Formate können während des Streamings geändert werden.</span><span class="sxs-lookup"><span data-stu-id="a3370-289">Formats can change during streaming.</span></span> <span data-ttu-id="a3370-290">Beispielsweise kann sich das Seitenverhältnis in der Mitte eines Videodaten Stroms ändern.</span><span class="sxs-lookup"><span data-stu-id="a3370-290">For example, aspect ratio can change in the middle of a video stream.</span></span>

<span data-ttu-id="a3370-291">Ausführliche Informationen dazu, wie streamänderungen von einem MFT behandelt werden, finden Sie unter [Handling Stream Changes](handling-stream-changes.md).</span><span class="sxs-lookup"><span data-stu-id="a3370-291">For details about how stream changes are handled by an MFT, see [Handling Stream Changes](handling-stream-changes.md).</span></span>

## <a name="stream-events"></a><span data-ttu-id="a3370-292">Streamereignisse</span><span class="sxs-lookup"><span data-stu-id="a3370-292">Stream Events</span></span>

<span data-ttu-id="a3370-293">Um ein Ereignis an einen MFT zu senden, wird [**imftransform::P rocesabvent**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processevent)aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="a3370-293">To send an event to an MFT, call [**IMFTransform::ProcessEvent**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processevent).</span></span> <span data-ttu-id="a3370-294">Wenn die Methode das **" \_ MF \_ S \_ Transform \_ Not \_ propagieren \_**"-Ereignis zurückgibt, gibt die MFT das Ereignis für einen nachfolgenden Aufruf von [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput)an den Aufrufer zurück.</span><span class="sxs-lookup"><span data-stu-id="a3370-294">If the method returns **MF\_S\_TRANSFORM\_DO\_NOT\_PROPAGATE\_EVENT**, the MFT will return the event to the caller on a subsequent call to [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="a3370-295">Wenn die Methode einen anderen **HRESULT** -Wert zurückgibt, wird das Ereignis vom MFT nicht an den Client in **ProcessOutput** zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="a3370-295">If the method returns any other **HRESULT** value, the MFT will not return the event to the client in **ProcessOutput**.</span></span> <span data-ttu-id="a3370-296">In diesem Fall ist der Client für die Weitergabe des Ereignisses an die nächste Komponente in der Pipeline zuständig, falls zutreffend.</span><span class="sxs-lookup"><span data-stu-id="a3370-296">In that case, the client is responsible for propagating the event downstream to the next component in the pipeline, if applicable.</span></span> <span data-ttu-id="a3370-297">Weitere Informationen finden Sie unter [**IMF Transform::P rocess Output**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="a3370-297">For more information, see [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>

## <a name="related-topics"></a><span data-ttu-id="a3370-298">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="a3370-298">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a3370-299">Media Foundation Transformationen</span><span class="sxs-lookup"><span data-stu-id="a3370-299">Media Foundation Transforms</span></span>](media-foundation-transforms.md)
</dt> </dl>

 

 



