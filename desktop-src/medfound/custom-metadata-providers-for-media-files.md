---
description: In diesem Thema wird beschrieben, wie ein benutzerdefinierter shelleigenschaftenhandler für eine Microsoft Media Foundation Medienquelle geschrieben wird.
ms.assetid: f8cf70ff-8324-4308-8adf-a145aa351ca9
title: Benutzerdefinierte Metadatenanbieter für Mediendateien
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a2ded77492d03f7b802f6b2f9c25e1009ef97f50
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/03/2021
ms.locfileid: "106357153"
---
# <a name="custom-metadata-providers-for-media-files"></a><span data-ttu-id="d8e9a-103">Benutzerdefinierte Metadatenanbieter für Mediendateien</span><span class="sxs-lookup"><span data-stu-id="d8e9a-103">Custom Metadata Providers for Media Files</span></span>

<span data-ttu-id="d8e9a-104">In diesem Thema wird beschrieben, wie ein benutzerdefinierter shelleigenschaftenhandler für eine Microsoft Media Foundation Medienquelle geschrieben wird.</span><span class="sxs-lookup"><span data-stu-id="d8e9a-104">This topic describes how to write a custom Shell property handler for a Microsoft Media Foundation media source.</span></span>

> [!Note]  
> <span data-ttu-id="d8e9a-105">Hintergrundinformationen zu metadatenanbietern in Media Foundation finden Sie unter [Medien Metadaten](media-metadata.md).</span><span class="sxs-lookup"><span data-stu-id="d8e9a-105">For background information about metadata providers in Media Foundation, see [Media Metadata](media-metadata.md).</span></span> <span data-ttu-id="d8e9a-106">In diesem Thema werden shelleigenschaftenhandler behandelt. die Metadatenschnittstelle der Version 1, [**IMF Metadata**](/windows/desktop/api/mfidl/nn-mfidl-imfmetadata), wird nicht beschrieben.</span><span class="sxs-lookup"><span data-stu-id="d8e9a-106">This topic discusses Shell property handlers; it does not describe the version 1 metadata interface, [**IMFMetadata**](/windows/desktop/api/mfidl/nn-mfidl-imfmetadata).</span></span>

 

<span data-ttu-id="d8e9a-107">Metadaten sind eng an das Format der Datei gebunden.</span><span class="sxs-lookup"><span data-stu-id="d8e9a-107">Metadata is closely tied to the format of the file.</span></span> <span data-ttu-id="d8e9a-108">In Media Foundation werden Dateiformate durch Medienquellen dargestellt.</span><span class="sxs-lookup"><span data-stu-id="d8e9a-108">In Media Foundation, file formats are represented by media sources.</span></span> <span data-ttu-id="d8e9a-109">Wenn Sie Metadaten für ein Format unterstützen möchten, das in Media Foundation nicht nativ unterstützt wird, müssen Sie eine benutzerdefinierte Medienquelle mit einem Eigenschaften Handler implementieren.</span><span class="sxs-lookup"><span data-stu-id="d8e9a-109">If you want to support metadata for a format that is not supported natively in Media Foundation, you must implement a custom media source with a property handler.</span></span> <span data-ttu-id="d8e9a-110">Der Eigenschaften Handler ermöglicht dem shelleigenschaftensystem das effiziente lesen und Schreiben von Metadaten.</span><span class="sxs-lookup"><span data-stu-id="d8e9a-110">The property handler enables the Shell property system to read and write metadata efficiently.</span></span>

<span data-ttu-id="d8e9a-111">Ein Eigenschafts Handler ist ein COM-Objekt, das die folgenden Schnittstellen implementiert:</span><span class="sxs-lookup"><span data-stu-id="d8e9a-111">A property handler is a COM object that implements the following interfaces:</span></span>

-   [<span data-ttu-id="d8e9a-112">**IInitializeWithStream**</span><span class="sxs-lookup"><span data-stu-id="d8e9a-112">**IInitializeWithStream**</span></span>](/windows/win32/api/propsys/nn-propsys-iinitializewithstream)
-   [<span data-ttu-id="d8e9a-113">**IPropertyStore**</span><span class="sxs-lookup"><span data-stu-id="d8e9a-113">**IPropertyStore**</span></span>](/windows/win32/api/propsys/nn-propsys-ipropertystore)

<span data-ttu-id="d8e9a-114">Optional kann auch die folgende Schnittstelle verfügbar gemacht werden:</span><span class="sxs-lookup"><span data-stu-id="d8e9a-114">Optionally, it can also expose the following interface:</span></span>

-   [<span data-ttu-id="d8e9a-115">**Ipropertystorecapabilitäten**</span><span class="sxs-lookup"><span data-stu-id="d8e9a-115">**IPropertyStoreCapabilities**</span></span>](/windows/win32/api/propsys/nn-propsys-ipropertystorecapabilities)

<span data-ttu-id="d8e9a-116">Wenn das shelleigenschaftensystem Metadaten für eine Datei erhalten muss, ruft es [**cokreateinstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) auf, um den Eigenschafts Handler zu erstellen, und ruft dann die entsprechenden Lese-und Schreib Methoden in der [**IPropertyStore**](/windows/win32/api/propsys/nn-propsys-ipropertystore) -Schnittstelle auf.</span><span class="sxs-lookup"><span data-stu-id="d8e9a-116">If the Shell property system needs to get metadata for a file, it calls [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) to create the property handler and then calls the appropriate read and write methods on the [**IPropertyStore**](/windows/win32/api/propsys/nn-propsys-ipropertystore) interface.</span></span>

<span data-ttu-id="d8e9a-117">Die Media Foundation Pipeline verwendet einen etwas anderen Mechanismus, da die Pipeline den Eigenschaften Handler direkt aus der Medienquelle abruft.</span><span class="sxs-lookup"><span data-stu-id="d8e9a-117">The Media Foundation pipeline uses a slightly different mechanism, because the pipeline gets the property handler directly from the media source.</span></span> <span data-ttu-id="d8e9a-118">Anstatt [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) zum Erstellen des Eigenschaften Handlers aufzurufen, ruft die Pipeline [**imfgetservice:: GetService**](/windows/desktop/api/mfidl/nf-mfidl-imfgetservice-getservice) auf der Medienquelle auf, wie im Thema [shellmetadatenanbieter](shell-metadata-providers.md)beschrieben.</span><span class="sxs-lookup"><span data-stu-id="d8e9a-118">Instead of calling [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) to create the property handler, the pipeline calls [**IMFGetService::GetService**](/windows/desktop/api/mfidl/nf-mfidl-imfgetservice-getservice) on the media source, as described in the topic [Shell Metadata Providers](shell-metadata-providers.md).</span></span>

<span data-ttu-id="d8e9a-119">Gehen Sie folgendermaßen vor, um einen benutzerdefinierten Eigenschaften Handler zu erstellen:</span><span class="sxs-lookup"><span data-stu-id="d8e9a-119">To create a custom property handler, do the following:</span></span>

-   <span data-ttu-id="d8e9a-120">Implementieren Sie die [**imfgetservice**](/windows/desktop/api/mfidl/nn-mfidl-imfgetservice) -Schnittstelle, um [**IPropertyStore**](/windows/win32/api/propsys/nn-propsys-ipropertystore)verfügbar zu machen.</span><span class="sxs-lookup"><span data-stu-id="d8e9a-120">Implement the [**IMFGetService**](/windows/desktop/api/mfidl/nn-mfidl-imfgetservice) interface to expose [**IPropertyStore**](/windows/win32/api/propsys/nn-propsys-ipropertystore).</span></span> <span data-ttu-id="d8e9a-121">Die Dienst-GUID ist der **MF- \_ \_ eigenschaftenhandlerdienst \_**</span><span class="sxs-lookup"><span data-stu-id="d8e9a-121">The service GUID is **MF\_PROPERTY\_HANDLER\_SERVICE**.</span></span>
-   <span data-ttu-id="d8e9a-122">Wenn die Medienquelle Remote verwendet wird, muss Sie zusätzlich zu [**imfgetservice**](/windows/desktop/api/mfidl/nn-mfidl-imfgetservice)auch die [**IPropertyStore**](/windows/win32/api/propsys/nn-propsys-ipropertystore) -Schnittstelle über die **QueryInterface** -Methode der Medienquelle verfügbar machen.</span><span class="sxs-lookup"><span data-stu-id="d8e9a-122">If the media source will be used remotely, it must also expose the [**IPropertyStore**](/windows/win32/api/propsys/nn-propsys-ipropertystore) interface through the media source's **QueryInterface** method, in addition to [**IMFGetService**](/windows/desktop/api/mfidl/nn-mfidl-imfgetservice).</span></span>
-   <span data-ttu-id="d8e9a-123">Um den Eigenschaften Handler für das Shell-Eigenschaften System verfügbar zu machen, registrieren Sie die DLL für den Eigenschafts Handler, wie unter [registrieren und Verteilen von Eigenschaften Handlern](../properties/prophand-reg-dist.md)beschrieben.</span><span class="sxs-lookup"><span data-stu-id="d8e9a-123">To make the property handler available to the Shell property system, register the DLL for the property handler as described in [Registering and Distributing Property Handlers](../properties/prophand-reg-dist.md).</span></span>
-   <span data-ttu-id="d8e9a-124">Die Medienquelle wird separat registriert, wie in [Schema Handler und Byte-Stream Handlern](scheme-handlers-and-byte-stream-handlers.md)beschrieben.</span><span class="sxs-lookup"><span data-stu-id="d8e9a-124">The media source is registered separately, as described in [Scheme Handlers and Byte-Stream Handlers](scheme-handlers-and-byte-stream-handlers.md).</span></span>

### <a name="implementation-tips"></a><span data-ttu-id="d8e9a-125">Implementierungs Tipps</span><span class="sxs-lookup"><span data-stu-id="d8e9a-125">Implementation Tips</span></span>

<span data-ttu-id="d8e9a-126">Eine Liste der Metadaten-Eigenschafts Schlüssel finden Sie unter [Metadateneigenschaften für Mediendateien](metadata-properties-for-media-files.md).</span><span class="sxs-lookup"><span data-stu-id="d8e9a-126">For a list of metadata property keys, see [Metadata Properties for Media Files](metadata-properties-for-media-files.md).</span></span>

<span data-ttu-id="d8e9a-127">Eigenschaften Handler müssen schnell sein. Sie müssen einen effizienten Lese-und Schreibzugriff auf die Metadaten bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="d8e9a-127">Property handlers must be fast; they must provide efficient read and write access to the metadata.</span></span> <span data-ttu-id="d8e9a-128">(Beachten Sie, dass die Shell Metadaten aus Hunderten von Dateien abrufen kann.) Daher müssen Sie [**MFStartup**](/windows/desktop/api/mfapi/nf-mfapi-mfstartup) nicht über Ihren Eigenschafts Handler abrufen.</span><span class="sxs-lookup"><span data-stu-id="d8e9a-128">(Consider that the Shell may retrieve metadata from hundreds of files.) Therefore, do not call [**MFStartup**](/windows/desktop/api/mfapi/nf-mfapi-mfstartup) from your property handler.</span></span> <span data-ttu-id="d8e9a-129">Die **MF Startup** -Funktion führt die Start Latenz ein, da Sie mehrere Arbeitswarteschlangen-Threads erstellt und globalen Speicher belegt.</span><span class="sxs-lookup"><span data-stu-id="d8e9a-129">The **MFStartup** function introduces startup latency, because it creates multiple work-queue threads and allocates global memory.</span></span>

<span data-ttu-id="d8e9a-130">In einer typischen-Implementierung teilen sich der Eigenschaften Handler und die Medienquelle einen Teil desselben Code Codes.</span><span class="sxs-lookup"><span data-stu-id="d8e9a-130">In a typical implementation, the property handler and the media source will share some of the same parsing code.</span></span> <span data-ttu-id="d8e9a-131">Eine Medienquelle verwendet jedoch asynchrone [**IMF Bytestream**](/windows/desktop/api/mfobjects/nn-mfobjects-imfbytestream) -Aufrufe für e/a-Vorgänge, während der Eigenschafts Handler die [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) -Schnittstelle verwendet.</span><span class="sxs-lookup"><span data-stu-id="d8e9a-131">However, a media source uses asynchronous [**IMFByteStream**](/windows/desktop/api/mfobjects/nn-mfobjects-imfbytestream) calls for I/O, whereas the property handler uses the [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) interface.</span></span> <span data-ttu-id="d8e9a-132">Media Foundation stellt ein Hilfsobjekt bereit, das einen **IStream**-basierten Datenstrom umschließt und ihn als **imfbytestream** -Stream verfügbar macht.</span><span class="sxs-lookup"><span data-stu-id="d8e9a-132">Media Foundation provides a helper object that wraps an **IStream**-based stream and exposes it as an **IMFByteStream** stream.</span></span> <span data-ttu-id="d8e9a-133">Rufen Sie zum Erstellen des Wrappers [**mfkreatemfbytestreamonstream**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatemfbytestreamonstream)auf.</span><span class="sxs-lookup"><span data-stu-id="d8e9a-133">To create the wrapper, call [**MFCreateMFByteStreamOnStream**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatemfbytestreamonstream).</span></span>

<span data-ttu-id="d8e9a-134">Beim Aktualisieren von Metadaten wird empfohlen, die Daten direkt in den ursprünglichen Stream zu schreiben.</span><span class="sxs-lookup"><span data-stu-id="d8e9a-134">When updating metadata, it is recommended to write the data directly to the original stream.</span></span> <span data-ttu-id="d8e9a-135">Diese Empfehlung unterscheidet sich vom Verhalten bei den meisten Eigenschaften Handlern, bei denen eine Kopie der Daten geändert wird, vom *Kopier-/Schreib-Verhalten* .</span><span class="sxs-lookup"><span data-stu-id="d8e9a-135">This recommendation differs from the *copy-on-write* behavior of most property handlers, in which a copy of the data is modified.</span></span> <span data-ttu-id="d8e9a-136">Mediendateien können sehr groß sein, daher ist Copy-on-Write in der Regel zu langsam für eine effiziente Implementierung.</span><span class="sxs-lookup"><span data-stu-id="d8e9a-136">Media files can be very large, so copy-on-write is typically too slow for an efficient implementation.</span></span> <span data-ttu-id="d8e9a-137">Legen Sie zum Deaktivieren von Copy-on-Write die Registrierungs Einstellung **manualsafesave** fest, wie unter [registrieren und Verteilen von Eigenschaften Handlern](../properties/prophand-reg-dist.md)beschrieben.</span><span class="sxs-lookup"><span data-stu-id="d8e9a-137">To disable copy-on-write, set the **ManualSafeSave** registry setting, as described in [Registering and Distributing Property Handlers](../properties/prophand-reg-dist.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="d8e9a-138">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="d8e9a-138">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d8e9a-139">Medien Metadaten</span><span class="sxs-lookup"><span data-stu-id="d8e9a-139">Media Metadata</span></span>](media-metadata.md)
</dt> <dt>

[<span data-ttu-id="d8e9a-140">Medienquellen</span><span class="sxs-lookup"><span data-stu-id="d8e9a-140">Media Sources</span></span>](media-sources.md)
</dt> <dt>

[<span data-ttu-id="d8e9a-141">Schreiben einer benutzerdefinierten Medienquelle</span><span class="sxs-lookup"><span data-stu-id="d8e9a-141">Writing a Custom Media Source</span></span>](writing-a-custom-media-source.md)
</dt> </dl>

 

 
