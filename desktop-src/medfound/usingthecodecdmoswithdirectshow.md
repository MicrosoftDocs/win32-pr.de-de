---
description: Verwenden der Fenster Medien Codecs in DirectShow
ms.assetid: 5b930447-6bf2-4bb3-8dfb-05f4c1e7cd64
title: Verwenden der Fenster Medien Codecs in DirectShow
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cb521c0e3897dc2415fbd613f97b755a146657d3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "106343380"
---
# <a name="using-the-window-media-codecs-in-directshow"></a><span data-ttu-id="6905f-103">Verwenden der Fenster Medien Codecs in DirectShow</span><span class="sxs-lookup"><span data-stu-id="6905f-103">Using the Window Media Codecs in DirectShow</span></span>

<span data-ttu-id="6905f-104">Die Windows Media Audio-und Video Encoder-und Decoder-Objekte wurden ursprünglich entworfen und optimiert, um mit dem Datei Containerformat ASF und dem SDK für den Windows Media-Format arbeiten zu können.</span><span class="sxs-lookup"><span data-stu-id="6905f-104">The Windows Media Audio and Video encoder and decoder objects were originally designed and optimized to work with the ASF file container format and the Windows Media Format SDK.</span></span> <span data-ttu-id="6905f-105">Die Codec-Objekte funktionieren in DirectShow für bestimmte Szenarien gut, d.... Dies gilt für CBR und eine qualitativ hochwertige VBR-Codierung von Videodaten strömen.</span><span class="sxs-lookup"><span data-stu-id="6905f-105">The codec objects work well in DirectShow for certain scenarios, namely one-pass CBR and quality based VBR encoding of video streams.</span></span> <span data-ttu-id="6905f-106">Wenn Sie jedoch erwägen, die Codec-Objekte direkt in DirectShow mithilfe von Datei Containern als ASF zu verwenden, gibt es bestimmte Verhalten und Probleme, die Sie im Voraus beachten sollten.</span><span class="sxs-lookup"><span data-stu-id="6905f-106">But if you are considering using the codec objects directly in DirectShow using file containers other than ASF, there are certain behaviors and issues that you should be aware of in advance.</span></span>

> [!Note]  
> <span data-ttu-id="6905f-107">Wenn Sie eigenständige Codecs mit DirectShow verwenden möchten, sollten Sie Sie wahrscheinlich nur als DMOS verwenden.</span><span class="sxs-lookup"><span data-stu-id="6905f-107">If you are going to use standalone codecs with DirectShow, you will probably want to use them as DMOs only.</span></span> <span data-ttu-id="6905f-108">Anders ausgedrückt: Sie verwenden die [**imediaobject**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobject) -Schnittstelle anstelle von [**IMF Transform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform).</span><span class="sxs-lookup"><span data-stu-id="6905f-108">In other words, you will be using the [**IMediaObject**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobject) interface instead of [**IMFTransform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform).</span></span>

 

## <a name="wm-audio-in-avi-files"></a><span data-ttu-id="6905f-109">WM-Audiodatei in AVI-Dateien</span><span class="sxs-lookup"><span data-stu-id="6905f-109">WM Audio in AVI Files</span></span>

<span data-ttu-id="6905f-110">Mithilfe von DirectShow können Sie WMA-Streams in ein beliebiges Datei Containerformat codieren, für das Sie einen Multiplexer-Filter verwenden.</span><span class="sxs-lookup"><span data-stu-id="6905f-110">You can use DirectShow to encode WMA streams into any file container format for which you have a multiplexer filter.</span></span> <span data-ttu-id="6905f-111">Die Windows Media Audio-und Video-Codec-Schnittstellen unterstützen WMA in AVI-Dateien jedoch nicht, da es nicht möglich ist, die standardmäßigen DirectShow-AVI-Wiedergabe Filter zu verwenden, um die audiovideosynchronisierung in einer AVI-Datei mit einem WMA-Stream aufrechtzuerhalten.</span><span class="sxs-lookup"><span data-stu-id="6905f-111">However, the Windows Media Audio and Video codec interfaces do not support WMA in AVI files because it is impossible, using the default DirectShow AVI playback filters, to maintain audio-video sync in an AVI file with a WMA stream.</span></span> <span data-ttu-id="6905f-112">Weitere Informationen finden Sie unter [Speichern von komprimierten Medien in AVI-Dateien](storingcompressedmediainavifiles.md).</span><span class="sxs-lookup"><span data-stu-id="6905f-112">For more information, see [Storing Compressed Media in AVI Files](storingcompressedmediainavifiles.md).</span></span>

<span data-ttu-id="6905f-113">Der Audioencoder-DMO gibt Stichproben unterschiedlicher Dauer aus, auch wenn der Modus "Konstante Bitrate" angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="6905f-113">The audio encoder DMO outputs samples of varying duration, even when in "constant bit rate" mode.</span></span> <span data-ttu-id="6905f-114">Dies funktioniert daher am besten mit Datei Containerformaten, die Zeitstempel verwenden.</span><span class="sxs-lookup"><span data-stu-id="6905f-114">It therefore works best with file container formats that use time stamps.</span></span> <span data-ttu-id="6905f-115">AVI-Dateien stellen keinen Zeitstempel für jedes Audiobeispiel oder jede Gruppe von Beispielen bereit.</span><span class="sxs-lookup"><span data-stu-id="6905f-115">AVI files do not provide a time stamp for each audio sample or group of samples.</span></span> <span data-ttu-id="6905f-116">In DirectShow stellt der avi-Splitter Filter Zeitstempel für jede Gruppe von Stichproben (jeden audioframe) basierend auf dem **navgbytespersec** -Wert in der [**WaveFormatEx**](/previous-versions/dd757713(v=vs.85)) -Struktur im AVI-Streamheader her.</span><span class="sxs-lookup"><span data-stu-id="6905f-116">In DirectShow, the AVI Splitter filter manufactures time stamps for each group of samples (each audio frame) based on the **nAvgBytesPerSec** value in the [**WAVEFORMATEX**](/previous-versions/dd757713(v=vs.85)) structure in the AVI stream header.</span></span>

<span data-ttu-id="6905f-117">Die Annahme, dass diese Berechnung zugrunde liegt, besteht darin, dass alle Audiobeispiele im Stream die gleiche Dauer haben. die vom DMO ausgegebenen Beispiele sind jedoch nicht identisch, sodass die vom avi-Splitter angewendeten Zeitstempel nicht exakt sind.</span><span class="sxs-lookup"><span data-stu-id="6905f-117">The assumption underlying this calculation is that all audio samples in the stream are of equal duration; however, the samples output by the DMO are not of equal duration, and so the time stamps applied by the AVI Splitter are not accurate.</span></span> <span data-ttu-id="6905f-118">Aus diesem Grund ist es nicht möglich, den avi-Splitter oder den Audiodecoder-DMO zu ändern, um die Verwendung einer beliebigen DirectShow-basierten Anwendung für die Wiedergabe von AVI-Dateien mit Audiodaten und Videostreams synchron zu verwenden. In einigen Fällen funktioniert der Voice-Codec von Windows Media Audio 9, aber auch dies verliert nach jedem Suchvorgang die Synchronisierung, sodass er nicht als geeignete Lösung angesehen werden kann.</span><span class="sxs-lookup"><span data-stu-id="6905f-118">Therefore, it is not possible, without modifying either the AVI Splitter or the audio decoder DMO, to use any DirectShow-based application to play back AVI files with audio and video streams in sync. The Windows Media Audio 9 Voice codec will work in some cases, but even this will lose sync after any seek operation, so it really cannot be considered a viable solution.</span></span>

<span data-ttu-id="6905f-119">Wenn Sie über einen MP3-Encoder verfügen, können Sie AVI-Dateien mit WMV und MP3 für den Audiostream erstellen.</span><span class="sxs-lookup"><span data-stu-id="6905f-119">If you have an MP3 encoder, you can create AVI files with WMV and MP3 for the audio stream.</span></span> <span data-ttu-id="6905f-120">Diese Dateien werden in Windows Media Player und anderen DirectShow-basierten Anwendungen ordnungsgemäß wiedergegeben, da der avi-Splitter einen speziellen Behandlungs Code für MP3-Streams enthält.</span><span class="sxs-lookup"><span data-stu-id="6905f-120">Such files will play back and seek correctly in Windows Media Player and other DirectShow-based applications, because the AVI Splitter contains special handling code for MP3 streams.</span></span> <span data-ttu-id="6905f-121">Eine andere Möglichkeit ist die Verwendung von unkomprimierter PCM-Audiodaten, obwohl die resultierende Dateigröße deutlich größer als bei einem komprimierten Audiodatenstrom ist.</span><span class="sxs-lookup"><span data-stu-id="6905f-121">Another option is to use uncompressed PCM audio, although obviously the resulting file size will be much larger than with a compressed audio stream.</span></span> <span data-ttu-id="6905f-122">Da die DirectShow-Beispielanwendung AVI-Dateien erstellt, wird die Verwendung des Audioencoders DMO nicht veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="6905f-122">Because the DirectShow sample application creates AVI files, it does not demonstrate how to use the audio encoder DMO.</span></span>

## <a name="one-pass-encoding"></a><span data-ttu-id="6905f-123">One-Pass-Codierung</span><span class="sxs-lookup"><span data-stu-id="6905f-123">One-pass Encoding</span></span>

<span data-ttu-id="6905f-124">Der Video Encoder DMO funktioniert problemlos in DirectShow für zwei Codierungs Modi: CBR und Qualitäts basiertes VBR.</span><span class="sxs-lookup"><span data-stu-id="6905f-124">The video encoder DMO works easily in DirectShow for two encoding modes: CBR and quality based VBR.</span></span> <span data-ttu-id="6905f-125">Solange Sie bei der Erstellung des Filter Diagramms auf die richtige Reihenfolge der Vorgänge folgen, wie in der Beispielanwendung veranschaulicht, ist es relativ einfach, WMV-Inhalte mithilfe von AVI Multiplexer und dem dateiwriter in eine AVI-Datei zu platzieren.</span><span class="sxs-lookup"><span data-stu-id="6905f-125">As long as you follow the correct order of operations when building the filter graph, as demonstrated in the sample application, it is relatively simple to place WMV content into an AVI file using the AVI Multiplexer and the File Writer.</span></span>

## <a name="two-pass-encoding"></a><span data-ttu-id="6905f-126">Zwei-Pass-Codierung</span><span class="sxs-lookup"><span data-stu-id="6905f-126">Two-pass Encoding</span></span>

<span data-ttu-id="6905f-127">Die zwei-Pass-Codierungs Modi erfordern einen komplexeren Ansatz zum entwickeln und Streamen von Diagrammen, um zu verhindern, dass der DMO seinen Inhalt vor dem zweiten Durchlauf aus dem ersten Durchlauf legt.</span><span class="sxs-lookup"><span data-stu-id="6905f-127">The two-pass encoding modes require a more complex approach to graph building and streaming in order to prevent the DMO from flushing its contents from the first pass before beginning the second pass.</span></span> <span data-ttu-id="6905f-128">Bei der Codierung mit zwei Durchgängen ist es erforderlich, das Diagramm einmal auszuführen, damit DMO seine Vorverarbeitungs Analyse der Datei Daten durchführen kann. Anschließend wird das Diagramm zurück gezeichnet und erneut ausgeführt, damit das DMO die tatsächliche Codierung durchführen kann.</span><span class="sxs-lookup"><span data-stu-id="6905f-128">In two-pass encoding, it is necessary to run the graph once so the DMO can perform its preprocessing analysis of the file data, and then rewind the graph and run it again so that the DMO can do the actual encoding.</span></span>

<span data-ttu-id="6905f-129">Wenn das Diagramm für den zweiten Durchlauf in den Lauf Zustand wechselt, legt der DMO-Wrapper das discontinuity-Flag für das erste Beispiel fest, da der Zeitstempel nicht mit dem letzten Zeitstempel im ersten Durchlauf sequenziell ist.</span><span class="sxs-lookup"><span data-stu-id="6905f-129">When the graph goes into a run state for the second pass, the DMO Wrapper sets the DISCONTINUITY flag on the first sample, because the time stamp is not sequential with the last time stamp on the first pass.</span></span> <span data-ttu-id="6905f-130">Wenn der DMO, der nicht für die Ausführung in DirectShow entworfen wurde, das discontinuity-Flag empfängt, führt er eine Leerung aus und verliert die vom ersten Durchlauf gespeicherten Daten.</span><span class="sxs-lookup"><span data-stu-id="6905f-130">When the DMO, which was not designed to work in DirectShow in this way, receives the DISCONTINUITY flag, it performs a flush and loses the data stored from the first pass.</span></span> <span data-ttu-id="6905f-131">Um dieses Problem zu umgehen, besteht die beste Lösung wahrscheinlich darin, einen benutzerdefinierten DMO-Wrapper Filter zu schreiben, der das discontinuity-Flag nicht festgelegt, wenn das Diagramm nach dem ersten Durchlauf als Seeding festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="6905f-131">To work around this issue, the best solution is probably to write a custom DMO Wrapper filter that does not set the DISCONTINUITY flag when the graph is seeked after the first pass.</span></span> <span data-ttu-id="6905f-132">Das Beispiel Video für Windows (Vfw) in diesem SDK veranschaulicht, wie die zwei-Pass-Codierung ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="6905f-132">The Video for Windows (VfW) sample in this SDK demonstrates how to perform two-pass encoding.</span></span>

## <a name="interlaced-content"></a><span data-ttu-id="6905f-133">Zeilen Sprung Inhalt</span><span class="sxs-lookup"><span data-stu-id="6905f-133">Interlaced Content</span></span>

<span data-ttu-id="6905f-134">Der WMV Encoder DMO ist in der Lage, Zeilen Sprung Inhalte zu codieren, während die Überlappung beibehalten wird. Dies ist nützlich für Inhalte, die von einem Fernsehgerät aufgezeichnet werden und möglicherweise auch auf einem Fernsehgerät wiedergegeben werden.</span><span class="sxs-lookup"><span data-stu-id="6905f-134">The WMV encoder DMO is able to encode interlaced content while preserving the interlacing, which is useful for content that is captured from a TV and might also be played back on a TV.</span></span> <span data-ttu-id="6905f-135">Es ist jedoch nicht möglich, die Überlappung mit dem standardmäßigen DMO-Wrapper beizubehalten, da dieser Filter [**inssbuffer**](/previous-versions/windows/desktop/api/wmsbuffer/nn-wmsbuffer-inssbuffer) in den Eingabe Beispielen nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="6905f-135">However, it is not possible to preserve interlacing using the default DMO Wrapper, because that filter does not support [**INSSBuffer**](/previous-versions/windows/desktop/api/wmsbuffer/nn-wmsbuffer-inssbuffer) on its input samples.</span></span>

<span data-ttu-id="6905f-136">Der DMO verwendet diese Schnittstelle zum Abrufen der Zeilen Sprung Einstellungen für jedes empfangene Beispiel.</span><span class="sxs-lookup"><span data-stu-id="6905f-136">The DMO uses that interface to obtain the interlaced settings for each sample that it receives.</span></span> <span data-ttu-id="6905f-137">Wenn die Schnittstelle nicht gefunden wird, wie es bei dem DMO-Wrapper der Fall ist, behandelt die DMO einfach die Eingabe Beispiele als nicht-Zeilen Sprung.</span><span class="sxs-lookup"><span data-stu-id="6905f-137">If the interface is not found, as is the case with the DMO Wrapper, the DMO simply treats the input samples as noninterlaced.</span></span> <span data-ttu-id="6905f-138">Zum Ausführen von Zeilen Sprung Codierung in DirectShow gibt es mehrere Alternativen.</span><span class="sxs-lookup"><span data-stu-id="6905f-138">To perform interlaced encoding in DirectShow, there are several alternatives.</span></span> <span data-ttu-id="6905f-139">Am einfachsten ist es, das Windows Media Format 9-Serien-SDK entweder direkt oder mithilfe des "WM ASF Writer DirectShow Filter" zu verwenden, um eine Zeilen Sprung-ASF-Datei zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="6905f-139">The easiest approach is probably to use the Windows Media Format 9 Series SDK either directly or using the WM ASF Writer DirectShow filter, to create an interlaced ASF file.</span></span> <span data-ttu-id="6905f-140">Anschließend können Sie diese Datei in ein anderes Format umwandeln.</span><span class="sxs-lookup"><span data-stu-id="6905f-140">You can then transcode that file into some other format.</span></span> <span data-ttu-id="6905f-141">Wenn Sie in AVI umwandeln, verfügen Sie über eine Zeilen Sprung Datei, aber die standardmäßigen DirectShow AVI-Wiedergabe Filter erkennen Sie nicht als solche, da Sie [**VIDEOINFOHEADER2**](/previous-versions/windows/desktop/api/dvdmedia/ns-dvdmedia-videoinfoheader2)nicht unterstützen.</span><span class="sxs-lookup"><span data-stu-id="6905f-141">If you transcode into AVI, you will have an interlaced file, but the standard DirectShow AVI playback filters will not recognize it as such because they do not support [**VIDEOINFOHEADER2**](/previous-versions/windows/desktop/api/dvdmedia/ns-dvdmedia-videoinfoheader2).</span></span> <span data-ttu-id="6905f-142">Ein anderer Ansatz besteht darin, einen eigenen DMO-Wrapper Filter zu schreiben, der die [**inssbuffer**](/previous-versions/windows/desktop/api/wmsbuffer/nn-wmsbuffer-inssbuffer) -Schnittstelle unterstützt.</span><span class="sxs-lookup"><span data-stu-id="6905f-142">Another approach is to write your own DMO Wrapper filter that supports the [**INSSBuffer**](/previous-versions/windows/desktop/api/wmsbuffer/nn-wmsbuffer-inssbuffer) interface.</span></span>

## <a name="related-topics"></a><span data-ttu-id="6905f-143">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="6905f-143">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="6905f-144">Arbeiten mit Codec-DMOS</span><span class="sxs-lookup"><span data-stu-id="6905f-144">Working with Codec DMOs</span></span>](workingwithcodecdmos.md)
</dt> </dl>

 

 
