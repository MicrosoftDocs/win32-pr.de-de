---
description: 'Weitere Informationen finden Sie unter: Verwenden von Output Protection Manager'
ms.assetid: 01edc17e-e71c-4772-a03c-09c9a2b8400f
title: Verwenden von Output Protection Manager
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 57bf4def3b0575dd706ae5f0c62924b6f1375a05
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "106345862"
---
# <a name="using-output-protection-manager"></a><span data-ttu-id="9e1cc-103">Verwenden von Output Protection Manager</span><span class="sxs-lookup"><span data-stu-id="9e1cc-103">Using Output Protection Manager</span></span>

<span data-ttu-id="9e1cc-104">In diesem Thema wird beschrieben, wie Sie mit dem Output Protection Manager (OPM) Videoinhalte während der Übertragung über einen physischen Connector zu einem Anzeigegerät schützen.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-104">This topic describes how to use Output Protection Manager (OPM) to protect video content as it travels over a physical connector to a display device.</span></span> <span data-ttu-id="9e1cc-105">Dieses Thema enthält folgende Abschnitte:</span><span class="sxs-lookup"><span data-stu-id="9e1cc-105">This topic contains the following sections:</span></span>

-   [<span data-ttu-id="9e1cc-106">Video Ausgaben</span><span class="sxs-lookup"><span data-stu-id="9e1cc-106">Video Outputs</span></span>](#video-outputs)
-   [<span data-ttu-id="9e1cc-107">Initialisieren einer OPM-Sitzung</span><span class="sxs-lookup"><span data-stu-id="9e1cc-107">Initializing an OPM Session</span></span>](#initializing-an-opm-session)
-   [<span data-ttu-id="9e1cc-108">Senden von OPM-Status Anforderungen</span><span class="sxs-lookup"><span data-stu-id="9e1cc-108">Sending OPM Status Requests</span></span>](#sending-opm-status-requests)
-   [<span data-ttu-id="9e1cc-109">Senden von OPM-Befehlen</span><span class="sxs-lookup"><span data-stu-id="9e1cc-109">Sending OPM Commands</span></span>](#sending-opm-commands)
-   [<span data-ttu-id="9e1cc-110">Behandeln einer deaktivierten Video Ausgabe</span><span class="sxs-lookup"><span data-stu-id="9e1cc-110">Handling a Disabled Video Output</span></span>](#sending-opm-commands)
-   [<span data-ttu-id="9e1cc-111">Verwenden von HDCP zum Schützen von Inhalten</span><span class="sxs-lookup"><span data-stu-id="9e1cc-111">Using HDCP to Protect Content</span></span>](#using-hdcp-to-protect-content)

<span data-ttu-id="9e1cc-112">Premium-Videoinhalte werden normalerweise verschlüsselt, um Sie vor unbefugter Duplizierung zu schützen.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-112">Premium video content is usually encrypted to protect it from unauthorized duplication.</span></span> <span data-ttu-id="9e1cc-113">Natürlich muss das Video entschlüsselt werden, bevor es angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-113">Of course, the video must be decrypted before it is displayed.</span></span> <span data-ttu-id="9e1cc-114">Die entschlüsselten, nicht komprimierten Frames müssen dann über einen physischen Connector auf das Anzeigegerät übertragen werden.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-114">The decrypted, uncompressed frames must then travel across a physical connector to the display device.</span></span> <span data-ttu-id="9e1cc-115">Bei Inhaltsanbietern ist es möglicherweise erforderlich, dass die Videorahmen an dieser Stelle geschützt werden, da Sie über den physischen Connector übertragen werden.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-115">Content providers may require the video frames to be protected at this point, as they travel across the physical connector.</span></span>

<span data-ttu-id="9e1cc-116">Zu diesem Zweck gibt es verschiedene Schutzmechanismen, einschließlich High-Bandwidth Digital Content Protection (HDCP) und DisplayPort Content Protection (dpcp) für digitale Ausgaben. und Copy Generation Management System-Analog (CGMS-A) für analoge Ausgaben.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-116">Various protection mechanisms exist for this purpose, including High-Bandwidth Digital Content Protection (HDCP) and DisplayPort Content Protection (DPCP) for digital outputs; and Copy Generation Management System - Analog (CGMS-A) for analog outputs.</span></span> <span data-ttu-id="9e1cc-117">Diese Mechanismen beinhalten in der Regel das Verschlüsseln oder stören des Signals, das Sie an die Anzeige weitergibt.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-117">Generally, these mechanisms involve encrypting or scrambling the signal befores it goes to the display.</span></span>

<span data-ttu-id="9e1cc-118">OPM ermöglicht es einer Anwendung, Inhalts Schutzmechanismen für die Videoausgabe zu erzwingen.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-118">OPM enables an application to enforce content protection mechanisms on the video output.</span></span> <span data-ttu-id="9e1cc-119">Mithilfe von OPM sendet die Anwendung Befehle und Status Anforderungen an den Grafiktreiber über einen vertrauenswürdigen, sicheren Kanal.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-119">Using OPM, the application sends commands and status requests to the graphics driver through a trusted, secure channel.</span></span> <span data-ttu-id="9e1cc-120">OPM ermöglicht einer Anwendung Folgendes:</span><span class="sxs-lookup"><span data-stu-id="9e1cc-120">OPM enables an application to:</span></span>

-   <span data-ttu-id="9e1cc-121">Überprüfen Sie, ob ein Grafiktreiber von Microsoft signiert wurde.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-121">Verify that a graphics driver has been signed by Microsoft.</span></span>
-   <span data-ttu-id="9e1cc-122">Richten Sie einen vertrauenswürdigen Kommunikationskanal mit dem Treiber ein.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-122">Set up a trusted communication channel with the driver.</span></span>
-   <span data-ttu-id="9e1cc-123">Erzwingen von Mechanismen zum Schutz von Inhalten für die physische Ausgabe.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-123">Enforce content protection mechanisms on the physical output.</span></span>

<span data-ttu-id="9e1cc-124">OPM ersetzt den zertifizierten Ausgabe Schutz-Protcol (COPP) und verwendet eine ähnliche API.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-124">OPM replaces Certified Output Protection Protcol (COPP) and uses a similar API.</span></span> <span data-ttu-id="9e1cc-125">Aus Gründen der Abwärtskompatibilität kann die OPM-Schnittstelle die COPP-Schnittstelle emulieren.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-125">For backward compatibility, the OPM interface can emulate the COPP interface.</span></span> <span data-ttu-id="9e1cc-126">Die Unterschiede zwischen OPM und COPP umfassen Folgendes:</span><span class="sxs-lookup"><span data-stu-id="9e1cc-126">Differences between OPM and COPP include the following:</span></span>

-   <span data-ttu-id="9e1cc-127">OPM verwendet X. 509-Zertifikate, während COPP ein proprietäres Zertifikat Format verwendet.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-127">OPM uses X.509 certificates, while COPP uses a proprietary certificate format.</span></span>
-   <span data-ttu-id="9e1cc-128">OPM unterstützt HDCP-Repeater.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-128">OPM supports HDCP repeaters.</span></span>
-   <span data-ttu-id="9e1cc-129">Anwendungen, die OPM verwenden, müssen keine HDCP-systemerneuungsopbarkeits-Meldungen (SRMs) analysieren.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-129">Applications that use OPM do not have to parse HDCP system renewability messages (SRMs).</span></span>
-   <span data-ttu-id="9e1cc-130">OPM kann verwendet werden, wenn in der Grafik Anzeige der Klon Modus verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-130">OPM can be used when the graphics display is using clone mode.</span></span> <span data-ttu-id="9e1cc-131">Der Klon Modus wird von COPP nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-131">COPP does not support clone mode.</span></span>

<span data-ttu-id="9e1cc-132">Wenn Ihre Anwendung den geschützten Medien Pfad (PMP) zum Wiedergeben von Videoinhalten verwendet, müssen Sie die OPM-API nicht verwenden, da das PMP alle erforderlichen OPM-Aufrufe ausführt.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-132">If your application uses the protected media path (PMP) to play video content, you do not have to use the OPM API, because the PMP makes all of the required OPM calls.</span></span> <span data-ttu-id="9e1cc-133">Die OPM-API ist für Anwendungen verfügbar, die das PMP nicht verwenden.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-133">The OPM API is available for applications that do not use the PMP.</span></span>

<span data-ttu-id="9e1cc-134">OPM ist in Windows Vista und höher verfügbar, aber die API wurde bis Windows 7 nicht öffentlich gemacht.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-134">OPM is available in Windows Vista and later, but the API was not made public until Windows 7.</span></span> <span data-ttu-id="9e1cc-135">Um OPM in einer Anwendung verwenden zu können, müssen Sie über die Header-und Bibliotheksdateien aus dem Windows 7 SDK verfügen.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-135">To use OPM in an application, you must have the headers and library files from the Windows 7 SDK.</span></span> <span data-ttu-id="9e1cc-136">Sie müssen keine DLLs neu verteilen, um OPM in Windows Vista oder Windows Server 2008 zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-136">You do not have to redistribute any DLLs to use OPM in Windows Vista or Windows Server 2008.</span></span>

## <a name="video-outputs"></a><span data-ttu-id="9e1cc-137">Video Ausgaben</span><span class="sxs-lookup"><span data-stu-id="9e1cc-137">Video Outputs</span></span>

<span data-ttu-id="9e1cc-138">Ein Grafikadapter kann über mehrere physische Ausgaben verfügen, die jeweils über eigene Funktionen verfügen.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-138">A graphics adapter can have more than one physical output, each with its own capabilities.</span></span> <span data-ttu-id="9e1cc-139">Bevor eine Anwendung geschützte Inhalte wieder gibt, muss Sie die entsprechenden Schutzmechanismen für jede Videoausgabe festlegen, die der Grafikkarte zugeordnet ist, auf der das Video angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-139">Before an application plays protected content, it must set the appropriate protection mechanisms on every video output associated with the graphics card that will display the video.</span></span> <span data-ttu-id="9e1cc-140">Welche Schutzmechanismen angewendet werden sollen, hängt von den Verwendungs Regeln für den Inhalt ab.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-140">Which protection mechanisms to apply will depend on the usage rules for the content.</span></span>

<span data-ttu-id="9e1cc-141">Jede Videoausgabe wird durch eine Instanz der [**IOPMVideoOutput**](/windows/desktop/api/opmapi/nn-opmapi-iopmvideooutput) -Schnittstelle dargestellt.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-141">Each video output is represented by an instance of the [**IOPMVideoOutput**](/windows/desktop/api/opmapi/nn-opmapi-iopmvideooutput) interface.</span></span> <span data-ttu-id="9e1cc-142">Sie können ein Direct3D-Gerät oder Monitor Handles verwenden, um die Video Ausgaben zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-142">You can use a Direct3D device or monitor handles to get the video outputs.</span></span>

<span data-ttu-id="9e1cc-143">Verwenden eines Direct3D-Geräts:</span><span class="sxs-lookup"><span data-stu-id="9e1cc-143">Using a Direct3D device:</span></span>

1.  <span data-ttu-id="9e1cc-144">Rufen Sie den **IDirect3DDevice9** -Zeiger für das Direct3D-Gerät ab, das Ihre Anwendung zum Erstellen von Oberflächen zum Speichern der Videorahmen verwendet.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-144">Get the **IDirect3DDevice9** pointer for the Direct3D device that your application will use to create surfaces to hold the video frames.</span></span>
2.  <span data-ttu-id="9e1cc-145">Ruft die [**OPMGetVideoOutputsFromIDirect3DDevice9Object**](/windows/desktop/api/opmapi/nf-opmapi-opmgetvideooutputsfromidirect3ddevice9object) -Funktion auf.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-145">Call the [**OPMGetVideoOutputsFromIDirect3DDevice9Object**](/windows/desktop/api/opmapi/nf-opmapi-opmgetvideooutputsfromidirect3ddevice9object) function.</span></span> <span data-ttu-id="9e1cc-146">Diese Funktion weist ein Array von [**IOPMVideoOutput**](/windows/desktop/api/opmapi/nn-opmapi-iopmvideooutput) -Zeigern zu, eines für jede Ausgabe.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-146">This function allocates an array of [**IOPMVideoOutput**](/windows/desktop/api/opmapi/nn-opmapi-iopmvideooutput) pointers, one for each output.</span></span>

<span data-ttu-id="9e1cc-147">Verwenden von Monitor Handles:</span><span class="sxs-lookup"><span data-stu-id="9e1cc-147">Using monitor handles:</span></span>

1.  <span data-ttu-id="9e1cc-148">Geben Sie " **enumdisplaymonitors** " an, um die **Hmonitor** -Handles abzurufen, die dem Videofenster entsprechen.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-148">Call **EnumDisplayMonitors** to get the **HMONITOR** handles that correspond to the video window.</span></span> <span data-ttu-id="9e1cc-149">Dem gleichen Fenster können mehrere Monitore zugeordnet werden, sodass Sie möglicherweise mehrere **Hmonitor** -Handles erhalten.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-149">Several monitors can be associated with the same window, so you might get several **HMONITOR** handles.</span></span>
2.  <span data-ttu-id="9e1cc-150">Aufrufen Sie für jedes Monitor Handle [**opmgetvideooutputsfromhmonitor**](/windows/desktop/api/opmapi/nf-opmapi-opmgetvideooutputsfromhmonitor).</span><span class="sxs-lookup"><span data-stu-id="9e1cc-150">For each monitor handle, call [**OPMGetVideoOutputsFromHMONITOR**](/windows/desktop/api/opmapi/nf-opmapi-opmgetvideooutputsfromhmonitor).</span></span> <span data-ttu-id="9e1cc-151">Diese Funktion weist ein Array von [**IOPMVideoOutput**](/windows/desktop/api/opmapi/nn-opmapi-iopmvideooutput) -Zeigern zu, eines für jede Ausgabe.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-151">This function allocates an array of [**IOPMVideoOutput**](/windows/desktop/api/opmapi/nn-opmapi-iopmvideooutput) pointers, one for each output.</span></span>

## <a name="initializing-an-opm-session"></a><span data-ttu-id="9e1cc-152">Initialisieren einer OPM-Sitzung</span><span class="sxs-lookup"><span data-stu-id="9e1cc-152">Initializing an OPM Session</span></span>

<span data-ttu-id="9e1cc-153">Bevor die Anwendung OPM-Befehle oder-Status Anforderungen sendet, muss Sie überprüfen, ob die Videoausgabe vertrauenswürdig ist, und einen Sitzungsschlüssel einrichten.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-153">Before the application sends OPM commands or status requests, it must verify that the video output is trusted and establish a session key.</span></span> <span data-ttu-id="9e1cc-154">Der Sitzungsschlüssel wird verwendet, um die zwischen der Anwendung und dem Grafiktreiber ausgetauschten Daten zu signieren.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-154">The session key is used to sign the data that is exchanged between the application and the graphics driver.</span></span>

<span data-ttu-id="9e1cc-155">Die OPM-API definiert einen Handshake, der Vertrauens Stellungen herstellt und den Sitzungsschlüssel festlegt.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-155">The OPM API defines a handshake that establishes trust and sets the session key.</span></span> <span data-ttu-id="9e1cc-156">Sie müssen diesen Handshake für jede Instanz der [**IOPMVideoOutput**](/windows/desktop/api/opmapi/nn-opmapi-iopmvideooutput) -Schnittstelle wie folgt ausführen:</span><span class="sxs-lookup"><span data-stu-id="9e1cc-156">You must perform this handshake for each instance of the [**IOPMVideoOutput**](/windows/desktop/api/opmapi/nn-opmapi-iopmvideooutput) interface, as follows:</span></span>

1.  <span data-ttu-id="9e1cc-157">Aufrufen von [**IOPMVideoOutput:: startinitialization**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-startinitialization).</span><span class="sxs-lookup"><span data-stu-id="9e1cc-157">Call [**IOPMVideoOutput::StartInitialization**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-startinitialization).</span></span> <span data-ttu-id="9e1cc-158">Diese Methode ruft zwei Datenelemente ab:</span><span class="sxs-lookup"><span data-stu-id="9e1cc-158">This method retrieves two pieces of data:</span></span>
    -   <span data-ttu-id="9e1cc-159">Eine Zufallszahl, die vom Treiber generiert wurde.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-159">A random number, generated by the driver.</span></span> <span data-ttu-id="9e1cc-160">Sie verwenden diese Zahl, um den Handshake abzuschließen.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-160">You will use this number to complete the handshake.</span></span>
    -   <span data-ttu-id="9e1cc-161">Die X. 509-Zertifikat Kette des Treibers.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-161">The driver's X.509 certificate chain.</span></span>
2.  <span data-ttu-id="9e1cc-162">Überprüfen Sie, ob die Zertifikat Kette von Microsoft signiert wurde.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-162">Verify that the certificate chain has been signed by Microsoft.</span></span>
    > [!Note]  
    > <span data-ttu-id="9e1cc-163">Die Zertifikat Sperrung liegt außerhalb des Gültigkeits Bereichs von OPM.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-163">Certificate revocation is outside the scope of OPM.</span></span>

     

3.  <span data-ttu-id="9e1cc-164">Den öffentlichen Schlüssel des Treibers aus der Zertifikat Kette erhalten.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-164">Get the driver's public key from the certificate chain.</span></span>
4.  <span data-ttu-id="9e1cc-165">Generieren Sie einen 128-Bit-AES-Sitzungsschlüssel.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-165">Generate a 128-bit AES session key.</span></span>
5.  <span data-ttu-id="9e1cc-166">Generieren Sie zwei zufällige 32-Bit-Zahlen:</span><span class="sxs-lookup"><span data-stu-id="9e1cc-166">Generate two random 32-bit numbers:</span></span>

    -   <span data-ttu-id="9e1cc-167">Die Startsequenz Nummer für OPM-Status Anforderungen.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-167">The starting sequence number for OPM status requests.</span></span>
    -   <span data-ttu-id="9e1cc-168">Die Startsequenz Nummer für OPM-Befehle.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-168">The starting sequence number for OPM commands.</span></span>

    <span data-ttu-id="9e1cc-169">Diese Zahlen müssen mithilfe eines kryptografisch sicheren Pseudozufallszahlen-Generators generiert werden, z. **b. cryptgenrandom**.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-169">These numbers must be generated using a cryptographically secure pseudo-random number generator, such as **CryptGenRandom**.</span></span>

6.  <span data-ttu-id="9e1cc-170">Kopieren Sie die zufällige Nummer des Treibers (abgerufen in Schritt 1), den Sitzungsschlüssel und die beiden Sequenznummern in eine [**OPM- \_ verschlüsselte \_ Initialisierungs \_ Parameter**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_encrypted_initialization_parameters) -Struktur, wie in [**IOPMVideoOutput:: FinishInitialization**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-finishinitialization)beschrieben.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-170">Copy the driver's random number (obtained in step 1), the session key, and the two sequence numbers into an [**OPM\_ENCRYPTED\_INITIALIZATION\_PARAMETERS**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_encrypted_initialization_parameters) structure, as described in [**IOPMVideoOutput::FinishInitialization**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-finishinitialization).</span></span>
7.  <span data-ttu-id="9e1cc-171">Verschlüsseln Sie die Struktur der [**verschlüsselten OPM- \_ \_ Initialisierungs \_ Parameter**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_encrypted_initialization_parameters) mit rsaes-OAEP. verwenden Sie dazu den öffentlichen Schlüssel des Treibers, der im Zertifikat des Treibers enthalten ist.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-171">Encrypt the [**OPM\_ENCRYPTED\_INITIALIZATION\_PARAMETERS**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_encrypted_initialization_parameters) structure with RSAES-OAEP, using the driver's public key, which is found in the driver's certificate.</span></span>
8.  <span data-ttu-id="9e1cc-172">Aufrufen von [**IOPMVideoOutput:: FinishInitialization**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-finishinitialization).</span><span class="sxs-lookup"><span data-stu-id="9e1cc-172">Call [**IOPMVideoOutput::FinishInitialization**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-finishinitialization).</span></span>

## <a name="sending-opm-status-requests"></a><span data-ttu-id="9e1cc-173">Senden von OPM-Status Anforderungen</span><span class="sxs-lookup"><span data-stu-id="9e1cc-173">Sending OPM Status Requests</span></span>

<span data-ttu-id="9e1cc-174">OPM-Status Anforderungen geben Informationen über die Videoausgabe zurück, z. b. den Typ des physischen Connector und die aktuelle Schutz Ebene.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-174">OPM status requests return information about the video output, such as the type of physical connector and the current protection level.</span></span> <span data-ttu-id="9e1cc-175">Eine Liste der Anforderungs Typen finden Sie unter [OPM-Status Anforderungen](opm-status-requests.md).</span><span class="sxs-lookup"><span data-stu-id="9e1cc-175">For a list of request types, see [OPM Status Requests](opm-status-requests.md).</span></span>

<span data-ttu-id="9e1cc-176">Führen Sie die folgenden Schritte aus, um eine Status Anforderung zu senden.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-176">To send a status request, perform the following steps.</span></span>

1.  <span data-ttu-id="9e1cc-177">Initialisieren [**Sie eine OPM-Struktur \_ get \_ Info \_ Parameters**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_get_info_parameters) , wie in der folgenden Tabelle gezeigt.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-177">Initialize an [**OPM\_GET\_INFO\_PARAMETERS**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_get_info_parameters) structure as shown in the following table.</span></span>

    | <span data-ttu-id="9e1cc-178">Member</span><span class="sxs-lookup"><span data-stu-id="9e1cc-178">Member</span></span>               | <span data-ttu-id="9e1cc-179">BESCHREIBUNG</span><span class="sxs-lookup"><span data-stu-id="9e1cc-179">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                 |
    |----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
    | <span data-ttu-id="9e1cc-180">**OMAC**</span><span class="sxs-lookup"><span data-stu-id="9e1cc-180">**omac**</span></span>             | <span data-ttu-id="9e1cc-181">Dieses Feld jetzt überspringen.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-181">Skip this field for now.</span></span>                                                                                                                                                                                                                                                                                                                                                    |
    | <span data-ttu-id="9e1cc-182">**rnrandomnumber**</span><span class="sxs-lookup"><span data-stu-id="9e1cc-182">**rnRandomNumber**</span></span>   | <span data-ttu-id="9e1cc-183">Eine kryptografisch sichere 128-Bit-Zufallszahl.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-183">A cryptographically secure 128-bit random number.</span></span> <span data-ttu-id="9e1cc-184">Wenn Sie eine Status Anforderung erstellen, generieren Sie immer eine neue Zufallszahl, auch wenn Sie dieselbe Anforderung vornehmen.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-184">Whenever you make a status request, always generate a new random number, even if you are making the same request.</span></span> <span data-ttu-id="9e1cc-185">Speichern Sie die Nummer in einer Variablen, da Sie später darauf verweisen müssen.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-185">Store the number in a variable, because you will need to refer to it later.</span></span>                                                                                                                             |
    | <span data-ttu-id="9e1cc-186">**guidinformation**</span><span class="sxs-lookup"><span data-stu-id="9e1cc-186">**guidInformation**</span></span>  | <span data-ttu-id="9e1cc-187">Eine GUID, die die Status Anforderung identifiziert.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-187">A GUID that identifies the status request.</span></span> <span data-ttu-id="9e1cc-188">Eine Liste der Status Anforderungen finden Sie unter [OPM-Status Anforderungen](opm-status-requests.md).</span><span class="sxs-lookup"><span data-stu-id="9e1cc-188">For a list of status requests, see [OPM Status Requests](opm-status-requests.md).</span></span>                                                                                                                                                                                                                                               |
    | <span data-ttu-id="9e1cc-189">**ulsequencenumschlag**</span><span class="sxs-lookup"><span data-stu-id="9e1cc-189">**ulSequenceNumber**</span></span> | <span data-ttu-id="9e1cc-190">Die Sequenznummer.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-190">The sequence number.</span></span> <span data-ttu-id="9e1cc-191">Verwenden Sie für die erste Status Anforderung die Startsequenz Nummer, die Sie in der [**IOPMVideoOutput:: FinishInitialization**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-finishinitialization) -Methode angegeben haben (Schritt 5 der [Initialisierung einer OPM-Sitzung](#initializing-an-opm-session)). Jedes Mal, wenn Sie eine weitere Status Anforderung vornehmen, erhöhen Sie diese Zahl um 1.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-191">For the first status request, use the starting sequence number that you specified in the [**IOPMVideoOutput::FinishInitialization**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-finishinitialization) method (step 5 of [Initializing an OPM Session](#initializing-an-opm-session).) Each time you make another status request, increment this number by 1.</span></span> |
    | <span data-ttu-id="9e1cc-192">**abparameters**</span><span class="sxs-lookup"><span data-stu-id="9e1cc-192">**abParameters**</span></span>     | <span data-ttu-id="9e1cc-193">Ein Bytearray, das zusätzliche Eingabedaten für die Anforderung enthält.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-193">A byte array that contains additional input data for the request.</span></span> <span data-ttu-id="9e1cc-194">Das Format der Eingabedaten wird im Referenz Thema für jede Status Anforderung aufgeführt.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-194">The format of the input data is listed in the reference topic for each status request.</span></span>                                                                                                                                                                                                                    |
    | <span data-ttu-id="9e1cc-195">**cbparameterssize**</span><span class="sxs-lookup"><span data-stu-id="9e1cc-195">**cbParametersSize**</span></span> | <span data-ttu-id="9e1cc-196">Die Größe der gültigen Daten im **abparameters** -Array.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-196">The size of the valid data in the **abParameters** array.</span></span> <span data-ttu-id="9e1cc-197">Der Inhalt des restlichen Arrays ist nicht definiert.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-197">The contents of the rest of the array are undefined.</span></span>                                                                                                                                                                                                                                                              |

    

     

2.  <span data-ttu-id="9e1cc-198">Berechnen Sie den One-Key-CBC-MAC (OMAC-1), um einen Hash für den Datenblock zu berechnen, der nach dem **OMAC** -Member angezeigt wird, und legen Sie dann den **OMAC** -Member auf diesen Wert fest.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-198">Calculate the one-key CBC MAC (OMAC-1) to calculate a hash for the block of data that appears after the **omac** member, and then set the **omac** member to this value.</span></span> <span data-ttu-id="9e1cc-199">Siehe [OPM-Beispiel Code](opm-example-code.md).</span><span class="sxs-lookup"><span data-stu-id="9e1cc-199">See [OPM Example Code](opm-example-code.md).</span></span>
3.  <span data-ttu-id="9e1cc-200">Aufrufen der [**IOPMVideoOutput:: GetInformation**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-getinformation) -Methode.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-200">Call the [**IOPMVideoOutput::GetInformation**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-getinformation) method.</span></span> <span data-ttu-id="9e1cc-201">Übergibt einen Zeiger auf die [**OPM-Struktur \_ get \_ Info \_ Parameters**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_get_info_parameters) und einen Zeiger auf eine von [**OPM \_ angeforderte \_ Informations**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) Struktur.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-201">Pass in a pointer to the [**OPM\_GET\_INFO\_PARAMETERS**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_get_info_parameters) structure and a pointer to an [**OPM\_REQUESTED\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) structure.</span></span> <span data-ttu-id="9e1cc-202">Die Antwort des Treibers wird in die von **OPM \_ angeforderte \_ Informations** Struktur geschrieben.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-202">The driver's response is written to the **OPM\_REQUESTED\_INFORMATION** structure.</span></span>
    -   <span data-ttu-id="9e1cc-203">Der **OMAC** -Member dieser Struktur enthält eine OMAC, die für die Daten berechnet wird, die diesem Element folgen.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-203">The **omac** member of this structure contains an OMAC computed for the data that follows this member.</span></span>
    -   <span data-ttu-id="9e1cc-204">Der **abrequestedinformation** -Member ist ein Bytearray, das Ausgabedaten für die Antwort enthält.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-204">The **abRequestedInformation** member is a byte array that contains output data for the response.</span></span> <span data-ttu-id="9e1cc-205">Das Format der Ausgabedaten wird im Referenz Thema für jede Status Anforderung aufgeführt.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-205">The format of the output data is listed in the reference topic for each status request.</span></span>
4.  <span data-ttu-id="9e1cc-206">Berechnen eines OMAC für die von [**OPM \_ angeforderte \_ Informations**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) Struktur, ohne den **OMAC** -Member.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-206">Calculate an OMAC for the [**OPM\_REQUESTED\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) structure, not including the **omac** member.</span></span> <span data-ttu-id="9e1cc-207">Vergewissern Sie sich, dass der OMAC mit dem Wert im **OMAC** -Member übereinstimmt.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-207">Verify that the OMAC matches the value in the **omac** member.</span></span>
5.  <span data-ttu-id="9e1cc-208">Stellen Sie sicher, dass der **cbrequestedinformationsize** -Member der von [**OPM \_ angeforderten \_ Informations**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) Struktur die richtige Größe für die Ausgabedaten liefert.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-208">Make sure the **cbRequestedInformationSize** member of the [**OPM\_REQUESTED\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) structure gives the correct size for the output data.</span></span> <span data-ttu-id="9e1cc-209">Beispielsweise handelt es sich bei den Ausgabedaten für die OPM-Abfrage " [**\_ get \_ Connector \_ Type**](opm-get-connector-type.md) " um eine [**OPM- \_ Standard \_ Informations**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) Struktur, daher sollte der Wert von " **cbrequestedinformationsize** " lauten `sizeof(OPM_STANDARD_INFORMATION)` .</span><span class="sxs-lookup"><span data-stu-id="9e1cc-209">For example, the output data for the [**OPM\_GET\_CONNECTOR\_TYPE**](opm-get-connector-type.md) query is an [**OPM\_STANDARD\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) structure, so the value of **cbRequestedInformationSize** should be `sizeof(OPM_STANDARD_INFORMATION)`.</span></span>
6.  <span data-ttu-id="9e1cc-210">Wandeln Sie den **abrequestedinformation** -Member der von [**OPM \_ angeforderten \_ Informations**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) Struktur in die richtige Ausgabedaten Struktur um.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-210">Cast the **abRequestedInformation** member of the [**OPM\_REQUESTED\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) structure to the correct output data structure.</span></span> <span data-ttu-id="9e1cc-211">Wenn die Status Anforderung beispielsweise [**OPM \_ get \_ Connector \_ Type**](opm-get-connector-type.md)lautet, wandeln Sie **abrequestedinformation** in eine [**OPM- \_ Standard \_ Informations**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) Struktur um.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-211">For example, if the status request is [**OPM\_GET\_CONNECTOR\_TYPE**](opm-get-connector-type.md), cast **abRequestedInformation** to an [**OPM\_STANDARD\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) structure.</span></span>
7.  <span data-ttu-id="9e1cc-212">Stellen Sie sicher, dass der **rnrandomnumber** -Member der Ausgabedaten Struktur mit dem Wert von **rnrandomnumber** aus Schritt 1 übereinstimmt.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-212">Make sure the **rnRandomNumber** member of the output data structure matches the value of **rnRandomNumber** from step 1.</span></span>
8.  <span data-ttu-id="9e1cc-213">Überprüfen Sie den **ulstaturflags** -Member der Ausgabedaten Struktur, wie unter [Behandeln einer deaktivierten Video Ausgabe](#handling-a-disabled-video-output)beschrieben.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-213">Check the **ulStatusFlags** member of the output data structure, as described in [Handling a Disabled Video Output](#handling-a-disabled-video-output).</span></span>

<span data-ttu-id="9e1cc-214">Wenn eine der Überprüfungen in den Schritten 5 – 8 fehlschlägt, muss die Anwendung den geschützten Inhalt nicht mehr angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-214">If any of the checks in steps 5–8 fails, the application must stop showing protected content.</span></span>

## <a name="sending-opm-commands"></a><span data-ttu-id="9e1cc-215">Senden von OPM-Befehlen</span><span class="sxs-lookup"><span data-stu-id="9e1cc-215">Sending OPM Commands</span></span>

<span data-ttu-id="9e1cc-216">OPM-Befehle werden verwendet, um die Schutz Ebene und andere Einstellungen für die Videoausgabe festzulegen.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-216">OPM commands are used to set the protection level and other settings on the video output.</span></span> <span data-ttu-id="9e1cc-217">Das Senden eines OPM-Befehls ähnelt dem Senden einer Status Anforderung, mit dem Unterschied, dass keine Antwortdaten vom Treiber vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-217">Sending an OPM command is similar to sending a status request, except there is no response data from the driver.</span></span> <span data-ttu-id="9e1cc-218">Eine Liste der Befehle finden Sie unter [OPM-Befehle](opm-commands.md).</span><span class="sxs-lookup"><span data-stu-id="9e1cc-218">For a list of commands, see [OPM Commands](opm-commands.md).</span></span>

<span data-ttu-id="9e1cc-219">Führen Sie die folgenden Schritte aus, um einen OPM-Befehl zu senden.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-219">To send an OPM command, perform the following steps.</span></span>

1.  <span data-ttu-id="9e1cc-220">Füllen Sie die Struktur von [**OPM- \_ Konfigurations \_ Parametern**](/windows/desktop/api/opmapi/ns-opmapi-opm_configure_parameters) aus, wie in der folgenden Tabelle gezeigt.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-220">Fill in an [**OPM\_CONFIGURE\_PARAMETERS**](/windows/desktop/api/opmapi/ns-opmapi-opm_configure_parameters) structure as shown in the following table.</span></span>

    | <span data-ttu-id="9e1cc-221">Member</span><span class="sxs-lookup"><span data-stu-id="9e1cc-221">Member</span></span>                | <span data-ttu-id="9e1cc-222">BESCHREIBUNG</span><span class="sxs-lookup"><span data-stu-id="9e1cc-222">Description</span></span>                                                                                                                                                                                                                                                                                                                                                   |
    |-----------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
    | <span data-ttu-id="9e1cc-223">**OMAC**</span><span class="sxs-lookup"><span data-stu-id="9e1cc-223">**omac**</span></span>              | <span data-ttu-id="9e1cc-224">Dieses Feld jetzt überspringen.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-224">Skip this field for now.</span></span>                                                                                                                                                                                                                                                                                                                                      |
    | <span data-ttu-id="9e1cc-225">**guidsetting**</span><span class="sxs-lookup"><span data-stu-id="9e1cc-225">**guidSetting**</span></span>       | <span data-ttu-id="9e1cc-226">Eine GUID, die den Befehl identifiziert.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-226">A GUID that identifies the command.</span></span> <span data-ttu-id="9e1cc-227">Eine Liste der Befehle finden Sie unter [OPM-Befehle](opm-commands.md).</span><span class="sxs-lookup"><span data-stu-id="9e1cc-227">For a list of commands, see [OPM Commands](opm-commands.md).</span></span>                                                                                                                                                                                                                                                             |
    | <span data-ttu-id="9e1cc-228">**ulsequencenumschlag**</span><span class="sxs-lookup"><span data-stu-id="9e1cc-228">**ulSequenceNumber**</span></span>  | <span data-ttu-id="9e1cc-229">Die Sequenznummer.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-229">The sequence number.</span></span> <span data-ttu-id="9e1cc-230">Verwenden Sie für den ersten Befehl die Startsequenz Nummer, die Sie in der [**IOPMVideoOutput:: FinishInitialization**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-finishinitialization) -Methode angegeben haben (Schritt 5 der [Initialisierung einer OPM-Sitzung](#initializing-an-opm-session)). Jedes Mal, wenn Sie einen anderen Befehl senden, erhöhen Sie diese Zahl um 1.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-230">For the first command, use the starting sequence number that you specified in the [**IOPMVideoOutput::FinishInitialization**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-finishinitialization) method (step 5 of [Initializing an OPM Session](#initializing-an-opm-session).) Each time you send another command, increment this number by 1.</span></span> |
    | <span data-ttu-id="9e1cc-231">**abparameters**</span><span class="sxs-lookup"><span data-stu-id="9e1cc-231">**abParameters**</span></span>      | <span data-ttu-id="9e1cc-232">Ein Bytearray, das zusätzliche Eingabedaten für den Befehl enthält.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-232">A byte array that contains additional input data for the command.</span></span> <span data-ttu-id="9e1cc-233">Das Format der Eingabedaten wird im Referenz Thema für jeden Befehl aufgeführt.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-233">The format of the input data is listed in the reference topic for each command.</span></span>                                                                                                                                                                                                             |
    | <span data-ttu-id="9e1cc-234">**cbsettingdatasize**</span><span class="sxs-lookup"><span data-stu-id="9e1cc-234">**cbSettingDataSize**</span></span> | <span data-ttu-id="9e1cc-235">Die Größe der gültigen Daten im **abparameters** -Array.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-235">The size of the valid data in the **abParameters** array.</span></span> <span data-ttu-id="9e1cc-236">Der Inhalt des restlichen Arrays ist nicht definiert.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-236">The contents of the rest of the array are undefined.</span></span>                                                                                                                                                                                                                                                |

    

     

2.  <span data-ttu-id="9e1cc-237">Berechnen Sie eine OMAC für den Datenblock, der nach dem **OMAC** -Member angezeigt wird, und legen Sie dann den **OMAC** -Member auf diesen Wert fest.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-237">Calculate an OMAC for the block of data that appears after the **omac** member, and then set the **omac** member to this value.</span></span>
3.  <span data-ttu-id="9e1cc-238">Nennen Sie [**IOPMVideoOutput:: Configure**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-configure).</span><span class="sxs-lookup"><span data-stu-id="9e1cc-238">Call [**IOPMVideoOutput::Configure**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-configure).</span></span>

<span data-ttu-id="9e1cc-239">Bei den meisten Befehlen gibt es eine entsprechende Status Anforderung, mit der der Status des Befehls zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-239">For most commands, there is a corresponding status request that returns the status of the command.</span></span> <span data-ttu-id="9e1cc-240">Der [**OPM-Befehl \_ \_ Schutz \_ Ebene festlegen**](opm-set-protection-level.md) legt z. b. die Schutz Ebene fest, und der Befehl [**OPM \_ get \_ Virtual \_ Protection \_ Level**](opm-get-virtual-protection-level.md) Ruft die aktuelle Schutz Ebene ab.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-240">For example, the [**OPM\_SET\_PROTECTION\_LEVEL**](opm-set-protection-level.md) command sets the protection level, and the [**OPM\_GET\_VIRTUAL\_PROTECTION\_LEVEL**](opm-get-virtual-protection-level.md) command gets the current protection level.</span></span>

## <a name="handling-a-disabled-video-output"></a><span data-ttu-id="9e1cc-241">Behandeln einer deaktivierten Video Ausgabe</span><span class="sxs-lookup"><span data-stu-id="9e1cc-241">Handling a Disabled Video Output</span></span>

<span data-ttu-id="9e1cc-242">Eine Videoausgabe kann jederzeit deaktiviert werden, um die nicht autorisierte Verwendung von Videoinhalten zu verhindern.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-242">A video output might disable itself at any time to prevent the unauthorized use of video content.</span></span> <span data-ttu-id="9e1cc-243">Dies kann der Fall sein, weil ein Schutzmechanismus nicht mehr funktioniert, da der Treiber Manipulationen erkennt oder die Anzeige vom physischen Connector getrennt wurde.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-243">This might occur because a protection mechanism stops working, because the driver detects tampering, or because the display was disconnected from the physical connector.</span></span> <span data-ttu-id="9e1cc-244">Während eine Videoausgabe deaktiviert ist, werden keine Video Frames angezeigt.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-244">While a video output is disabled, no video frames are displayed.</span></span>

<span data-ttu-id="9e1cc-245">Während der Inhalts Schutz aktiviert ist, sollte eine Anwendung in regelmäßigen Abständen (mindestens einmal alle zwei Sekunden) die folgenden Schritte ausführen.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-245">While content protection is enabled, an application should periodically (at least once every 2 seconds) perform the following steps.</span></span>

1.  <span data-ttu-id="9e1cc-246">Wenden Sie [**IOPMVideoOutput:: GetInformation**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-getinformation) an, um entweder die Status Anforderung " [**\_ \_ tatsächliche \_ Schutz \_ Ebene**](opm-get-actual-protection-level.md) abrufen" oder " [**OPM \_ get \_ Virtual \_ Protection \_ Level**](opm-get-virtual-protection-level.md) " zu senden.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-246">Call [**IOPMVideoOutput::GetInformation**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-getinformation) to send either the [**OPM\_GET\_ACTUAL\_PROTECTION\_LEVEL**](opm-get-actual-protection-level.md) or [**OPM\_GET\_VIRTUAL\_PROTECTION\_LEVEL**](opm-get-virtual-protection-level.md) status request.</span></span> <span data-ttu-id="9e1cc-247">Die Rückgabe Daten für beide Befehle sind eine [**OPM- \_ Standard \_ Informations**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) Struktur.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-247">The return data for both commands is an [**OPM\_STANDARD\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) structure.</span></span>
2.  <span data-ttu-id="9e1cc-248">Überprüfen Sie den **ulinformation** -Member der [**OPM- \_ Standard \_ Informations**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) Struktur.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-248">Check the **ulInformation** member of the [**OPM\_STANDARD\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) structure.</span></span> <span data-ttu-id="9e1cc-249">Dieser Member enthält ein Flag, das angibt, ob der Inhalts Schutz weiterhin aktiviert ist.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-249">This member contains a flag indicating whether content protection is still enabled.</span></span> <span data-ttu-id="9e1cc-250">Wenn Content Protection deaktiviert ist, beenden Sie die Wiedergabe des Videos sofort.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-250">If content protection is off, stop playing the video immediately.</span></span>
3.  <span data-ttu-id="9e1cc-251">Wenn der Inhalts Schutz auf on ist, überprüfen Sie den **ulstatus-Flags** -Member der [**OPM- \_ Standard \_ Informations**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) Struktur.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-251">If content protection is on, check the **ulStatusFlags** member of the [**OPM\_STANDARD\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) structure.</span></span> <span data-ttu-id="9e1cc-252">Wenn keine Flags festgelegt sind, funktioniert die Videoausgabe ordnungsgemäß.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-252">If no flags are set, the video output is working correctly.</span></span> <span data-ttu-id="9e1cc-253">Andernfalls ist die Videoausgabe deaktiviert.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-253">Otherwise, the video output is disabled.</span></span>

<span data-ttu-id="9e1cc-254">Die folgenden Flags sind für **ulstatus-Flags** definiert.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-254">The following flags are defined for **ulStatusFlags**.</span></span>



<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><span data-ttu-id="9e1cc-255">Flag</span><span class="sxs-lookup"><span data-stu-id="9e1cc-255">Flag</span></span></th>
<th><span data-ttu-id="9e1cc-256">Beschreibung</span><span class="sxs-lookup"><span data-stu-id="9e1cc-256">Description</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span data-ttu-id="9e1cc-257"><strong>OPM_STATUS_LINK_LOST</strong></span><span class="sxs-lookup"><span data-stu-id="9e1cc-257"><strong>OPM_STATUS_LINK_LOST</strong></span></span></td>
<td><span data-ttu-id="9e1cc-258">Der Ausgabe Schutz ist aus irgendeinem Grund nicht mehr Funktions intensiv. Beispielsweise kann das Anzeigegerät nicht aus dem Verbindungs Modul entfernt werden.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-258">Output protection stopped working for some reason; for example, the display device might be unplugged from the conntector.</span></span> <span data-ttu-id="9e1cc-259">Beenden Sie die Wiedergabe, und deaktivieren Sie alle Mechanismen des Ausgabe Schutzes.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-259">Stop playback and turn off all output protection mechanisms.</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="9e1cc-260"><strong>OPM_STATUS_RENEGOTIATION_REQUIRED</strong></span><span class="sxs-lookup"><span data-stu-id="9e1cc-260"><strong>OPM_STATUS_RENEGOTIATION_REQUIRED</strong></span></span></td>
<td><span data-ttu-id="9e1cc-261">Die Anwendung muss die OPM-Sitzung wiederherstellen.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-261">The application must reestablish the OPM session.</span></span> <span data-ttu-id="9e1cc-262">Antworten Sie wie folgt:</span><span class="sxs-lookup"><span data-stu-id="9e1cc-262">Respond as follows:</span></span>
<ol>
<li><span data-ttu-id="9e1cc-263">Wiedergabe wird beendet.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-263">Stop playback.</span></span></li>
<li><span data-ttu-id="9e1cc-264">Deaktivieren Sie alle Schutzmechanismen.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-264">Turn off all protection mechanisms.</span></span></li>
<li><span data-ttu-id="9e1cc-265">Geben Sie die <a href="/windows/desktop/api/opmapi/nn-opmapi-iopmvideooutput"><strong>IOPMVideoOutput</strong></a> -Schnittstelle frei.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-265">Release the <a href="/windows/desktop/api/opmapi/nn-opmapi-iopmvideooutput"><strong>IOPMVideoOutput</strong></a> interface.</span></span></li>
<li><span data-ttu-id="9e1cc-266">Erstellen Sie alle Video Oberflächen neu.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-266">Recreate all video surfaces.</span></span></li>
<li><span data-ttu-id="9e1cc-267">Erstellen Sie ein neues OPM-Objekt, und versuchen Sie, den Inhalts Schutz wiederherzustellen.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-267">Create a new OPM object and attempt to reestablish content protection.</span></span> <span data-ttu-id="9e1cc-268">Wenn dies nicht möglich ist, wird dem Benutzer eine Fehlermeldung angezeigt.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-268">If this fails, display an error message to the user.</span></span> <span data-ttu-id="9e1cc-269">Spielen Sie keine weiteren Videoinhalte.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-269">Do not play any more video content.</span></span></li>
</ol></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="9e1cc-270"><strong>OPM_STATUS_REVOKED_HDCP_DEVICE_ATTACHED</strong></span><span class="sxs-lookup"><span data-stu-id="9e1cc-270"><strong>OPM_STATUS_REVOKED_HDCP_DEVICE_ATTACHED</strong></span></span></td>
<td><span data-ttu-id="9e1cc-271">Dieses Flag gilt nur, wenn HDCP verwendet wird, und gibt an, dass ein gesperrtes HDCP-Gerät vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-271">This flag applies only when HDCP is used, and indicates the presence of a revoked HDCP device.</span></span> <span data-ttu-id="9e1cc-272">Beenden Sie die Wiedergabe, und deaktivieren Sie alle Schutzmechanismen für diese Videoausgabe.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-272">Stop playback and turn off all protection mechanisms on this video output.</span></span> <span data-ttu-id="9e1cc-273">Wenn dieses Flag festgelegt ist, wird auch das <strong>OPM_STATUS_LINK_LOST</strong> -Flag festgelegt.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-273">When this flag is set, the <strong>OPM_STATUS_LINK_LOST</strong> flag is also set.</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="9e1cc-274"><strong>OPM_STATUS_REVOKED_HDCP_DEVICE_ATTACHED</strong></span><span class="sxs-lookup"><span data-stu-id="9e1cc-274"><strong>OPM_STATUS_REVOKED_HDCP_DEVICE_ATTACHED</strong></span></span></td>
<td><span data-ttu-id="9e1cc-275">Der Treiber hat Manipulationen erkannt.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-275">The driver has detected tampering.</span></span> <span data-ttu-id="9e1cc-276">Die Wiedergabe wird beendet, und es werden keine weiteren Videos mit dieser Videoausgabe abgespielt.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-276">Stop playback, and do not play any more video using this video output.</span></span> <span data-ttu-id="9e1cc-277">Es ist auch eine gute Idee, andere Video Ausgaben nicht zu verwenden, da das System möglicherweise kompromittiert ist.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-277">It is also a good idea to stop using any other video outputs, because the system might be compromised.</span></span></td>
</tr>
</tbody>
</table>



 

## <a name="using-hdcp-to-protect-content"></a><span data-ttu-id="9e1cc-278">Verwenden von HDCP zum Schützen von Inhalten</span><span class="sxs-lookup"><span data-stu-id="9e1cc-278">Using HDCP to Protect Content</span></span>

<span data-ttu-id="9e1cc-279">In diesem Abschnitt wird beschrieben, wie Sie den HDCP-Ausgabe Schutz mithilfe von OPM aktivieren.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-279">This section describes how to enable HDCP output protection using OPM.</span></span> <span data-ttu-id="9e1cc-280">Im folgenden finden Sie eine allgemeine Übersicht über die Schritte, die die Anwendung ausführen muss.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-280">Here is a general outline of the steps the application must take.</span></span> <span data-ttu-id="9e1cc-281">Details finden Sie weiter unten in diesem Abschnitt.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-281">Details are given later in this section.</span></span>

1.  <span data-ttu-id="9e1cc-282">Die Anwendung muss möglicherweise einen SRM für die Videoausgabe bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-282">The application might have to provide an SRM to the video output.</span></span> <span data-ttu-id="9e1cc-283">Der Mechanismus für den Empfang von SRMs liegt außerhalb des Gültigkeits Bereichs der OPM-Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-283">The mechanism for receiving SRMs is outside the scope of the OPM interface.</span></span> <span data-ttu-id="9e1cc-284">Beispielsweise können SRMs als Teil eines Broadcast Datenstroms übermittelt werden.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-284">For example, SRMs might be delivered as part of a broadcast stream.</span></span>
2.  <span data-ttu-id="9e1cc-285">Die Anwendung aktiviert den HDCP-Ausgabe Schutz.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-285">The application enables HDCP output protection.</span></span>
3.  <span data-ttu-id="9e1cc-286">Die Anwendung spielt den Videoinhalt.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-286">The application plays the video content.</span></span> <span data-ttu-id="9e1cc-287">Die Anwendung fragt den Treiber in regelmäßigen Abständen ab, um sicherzustellen, dass HDCP eingeschaltet ist.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-287">Periodically, the application polls the driver to make sure HDCP is on.</span></span>
4.  <span data-ttu-id="9e1cc-288">Wenn die Wiedergabe beendet ist, wird HDCP von der Anwendung deaktiviert.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-288">When playback is complete, the application turns off HDCP.</span></span>

### <a name="setting-the-srm"></a><span data-ttu-id="9e1cc-289">Festlegen des SRM</span><span class="sxs-lookup"><span data-stu-id="9e1cc-289">Setting the SRM</span></span>

<span data-ttu-id="9e1cc-290">Führen Sie die folgenden Schritte aus, um den SRM festzulegen.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-290">To set the SRM, perform the following steps.</span></span>

1.  <span data-ttu-id="9e1cc-291">Initialisieren Sie eine [**OPM- \_ festgelegte \_ HDCP- \_ SRM- \_ Parameter**](/windows/desktop/api/opmapi/ns-opmapi-opm_set_hdcp_srm_parameters) Struktur mit der SRM-Versionsnummer.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-291">Initialize an [**OPM\_SET\_HDCP\_SRM\_PARAMETERS**](/windows/desktop/api/opmapi/ns-opmapi-opm_set_hdcp_srm_parameters) structure with the SRM version number.</span></span>
2.  <span data-ttu-id="9e1cc-292">Speichern Sie den SRM in einer Variablen.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-292">Store the SRM in a variable.</span></span>
3.  <span data-ttu-id="9e1cc-293">Senden Sie einen [**OPM \_ Set \_ HDCP \_ SRM**](opm-set-hdcp-srm.md) -Befehl an die Videoausgabe.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-293">Send an [**OPM\_SET\_HDCP\_SRM**](opm-set-hdcp-srm.md) command to the video output.</span></span> <span data-ttu-id="9e1cc-294">Verwenden Sie das unter [Senden von OPM-Befehlen](#sending-opm-commands)beschriebene Verfahren.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-294">Use the procedure described in [Sending OPM Commands](#sending-opm-commands).</span></span>
    -   <span data-ttu-id="9e1cc-295">Der **abparameters** -Member der [**OPM- \_ configure \_ Parameters**](/windows/desktop/api/opmapi/ns-opmapi-opm_configure_parameters) -Struktur enthält die [**OPM- \_ festgelegte \_ HDCP-SRM- \_ \_ Parameter**](/windows/desktop/api/opmapi/ns-opmapi-opm_set_hdcp_srm_parameters) Struktur.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-295">The **abParameters** member of the [**OPM\_CONFIGURE\_PARAMETERS**](/windows/desktop/api/opmapi/ns-opmapi-opm_configure_parameters) structure contains the [**OPM\_SET\_HDCP\_SRM\_PARAMETERS**](/windows/desktop/api/opmapi/ns-opmapi-opm_set_hdcp_srm_parameters) structure.</span></span>
    -   <span data-ttu-id="9e1cc-296">Der *pbadditionalparameters* -Parameter der [**IOPMVideoOutput:: Configure**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-configure) -Methode verweist auf die Variable, die das SRM enthält.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-296">The *pbAdditionalParameters* parameter of the [**IOPMVideoOutput::Configure**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-configure) method points to the variable that contains the SRM.</span></span>
4.  <span data-ttu-id="9e1cc-297">Hiermit wird eine OPM-Anforderung zum Status der [**\_ \_ aktuellen \_ HDCP- \_ SRM- \_ Version**](opm-get-current-hdcp-srm-version.md) an die Videoausgabe gesendet.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-297">Send an [**OPM\_GET\_CURRENT\_HDCP\_SRM\_VERSION**](opm-get-current-hdcp-srm-version.md) status request to the video output.</span></span> <span data-ttu-id="9e1cc-298">Verwenden Sie das unter [Senden von OPM-Status Anforderungen](#sending-opm-status-requests)beschriebene Verfahren.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-298">Use the procedure described in [Sending OPM Status Requests](#sending-opm-status-requests).</span></span> <span data-ttu-id="9e1cc-299">Diese Status Anforderung enthält keine Eingabedaten, sodass der Inhalt des **abparameters** -Members der [**OPM-Struktur \_ get \_ Info \_ Parameters**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_get_info_parameters) nicht definiert ist.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-299">This status request has no input data, so the contents of the **abParameters** member of the [**OPM\_GET\_INFO\_PARAMETERS**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_get_info_parameters) structure are undefined.</span></span>
5.  <span data-ttu-id="9e1cc-300">Wenn die [**IOPMVideoOutput:: GetInformation**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-getinformation) -Methode zurückgegeben wird, enthält das **abrequestedinformation** -Array in der von [**OPM \_ angeforderten \_ Informations**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) Struktur eine [**OPM- \_ Standard \_ Informations**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) Struktur.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-300">When the [**IOPMVideoOutput::GetInformation**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-getinformation) method returns, the **abRequestedInformation** array in the [**OPM\_REQUESTED\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) structure contains an [**OPM\_STANDARD\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) structure.</span></span> <span data-ttu-id="9e1cc-301">Der **ulinformation** -Member dieser Struktur enthält die Versionsnummer des aktuellen SRM.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-301">The **ulInformation** member of this structure contains the version number of the current SRM.</span></span> <span data-ttu-id="9e1cc-302">Dieser Wert muss mit dem Wert aus Schritt 2 übereinstimmen.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-302">This value must equal the value from step 2.</span></span>

### <a name="enabling-hdcp"></a><span data-ttu-id="9e1cc-303">Aktivieren von HDCP</span><span class="sxs-lookup"><span data-stu-id="9e1cc-303">Enabling HDCP</span></span>

<span data-ttu-id="9e1cc-304">Führen Sie die folgenden Schritte aus, um HDCP zu aktivieren.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-304">To enable HDCP, perform the following steps.</span></span>

1.  <span data-ttu-id="9e1cc-305">Initialisieren Sie eine OPM-Struktur vom Typ " [**\_ \_ Schutz \_ Ebenen- \_ Parameter festlegen**](/windows/desktop/api/opmapi/ns-opmapi-opm_set_protection_level_parameters) " mit den folgenden Werten:</span><span class="sxs-lookup"><span data-stu-id="9e1cc-305">Initialize an [**OPM\_SET\_PROTECTION\_LEVEL\_PARAMETERS**](/windows/desktop/api/opmapi/ns-opmapi-opm_set_protection_level_parameters) structure with the following values:</span></span>
    -   <span data-ttu-id="9e1cc-306">**ulschutztyp**  =  **OPM \_ \_Schutztyp \_ HDCP**</span><span class="sxs-lookup"><span data-stu-id="9e1cc-306">**ulProtectionType** = **OPM\_PROTECTION\_TYPE\_HDCP**</span></span>
    -   <span data-ttu-id="9e1cc-307">**ulschutzlevel**  =  **OPM \_ HDCP \_ auf**</span><span class="sxs-lookup"><span data-stu-id="9e1cc-307">**ulProtectionLevel** = **OPM\_HDCP\_ON**</span></span>
    -   <span data-ttu-id="9e1cc-308">**Reserviert** = 0</span><span class="sxs-lookup"><span data-stu-id="9e1cc-308">**Reserved** = 0</span></span>
    -   <span data-ttu-id="9e1cc-309">**"Reserved2"** = 0</span><span class="sxs-lookup"><span data-stu-id="9e1cc-309">**Reserved2** = 0</span></span>
2.  <span data-ttu-id="9e1cc-310">Senden Sie einen OPM-Befehl zum [**\_ Festlegen der \_ Schutz \_ Ebene**](opm-set-protection-level.md) .</span><span class="sxs-lookup"><span data-stu-id="9e1cc-310">Send an [**OPM\_SET\_PROTECTION\_LEVEL**](opm-set-protection-level.md) command.</span></span> <span data-ttu-id="9e1cc-311">Bei den Eingabedaten im **abparameter** -Array handelt es sich um die OPM-Struktur zum [**\_ Festlegen der \_ Schutz \_ Ebenen \_**](/windows/desktop/api/opmapi/ns-opmapi-opm_set_protection_level_parameters) .</span><span class="sxs-lookup"><span data-stu-id="9e1cc-311">The input data in the **abParameters** array is the [**OPM\_SET\_PROTECTION\_LEVEL\_PARAMETERS**](/windows/desktop/api/opmapi/ns-opmapi-opm_set_protection_level_parameters) structure.</span></span>
3.  <span data-ttu-id="9e1cc-312">Senden Sie eine OPM-Anforderung zum Status der [**\_ \_ virtuellen \_ Schutz \_ Ebene**](opm-get-virtual-protection-level.md) , um zu überprüfen, ob HDCP aktiviert ist.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-312">Send an [**OPM\_GET\_VIRTUAL\_PROTECTION\_LEVEL**](opm-get-virtual-protection-level.md) status request to check whether HDCP is enabled.</span></span> <span data-ttu-id="9e1cc-313">Die ersten 4 Bytes des **abparameters** -Elements der [**OPM-Struktur \_ get \_ Info \_ Parameters**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_get_info_parameters) enthalten den Wert **OPM \_ Protection \_ Type \_ HDCP**.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-313">The first 4 bytes of the **abParameters** member of the [**OPM\_GET\_INFO\_PARAMETERS**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_get_info_parameters) structure contain the value **OPM\_PROTECTION\_TYPE\_HDCP**.</span></span>

<span data-ttu-id="9e1cc-314">Wenn die [**GetInformation**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-getinformation) -Methode zurückgegeben wird, enthält das **abrequestedinformation** -Array in der von [**OPM \_ angeforderten \_ Informations**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) Struktur eine [**OPM- \_ Standard \_ Informations**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) Struktur.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-314">When the [**GetInformation**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-getinformation) method returns, the **abRequestedInformation** array in the [**OPM\_REQUESTED\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) structure contains an [**OPM\_STANDARD\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) structure.</span></span> <span data-ttu-id="9e1cc-315">Der **ulinformation** -Member dieser Struktur enthält einen Wert aus der Enumeration der [**OPM- \_ HDCP- \_ Schutz \_ Ebene**](/windows/desktop/api/opmapi/ne-opmapi-opm_hdcp_protection_level) .</span><span class="sxs-lookup"><span data-stu-id="9e1cc-315">The **ulInformation** member of this structure contains a value from the [**OPM\_HDCP\_PROTECTION\_LEVEL**](/windows/desktop/api/opmapi/ne-opmapi-opm_hdcp_protection_level) enumeration.</span></span> <span data-ttu-id="9e1cc-316">Wenn der Wert **OPM \_ HDCP \_ on** ist, bedeutet dies, dass HDCP aktiviert ist.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-316">If the value equals **OPM\_HDCP\_ON**, it means HDCP is enabled.</span></span> <span data-ttu-id="9e1cc-317">Wiederholen Sie andernfalls die Schritte 1 – 2, bis HDCP aktiviert ist, andernfalls tritt ein Fehler auf.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-317">Otherwise, repeat steps 1–2 until HDCP is enabled, or an error occurs.</span></span> <span data-ttu-id="9e1cc-318">(Denken Sie daran, die Sequenznummer zu erhöhen und jedes Mal eine neue Zufallszahl zu generieren.)</span><span class="sxs-lookup"><span data-stu-id="9e1cc-318">(Remember to increment the sequence number and generate a new random number each time.)</span></span>

<span data-ttu-id="9e1cc-319">Es dauert in der Regel zwischen 100 und 200 Millisekunden, um HDCP zu aktivieren, aber es kann länger dauern.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-319">It usually takes between 100 and 200 milliseconds to enable HDCP, but it can take longer.</span></span> <span data-ttu-id="9e1cc-320">Gehen Sie nicht davon aus, dass HDCP aktiviert ist, bis Sie es überprüft haben.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-320">Do not assume that HDCP is enabled until you have verified it.</span></span>

<span data-ttu-id="9e1cc-321">Deaktivieren Sie HDCP, wenn die Anwendung die Wiedergabe geschützter Inhalte beendet hat.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-321">When the application finishes playing protected content, turn off HDCP.</span></span> <span data-ttu-id="9e1cc-322">Die Schritte sind identisch mit dem Aktivieren von HDCP, aber in Schritt 1 Legen Sie **ulschutzlevel** auf **OPM \_ HDCP \_ Off** fest.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-322">The steps are the same as for enabling HDCP, but in step 1, set **ulProtectionLevel** to **OPM\_HDCP\_OFF**.</span></span>

> [!Note]  
> <span data-ttu-id="9e1cc-323">Aktivieren Sie HDCP nicht, wenn der Verbindungstyp **OPM- \_ Connector- \_ Typ \_ Display Port \_ Embedded** ist.</span><span class="sxs-lookup"><span data-stu-id="9e1cc-323">Do not enable HDCP if the connector type is **OPM\_CONNECTOR\_TYPE\_DISPLAYPORT\_EMBEDDED**.</span></span> <span data-ttu-id="9e1cc-324">(Siehe [**OPM-Connector-Typflags**](opm-connector-type-flags.md).)</span><span class="sxs-lookup"><span data-stu-id="9e1cc-324">(See [**OPM Connector Type Flags**](opm-connector-type-flags.md).)</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="9e1cc-325">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="9e1cc-325">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="9e1cc-326">Output Protection Manager</span><span class="sxs-lookup"><span data-stu-id="9e1cc-326">Output Protection Manager</span></span>](output-protection-manager.md)
</dt> </dl>

 

 



