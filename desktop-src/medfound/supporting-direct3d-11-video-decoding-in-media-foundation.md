---
description: In diesem Thema wird beschrieben, wie Microsoft Direct3D 11 in einem Microsoft Media Foundation Decoder unterstützt wird.
ms.assetid: 656556AA-0266-4318-9D3C-AED75BD728F6
title: Unterstützung von Direct3D 11 Video Decodierung in Media Foundation
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 542f7244922dc7947f22e4d33027fdcac1962fe5
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/03/2021
ms.locfileid: "106355107"
---
# <a name="supporting-direct3d-11-video-decoding-in-media-foundation"></a><span data-ttu-id="25552-103">Unterstützung von Direct3D 11 Video Decodierung in Media Foundation</span><span class="sxs-lookup"><span data-stu-id="25552-103">Supporting Direct3D 11 Video Decoding in Media Foundation</span></span>

<span data-ttu-id="25552-104">In diesem Thema wird beschrieben, wie Microsoft Direct3D 11 in einem Microsoft Media Foundation Decoder unterstützt wird.</span><span class="sxs-lookup"><span data-stu-id="25552-104">This topic describes how to support Microsoft Direct3D 11 in a Microsoft Media Foundation decoder.</span></span> <span data-ttu-id="25552-105">Insbesondere wird die Kommunikation zwischen dem Decoder und dem Videorenderer beschrieben.</span><span class="sxs-lookup"><span data-stu-id="25552-105">Specifically, it describes the communication between the decoder and the video renderer.</span></span> <span data-ttu-id="25552-106">In diesem Thema wird nicht beschrieben, wie die Decodierungs Vorgänge implementiert werden.</span><span class="sxs-lookup"><span data-stu-id="25552-106">This topic does not describe how to implement the decoding operations.</span></span>

-   [<span data-ttu-id="25552-107">Übersicht</span><span class="sxs-lookup"><span data-stu-id="25552-107">Overview</span></span>](#overview)
-   [<span data-ttu-id="25552-108">Öffnen eines Geräte Handles</span><span class="sxs-lookup"><span data-stu-id="25552-108">Open a Device Handle</span></span>](#open-a-device-handle)
-   [<span data-ttu-id="25552-109">Suchen einer decoderkonfiguration</span><span class="sxs-lookup"><span data-stu-id="25552-109">Find a Decoder Configuration</span></span>](#find-a-decoder-configuration)
-   [<span data-ttu-id="25552-110">Fallback auf Software Decodierung</span><span class="sxs-lookup"><span data-stu-id="25552-110">Fallback to Software Decoding</span></span>](#fallback-to-software-decoding)
-   [<span data-ttu-id="25552-111">Zuordnen von nicht komprimierten Puffern</span><span class="sxs-lookup"><span data-stu-id="25552-111">Allocating Uncompressed Buffers</span></span>](#allocating-uncompressed-buffers)
-   [<span data-ttu-id="25552-112">Decodierung</span><span class="sxs-lookup"><span data-stu-id="25552-112">Decoding</span></span>](#supporting-direct3d-11-video-decoding-in-media-foundation)
-   [<span data-ttu-id="25552-113">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="25552-113">Related topics</span></span>](#related-topics)

## <a name="overview"></a><span data-ttu-id="25552-114">Übersicht</span><span class="sxs-lookup"><span data-stu-id="25552-114">Overview</span></span>

<span data-ttu-id="25552-115">Im restlichen Teil dieses Themas werden die folgenden Begriffe verwendet:</span><span class="sxs-lookup"><span data-stu-id="25552-115">In the remainder of this topic, the following terms are used:</span></span>

-   <span data-ttu-id="25552-116">**Software Decoder**.</span><span class="sxs-lookup"><span data-stu-id="25552-116">**Software decoder**.</span></span> <span data-ttu-id="25552-117">Der Software Decoder ist die Media Foundation Transformation (MFT), die komprimierte Videobeispiele empfängt und unkomprimierte Video Frames ausgibt.</span><span class="sxs-lookup"><span data-stu-id="25552-117">The software decoder is the Media Foundation transform (MFT) that receives compressed video samples and outputs uncompressed video frames.</span></span>
-   <span data-ttu-id="25552-118">**Decoder-Gerät**.</span><span class="sxs-lookup"><span data-stu-id="25552-118">**Decoder device**.</span></span> <span data-ttu-id="25552-119">Das Decoder-Gerät ist die Video Zugriffstaste und wird von dem Grafiktreiber implementiert.</span><span class="sxs-lookup"><span data-stu-id="25552-119">The decoder device is the video accelerator, and is implemented by the graphics driver.</span></span> <span data-ttu-id="25552-120">Das Decoder-Gerät führt beschleunigte Decodierungs Vorgänge aus.</span><span class="sxs-lookup"><span data-stu-id="25552-120">The decoder device performs accelerated decoding operations.</span></span>
-   <span data-ttu-id="25552-121">**Pipeline**.</span><span class="sxs-lookup"><span data-stu-id="25552-121">**Pipeline**.</span></span> <span data-ttu-id="25552-122">Die Pipeline hostet den Software Decoder und übermittelt Puffer an den und aus dem Software Decoder.</span><span class="sxs-lookup"><span data-stu-id="25552-122">The pipeline hosts the software decoder and delivers buffers to and from the software decoder.</span></span> <span data-ttu-id="25552-123">Abhängig von der Anwendung ist die Pipeline möglicherweise die [Medien Sitzung](media-session.md), der [Quell Leser](source-reader.md)oder der Anwendungscode, der die MFT direkt aufruft.</span><span class="sxs-lookup"><span data-stu-id="25552-123">Depending on the application, the pipeline might be the [Media Session](media-session.md), the [Source Reader](source-reader.md), or application code that directly calls into the MFT.</span></span>

<span data-ttu-id="25552-124">Um die Decodierung mit Direct3D 11 auszuführen, muss der Software Decoder über einen Zeiger auf ein Direct3D 11-Gerät verfügen.</span><span class="sxs-lookup"><span data-stu-id="25552-124">To perform decoding using Direct3D 11, the software decoder must have a pointer to a Direct3D 11 device.</span></span> <span data-ttu-id="25552-125">Das Gerät Direct3D 11 wird extern zum Software Decoder erstellt.</span><span class="sxs-lookup"><span data-stu-id="25552-125">The Direct3D 11 device is created externally to the software decoder.</span></span> <span data-ttu-id="25552-126">In einem [Medien Sitzungs](media-session.md) Szenario erstellt der Videorenderer das Gerät Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="25552-126">In a [Media Session](media-session.md) scenario, the video renderer creates the Direct3D 11 device.</span></span> <span data-ttu-id="25552-127">In einem [Quell Leser](source-reader.md) Szenario erstellt die Anwendung normalerweise das Gerät Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="25552-127">In a [Source Reader](source-reader.md) scenario, typically the application creates the Direct3D 11 device.</span></span>

<span data-ttu-id="25552-128">Der DXGI-Device Manager wird verwendet, um Direct3D 11 zwischen Komponenten gemeinsam zu nutzen.</span><span class="sxs-lookup"><span data-stu-id="25552-128">The DXGI Device Manager is used to share the Direct3D 11 between components.</span></span> <span data-ttu-id="25552-129">Der DXGI-Device Manager macht die [**IMF dxgidebug Manager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) -Schnittstelle verfügbar.</span><span class="sxs-lookup"><span data-stu-id="25552-129">The DXGI Device Manager exposes the [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) interface.</span></span> <span data-ttu-id="25552-130">Die Pipeline legt den **imfdxgidevicemanager** -Zeiger auf den Software Decoder fest, indem die [**MFT \_ Message \_ Set \_ D3D \_ Manager**](mft-message-set-d3d-manager.md) -Nachricht gesendet wird.</span><span class="sxs-lookup"><span data-stu-id="25552-130">The pipeline sets the **IMFDXGIDeviceManager** pointer on the software decoder by sending the [**MFT\_MESSAGE\_SET\_D3D\_MANAGER**](mft-message-set-d3d-manager.md) message.</span></span>

<span data-ttu-id="25552-131">Das folgende Diagramm zeigt die Beziehung zwischen dem Software Decoder, Direct3D 11 und der Pipeline.</span><span class="sxs-lookup"><span data-stu-id="25552-131">The following diagram shows the relation between the software decoder, the Direct3D 11, and the pipeline.</span></span>

![ein Diagramm, in dem der Software Decoder und der DXGI-Geräte-Manager angezeigt werden.](images/d3d11video01.png)

<span data-ttu-id="25552-133">Im folgenden finden Sie die grundlegenden Schritte, die ein Software Decoder ausführen muss, um Direct3D 11 in Media Foundation zu unterstützen:</span><span class="sxs-lookup"><span data-stu-id="25552-133">Here are the basic steps that a software decoder must perform to support Direct3D 11 in Media Foundation:</span></span>

1.  <span data-ttu-id="25552-134">Öffnen Sie ein Handle für das Gerät Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="25552-134">Open a handle to the Direct3D 11 device.</span></span>
2.  <span data-ttu-id="25552-135">Suchen Sie eine Decoder-Konfiguration.</span><span class="sxs-lookup"><span data-stu-id="25552-135">Find a decoder configuration.</span></span>
3.  <span data-ttu-id="25552-136">Nicht komprimierte Puffer zuordnen.</span><span class="sxs-lookup"><span data-stu-id="25552-136">Allocate uncompressed buffers.</span></span>
4.  <span data-ttu-id="25552-137">Decodieren von Frames.</span><span class="sxs-lookup"><span data-stu-id="25552-137">Decode frames.</span></span>

<span data-ttu-id="25552-138">Diese Schritte werden im weiteren Verlauf dieses Themas ausführlicher beschrieben.</span><span class="sxs-lookup"><span data-stu-id="25552-138">These steps are described in more detail in the remainder of this topic.</span></span>

## <a name="open-a-device-handle"></a><span data-ttu-id="25552-139">Öffnen eines Geräte Handles</span><span class="sxs-lookup"><span data-stu-id="25552-139">Open a Device Handle</span></span>

<span data-ttu-id="25552-140">Der Decoder-MFT verwendet den DXGI-Geräte-Manager, um ein Handle für das Direct3D 11-Gerät zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="25552-140">The decoder MFT uses the DXGI device manager to get a handle to the Direct3D 11 device.</span></span> <span data-ttu-id="25552-141">Führen Sie die folgenden Schritte aus, um das Geräte Handle zu öffnen:</span><span class="sxs-lookup"><span data-stu-id="25552-141">To open the device handle, perform the following steps:</span></span>

1.  <span data-ttu-id="25552-142">Der Decoder-MFT muss das Attribut [MF \_ sa \_ D3D11 \_ Aware](mf-sa-d3d11-aware.md) mit dem Wert **true** verfügbar machen.</span><span class="sxs-lookup"><span data-stu-id="25552-142">The decoder MFT must expose the [MF\_SA\_D3D11\_AWARE](mf-sa-d3d11-aware.md) attribute with the value **TRUE**.</span></span>
2.  <span data-ttu-id="25552-143">Das topologielader fragt dieses Attribut durch Aufrufen von [**imftransform:: GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes)ab.</span><span class="sxs-lookup"><span data-stu-id="25552-143">The Topology Loader queries this attribute by calling [**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes).</span></span> <span data-ttu-id="25552-144">Der Wert **true** gibt an, dass der MFT Direct3D 11 unterstützt.</span><span class="sxs-lookup"><span data-stu-id="25552-144">The value **TRUE** indicates that the MFT supports Direct3D 11.</span></span>
3.  <span data-ttu-id="25552-145">Das topologielader ruft [**imftransform::P rocess Message**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) mit der Meldung [**MFT \_ Message \_ Set \_ D3D \_ Manager**](mft-message-set-d3d-manager.md) auf.</span><span class="sxs-lookup"><span data-stu-id="25552-145">The Topology Loader calls [**IMFTransform::ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_SET\_D3D\_MANAGER**](mft-message-set-d3d-manager.md) message.</span></span> <span data-ttu-id="25552-146">Der *ulparam* -Parameter ist ein [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) -Zeiger auf den DXGI-Geräte-Manager.</span><span class="sxs-lookup"><span data-stu-id="25552-146">The *ulParam* parameter is an [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) pointer to the DXGI device manager.</span></span> <span data-ttu-id="25552-147">Fragen Sie diesen Zeiger nach der [**imbodxgidebug Manager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) -Schnittstelle ab.</span><span class="sxs-lookup"><span data-stu-id="25552-147">Query this pointer for the [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) interface.</span></span>
4.  <span data-ttu-id="25552-148">Wenn Sie [**imfdxgidebug Manager:: opentovicehandle**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-opendevicehandle) abrufen, erhalten Sie ein Handle für das Gerät Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="25552-148">Call [**IMFDXGIDeviceManager::OpenDeviceHandle**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-opendevicehandle) to get a handle to the Direct3D 11 device.</span></span>
5.  <span data-ttu-id="25552-149">Um einen Zeiger auf das Direct3D 11-Gerät abzurufen, nennen Sie [**imfdxgidevicemanager:: getvideoservice**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-getvideoservice).</span><span class="sxs-lookup"><span data-stu-id="25552-149">To get a pointer to the Direct3D 11 device, call [**IMFDXGIDeviceManager::GetVideoService**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-getvideoservice).</span></span> <span data-ttu-id="25552-150">Übergeben Sie das Geräte Handle und den Wert **IID \_ ID3D11Device**.</span><span class="sxs-lookup"><span data-stu-id="25552-150">Pass in the device handle and the value **IID\_ID3D11Device**.</span></span> <span data-ttu-id="25552-151">Die-Methode gibt einen Zeiger auf die [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) -Schnittstelle zurück.</span><span class="sxs-lookup"><span data-stu-id="25552-151">The method returns a pointer to the [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) interface.</span></span>
6.  <span data-ttu-id="25552-152">Zum Abrufen eines Zeigers auf die Video Zugriffstaste müssen Sie [**imfdxgidevicemanager:: getvideoservice**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-getvideoservice) erneut aufrufen.</span><span class="sxs-lookup"><span data-stu-id="25552-152">To get a pointer to the video accelerator, call [**IMFDXGIDeviceManager::GetVideoService**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-getvideoservice) again.</span></span> <span data-ttu-id="25552-153">Übergeben Sie dieses Mal das Geräte Handle und den Wert **IID \_ ID3D11VideoDevice**.</span><span class="sxs-lookup"><span data-stu-id="25552-153">This time, pass in the device handle and the value **IID\_ID3D11VideoDevice**.</span></span> <span data-ttu-id="25552-154">Die-Methode gibt einen Zeiger auf die [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) -Schnittstelle zurück.</span><span class="sxs-lookup"><span data-stu-id="25552-154">The method returns a pointer to the [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) interface.</span></span>
7.  <span data-ttu-id="25552-155">Aufrufen von [**ID3D11Device:: getimmediatecontext**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-getimmediatecontext) zum Abrufen eines [**Verknüpfung id3d11devicecontext aus**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) -Zeigers.</span><span class="sxs-lookup"><span data-stu-id="25552-155">Call [**ID3D11Device::GetImmediateContext**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-getimmediatecontext) to get an [**ID3D11DeviceContext**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) pointer.</span></span>
8.  <span data-ttu-id="25552-156">Ruft [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) für den [**Verknüpfung id3d11devicecontext aus**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) auf, um einen [**ID3D11VideoContext**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videocontext) -Zeiger zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="25552-156">Call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) on the [**ID3D11DeviceContext**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) to get an [**ID3D11VideoContext**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videocontext) pointer.</span></span>
9.  <span data-ttu-id="25552-157">Es wird empfohlen, dass Sie den Multithread-Schutz für den Gerätekontext verwenden, um Deadlock-Probleme zu vermeiden, die manchmal auftreten können, wenn Sie [**ID3D11VideoContext:: getdecoderbuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) oder [**ID3D11VideoContext:: releasedecoderbuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-releasedecoderbuffer)aufrufen.</span><span class="sxs-lookup"><span data-stu-id="25552-157">It is recommended that you use multi-thread protection on the device context to prevent deadlock issues that can sometimes happen when you call [**ID3D11VideoContext::GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) or [**ID3D11VideoContext::ReleaseDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-releasedecoderbuffer).</span></span> <span data-ttu-id="25552-158">Um den Multithread-Schutz festzulegen, müssen Sie zuerst [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) auf [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) abrufen, um einen [**ID3D10Multithread**](/windows/win32/api/d3d10/nn-d3d10-id3d10multithread) -Zeiger zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="25552-158">To set multi-thread protection, first call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) on [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) to get an [**ID3D10Multithread**](/windows/win32/api/d3d10/nn-d3d10-id3d10multithread) pointer.</span></span> <span data-ttu-id="25552-159">Dann rufe ich [**ID3D10Multithread:: setmultithreadprotected**](/windows/win32/api/d3d10/nf-d3d10-id3d10multithread-setmultithreadprotected)auf und übergebe **true** für *bmtprotect*.</span><span class="sxs-lookup"><span data-stu-id="25552-159">Then call [**ID3D10Multithread::SetMultithreadProtected**](/windows/win32/api/d3d10/nf-d3d10-id3d10multithread-setmultithreadprotected), passing in **true** for *bMTProtect*.</span></span>

## <a name="find-a-decoder-configuration"></a><span data-ttu-id="25552-160">Suchen einer decoderkonfiguration</span><span class="sxs-lookup"><span data-stu-id="25552-160">Find a Decoder Configuration</span></span>

<span data-ttu-id="25552-161">Um die Decodierung auszuführen, muss der Software Decoder eine kompatible Konfiguration finden, die vom Decoder-Gerät unterstützt wird, einschließlich eines renderzielformats.</span><span class="sxs-lookup"><span data-stu-id="25552-161">To perform decoding, the software decoder must find a compatible configuration that is supported by the decoder device, including a render-target format.</span></span> <span data-ttu-id="25552-162">Dieser Schritt erfolgt in der [**IMF Transform::**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) \*-Methode wie folgt.</span><span class="sxs-lookup"><span data-stu-id="25552-162">This step occurs inside the [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) method, as follows.</span></span>

1.  <span data-ttu-id="25552-163">Überprüfen Sie den Eingabe Medientyp.</span><span class="sxs-lookup"><span data-stu-id="25552-163">Validate the input media type.</span></span> <span data-ttu-id="25552-164">Wenn der Typ abgelehnt wird, überspringen Sie die restlichen Schritte, und geben Sie einen Fehlercode zurück.</span><span class="sxs-lookup"><span data-stu-id="25552-164">If the type is rejected, skip the remaining steps and return an error code.</span></span>
2.  <span data-ttu-id="25552-165">Aufrufen von [**ID3D11VideoDevice:: getvideodecoderprofilecount**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderprofilecount) , um die Anzahl unterstützter Profile zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="25552-165">Call [**ID3D11VideoDevice::GetVideoDecoderProfileCount**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderprofilecount) to get the number of supported profiles.</span></span>
3.  <span data-ttu-id="25552-166">Aufrufen von [**ID3D11VideoDevice:: getvideodecoderprofile**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderprofile) zum Auflisten der Profile und Abrufen der Profil-GUIDs.</span><span class="sxs-lookup"><span data-stu-id="25552-166">Call [**ID3D11VideoDevice::GetVideoDecoderProfile**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderprofile) to enumerate the profiles and get the profile GUIDs.</span></span>
4.  <span data-ttu-id="25552-167">Suchen Sie nach einer Profil-GUID, die dem Videoformat und den Funktionen des Software Decoders entspricht.</span><span class="sxs-lookup"><span data-stu-id="25552-167">Look for a profile GUID that matches the video format and the capabilities of the software decoder.</span></span> <span data-ttu-id="25552-168">Ein MPEG-2-Decoder würde z. b. nach **D3D11 \_ Decoder \_ profile \_ MPEG2 \_ mucomp**,**D3D11 \_ Decoder \_ profile \_ MPEG2 \_ IDCT** und **D3D11 \_ Decoder \_ profile \_ MPEG2 \_ VLD** suchen.</span><span class="sxs-lookup"><span data-stu-id="25552-168">For example, an MPEG-2 decoder would look for **D3D11\_DECODER\_PROFILE\_MPEG2\_MOCOMP**,**D3D11\_DECODER\_PROFILE\_MPEG2\_IDCT**, and **D3D11\_DECODER\_PROFILE\_MPEG2\_VLD**.</span></span>
5.  <span data-ttu-id="25552-169">Wenn eine passende decoderguid gefunden wird, überprüfen Sie das Ausgabeformat, indem Sie die [**ID3D11VideoDevice:: checkvideodecoderformat**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-checkvideodecoderformat) -Methode aufrufen.</span><span class="sxs-lookup"><span data-stu-id="25552-169">If a suitable decoder GUID is found, check the output format by calling the [**ID3D11VideoDevice::CheckVideoDecoderFormat**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-checkvideodecoderformat) method.</span></span> <span data-ttu-id="25552-170">Übergeben Sie die decoderguid und einen **DXGI- \_ Format** Wert, der das renderzielformat angibt.</span><span class="sxs-lookup"><span data-stu-id="25552-170">Pass in the decoder GUID and a **DXGI\_FORMAT** value that specifies the render-target format.</span></span>
6.  <span data-ttu-id="25552-171">Suchen Sie als nächstes eine passende Konfiguration für den Decoder.</span><span class="sxs-lookup"><span data-stu-id="25552-171">Next, find a suitable configuration for the decoder.</span></span>
    1.  <span data-ttu-id="25552-172">Aufrufen von [**ID3D11VideoDevice:: getvideodecoderconfigcount**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderconfigcount) zum Abrufen der Anzahl von Decoder-Konfigurationen.</span><span class="sxs-lookup"><span data-stu-id="25552-172">Call [**ID3D11VideoDevice::GetVideoDecoderConfigCount**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderconfigcount) to get the number of decoder configurations.</span></span> <span data-ttu-id="25552-173">Übergeben Sie dieselbe Decoder-Geräte-GUID, zusammen mit einer [**D3D11- \_ Video- \_ decoderstruktur \_**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_decoder_desc) , die das vorgeschlagene renderzielformat beschreibt.</span><span class="sxs-lookup"><span data-stu-id="25552-173">Pass in the same decoder device GUID, along with a [**D3D11\_VIDEO\_DECODER\_DESC**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_decoder_desc) structure that describes the proposed render-target format.</span></span>
    2.  <span data-ttu-id="25552-174">Aufrufen von [**ID3D11VideoDevice:: getvideodecoderconfig zum Auflisten der decoderkonfigurationen**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderconfig) .</span><span class="sxs-lookup"><span data-stu-id="25552-174">Call [**ID3D11VideoDevice::GetVideoDecoderConfig**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderconfig) to enumerate the decoder configurations.</span></span>

<span data-ttu-id="25552-175">Geben Sie in der [**imftransform:: getoutputavailabletype**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) -Methode ein unkomprimiertes Videoformat basierend auf dem vorgeschlagenen renderzielformat zurück.</span><span class="sxs-lookup"><span data-stu-id="25552-175">In the [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) method, return an uncompressed video format based on the proposed render-target format.</span></span>

<span data-ttu-id="25552-176">Überprüfen Sie in der [**IMF Transform:: setoutputtype**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) -Methode den Medientyp auf das renderzielformat.</span><span class="sxs-lookup"><span data-stu-id="25552-176">In the [**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) method, check the media type against the render target format.</span></span>

## <a name="fallback-to-software-decoding"></a><span data-ttu-id="25552-177">Fallback auf Software Decodierung</span><span class="sxs-lookup"><span data-stu-id="25552-177">Fallback to Software Decoding</span></span>

<span data-ttu-id="25552-178">Die MFT kann möglicherweise keine Konfiguration finden.</span><span class="sxs-lookup"><span data-stu-id="25552-178">The MFT might be unable to find a configuration.</span></span> <span data-ttu-id="25552-179">Der Grafiktreiber unterstützt z. b. möglicherweise nicht die richtigen Funktionen.</span><span class="sxs-lookup"><span data-stu-id="25552-179">For example, the graphics driver might not support the right capabilities.</span></span> <span data-ttu-id="25552-180">In diesem Fall muss der MFT wie folgt auf die Software Decodierung zurückgreifen.</span><span class="sxs-lookup"><span data-stu-id="25552-180">In that case, the MFT must fall back to software decoding, as follows.</span></span>

1.  <span data-ttu-id="25552-181">Die [**setinputtype**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) -Methode und die [**setoutputtype**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) -Methode sollten sowohl den **\_ \_ nicht unterstützten MF- \_ D3D- \_ Typ** zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="25552-181">The [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) and [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) methods should both return **MF\_E\_UNSUPPORTED\_D3D\_TYPE**.</span></span>
2.  <span data-ttu-id="25552-182">Als Antwort sendet das topologielader die [**MFT \_ Message \_ Set \_ D3D \_ Manager**](mft-message-set-d3d-manager.md) -Nachricht mit dem Wert **null** für den *ulparam* -Parameter.</span><span class="sxs-lookup"><span data-stu-id="25552-182">In response, the Topology Loader will send the [**MFT\_MESSAGE\_SET\_D3D\_MANAGER**](mft-message-set-d3d-manager.md) message with the value **NULL** for the *ulParam* parameter.</span></span>
3.  <span data-ttu-id="25552-183">Der MFT gibt seinen Zeiger auf die [**imfdxgidebug Manager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) -Schnittstelle frei.</span><span class="sxs-lookup"><span data-stu-id="25552-183">The MFT releases its pointer to the [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) interface.</span></span>
4.  <span data-ttu-id="25552-184">Der topologielader verhandelt den Medientyp erneut.</span><span class="sxs-lookup"><span data-stu-id="25552-184">The Topology Loader renegotiates the media type.</span></span>

<span data-ttu-id="25552-185">An diesem Punkt kann der MFT Software Decodierung verwenden.</span><span class="sxs-lookup"><span data-stu-id="25552-185">At this point, the MFT can use software decoding.</span></span>

## <a name="allocating-uncompressed-buffers"></a><span data-ttu-id="25552-186">Zuordnen von nicht komprimierten Puffern</span><span class="sxs-lookup"><span data-stu-id="25552-186">Allocating Uncompressed Buffers</span></span>

<span data-ttu-id="25552-187">Der Decoder ist dafür verantwortlich, Direct3D 11-Texturen zuzuordnen, die als unkomprimierte Video Puffer verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="25552-187">The decoder is responsible for allocating Direct3D 11 textures to use as uncompressed video buffers.</span></span> <span data-ttu-id="25552-188">Das Attribut für die [ \_ \_ minimale \_ Ausgabe \_ Stichproben \_ Anzahl der MF-Ausgabe](mf-sa-minimum-output-sample-count.md) in den ausgabestreamattributen (siehe [**imftransform:: getoutputstreamtribute**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes)) wird verwendet, um zu bestimmen, wie viele Oberflächen der Decoder dem Videorenderer zuweisen soll, der für Deinterlacing verwendet werden soll.</span><span class="sxs-lookup"><span data-stu-id="25552-188">The [MF\_SA\_MINIMUM\_OUTPUT\_SAMPLE\_COUNT](mf-sa-minimum-output-sample-count.md) attribute in the output stream attributes (see [**IMFTransform::GetOutputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes)) is used to determine how many surfaces the decoder should allocate for the video renderer to use for deinterlacing .</span></span> <span data-ttu-id="25552-189">Ein Decoder sollte diesen Wert verwenden, um ihn für einige sinnvolle obere und untere Grenzwerte zu verwenden, z. b. 3-32.</span><span class="sxs-lookup"><span data-stu-id="25552-189">A decoder should use this value bounding it for some reasonable upper and lower limits, for example 3-32.</span></span> <span data-ttu-id="25552-190">Informationen zu progressivem Inhalt finden Sie unter die [ \_ \_ minimale \_ Anzahl von Ausgabe \_ Beispielen \_ \_ für MF SA](mf-sa-minimum-output-sample-count-progressive.md).</span><span class="sxs-lookup"><span data-stu-id="25552-190">For progressive content see [MF\_SA\_MINIMUM\_OUTPUT\_SAMPLE\_COUNT\_PROGRESSIVE](mf-sa-minimum-output-sample-count-progressive.md).</span></span>

<span data-ttu-id="25552-191">Legen Sie in der [**imftransform:: getoutputstreaminfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) -Methode den **MFT- \_ Ausgabestream \_ \_ enthält \_** ein beispielflag in der [**MFT- \_ Ausgabestream- \_ \_ Informations**](/windows/win32/api/mftransform/ne-mftransform-_mft_output_stream_info_flags) Struktur fest.</span><span class="sxs-lookup"><span data-stu-id="25552-191">In the [**IMFTransform::GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method, set the **MFT\_OUTPUT\_STREAM\_PROVIDES\_SAMPLES** flag in the [**MFT\_OUTPUT\_STREAM\_INFO**](/windows/win32/api/mftransform/ne-mftransform-_mft_output_stream_info_flags) structure.</span></span> <span data-ttu-id="25552-192">Dieses Flag benachrichtigt die Medien Sitzung, dass der MFT seine eigenen Ausgabe Beispiele zuweist.</span><span class="sxs-lookup"><span data-stu-id="25552-192">This flag notifies the Media Session that the MFT allocates its own output samples.</span></span> <span data-ttu-id="25552-193">Zum Zuordnen der Ausgabe Beispiele führt der MFT die folgenden Schritte aus:</span><span class="sxs-lookup"><span data-stu-id="25552-193">To allocate the output samples, the MFT performs the following steps:</span></span>

1.  <span data-ttu-id="25552-194">Erstellen Sie ein 2D-Textur Array durch Aufrufen von [**ID3D11Device:: CreateTexture2D**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createtexture2d).</span><span class="sxs-lookup"><span data-stu-id="25552-194">Create a 2D texture array by calling [**ID3D11Device::CreateTexture2D**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createtexture2d).</span></span> <span data-ttu-id="25552-195">Legen Sie **arraySize** in der [**D3D11 \_ TEXTURE2D \_**](/windows/win32/api/d3d11/ns-d3d11-d3d11_texture2d_desc) -Struktur auf die Anzahl der vom Decoder benötigten Oberflächen fest.</span><span class="sxs-lookup"><span data-stu-id="25552-195">In the [**D3D11\_TEXTURE2D\_DESC**](/windows/win32/api/d3d11/ns-d3d11-d3d11_texture2d_desc) structure, set **ArraySize** equal to the number of surfaces that the decoder needs.</span></span> <span data-ttu-id="25552-196">Dies schließt Folgendes ein:</span><span class="sxs-lookup"><span data-stu-id="25552-196">This includes:</span></span>
    -   <span data-ttu-id="25552-197">Oberflächen für Bezugs Frames.</span><span class="sxs-lookup"><span data-stu-id="25552-197">Surfaces for reference frames.</span></span>
    -   <span data-ttu-id="25552-198">Oberflächen für Deinterlacing (drei Oberflächen).</span><span class="sxs-lookup"><span data-stu-id="25552-198">Surfaces for deinterlacing (three surfaces).</span></span>
    -   <span data-ttu-id="25552-199">Oberflächen, die der Decoder für die Pufferung benötigt.</span><span class="sxs-lookup"><span data-stu-id="25552-199">Surfaces that the decoder needs for buffering.</span></span>

    <span data-ttu-id="25552-200">Die **Bindungsflags (bindflags**) müssen das **D3D11 \_ Bind- \_ decoderflag** und alle Bindungsflags enthalten, die über das [MF \_ sa \_ D3D11 \_ bindflags](mf-sa-d3d11-bindflags.md) -Attribut in den ausgabestreamattributen festgelegt wurden.</span><span class="sxs-lookup"><span data-stu-id="25552-200">The binding flags (**BindFlags**) should include the **D3D11\_BIND\_DECODER** flag and any bind flags set through the [MF\_SA\_D3D11\_BINDFLAGS](mf-sa-d3d11-bindflags.md) attribute in the output stream attributes.</span></span>
2.  <span data-ttu-id="25552-201">Rufen Sie für jede Oberfläche im Textur Array [**ID3D11VideoDevice:: createvideodecoderoutputview**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoderoutputview) auf, um eine Video Decoder-Ausgabe Ansicht zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="25552-201">For each surface in the texture array, call [**ID3D11VideoDevice::CreateVideoDecoderOutputView**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoderoutputview) to create a video decoder output view.</span></span> <span data-ttu-id="25552-202">Beim Decodieren werden diese Ausgabe Sichten an die [**ID3D11VideoContext::D ecoderbeginframe**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe) -Methode übermittelt.</span><span class="sxs-lookup"><span data-stu-id="25552-202">During decoding, these output views will be passed to the [**ID3D11VideoContext::DecoderBeginFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe) method.</span></span>
3.  <span data-ttu-id="25552-203">Erstellen Sie für jede Oberfläche im Textur Array ein Medien Beispiel wie folgt:</span><span class="sxs-lookup"><span data-stu-id="25552-203">For each surface in the texture array, create a media sample as follows:</span></span>
    1.  <span data-ttu-id="25552-204">Erstellen Sie einen DXGI-Medien Puffer, indem Sie die [**mfcreatedxgisurfacebuffer**](/windows/desktop/api/mfapi/nf-mfapi-mfcreatedxgisurfacebuffer) -Funktion aufrufen.</span><span class="sxs-lookup"><span data-stu-id="25552-204">Create a DXGI media buffer by calling the [**MFCreateDXGISurfaceBuffer**](/windows/desktop/api/mfapi/nf-mfapi-mfcreatedxgisurfacebuffer) function.</span></span> <span data-ttu-id="25552-205">Übergeben Sie den [**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d) -Zeiger und den Offset für jedes Element im Textur Array.</span><span class="sxs-lookup"><span data-stu-id="25552-205">Pass in the [**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d) pointer and the offset for each element in the texture array.</span></span> <span data-ttu-id="25552-206">Die-Funktion gibt einen [**imfmediabuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediabuffer) -Zeiger zurück.</span><span class="sxs-lookup"><span data-stu-id="25552-206">The function returns an [**IMFMediaBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediabuffer) pointer.</span></span>
    2.  <span data-ttu-id="25552-207">Erstellen Sie ein leeres Medien Beispiel, indem Sie die [**mfcreatevideosamplefromsurface**](/windows/desktop/api/evr/nc-evr-mfcreatevideosamplefromsurface) -Funktion aufrufen.</span><span class="sxs-lookup"><span data-stu-id="25552-207">Create an empty media sample by calling the [**MFCreateVideoSampleFromSurface**](/windows/desktop/api/evr/nc-evr-mfcreatevideosamplefromsurface) function.</span></span> <span data-ttu-id="25552-208">Legen Sie den Parameter " *punksurface* " auf **null** fest.</span><span class="sxs-lookup"><span data-stu-id="25552-208">Set the *pUnkSurface* parameter equal to **NULL**.</span></span> <span data-ttu-id="25552-209">Die-Funktion gibt einen [**IMF Sample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) -Zeiger zurück.</span><span class="sxs-lookup"><span data-stu-id="25552-209">The function returns an [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) pointer.</span></span>
    3.  <span data-ttu-id="25552-210">Zum Hinzufügen des Medien Puffers zum Beispiel wird [**imfsample:: addbuffer**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-addbuffer) aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="25552-210">Call [**IMFSample::AddBuffer**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-addbuffer) to add the media buffer to the sample.</span></span>

<span data-ttu-id="25552-211">Sie sollten alle Texturen, die Sie gleichzeitig erstellen, zerstören, anstatt nur einige zu zerstören und die Erinnerung weiterhin zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="25552-211">You should destroy all the textures you create at the same time, rather then destroying only some and continuing to use the reminder.</span></span>

## <a name="decoding"></a><span data-ttu-id="25552-212">Decodierung</span><span class="sxs-lookup"><span data-stu-id="25552-212">Decoding</span></span>

<span data-ttu-id="25552-213">Um das Decoder-Gerät zu erstellen, rufen Sie [**ID3D11VideoDevice:: createvideodecoder**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoder)auf.</span><span class="sxs-lookup"><span data-stu-id="25552-213">To create the decoder device, call [**ID3D11VideoDevice::CreateVideoDecoder**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoder).</span></span> <span data-ttu-id="25552-214">Die-Methode gibt einen Zeiger auf die [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder) -Schnittstelle zurück.</span><span class="sxs-lookup"><span data-stu-id="25552-214">The method returns a pointer to the [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder) interface.</span></span> <span data-ttu-id="25552-215">Die Decodierung sollte in der [**IMF Transform::P rocess Output**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) -Methode erfolgen.</span><span class="sxs-lookup"><span data-stu-id="25552-215">Decoding should occur inside the [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method.</span></span> <span data-ttu-id="25552-216">Bei jedem Frame wird [**imfdxgiabvicemanager:: testdevice**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-testdevice) aufgerufen, um die Verfügbarkeit des DXGI zu testen.</span><span class="sxs-lookup"><span data-stu-id="25552-216">On each frame, call [**IMFDXGIDeviceManager::TestDevice**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-testdevice) to test the availability of the DXGI.</span></span> <span data-ttu-id="25552-217">Wenn sich das Gerät geändert hat, muss der Software Decoder das Decoder-Gerät wie folgt neu erstellen:</span><span class="sxs-lookup"><span data-stu-id="25552-217">If the device has changed, the software decoder must recreate the decoder device, as follows:</span></span>

1.  <span data-ttu-id="25552-218">Schließen Sie das Geräte handle, indem Sie [**imfdxgidevicemanager:: closedevicehandle**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-closedevicehandle)aufrufen.</span><span class="sxs-lookup"><span data-stu-id="25552-218">Close the device handle by calling [**IMFDXGIDeviceManager::CloseDeviceHandle**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-closedevicehandle).</span></span>
2.  <span data-ttu-id="25552-219">Gibt alle dem früheren Direct3D 11-Gerät zugeordneten Ressourcen frei, einschließlich der [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder)-, [**ID3D11VideoContext**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videocontext)-, [**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d)-und [**ID3D11VideoDecoderOutputView**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoderoutputview) -Schnittstellen.</span><span class="sxs-lookup"><span data-stu-id="25552-219">Release all resources associated with the previous Direct3D 11 device, including the [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder), [**ID3D11VideoContext**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videocontext), [**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d), and [**ID3D11VideoDecoderOutputView**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoderoutputview) interfaces.</span></span>
3.  <span data-ttu-id="25552-220">Öffnen Sie ein neues Geräte handle.</span><span class="sxs-lookup"><span data-stu-id="25552-220">Open a new device handle.</span></span>
4.  <span data-ttu-id="25552-221">Aushandeln Sie eine neue decoderkonfiguration, wie zuvor in [Suchen einer decoderkonfiguration](#find-a-decoder-configuration)beschrieben.</span><span class="sxs-lookup"><span data-stu-id="25552-221">Negotiate a new decoder configuration, as described previously in [Find a Decoder Configuration](#find-a-decoder-configuration).</span></span> <span data-ttu-id="25552-222">Dieser Schritt ist erforderlich, da sich die Gerätefunktionen möglicherweise geändert haben.</span><span class="sxs-lookup"><span data-stu-id="25552-222">This step is necessary because the device capabilities might have changed.</span></span>
5.  <span data-ttu-id="25552-223">Erstellen Sie ein neues Decoder-Gerät.</span><span class="sxs-lookup"><span data-stu-id="25552-223">Create a new decoder device.</span></span>

<span data-ttu-id="25552-224">Wenn das Geräte Handle gültig ist, funktioniert der Decodierungs Prozess wie folgt:</span><span class="sxs-lookup"><span data-stu-id="25552-224">Assuming that the device handle is valid, the decoding process works as follows:</span></span>

1.  <span data-ttu-id="25552-225">Sie erhalten eine verfügbare Oberfläche, die derzeit nicht verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="25552-225">Get an available surface that is not currently in use.</span></span> <span data-ttu-id="25552-226">Anfänglich sind alle Oberflächen verfügbar.</span><span class="sxs-lookup"><span data-stu-id="25552-226">Initially, all of the surfaces are available.</span></span>
2.  <span data-ttu-id="25552-227">Fragen Sie das Medien Beispiel nach der [**IMF trackedsample**](/windows/win32/api/mfidl/nn-mfidl-imftrackedsample) -Schnittstelle ab.</span><span class="sxs-lookup"><span data-stu-id="25552-227">Query the media sample for the [**IMFTrackedSample**](/windows/win32/api/mfidl/nn-mfidl-imftrackedsample) interface.</span></span>
3.  <span data-ttu-id="25552-228">Aufrufen von [**imftrackedsample:: abtallocator**](/windows/win32/api/mfidl/nf-mfidl-imftrackedsample-setallocator) und Bereitstellen eines Zeigers auf die [**imfasynccallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) -Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="25552-228">Call [**IMFTrackedSample::SetAllocator**](/windows/win32/api/mfidl/nf-mfidl-imftrackedsample-setallocator) and provide a pointer to the [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) interface.</span></span> <span data-ttu-id="25552-229">(Der Software Decoder muss diese Schnittstelle implementieren.) Wenn der Videorenderer das Beispiel freigibt, wird der Rückruf aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="25552-229">(The software decoder must implement this interface.) When the video renderer releases the sample, the callback will be invoked.</span></span> <span data-ttu-id="25552-230">Verwenden Sie diesen Rückruf, um nachzuverfolgen, welche Beispiele derzeit verfügbar sind und welche verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="25552-230">Use this callback to keep track of which samples are currently available and which are in use.</span></span>
4.  <span data-ttu-id="25552-231">Aufrufen von [**ID3D11VideoContext::D ecoderbeginframe**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe).</span><span class="sxs-lookup"><span data-stu-id="25552-231">Call [**ID3D11VideoContext::DecoderBeginFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe).</span></span> <span data-ttu-id="25552-232">Übergeben Sie die Zeiger auf die [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder) -Schnittstelle für das Decoder-Gerät und die [**ID3D11VideoDecoderOutputView**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoderoutputview) -Schnittstelle für die Ausgabe Ansicht.</span><span class="sxs-lookup"><span data-stu-id="25552-232">Pass in the pointers to the [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder) interface for the decoder device and the [**ID3D11VideoDecoderOutputView**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoderoutputview) interface for the output view.</span></span>
5.  <span data-ttu-id="25552-233">Führen Sie die folgenden Schritte aus:</span><span class="sxs-lookup"><span data-stu-id="25552-233">Do the following one or more times:</span></span>
    1.  <span data-ttu-id="25552-234">Aufrufen von [**ID3D11VideoContext:: getdecoderbuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) zum Abrufen eines Puffers.</span><span class="sxs-lookup"><span data-stu-id="25552-234">Call [**ID3D11VideoContext::GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) to get a buffer.</span></span>
    2.  <span data-ttu-id="25552-235">Füllen Sie den Puffer aus.</span><span class="sxs-lookup"><span data-stu-id="25552-235">Fill the buffer.</span></span>
    3.  <span data-ttu-id="25552-236">Aufrufen von [**ID3D11VideoContext:: releasedecoderbuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-releasedecoderbuffer).</span><span class="sxs-lookup"><span data-stu-id="25552-236">Call [**ID3D11VideoContext::ReleaseDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-releasedecoderbuffer).</span></span>
    4.  <span data-ttu-id="25552-237">[**ID3D11VideoContext:: submitdecoderbuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-submitdecoderbuffers)aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="25552-237">Call [**ID3D11VideoContext::SubmitDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-submitdecoderbuffers).</span></span> <span data-ttu-id="25552-238">Diese Methode weist das Decoder-Gerät an, die Decodierungs Vorgänge für den Frame auszuführen.</span><span class="sxs-lookup"><span data-stu-id="25552-238">This method instructs the decoder device to perform the decoding operations on the frame.</span></span>
6.  <span data-ttu-id="25552-239">[**ID3D11VideoContext::D ecoderendframe**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderendframe) , um das Ende der Decodierung für den aktuellen Frame zu signalisieren.</span><span class="sxs-lookup"><span data-stu-id="25552-239">Call [**ID3D11VideoContext::DecoderEndFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderendframe) to signal the end of decoding for the current frame.</span></span>

<span data-ttu-id="25552-240">Direct3D 11 verwendet die gleichen Datenstrukturen wie DXVA 2,0 für Decodierungs Vorgänge.</span><span class="sxs-lookup"><span data-stu-id="25552-240">Direct3D 11 uses the same data structures as DXVA 2.0 for decoding operations.</span></span> <span data-ttu-id="25552-241">Für den ursprünglichen Satz von DXVA-Profilen (für h. 261, h. 263 und MPEG-2) werden diese Datenstrukturen in der [Spezifikation DXVA 1,0](/windows-hardware/drivers/display/directx-video-acceleration)beschrieben.</span><span class="sxs-lookup"><span data-stu-id="25552-241">For the original set of DXVA profiles (for H.261, H.263, and MPEG-2), these data structures are described in the [DXVA 1.0 specification](/windows-hardware/drivers/display/directx-video-acceleration).</span></span>

<span data-ttu-id="25552-242">In jedem Paar von [**decoderbeginframe**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe) -und [**submitdecoderbuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-submitdecoderbuffers) -aufrufen können Sie [**getdecoderbuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) mehrmals aufrufen, aber nur einmal für jeden Puffertyp.</span><span class="sxs-lookup"><span data-stu-id="25552-242">Within each pair of [**DecoderBeginFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe) and [**SubmitDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-submitdecoderbuffers) calls, you may call [**GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) multiple times, but only once for each type of buffer.</span></span> <span data-ttu-id="25552-243">Wenn Sie den gleichen Puffertyp zweimal verwenden, ohne **submitdecoderbuffer** zu aufrufen, überschreiben Sie die Daten im Puffer.</span><span class="sxs-lookup"><span data-stu-id="25552-243">If you use the same buffer type twice without calling **SubmitDecoderBuffer**, you will overwrite the data in the buffer.</span></span>

## <a name="related-topics"></a><span data-ttu-id="25552-244">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="25552-244">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="25552-245">Direct3D 11-Video-APIs</span><span class="sxs-lookup"><span data-stu-id="25552-245">Direct3D 11 Video APIs</span></span>](direct3d-11-video-apis.md)
</dt> <dt>

[<span data-ttu-id="25552-246">DirectX-Video Beschleunigung 2,0</span><span class="sxs-lookup"><span data-stu-id="25552-246">DirectX Video Acceleration 2.0</span></span>](directx-video-acceleration-2-0.md)
</dt> </dl>

 

 
