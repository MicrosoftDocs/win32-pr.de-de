---
description: In diesem Thema werden Videoinhalte&\# 8211 und Schutzfunktionen beschrieben, die von einem Grafiktreiber bereitgestellt werden können.
ms.assetid: 3FDB4908-C75D-4AE0-B32E-93F840E4F30A
title: GPU-Based Content Protection mit D3D11-Video
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 78097492d375d50688f2472f5d2de99cc21f8594
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "104041546"
---
# <a name="gpu-based-content-protection-with-d3d11-video"></a><span data-ttu-id="9ce9a-103">GPU-Based Content Protection mit D3D11-Video</span><span class="sxs-lookup"><span data-stu-id="9ce9a-103">GPU-Based Content Protection with D3D11 Video</span></span>

<span data-ttu-id="9ce9a-104">In diesem Thema werden Videoinhalte – Schutzfunktionen beschrieben, die von einem Grafiktreiber bereitgestellt werden können.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-104">This topic describes video content–protection capabilities that a graphics driver can provide.</span></span>

-   [<span data-ttu-id="9ce9a-105">Introduction (Einführung)</span><span class="sxs-lookup"><span data-stu-id="9ce9a-105">Introduction</span></span>](#introduction)
-   [<span data-ttu-id="9ce9a-106">Übersicht über den Decodierungs Prozess</span><span class="sxs-lookup"><span data-stu-id="9ce9a-106">Overview of the Decoding Process</span></span>](#overview-of-the-decoding-process)
-   [<span data-ttu-id="9ce9a-107">Verschlüsseln komprimierter Video Puffer für den Decoder</span><span class="sxs-lookup"><span data-stu-id="9ce9a-107">Encrypting Compressed Video Buffers for the Decoder</span></span>](#encrypting-compressed-video-buffers-for-the-decoder)
    -   [<span data-ttu-id="9ce9a-108">1. Abfragen der Content Protection Funktionen des Treibers</span><span class="sxs-lookup"><span data-stu-id="9ce9a-108">1. Query the Content Protection Capabilities of the Driver</span></span>](#1-query-the-content-protection-capabilities-of-the-driver)
    -   [<span data-ttu-id="9ce9a-109">2. Konfigurieren des authentifizierten Kanals</span><span class="sxs-lookup"><span data-stu-id="9ce9a-109">2. Configure the Authenticated Channel</span></span>](#2-configure-the-authenticated-channel)
    -   [<span data-ttu-id="9ce9a-110">3. Konfigurieren der Kryptografiesitzung</span><span class="sxs-lookup"><span data-stu-id="9ce9a-110">3. Configure the Cryptographic Session</span></span>](#3-configure-the-cryptographic-session)
    -   [<span data-ttu-id="9ce9a-111">4. Ordnen Sie den Decoder der Kryptografiesitzung zu.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-111">4. Associate the decoder with the Cryptographic Session</span></span>](#4-associate-the-decoder-with-the-cryptographic-session)
-   [<span data-ttu-id="9ce9a-112">Senden von authentifizierten Kanal Befehlen</span><span class="sxs-lookup"><span data-stu-id="9ce9a-112">Sending Authenticated Channel Commands</span></span>](#sending-authenticated-channel-commands)
-   [<span data-ttu-id="9ce9a-113">Senden von authentifizierten Kanal Abfragen</span><span class="sxs-lookup"><span data-stu-id="9ce9a-113">Sending Authenticated Channel Queries</span></span>](#sending-authenticated-channel-queries)
-   [<span data-ttu-id="9ce9a-114">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="9ce9a-114">Related topics</span></span>](#related-topics)

## <a name="introduction"></a><span data-ttu-id="9ce9a-115">Einführung</span><span class="sxs-lookup"><span data-stu-id="9ce9a-115">Introduction</span></span>

<span data-ttu-id="9ce9a-116">Das folgende Diagramm zeigt eine vereinfachte Ansicht, wie Inhalte geschützter Videos durch die Pipeline durchlaufen werden, die gerendert werden soll.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-116">The following diagram shows a simplified view of how protected video content travels through the pipeline to be rendered.</span></span>

![ein Diagramm, in dem geschützte Videoinhalte angezeigt werden.](images/d3d9video01.png)

> [!Note]
>
> <span data-ttu-id="9ce9a-118">Der [geschützte Medien Pfad](protected-media-path.md) (PMP) ist in diesem Diagramm nicht dargestellt.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-118">The [Protected Media Path](protected-media-path.md) (PMP) is not depicted in this diagram.</span></span> <span data-ttu-id="9ce9a-119">Der hier gezeigte Datenfluss kann in einem PMP-Prozess oder innerhalb eines Anwendungsprozesses auftreten.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-119">The data flow that is shown here might occur within a PMP process, or within an application process.</span></span>

 

<span data-ttu-id="9ce9a-120">Der Decoder empfängt verschlüsselte, komprimierte Videodaten aus einer externen Quelle.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-120">The decoder receives encrypted, compressed video data from an external source.</span></span> <span data-ttu-id="9ce9a-121">Außerdem wird davon ausgegangen, dass der Decoder auch einen kryptografischen Schlüssel erhält, um diese Daten zu entschlüsseln.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-121">It is assumed also the decoder also receives a cryptographic key to decrypt this data.</span></span> <span data-ttu-id="9ce9a-122">In diesem Thema wird nicht der Schlüsselaustausch zwischen der Videoquelle und dem Decoder beschrieben, aber das PMP definiert einen möglichen Mechanismus.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-122">This topic does not describe the key exchange between the video source and decoder, but the PMP defines one possible mechanism.</span></span> <span data-ttu-id="9ce9a-123">Die GPU ist an dieser Phase nicht beteiligt.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-123">The GPU is not involved at this stage.</span></span>

<span data-ttu-id="9ce9a-124">Bei der Hardware beschleunigten Decodierung übergibt der Software Decoder komprimierte Videoinhalte an die GPU.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-124">For hardware-accelerated decoding, the software decoder passes compressed video content to the GPU.</span></span> <span data-ttu-id="9ce9a-125">Um diesen Inhalt zu schützen, verschlüsselt der Decoder die Daten, in der Regel AES-CTR, erneut, bevor Sie an den Hardwarebeschleuniger übergeben werden.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-125">To protect this content, the decoder re-encrypts the data, typically using AES-CTR, before passing it to the hardware accelerator.</span></span> <span data-ttu-id="9ce9a-126">Zwischen dem Decoder und dem Grafiktreiber wird ein Schlüsselaustausch Mechanismus definiert.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-126">A key-exchange mechanism is defined between the decoder and the graphics driver.</span></span>

<span data-ttu-id="9ce9a-127">Decodierte Video Frames werden im Videospeicher gespeichert, in der Regel im Klartext.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-127">Decoded video frames are stored in video memory, generally in the clear.</span></span> <span data-ttu-id="9ce9a-128">An diesem Punkt werden die Frames verarbeitet und dann dargestellt.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-128">At this point, the frames are processed and then presented.</span></span> <span data-ttu-id="9ce9a-129">Es gibt zwei Hauptoptionen für die Präsentation.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-129">There are two main options for presentation.</span></span>

-   <span data-ttu-id="9ce9a-130">Wenn Sie die d3d9-API verwenden, können Frames mithilfe eines Hardware Überlagerungs Fensters angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-130">When using the D3D9 API, frames can be presented using a hardware overlay.</span></span> <span data-ttu-id="9ce9a-131">Hardware übermäßig wird in D3D11 nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-131">Hardware overly is not supported in D3D11.</span></span> <span data-ttu-id="9ce9a-132">Weitere Informationen finden Sie [unter Unterstützung für Hardware Überlagerung](hardware-overlay-support.md).</span><span class="sxs-lookup"><span data-stu-id="9ce9a-132">For more information, see [Hardware Overlay Support](hardware-overlay-support.md).</span></span>
-   <span data-ttu-id="9ce9a-133">Frames können von der Desktop Fensterverwaltung (DWM) mithilfe einer freigegebenen Oberfläche dargestellt werden.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-133">Frames can be presented by the Desktop Window Manage (DWM) using a shared surface.</span></span>

<span data-ttu-id="9ce9a-134">Der letzte Schritt besteht darin, den Frame auf dem Monitor anzuzeigen, der möglicherweise einen Link Schutz zwischen der Grafikkarte und dem Anzeigegerät erfordert.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-134">The last step is to display the frame on the monitor, which may require link protection between the graphics card and the display device.</span></span> <span data-ttu-id="9ce9a-135">Ein Beispiel für den Link Schutz ist High-Bandwidth Digital Content Protection (HDCP).</span><span class="sxs-lookup"><span data-stu-id="9ce9a-135">An example of link protection is High-Bandwidth Digital Content Protection (HDCP).</span></span> <span data-ttu-id="9ce9a-136">Der Link Schutz wird mithilfe von [Output Protection Manager](output-protection-manager.md) (OPM) konfiguriert.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-136">Link protection is configured using [Output Protection Manager](output-protection-manager.md) (OPM).</span></span> <span data-ttu-id="9ce9a-137">OPM wird in diesem Thema nicht beschrieben. Weitere Informationen finden Sie unter [Verwenden von Output Protection Manager](using-output-protection-manager.md).</span><span class="sxs-lookup"><span data-stu-id="9ce9a-137">This topic does not describe OPM; for more information, see [Using Output Protection Manager](using-output-protection-manager.md).</span></span>

## <a name="overview-of-the-decoding-process"></a><span data-ttu-id="9ce9a-138">Übersicht über den Decodierungs Prozess</span><span class="sxs-lookup"><span data-stu-id="9ce9a-138">Overview of the Decoding Process</span></span>

<span data-ttu-id="9ce9a-139">Während der Hardware beschleunigten Decodierung muss der Software Decoder komprimierte Videodaten an die Grafikkarte übergeben.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-139">During hardware-accelerated decoding, the software decoder must pass compressed video data to the graphics card.</span></span> <span data-ttu-id="9ce9a-140">Bei Premium-Inhalten müssen diese Daten in der Regel mithilfe der Verschlüsselung mit symmetrischen Schlüsseln verschlüsselt werden, bevor Sie an die GPU gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-140">For premium content, this data typically must be encrypted, using symmetric-key encryption, before it is sent to the GPU.</span></span>

<span data-ttu-id="9ce9a-141">Zum Verschlüsseln des Videos für die Decodierung verwendet der Software Decoder die folgenden Schnittstellen:</span><span class="sxs-lookup"><span data-stu-id="9ce9a-141">To encrypt the video for decoding, the software decoder uses the following interfaces:</span></span>

-   <span data-ttu-id="9ce9a-142">[**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder).</span><span class="sxs-lookup"><span data-stu-id="9ce9a-142">[**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder).</span></span> <span data-ttu-id="9ce9a-143">Stellt das Decoder-Gerät dar, das auch als Accelerator bezeichnet wird.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-143">Represents the decoder device, also called the accelerator.</span></span>
-   <span data-ttu-id="9ce9a-144">[**ID3D11CryptoSession**](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession).</span><span class="sxs-lookup"><span data-stu-id="9ce9a-144">[**ID3D11CryptoSession**](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession).</span></span> <span data-ttu-id="9ce9a-145">Stellt eine Kryptografiesitzung dar, die den Verschlüsselungsschlüssel bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-145">Represents a cryptographic session, which provides the encryption key.</span></span>
-   <span data-ttu-id="9ce9a-146">[**ID3D11AuthenticatedChannel**](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel).</span><span class="sxs-lookup"><span data-stu-id="9ce9a-146">[**ID3D11AuthenticatedChannel**](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel).</span></span> <span data-ttu-id="9ce9a-147">Stellt einen authentifizierten Kanal dar, der es dem Software Decoder ermöglicht, die Kryptografiesitzung dem Decoder zuzuordnen.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-147">Represents an authenticated channel, which enables the software decoder to associate the cryptographic session with the decoder.</span></span>

![ein Diagramm, das die von Direct3D9-Decodierungs Schnittstellen anzeigt.](images/d3d9video02.png)

<span data-ttu-id="9ce9a-149">Alle diese Schnittstellen werden vom Direct3D11-Gerät wie folgt abgerufen:</span><span class="sxs-lookup"><span data-stu-id="9ce9a-149">All of these interfaces are obtained from the Direct3D11 device, as follows:</span></span>



| <span data-ttu-id="9ce9a-150">Schnittstelle</span><span class="sxs-lookup"><span data-stu-id="9ce9a-150">Interface</span></span>                                                        | <span data-ttu-id="9ce9a-151">Erstellung</span><span class="sxs-lookup"><span data-stu-id="9ce9a-151">Creation</span></span>                                                                                                                                                |
|------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="9ce9a-152">**ID3D11VideoDecoder**</span><span class="sxs-lookup"><span data-stu-id="9ce9a-152">**ID3D11VideoDecoder**</span></span>](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder)                 | <span data-ttu-id="9ce9a-153">Aufrufen von [**ID3D11VideoDevice:: createvideodecoder**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoderoutputview).</span><span class="sxs-lookup"><span data-stu-id="9ce9a-153">Call [**ID3D11VideoDevice::CreateVideoDecoder**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoderoutputview).</span></span> <span data-ttu-id="9ce9a-154">Der Decodertyp wird durch eine Profil-GUID identifiziert.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-154">The decoder type is identified by a profile GUID.</span></span> |
| [<span data-ttu-id="9ce9a-155">**ID3D11CryptoSession**</span><span class="sxs-lookup"><span data-stu-id="9ce9a-155">**ID3D11CryptoSession**</span></span>](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession)               | <span data-ttu-id="9ce9a-156">Aufrufen von [**ID3D11VideoDevice:: anatecrypdesession**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createcryptosession).</span><span class="sxs-lookup"><span data-stu-id="9ce9a-156">Call [**ID3D11VideoDevice::CreateCryptoSession**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createcryptosession).</span></span>                                                           |
| [<span data-ttu-id="9ce9a-157">**ID3D11AuthenticatedChannel**</span><span class="sxs-lookup"><span data-stu-id="9ce9a-157">**ID3D11AuthenticatedChannel**</span></span>](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel) | <span data-ttu-id="9ce9a-158">Aufrufen von [**ID3D11VideoDevice:: kreateauthentiinitiedchannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createauthenticatedchannel).</span><span class="sxs-lookup"><span data-stu-id="9ce9a-158">Call [**ID3D11VideoDevice::CreateAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createauthenticatedchannel).</span></span>                                             |



 

> [!Note]  
> <span data-ttu-id="9ce9a-159">Um einen Zeiger auf die [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) -Schnittstelle abzurufen, nennen Sie [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) in der [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) -Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-159">To get a pointer to the [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) interface, call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) on [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) interface.</span></span>

 

<span data-ttu-id="9ce9a-160">Der authentifizierte Kanal bietet einen vertrauenswürdigen Kommunikationskanal zwischen dem Software Decoder und dem Treiber.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-160">The authenticated channel provides a trusted communication channel between the software decoder and the driver.</span></span> <span data-ttu-id="9ce9a-161">Der Kommunikationskanal funktioniert wie folgt:</span><span class="sxs-lookup"><span data-stu-id="9ce9a-161">The communication channel works as follows:</span></span>

-   <span data-ttu-id="9ce9a-162">Der Treiber stellt eine X. 509-Zertifikat Kette bereit, deren Stamm Zertifikat von Microsoft signiert ist.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-162">The driver provides an X.509 certificate chain whose root certificate is signed by Microsoft.</span></span>
-   <span data-ttu-id="9ce9a-163">Das Zertifikat enthält einen öffentlichen RSA-Schlüssel für den Treiber.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-163">The certificate contains an RSA public key for the driver.</span></span>
-   <span data-ttu-id="9ce9a-164">Der Software Decoder verwendet den öffentlichen Schlüssel, um dem Treiber einen 128-Bit-AES-Sitzungsschlüssel zu senden.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-164">The software decoder uses the public key to send the driver a 128-bit AES session key.</span></span>
-   <span data-ttu-id="9ce9a-165">Der Software Decoder sendet Abfragen und Befehle an den authentifizierten Kanal.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-165">The software decoder sends queries and commands to the authenticated channel.</span></span>
-   <span data-ttu-id="9ce9a-166">Der Sitzungsschlüssel wird zum Berechnen von Nachrichten Authentifizierungscodes (Macs) für die Abfragen und Befehle verwendet.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-166">The session key is used to compute message authentication codes (MACs) for the queries and commands.</span></span> <span data-ttu-id="9ce9a-167">Der Treiber verwendet die Macs, um die Integrität der Abfrage-/Befehlsdaten zu überprüfen, und der Software Decoder verwendet diese, um die Integrität der Antwortdaten des Treibers zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-167">The driver uses the MACs to verify the integrity of the query/command data, and the software decoder uses them to verify the integrity of the response data from the driver.</span></span>

## <a name="encrypting-compressed-video-buffers-for-the-decoder"></a><span data-ttu-id="9ce9a-168">Verschlüsseln komprimierter Video Puffer für den Decoder</span><span class="sxs-lookup"><span data-stu-id="9ce9a-168">Encrypting Compressed Video Buffers for the Decoder</span></span>

<span data-ttu-id="9ce9a-169">Im folgenden finden Sie eine allgemeine Übersicht über den Verschlüsselungs-und Decodierungs Prozess:</span><span class="sxs-lookup"><span data-stu-id="9ce9a-169">Here is a high-level overview of the encryption and decoding process:</span></span>

1.  <span data-ttu-id="9ce9a-170">Der Software Decoder empfängt einen Stream verschlüsselter Daten aus der Videoquelle.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-170">The software decoder receives a stream of encrypted data from the video source.</span></span> <span data-ttu-id="9ce9a-171">Der Decoder entschlüsselt diesen Datenstrom.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-171">The decoder decrypts this stream.</span></span>
2.  <span data-ttu-id="9ce9a-172">Der Software Decoder aushandiert einen Sitzungsschlüssel mit der Kryptografiesitzung.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-172">The software decoder negotiates a session key with the cryptographic session.</span></span>
3.  <span data-ttu-id="9ce9a-173">Der Software Decoder verwendet den authentifizierten Kanal, um die Kryptografiesitzung dem Decoder-Gerät zuzuordnen.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-173">The software decoder uses the authenticated channel to associate the cryptographic session with the decoder device.</span></span>
4.  <span data-ttu-id="9ce9a-174">Der Software Decoder fügt komprimierte Daten in Puffer ein, die vom Decoder-Gerät (Accelerator) abgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-174">The software decoder puts compressed data in buffers that it gets from the decoder device (accelerator).</span></span> <span data-ttu-id="9ce9a-175">Für geschützte Inhalte verschlüsselt der Software Encoder die Daten, die in die Puffer eingefügt werden, unter Verwendung des Sitzungsschlüssels für die Verschlüsselung.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-175">For protected content, the software encoder encrypts the data that is puts into the buffers, using the session key for the encryption.</span></span>
    > [!Note]  
    > <span data-ttu-id="9ce9a-176">Einige Treiber verwenden einen Inhalts Schlüssel anstelle des Sitzungsschlüssels für die Verschlüsselung.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-176">Some drivers use a content key, instead of the session key, for encryption.</span></span> <span data-ttu-id="9ce9a-177">Der Inhalts Schlüssel kann sich von einem Frame zur nächsten ändern.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-177">The content key could change from one frame to the next.</span></span>

     

5.  <span data-ttu-id="9ce9a-178">Der Decoder übergibt die verschlüsselten komprimierten Puffer an die Zugriffstaste.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-178">The decoder submits the encrypted compressed buffers to the accelerator.</span></span> <span data-ttu-id="9ce9a-179">Für AES-CTR übergibt der Decoder auch den Initialisierungs Vektor.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-179">For AES-CTR, the decoder also passes the initialization vector.</span></span> <span data-ttu-id="9ce9a-180">Wenn ein Inhalts Schlüssel verwendet wird, übergibt der Decoder den Inhalts Schlüssel, der mit dem Sitzungsschlüssel verschlüsselt wurde.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-180">If a content key is used, the decoder passes the content key, encrypted using the session key.</span></span>

<span data-ttu-id="9ce9a-181">Direct3D11 verfügt über Standardunterstützung für 128-Bit-AES-CTR, wurde jedoch für die Erweiterung auf zusätzliche Verschlüsselungstypen entwickelt.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-181">Direct3D11 has standard support for 128-bit AES-CTR, but is designed to extend to additional encryption types.</span></span>

<span data-ttu-id="9ce9a-182">In den nächsten fünf Abschnitten finden Sie ausführlichere Schritte.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-182">The next five sections give more detailed steps.</span></span>

-   [<span data-ttu-id="9ce9a-183">1. Abfragen der Content Protection Funktionen des Treibers</span><span class="sxs-lookup"><span data-stu-id="9ce9a-183">1. Query the Content Protection Capabilities of the Driver</span></span>](#1-query-the-content-protection-capabilities-of-the-driver)
-   [<span data-ttu-id="9ce9a-184">2. Konfigurieren des authentifizierten Kanals</span><span class="sxs-lookup"><span data-stu-id="9ce9a-184">2. Configure the Authenticated Channel</span></span>](#2-configure-the-authenticated-channel)
-   [<span data-ttu-id="9ce9a-185">3. Konfigurieren der Kryptografiesitzung</span><span class="sxs-lookup"><span data-stu-id="9ce9a-185">3. Configure the Cryptographic Session</span></span>](#3-configure-the-cryptographic-session)
-   [<span data-ttu-id="9ce9a-186">4. Ordnen Sie den Decoder der Kryptografiesitzung zu.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-186">4. Associate the decoder with the Cryptographic Session</span></span>](#4-associate-the-decoder-with-the-cryptographic-session)

### <a name="1-query-the-content-protection-capabilities-of-the-driver"></a><span data-ttu-id="9ce9a-187">1. Abfragen der Content Protection Funktionen des Treibers</span><span class="sxs-lookup"><span data-stu-id="9ce9a-187">1. Query the Content Protection Capabilities of the Driver</span></span>

<span data-ttu-id="9ce9a-188">Bevor Sie versuchen, die Verschlüsselung anzuwenden, sollten Sie die inhaltsschutzfunktionen des Treibers erhalten.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-188">Before attempting to apply encryption, get the content protection capabilities of the driver.</span></span>

1.  <span data-ttu-id="9ce9a-189">Einen Zeiger auf die ID3D11Device-Schnittstelle erhalten.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-189">Get a pointer to the ID3D11Device interface.</span></span>
2.  <span data-ttu-id="9ce9a-190">Ruft [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) für die [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) -Schnittstelle auf.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-190">Call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) for the [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) interface.</span></span>
3.  <span data-ttu-id="9ce9a-191">Aufrufen von [**ID3D11VideoDevice:: getcontentschutzcaps**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getcontentprotectioncaps).</span><span class="sxs-lookup"><span data-stu-id="9ce9a-191">Call [**ID3D11VideoDevice::GetContentProtectionCaps**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getcontentprotectioncaps).</span></span> <span data-ttu-id="9ce9a-192">Diese Methode füllt eine [**D3D11_VIDEO_CONTENT_PROTECTION_CAPS**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_content_protection_caps) Struktur mit den inhaltsschutzfunktionen des Treibers aus.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-192">This method fills in a [**D3D11_VIDEO_CONTENT_PROTECTION_CAPS**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_content_protection_caps) structure with the driver’s content protection capabilities.</span></span>

<span data-ttu-id="9ce9a-193">Achten Sie insbesondere auf die folgenden Funktionen:</span><span class="sxs-lookup"><span data-stu-id="9ce9a-193">In particular, look for the following capabilities:</span></span>

-   <span data-ttu-id="9ce9a-194">Wenn das **Caps** -Mitglied die **D3D11_CONTENT_PROTECTION_CAPS_SOFTWARE** oder **D3D11_CONTENT_PROTECTION_CAPS_HARDWARE** -Flag enthält, kann der Treiber die Verschlüsselung ausführen.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-194">If the **Caps** member contains the **D3D11_CONTENT_PROTECTION_CAPS_SOFTWARE** or **D3D11_CONTENT_PROTECTION_CAPS_HARDWARE** flag, the driver can perform encryption.</span></span>
-   <span data-ttu-id="9ce9a-195">Wenn das **Caps** -Element das **D3D11_CONTENT_PROTECTION_CAPS_CONTENT_KEY** -Flag enthält, verwendet der Treiber einen separaten Inhalts Schlüssel für die Entschlüsselung.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-195">If the **Caps** member contains the **D3D11_CONTENT_PROTECTION_CAPS_CONTENT_KEY** flag, the driver uses a separate content key for decryption.</span></span>
-   <span data-ttu-id="9ce9a-196">Rufen Sie [**ID3D11VideoDevice:: checkcryptokeyexchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-checkcryptokeyexchange) auf, um zu bestimmen, welche Typen von Schlüsselaustausch der Treiber zum Erstellen des Sitzungsschlüssels unterstützt.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-196">Call [**ID3D11VideoDevice::CheckCryptoKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-checkcryptokeyexchange) to determine which types of key exchanges the driver supports for generating the session key.</span></span>

<span data-ttu-id="9ce9a-197">Zusätzliche Funktionen werden im **Caps** -Member angezeigt.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-197">Additional capabilities are indicated in the **Caps** member.</span></span>

### <a name="2-configure-the-authenticated-channel"></a><span data-ttu-id="9ce9a-198">2. Konfigurieren des authentifizierten Kanals</span><span class="sxs-lookup"><span data-stu-id="9ce9a-198">2. Configure the Authenticated Channel</span></span>

<span data-ttu-id="9ce9a-199">Der nächste Schritt besteht darin, den authentifizierten Kanal zu konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-199">The next step is to configure the authenticated channel.</span></span>

1.  <span data-ttu-id="9ce9a-200">Rufen Sie [**ID3D11VideoDevice:: kreateauthentiinitiedchannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createauthenticatedchannel) auf, um den authentifizierten Kanal zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-200">Call [**ID3D11VideoDevice::CreateAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createauthenticatedchannel) to create the authenticated channel.</span></span> <span data-ttu-id="9ce9a-201">Geben Sie für den *channelType* -Parameter einen Kanaltyp an, der mit den Funktionen des Treibers übereinstimmt.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-201">For the *ChannelType* parameter, specify a channel type that matches the capabilities of the driver.</span></span>
    -   <span data-ttu-id="9ce9a-202">Der **D3D11_AUTHENTICATED_CHANNEL_DRIVER_SOFTWARE** Kanaltyp entspricht **D3D11_CONTENT_PROTECTION_CAPS_SOFTWARE**.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-202">The **D3D11_AUTHENTICATED_CHANNEL_DRIVER_SOFTWARE** channel type corresponds to **D3D11_CONTENT_PROTECTION_CAPS_SOFTWARE**.</span></span>
    -   <span data-ttu-id="9ce9a-203">Der **D3D11_AUTHENTICATED_CHANNEL_DRIVER_HARDWARE** Kanaltyp entspricht **D3D11_CONTENT_PROTECTION_CAPS_HARDWARE**.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-203">The **D3D11_AUTHENTICATED_CHANNEL_DRIVER_HARDWARE** channel type corresponds to **D3D11_CONTENT_PROTECTION_CAPS_HARDWARE**.</span></span>

    <span data-ttu-id="9ce9a-204">Die Methode " **kreateauthentiinitiedchannel** " gibt einen Zeiger auf die [**ID3D11AuthenticatedChannel**](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel) -Schnittstelle zurück.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-204">The **CreateAuthenticatedChannel** method returns a pointer to the [**ID3D11AuthenticatedChannel**](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel) interface.</span></span>
2.  <span data-ttu-id="9ce9a-205">Aufrufen von [**ID3D11AuthenticatedChannel:: getcertifikatesize**](/windows/desktop/api/d3d11/nf-d3d11-id3d11authenticatedchannel-getcertificatesize) zum Abrufen der Größe des X. 509-Zertifikats des Treibers.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-205">Call [**ID3D11AuthenticatedChannel::GetCertificateSize**](/windows/desktop/api/d3d11/nf-d3d11-id3d11authenticatedchannel-getcertificatesize) to get the size of the driver's X.509 certificate.</span></span> <span data-ttu-id="9ce9a-206">Weisen Sie einen Puffer mit der erforderlichen Größe zu.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-206">Allocate a buffer of the required size.</span></span>
3.  <span data-ttu-id="9ce9a-207">Aufrufen von [**ID3D11AuthenticatedChannel:: GetCertificate**](/windows/desktop/api/d3d11/nf-d3d11-id3d11authenticatedchannel-getcertificate) zum Abrufen des Zertifikats.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-207">Call [**ID3D11AuthenticatedChannel::GetCertificate**](/windows/desktop/api/d3d11/nf-d3d11-id3d11authenticatedchannel-getcertificate) to get the certificate.</span></span> <span data-ttu-id="9ce9a-208">Die-Methode kopiert das Zertifikat in den Puffer, der im vorherigen Schritt zugeordnet wurde.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-208">The method copies the certificate into the buffer that was allocated in the previous step.</span></span>
4.  <span data-ttu-id="9ce9a-209">Vergewissern Sie sich, dass das Zertifikat des Treibers von Microsoft signiert wurde und nicht widerrufen wurde.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-209">Verify that the driver’s certificate was signed by Microsoft and has not been revoked.</span></span>
5.  <span data-ttu-id="9ce9a-210">Den öffentlichen Schlüssel aus dem Zertifikat zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-210">Get the public key from the certificate.</span></span>
6.  <span data-ttu-id="9ce9a-211">Generieren Sie einen zufälligen RSA-Sitzungsschlüssel.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-211">Generate a random RSA session key.</span></span> <span data-ttu-id="9ce9a-212">Dieser Sitzungsschlüssel wird zum Signieren von Daten verwendet, die an den authentifizierten Kanal gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-212">This session key is used to sign data that is sent to the authenticated channel.</span></span> <span data-ttu-id="9ce9a-213">Verschlüsseln Sie den Sitzungsschlüssel mit dem öffentlichen Schlüssel des Treibers.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-213">Encrypt the session key using the driver's public key.</span></span>
7.  <span data-ttu-id="9ce9a-214">Aufrufen von [**ID3D11VideoContext:: aushandateauthentitoredchannelkeyexchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-negotiateauthenticatedchannelkeyexchange) , um den verschlüsselten Sitzungsschlüssel an den Treiber zu senden.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-214">Call [**ID3D11VideoContext::NegotiateAuthenticatedChannelKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-negotiateauthenticatedchannelkeyexchange) to send the encrypted session key to the driver.</span></span>
8.  <span data-ttu-id="9ce9a-215">Initialisieren Sie den sicheren Kanal wie folgt:</span><span class="sxs-lookup"><span data-stu-id="9ce9a-215">Initialize the secure channel as follows:</span></span>
    1.  <span data-ttu-id="9ce9a-216">Füllen Sie eine [**D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input) Struktur aus, wie in der Dokumentation beschrieben.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-216">Fill in a [**D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input) structure as described in the documentation.</span></span>
    2.  <span data-ttu-id="9ce9a-217">Senden Sie den [**D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input) Befehl, indem Sie [**ID3D11VideoContext:: Konfigurations reauthentiinitiedchannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel) aufrufen, wie im Abschnitt [Senden von authentifizierten Kanal Befehlen](#sending-authenticated-channel-commands)beschrieben.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-217">Send the [**D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input) command by calling [**ID3D11VideoContext::ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel) as described in the section [Sending Authenticated Channel Commands](#sending-authenticated-channel-commands).</span></span> <span data-ttu-id="9ce9a-218">Dieser Befehl enthält die Startsequenz Nummern für die Befehle und Abfragen, die an den authentifizierten Kanal gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-218">This command contains the starting sequence numbers for the commands and queries that are sent to the authenticated channel.</span></span>
9.  <span data-ttu-id="9ce9a-219">Überprüfen Sie den Kanaltyp, indem Sie eine [**D3D11_AUTHENTICATED_QUERY_CHANNEL_TYPE**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_channel_type_output) Abfrage an den authentifizierten Kanal senden, wie im Abschnitt [Senden von authentifizierten Kanal Abfragen](#sending-authenticated-channel-queries)beschrieben.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-219">Verify the channel type by sending a [**D3D11_AUTHENTICATED_QUERY_CHANNEL_TYPE**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_channel_type_output) query to the authenticated channel, as described in the section [Sending Authenticated Channel Queries](#sending-authenticated-channel-queries).</span></span> <span data-ttu-id="9ce9a-220">Überprüfen Sie, ob der Kanaltyp mit dem übereinstimmt [**, den Sie in der Methode "**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9video-createauthenticatedchannel) Methode" von "" aufgerufen haben.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-220">Check that the channel type matches what you specified in the [**CreateAuthenticatedChannel**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9video-createauthenticatedchannel) method.</span></span>

### <a name="3-configure-the-cryptographic-session"></a><span data-ttu-id="9ce9a-221">3. Konfigurieren der Kryptografiesitzung</span><span class="sxs-lookup"><span data-stu-id="9ce9a-221">3. Configure the Cryptographic Session</span></span>

<span data-ttu-id="9ce9a-222">Konfigurieren Sie als nächstes die Kryptografiesitzung, und legen Sie den Sitzungsschlüssel fest.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-222">Next, configure the cryptographic session and establish the session key.</span></span>

1.  <span data-ttu-id="9ce9a-223">Rufen Sie [**ID3D11VideoDevice:: featecrypdesession**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createcryptosession) auf, um die Kryptografiesitzung zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-223">Call [**ID3D11VideoDevice::CreateCryptoSession**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createcryptosession) to create the cryptographic session.</span></span> <span data-ttu-id="9ce9a-224">Diese Methode gibt einen Zeiger auf die [**ID3D11CryptoSession**](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession) -Schnittstelle zurück.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-224">This method returns a pointer to the [**ID3D11CryptoSession**](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession) interface.</span></span>
2.  <span data-ttu-id="9ce9a-225">Aufrufen von [**ID3D11CryptoSession:: getcertifikatesize**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcertificatesize) zum Abrufen der Größe des X. 509-Zertifikats des Treibers.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-225">Call [**ID3D11CryptoSession::GetCertificateSize**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcertificatesize) to get the size of the driver's X.509 certificate.</span></span> <span data-ttu-id="9ce9a-226">Weisen Sie einen Puffer mit der erforderlichen Größe zu.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-226">Allocate a buffer of the required size.</span></span>
3.  <span data-ttu-id="9ce9a-227">Aufrufen von [**ID3D11CryptoSession:: GetCertificate**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcertificate) zum Abrufen des Zertifikats.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-227">Call [**ID3D11CryptoSession::GetCertificate**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcertificate) to get the certificate.</span></span> <span data-ttu-id="9ce9a-228">Die-Methode kopiert das Zertifikat in den Puffer, der im vorherigen Schritt zugeordnet wurde.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-228">The method copies the certificate into the buffer that was allocated in the previous step.</span></span>
4.  <span data-ttu-id="9ce9a-229">Vergewissern Sie sich, dass das Zertifikat des Treibers von Microsoft signiert wurde und nicht widerrufen wurde.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-229">Verify that the driver’s certificate was signed by Microsoft and has not been revoked.</span></span>
5.  <span data-ttu-id="9ce9a-230">Den öffentlichen Schlüssel aus dem Zertifikat zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-230">Get the public key from the certificate.</span></span>
6.  <span data-ttu-id="9ce9a-231">Generieren Sie einen zufälligen RSA-Sitzungsschlüssel.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-231">Generate a random RSA session key.</span></span> <span data-ttu-id="9ce9a-232">Dabei handelt es sich um einen separaten Sitzungsschlüssel aus dem authentifizierten channelsitzungsschlüssel.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-232">This is a separate session key from the authenticated channel session key.</span></span> <span data-ttu-id="9ce9a-233">Verschlüsseln Sie den Sitzungsschlüssel mit dem öffentlichen Schlüssel des Treibers.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-233">Encrypt the session key using the driver's public key.</span></span>
7.  <span data-ttu-id="9ce9a-234">Wenden Sie [**ID3D11VideoContext:: aushandatecryptosessionkeyexchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-negotiatecryptosessionkeyexchange) an, um den verschlüsselten Sitzungsschlüssel an den Treiber zu senden.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-234">Call [**ID3D11VideoContext::NegotiateCryptoSessionKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-negotiatecryptosessionkeyexchange) to send the encrypted session key to the driver.</span></span>
8.  <span data-ttu-id="9ce9a-235">Wenn die inhaltsschutzfunktionen **3D11_CONTENT_PROTECTION_CAPS_CONTENT_KEY** enthalten, erstellen Sie einen zufälligen RSA-Inhalts Schlüssel.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-235">If the content protection capabilities include **3D11_CONTENT_PROTECTION_CAPS_CONTENT_KEY**, create a random RSA content key.</span></span> <span data-ttu-id="9ce9a-236">Diese wird später im Decodierungs Vorgang verwendet.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-236">This will be used later in the decoding process.</span></span>

### <a name="4-associate-the-decoder-with-the-cryptographic-session"></a><span data-ttu-id="9ce9a-237">4. Ordnen Sie den Decoder der Kryptografiesitzung zu.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-237">4. Associate the decoder with the Cryptographic Session</span></span>

<span data-ttu-id="9ce9a-238">Ordnen Sie anschließend das Decoder-Gerät wie folgt dem Direct3D11-Gerät und der Kryptografiesitzung zu:</span><span class="sxs-lookup"><span data-stu-id="9ce9a-238">Next, associate the decoder device with the Direct3D11 device and the cryptographic session, as follows:</span></span>

1.  <span data-ttu-id="9ce9a-239">Sie erhalten ein Handle für das Direct3D11-Gerät, indem Sie eine [**D3D11_AUTHENTICATED_QUERY_DEVICE_HANDLE**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_device_handle_output) Abfrage an den authentifizierten Kanal senden.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-239">Get a handle to the Direct3D11 device, by sending a [**D3D11_AUTHENTICATED_QUERY_DEVICE_HANDLE**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_device_handle_output) query to the authenticated channel.</span></span>
2.  <span data-ttu-id="9ce9a-240">Fügen Sie eine [**D3D11_AUTHENTICATED_CONFIGURE_CRYPTO_SESSION_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_crypto_session_input) Struktur mit den folgenden Informationen ein:</span><span class="sxs-lookup"><span data-stu-id="9ce9a-240">Fill in a [**D3D11_AUTHENTICATED_CONFIGURE_CRYPTO_SESSION_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_crypto_session_input) structure with the following information:</span></span>
    -   <span data-ttu-id="9ce9a-241">Legen Sie den **decodehandle** -Member auf das von [**ID3D11VideoDecoder:: getdriverhandle**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodecoder-getdriverhandle)zurückgegebene Handle fest.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-241">Set the **DecodeHandle** member to the handle returned from [**ID3D11VideoDecoder::GetDriverHandle**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodecoder-getdriverhandle).</span></span>
    -   <span data-ttu-id="9ce9a-242">Legen Sie den **cryptosessionhandle** -Member auf das von [**ID3D11CryptoSession:: getcryptosessionhandle**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcryptosessionhandle)zurückgegebene Handle fest.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-242">Set the **CryptoSessionHandle** member to the handle returned from [**ID3D11CryptoSession::GetCryptoSessionHandle**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcryptosessionhandle).</span></span>
    -   <span data-ttu-id="9ce9a-243">Legen Sie das Element " **envicehandle** " auf das Direct3D11-Geräte Handle fest.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-243">Set the **DeviceHandle** member to the Direct3D11 device handle.</span></span>
3.  <span data-ttu-id="9ce9a-244">Wenden Sie [**ID3D11VideoContext:: konfigurierten reauthentiinitiedchannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel) an, um einen [**D3D11_AUTHENTICATED_CONFIGURE_CRYPTO_SESSION**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_crypto_session_input) Befehl an den authentifizierten Kanal zu senden.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-244">Call [**ID3D11VideoContext::ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel) to send a [**D3D11_AUTHENTICATED_CONFIGURE_CRYPTO_SESSION**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_crypto_session_input) command to the authenticated channel.</span></span>

<span data-ttu-id="9ce9a-245">Das folgende Diagramm veranschaulicht den Austausch von Handles:</span><span class="sxs-lookup"><span data-stu-id="9ce9a-245">The following diagram illustrates the exchange of handles:</span></span>

![ein Diagramm, das zeigt, wie der DXVA-Decoder der Kryptografiesitzung zugeordnet wird.](images/d3d9video03.png)

<span data-ttu-id="9ce9a-247">Der Software Decoder kann nun den kryptografiesitzungsschlüssel verwenden, um die komprimierten Video Puffer zu verschlüsseln.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-247">The software decoder can now use the cryptographic session key to encrypt the compressed video buffers.</span></span> <span data-ttu-id="9ce9a-248">Jeder komprimierte Puffer verfügt über einen eigenen Initialisierungs Vektor (IV), der im **PIV** -Member der [**D3D11_VIDEO_DECODER_BUFFER_DESC**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_decoder_buffer_desc) Struktur angegeben wird.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-248">Each compressed buffer will have its own initialization vector (IV) specified in the **pIV** member of the [**D3D11_VIDEO_DECODER_BUFFER_DESC**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_decoder_buffer_desc) structure.</span></span>

## <a name="sending-authenticated-channel-commands"></a><span data-ttu-id="9ce9a-249">Senden von authentifizierten Kanal Befehlen</span><span class="sxs-lookup"><span data-stu-id="9ce9a-249">Sending Authenticated Channel Commands</span></span>

<span data-ttu-id="9ce9a-250">Ein Satz von Befehlen wird zum Konfigurieren des authentifizierten Kanals und zum Festlegen verschiedener Inhalts Schutzmaßnahmen definiert.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-250">A set of commands are defined for configuring the authenticated channel and setting various content protections.</span></span> <span data-ttu-id="9ce9a-251">Eine Liste der Befehle finden Sie unter [Content Protection-Befehle](content-protection-commands.md).</span><span class="sxs-lookup"><span data-stu-id="9ce9a-251">For a list of commands, see [Content Protection Commands](content-protection-commands.md).</span></span>

<span data-ttu-id="9ce9a-252">Führen Sie die folgenden Schritte aus, um einen Befehl an den authentifizierten Kanal zu senden.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-252">To send a command to the authenticated channel, perform the following steps.</span></span>

1.  <span data-ttu-id="9ce9a-253">Füllen Sie die Eingabedaten Struktur aus.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-253">Fill in the input data structure.</span></span> <span data-ttu-id="9ce9a-254">Diese Datenstruktur ist immer eine [**D3D11_AUTHENTICATED_CONFIGURE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_input) Struktur, gefolgt von zusätzlichen Feldern.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-254">This data structure is always a [**D3D11_AUTHENTICATED_CONFIGURE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_input) structure followed by additional fields.</span></span> <span data-ttu-id="9ce9a-255">Füllen Sie die **D3D11_AUTHENTICATED_CONFIGURE_INPUT** Struktur aus, wie in der folgenden Tabelle gezeigt.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-255">Fill in the **D3D11_AUTHENTICATED_CONFIGURE_INPUT** structure as shown in the following table.</span></span>

    <table>
    <colgroup>
    <col style="width: 50%" />
    <col style="width: 50%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th><span data-ttu-id="9ce9a-256">Member</span><span class="sxs-lookup"><span data-stu-id="9ce9a-256">Member</span></span></th>
    <th><span data-ttu-id="9ce9a-257">BESCHREIBUNG</span><span class="sxs-lookup"><span data-stu-id="9ce9a-257">Description</span></span></th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td><span data-ttu-id="9ce9a-258"><strong>OMAC</strong></span><span class="sxs-lookup"><span data-stu-id="9ce9a-258"><strong>omac</strong></span></span></td>
    <td><span data-ttu-id="9ce9a-259">Dieses Feld jetzt überspringen.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-259">Skip this field for now.</span></span></td>
    </tr>
    <tr class="even">
    <td><span data-ttu-id="9ce9a-260"><strong>Konfiguriertyp</strong></span><span class="sxs-lookup"><span data-stu-id="9ce9a-260"><strong>ConfigureType</strong></span></span></td>
    <td><span data-ttu-id="9ce9a-261">GUID, die den Befehl identifiziert.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-261">GUID that identifies the command.</span></span> <span data-ttu-id="9ce9a-262">Eine Liste der Befehle finden Sie unter <a href="content-protection-commands.md">Content Protection-Befehle</a>.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-262">For a list of commands, see <a href="content-protection-commands.md">Content Protection Commands</a>.</span></span></td>
    </tr>
    <tr class="odd">
    <td><span data-ttu-id="9ce9a-263"><strong>hchannel</strong></span><span class="sxs-lookup"><span data-stu-id="9ce9a-263"><strong>hChannel</strong></span></span></td>
    <td><span data-ttu-id="9ce9a-264">Das Handle für den authentifizierten Kanal.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-264">The handle to the authenticated channel.</span></span></td>
    </tr>
    <tr class="even">
    <td><span data-ttu-id="9ce9a-265"><strong>SequenceNumber</strong></span><span class="sxs-lookup"><span data-stu-id="9ce9a-265"><strong>SequenceNumber</strong></span></span></td>
    <td><span data-ttu-id="9ce9a-266">Die Sequenznummer.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-266">The sequence number.</span></span> <span data-ttu-id="9ce9a-267">Die erste Sequenznummer wird durch Senden eines <a href="/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input"><strong>D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE</strong></a> Befehls angegeben.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-267">The first sequence number is specified by sending a <a href="/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input"><strong>D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE</strong></a> command.</span></span> <span data-ttu-id="9ce9a-268">Jedes Mal, wenn Sie einen anderen Befehl senden, erhöhen Sie diese Zahl um 1.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-268">Each time you send another command, increment this number by 1.</span></span> <span data-ttu-id="9ce9a-269">Die Sequenznummer schützt vor Replay-Angriffen.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-269">The sequence number guards against replay attacks.</span></span>
    <blockquote>
    [!Note]<br />
<span data-ttu-id="9ce9a-270">Es werden zwei separate Sequenznummern verwendet, eine für Befehle und eine für Abfragen.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-270">Two separate sequence numbers are used, one for commands and one for queries.</span></span>
    </blockquote>
    <br/> <br/></td>
    </tr>
    </tbody>
    </table>

    

     

2.  <span data-ttu-id="9ce9a-271">Berechnen Sie das OMAC-Tag für den Datenblock, der nach dem **OMAC** -Member der Eingabe Struktur angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-271">Calculate the OMAC tag for the block of data that appears after the **omac** member of the input structure.</span></span> <span data-ttu-id="9ce9a-272">Kopieren Sie dann diesen Tagwert in den **OMAC** -Member.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-272">Then copy this tag value into the **omac** member.</span></span>
3.  <span data-ttu-id="9ce9a-273">Ruft [**ID3D11VideoContext:: konfigurierten reauthentiinitiedchannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel)auf.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-273">Call [**ID3D11VideoContext::ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel).</span></span>
4.  <span data-ttu-id="9ce9a-274">Der Treiber legt die Ausgabe aus dem Befehl in der [**D3D11_AUTHENTICATED_CONFIGURE_OUTPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_output) Struktur ab.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-274">The driver places the output from the command in the [**D3D11_AUTHENTICATED_CONFIGURE_OUTPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_output) structure.</span></span>
5.  <span data-ttu-id="9ce9a-275">Berechnen Sie das OMAC-Tag für den Datenblock, der nach dem **OMAC** -Member der Ausgabestruktur angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-275">Calculate the OMAC tag for the block of data that appears after the **omac** member of the output structure.</span></span> <span data-ttu-id="9ce9a-276">Vergleichen Sie dies mit dem Wert des **OMAC** -Members.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-276">Compare this with the value of the **omac** member.</span></span> <span data-ttu-id="9ce9a-277">Schlägt fehl, wenn Sie nicht stimmen.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-277">Fail if they do not match.</span></span>
6.  <span data-ttu-id="9ce9a-278">Vergleichen Sie die Werte der Member " **konfiguritytype**", " **hchannel**" und " **SequenceNumber** " in der Ausgabestruktur mit ihren Werten für diese Elemente.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-278">Compare the values of the **ConfigureType**, **hChannel**, and **SequenceNumber** members in the output structure against your values for those members.</span></span> <span data-ttu-id="9ce9a-279">Schlägt fehl, wenn Sie nicht stimmen.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-279">Fail if they do not match.</span></span>
7.  <span data-ttu-id="9ce9a-280">Erhöhen Sie die Sequenznummer für den nächsten Befehl.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-280">Increment the sequence number for the next command.</span></span>

## <a name="sending-authenticated-channel-queries"></a><span data-ttu-id="9ce9a-281">Senden von authentifizierten Kanal Abfragen</span><span class="sxs-lookup"><span data-stu-id="9ce9a-281">Sending Authenticated Channel Queries</span></span>

<span data-ttu-id="9ce9a-282">Ein Satz von Abfragen wird zum Abrufen von Informationen über den authentifizierten Kanal definiert.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-282">A set of queries are defined for retrieving information about the authenticated channel.</span></span> <span data-ttu-id="9ce9a-283">Eine Liste der Abfragen finden Sie unter [Content Protection-Abfragen](content-protection-queries.md).</span><span class="sxs-lookup"><span data-stu-id="9ce9a-283">For a list of queries, see [Content Protection Queries](content-protection-queries.md).</span></span>

<span data-ttu-id="9ce9a-284">Führen Sie die folgenden Schritte aus, um einen Befehl an den authentifizierten Kanal zu senden.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-284">To send a command to the authenticated channel, perform the following steps.</span></span>

1.  <span data-ttu-id="9ce9a-285">Füllen Sie die Eingabedaten Struktur aus.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-285">Fill in the input data structure.</span></span> <span data-ttu-id="9ce9a-286">Diese Datenstruktur ist immer eine [**D3D11_AUTHENTICATED_QUERY_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_input) Struktur, der möglicherweise zusätzliche Felder folgt.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-286">This data structure is always a [**D3D11_AUTHENTICATED_QUERY_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_input) structure, possibly followed by additional fields.</span></span> <span data-ttu-id="9ce9a-287">Füllen Sie die **D3D11_AUTHENTICATED_QUERY_INPUT** Struktur aus, wie in der folgenden Tabelle gezeigt.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-287">Fill in the **D3D11_AUTHENTICATED_QUERY_INPUT** structure as shown in the following table.</span></span>

    <table>
    <colgroup>
    <col style="width: 50%" />
    <col style="width: 50%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th><span data-ttu-id="9ce9a-288">Member</span><span class="sxs-lookup"><span data-stu-id="9ce9a-288">Member</span></span></th>
    <th><span data-ttu-id="9ce9a-289">BESCHREIBUNG</span><span class="sxs-lookup"><span data-stu-id="9ce9a-289">Description</span></span></th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td><span data-ttu-id="9ce9a-290"><strong>QueryType</strong></span><span class="sxs-lookup"><span data-stu-id="9ce9a-290"><strong>QueryType</strong></span></span></td>
    <td><span data-ttu-id="9ce9a-291">GUID, die die Abfrage identifiziert.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-291">GUID that identifies the query.</span></span> <span data-ttu-id="9ce9a-292">Eine Liste der Abfragen finden Sie unter <a href="content-protection-queries.md">Content Protection-Abfragen</a>.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-292">For a list of queries, see <a href="content-protection-queries.md">Content Protection Queries</a>.</span></span></td>
    </tr>
    <tr class="even">
    <td><span data-ttu-id="9ce9a-293"><strong>hchannel</strong></span><span class="sxs-lookup"><span data-stu-id="9ce9a-293"><strong>hChannel</strong></span></span></td>
    <td><span data-ttu-id="9ce9a-294">Das Handle für den authentifizierten Kanal.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-294">The handle to the authenticated channel.</span></span></td>
    </tr>
    <tr class="odd">
    <td><span data-ttu-id="9ce9a-295"><strong>SequenceNumber</strong></span><span class="sxs-lookup"><span data-stu-id="9ce9a-295"><strong>SequenceNumber</strong></span></span></td>
    <td><span data-ttu-id="9ce9a-296">Die Sequenznummer.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-296">The sequence number.</span></span> <span data-ttu-id="9ce9a-297">Die erste Sequenznummer wird durch Senden eines <a href="/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input"><strong>D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE</strong></a> Befehls angegeben.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-297">The first sequence number is specified by sending a <a href="/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input"><strong>D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE</strong></a> command.</span></span> <span data-ttu-id="9ce9a-298">Jedes Mal, wenn Sie eine andere Abfrage senden, erhöhen Sie diese Zahl um 1.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-298">Each time you send another query, increment this number by 1.</span></span> <span data-ttu-id="9ce9a-299">Die Sequenznummer schützt vor Replay-Angriffen.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-299">The sequence number guards against replay attacks.</span></span>
    <blockquote>
    [!Note]<br />
<span data-ttu-id="9ce9a-300">Es werden zwei separate Sequenznummern verwendet, eine für Befehle und eine für Abfragen.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-300">Two separate sequence numbers are used, one for commands and one for queries.</span></span>
    </blockquote>
    <br/> <br/></td>
    </tr>
    </tbody>
    </table>

    

     

2.  <span data-ttu-id="9ce9a-301">[**ID3D11VideoContext:: queryauthentiinitiedchannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-queryauthenticatedchannel)aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-301">Call [**ID3D11VideoContext::QueryAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-queryauthenticatedchannel).</span></span>
3.  <span data-ttu-id="9ce9a-302">Der Treiber legt die Ausgabe der Abfrage in einer [**D3D11_AUTHENTICATED_QUERY_OUTPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_output) Struktur ab.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-302">The driver places the output from the query in a [**D3D11_AUTHENTICATED_QUERY_OUTPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_output) structure.</span></span> <span data-ttu-id="9ce9a-303">Auf diese Struktur folgen je nach Abfragetyp zusätzliche Felder.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-303">This structure is followed by additional fields, depending on the query type.</span></span>
4.  <span data-ttu-id="9ce9a-304">Berechnen Sie das OMAC-Tag für den Datenblock, der nach dem **OMAC** -Member der Ausgabestruktur angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-304">Calculate the OMAC tag for the block of data that appears after the **omac** member of the output structure.</span></span> <span data-ttu-id="9ce9a-305">Vergleichen Sie dies mit dem Wert des **OMAC** -Members.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-305">Compare this with the value of the **omac** member.</span></span> <span data-ttu-id="9ce9a-306">Schlägt fehl, wenn Sie nicht stimmen.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-306">Fail if they do not match.</span></span>
5.  <span data-ttu-id="9ce9a-307">Vergleichen Sie die Werte der Member " **konfiguritytype**", " **hchannel**" und " **SequenceNumber** " in der Ausgabestruktur mit ihren Werten für diese Elemente.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-307">Compare the values of the **ConfigureType**, **hChannel**, and **SequenceNumber** members in the output structure against your values for those members.</span></span> <span data-ttu-id="9ce9a-308">Schlägt fehl, wenn Sie nicht stimmen.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-308">Fail if they do not match.</span></span>
6.  <span data-ttu-id="9ce9a-309">Erhöhen Sie die Sequenznummer für die nächste Abfrage.</span><span class="sxs-lookup"><span data-stu-id="9ce9a-309">Increment the sequence number for the next query.</span></span>

## <a name="related-topics"></a><span data-ttu-id="9ce9a-310">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="9ce9a-310">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="9ce9a-311">Direct3D 11-Video-APIs</span><span class="sxs-lookup"><span data-stu-id="9ce9a-311">Direct3D 11 Video APIs</span></span>](direct3d-11-video-apis.md)
</dt> </dl>

 

 
