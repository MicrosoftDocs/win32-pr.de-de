---
description: Es ist manchmal hilfreich, nur Datei Abschnitte zu sichern und wiederherzustellen. VSS stellt partielle Datei Mechanismen bereit, die es Writer ermöglichen, Teil Dateien Sicherungen und-Wiederherstellungen anzugeben, wenn Sie von Anforderern unterstützt werden.
ms.assetid: 02b74a4e-d69f-4eeb-866a-3399598b7035
title: Arbeiten mit partiellen Dateien
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7194f01df11f6c0e368941e17ef6ab1620b17f67
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "106344444"
---
# <a name="working-with-partial-files"></a><span data-ttu-id="f97ff-104">Arbeiten mit partiellen Dateien</span><span class="sxs-lookup"><span data-stu-id="f97ff-104">Working with Partial Files</span></span>

<span data-ttu-id="f97ff-105">Es ist manchmal hilfreich, nur Datei Abschnitte zu sichern und wiederherzustellen.</span><span class="sxs-lookup"><span data-stu-id="f97ff-105">It is sometimes useful to back up and restore only sections of files.</span></span> <span data-ttu-id="f97ff-106">VSS stellt [*partielle Datei*](vssgloss-p.md) Mechanismen bereit, die es Writer ermöglichen, Teil Dateien Sicherungen und-Wiederherstellungen anzugeben, wenn Sie von Anforderern unterstützt werden.</span><span class="sxs-lookup"><span data-stu-id="f97ff-106">VSS provides [*partial file*](vssgloss-p.md) mechanisms, which, if requesters support it, allows writers to specify partial file backups and restores.</span></span>

<span data-ttu-id="f97ff-107">Partielle Datei Vorgänge sind häufig die beste Verwendung von Writern, die sehr große Dateien verwalten, nur ein kleiner Bruchteil der Änderung zwischen den Sicherungs Vorgängen.</span><span class="sxs-lookup"><span data-stu-id="f97ff-107">Partial file operations are frequently of greatest use to writers that maintain very large files, only a small fraction of which change between backup operations.</span></span> <span data-ttu-id="f97ff-108">Dies ist der Fall, es ist häufig hilfreich, nur den Abschnitt zu kopieren, der auf Sicherungsmedien geändert wurde.</span><span class="sxs-lookup"><span data-stu-id="f97ff-108">This being the case, it is frequently useful to copy only that section that changed to backup media.</span></span> <span data-ttu-id="f97ff-109">Aus diesem Grund werden partielle Datei Vorgänge in der Regel, aber nicht exklusiv verwendet, um inkrementelle Sicherungs-und Wiederherstellungs Vorgänge zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="f97ff-109">For this reason, partial file operations are typically, but not exclusively, used to support incremental backup and restore operations.</span></span>

<span data-ttu-id="f97ff-110">Wenn ein Writer eine partielle Dateioperation implementieren möchte, wird [**CVssWriter:: ispartialfilesupportenabled**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispartialfilesupportenabled) verwendet, um zu bestimmen, ob der Anforderer, mit dem er arbeitet, den Vorgang unterstützt.</span><span class="sxs-lookup"><span data-stu-id="f97ff-110">If a writer wants to implement a partial file operation, it uses [**CVssWriter::IsPartialFileSupportEnabled**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispartialfilesupportenabled) to determine whether the requester it is working with supports the operation.</span></span>

<span data-ttu-id="f97ff-111">Wenn die anfordernde Person partielle Datei Vorgänge unterstützt und die Komponente, mit der die Datei verwaltet wird (oder die Komponente, die den Komponenten Satz definiert, der die Datei enthält), in das Dokument mit den Sicherungs Komponenten eingefügt wird, gibt ein Writer an, welche [](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) Abschnitte der Datei gespeichert werden [](vssgloss-p.md) sollen [](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile)</span><span class="sxs-lookup"><span data-stu-id="f97ff-111">If the requester supports partial file operations, and if it adds the component that manages the file (or the component that defines the component set that contains the file) to the Backup Components Document, a writer indicates which sections of the file to save (typically while handling a [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) or [*PostSnapshot*](vssgloss-p.md) event) by calling [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile).</span></span>

<span data-ttu-id="f97ff-112">Neben dem Pfad und dem Dateinamen stellt der Writer den Bereich optionale Metadateninformationen für [**IVssComponent:: addpartialfile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile)bereit.</span><span class="sxs-lookup"><span data-stu-id="f97ff-112">In addition to a path and file name, the writer supplies the range, optional metadata information to [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile).</span></span>

<span data-ttu-id="f97ff-113">Die Bereichs Informationen werden als Zeichenfolge bereitgestellt, die eine der folgenden Optionen enthält:</span><span class="sxs-lookup"><span data-stu-id="f97ff-113">The range information is provided as a string that contains either of the following:</span></span>

-   <span data-ttu-id="f97ff-114">Paare von Offsets in die zu sichernde Datei (in Bytes) und die Länge des zu sichernden Abschnitts (in Bytes), der Offset und die Länge, die durch einen Doppelpunkt getrennt werden, und jedes Paar durch Kommas getrennt, z. b. \*offset1 \***:**_Length1_*_,_* \* Offset2 \***:**_Length2_.</span><span class="sxs-lookup"><span data-stu-id="f97ff-114">Pairs of offsets into the file to be backed up (in bytes) and the length of the section to be backed up (in bytes), the offset and length being separated by a colon, and each pair separated by a comma, for example, *Offset1\***:**_Length1_*_,_\* \*Offset2\***:**_Length2_.</span></span>

    <span data-ttu-id="f97ff-115">Jeder Wert ist eine 64-Bit-Ganzzahl (im Hexadezimal-oder Dezimal Format), die jeweils einen Byte Offset und eine Länge in Byte angibt.</span><span class="sxs-lookup"><span data-stu-id="f97ff-115">Each value is a 64-bit integer (in either hexadecimal or decimal format) specifying a byte offset and length in bytes, respectively.</span></span>

-   <span data-ttu-id="f97ff-116">Der vollständige Pfad, einschließlich des Datei namens, auf dem aktuellen System einer Binär Bereichs Datei, die Folgendes enthält:</span><span class="sxs-lookup"><span data-stu-id="f97ff-116">The full path, including file name, on the current system of a binary ranges file containing the following:</span></span>
    -   <span data-ttu-id="f97ff-117">Die Zahl (ausgedrückt als 64-Bit-Ganzzahl) mit unterschiedlichen Datei Bereichen, die in der Datei enthalten sind.</span><span class="sxs-lookup"><span data-stu-id="f97ff-117">The number (expressed as a 64-bit integer) of distinct file ranges contained in the file</span></span>
    -   <span data-ttu-id="f97ff-118">Jeder Bereich wird als Paar von 64-Bit-Ganzzahlen ausgedrückt: das erste Element des Paars ist der Offset in die zu sichernde Datei (in Bytes), und der zweite Member ist die Länge der zu sichernden Daten (in Bytes).</span><span class="sxs-lookup"><span data-stu-id="f97ff-118">Each range expressed as a pair of 64-bit integers: the first member of the pair being the offset into the file being backed up (in bytes), and the second member being the length of data to be backed up (in bytes)</span></span>

<span data-ttu-id="f97ff-119">Wenn ein Writer eine Bereichs Datei zum Angeben eines partiellen Datei Vorgangs verwendet, muss ein Anforderer sicherstellen, dass entweder diese Datei gesichert wird (auch wenn die Datei nicht notwendigerweise Teil des Standard Sicherungs Satzes ist) oder dass die Bereichs Informationen auf den Sicherungsmedien auf andere Weise beibehalten werden.</span><span class="sxs-lookup"><span data-stu-id="f97ff-119">If a writer uses a ranges file to specify a partial file operation, a requester must guarantee that either this file is backed up (even if the file is not necessarily part of the default backup set) or that the ranges information is preserved on the backup media in some other way.</span></span> <span data-ttu-id="f97ff-120">Wenn die Informationen zu den Bereichs Dateien nicht gesichert werden, ist das Wiederherstellen der teilweise gesicherten Datei nicht möglich.</span><span class="sxs-lookup"><span data-stu-id="f97ff-120">If the ranges file's information is not backed up, restoring the partially backed up file will be impossible.</span></span>

<span data-ttu-id="f97ff-121">Der Writer kann auch eine Zeichenfolge hinzufügen, die Metadaten enthält.</span><span class="sxs-lookup"><span data-stu-id="f97ff-121">The writer can also add a string containing metadata.</span></span> <span data-ttu-id="f97ff-122">Diese Metadaten können ein Schreib spezifisches Format aufweisen, da es dem Writer ermöglicht, zukünftige Wiederherstellungen zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="f97ff-122">This metadata can be in a writer-specific format because it is intended to allow the writer to validate any future restores.</span></span>

<span data-ttu-id="f97ff-123">Mit diesen Informationen kann eine unterstützende Anforderer eine partielle Datei Sicherung ausführen.</span><span class="sxs-lookup"><span data-stu-id="f97ff-123">With this information, a supporting requester can perform a partial file backup.</span></span>

<span data-ttu-id="f97ff-124">Betrachten Sie als Beispiel eine große Datei, deren Header (Bytes 64-512) eine Daten Satz Anzahl und andere häufig aktualisierte Informationen enthält und deren aktuelle Daten in den letzten 65536 Bytes der Datei – Bytes 0x1239e8577a bis 0x1239e7577a zu finden sind.</span><span class="sxs-lookup"><span data-stu-id="f97ff-124">As an example, consider a large file whose header (bytes 64-512) contains a record count and other frequently updated information, and whose most recent data is to be found in the file's last 65536 bytes—bytes 0x1239E8577A to 0x1239E7577A.</span></span>

<span data-ttu-id="f97ff-125">Ein Writer könnte eine Bereichs Liste als Zeichenfolge "**64:448, 0x1239e8577a: 65536**" angeben.</span><span class="sxs-lookup"><span data-stu-id="f97ff-125">A writer could specify a range list as the string "**64:448,0x1239E8577A:65536**."</span></span>

<span data-ttu-id="f97ff-126">Bei der Wiederherstellung und vor der tatsächlichen Ausführung eines Wiederherstellungs Vorgangs sollte ein Anforderer überprüfen, ob Dateien partielle Dateiunterstützung benötigen.</span><span class="sxs-lookup"><span data-stu-id="f97ff-126">On restore, and prior to actually performing a restore operation, a requester should check to see if any files require partial file support.</span></span>

<span data-ttu-id="f97ff-127">Zu diesem Zweck durchläuft der Anforderer zuerst die Writer mit gespeicherten Komponenten in seinem Sicherungs Komponenten Dokument mithilfe von [**IVssBackupComponents:: getwritercomponentscount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponentscount) und [**IVssBackupComponents:: getwritercomponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents).</span><span class="sxs-lookup"><span data-stu-id="f97ff-127">To do this, the requester first iterates over the writers with stored components in its Backup Components Document using [**IVssBackupComponents::GetWriterComponentsCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponentscount) and [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents).</span></span>

<span data-ttu-id="f97ff-128">Die [**IVssBackupComponents:: getschreitercomponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents) -Schnittstelle wird dann verwendet, um Instanzen der [**ivssschreitercomponentset**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) -Schnittstelle zurückzugeben, die [**ivssschreitercomponentset XT:: getComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponent) und [](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) [**ivssschreitercomponentset XT:: getcomponentcount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponentcount)angeben</span><span class="sxs-lookup"><span data-stu-id="f97ff-128">The [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents) interface is then used to return instances of the [**IVssWriterComponentsExt**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) interface, which provide [**IVssWriterComponentsExt::GetComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponent) and [**IVssWriterComponentsExt::GetComponentCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponentcount), that allow the requester to obtain [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) instances.</span></span>

<span data-ttu-id="f97ff-129">Dadurch kann ein Anforderer Informationen über die teilweise gesicherten Dateien abrufen, um an einer Wiederherstellung teilzunehmen, indem [**IVssComponent:: GetPartialFileCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfilecount) und [**IVssComponent:: GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) für die Instanz von [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) verwendet werden. Dies entspricht der Komponente, die die Datei verwaltet (oder der Komponente, die den Komponenten Satz definiert, der die Datei enthält).</span><span class="sxs-lookup"><span data-stu-id="f97ff-129">This allows a requester to obtain information about the partially backed up files to participate in a restore by using [**IVssComponent::GetPartialFileCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfilecount) and [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) for the instance of [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corresponding to the component that manages the file (or the component that defines the component set that contains the file).</span></span>

<span data-ttu-id="f97ff-130">Wenn der Teil Datei Vorgang durch eine Bereichs Datei gesteuert wurde, sollte diese Datei vor dem Kopieren der Daten auf den Datenträger wieder hergestellt werden.</span><span class="sxs-lookup"><span data-stu-id="f97ff-130">If the partial file operation was controlled by a ranges file, that file should be restored prior to copied data back to disk.</span></span> <span data-ttu-id="f97ff-131">Es kann vorkommen, dass die anfordernde Person die Bereichs Datei an einen neuen Speicherort auf dem Datenträger Zurückkopieren muss.</span><span class="sxs-lookup"><span data-stu-id="f97ff-131">It may happen that the requester needed to copy the ranges file back to a new location on disk.</span></span> <span data-ttu-id="f97ff-132">In diesem Fall ist dies ein Hinweis darauf, dass dies über den [**IVssBackupComponents:: Server File Path**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrangesfilepath)erfolgt ist.</span><span class="sxs-lookup"><span data-stu-id="f97ff-132">In this case, it indicates that it has done so through the [**IVssBackupComponents::SetRangesFilePath**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrangesfilepath).</span></span>

<span data-ttu-id="f97ff-133">Der Anforderer fährt dann mit dem Kopieren von Daten an die entsprechenden Speicherorte im Wiederherstellungs Ziel auf dem Datenträger fort.</span><span class="sxs-lookup"><span data-stu-id="f97ff-133">The requester then proceeds to copy data into the appropriate locations in the restore destination already on disk.</span></span>

<span data-ttu-id="f97ff-134">Ein Writer (bei der Behandlung eines [**postrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) -Ereignisses) bestimmt durch Untersuchen von [**IVssComponent:: getfilerestorestatus**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getfilerestorestatus) für die durch [**IVssComponent:: GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile)festgelegten Dateien, ob der Teil Datei Vorgang erfolgreich war.</span><span class="sxs-lookup"><span data-stu-id="f97ff-134">A writer (while handling a [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) event), by examining [**IVssComponent::GetFileRestoreStatus**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getfilerestorestatus) for the files indicated by [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile), determines if the partial file operation was successful.</span></span> <span data-ttu-id="f97ff-135">Der Writer sollte immer versuchen, die Richtigkeit dieser Wiederherstellung mit den Offset Informationen und Metadaten zu überprüfen, die im Dokument mit den Sicherungs Komponenten enthalten sind.</span><span class="sxs-lookup"><span data-stu-id="f97ff-135">The writer should always attempt to verify the correctness of this restore using the offset information and any metadata included in the Backup Components Document.</span></span>

<span data-ttu-id="f97ff-136">Wenn der Anforderer die Bereichs Datei an einem neuen Speicherort wiederherstellen muss, aktualisiert VSS diese Informationen so, dass der von [**IVssComponent:: GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) zurückgegebene Pfad richtig ist.</span><span class="sxs-lookup"><span data-stu-id="f97ff-136">If the requester has had to restore the ranges file to a new location, VSS will update this information so that the path returned by [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) is correct.</span></span>

 

 
