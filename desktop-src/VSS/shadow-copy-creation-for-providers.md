---
description: Erstellen von Schatten Kopien für Anbieter
ms.assetid: d5042945-ba81-40d0-b204-1f08d153a788
title: Erstellen von Schatten Kopien für Anbieter
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 91cc7306e7a13ef8e96ab032016a922411a70f95
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "104042088"
---
# <a name="shadow-copy-creation-for-providers"></a><span data-ttu-id="f0e87-103">Erstellen von Schatten Kopien für Anbieter</span><span class="sxs-lookup"><span data-stu-id="f0e87-103">Shadow Copy Creation for Providers</span></span>

## <a name="the-shadow-copy-creation-process"></a><span data-ttu-id="f0e87-104">Der Erstellungs Vorgang für Schatten Kopien</span><span class="sxs-lookup"><span data-stu-id="f0e87-104">The Shadow Copy Creation Process</span></span>

<span data-ttu-id="f0e87-105">Ein Anforderer ist die Anwendung, die die Anforderung initiiert, eine Schatten Kopie zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="f0e87-105">A requester is the application that initiates the request to create a shadow copy.</span></span> <span data-ttu-id="f0e87-106">In der Regel ist der Anforderer eine Sicherungs Anwendung.</span><span class="sxs-lookup"><span data-stu-id="f0e87-106">Typically the requester is a backup application.</span></span> <span data-ttu-id="f0e87-107">Bei Bedarf werden von VSS die beteiligten Anbieter aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="f0e87-107">As necessary, VSS will call the providers involved.</span></span> <span data-ttu-id="f0e87-108">Die meisten Anbieter sind an drei speziellen Anforderungen von der anfordernden Person interessiert.</span><span class="sxs-lookup"><span data-stu-id="f0e87-108">Most providers are interested in three specific requests from the requester.</span></span>

1.  <span data-ttu-id="f0e87-109">Der Anforderer beginnt mit der Erstellung der Schattenkopieerstellung mit einem Befehl für [**IVssBackupComponents:: startnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset).</span><span class="sxs-lookup"><span data-stu-id="f0e87-109">The requester begins the shadow copy creation activity with a call to [**IVssBackupComponents::StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset).</span></span> <span data-ttu-id="f0e87-110">Dadurch wird eine **GUID** des Typs "VSS-ID" generiert, die diesen speziellen **Schattenkopiesatz \_** eindeutig identifiziert: "snapshotsetid".</span><span class="sxs-lookup"><span data-stu-id="f0e87-110">This generates a **GUID** of type **VSS\_ID** that uniquely identifies this specific shadow copy set - the SnapshotSetId.</span></span> <span data-ttu-id="f0e87-111">Der Anbieter ist in diesem Schritt nicht beteiligt, aber die snapshotsetid wird in allen nachfolgenden Schritten ausgiebig verwendet.</span><span class="sxs-lookup"><span data-stu-id="f0e87-111">The provider is not involved in this step, but the SnapshotSetId is used extensively in all subsequent steps.</span></span>
2.  <span data-ttu-id="f0e87-112">Für jedes Volume, das in diesen Schattenkopiesatz aufgenommen werden soll, ruft der Anforderer [**IVssBackupComponents:: addtosnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addtosnapshotset)auf.</span><span class="sxs-lookup"><span data-stu-id="f0e87-112">For each volume it wishes to include in this shadow copy set, the requester calls [**IVssBackupComponents::AddToSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addtosnapshotset).</span></span> <span data-ttu-id="f0e87-113">VSS bestimmt, welcher Anbieter zum Schatten kopieren des Volumes verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="f0e87-113">VSS determines which provider will be used to shadow copy the volume.</span></span>
    -   <span data-ttu-id="f0e87-114">Mehrere Anbieter können an einem Schattenkopiesatz teilnehmen.</span><span class="sxs-lookup"><span data-stu-id="f0e87-114">Multiple providers may participate in a shadow copy set.</span></span> <span data-ttu-id="f0e87-115">Wenn z. b. das System Volume und ein Daten Volume Teil desselben schattenkopiesatzes sind, kann der Systemanbieter als Schattenkopieanbieter für das System Volume fungieren, während ein Hardware Anbieter als Schattenkopieanbieter für das Daten Volume fungieren kann.</span><span class="sxs-lookup"><span data-stu-id="f0e87-115">For example, if the system volume and a data volume are part of the same shadow copy set, the system provider may serve as the shadow copy provider for the system volume while a hardware provider may serve as the shadow copy provider for the data volume.</span></span> <span data-ttu-id="f0e87-116">Beide Anbieter sind Teil desselben schattenkopiespeichersets, und der Benutzer erwartet für beide Volumes dieselbe Zeit Punkt Konsistenz.</span><span class="sxs-lookup"><span data-stu-id="f0e87-116">Both providers would be part of the same shadow copy set and the user would expect the same point-in-time consistency across both volumes.</span></span>
    -   <span data-ttu-id="f0e87-117">Damit ein Hardware Anbieter ausgewählt werden kann, muss der Hardware Anbieter in der Lage sein, alle LUNs zu unterstützen, die zum angegebenen Volume beitragen.</span><span class="sxs-lookup"><span data-stu-id="f0e87-117">For a hardware provider to be selected, the hardware provider must be able to support all LUNs contributing to the specified volume.</span></span>
    -   <span data-ttu-id="f0e87-118">Alle registrierten Anbieter haben die Möglichkeit, die Unterstützung für ein bestimmtes Volume während der Erstellung von Schatten Kopien anzugeben.</span><span class="sxs-lookup"><span data-stu-id="f0e87-118">All registered providers are given the opportunity to indicate support for a given volume during shadow copy creation.</span></span> <span data-ttu-id="f0e87-119">Wenn mehr als ein Anbieter Unterstützung angibt, wird VSS zuerst standardmäßig Hardware Anbieter, dann Softwareanbieter und schließlich den Systemanbieter (wenn kein anderer Anbieter Unterstützung für dieses Volume anzeigt).</span><span class="sxs-lookup"><span data-stu-id="f0e87-119">If more than one provider indicates support, VSS will first default to hardware providers, then software providers, and finally the system provider (if no other provider indicates support for that volume).</span></span>
    -   <span data-ttu-id="f0e87-120">Ein Anforderer kann diese Standard Reihenfolge überschreiben, indem er explizit den Anbieter angibt, der zum Erstellen der Schatten Kopie erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="f0e87-120">A requester may override this default order by explicitly indicating the provider it requires to create the shadow copy.</span></span>
    -   <span data-ttu-id="f0e87-121">Wenn es mehrere Hardware Anbieter gibt, die ein bestimmtes Volume unterstützen, gibt es keine Garantie für die Reihenfolge, in der die Hardware Anbieter aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="f0e87-121">If there are multiple hardware providers that support a given volume, there is no guarantee to the order in which the hardware providers will be called.</span></span>
3.  <span data-ttu-id="f0e87-122">Nach einem oder mehreren Aufrufen von [**addtosnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addtosnapshotset)kann der Anforderer mithilfe der [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) -Methode zum Erstellen der Schatten Kopie aufgefordert werden.</span><span class="sxs-lookup"><span data-stu-id="f0e87-122">After one or more calls to [**AddToSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addtosnapshotset), the requester can ask for the shadow copy to be created by using the [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) method.</span></span> <span data-ttu-id="f0e87-123">VSS arbeitet dann mit dem System zusammen, um die Schatten Kopie zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="f0e87-123">VSS then works with the system to create the shadow copy.</span></span> <span data-ttu-id="f0e87-124">Die **DoSnapshotSet** -Methode führt diese Aufgabe asynchron aus, und der Anforderer kann entweder Abfragen oder darauf warten, dass der Vorgang zum Erstellen von Schatten Kopien beendet wird.</span><span class="sxs-lookup"><span data-stu-id="f0e87-124">The **DoSnapshotSet** method performs this work asynchronously, and the requester can either poll or wait for the shadow copy creation process to complete.</span></span>

<span data-ttu-id="f0e87-125">Dieses Diagramm zeigt die Interaktionen zwischen dem Anforderer, dem VSS-Dienst, der VSS-Kernel Unterstützung, den beteiligten VSS-Writern und VSS-Hardwareanbietern.</span><span class="sxs-lookup"><span data-stu-id="f0e87-125">This diagram shows the interactions between the requester, the VSS service, the VSS kernel support, any VSS writers involved, and any VSS hardware providers.</span></span> <span data-ttu-id="f0e87-126">Eine ausführliche Beschreibung dieser Interaktionen finden Sie [unter Erstellen von Schatten Kopien](the-shadow-copy-creation-process.md) .</span><span class="sxs-lookup"><span data-stu-id="f0e87-126">See [The Shadow Copy Creation Process](the-shadow-copy-creation-process.md) for a detailed description of these interactions.</span></span>

![Interaktionen zwischen Anforderer, Sicherungs Komponenten, Writern und Anbietern](images/vssimpl.png)

<span data-ttu-id="f0e87-128">Wenn der Vorgang zum Erstellen von Schatten Kopien abgeschlossen ist, kann der Anforderer ermitteln, ob die Erstellung der Schatten Kopie erfolgreich war, und andernfalls die Fehlerquelle ermitteln.</span><span class="sxs-lookup"><span data-stu-id="f0e87-128">When the shadow copy creation process is complete, the requester can determine if the shadow copy creation was successful, and if not, determine the source of the failure.</span></span>

<span data-ttu-id="f0e87-129">Das Zeitintervall zwischen dem Einfrieren und dem Bereinigen der Writer-Anwendungen muss minimiert werden.</span><span class="sxs-lookup"><span data-stu-id="f0e87-129">The time interval between the freeze and thaw of the writer applications must be minimized.</span></span> <span data-ttu-id="f0e87-130">Der Anbieter muss in der [**ivsshardwaresnapshotprovider:: beginpreparesnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-beginpreparesnapshot) -Methode asynchron alle Vorbereitungsarbeiten im Zusammenhang mit der Schatten Kopie (z. b. einen Hardware Anbieter, der die Synchronisierung startet) starten und dann auf die Vervollständigung in der [**ivssproviderkreatesnapshotset**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots)</span><span class="sxs-lookup"><span data-stu-id="f0e87-130">Provider must asynchronously start all preparation work related to the shadow copy (such as a hardware provider that uses plexes starting the synchronization) in the [**IVssHardwareSnapshotProvider::BeginPrepareSnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-beginpreparesnapshot) method, and then wait for the completions in the [**IVssProviderCreateSnapshotSet::EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots) method.</span></span>

<span data-ttu-id="f0e87-131">Es gibt mehrere Zeit Steuerungs Grenzen, die von Anbietern befolgt werden müssen.</span><span class="sxs-lookup"><span data-stu-id="f0e87-131">There are multiple timing limit windows that providers must follow.</span></span> <span data-ttu-id="f0e87-132">Daher führen wohl verhaltene Anbieter die gesamte unnötige Verarbeitung vor [**ivssproviderkreatesnapshotset aus::P recommitsnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-precommitsnapshots) und nach [**ivssproviderkreatesnapshotset::P ostcommitsnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots).</span><span class="sxs-lookup"><span data-stu-id="f0e87-132">As a result, well-behaved providers will perform all unnecessary processing before [**IVssProviderCreateSnapshotSet::PreCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-precommitsnapshots) and after [**IVssProviderCreateSnapshotSet::PostCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots).</span></span>

<span data-ttu-id="f0e87-133">Der Schattenkopiesatz wird korrigiert, wenn [**DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="f0e87-133">The shadow copy set is fixed when [**DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) is called.</span></span> <span data-ttu-id="f0e87-134">Zusätzliche Volumes können später nicht mehr hinzugefügt werden, da die zusätzlichen Volumes nicht denselben Zeitpunkt aufweisen würden.</span><span class="sxs-lookup"><span data-stu-id="f0e87-134">Additional volumes cannot be added later because the additional volumes would not share the same point-in-time.</span></span>

<span data-ttu-id="f0e87-135">Im Schattenkopiesatz ist ein Grenzwert von 64 Volumes vorhanden.</span><span class="sxs-lookup"><span data-stu-id="f0e87-135">There is a limit of 64 volumes in the shadow copy set.</span></span> <span data-ttu-id="f0e87-136">Ein bestimmtes Volume kann einer ganzen LUN, einem Teil einer LUN oder Teilen mehrerer LUNs zugeordnet werden.</span><span class="sxs-lookup"><span data-stu-id="f0e87-136">A specific volume may map to an entire LUN, a portion of a LUN, or portions of multiple LUNs.</span></span> <span data-ttu-id="f0e87-137">Die meisten Konfigurationen verfügen über ein Volume pro LUN, obwohl beliebige Zuordnungen möglich sind.</span><span class="sxs-lookup"><span data-stu-id="f0e87-137">Most configurations will have one volume per LUN, although arbitrary mappings are possible.</span></span>

<span data-ttu-id="f0e87-138">Es gibt keine Beschränkung der Anzahl von schattenkopiesätzen oder der Anzahl von schattenkopiesätzen eines ursprünglichen Volumes.</span><span class="sxs-lookup"><span data-stu-id="f0e87-138">There is no limit on the number of shadow copy sets or the number of shadow copy sets of an original volume.</span></span> <span data-ttu-id="f0e87-139">Ein Anbieter kann bestimmte Grenzwerte definieren oder basierend auf den verfügbaren Hardware Ressourcen eine dynamische Beschränkung festlegen.</span><span class="sxs-lookup"><span data-stu-id="f0e87-139">A provider may define specific limits, or dynamically limit based on hardware resources available.</span></span>

### <a name="point-in-time-for-writerless-applications"></a><span data-ttu-id="f0e87-140">Zeitpunkt für Schreib lose Anwendungen</span><span class="sxs-lookup"><span data-stu-id="f0e87-140">Point-in-time for Writerless Applications</span></span>

<span data-ttu-id="f0e87-141">VSS umfasst besondere Unterstützung, die den Zeit Punkt definiert, der für alle Volumes in einem Schattenkopiesatz verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="f0e87-141">VSS includes special support that defines the point-in-time that is common for all volumes in a shadow copy set.</span></span> <span data-ttu-id="f0e87-142">Hardware Anbieter müssen sich nicht direkt mit diesen Kernel Technologien verbinden, da Sie im Rahmen der normalen Verarbeitung von schattenkopiercommit aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="f0e87-142">Hardware providers do not need to directly interface with these kernel technologies, since they are invoked as part of the normal shadow copy commit processing.</span></span> <span data-ttu-id="f0e87-143">Es ist jedoch sinnvoll, die verwendeten Mechanismen zu verstehen, da die Definition von "Point-in-Time" für Schreib lose Anwendungen (Anwendungen, die keine VSS Writer-Schnittstelle verfügbar gemacht haben und daher nicht am Erstellungs Prozess der Volumeschattenkopie beteiligt sind) erläutert wird.</span><span class="sxs-lookup"><span data-stu-id="f0e87-143">However, it is useful to understand the mechanisms used because it explains the definition of 'point-in-time' for writerless applications (applications that have not exposed a VSS Writer interface and therefore do not participate in the volume shadow copy creation process.)</span></span>

<span data-ttu-id="f0e87-144">Diese VSS-Kernel Unterstützung für allgemeine Zeitpunkte wird zwischen dem VolSnap.sys-Treiber, den Dateisystemen und VSS verteilt.</span><span class="sxs-lookup"><span data-stu-id="f0e87-144">This VSS kernel support for common point-in-time is distributed between the VolSnap.sys driver, the file systems, and VSS.</span></span>

1.  <span data-ttu-id="f0e87-145">Bevor die VSS-Kernel Unterstützung aufgerufen wird, hat VSS bereits Folgendes:</span><span class="sxs-lookup"><span data-stu-id="f0e87-145">Before the VSS kernel support is invoked, VSS has already:</span></span>
    1.  <span data-ttu-id="f0e87-146">Bestimmt, welche Volumes an der Schatten Kopie beteiligt sein sollen.</span><span class="sxs-lookup"><span data-stu-id="f0e87-146">Determined which volumes are to be involved in the shadow copy.</span></span>
    2.  <span data-ttu-id="f0e87-147">Bestimmt, welcher Anbieter auf jedem Volume verwendet werden soll.</span><span class="sxs-lookup"><span data-stu-id="f0e87-147">Determined which provider is to be used on each volume.</span></span>
    3.  <span data-ttu-id="f0e87-148">Fixierte Anwendungen, die Freeze/Thaw-Nachrichten akzeptieren.</span><span class="sxs-lookup"><span data-stu-id="f0e87-148">Frozen applications that are accepting freeze/thaw messages.</span></span>
    4.  <span data-ttu-id="f0e87-149">Die Anbieter für die Schatten Kopie wurden durch Aufrufen der [**precommitshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-precommitsnapshots) -Methoden vorbereitet.</span><span class="sxs-lookup"><span data-stu-id="f0e87-149">Prepared the providers for the shadow copy by calling the [**PreCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-precommitsnapshots) methods.</span></span> <span data-ttu-id="f0e87-150">Alle Anbieter warten nun, dass die tatsächliche Erstellung von Schatten Kopien durchzuführen ist.</span><span class="sxs-lookup"><span data-stu-id="f0e87-150">All providers are now waiting to do the actual shadow copy creation.</span></span>
2.  <span data-ttu-id="f0e87-151">Der Zeitpunkt wird dann erstellt.</span><span class="sxs-lookup"><span data-stu-id="f0e87-151">The point-in-time is then created.</span></span> <span data-ttu-id="f0e87-152">VSS leert die Dateisysteme gleichzeitig auf allen Volumes, die als Schatten kopiert werden sollen.</span><span class="sxs-lookup"><span data-stu-id="f0e87-152">VSS concurrently flushes the file systems on all of the volumes that are to be shadow copied.</span></span>
    1.  <span data-ttu-id="f0e87-153">VSS gibt \_ \_ \_ \_ \_ für jedes Volume, das die Dateisysteme leert, einen Befehl zum Steuern von IOCTL Volsnap-und Hold-Schreibvorgängen aus.</span><span class="sxs-lookup"><span data-stu-id="f0e87-153">VSS issues an IOCTL\_VOLSNAP\_FLUSH\_AND\_HOLD\_WRITES control command on each volume that flushes the file systems.</span></span> <span data-ttu-id="f0e87-154">Diese IOCTL wird an VolSnap.sys an den Speicher Stapel übermittelt.</span><span class="sxs-lookup"><span data-stu-id="f0e87-154">That IOCTL is passed down the storage stack to VolSnap.sys.</span></span> <span data-ttu-id="f0e87-155">VolSnap.sys enthält dann alle Schreibvorgänge bis 4.</span><span class="sxs-lookup"><span data-stu-id="f0e87-155">VolSnap.sys then holds all write IRPs until step 4 below.</span></span> <span data-ttu-id="f0e87-156">Jedes Dateisystem (z. b. RAW) ohne Unterstützung dieser neuen ioctl übergibt die unbekannte IOCTL-–, wo Sie wieder von VolSnap.sys gehalten wird.</span><span class="sxs-lookup"><span data-stu-id="f0e87-156">Any file system (such as RAW) without support for this new IOCTL passes the unknown IOCTL down—where it is again held by VolSnap.sys.</span></span> <span data-ttu-id="f0e87-157">Auf NTFS-Volumes führt das Flush auch ein Commit für das NTFS-Protokoll aus.</span><span class="sxs-lookup"><span data-stu-id="f0e87-157">On NTFS volumes, the flush also commits the NTFS log.</span></span>
    2.  <span data-ttu-id="f0e87-158">Dadurch werden alle NTFS/FAT-metadatenaktivitäten angehalten. für die Dateisystem Metadaten ist ein ordnungsgemäßes Commit ausgeführt worden.</span><span class="sxs-lookup"><span data-stu-id="f0e87-158">This suspends all NTFS/FAT metadata activity; the file system metadata is cleanly committed.</span></span>
    3.  <span data-ttu-id="f0e87-159">Der Schatten Kopie-Instant: VolSnap.sys bewirkt, dass alle nachfolgenden Schreibvorgänge auf allen Volumes, die als Schatten kopiert werden sollen, in die Warteschlange eingereiht werden.</span><span class="sxs-lookup"><span data-stu-id="f0e87-159">The shadow copy instant: VolSnap.sys causes all subsequent write IRPs to be queued on all of the volumes that are to be shadow copied.</span></span>
    4.  <span data-ttu-id="f0e87-160">VolSnap.sys wartet auf den Abschluss aller ausstehenden Schreibvorgänge auf den schattenkopierten Volumes.</span><span class="sxs-lookup"><span data-stu-id="f0e87-160">VolSnap.sys waits for all pending writes on the shadow copied volumes to complete.</span></span> <span data-ttu-id="f0e87-161">Die Volumes sind nun in Bezug auf Schreibvorgänge inaktiv und wurden auf jedem Volume in genau demselben Moment inaktiv.</span><span class="sxs-lookup"><span data-stu-id="f0e87-161">The volumes are now quiescent with respect to writes, and were quiescent at exactly the same moment on each volume.</span></span> <span data-ttu-id="f0e87-162">Es gibt keine Garantie für Schreibzugriffe auf vom Benutzer zugeordnete Abschnitte oder Schreibvorgänge, die zwischen (a) und (b) auf Dateisystemen ausgegeben werden, die die leeren ioctl nicht implementieren (z. b. RAW).</span><span class="sxs-lookup"><span data-stu-id="f0e87-162">There are no guarantees about writes to user mapped sections or writes issued between (a) and (b) on file systems that do not implement the flush IOCTL (e.g. RAW).</span></span>
3.  <span data-ttu-id="f0e87-163">VSS weist jeden Anbieter an, die Schatten Kopie durch Aufrufen der [**ivssprovidercreatesnapshotset:: commitsnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots) -Methoden zu übernehmen.</span><span class="sxs-lookup"><span data-stu-id="f0e87-163">VSS instructs each provider to take in the shadow copy by calling the [**IVssProviderCreateSnapshotSet::CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots) methods.</span></span> <span data-ttu-id="f0e87-164">Die Anbieter sollten die gesamte Vorbereitung durchgeführt haben, damit dies ein schneller Vorgang ist.</span><span class="sxs-lookup"><span data-stu-id="f0e87-164">The providers should have all preparation done so that this is a quick operation.</span></span>

    <span data-ttu-id="f0e87-165">Beachten Sie, dass das e/a-System nur ineskalierend ist, während diese [**commitshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots) -Methoden ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="f0e87-165">Note that the I/O system is quiescent only while these [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots) methods are executing.</span></span> <span data-ttu-id="f0e87-166">Wenn ein Anbieter eine Synchronisierung der Quell-und schattenkopieluns ausführt, muss diese Synchronisierung abgeschlossen werden, bevor die **commitshots** -Methode des Anbieters zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="f0e87-166">If a provider performs any synchronization of the source and shadow copy LUNs, this synchronization must be completed before the provider's **CommitSnapshots** method returns.</span></span> <span data-ttu-id="f0e87-167">Sie kann nicht asynchron ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="f0e87-167">It cannot be performed asynchronously.</span></span>

4.  <span data-ttu-id="f0e87-168">Unmittelbar nach dem Zurückgeben der [**commitshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots) -Methode des letzten Anbieters gibt VSS alle ausstehenden Schreibvorgänge (einschließlich der unps, die die Dateisysteme am Ende ihrer commitpfade blockieren) durch Aufrufen eines anderen, an VolSnap.sys übergeben.</span><span class="sxs-lookup"><span data-stu-id="f0e87-168">Immediately after the last provider's [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots) method returns, VSS releases all pending write IRPs (including the IRPs that were blocking the file systems at the conclusion of their commit paths) by invoking another IRP passed to VolSnap.sys.</span></span>
5.  <span data-ttu-id="f0e87-169">Wenn der Schattenkopievorgang erfolgreich war, wird jetzt VSS angezeigt:</span><span class="sxs-lookup"><span data-stu-id="f0e87-169">If the shadow copy process was successful, then VSS now:</span></span>
    1.  <span data-ttu-id="f0e87-170">Ruft [**postcommitmomentaufnahmen**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots) für die beteiligten Anbieter auf.</span><span class="sxs-lookup"><span data-stu-id="f0e87-170">Calls [**PostCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots) for the providers involved.</span></span>
    2.  <span data-ttu-id="f0e87-171">Ruft [**CVssWriter:: OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw) für die beteiligten Writer auf.</span><span class="sxs-lookup"><span data-stu-id="f0e87-171">Calls [**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw) for the writers involved.</span></span>
    3.  <span data-ttu-id="f0e87-172">Benachrichtigt den Anforderer, dass der schattenkopieprozess abgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="f0e87-172">Informs the requester that the shadow copy process has completed.</span></span>

<span data-ttu-id="f0e87-173">[**Precommitmomentaufnahmen**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-precommitsnapshots), [**commitmomentaufnahmen**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots)und [**postcommitmomentaufnahmen**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots) sind Zeit kritisch.</span><span class="sxs-lookup"><span data-stu-id="f0e87-173">[**PreCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-precommitsnapshots), [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), to [**PostCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots) are all time critical.</span></span> <span data-ttu-id="f0e87-174">Alle e/a-Vorgänge von Anwendungen mit Writern werden von **präcommitmomentaufnahmen** zu **postcommitmomentaufnahmen** eingefroren. Verzögerungen wirken sich auf die Anwendungs Verfügbarkeit aus.</span><span class="sxs-lookup"><span data-stu-id="f0e87-174">All I/O from applications with writers is frozen from **PreCommitSnapshots** to **PostCommitSnapshots**; any delays affect application availability.</span></span> <span data-ttu-id="f0e87-175">Alle Datei-e/a-Vorgänge, einschließlich Schreib loser Anwendungs-e/a, werden während **commitmomentaufnahmen** angehalten.</span><span class="sxs-lookup"><span data-stu-id="f0e87-175">All file I/O, including writerless application I/O, is suspended during **CommitSnapshots**.</span></span>

<span data-ttu-id="f0e87-176">Anbieter sollten vor der Rückgabe von [**EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots)alle zeitkritischen Arbeiten ausführen.</span><span class="sxs-lookup"><span data-stu-id="f0e87-176">Providers should complete all time-critical work prior to returning from [**EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots).</span></span>

-   <span data-ttu-id="f0e87-177">[**Commitmomentaufnahmen**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots) sollten innerhalb von Sekunden zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="f0e87-177">[**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots) should be returned within seconds.</span></span> <span data-ttu-id="f0e87-178">Die **commitshots** -Phase befindet sich im Fenster "leeren" und "Speichern".</span><span class="sxs-lookup"><span data-stu-id="f0e87-178">The **CommitSnapshots** phase is located within the Flush and Hold window.</span></span> <span data-ttu-id="f0e87-179">Durch die VSS-Kernel Unterstützung wird die Leerung und die Aufbewahrung abgebrochen, die die e/a-Vorgänge enthält, wenn die nachfolgende Version nicht innerhalb von 10 Sekunden empfangen wird und VSS den Vorgang zum Erstellen von Schatten Kopien nicht besteht.</span><span class="sxs-lookup"><span data-stu-id="f0e87-179">VSS kernel support will cancel the Flush and Hold that is holding the I/O if the subsequent release is not received within 10 seconds, and VSS will fail the shadow copy creation process.</span></span> <span data-ttu-id="f0e87-180">Andere Aktivitäten werden auf dem System ausgeführt, sodass ein Anbieter nicht die vollen 10 Sekunden benötigen sollte.</span><span class="sxs-lookup"><span data-stu-id="f0e87-180">Other activities will be happening on the system, so a provider should not rely on having the full 10 seconds.</span></span> <span data-ttu-id="f0e87-181">Der Anbieter sollte während des Commit keine Win32-APIs aufzurufen, da viele zu unerwarteten Schreib-und Blockierungs Vorgängen führen.</span><span class="sxs-lookup"><span data-stu-id="f0e87-181">The provider should not call Win32 APIs during commit as many will result in unexpected writes and block.</span></span> <span data-ttu-id="f0e87-182">Wenn der Anbieter mehr als einige Sekunden Zeit benötigt, um den-Vorgang abzuschließen, besteht eine hohe Wahrscheinlichkeit, dass dies fehlschlägt.</span><span class="sxs-lookup"><span data-stu-id="f0e87-182">If the provider takes more than a few seconds to complete the call, there is a high probability that this will fail.</span></span>
-   <span data-ttu-id="f0e87-183">Die vollständige Sequenz von [**precommitmomentaufnahmen**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-precommitsnapshots) zur Rückgabe von [**postcommitmomentaufnahmen**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots) wird dem Fenster zwischen den Writern zugeordnet, die die Ereignisse zum Einfrieren und zum Durchsetzen des Ereignisses empfangen.</span><span class="sxs-lookup"><span data-stu-id="f0e87-183">The full sequence from [**PreCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-precommitsnapshots) to the return of [**PostCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots) maps to the window between writers receiving the Freeze and Thaw events.</span></span> <span data-ttu-id="f0e87-184">Der Writer-Standard für dieses Fenster ist 60 Sekunden, aber ein Writer kann diesen Wert mit einem kleineren Timeout überschreiben.</span><span class="sxs-lookup"><span data-stu-id="f0e87-184">The writer default for this window is 60 seconds, but a writer may override this value with a smaller timeout.</span></span> <span data-ttu-id="f0e87-185">Der Microsoft Exchange Server-Writer ändert z. b. den Timeout Wert auf 20 Sekunden.</span><span class="sxs-lookup"><span data-stu-id="f0e87-185">For example, the Microsoft Exchange Server writer changes the timeout to 20 seconds.</span></span> <span data-ttu-id="f0e87-186">Anbieter sollten in dieser Methode nicht mehr als eine Sekunde oder zwei Sekunden aufwenden.</span><span class="sxs-lookup"><span data-stu-id="f0e87-186">Providers should not spend more than a second or two in this method.</span></span>

<span data-ttu-id="f0e87-187">Während der [**commitmomentaufnahmen**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots) muss der Anbieter alle nicht Auslagerungs Datei-e/a-Vorgänge vermeiden. Diese e/a-Vorgänge haben eine sehr hohe Wahrscheinlichkeit für Deadlocks.</span><span class="sxs-lookup"><span data-stu-id="f0e87-187">During [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots) the provider must avoid any non-paging file I/O; such I/O has a very high probability of deadlocking.</span></span> <span data-ttu-id="f0e87-188">Insbesondere sollte der Anbieter keine Debug-oder Ablauf Verfolgungs Protokolle synchron schreiben.</span><span class="sxs-lookup"><span data-stu-id="f0e87-188">In particular, the provider should not synchronously write any debug or trace logs.</span></span>

 

 



