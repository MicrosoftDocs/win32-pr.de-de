---
description: Der Windows-Registrierungsdienst unterstützt eine VSS Writer, die als registrierungswriter bezeichnet wird und es Anforderern ermöglicht, eine Systemregistrierung mithilfe von Daten zu sichern, die auf einem Schatten kopierten Volume gespeichert sind.
ms.assetid: 94a45b04-0bdc-4211-bed0-caeabba774af
title: Sicherungs-und Wiederherstellungs Vorgänge für die Registrierung unter VSS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: db1a3022ec2fb08b07bcff8b28455ae7154e4c40
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "106348933"
---
# <a name="registry-backup-and-restore-operations-under-vss"></a><span data-ttu-id="89429-103">Sicherungs-und Wiederherstellungs Vorgänge für die Registrierung unter VSS</span><span class="sxs-lookup"><span data-stu-id="89429-103">Registry Backup and Restore Operations Under VSS</span></span>

<span data-ttu-id="89429-104">Der Windows-Registrierungsdienst unterstützt eine VSS Writer, die als registrierungswriter bezeichnet wird und es Anforderern ermöglicht, eine Systemregistrierung mithilfe von Daten zu sichern, die auf einem Schatten kopierten Volume gespeichert sind.</span><span class="sxs-lookup"><span data-stu-id="89429-104">The Windows Registry Service supports a VSS writer, called the registry writer, which allows requesters to back up a system registry using data stored on a shadow copied volume.</span></span> <span data-ttu-id="89429-105">Weitere Informationen zum registrierungswriter finden Sie unter [in-Box-VSS-Writer](in-box-vss-writers.md).</span><span class="sxs-lookup"><span data-stu-id="89429-105">For more information about the registry writer, see [In-Box VSS Writers](in-box-vss-writers.md).</span></span>

<span data-ttu-id="89429-106">Der Registrierungs Schreiber führt direkte Sicherungen und Wiederherstellungen der Registrierung aus.</span><span class="sxs-lookup"><span data-stu-id="89429-106">The registry writer performs in-place backups and restores of the registry.</span></span> <span data-ttu-id="89429-107">Außerdem meldet der Registrierungs Schreiber nur System Strukturen. Benutzer Strukturen werden nicht gemeldet.</span><span class="sxs-lookup"><span data-stu-id="89429-107">In addition, the registry writer reports only system hives; it does not report user hives.</span></span>

<span data-ttu-id="89429-108">**Windows Server 2003:** Der Registrierungs Schreiber verwendet eine zwischenrepository-Datei (auch als "spuckdatei" bezeichnet) zum Speichern von Registrierungsdaten.</span><span class="sxs-lookup"><span data-stu-id="89429-108">**Windows Server 2003:** The registry writer uses an intermediate repository file (also known as a spit file) to store registry data.</span></span> <span data-ttu-id="89429-109">Außerdem meldet der Registrierungs Schreiber System Strukturen und Benutzer Strukturen.</span><span class="sxs-lookup"><span data-stu-id="89429-109">In addition, the registry writer reports system hives and user hives.</span></span>

<span data-ttu-id="89429-110">Die Writer-ID für den Registrierungs Schreiber lautet AFBAB4A2-367D-4D15-A586-71DBB18F8485.</span><span class="sxs-lookup"><span data-stu-id="89429-110">The writer ID for the registry writer is AFBAB4A2-367D-4D15-A586-71DBB18F8485.</span></span>

<span data-ttu-id="89429-111">**Windows XP:** Es ist kein registrierungswriter vorhanden.</span><span class="sxs-lookup"><span data-stu-id="89429-111">**Windows XP:** There is no registry writer.</span></span> <span data-ttu-id="89429-112">Die Registrierungsdaten werden vom bootable State Writer berichtet, dessen Writer-ID F2436E37-09F5-41AF-9B2A-4CA2435DBFD5 lautet.</span><span class="sxs-lookup"><span data-stu-id="89429-112">The registry data is reported by the Bootable State writer, whose writer ID is F2436E37-09F5-41AF-9B2A-4CA2435DBFD5.</span></span>

> [!Note]  
> <span data-ttu-id="89429-113">Microsoft bietet keinen technischen Support für Entwickler oder IT-Experten für die Implementierung von Online-Systemstatus Wiederherstellungen unter Windows (alle Versionen).</span><span class="sxs-lookup"><span data-stu-id="89429-113">Microsoft does not provide developer or IT professional technical support for implementing online system state restores on Windows (all releases).</span></span> <span data-ttu-id="89429-114">Weitere Informationen zur Verwendung von von Microsoft bereitgestellten APIs und Prozeduren zum Implementieren von Online-Systemstatus Wiederherstellungen finden Sie in den Communityressourcen im [MSDN Community Center](https://msdn.microsoft.com/community/default.aspx).</span><span class="sxs-lookup"><span data-stu-id="89429-114">For information about using Microsoft-provided APIs and procedures to implement online system state restores, see the community resources available at the [MSDN Community Center](https://msdn.microsoft.com/community/default.aspx).</span></span>

 

> [!Note]  
> <span data-ttu-id="89429-115">Die folgenden Informationen gelten nur für Windows Server 2003 und Windows XP.</span><span class="sxs-lookup"><span data-stu-id="89429-115">The following information only applies to Windows Server 2003 and Windows XP.</span></span>

 

## <a name="registry-backup-using-vss"></a><span data-ttu-id="89429-116">Registrierungs Sicherung mithilfe von VSS</span><span class="sxs-lookup"><span data-stu-id="89429-116">Registry Backup Using VSS</span></span>

<span data-ttu-id="89429-117">Der registrierungswriter exportiert und speichert aktive Registrierungsdateien an den Speicherorten, die vom Schlüssel **HKEY \_ local \_ Machine** \\ **System** \\ **CurrentControlSet** \\ **Control** \\ **hivelist** definiert werden.</span><span class="sxs-lookup"><span data-stu-id="89429-117">The registry writer will export and save active registry files in the locations defined by the key **HKEY\_LOCAL\_MACHINE**\\**System**\\**CurrentControlSet**\\**Control**\\**hivelist**.</span></span>

<span data-ttu-id="89429-118">Die Namen der Werte unter diesem Registrierungs Eintrag identifizieren die zu speichernde Registrierungs Struktur, und die Daten des Werts enthalten die Datei, die die Datei enthält (die Hive-Datei).</span><span class="sxs-lookup"><span data-stu-id="89429-118">The names of the values under this registry entry identify the registry hive to be saved, and the value's data provides the file containing the file (the hive file).</span></span> <span data-ttu-id="89429-119">Die Hive-Dateien werden im folgenden Format angegeben: \\ Device \\ *harddiskvolumex* \\ *Pfad* \\ *Dateiname*.</span><span class="sxs-lookup"><span data-stu-id="89429-119">The hive files are specified with the following format: \\Device\\*HarddiskVolumeX*\\*path*\\*filename*.</span></span>

<span data-ttu-id="89429-120">Beispielsweise wird unter **HKEY \_ local \_ Machine** \\ **System** \\ **CurrentControlSet** \\ **Control** \\ **hivelist** möglicherweise die Geräte **\\ \\ \\ Software**  =  \\ Device \\ HarddiskVolume1 \\ Windows \\ system32 \\ config Software angezeigt \\ .</span><span class="sxs-lookup"><span data-stu-id="89429-120">For example, under **HKEY\_LOCAL\_MACHINE**\\**System**\\**CurrentControlSet**\\**Control**\\**hivelist**, you might see **\\REGISTRY\\MACHINE\\SOFTWARE** = \\Device\\HarddiskVolume1\\Windows\\System32\\config\\SOFTWARE.</span></span>

<span data-ttu-id="89429-121">Der Registrierungs Schreiber stellt sicher, dass Hive-Dateien vor der Schatten Kopie auf dem Datenträger gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="89429-121">The registry writer ensures that hive files are saved to disk prior to its shadow copy.</span></span>

<span data-ttu-id="89429-122">Beim Sichern der Registrierungs Strukturen ersetzt ein Anforderer das \\ Gerät \\ *harddiskvolumex* durch die [*Geräte Objekt*](vssgloss-d.md) Zeichenfolge der Schatten Kopie des Volumes.</span><span class="sxs-lookup"><span data-stu-id="89429-122">When backing up the registry hives, a requester would replace \\Device\\*HarddiskVolumeX* with the [*device object*](vssgloss-d.md) string of the volume's shadow copy.</span></span>

> [!Note]  
> <span data-ttu-id="89429-123">Sie können den \\ \\ *harddiskvolumex* -Pfad des Geräts mithilfe der [**querydosdevice**](/windows/win32/api/fileapi/nf-fileapi-querydosdevicew) -Funktion in einen entsprechenden Win32-Pfad konvertieren.</span><span class="sxs-lookup"><span data-stu-id="89429-123">You can convert the \\Device\\*HarddiskVolumeX* path to an equivalent Win32 path by using the [**QueryDosDevice**](/windows/win32/api/fileapi/nf-fileapi-querydosdevicew) function.</span></span> <span data-ttu-id="89429-124">Weitere Informationen finden Sie unter Abrufen [eines Datei namens von einem Datei Handle](../memory/obtaining-a-file-name-from-a-file-handle.md) oder [Anzeigen von volumepfadnamen](../fileio/displaying-volume-paths.md).</span><span class="sxs-lookup"><span data-stu-id="89429-124">For more information, see [Obtaining a File Name From a File Handle](../memory/obtaining-a-file-name-from-a-file-handle.md) or [Displaying Volume Path Names](../fileio/displaying-volume-paths.md).</span></span>

 

## <a name="registry-restore-using-non-vss-win32-apis"></a><span data-ttu-id="89429-125">Registrierungs Wiederherstellung mit nicht-VSS-Win32-APIs</span><span class="sxs-lookup"><span data-stu-id="89429-125">Registry Restore Using Non-VSS Win32 APIs</span></span>

<span data-ttu-id="89429-126">Bei einer Online Wiederherstellung (Abgesicherter Modus oder vollständiges Betriebssystem) müssen die untergeordneten Schlüssel im **HKEY \_ local \_ Machine** \\ **System** \\ **CurrentControlSet** \\ **Control** \\ **Session Manager**" \\ **pdingfilerenameoperations** " gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="89429-126">For an online (safe mode or full operating system) restore, the subkeys in the **HKEY\_LOCAL\_MACHINE**\\**SYSTEM**\\**CurrentControlSet**\\**Control**\\**Session Manager**\\**PendingFileRenameOperations** registry key must be preserved.</span></span>

<span data-ttu-id="89429-127">Die Funktionen " [**fivefileex**](/windows/win32/api/winbase/nf-winbase-movefileexa) " und " [**muvefiletransall**](/windows/win32/api/winbase/nf-winbase-movefiletransacteda) " verwenden diesen Registrierungsschlüssel zum Speichern von Informationen zu Dateien, die mit dem \_ Wert "verzögerten verzögerten Datei Verzögerung" \_ \_ im Parameter " *dwFlags* " umbenannt wurden.</span><span class="sxs-lookup"><span data-stu-id="89429-127">The [**MoveFileEx**](/windows/win32/api/winbase/nf-winbase-movefileexa) and [**MoveFileTransacted**](/windows/win32/api/winbase/nf-winbase-movefiletransacteda) functions use this registry key to store information about files that were renamed by using the MOVEFILE\_DELAY\_UNTIL\_REBOOT value in the *dwFlags* parameter.</span></span>

<span data-ttu-id="89429-128">Um den Inhalt des Registrierungsschlüssels " **pdingfilerenameoperations** " beizubehalten, sollte die Sicherungs Anwendung die [**RegLoadKey**](/windows/win32/api/winreg/nf-winreg-regloadkeya) -Funktion aufrufen, um die wieder herzustellende Registrierungsdatei in der aktiven Registrierung zu verbinden.</span><span class="sxs-lookup"><span data-stu-id="89429-128">To preserve the contents of the **PendingFileRenameOperations** registry key, your backup application should call the [**RegLoadKey**](/windows/win32/api/winreg/nf-winreg-regloadkeya) function to connect the registry file to be restored to the active registry.</span></span> <span data-ttu-id="89429-129">Die Sicherungs Anwendung kann dann die verschiedenen Registrierungsfunktionen verwenden, um die gewünschten Schlüssel und Werte in die geladene Struktur zu kopieren.</span><span class="sxs-lookup"><span data-stu-id="89429-129">Your backup application can then use the various registry functions to copy the desired keys and values into the loaded hive.</span></span> <span data-ttu-id="89429-130">Nachdem der Kopiervorgang beendet wurde, sollten die Funktionen [**regflushkey**](/windows/win32/api/winreg/nf-winreg-regflushkey) und [**regunloadkey**](/windows/win32/api/winreg/nf-winreg-regunloadkeya) aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="89429-130">After the copy is complete, the [**RegFlushKey**](/windows/win32/api/winreg/nf-winreg-regflushkey) and [**RegUnloadKey**](/windows/win32/api/winreg/nf-winreg-regunloadkeya) functions should be called.</span></span>

<span data-ttu-id="89429-131">Bei einer Offline Wiederherstellung (Windows Recovery Environment oder Windows PE) ist es nicht notwendig, den Registrierungsschlüssel " **pdingfilerenameoperations** " einzuhalten.</span><span class="sxs-lookup"><span data-stu-id="89429-131">For an offline (Windows Recovery Environment or Windows PE) restore, it is not necessary to honor the **PendingFileRenameOperations** registry key.</span></span>

## <a name="registry-restore-using-non-vss-win32-apis-in-windows-server-2003"></a><span data-ttu-id="89429-132">Wiederherstellung der Registrierung mithilfe von nicht-VSS-Win32-APIs in Windows Server 2003</span><span class="sxs-lookup"><span data-stu-id="89429-132">Registry Restore Using Non-VSS Win32 APIs in Windows Server 2003</span></span>

> [!Note]  
> <span data-ttu-id="89429-133">Die folgenden Informationen gelten nur für Wiederherstellungs Vorgänge im Zusammenhang mit der Notfall Wiederherstellung (auch als Bare-Metal-Recovery bezeichnet), die in Windows Server 2003 ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="89429-133">The following information applies only to restore operations related to disaster recovery (also known as bare-metal recovery) that are performed in Windows Server 2003.</span></span>

 

<span data-ttu-id="89429-134">Beim Wiederherstellen der Registrierung muss eine Sicherungs Anwendung einige der Unterschlüssel aus der aktuellen Registrierung in die wieder herzustellende Registrierung verschieben.</span><span class="sxs-lookup"><span data-stu-id="89429-134">When restoring the registry, a backup application needs to move some of the subkeys from the current registry into the registry that is to be restored.</span></span>

<span data-ttu-id="89429-135">Zu diesem Zweck kann eine Sicherungs Anwendung **RegLoadKey** zum Verbinden der Registrierungsdatei verwenden, die mit der aktuell aktiven Registrierung wieder hergestellt werden soll.</span><span class="sxs-lookup"><span data-stu-id="89429-135">To do this, a backup application can call **RegLoadKey** to connect the registry file to be restored to the currently active registry.</span></span> <span data-ttu-id="89429-136">Anschließend können die verschiedenen Registrierungsfunktionen verwendet werden, um die gewünschten Schlüssel und Werte in die geladene Struktur zu kopieren.</span><span class="sxs-lookup"><span data-stu-id="89429-136">It can then use the various registry functions to copy the desired keys and values into the loaded hive.</span></span> <span data-ttu-id="89429-137">Nachdem der Kopiervorgang beendet wurde, werden **regflushkey** und **regunloadkey** aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="89429-137">After the copy is complete, **RegFlushKey** and **RegUnloadKey** are called.</span></span>

<span data-ttu-id="89429-138">Es gibt einen Registrierungsschlüssel, der einer Wiederherstellungs Anwendung (Anforderer) die Registrierungsschlüssel unter **HKEY \_ local \_ Machine \\ System** anzeigt, die zum Zeitpunkt der Wiederherstellung nicht überschrieben werden sollen:</span><span class="sxs-lookup"><span data-stu-id="89429-138">There is a registry key that indicates to a restore application (requester) the registry keys under **HKEY\_LOCAL\_MACHINE\\SYSTEM** that should not be overwritten at restore time:</span></span>

<span data-ttu-id="89429-139">**HKEY \_ local \_ Machine \\ System \\ CurrentControlSet \\ Control \\ backuprestore \\ keysnottorestore**</span><span class="sxs-lookup"><span data-stu-id="89429-139">**HKEY\_LOCAL\_MACHINE\\System\\CurrentControlSet\\Control\\BackupRestore\\KeysNotToRestore**</span></span>

<span data-ttu-id="89429-140">Ein Teil der Wiederherstellung des Systemstatus ist das Wiederherstellen einer zuvor gesicherten Registrierung.</span><span class="sxs-lookup"><span data-stu-id="89429-140">Part of the system state restore process involves restoring a previously backed-up registry.</span></span>

<span data-ttu-id="89429-141">Sicherungs Anwendungen müssen bei der Wiederherstellung der Systemstruktur des **lokalen HKEY \_ \_ \\** -Computers besondere Sorgfalt walten lassen, da bei der Installation einer temporären Version des Windows-Betriebssystems Schlüssel in der neu installierten System Struktur eingerichtet werden, deren Werte den Wiederherstellungs Vorgang überstehen müssen.</span><span class="sxs-lookup"><span data-stu-id="89429-141">Backup applications need to take special care when restoring the **HKEY\_LOCAL\_MACHINE\\SYSTEM** hive because the process of installing a temporary version of the Windows operating system will have established keys in the newly installed system hive whose values must survive the restore operation.</span></span>

<span data-ttu-id="89429-142">Wenn sich beispielsweise das Ersatzsystem eine Netzwerkschnittstellenkarte vom ursprünglichen System unterscheidet, führt das Wiederherstellen der ursprünglichen Schlüssel für die vorherige Karte zu unvorhersehbaren Ergebnissen.</span><span class="sxs-lookup"><span data-stu-id="89429-142">For example, when the replacement system has a network interface card different from the original system, restoration of the original keys for the previous card will lead to unpredictable results.</span></span> <span data-ttu-id="89429-143">Dies liegt daran, dass der Plug & Play Dienst die ordnungsgemäßen Dienst-und Treiber Registrierungseinträge in der Registrierung erkannt und abgelegt hat.</span><span class="sxs-lookup"><span data-stu-id="89429-143">This is because the Plug and Play service has detected and placed proper service and driver registry entries into the registry.</span></span> <span data-ttu-id="89429-144">Diese Werte müssen beibehalten werden, damit Sie nach der Systemwiederherstellung ordnungsgemäß gestartet werden.</span><span class="sxs-lookup"><span data-stu-id="89429-144">These values must be preserved to properly boot after system restore.</span></span>

<span data-ttu-id="89429-145">In diesem Abschnitt wird beschrieben, wie Sicherungs Anwendungen ermitteln können, welche Schlüssel und Dateien bei der Ausführung einer Wiederherstellung der **\_ \_ \\ System Struktur des lokalen HKEY** -Computers beibehalten werden müssen.</span><span class="sxs-lookup"><span data-stu-id="89429-145">This section describes how backup applications can discover which keys and files are to be preserved when executing a restore of the **HKEY\_LOCAL\_MACHINE\\SYSTEM** hive.</span></span> <span data-ttu-id="89429-146">In einigen Fällen umfasst dies Programm gesteuertes Kopieren der Schlüssel aus der neu installierten Installations Struktur in die wieder herzustellende Hive-Struktur.</span><span class="sxs-lookup"><span data-stu-id="89429-146">In some cases, this will involve programmatically copying the keys from the newly installed installation hive into the hive to be restored.</span></span> <span data-ttu-id="89429-147">In anderen Fällen ist die Sicherstellung, dass die Registrierungsschlüssel eines Produkts nicht ersetzt werden, so einfach wie das Angeben dieser Schlüssel in der INF-Konfigurationsdatei des Produkts.</span><span class="sxs-lookup"><span data-stu-id="89429-147">In other cases, ensuring that a product's registry keys are not replaced is as simple as specifying such keys in the product's INF configuration file.</span></span>

<span data-ttu-id="89429-148">Schlüssel (und Schlüsseldaten), die beibehalten werden sollen, werden in der **HKEY- \_ \_ \\ System** Struktur des lokalen Computers aufgelistet.</span><span class="sxs-lookup"><span data-stu-id="89429-148">Keys (and key data) that are to be preserved are enumerated in the **HKEY\_LOCAL\_MACHINE\\SYSTEM** hive under the</span></span>

<span data-ttu-id="89429-149">**HKEY \_ local \_ Machine \\ System \\ CurrentControlSet \\ Control \\ backuprestore \\ keysnottorestore**</span><span class="sxs-lookup"><span data-stu-id="89429-149">**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\BackupRestore\\KeysNotToRestore**</span></span>

<span data-ttu-id="89429-150">Schlüssel als Sätze von reg \_ MultiSZ-Zeichen folgen \_ (in diesem Dokument als *Schlüssel* Zeichenfolgen bezeichnet).</span><span class="sxs-lookup"><span data-stu-id="89429-150">key as sets of REG\_MULTI\_SZ strings (called *key strings* in this document).</span></span>

<span data-ttu-id="89429-151">Eine Sicherungs Anwendung (Anforderer) muss die Werte dieser Schlüssel in der aktiven Registrierung und der neu wiederhergestellten Registrierung untersuchen, da jede Anwendung oder jeder Dienst Werte jederzeit hinzufügen kann.</span><span class="sxs-lookup"><span data-stu-id="89429-151">A backup application (requester) must examine the values of these keys in the active registry and the newly restored registry because any application or service can add values at any time.</span></span>

<span data-ttu-id="89429-152">Wie Schlüssel Zeichenfolgen von Sicherungs Anwendungen interpretiert werden sollen, hängt von Ihrem Endzeichen ab:</span><span class="sxs-lookup"><span data-stu-id="89429-152">How key strings are to be interpreted by backup applications is determined by their terminal character:</span></span>

1.  <span data-ttu-id="89429-153">Schlüssel Zeichenfolgen, die mit einem umgekehrten Schrägstrich (" \\ ") beendet werden, werden als Unterschlüssel interpretiert.</span><span class="sxs-lookup"><span data-stu-id="89429-153">Key strings terminated with a backslash ('\\') are interpreted as subkeys.</span></span> <span data-ttu-id="89429-154">Wenn eine solche Teil Zeichenfolge gefunden wird, muss die Sicherungs Anwendung alle Daten und alle untergeordneten Schlüssel beibehalten.</span><span class="sxs-lookup"><span data-stu-id="89429-154">When such a substring is encountered, the backup application must preserve all data and all subordinate keys.</span></span>

    <span data-ttu-id="89429-155">Im folgenden Beispiel wird angegeben, dass alle untergeordneten Schlüssel und Daten bei einem Wiederherstellungs Vorgang beibehalten werden sollen:</span><span class="sxs-lookup"><span data-stu-id="89429-155">For example, the following specifies that all subordinate keys and data are to be preserved across a restore operation:</span></span>

    <span data-ttu-id="89429-156">**HKEY \_ local \_ Machine \\ System \\ CurrentControlSet \\ Services \\ Dmio \\ Boot Info\\**</span><span class="sxs-lookup"><span data-stu-id="89429-156">**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\dmio\\boot info\\**</span></span>

    <span data-ttu-id="89429-157">Zu diesem Zweck müssen dieser Schlüssel und alle untergeordneten Schlüssel und Daten aus der vorhandenen Registrierung (d. h. der von der Windows-Installation erstellten) in die neu wiederhergestellte Registrierung kopiert werden.</span><span class="sxs-lookup"><span data-stu-id="89429-157">To this end, this key and all subordinate keys and data must be copied from the existing registry (that is, the one created by the installation of Windows) into the newly restored registry.</span></span> <span data-ttu-id="89429-158">Dies wird als *Schlüssel Ersetzungs* Vorgang bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="89429-158">This is called a *key replace* operation.</span></span> <span data-ttu-id="89429-159">Dieser Vorgang ersetzt den entsprechenden Schlüssel in der wiederhergestellten Registrierung.</span><span class="sxs-lookup"><span data-stu-id="89429-159">This operation replaces the corresponding key in the restored registry.</span></span>

2.  <span data-ttu-id="89429-160">Schlüssel Zeichenfolgen, deren Beendigungs Zeichen ein Sternchen (" \* ") ist, gibt an, dass alle Unterschlüssel zusammengeführt werden sollen.</span><span class="sxs-lookup"><span data-stu-id="89429-160">Key strings whose termination character is an asterisk ('\*') specifies that all subkeys should be merged.</span></span> <span data-ttu-id="89429-161">Beispielsweise ist die Schlüssel Zeichenfolge:</span><span class="sxs-lookup"><span data-stu-id="89429-161">For example, the key string:</span></span>

    <span data-ttu-id="89429-162">\**HKEY \_ Lokales \_ Computer \\ System \\ CurrentControlSet \\ Services \\ \** _</span><span class="sxs-lookup"><span data-stu-id="89429-162">\**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\\** _</span></span>

    <span data-ttu-id="89429-163">Gibt an, dass der Dienst Schlüssel in der vorhandenen Registrierung (z. b. die von der Installation von Windows erstellten) in der wiederhergestellten Registrierung zusammengeführt werden muss.</span><span class="sxs-lookup"><span data-stu-id="89429-163">specifies that the services key in the existing registry (for example those created by the installation of Windows) must be merged into the restored registry.</span></span> <span data-ttu-id="89429-164">Dies wird als _Key Merge \*-Vorgang bezeichnet, und wenn ein Unterschlüssel sowohl in der vorhandenen Hive als auch in der wiederhergestellten Hive vorhanden ist, wird der Schlüssel im wiederhergestellten Verzeichnis mit den folgenden Ausnahmen beibehalten:</span><span class="sxs-lookup"><span data-stu-id="89429-164">This is called a _key merge\* operation, and if a subkey exists in both the existing hive and the restored hive, the key in the restored directory is preserved with the following exceptions:</span></span>

    -   <span data-ttu-id="89429-165">, Wenn der Unterschlüssel in der vorhandenen Struktur einen Wert mit dem Namen "Start" enthält und der Unterschlüssel in der wiederhergestellten nicht.</span><span class="sxs-lookup"><span data-stu-id="89429-165">If the subkey in the existing hive contains a value named "start", and the subkey in the restored does not.</span></span>
    -   <span data-ttu-id="89429-166">Wenn der Unterschlüssel sowohl in der vorhandenen als auch in der wiederhergestellten Hive einen Wert mit dem Namen "Start" enthält und der numerische Wert in der vorhandenen Hive kleiner ist.</span><span class="sxs-lookup"><span data-stu-id="89429-166">If the subkey in both the existing and restored hive contain a value named "start", and its numeric value in the existing hive is less.</span></span>

    <span data-ttu-id="89429-167">Der "Start"-Wert in der Registrierung gibt an, wann ein Dienst oder Treiber gestartet wird und einen numerischen Wert von 0-4 aufweisen kann.</span><span class="sxs-lookup"><span data-stu-id="89429-167">The "start" value in the registry specifies when a service or driver will start and can have a numeric value from 0-4.</span></span> <span data-ttu-id="89429-168">Je niedriger der Wert ist, desto früher wird der Dienst gestartet.</span><span class="sxs-lookup"><span data-stu-id="89429-168">The lower the value, the sooner in the boot process the service will start.</span></span>

    <span data-ttu-id="89429-169">Wenn dieser Schlüssel sowohl für das vorhandene als auch das wiederhergestellte Verzeichnis vorhanden ist, müssen Sie den Wert der Start Taste in jeder Hive überprüfen.</span><span class="sxs-lookup"><span data-stu-id="89429-169">If this key exists in both the existing and the restored directory, you must examine the value of the start key in each hive.</span></span> <span data-ttu-id="89429-170">Wenn der Wert in der vorhandenen Hive niedriger als der Wert im wiederhergestellten Verzeichnis ist, muss der niedrigere Wert beibehalten werden.</span><span class="sxs-lookup"><span data-stu-id="89429-170">If the value in the existing hive is lower than the value in the restored directory, the lower value must be preserved.</span></span>

    <span data-ttu-id="89429-171">Der Schlüssel wird erneut verwendet, um zu bestimmen, ob ein Dienst oder Treiber bei der Systemzeit, manuell, automatisch oder deaktiviert gestartet werden soll.</span><span class="sxs-lookup"><span data-stu-id="89429-171">Once again, this key is used to determine whether a service or driver is to be started at boot time, at system time, manually, automatically, or be disabled.</span></span> <span data-ttu-id="89429-172">Der niedrigere Wert stellt eine frühere Startzeit dar.</span><span class="sxs-lookup"><span data-stu-id="89429-172">The lower value represents an earlier start time.</span></span> <span data-ttu-id="89429-173">Die frühere Startzeit muss auf die neue Registrierung angewendet werden, um sicherzustellen, dass der Dienst oder die Treiber beim nächsten Start ordnungsgemäß gestartet werden.</span><span class="sxs-lookup"><span data-stu-id="89429-173">The earlier start time must be applied to the new registry to ensure that the service or drivers are started properly at the next boot.</span></span>

3.  <span data-ttu-id="89429-174">Schlüssel Zeichenfolgen, deren Beendigungs Zeichen weder ein umgekehrter Schrägstrich noch ein Sternchen ist, werden als zu erhaltene Registrierungs Werte interpretiert.</span><span class="sxs-lookup"><span data-stu-id="89429-174">Key strings whose termination character is neither a backslash nor an asterisk are interpreted as registry values to be preserved.</span></span>

    <span data-ttu-id="89429-175">Beispielsweise ist die Schlüssel Zeichenfolge:</span><span class="sxs-lookup"><span data-stu-id="89429-175">For example, the key string:</span></span>

    <span data-ttu-id="89429-176">**HKEY \_ local \_ Machine \\ System \\ CurrentControlSet \\ Control \\ Session Manager \\ pdingfilerenameoperations**</span><span class="sxs-lookup"><span data-stu-id="89429-176">**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\PendingFileRenameOperations**</span></span>

    <span data-ttu-id="89429-177">Der Mechanismus, mit dem Schlüsselprogramm gesteuert aufbewahrt werden können, umfasst die Win32-Registrierungs-API.</span><span class="sxs-lookup"><span data-stu-id="89429-177">The mechanism by which keys can be preserved programmatically involves the Win32 registry API.</span></span> <span data-ttu-id="89429-178">Beispielsweise ist ein Algorithmus unten aufgeführt:</span><span class="sxs-lookup"><span data-stu-id="89429-178">For example, one algorithm is enumerated below:</span></span>

    1.  <span data-ttu-id="89429-179">Stellen Sie die gesicherte Systemstruktur Datei in einer Datei wieder her.</span><span class="sxs-lookup"><span data-stu-id="89429-179">Restore the backed-up system hive file to a file.</span></span> <span data-ttu-id="89429-180">Nennen Sie in diesem Beispiel den Namen System. reg.</span><span class="sxs-lookup"><span data-stu-id="89429-180">For this example, let the name be System.reg.</span></span>
    2.  <span data-ttu-id="89429-181">Verwenden Sie **RegLoadKey** , um System. reg unter einem temporären Namen in **den lokalen HKEY- \_ \_ Computer** zu laden.</span><span class="sxs-lookup"><span data-stu-id="89429-181">Use **RegLoadKey** to load System.reg into **HKEY\_LOCAL\_MACHINE** under a temporary name.</span></span> <span data-ttu-id="89429-182">Ein solcher Name könnte z. b. lauten.</span><span class="sxs-lookup"><span data-stu-id="89429-182">For example, one such name might be</span></span>

        <span data-ttu-id="89429-183">**\_ \_ \\ tmp-System des lokalen \_ HKEY-Computers**</span><span class="sxs-lookup"><span data-stu-id="89429-183">**HKEY\_LOCAL\_MACHINE\\TMP\_SYSTEM**</span></span>

    3.  <span data-ttu-id="89429-184">Zählen Sie die Werte im Unterschlüssel **keysnottorestore** aus beiden Registrierungs Kopien auf, und erstellen Sie eine übergeordnete Gruppe der Listen.</span><span class="sxs-lookup"><span data-stu-id="89429-184">Enumerate the values in the **KeysNotToRestore** subkey from both of the registry copies and create a superset of the lists.</span></span> <span data-ttu-id="89429-185">Jeden solchen Schlüssel aus dem vorhandenen kopieren</span><span class="sxs-lookup"><span data-stu-id="89429-185">Copy each such key from the existing</span></span>

        <span data-ttu-id="89429-186">**lokales HKEY- \_ \_ Computer \\ System**</span><span class="sxs-lookup"><span data-stu-id="89429-186">**HKEY\_LOCAL\_MACHINE\\SYSTEM**</span></span>

        <span data-ttu-id="89429-187">Schlüssel in den</span><span class="sxs-lookup"><span data-stu-id="89429-187">key into the</span></span>

        <span data-ttu-id="89429-188">**\_ \_ \\ tmp-System des lokalen \_ HKEY-Computers**</span><span class="sxs-lookup"><span data-stu-id="89429-188">**HKEY\_LOCAL\_MACHINE\\TMP\_SYSTEM**</span></span>

        <span data-ttu-id="89429-189">Schlüssel gemäß der oben beschriebenen Semantik.</span><span class="sxs-lookup"><span data-stu-id="89429-189">key according to the semantics described above.</span></span>

    4.  <span data-ttu-id="89429-190">Wenn Sie fertig sind, verwenden Sie die Einstiegspunkte für **regflushkey**  &  **regunloadkey** , um das</span><span class="sxs-lookup"><span data-stu-id="89429-190">When complete use the **RegFlushKey** & **RegUnloadKey** entry points to save the</span></span>

        <span data-ttu-id="89429-191">**\_ \_ \\ tmp-System des lokalen \_ HKEY-Computers**</span><span class="sxs-lookup"><span data-stu-id="89429-191">**HKEY\_LOCAL\_MACHINE\\TMP\_SYSTEM**</span></span>

        <span data-ttu-id="89429-192">der Schlüssel wird zurück zu "System. reg".</span><span class="sxs-lookup"><span data-stu-id="89429-192">key back to System.reg.</span></span>

    5.  <span data-ttu-id="89429-193">Verwenden Sie abschließend **RegReplaceKey** , um anzugeben, dass System. reg das</span><span class="sxs-lookup"><span data-stu-id="89429-193">Finally, use **RegReplaceKey** to specify that System.reg is to replace the</span></span>

        <span data-ttu-id="89429-194">**lokales HKEY- \_ \_ Computer \\ System**</span><span class="sxs-lookup"><span data-stu-id="89429-194">**HKEY\_LOCAL\_MACHINE\\SYSTEM**</span></span>

        <span data-ttu-id="89429-195">Hive-Datei, System.</span><span class="sxs-lookup"><span data-stu-id="89429-195">hive file, SYSTEM.</span></span>

 

 
