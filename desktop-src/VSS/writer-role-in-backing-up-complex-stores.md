---
description: Erfahren Sie mehr über die Rolle "Writer" bei inkrementellen und differenziellen Sicherungen, die eine enge Zusammenarbeit zwischen Anfordernden und Writern erfordern.
ms.assetid: 3cf5dd1f-dc58-42bc-925f-fee7d34053c5
title: Rolle "Writer" beim Sichern komplexer Speicher
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 30e34952cc4a2184d2f9abcc43283d24f64bdcc3
ms.sourcegitcommit: d0eb44d0a95f5e5efbfec3d3e9c143f5cba25bc3
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 06/17/2021
ms.locfileid: "112262152"
---
# <a name="writer-role-in-backing-up-complex-stores"></a><span data-ttu-id="e22a2-103">Rolle "Writer" beim Sichern komplexer Speicher</span><span class="sxs-lookup"><span data-stu-id="e22a2-103">Writer Role in Backing Up Complex Stores</span></span>

<span data-ttu-id="e22a2-104">Wie bei allen wichtigen Vorgängen unter VSS erfordern [*inkrementelle*](vssgloss-i.md) und [*differenzielle*](vssgloss-d.md) Sicherungen eine enge Zusammenarbeit zwischen Anfordernden und Writern.</span><span class="sxs-lookup"><span data-stu-id="e22a2-104">As with all important operations under VSS, [*incremental*](vssgloss-i.md) and [*differential*](vssgloss-d.md) backups require close cooperation between requesters and writers.</span></span>

## <a name="backup-types"></a><span data-ttu-id="e22a2-105">Sicherungstypen</span><span class="sxs-lookup"><span data-stu-id="e22a2-105">Backup Types</span></span>

<span data-ttu-id="e22a2-106">Die Infrastruktur bietet spezielle Unterstützung für fünf Sicherungstypen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-106">The infrastructure provides special support for five types of backup.</span></span> <span data-ttu-id="e22a2-107">Die Schritte lassen sich wie folgt beschreiben:</span><span class="sxs-lookup"><span data-stu-id="e22a2-107">They are described as follows:</span></span>

-   <span data-ttu-id="e22a2-108">Full (**VSS \_ BT \_ FULL**).</span><span class="sxs-lookup"><span data-stu-id="e22a2-108">Full (**VSS\_BT\_FULL**).</span></span> <span data-ttu-id="e22a2-109">Dateien werden unabhängig vom letzten Sicherungsdatum gesichert.</span><span class="sxs-lookup"><span data-stu-id="e22a2-109">Files will be backed up regardless of their last backup date.</span></span> <span data-ttu-id="e22a2-110">Der Sicherungsverlauf jeder Datei wird aktualisiert, und dieser Sicherungstyp kann als Grundlage für eine inkrementelle oder differenzielle Sicherung verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="e22a2-110">The backup history of each file will be updated, and this type of backup can be used as the basis of an incremental or differential backup.</span></span> <span data-ttu-id="e22a2-111">Wenn Protokolldateien enthalten sind, werden sie möglicherweise als Ergebnis dieser Sicherung abgeschnitten.</span><span class="sxs-lookup"><span data-stu-id="e22a2-111">If there are log files, they may be truncated as a result of this backup.</span></span>

    <span data-ttu-id="e22a2-112">Zum Wiederherstellen einer vollständigen Sicherung ist nur ein einzelnes Sicherungsimage erforderlich.</span><span class="sxs-lookup"><span data-stu-id="e22a2-112">Restoring a full backup requires only a single backup image.</span></span>

-   <span data-ttu-id="e22a2-113">Differenziell (**VSS \_ BT \_ DIFFERENTIAL**).</span><span class="sxs-lookup"><span data-stu-id="e22a2-113">Differential (**VSS\_BT\_DIFFERENTIAL**).</span></span> <span data-ttu-id="e22a2-114">Die VSS-API wird verwendet, um sicherzustellen, dass nur Dateien, die seit der letzten vollständigen Sicherung geändert oder hinzugefügt wurden, auf ein Speichermedium kopiert werden sollen. alle Zwischensicherungsinformationen werden ignoriert.</span><span class="sxs-lookup"><span data-stu-id="e22a2-114">The VSS API is used to ensure that only files that have been changed or added since the last full backup are to be copied to a storage medium; all intermediate backup information is ignored.</span></span> <span data-ttu-id="e22a2-115">Dies kann ganze Dateien oder bestimmte Bereiche in Dateien umfassen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-115">This may include entire files, or specific ranges within files.</span></span> <span data-ttu-id="e22a2-116">Eine differenzielle Sicherung ist einer vollständigen Sicherung zugeordnet und kann im Allgemeinen erst wiederhergestellt werden, wenn die vollständige Sicherung wiederhergestellt wurde.</span><span class="sxs-lookup"><span data-stu-id="e22a2-116">A differential backup is associated with a full backup, and generally cannot be restored until the full backup has been restored.</span></span> <span data-ttu-id="e22a2-117">Wenn Protokolldateien enthalten sind, werden sie in der Regel nicht als Ergebnis dieser Sicherung abgeschnitten.</span><span class="sxs-lookup"><span data-stu-id="e22a2-117">If there are log files, they will usually not be truncated as a result of this backup.</span></span>

    <span data-ttu-id="e22a2-118">Das Wiederherstellen einer differenziellen Sicherung erfordert das ursprüngliche Sicherungsimage und das letzte differenzielle Sicherungsimage, das seit der letzten vollständigen Sicherung erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="e22a2-118">Restoring a differential backup requires the original backup image and the most recent differential backup image made since the last full backup.</span></span>

-   <span data-ttu-id="e22a2-119">Inkrementell (**VSS \_ BT \_ INCREMENTAL**).</span><span class="sxs-lookup"><span data-stu-id="e22a2-119">Incremental (**VSS\_BT\_INCREMENTAL**).</span></span> <span data-ttu-id="e22a2-120">Die VSS-API wird verwendet, um sicherzustellen, dass nur Dateien, die seit der letzten vollständigen oder inkrementellen Sicherung geändert oder hinzugefügt wurden, auf ein Speichermedium kopiert werden sollen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-120">The VSS API is used to ensure that only files that have been changed or added since the last full or incremental backup are to be copied to a storage medium.</span></span> <span data-ttu-id="e22a2-121">Dies kann ganze Dateien oder bestimmte Bereiche in Dateien umfassen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-121">This may include entire files, or specific ranges within files.</span></span> <span data-ttu-id="e22a2-122">Einige Writer lassen nicht zu, dass inkrementelle Sicherungen mit differenziellen Sicherungen gemischt werden.</span><span class="sxs-lookup"><span data-stu-id="e22a2-122">Some writers do not allow incremental backups to be mixed with differential backups.</span></span> <span data-ttu-id="e22a2-123">Wenn Protokolldateien enthalten sind, werden sie möglicherweise als Ergebnis dieser Sicherung abgeschnitten.</span><span class="sxs-lookup"><span data-stu-id="e22a2-123">If there are log files, they may be truncated as a result of this backup.</span></span>

    <span data-ttu-id="e22a2-124">Das Wiederherstellen einer inkrementellen Sicherung erfordert das ursprüngliche Sicherungsimage und alle inkrementellen Sicherungsimages, die seit der ersten Sicherung erstellt wurden.</span><span class="sxs-lookup"><span data-stu-id="e22a2-124">Restoring an incremental backup requires the original backup image and all incremental backup images made since the initial backup.</span></span>

-   <span data-ttu-id="e22a2-125">Protokollsicherung (**VSS \_ BT \_ LOG**).</span><span class="sxs-lookup"><span data-stu-id="e22a2-125">Log Backup (**VSS\_BT\_LOG**).</span></span> <span data-ttu-id="e22a2-126">Nur die Protokolldateien eines Writers (Dateien, die einer Komponente mit der [**IVssCreateWriterMetadata::AddDataBaseLogFiles-Methode**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles) hinzugefügt und durch einen Aufruf von [**IVssWMComponent::GetDatabaseLogFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile)abgerufen werden) werden unterstützt.</span><span class="sxs-lookup"><span data-stu-id="e22a2-126">Only a writer's log files (files added to a component with the [**IVssCreateWriterMetadata::AddDataBaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles) method, and retrieved by a call to [**IVssWMComponent::GetDatabaseLogFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile)) will be backed up.</span></span> <span data-ttu-id="e22a2-127">Dieser Sicherungstyp ist für VSS spezifisch.</span><span class="sxs-lookup"><span data-stu-id="e22a2-127">This backup type is specific to VSS.</span></span> <span data-ttu-id="e22a2-128">Protokollsicherungen werden in der Regel sehr häufig erstellt.</span><span class="sxs-lookup"><span data-stu-id="e22a2-128">Log backups tend to be taken quite frequently.</span></span> <span data-ttu-id="e22a2-129">In der Regel wird die Protokolldatei als Ergebnis dieser Sicherung abgeschnitten.</span><span class="sxs-lookup"><span data-stu-id="e22a2-129">Typically, the log file will be truncated as a result of this backup.</span></span>
-   <span data-ttu-id="e22a2-130">Kopiesicherung (**VSS \_ BT \_ COPY**).</span><span class="sxs-lookup"><span data-stu-id="e22a2-130">Copy Backup (**VSS\_BT\_COPY**).</span></span> <span data-ttu-id="e22a2-131">Wie beim VSS BT FULL-Sicherungstyp werden Dateien unabhängig vom \_ \_ letzten Sicherungsdatum gesichert.</span><span class="sxs-lookup"><span data-stu-id="e22a2-131">Like the VSS\_BT\_FULL backup type, files will be backed up regardless of their last backup date.</span></span> <span data-ttu-id="e22a2-132">Der Sicherungsverlauf jeder Datei wird jedoch nicht aktualisiert, und dieser Sicherungstyp kann nicht als Grundlage für eine inkrementelle oder differenzielle Sicherung verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="e22a2-132">However, the backup history of each file will not be updated, and this type of backup cannot be used as the basis of an incremental or differential backup.</span></span> <span data-ttu-id="e22a2-133">Protokolldateien sollten nie als Ergebnis einer Kopiersicherung abgeschnitten werden.</span><span class="sxs-lookup"><span data-stu-id="e22a2-133">Log files should never be truncated as a result of a copy backup.</span></span>

<dl> <dt>

<span data-ttu-id="e22a2-134"><span id="Partial_File_Support"></span><span id="partial_file_support"></span><span id="PARTIAL_FILE_SUPPORT"></span>Teilweise Dateiunterstützung</span><span class="sxs-lookup"><span data-stu-id="e22a2-134"><span id="Partial_File_Support"></span><span id="partial_file_support"></span><span id="PARTIAL_FILE_SUPPORT"></span>Partial File Support</span></span>
</dt> <dd>

<span data-ttu-id="e22a2-135">Einige Writer unterstützen die Dateiwiederherstellung durch das Überschreiben von Teilen der Dateien, die sie verwalten.</span><span class="sxs-lookup"><span data-stu-id="e22a2-135">Some writers support file restoration through the overwriting of parts of the files they manage.</span></span> <span data-ttu-id="e22a2-136">Ein Anfordernder kann so entworfen werden, dass er dies nutzt. Wenn dies der Fall ist, wird dies durch Festlegen der Informationen in [**IVssBackupComponents::SetBackupState angegeben.**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate)</span><span class="sxs-lookup"><span data-stu-id="e22a2-136">A requester may be designed to take advantage of this, and if so it indicates this by setting the information in [**IVssBackupComponents::SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate).</span></span>

</dd> </dl>

<span data-ttu-id="e22a2-137">Die Writer geben an, welche Art von Sicherungen unterstützt werden, indem [**sie IVssCreateWriterMetadata::SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema) aufrufen, während das [*Identify-Ereignis verarbeitet*](vssgloss-i.md) wird.</span><span class="sxs-lookup"><span data-stu-id="e22a2-137">The writers indicate what type of backups are supported by calling [**IVssCreateWriterMetadata::SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema) while processing the [*Identify*](vssgloss-i.md) event.</span></span> <span data-ttu-id="e22a2-138">Der *dsSchemaMask-Parameter* für die **IVssCreateWriterMetadata::SetBackupSchema-Methode** ist eine Bitmaske, die angibt, welche Sicherungstypen unterstützt werden.</span><span class="sxs-lookup"><span data-stu-id="e22a2-138">The *dsSchemaMask* parameter to the **IVssCreateWriterMetadata::SetBackupSchema** method is a bit mask indicating what types of backup are supported.</span></span> <span data-ttu-id="e22a2-139">Alle Writer müssen vollständige Sicherungen unterstützen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-139">All writers must support full backups.</span></span>

<dl> <dt>

<span data-ttu-id="e22a2-140"><span id="VSS_BS_DIFFERENTIAL"></span><span id="vss_bs_differential"></span>**VSS \_ BS \_ DIFFERENTIAL**</span><span class="sxs-lookup"><span data-stu-id="e22a2-140"><span id="VSS_BS_DIFFERENTIAL"></span><span id="vss_bs_differential"></span>**VSS\_BS\_DIFFERENTIAL**</span></span>
</dt> <dd>

<span data-ttu-id="e22a2-141">Gibt die Unterstützung für differenzielle Sicherungen an.</span><span class="sxs-lookup"><span data-stu-id="e22a2-141">Indicates support for differential backups.</span></span>

</dd> <dt>

<span data-ttu-id="e22a2-142"><span id="VSS_BS_INCREMENTAL"></span><span id="vss_bs_incremental"></span>**VSS \_ BS \_ INCREMENTAL**</span><span class="sxs-lookup"><span data-stu-id="e22a2-142"><span id="VSS_BS_INCREMENTAL"></span><span id="vss_bs_incremental"></span>**VSS\_BS\_INCREMENTAL**</span></span>
</dt> <dd>

<span data-ttu-id="e22a2-143">Gibt die Unterstützung für inkrementelle Sicherungen an.</span><span class="sxs-lookup"><span data-stu-id="e22a2-143">Indicates support for incremental backups.</span></span>

</dd> <dt>

<span data-ttu-id="e22a2-144"><span id="VSS_BS_LOG"></span><span id="vss_bs_log"></span>**VSS \_ \_ BS-PROTOKOLL**</span><span class="sxs-lookup"><span data-stu-id="e22a2-144"><span id="VSS_BS_LOG"></span><span id="vss_bs_log"></span>**VSS\_BS\_LOG**</span></span>
</dt> <dd>

<span data-ttu-id="e22a2-145">Gibt die Unterstützung für Protokollsicherungen an.</span><span class="sxs-lookup"><span data-stu-id="e22a2-145">Indicates support for log backups.</span></span>

</dd> <dt>

<span data-ttu-id="e22a2-146"><span id="VSS_BS_COPY"></span><span id="vss_bs_copy"></span>**VSS \_ BS \_ COPY**</span><span class="sxs-lookup"><span data-stu-id="e22a2-146"><span id="VSS_BS_COPY"></span><span id="vss_bs_copy"></span>**VSS\_BS\_COPY**</span></span>
</dt> <dd>

<span data-ttu-id="e22a2-147">Gibt die Unterstützung für Kopiesicherungen an.</span><span class="sxs-lookup"><span data-stu-id="e22a2-147">Indicates support for copy backups.</span></span>

</dd> <dt>

<span data-ttu-id="e22a2-148"><span id="VSS_BS_EXCLUSIVE_INCREMENTAL_DIFFERENTIAL"></span><span id="vss_bs_exclusive_incremental_differential"></span>**VSS \_ BS \_ EXCLUSIVE \_ INCREMENTAL \_ DIFFERENTIAL**</span><span class="sxs-lookup"><span data-stu-id="e22a2-148"><span id="VSS_BS_EXCLUSIVE_INCREMENTAL_DIFFERENTIAL"></span><span id="vss_bs_exclusive_incremental_differential"></span>**VSS\_BS\_EXCLUSIVE\_INCREMENTAL\_DIFFERENTIAL**</span></span>
</dt> <dd>

<span data-ttu-id="e22a2-149">Gibt an, dass ein Writer das Mischen inkrementeller Sicherungen mit differenziellen Sicherungen nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="e22a2-149">Indicates that a writer does not support mixing incremental backups with differential backups.</span></span>

</dd> </dl>

<span data-ttu-id="e22a2-150">Der Writer kann bestimmen, welcher Sicherungstyp ausgeführt wird, indem er [**CVssWriter::GetBackupType aufruft.**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getbackuptype)</span><span class="sxs-lookup"><span data-stu-id="e22a2-150">The writer can determine what type of backup is being performed by calling [**CVssWriter::GetBackupType**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getbackuptype).</span></span> <span data-ttu-id="e22a2-151">Der früheste Zeitpunkt, an dem dies ausgeführt werden kann, ist die Verarbeitung des PrepareForBackup-Ereignisses.</span><span class="sxs-lookup"><span data-stu-id="e22a2-151">The earliest point when this can be performed is while processing the PrepareForBackup event.</span></span> <span data-ttu-id="e22a2-152">**CVssWriter::GetBackupType** gibt einen Member der [**VSS \_ BACKUP \_ TYPE-Enumeration**](/windows/desktop/api/Vss/ne-vss-vss_backup_type) zurück.</span><span class="sxs-lookup"><span data-stu-id="e22a2-152">**CVssWriter::GetBackupType** will return a member of the [**VSS\_BACKUP\_TYPE**](/windows/desktop/api/Vss/ne-vss-vss_backup_type) enumeration.</span></span> <span data-ttu-id="e22a2-153">Wenn der Sicherungstyp vom Writer nicht unterstützt wird, sollte der Writer die Sicherung als vollständige Sicherung behandeln.</span><span class="sxs-lookup"><span data-stu-id="e22a2-153">If the backup type is not supported by the writer, then the writer should treat the backup as a full backup.</span></span>

## <a name="backup-stamps"></a><span data-ttu-id="e22a2-154">Sicherungsstempel</span><span class="sxs-lookup"><span data-stu-id="e22a2-154">Backup Stamps</span></span>

<span data-ttu-id="e22a2-155">Inkrementelle und differenzielle Sicherungen sind immer an eine vorherige Sicherung gebunden.</span><span class="sxs-lookup"><span data-stu-id="e22a2-155">Incremental and differential backups are always tied to a previous backup.</span></span> <span data-ttu-id="e22a2-156">Es gibt zwei Möglichkeiten, Sicherungen zu verknüpfen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-156">There are two ways to tie backups.</span></span> <span data-ttu-id="e22a2-157">Bei einfachen Datenspeichern kann der Anfordernde die Korrelation zwischen Sicherungen nachverfolgen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-157">For simple data stores, the requester can keep track of the correlation between backups.</span></span> <span data-ttu-id="e22a2-158">Für komplexere Datenspeicher muss der Writer jedoch seinen eigenen Zeitstempel mit der Sicherung verwalten. dieser Zeitstempel kann die Protokollposition, Prüfpunktinformationen und so weiter nachverfolgen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-158">However, for more complex data stores, the writer will need to maintain its own timestamp with the backup; this timestamp may keep track of log position, checkpoint information, and so on.</span></span> <span data-ttu-id="e22a2-159">Ein Writer gibt an, dass er eigene Zeitstempel benötigt, indem er das **\_ VSS BS \_ TIMESTAMPED-Bit** beim Aufrufen von [**IVssCreateWriterMetadata::SetBackupSchema eingibt.**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema)</span><span class="sxs-lookup"><span data-stu-id="e22a2-159">A writer indicates that it needs its own timestamps by setting the **VSS\_BS\_TIMESTAMPED** bit when it calls [**IVssCreateWriterMetadata::SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema).</span></span>

<span data-ttu-id="e22a2-160">Ein Writer kann einen Zeitstempel mit jeder Komponente speichern, die sichern wird.</span><span class="sxs-lookup"><span data-stu-id="e22a2-160">A writer can store a timestamp with each component that is being backed up.</span></span> <span data-ttu-id="e22a2-161">Der Writer speichert den Zeitstempel, indem er [**IVssComponent::SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp)aufruft und eine Zeichenfolgendarstellung des Stempels für den *wszBackupStamp-Parameter* übergibt.</span><span class="sxs-lookup"><span data-stu-id="e22a2-161">The writer stores the timestamp by calling [**IVssComponent::SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp), and passing in a string representation of the stamp for the *wszBackupStamp* parameter.</span></span> <span data-ttu-id="e22a2-162">Im Allgemeinen wird diese Methode von einem Writer während der Verarbeitung des [*PostSnapshot-Ereignisses*](vssgloss-p.md) aufruft.</span><span class="sxs-lookup"><span data-stu-id="e22a2-162">Generally, a writer will call this method while processing the [*PostSnapshot*](vssgloss-p.md) event.</span></span> <span data-ttu-id="e22a2-163">Für Sicherungen, die keine Schattenkopie beinhalten, wird das PostSnapshot-Ereignis jedoch nicht gesendet.</span><span class="sxs-lookup"><span data-stu-id="e22a2-163">However, for backups that do not involve a shadow copy, the PostSnapshot event will not be sent.</span></span> <span data-ttu-id="e22a2-164">In diesem Fall muss **IVssComponent::SetBackupStamp** während der Verarbeitung des [*PrepareForBackup-Ereignisses aufgerufen*](vssgloss-p.md) werden.</span><span class="sxs-lookup"><span data-stu-id="e22a2-164">In this case, **IVssComponent::SetBackupStamp** must be called while processing the [*PrepareForBackup*](vssgloss-p.md) event.</span></span>

<span data-ttu-id="e22a2-165">Wenn eine inkrementelle oder differenzielle Sicherung ausgeführt wird, gibt der Anfordernde dem Writer den Sicherungsstempel der vorherigen Sicherung an, die als Basis für diese Sicherung dient.</span><span class="sxs-lookup"><span data-stu-id="e22a2-165">When an incremental or differential backup is being performed, the requester will indicate to the writer the backup stamp of the previous backup that is serving as a base for this backup.</span></span> <span data-ttu-id="e22a2-166">Der Writer kann während der Verarbeitung des PrepareForBackup- oder PostSnapshot-Ereignisses auf diesen vorherigen Sicherungsstempel zugreifen, indem er [**IVssComponent::GetPreviousBackupStamp aufruft.**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp)</span><span class="sxs-lookup"><span data-stu-id="e22a2-166">The writer can access this previous backup stamp while processing either the PrepareForBackup or PostSnapshot event, by calling [**IVssComponent::GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span></span> <span data-ttu-id="e22a2-167">Der Writer kann den zurückgegebenen Stempel verwenden, um zu bestimmen, was zu sichern ist.</span><span class="sxs-lookup"><span data-stu-id="e22a2-167">The writer can use the returned stamp to determine what needs to be backed up.</span></span>

## <a name="backup-strategies"></a><span data-ttu-id="e22a2-168">Sicherungsstrategien</span><span class="sxs-lookup"><span data-stu-id="e22a2-168">Backup Strategies</span></span>

### <a name="file-backup-files-strategies"></a><span data-ttu-id="e22a2-169">Strategien für Dateisicherungsdateien</span><span class="sxs-lookup"><span data-stu-id="e22a2-169">File Backup Files Strategies</span></span>

<span data-ttu-id="e22a2-170">Häufig müssen bestimmte Dateien, die in den Writer-Metadaten gemeldet werden, nur gesichert werden, wenn bestimmte Sicherungstypen erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="e22a2-170">Often, certain files reported in the writer metadata need only be backed up when performing certain types of backup.</span></span> <span data-ttu-id="e22a2-171">Einige Dateien sind möglicherweise nur erforderlich, wenn eine vollständige Sicherung erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="e22a2-171">Some files may only be required when performing a full backup.</span></span> <span data-ttu-id="e22a2-172">Andere Dateien sind möglicherweise nur erforderlich, wenn eine inkrementelle oder differenzielle Sicherung durchgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="e22a2-172">Other files may only be required when performing an incremental or differential backup.</span></span> <span data-ttu-id="e22a2-173">VSS stellt eine Methode für die Writer zur Verfügung, um dem Anfordernden diese Informationen anzugeben.</span><span class="sxs-lookup"><span data-stu-id="e22a2-173">VSS provides a method for the writers to indicate this information to the requester.</span></span> <span data-ttu-id="e22a2-174">Beim Hinzufügen von Dateien zu Komponenten mithilfe von [**IVssCreateWriterMetadata::AddDatabaseFiles,**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles) [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles)oder [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)gibt der *parameter dwBackupTypeMask* an, für welche Sicherungstypen diese Dateien gesichert werden müssen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-174">When adding files to components using [**IVssCreateWriterMetadata::AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles), or [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup), the *dwBackupTypeMask* parameter indicates for which backup types these files must be backed up.</span></span> <span data-ttu-id="e22a2-175">Die Maske kann einen oder mehrere der folgenden Werte enthalten:</span><span class="sxs-lookup"><span data-stu-id="e22a2-175">The mask can contain one or more of the following values:</span></span>

<dl> <dt>

<span data-ttu-id="e22a2-176"><span id="VSS_FSBT_FULL_BACKUP_REQUIRED"></span><span id="vss_fsbt_full_backup_required"></span>**VOLLSTÄNDIGE VSS \_ \_ \_ FSBT-SICHERUNG \_ ERFORDERLICH**</span><span class="sxs-lookup"><span data-stu-id="e22a2-176"><span id="VSS_FSBT_FULL_BACKUP_REQUIRED"></span><span id="vss_fsbt_full_backup_required"></span>**VSS\_FSBT\_FULL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="e22a2-177">Erforderlich für vollständige Sicherungen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-177">Required for full backups.</span></span>

</dd> <dt>

<span data-ttu-id="e22a2-178"><span id="VSS_FSBT_DIFFERENTIAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_differential_backup_required"></span>**VSS FSBT DIFFERENTIAL BACKUP REQUIRED (VSS \_ \_ FSBT-DIFFERENZIELLE \_ \_ SICHERUNG ERFORDERLICH)**</span><span class="sxs-lookup"><span data-stu-id="e22a2-178"><span id="VSS_FSBT_DIFFERENTIAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_differential_backup_required"></span>**VSS\_FSBT\_DIFFERENTIAL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="e22a2-179">Erforderlich für differenzielle Sicherungen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-179">Required for differential backups.</span></span>

</dd> <dt>

<span data-ttu-id="e22a2-180"><span id="VSS_FSBT_INCREMENTAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_incremental_backup_required"></span>**VSS \_ FSBT: \_ INKREMENTELLE \_ SICHERUNG \_ ERFORDERLICH**</span><span class="sxs-lookup"><span data-stu-id="e22a2-180"><span id="VSS_FSBT_INCREMENTAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_incremental_backup_required"></span>**VSS\_FSBT\_INCREMENTAL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="e22a2-181">Erforderlich für inkrementelle Sicherungen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-181">Required for incremental backups.</span></span>

</dd> <dt>

<span data-ttu-id="e22a2-182"><span id="VSS_FSBT_LOG_BACKUP_REQUIRED"></span><span id="vss_fsbt_log_backup_required"></span>**VSS \_ \_ FSBT-PROTOKOLLSICHERUNG \_ \_ ERFORDERLICH**</span><span class="sxs-lookup"><span data-stu-id="e22a2-182"><span id="VSS_FSBT_LOG_BACKUP_REQUIRED"></span><span id="vss_fsbt_log_backup_required"></span>**VSS\_FSBT\_LOG\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="e22a2-183">Erforderlich für Protokollsicherungen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-183">Required for log backups.</span></span>

</dd> <dt>

<span data-ttu-id="e22a2-184"><span id="VSS_FSBT_ALL_BACKUP_REQUIRED"></span><span id="vss_fsbt_all_backup_required"></span>**VSS \_ \_ FSBT: ALLE \_ \_ SICHERUNGEN ERFORDERLICH**</span><span class="sxs-lookup"><span data-stu-id="e22a2-184"><span id="VSS_FSBT_ALL_BACKUP_REQUIRED"></span><span id="vss_fsbt_all_backup_required"></span>**VSS\_FSBT\_ALL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="e22a2-185">Für alle Sicherungstypen erforderlich; dies ist die Standardeinstellung.</span><span class="sxs-lookup"><span data-stu-id="e22a2-185">Required for all backup types; this is the default.</span></span>

</dd> </dl>

<span data-ttu-id="e22a2-186">Diese Spezifikation überschreibt die Selektivitätsspezifikation der Komponente.</span><span class="sxs-lookup"><span data-stu-id="e22a2-186">This specification overrides the component's selectivity specification.</span></span> <span data-ttu-id="e22a2-187">Stellen Sie sich beispielsweise eine Komponente vor, deren Dateien alle mit **VSS \_ FSBT \_ LOG BACKUP \_ \_ REQUIRED** gekennzeichnet sind, jedoch nicht mit **VSS \_ FSBT FULL BACKUP \_ \_ \_ REQUIRED.**</span><span class="sxs-lookup"><span data-stu-id="e22a2-187">For example, consider a component whose files are all marked with **VSS\_FSBT\_LOG\_BACKUP\_REQUIRED** but not with **VSS\_FSBT\_FULL\_BACKUP\_REQUIRED**.</span></span> <span data-ttu-id="e22a2-188">Angenommen, diese Komponente kann nicht für die Sicherung ausgewählt werden (*bSelectable* war false, als [**IVssCreateWriterMetadata::AddComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponent) aufgerufen wurde).</span><span class="sxs-lookup"><span data-stu-id="e22a2-188">Suppose this component is not selectable for backup (*bSelectable* was false when [**IVssCreateWriterMetadata::AddComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponent) was called).</span></span> <span data-ttu-id="e22a2-189">Im Fall einer Protokollsicherung bedeutet dies, dass alle Dateien in dieser Komponente immer gesichert werden müssen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-189">In the case of a log backup, this means that all the files in this component must always be backed up.</span></span> <span data-ttu-id="e22a2-190">Im Fall einer vollständigen Sicherung muss jedoch keine der Dateien gesichert werden, obwohl die Selektivität der Komponente impliziert, dass sie gesichert werden sollte.</span><span class="sxs-lookup"><span data-stu-id="e22a2-190">However, in the case of a full backup, none of the files need to be backed up, despite the fact that the component's selectivity implies it should be backed up.</span></span>

### <a name="backup-by-last-modify-time"></a><span data-ttu-id="e22a2-191">Sicherung nach zeitpunkt der letzten Änderung</span><span class="sxs-lookup"><span data-stu-id="e22a2-191">Backup By Last Modify Time</span></span>

<span data-ttu-id="e22a2-192">Eine Möglichkeit für einen Writer, anzugeben, welche Dateien sich geändert haben, ist die Verwendung des Differenzdateimechanismus.</span><span class="sxs-lookup"><span data-stu-id="e22a2-192">One way for a writer to indicate what files have changed is by using the differenced file mechanism.</span></span> <span data-ttu-id="e22a2-193">Ein Writer kann angeben, dass bestimmte Dateien in einer Komponente nur dann sichern werden sollen, wenn sie seit einer bestimmten Zeit geändert wurden.</span><span class="sxs-lookup"><span data-stu-id="e22a2-193">A writer can specify that certain files in a component should only be backed up if they have been modified since a certain time.</span></span> <span data-ttu-id="e22a2-194">Der Writer ruft [**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) mit einer Dateispezifikation und einem Zeitpunkt der letzten Änderung auf.</span><span class="sxs-lookup"><span data-stu-id="e22a2-194">The writer calls [**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) with a file specification and a last modify time.</span></span> <span data-ttu-id="e22a2-195">**IVssComponent::AddDifferencedFilesByLastModifyTime** wird in der Regel während der Verarbeitung des PostSnapshot-Ereignisses aufgerufen, obwohl es während der Verarbeitung des PrepareForBackup-Ereignisses aufgerufen werden kann.</span><span class="sxs-lookup"><span data-stu-id="e22a2-195">**IVssComponent::AddDifferencedFilesByLastModifyTime** is typically called while processing the PostSnapshot event, although it can be called while processing the PrepareForBackup event.</span></span> <span data-ttu-id="e22a2-196">Der Anfordernde muss dann alle Dateien sichern, die der Dateispezifikation entsprechen, die sich seit dem angegebenen Zeitpunkt geändert haben.</span><span class="sxs-lookup"><span data-stu-id="e22a2-196">The requester must then back up all files matching the file specification that have changed since the specified time.</span></span> <span data-ttu-id="e22a2-197">Wenn der Writer den Sicherungsstempelmechanismus verwendet, wird dieser Zeitpunkt der letzten Änderung basierend auf dem vorherigen Sicherungsstempel im Sicherungsdokument bestimmt.</span><span class="sxs-lookup"><span data-stu-id="e22a2-197">If the writer is using the backup stamp mechanism, this last modify time will be determined based on the previous backup stamp in the backup document.</span></span> <span data-ttu-id="e22a2-198">Der Writer kann auch 0 (null) für die letzte Änderung übergeben. Dies bedeutet, dass der Anfordernde für die Bestimmung des Zeitpunkts der letzten Sicherung und der seit diesem Zeitpunkt geänderten Dateien verantwortlich ist.</span><span class="sxs-lookup"><span data-stu-id="e22a2-198">The writer can also pass in zero for the last modify time, which indicates that the requester is responsible for determining the time of the last backup and the files changed since that time.</span></span>

### <a name="partial-file-backup"></a><span data-ttu-id="e22a2-199">Partielle Dateisicherung</span><span class="sxs-lookup"><span data-stu-id="e22a2-199">Partial File Backup</span></span>

<span data-ttu-id="e22a2-200">Eine weitere Möglichkeit für einen Writer, Änderungen an der anfordernden Person anzugeben, ist die Verwendung des Mechanismus für partielle Dateien.</span><span class="sxs-lookup"><span data-stu-id="e22a2-200">Another way for a writer to indicate changes to the requester is by using the partial-file mechanism.</span></span> <span data-ttu-id="e22a2-201">Ein Writer kann Bytebereiche in Komponentendateien angeben, die gesichert werden müssen. Der Writer kann diese Dateibereiche während der Verarbeitung des PostSnapshot- oder PrepareForBackup-Ereignisses angeben.</span><span class="sxs-lookup"><span data-stu-id="e22a2-201">A writer can specify byte ranges within component files that need to be backed up; the writer may specify these file ranges while processing either the PostSnapshot or PrepareForBackup event.</span></span> <span data-ttu-id="e22a2-202">Der Writer ruft [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) auf, um der Sicherung partielle Dateispezifikationen hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-202">The writer calls [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) to add partial file specifications to the backup.</span></span> <span data-ttu-id="e22a2-203">Eine partielle Dateispezifikation besteht aus einem Pfad und einem Dateinamen sowie Informationen darüber, welche Bereiche in der Datei gesichert werden müssen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-203">A partial file specification consists of a path and file name together with information about what ranges in the file need to be backed up.</span></span>

### <a name="file-specification-rules"></a><span data-ttu-id="e22a2-204">Dateispezifikationsregeln</span><span class="sxs-lookup"><span data-stu-id="e22a2-204">File Specification Rules</span></span>

<span data-ttu-id="e22a2-205">[**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) oder [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) können beide verwendet werden, um dateispezifikationen zu ändern, die während des Identify-Ereignisses angegeben wurden, oder um der Spezifikation vollständig neue Dateien hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-205">[**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) or [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) can both be used to modify file specifications given during the Identify event, or to add completely new files to the specification.</span></span> <span data-ttu-id="e22a2-206">Wenn der Writer informationen ändert, die während des Identify-Ereignisses mithilfe von **IVssComponent::AddDifferencedFilesByLastModifyTime** festgelegt wurden, muss die Dateispezifikation genau mit einer der Dateispezifikationen in der aktuellen Komponente übereinstimmen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-206">If the writer is modifying information set during the Identify event using **IVssComponent::AddDifferencedFilesByLastModifyTime**, then the file specification must exactly match one of the file specifications in the current component.</span></span> <span data-ttu-id="e22a2-207">Die Dateispezifikation darf dateien in der aktuellen Komponente nicht teilweise überlappen und darf nicht mit Dateien in anderen Komponenten übereinstimmen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-207">The file specification must not partially overlap files in the current component, and it must not match files in any other components.</span></span> <span data-ttu-id="e22a2-208">Dateien, die mit **IVssComponent::AddPartialFile** angegeben werden, können sich jedoch teilweise überlappen, wenn eine andere Dateispezifikation angegeben wird.</span><span class="sxs-lookup"><span data-stu-id="e22a2-208">Files specified using **IVssComponent::AddPartialFile** can, however, partially overlap another file specification.</span></span> <span data-ttu-id="e22a2-209">Informationen, die von **IVssComponent::AddDifferencedFilesByLastModifyTime** oder **IVssComponent::AddPartialFile** festgelegt wurden, überschreiben die zuvor festgelegten Informationen mithilfe der [**IVssCreateWriterMetadata-Schnittstelle**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata) als Reaktion auf das Identify-Ereignis.</span><span class="sxs-lookup"><span data-stu-id="e22a2-209">Information set by **IVssComponent::AddDifferencedFilesByLastModifyTime** or **IVssComponent::AddPartialFile** overrides the information set earlier using the [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata) interface in response to the Identify event.</span></span>

<span data-ttu-id="e22a2-210">Allgemeine Dateispezifikationen können einen Wert für einen alternativen Speicherort aufweisen (festgelegt durch den *wszAlternateLocation-Parameter* von [**IVssCreateWriterMetadata::AddFilesToFileGroup),**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)der einen alternativen Speicherort zum Abrufen der Datei zum Zeitpunkt der Sicherung angibt.</span><span class="sxs-lookup"><span data-stu-id="e22a2-210">General file specifications can have an alternate-location value (set by the *wszAlternateLocation* parameter of [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)) that indicates an alternate location to obtain the file from at backup time.</span></span> <span data-ttu-id="e22a2-211">Wenn die Dateispezifikation, die über die Mechanismen differenced-file oder partial-file festgelegt wurde, mit einer vorhandenen Dateispezifikation übereinstimmt, die über einen alternativen Speicherort verfügt, ruft die Sicherungsanwendung die Daten von diesem alternativen Speicherort ab.</span><span class="sxs-lookup"><span data-stu-id="e22a2-211">If the file specification set through the differenced-file or partial-file mechanisms matches an existing file specification that has an alternate location, the backup application will obtain the data from this alternate location.</span></span>

<span data-ttu-id="e22a2-212">Wenn die in [**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) oder in [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) festgelegte Datei nicht übereinstimmt und dateien in der Komponente, die gesichert werden, werden jetzt alle übereinstimmenden Dateien zur Sicherung hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="e22a2-212">If the file specification set in [**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) or in [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) does not match and files in the component that are being backed up, then all matching files are now added to the backup.</span></span> <span data-ttu-id="e22a2-213">Achten Sie darauf, dass der Writer nur Dateien hinzufügt, die auf einem Volume vorhanden sind, das bereits während dieser Arbeit schattenkopiert wird. Andernfalls kann der Anforderer diese Dateien möglicherweise nicht sichern.</span><span class="sxs-lookup"><span data-stu-id="e22a2-213">Care must be taken that the writer only adds files that exist on a volume that is already being shadow copied while doing this; otherwise, the requester may fail to back up these files.</span></span> <span data-ttu-id="e22a2-214">Wenn diese Funktionen während der Verarbeitung des PostSnapshot-Ereignisses aufgerufen werden, kann dies mithilfe der [**CVssWriter::IsPathAffected-Methode**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected) bestimmt werden.</span><span class="sxs-lookup"><span data-stu-id="e22a2-214">If these functions are called while processing the PostSnapshot event, this can be determined by using the [**CVssWriter::IsPathAffected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected) method.</span></span> <span data-ttu-id="e22a2-215">Wenn er während der Behandlung des PrepareForBackup-Ereignisses aufgerufen wird, muss der Writer diese Bestimmung mithilfe einer anderen Methode vornehmen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-215">If called while handling the PrepareForBackup event, the writer must make this determination using another method.</span></span>

### <a name="backup-without-a-shadow-copy"></a><span data-ttu-id="e22a2-216">Sicherung ohne Schattenkopie</span><span class="sxs-lookup"><span data-stu-id="e22a2-216">Backup Without a Shadow Copy</span></span>

<span data-ttu-id="e22a2-217">Bestimmte Dateitypen müssen möglicherweise nicht von einem Schattenkopievolume gesichert werden.</span><span class="sxs-lookup"><span data-stu-id="e22a2-217">Certain types of files may not need to be backed up off of a shadow copy volume.</span></span> <span data-ttu-id="e22a2-218">Dies gilt beispielsweise häufig für Datenbankprotokolldateien.</span><span class="sxs-lookup"><span data-stu-id="e22a2-218">For example, this will often be true of database log files.</span></span> <span data-ttu-id="e22a2-219">Da Protokolldateien monoton zunehmen und ein Writer genau angeben kann, welche Teile der Datei mithilfe von Teildateien gesichert werden sollen, ist es häufig möglich, das Protokoll vom ursprünglichen Volume zu sichern.</span><span class="sxs-lookup"><span data-stu-id="e22a2-219">Since log files grow monotonically, and a writer can specify exactly what portions of the file to back up using partial files, it will often be possible to back up the log off the original volume.</span></span> <span data-ttu-id="e22a2-220">Als Optimierung kann ein Writer markieren, welche Dateien Schattenkopien für verschiedene Sicherungstypen erfordern, indem er die im *dwBackupTypeMask-Parameter* von [**IVssCreateWriterMetadata::AddDatabaseFiles,**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles) [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles)oder [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)festgelegten Flags verwendet.</span><span class="sxs-lookup"><span data-stu-id="e22a2-220">As an optimization, a writer can mark which files require shadow copies for different backup types using the flags set in the *dwBackupTypeMask* parameter of [**IVssCreateWriterMetadata::AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles), or [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup).</span></span> <span data-ttu-id="e22a2-221">Folgende Flags werden unterstützt:</span><span class="sxs-lookup"><span data-stu-id="e22a2-221">Supported flags include the following:</span></span>

<dl> <dt>

<span data-ttu-id="e22a2-222"><span id="VSS_FSBT_FULL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_full_snapshot_required"></span>**VOLLSTÄNDIGE VSS \_ \_ \_ FSBT-MOMENTAUFNAHME \_ ERFORDERLICH**</span><span class="sxs-lookup"><span data-stu-id="e22a2-222"><span id="VSS_FSBT_FULL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_full_snapshot_required"></span>**VSS\_FSBT\_FULL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="e22a2-223">Schattenkopie für vollständige Sicherungen erforderlich.</span><span class="sxs-lookup"><span data-stu-id="e22a2-223">Shadow copy required for full backups.</span></span>

</dd> <dt>

<span data-ttu-id="e22a2-224"><span id="VSS_FSBT_DIFFERENTIAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_differential_snapshot_required"></span>**VSS \_ FSBT \_ DIFFERENTIAL SNAPSHOT \_ \_ ERFORDERLICH**</span><span class="sxs-lookup"><span data-stu-id="e22a2-224"><span id="VSS_FSBT_DIFFERENTIAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_differential_snapshot_required"></span>**VSS\_FSBT\_DIFFERENTIAL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="e22a2-225">Schattenkopie für differenzielle Sicherungen erforderlich.</span><span class="sxs-lookup"><span data-stu-id="e22a2-225">Shadow copy required for differential backups.</span></span>

</dd> <dt>

<span data-ttu-id="e22a2-226"><span id="VSS_FSBT_INCREMENTAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_incremental_snapshot_required"></span>**INKREMENTELLE VSS \_ \_ \_ FSBT-MOMENTAUFNAHME \_ ERFORDERLICH**</span><span class="sxs-lookup"><span data-stu-id="e22a2-226"><span id="VSS_FSBT_INCREMENTAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_incremental_snapshot_required"></span>**VSS\_FSBT\_INCREMENTAL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="e22a2-227">Schattenkopie für inkrementelle Sicherungen erforderlich.</span><span class="sxs-lookup"><span data-stu-id="e22a2-227">Shadow copy required for incremental backups.</span></span>

</dd> <dt>

<span data-ttu-id="e22a2-228"><span id="VSS_FSBT_LOG_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_log_snapshot_required"></span>**VSS \_ \_ FSBT-PROTOKOLLMOMENTAUFNAHME \_ \_ ERFORDERLICH**</span><span class="sxs-lookup"><span data-stu-id="e22a2-228"><span id="VSS_FSBT_LOG_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_log_snapshot_required"></span>**VSS\_FSBT\_LOG\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="e22a2-229">Schattenkopie für Protokollsicherungen erforderlich.</span><span class="sxs-lookup"><span data-stu-id="e22a2-229">Shadow copy required for log backups.</span></span>

</dd> <dt>

<span data-ttu-id="e22a2-230"><span id="VSS_FSBT_ALL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_all_snapshot_required"></span>**VSS \_ FSBT \_ – ALLE \_ MOMENTAUFNAHMEN \_ ERFORDERLICH**</span><span class="sxs-lookup"><span data-stu-id="e22a2-230"><span id="VSS_FSBT_ALL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_all_snapshot_required"></span>**VSS\_FSBT\_ALL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="e22a2-231">Schattenkopie ist für alle Sicherungstypen erforderlich. Dies ist die Standardeinstellung.</span><span class="sxs-lookup"><span data-stu-id="e22a2-231">Shadow copy required for all backup types; this is the default.</span></span>

</dd> </dl>

<span data-ttu-id="e22a2-232">Wenn ein bestimmtes Volume nur Komponenten enthält, für die keine Schattenkopie für diese Sicherung erforderlich ist, kann der Anforderer den Schritt zum Erstellen einer Schattenkopie für dieses Volume überspringen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-232">If a specific volume contains only components that do not require a shadow copy for this backup, the requester can skip the step of creating a shadow copy for this volume.</span></span> <span data-ttu-id="e22a2-233">Alle Daten auf diesem Volume können direkt vom ursprünglichen Volume auf das Sicherungsmedium kopiert werden.</span><span class="sxs-lookup"><span data-stu-id="e22a2-233">All the data on this volume can be copied to the backup media directly from the original volume.</span></span>

## <a name="backup-cleanup"></a><span data-ttu-id="e22a2-234">Sicherungsbereinigung</span><span class="sxs-lookup"><span data-stu-id="e22a2-234">Backup Cleanup</span></span>

<span data-ttu-id="e22a2-235">Wenn der Writer eine Protokollkürzung oder eine andere Bereinigung nach der Sicherung durchführen muss, ist der richtige Ort hierfür die Verarbeitung des [*BackupComplete-Ereignisses.*](vssgloss-b.md)</span><span class="sxs-lookup"><span data-stu-id="e22a2-235">If the writer needs to perform log truncation or other post-backup cleanup, the proper place to do this is while processing the [*BackupComplete*](vssgloss-b.md) event.</span></span> <span data-ttu-id="e22a2-236">Das [*BackupShutdown-Ereignis*](vssgloss-b.md) wird einige Zeit nach BackupComplete gesendet, sodass einige Bereinigungen auch im BackupShutdown-Ereignishandler durchgeführt werden können.</span><span class="sxs-lookup"><span data-stu-id="e22a2-236">The [*BackupShutdown*](vssgloss-b.md) event will be sent some time after BackupComplete, so some cleanup may also be done in the BackupShutdown event handler.</span></span>

<span data-ttu-id="e22a2-237">Das BackupShutdown-Ereignis wird immer nach beendigung einer Sicherung gesendet.</span><span class="sxs-lookup"><span data-stu-id="e22a2-237">The BackupShutdown event is always sent after termination of a backup.</span></span> <span data-ttu-id="e22a2-238">Wenn der Anforderer beim Ausführen einer Sicherung ungewöhnlich beendet wird, wird BackupShutdown sofort gesendet, ohne zuerst BackupComplete zu senden.</span><span class="sxs-lookup"><span data-stu-id="e22a2-238">If the requester terminates abnormally while performing a backup, BackupShutdown will be sent immediately, without first sending BackupComplete.</span></span> <span data-ttu-id="e22a2-239">Wenn der Writer einen Beliebigen Zustand bereinigen muss, kann dies hier erfolgen. In diesem Fall sollte die Protokollkürzung jedoch nicht erfolgen, da die Sicherung nicht notwendigerweise abgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="e22a2-239">If the writer needs to clean up any state, that may be done here; however, log truncation should not happen in this event because the backup did not necessarily complete.</span></span>

## <a name="restore-strategies"></a><span data-ttu-id="e22a2-240">Wiederherstellungsstrategien</span><span class="sxs-lookup"><span data-stu-id="e22a2-240">Restore Strategies</span></span>

<span data-ttu-id="e22a2-241">Die grundlegenden Aufgaben von Writern bei der Wiederherstellung bestehen darin, zu überprüfen, ob die Wiederherstellung bei der Behandlung des PreRestore-Ereignisses erfolgen kann und ob die Wiederherstellung bei der Behandlung des PostRestore-Ereignisses erfolgt ist.</span><span class="sxs-lookup"><span data-stu-id="e22a2-241">The basic tasks of writers at restore are to verify that the restore can happen in handling the PreRestore event, and that the restore has happened in handling the PostRestore event.</span></span> <span data-ttu-id="e22a2-242">Komplexere Speicher führen auch einen Wiederherstellungsprozess im PostRestore-Handler aus.</span><span class="sxs-lookup"><span data-stu-id="e22a2-242">More complex stores will also perform a recovery process in the PostRestore handler.</span></span> <span data-ttu-id="e22a2-243">Wenn die Wiederherstellung Teil einer inkrementellen oder differenziellen Wiederherstellung ist, möchte der Writer diesen Wiederherstellungsprozess in der Regel verzögern, bis alle inkrementellen oder differenziellen Wiederherstellungen abgeschlossen sind.</span><span class="sxs-lookup"><span data-stu-id="e22a2-243">If the restore is part of an incremental or differential restore, the writer will generally want to delay this recovery process until all incremental or differential restores have been completed.</span></span> <span data-ttu-id="e22a2-244">[**IVssComponent::GetAdditionalRestores**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores) gibt an, ob dies die endgültige Wiederherstellung dieser Komponente ist oder ob weitere Wiederherstellungen folgen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-244">[**IVssComponent::GetAdditionalRestores**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores) will indicate whether this is the final restore of this component, or whether there are more restores to come.</span></span> <span data-ttu-id="e22a2-245">Wenn **IVssComponent::GetAdditionalRestores** **true** zurückgibt, sollte der Writer seine Wiederherstellungsprozedur für diese Komponente nicht ausführen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-245">If **IVssComponent::GetAdditionalRestores** returns **true**, the writer should not perform its recovery procedure on that component.</span></span>

## <a name="new-targets"></a><span data-ttu-id="e22a2-246">Neue Ziele</span><span class="sxs-lookup"><span data-stu-id="e22a2-246">New Targets</span></span>

<span data-ttu-id="e22a2-247">Wenn dies vom Writer unterstützt wird, kann der Anforderer Datendateien an einem anderen Speicherort als dem ursprünglichen Sicherungszeitspeicherort wiederherstellen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-247">If supported by the writer, the requester can restore data files to a location other than the original backup-time location.</span></span> <span data-ttu-id="e22a2-248">Ein Writer gibt Unterstützung für diesen Wiederherstellungsmodus an, indem das **VSS \_ BS \_ WRITER SUPPORTS \_ NEW \_ \_ TARGET-Bit** im *dsSchemaMask-Parameter* festgelegt wird, wenn [**IVssCreateWriterMetadata::SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema)aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="e22a2-248">A writer indicates support for this restore mode by setting the **VSS\_BS\_WRITER\_SUPPORTS\_NEW\_TARGET** bit in the *dsSchemaMask* parameter when calling [**IVssCreateWriterMetadata::SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema).</span></span> <span data-ttu-id="e22a2-249">Ein Writer ruft die neuen Speicherorte für Komponentendateien zur Wiederherstellungszeit ab, indem [**er IVssComponent::GetNewTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtargetcount) und [**IVssComponent::GetNewTarget aufruft.**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtarget)</span><span class="sxs-lookup"><span data-stu-id="e22a2-249">A writer obtains the new locations for component files at restore time by calling [**IVssComponent::GetNewTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtargetcount) and [**IVssComponent::GetNewTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtarget).</span></span>

## <a name="directed-targets"></a><span data-ttu-id="e22a2-250">Directed Targets</span><span class="sxs-lookup"><span data-stu-id="e22a2-250">Directed Targets</span></span>

<span data-ttu-id="e22a2-251">Bei komplizierten Wiederherstellungsszenarien kann ein Writer Bereiche einer gesicherten Datei verschiedenen Bereichen derselben oder einer anderen Datei zuordnen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-251">For complicated restore scenarios, a writer may want to map ranges of a backed-up file onto different ranges of the same or a different file.</span></span> <span data-ttu-id="e22a2-252">Dies kann mithilfe des Zielmechanismus erfolgen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-252">This can be done by using the directed-target mechanism.</span></span> <span data-ttu-id="e22a2-253">Dazu muss ein Writer zuerst angeben, dass dies geschieht, indem [**er IVssComponent::SetRestoreTarget aufruft**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget)und **VSS \_ RT \_ DIRECTED** für den *Zielparameter* übergibt.</span><span class="sxs-lookup"><span data-stu-id="e22a2-253">To do this, a writer must first indicate this is happening by calling [**IVssComponent::SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget), passing in **VSS\_RT\_DIRECTED** for the *target* parameter.</span></span> <span data-ttu-id="e22a2-254">Anschließend ruft der Writer für jede Zuordnung [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget)auf.</span><span class="sxs-lookup"><span data-stu-id="e22a2-254">Then, for each mapping, the writer calls [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget).</span></span> <span data-ttu-id="e22a2-255">Diese Methode verwendet einen vollständigen Pfad zu einer Quelldatei in der Sicherung und einen vollständigen Pfad zu einer Zieldatei, in der wiederhergestellt wird.</span><span class="sxs-lookup"><span data-stu-id="e22a2-255">This method takes a full path to a source file on the backup and a full path to a destination file that will be restored to.</span></span> <span data-ttu-id="e22a2-256">Außerdem wird eine Bereichsliste für jede dieser Dateien verwendet.</span><span class="sxs-lookup"><span data-stu-id="e22a2-256">It also takes a ranges list for each of these files.</span></span> <span data-ttu-id="e22a2-257">Der Writer ruft diese Funktionen während der Behandlung des PreRestore-Ereignisses auf, und der Anforderer ist dann für die Wiederherstellung der angegebenen Bereiche in der Quelldatei in den zugeordneten Bereichen in der Zieldatei verantwortlich.</span><span class="sxs-lookup"><span data-stu-id="e22a2-257">The writer calls these functions while handling the PreRestore event, and the requester is then responsible for restoring the specified ranges in the source file to the mapped ranges in the destination file.</span></span> <span data-ttu-id="e22a2-258">Das Format der Bereichszeichenfolge ist dasselbe wie in [ **IVssComponent::AddPartialFile.**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile)</span><span class="sxs-lookup"><span data-stu-id="e22a2-258">The format of the ranges string is the same as in [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile)</span></span>

## <a name="private-writer-metadata"></a><span data-ttu-id="e22a2-259">Private Writer-Metadaten</span><span class="sxs-lookup"><span data-stu-id="e22a2-259">Private Writer Metadata</span></span>

<span data-ttu-id="e22a2-260">Es ist häufig nützlich, dass ein Writer private Metadaten mit einer Sicherung verwaltet, um eine inkrementelle oder differenzielle Wiederherstellung ordnungsgemäß durchzuführen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-260">It is often useful for a writer to maintain private metadata with a backup to properly perform an incremental or differential restore.</span></span> <span data-ttu-id="e22a2-261">Ein Writer kann [**IVssComponent::SetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata) aufrufen, während er entweder PrepareForBackup oder PostSnapshot zum Speichern von Metadaten verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="e22a2-261">A writer may call [**IVssComponent::SetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata) while handling either PrepareForBackup or PostSnapshot to store metadata.</span></span> <span data-ttu-id="e22a2-262">Auf diese Metadaten kann der Writer während PreRestore oder PostRestore zugreifen, indem [**IVssComponent::GetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupmetadata)aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="e22a2-262">This metadata can be accessed by the writer during either PreRestore or PostRestore by calling [**IVssComponent::GetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupmetadata).</span></span> <span data-ttu-id="e22a2-263">Metadaten können auch mit partieller Dateispezifikation gespeichert werden, indem der *wszMetadata-Parameter* von [**IVssComponent::AddPartialFile verwendet wird.**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) Auf diese Metadaten wird über den *pbstrMetadata-Parameter* von [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile)zugegriffen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-263">Metadata can also be stored with partial file specification by using the *wszMetadata* parameter of [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile); this metadata is accessed through the *pbstrMetadata* parameter of [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile).</span></span> <span data-ttu-id="e22a2-264">Der Writer kann auch Metadaten zwischen [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore) und [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore)an sich selbst übergeben.</span><span class="sxs-lookup"><span data-stu-id="e22a2-264">The writer can also pass metadata to itself between [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore) and [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore).</span></span> <span data-ttu-id="e22a2-265">In **CVssWriter::OnPreRestore** werden die Metadaten durch Aufrufen von [**IVssComponent::SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata)festgelegt.</span><span class="sxs-lookup"><span data-stu-id="e22a2-265">In **CVssWriter::OnPreRestore**, the metadata is set by calling [**IVssComponent::SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata).</span></span> <span data-ttu-id="e22a2-266">In **CVssWriter::OnPostRestore** werden die Metadaten durch Aufrufen von [**IVssComponent::GetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoremetadata)abgerufen.</span><span class="sxs-lookup"><span data-stu-id="e22a2-266">In **CVssWriter::OnPostRestore**, the metadata is retrieved by calling [**IVssComponent::GetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoremetadata).</span></span>

-   [<span data-ttu-id="e22a2-267">Writer-Rolle in inkrementellen und differenziellen VSS-Sicherungen</span><span class="sxs-lookup"><span data-stu-id="e22a2-267">Writer Role in VSS Incremental and Differential Backups</span></span>](writer-role-in-vss-incremental-and-differential-backups.md)
-   [<span data-ttu-id="e22a2-268">Anfordererrolle in inkrementellen und differenziellen VSS-Sicherungen</span><span class="sxs-lookup"><span data-stu-id="e22a2-268">Requester Role in VSS Incremental and Differential Backups</span></span>](requestor-role-in-vss-incremental-and-differential-backups.md)

 

 



