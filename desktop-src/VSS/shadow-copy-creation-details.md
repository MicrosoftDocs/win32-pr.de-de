---
description: Im Allgemeinen ist das Erstellen einer Schatten Kopie abhängig vom Typ der zu erstellenden Schatten Kopie, vom Kontext und von der Rolle, die den Writern im Schattenkopievorgang zugewiesen wird.
ms.assetid: eab3b39b-dfa7-43ea-adba-cd0b495c373f
title: Details zur Erstellung von Schatten Kopien
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8b9281b899593ca0751f1d549aed60305041b18c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "106351624"
---
# <a name="shadow-copy-creation-details"></a><span data-ttu-id="cbde4-103">Details zur Erstellung von Schatten Kopien</span><span class="sxs-lookup"><span data-stu-id="cbde4-103">Shadow Copy Creation Details</span></span>

<span data-ttu-id="cbde4-104">Im Allgemeinen ist das Erstellen einer Schatten Kopie abhängig vom Typ der zu erstellenden Schatten Kopie, vom Kontext und von der Rolle, die den Writern im Schattenkopievorgang zugewiesen wird.</span><span class="sxs-lookup"><span data-stu-id="cbde4-104">In general, how a shadow copy is created depends on the type of shadow copy to be created, its context, and the role accorded to writers in the shadow copy operation.</span></span> <span data-ttu-id="cbde4-105">(Weitere Informationen finden Sie unter [Kontext Konfigurationen für Schatten Kopien](shadow-copy-context-configurations.md) .)</span><span class="sxs-lookup"><span data-stu-id="cbde4-105">(See [Shadow Copy Context Configurations](shadow-copy-context-configurations.md) for more information.)</span></span>

<span data-ttu-id="cbde4-106">Der Kontext der Schatten Kopie wird durch Aufrufen der [**IVssBackupComponents:: SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext) -Methode festgelegt.</span><span class="sxs-lookup"><span data-stu-id="cbde4-106">The shadow copy context is set by calling the [**IVssBackupComponents::SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext) method.</span></span> <span data-ttu-id="cbde4-107">Vor dem Aufrufen der [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) -Methode zum Erstellen einer Schatten Kopie müssen anfordernde Personen die [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) -Methoden in der Reihenfolge aufrufen, die in den folgenden Abschnitten angegeben ist.</span><span class="sxs-lookup"><span data-stu-id="cbde4-107">Before calling the [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) method to create a shadow copy, requesters must call the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) methods in the order specified in the following sections.</span></span>

## <a name="prerequisites-for-all-shadow-copies"></a><span data-ttu-id="cbde4-108">Voraussetzungen für alle Schatten Kopien</span><span class="sxs-lookup"><span data-stu-id="cbde4-108">Prerequisites for All Shadow Copies</span></span>

<span data-ttu-id="cbde4-109">Unabhängig von der Ebene der Schreib Beteiligung erfordert die Erstellung einer beliebigen Schatten Kopie immer, dass der Anforderer mit Aufrufen von [**IVssBackupComponents:: initializeforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) und [**IVssBackupComponents:: startnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset)initialisiert wird.</span><span class="sxs-lookup"><span data-stu-id="cbde4-109">Regardless of the level of writer participation, the creation of any shadow copy will always require the requestor be initialized with calls to [**IVssBackupComponents::InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) and [**IVssBackupComponents::StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset).</span></span>

<span data-ttu-id="cbde4-110">Wenn dieser-Befehl nicht durchgeführt wird, gibt die [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) -Methode einen Fehler zurück.</span><span class="sxs-lookup"><span data-stu-id="cbde4-110">If this call is not made, the [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) method will return an error.</span></span>

## <a name="shadow-copies-with-writer-participation"></a><span data-ttu-id="cbde4-111">Schatten Kopien mit Writer-Beteiligung</span><span class="sxs-lookup"><span data-stu-id="cbde4-111">Shadow Copies with Writer Participation</span></span>

<span data-ttu-id="cbde4-112">Wenn der schattenkopieskontext die Writer-Teilnahme angibt (d. h. [**IVssBackupComponents:: SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext) wird mit **VSS \_ ctx- \_ Sicherung** oder **VSS \_ ctx- \_ App- \_ Rollback** aufgerufen):</span><span class="sxs-lookup"><span data-stu-id="cbde4-112">If the shadow copy context specifies writer participation (that is, [**IVssBackupComponents::SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext) is called with **VSS\_CTX\_BACKUP**, or **VSS\_CTX\_APP\_ROLLBACK**):</span></span>

-   <span data-ttu-id="cbde4-113">Anforderer muss immer [**IVssBackupComponents:: gatherschreitermetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) aufruft, wenn der schattenkopieskontext die Writer-Teilnahme unterstützt.</span><span class="sxs-lookup"><span data-stu-id="cbde4-113">Requesters must always call [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) when the shadow copy context supports writer participation.</span></span> <span data-ttu-id="cbde4-114">Wenn der schattenkopieskontext die Writer-Teilnahme unterstützt und **IVssBackupComponents:: gatherschreitermetadata** nicht vor [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset)aufgerufen wird, wird ein Fehler zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="cbde4-114">If the shadow copy context supports writer participation and **IVssBackupComponents::GatherWriterMetadata** is not called prior to [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), an error will be returned.</span></span>
-   <span data-ttu-id="cbde4-115">Wenn ein Anforderer bestimmte Writer-Komponenten auswählen möchte, muss er [**IVssBackupComponents:: addComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent) aufrufen, bevor [**startnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset) aufgerufen wird, um den Schattenkopiesatz zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="cbde4-115">If a requester wants to select specific writer components, it must call [**IVssBackupComponents::AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent) before calling [**StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset) to create the shadow copy set.</span></span>
-   <span data-ttu-id="cbde4-116">[**Startnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset) muss aufgerufen werden, um den Schattenkopiesatz zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="cbde4-116">[**StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset) must be called to create the shadow copy set.</span></span>
-   <span data-ttu-id="cbde4-117">Anforderer können dem Schattenkopiesatz durch Aufrufen von [**addtosnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addtosnapshotset)ein oder mehrere Volumes hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="cbde4-117">Requesters may add one or more volumes to the shadow copy set by calling [**AddToSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addtosnapshotset).</span></span> <span data-ttu-id="cbde4-118">Einige Writer-Komponenten geben möglicherweise keine betroffenen Volumes an.</span><span class="sxs-lookup"><span data-stu-id="cbde4-118">Some writer components may not specify any affected volumes.</span></span> <span data-ttu-id="cbde4-119">In diesem Fall ist es akzeptabel, dass eine Momentaufnahme als leer festgelegt ist (d. h., Sie enthält keine Volumes).</span><span class="sxs-lookup"><span data-stu-id="cbde4-119">In this case, it is acceptable for a snapshot set to be empty (that is, to contain no volumes).</span></span>
-   <span data-ttu-id="cbde4-120">Um die Konsistenz von Writer-Metadaten zu gewährleisten, sollte ein Anforderer immer [**IVssBackupComponents::P Analyse forbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) aufruft, auch wenn keine Komponenten ausgewählt sind.</span><span class="sxs-lookup"><span data-stu-id="cbde4-120">To guarantee the consistency of writer metadata, a requester should always call [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) even if no components are selected.</span></span> <span data-ttu-id="cbde4-121">Dies bewirkt, dass VSS ein **PrepareForBackup** -Ereignis generiert, in dem VSS die [**CVssWriter:: onpreparebackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) -Methode für jeden Beteiligten Writer aufruft.</span><span class="sxs-lookup"><span data-stu-id="cbde4-121">This causes VSS to generate a **PrepareForBackup** event, in which VSS calls the [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) method for each participating writer.</span></span>
-   <span data-ttu-id="cbde4-122">VSS generiert [*prepareforsnapshot*](vssgloss-p.md) -und [*Freeze*](vssgloss-f.md) -Ereignisse, bevor die Schatten Kopie als Antwort auf [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset)erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="cbde4-122">VSS will generate [*PrepareForSnapshot*](vssgloss-p.md) and [*Freeze*](vssgloss-f.md) events before creating the shadow copy in response to [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span> <span data-ttu-id="cbde4-123">Writer behandeln die Ereignisse mit [**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) und [**CVssWriter:: OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze).</span><span class="sxs-lookup"><span data-stu-id="cbde4-123">Writers will handle the events with [**CVssWriter::OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) and [**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze).</span></span>
-   <span data-ttu-id="cbde4-124">VSS generiert nach dem Erstellen einer Schatten Kopie als Antwort auf [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) [*Thaw*](vssgloss-t.md) -Ereignisse und [*PostSnapshot*](vssgloss-p.md) -Ereignisse.</span><span class="sxs-lookup"><span data-stu-id="cbde4-124">VSS will generate [*Thaw*](vssgloss-t.md) events and [*PostSnapshot*](vssgloss-p.md) events after creating a shadow copy in response to [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span> <span data-ttu-id="cbde4-125">Writer behandeln die Ereignisse mit [**CVssWriter:: OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw) und [**CVssWriter:: OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot).</span><span class="sxs-lookup"><span data-stu-id="cbde4-125">Writers will handle the events with [**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw) and [**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot).</span></span>

## <a name="shadow-copies-without-writer-participation"></a><span data-ttu-id="cbde4-126">Schatten Kopien ohne Writer-Teilnahme</span><span class="sxs-lookup"><span data-stu-id="cbde4-126">Shadow Copies without Writer Participation</span></span>

<span data-ttu-id="cbde4-127">Das Erstellen von Schatten Kopien ohne Writer-Beteiligung wird bei Standard Sicherungs Anwendungen empfohlen (siehe [Sicherungen ohne Writer-Teilnahme](backups-without-writer-participation.md)).</span><span class="sxs-lookup"><span data-stu-id="cbde4-127">Creating shadow copies without writer participation is discouraged for standard backup applications (see [Backups without Writer Participation](backups-without-writer-participation.md)).</span></span>

<span data-ttu-id="cbde4-128">Es gibt Verwendungsmöglichkeiten, wie z. b. schnelle Sicherungen eines Datenträgers zur Bereitstellung eines Sicherheitsnetzes vor versehentlicher Beschädigung von Dateien, die ohne explizite Writer-Teilnahme durchgeführt werden können.</span><span class="sxs-lookup"><span data-stu-id="cbde4-128">There are uses, such as fast backups of a disk to provide a safety net against accidental file corruption, which can be conducted without explicit writer participation.</span></span> <span data-ttu-id="cbde4-129">Eine solche Schatten Kopie hätte entweder den Kontext der **VSS \_ ctx- \_ Datei \_ Freigabe \_ Sicherung** oder des **VSS \_ ctx \_ NAS- \_ Rollbacks**.</span><span class="sxs-lookup"><span data-stu-id="cbde4-129">Such a shadow copy would have a context of either **VSS\_CTX\_FILE\_SHARE\_BACKUP** or **VSS\_CTX\_NAS\_ROLLBACK**.</span></span>

<span data-ttu-id="cbde4-130">Beachten Sie für diese Art der Schatten Kopie Folgendes:</span><span class="sxs-lookup"><span data-stu-id="cbde4-130">For this type of shadow copy, note the following:</span></span>

-   <span data-ttu-id="cbde4-131">Anfordernde Personen müssen weiterhin die erforderlichen Methoden abrufen, die unter [Voraussetzungen für alle Schatten Kopien](#prerequisites-for-all-shadow-copies)aufgeführt sind.</span><span class="sxs-lookup"><span data-stu-id="cbde4-131">Requesters must still call the required methods listed in [Prerequisites for All Shadow Copies](#prerequisites-for-all-shadow-copies).</span></span>
-   <span data-ttu-id="cbde4-132">Anfordernde Personen können [**IVssBackupComponents:: gatherschreitermetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata)aufzurufen, dies ist jedoch nicht erforderlich.</span><span class="sxs-lookup"><span data-stu-id="cbde4-132">Requesters may call [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), but this is not required.</span></span>
-   <span data-ttu-id="cbde4-133">Wenn Requester [**IVssBackupComponents:: addComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent), [**IVssBackupComponents::P Analyse forbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup)oder [**IVssBackupComponents:: BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete)aufruft, wird ein Fehler zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="cbde4-133">If requesters call [**IVssBackupComponents::AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent), [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), or [**IVssBackupComponents::BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete), an error will be returned.</span></span>
-   <span data-ttu-id="cbde4-134">Anbieter generieren für diese Art von Schatten Kopie keine [*prepareforsnapshot*](vssgloss-p.md)-, [*Freeze*](vssgloss-f.md)-, [*Thaw*](vssgloss-t.md)-oder [*PostSnapshot*](vssgloss-p.md) -Ereignisse.</span><span class="sxs-lookup"><span data-stu-id="cbde4-134">Providers will not generate [*PrepareForSnapshot*](vssgloss-p.md), [*Freeze*](vssgloss-f.md), [*Thaw*](vssgloss-t.md), or [*PostSnapshot*](vssgloss-p.md) events for this type of shadow copy.</span></span>

 

 



