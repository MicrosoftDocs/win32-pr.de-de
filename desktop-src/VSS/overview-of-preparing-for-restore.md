---
description: Bei der Vorbereitung einer Wiederherstellung verwendet ein Anforderer die gespeicherten Writer Metadata Documents in Verbindung mit seinem eigenen abgerufenen Sicherungskomponentendokument, um zu bestimmen, was wiederhergestellt werden soll.
ms.assetid: 36cf188f-fce6-467c-a200-cbd9dc8f31a6
title: Übersicht über die Vorbereitung auf die Wiederherstellung
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fa9748ff3d6602695dfde703b020e10ab05791d5eeb3957d23a1d1a4fcb82cc2
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/11/2021
ms.locfileid: "118998155"
---
# <a name="overview-of-preparing-for-restore"></a>Übersicht über die Vorbereitung auf die Wiederherstellung

Bei der Vorbereitung einer Wiederherstellung verwendet ein Anforderer die gespeicherten Writer Metadata Documents in Verbindung mit seinem eigenen abgerufenen Sicherungskomponentendokument, um zu bestimmen, was wiederhergestellt werden soll. Weitere Informationen finden Sie unter [Übersicht über die Verarbeitung einer Wiederherstellung unter VSS.](overview-of-processing-a-restore-under-vss.md)

Nach der Auswahl der wiederherzustellenden Komponenten greifen Writer, die derzeit auf dem System ausgeführt werden, auf das Sicherungskomponentendokument des Anfordernden zu. Writer verwenden diesen Zugriff, um anzugeben, wie die Ausführung von Diensten aufgrund der Wiederherstellung minimal erschwert werden kann.

Nachdem dies abgeschlossen ist, verfügt der Anforderer über genügend Informationen, um zu bestimmen, welche Dateien wiederhergestellt werden müssen und wo und wie sie wiederhergestellt werden sollen. (Weitere Informationen finden Sie unter [Generieren eines Wiederherstellungssatzes.)](generating-a-restore-set.md)

Die folgende Tabelle zeigt die Abfolge von Aktionen und Ereignissen, die für die Vorbereitung auf einen Wiederherstellungsvorgang erforderlich sind.



| Anfordereraktion                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Ereignis                                                         | Writer-Aktion                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Rufen Sie Informationen aus dem Sicherungskomponentendokument zu den Komponenten ab, die explizit im Sicherungsvorgang [*enthalten sind*](vssgloss-e.md) (siehe [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents)) Überprüfen Sie abgerufene Writer-Metadatendokumente, um Details zu diesen Komponenten abzurufen, die explizit in die Sicherung eingeschlossen sind, sowie alle implizit [*enthaltenen*](vssgloss-i.md) Unterkomponenten. (Siehe [**IVssEx csvWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata), [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent).)<br/> | Keine                                                          | Keine                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Wählen Sie komponenten und komponentensätze aus, die wiederhergestellt werden sollen (siehe [**IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) und [**IVssBackupComponents::AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent).)                                                                                                                                                                                                                                                                                                                                                                                          | Keine                                                          | Keine                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Der Anforderer ermöglicht dem Writer das Aktualisieren des Sicherungskomponentendokuments und kann dem Writer optional spezielle Wiederherstellungsoptionen mitteilen. (Siehe [**IVssBackupComponents::SetRestoreOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions), [**IVssBackupComponents::AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget)und [**IVssBackupComponents::P reRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore).)                                                                                                                                                                                                                                         | [*PreRestore*](vssgloss-p.md) | Der Writer bestimmt die Teilnahme an der Wiederherstellung, bereitet dateien für die Wiederherstellung vor und ändert bei Bedarf optional das Sicherungskomponentendokument. (Siehe [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent), [**IVssComponent::IsSelectedForRestore**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-isselectedforrestore), [**IVssComponent::GetRestoreOptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoreoptions), [**IVssComponent::SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget), [**IVssComponent::SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata), [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget).) |
| Der Anfordernde wartet auf Writer, um das [**PreRestore-Ereignis**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) mit [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync)zu behandeln. Außerdem sollte der Writerstatus überprüft werden. (Siehe [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus).)                                                                                                                                                                                                                                                                                  | Keine                                                          | Keine                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |



 

## <a name="requester-actions-during-restore-preparations"></a>Aktionen des Anfordernden während der Wiederherstellungsvorbereitungen

Um zu bestimmen, welche Komponenten kandidaten für die Wiederherstellung sind, muss der Anforderer folgende Schritte ausführen:

-   Richten Sie die Komponente und die [*Komponentensatzstruktur*](vssgloss-c.md) ein, die zum Erstellen der Sicherung verwendet werden.
-   Überprüfen Sie die [*Selektivität*](vssgloss-s.md)der Komponenten für die Wiederherstellung.
-   Verwenden Sie Auswahlrichtlinien[(Arbeiten mit Der Auswählbarkeit für Wiederherstellung und Unterkomponenten](working-with-selectability-for-restore-and-subcomponents.md)), um die einzufügenden Komponenten auszuwählen.
-   Verwenden Sie [*Komponentendateisatzinformationen,*](vssgloss-f.md) um zu bestimmen, welche Dateien auf dem Sicherungsmedium wiederhergestellt werden müssen.

Hierzu muss der Anforderer [*explizit eingeschlossene*](vssgloss-e.md) Komponenten im gespeicherten Sicherungskomponentendokument untersuchen. Diese Komponenteninformationen sind auf Writer-by-Writer-Basis mithilfe von [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents)verfügbar, die Instanzen der [**IVssWriterComponentsExt-Schnittstelle**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) zurückgibt, aus der sowohl Writerinformationen als auch Instanzen der [**IVssComponent-Schnittstelle**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) abgerufen werden können.

Wie an anderer Stelle [(Verwendung von Komponenten durch den Anforderer)](use-of-components-by-the-requestor.md)erwähnt, enthalten das Sicherungskomponentendokument und die **IVssComponent-Schnittstelle** nicht genügend Informationen, um die Sicherung zu unterstützen. Daher muss der Anforderer das entsprechende gespeicherte Writer Metadata Document mithilfe von [**IVssExwriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) untersuchen (siehe [Writer Identification Information](writer-metadata-document-contents.md)).

Die Anzahl der komponenten, die jeder Writer verwaltet, wird von [**IVssExwriterMetadata::GetFileCounts**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getfilecounts)zurückgegeben. Der Anforderer kann dann [**IVssExwriterMetadata::GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) verwenden, um eine [**IVssWMComponent-Schnittstelle**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) für jede Komponente abzurufen, die ein Writer verwaltet.

Durch Untersuchen der [*Selektivität*](vssgloss-s.md) der Komponenten für Sicherungen und [*logische Pfade*](vssgloss-l.md) (siehe Arbeiten [mit Selektivität und logischen Pfaden)](working-with-selectability-and-logical-paths.md)kann ein Anforderer die Komponenten identifizieren, die Sicherungszeit-Komponentensätze definiert haben (explizit eingeschlossene Komponenten) und die Unterkomponentenmember dieser Sätze (implizit eingeschlossene Komponenten).

Anforderer geben über das Sicherungskomponentendokument an, ob eine Komponente explizit wiederhergestellt werden soll, indem sie entweder [**IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) oder [**IVssBackupComponents::AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent)verwenden. Die Auswahl der Methode hängt davon ab, wie die Komponente ursprünglich gesichert wurde, und von ihrer [*Auswahl für die Wiederherstellung.*](vssgloss-s.md) Diese Komponenten, die explizit für die Wiederherstellung eingeschlossen werden, bestimmen andere Komponenten, die implizit enthalten sind (details finden Sie unter [Working with Selectability for Restore and Subcomponents (Arbeiten mit Auswahlfähigkeit für Wiederherstellungs- und Unterkomponenten).](working-with-selectability-for-restore-and-subcomponents.md)

Ein Anforderer kann explizit keine der Derzeit ausgeführten Writerkomponenten für die Wiederherstellung mit [**IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) oder [**IVssBackupComponents::AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent)einschließen. In diesem Fall empfängt dieser Writer für den Rest des Wiederherstellungsvorgangs keine VSS-Ereignisse.

Die explizite Verwendung von [**IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) oder [**IVssBackupComponents::AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent) zum Auswählen einer Komponente eines Writers, der derzeit nicht ausgeführt wird, gibt einen \_ VSS E \_ OBJECT NOT \_ \_ FOUND-Fehler zurück. Informationen zum Wiederherstellen der Daten fehlender Writer finden Sie unter [Wiederherstellungen ohne Writer-Beteiligung.](restores-without-writer-participation.md)

Damit ein Writer vollständige Informationen zur Aktion erhalten kann, können writerspezifische Wiederherstellungsoptionen und Der Hinweis auf eine inkrementelle Wiederherstellung durch Aufrufe von [**IVssBackupComponents::SetRestoreOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions) bzw. [**IVssBackupComponents::SetAdditionalRestores**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores)an die Writer gesendet werden.

An diesem Punkt hat ein Anforderer seine Vorbereitung abgeschlossen und generiert ein **PreRestore-Ereignis,** indem [**er IVssBackupComponents::P reRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore)aufruft, sodass Writer sich auf die tatsächliche Wiederherstellung vorbereiten können.

## <a name="writer-actions-during-restore-preparations"></a>Writer-Aktionen während der Wiederherstellungsvorbereitungen

Die Writervorbereitung für den Wiederherstellungsvorgang erfolgt, wenn das [**PreRestore-Ereignis**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) mit der virtuellen Methode [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore)behandelt wird. Die Standardimplementierungen geben einfach zurück, ohne eine Aktion zu ergreifen. Writer können die Standardimplementierungen überschreiben, um mehr Kontrolle über folgende Aufgaben zu haben:

-   Überschreiben von [*Wiederherstellungsmethoden*](vssgloss-r.md) mit [*Wiederherstellungszielen*](vssgloss-r.md)
-   Definieren [ *von gerichteten Zielen*](vssgloss-d.md)
-   Erstellen von Fehlermeldungen und zusätzlichen Daten
-   Bereitstellen von Sicherungsstempelinformationen

Der Ereignishandler [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore) empfängt eine Instanz von [**IVssWriterComponents,**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents)von der [**IVssComponent-Schnittstellen**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) für die Komponenten erhalten werden können, die während der Sicherung explizit im Sicherungskomponentendokument enthalten sind.

Informationen zu Unterkomponenten, die implizit in Sicherungsvorgänge eingeschlossen und explizit in Wiederherstellungen eingeschlossen werden, indem eine Instanz der **IVssComponent** verwendet wird, die der Komponente entspricht, die den [*Sicherungskomponentensatz*](vssgloss-c.md)definiert hat.

Die [**IVssComponent::IsSelectedForRestore-Methode**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-isselectedforrestore) wird verwendet, um zu bestimmen, ob eine explizit für die Sicherungskomponente enthaltene wiederhergestellt werden soll.

Um zu bestimmen, ob eine Sicherungsunterkomponente explizit in die Wiederherstellung eingeschlossen wurde, verwenden Writer [**IVssComponent::GetRestoreSubcomponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoresubcomponent).

Der Writer sollte den [*Dateisatz*](vssgloss-f.md) in jeder Komponente untersuchen und ermitteln, ob er Maßnahmen ergreifen muss, um die Wiederherstellung zu unterstützen. Der Writer muss auswerten, ob die aktuellen Dateien überschrieben werden sollen oder ob eine Wiederherstellung an neuen Speicherorten erforderlich ist. Aktionen können Folgendes umfassen:

-   Abrufen und Agieren auf writer- oder anfordererspezifische Optionen für Wiederherstellungsvorgänge (siehe [**IVssComponent::GetRestoreOptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoreoptions))
-   Schließen und Schreiben aller derzeit geöffneten Dateien
-   Aktualisieren des Wiederherstellungsziels (z. B. zum Erzwingen der Wiederherstellung an einer alternativen Speicherortzuordnung). Siehe [**IVssComponent::SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget).
-   Kommunikation mit dem Anfordernden über private Metadaten (siehe [**IVssComponent::SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata))
-   Gibt an, dass eine Datei wiederhergestellt werden soll, indem die Definition der [*gerichteten Ziele*](vssgloss-d.md) neu angepasst wird (siehe [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget)).

Die verwendete Instanz von [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) ist entweder die Instanz, die durch die explizite Aufnahme der Komponente in das Sicherungskomponentendokument während der Sicherung erstellt wurde, oder die Instanz der Komponente, die den Sicherungskomponentensatz definiert, dessen Mitglied sie war (siehe [Working with Selectability For Restore and Subcomponents](working-with-selectability-for-restore-and-subcomponents.md)).

 

 
