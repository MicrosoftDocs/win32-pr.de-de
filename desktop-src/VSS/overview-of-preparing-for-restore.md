---
description: Beim Vorbereiten der Wiederherstellung verwendet ein Anforderer die gespeicherten Writer-Metadatendokumente zusammen mit dem eigenen abgerufenen Sicherungs Komponenten Dokument, um zu bestimmen, was wieder hergestellt werden soll und wie.
ms.assetid: 36cf188f-fce6-467c-a200-cbd9dc8f31a6
title: Übersicht über das Vorbereiten der Wiederherstellung
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d8b1bc3e429da5be9872e8345fe6da32a5340005
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "106354639"
---
# <a name="overview-of-preparing-for-restore"></a>Übersicht über das Vorbereiten der Wiederherstellung

Beim Vorbereiten der Wiederherstellung verwendet ein Anforderer die gespeicherten Writer-Metadatendokumente zusammen mit dem eigenen abgerufenen Sicherungs Komponenten Dokument, um zu bestimmen, was wieder hergestellt werden soll und wie. Weitere Informationen finden Sie [unter Übersicht über die Verarbeitung einer Wiederherstellung unter VSS](overview-of-processing-a-restore-under-vss.md).

Nach der Auswahl der Wiederherstellungs Kandidaten Komponenten greifen Writer, die derzeit auf dem System ausgeführt werden, auf das Dokument mit den Sicherungs Komponenten der Anforderer zu. Writer verwenden diesen Zugriff, um anzugeben, wie eine minimale Schwierigkeit für das Ausführen von Diensten aufgrund der Wiederherstellung verursacht wird.

Nachdem dieser Vorgang abgeschlossen ist, verfügt der Anforderer über ausreichend Informationen, um zu bestimmen, welche Dateien wieder hergestellt werden müssen, sowie wo und wie Sie wieder hergestellt werden sollten. (Weitere Informationen finden Sie unter [Erstellen einer Wiederherstellungs Gruppe](generating-a-restore-set.md).)

In der folgenden Tabelle wird die Abfolge der Aktionen und Ereignisse aufgeführt, die für die Vorbereitung auf einen Wiederherstellungs Vorgang erforderlich sind.



| Requestaktion                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Ereignis                                                         | Writer-Aktion                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Abrufen von Informationen aus dem Sicherungs Komponenten Dokument zu den Komponenten, die explizit in den Sicherungs Vorgang [*eingeschlossen*](vssgloss-e.md) werden (siehe [**IVssBackupComponents:: getschreitercomponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents)) untersuchen von abgerufenen Writer-Metadatendokumenten, um Details zu den explizit in der Sicherung enthaltenen Komponenten zu erhalten und alle [*implizit enthaltenen*](vssgloss-i.md) unter Komponenten zu suchen. (Siehe [**ivssexaminewrite Metadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata), [**ivsswmcomponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent).)<br/> | Keine                                                          | Keine                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Wählen Sie Komponenten und Komponenten Sätze aus, die wieder hergestellt werden sollen (siehe [**IVssBackupComponents:: setselectedforrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) und [**IVssBackupComponents:: adressstoresubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent)).                                                                                                                                                                                                                                                                                                                                                                                          | Keine                                                          | Keine                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Der Anforderer ermöglicht es dem Writer, das Dokument mit den Sicherungs Komponenten zu aktualisieren, und kann optional allen speziellen Wiederherstellungsoptionen für den Writer mitteilen. (Siehe [**IVssBackupComponents:: setrestoreoptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions), [**IVssBackupComponents:: addnewtarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget)und [**IVssBackupComponents::P erneut**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore).)                                                                                                                                                                                                                                         | [*Vorabversion*](vssgloss-p.md) | Der Writer bestimmt die Teilnahme an der Wiederherstellung, bereitet die wiederherzustellenden Dateien vor und ändert bei Bedarf optional das Dokument mit den Sicherungs Komponenten. (Siehe [**CVssWriter:: onprerestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent), [**IVssComponent:: isselectedforrestore**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-isselectedforrestore), [**IVssComponent:: getrestoreoptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoreoptions), [**IVssComponent:: setrestoretarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget), [**IVssComponent:: setrestoremetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata), [**IVssComponent:: adddirectedtarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget).) |
| Der Anforderer wartet darauf, dass Writer das [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) -Ereignis mit [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync)verarbeiten. Außerdem sollte der Writer-Status überprüft werden. (Siehe [**IVssBackupComponents:: gatherschreiterstatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents:: getschreiterstatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus).)                                                                                                                                                                                                                                                                                  | Keine                                                          | Keine                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |



 

## <a name="requester-actions-during-restore-preparations"></a>Requestaktionen während der Wiederherstellungs Vorbereitung

Um zu ermitteln, welche Komponenten als Kandidaten für die Wiederherstellung dienen, muss der Anforderer die folgenden Schritte ausführen:

-   Richten Sie die Komponente und die [*Komponenten Satz*](vssgloss-c.md) Struktur ein, die zum Erstellen der Sicherung verwendet wird.
-   Untersuchen Sie die [*selekabilität der Komponenten für die Wiederherstellung*](vssgloss-s.md).
-   Verwenden Sie Richtlinien zur Auswahl von Richtlinien ([Arbeiten mit selekabilität für Wiederherstellung und unter Komponenten](working-with-selectability-for-restore-and-subcomponents.md)), um einzuschließdende Komponenten auszuwählen
-   Bestimmen Sie anhand der Informationen der Komponenten [*Datei Gruppe*](vssgloss-f.md) , welche Dateien auf dem Sicherungsmedium wieder hergestellt werden müssen.

Zu diesem Zweck muss der Anforderer [*explizit enthaltene*](vssgloss-e.md) Komponenten im Dokument mit den gespeicherten Sicherungs Komponenten untersuchen. Diese Komponenten Informationen sind auf Writer-für-Writer-Basis mithilfe von [**IVssBackupComponents:: getschreitercomponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents)verfügbar, das Instanzen der [**ivssschreitercomponentc-Schnittstelle**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) zurückgibt, von denen sowohl Writer-Informationen als auch Instanzen der [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) -Schnittstelle abgerufen werden können.

Wie an anderer Stelle notiert ([Verwendung von Komponenten durch den Anforderer](use-of-components-by-the-requestor.md)), enthalten das Dokument mit den Sicherungs Komponenten und die **IVssComponent** -Schnittstelle nicht genügend Informationen zur Unterstützung der Sicherung. Daher muss der Anforderer das entsprechende gespeicherte Writer-Metadatendokument mithilfe von [**ivssexamineschreibmetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) untersuchen (siehe [Writer-Identifikationsinformationen](writer-metadata-document-contents.md)).

Die Anzahl der von jedem Writer verwalteten Komponenten wird von [**ivssexamineschreibmetadata:: getfilecounts**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getfilecounts)zurückgegeben. Der Anforderer kann dann [**ivssexaminewrite Metadata:: getComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) verwenden, um eine [**ivsswmcomponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) -Schnittstelle für jede von einem Writer verwaltete Komponente zu erhalten.

Durch die Untersuchung der [*selekabilität der Komponenten für Sicherungs*](vssgloss-s.md) -und [*logische Pfade*](vssgloss-l.md) (siehe [Arbeiten mit selekabilität und logischen Pfaden](working-with-selectability-and-logical-paths.md)) kann ein Anforderer die Komponenten identifizieren, die die Sicherungs Zeit-Komponenten Sätze (explizit enthaltene Komponenten) und die unter Komponenten Mitglieder dieser Sätze (implizit enthaltene Komponenten) definieren.

Anforderer geben das Dokument mit den Sicherungs Komponenten an, wenn eine Komponente explizit wieder hergestellt werden soll, entweder mithilfe von [**IVssBackupComponents:: setselectedforrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) oder [**IVssBackupComponents:: adressstoresubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent). Die Auswahl der Methode hängt davon ab, wie die Komponente ursprünglich gesichert wurde, und deren [*selektorart für die Wiederherstellung*](vssgloss-s.md). Diese Komponenten, die explizit für die Wiederherstellung eingeschlossen werden, legen andere Komponenten fest, die implizit eingeschlossen sind (Weitere Informationen finden Sie [unter Arbeiten mit der Auswahl von "Restore" und unter Komponenten](working-with-selectability-for-restore-and-subcomponents.md)

Ein Anforderer kann explizit keine der derzeit ausgeführten Writer-Komponenten für die Wiederherstellung mithilfe von [**IVssBackupComponents:: setselectedforrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) oder [**IVssBackupComponents:: adressstoresubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent)einschließen. In diesem Fall empfängt dieser Writer keine VSS-Ereignisse für den Rest des Wiederherstellungs Vorgangs.

Explizites Verwenden von [**IVssBackupComponents:: setselectedforrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) oder [**IVssBackupComponents:: adressstoresubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent) zum Auswählen einer Komponente eines Writer, der zurzeit nicht ausgeführt wird, wird ein VSS \_ E- \_ \_ Fehler gefunden, der nicht gefunden wurde \_ . Informationen zum Wiederherstellen der Daten fehlender Writer finden Sie unter Wiederherstellungen [ohne Writer-Teilnahme](restores-without-writer-participation.md) .

Damit ein Writer über umfassende Informationen zum agieren verfügen kann, können Writer-spezifische Wiederherstellungsoptionen und die Angabe einer inkrementellen Wiederherstellung an die Writer von Anforderer Aufrufen an [**IVssBackupComponents:: setrestoreoptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions) und [**IVssBackupComponents:: setadditionalrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores)gesendet werden.

An diesem Punkt ist die Vorbereitung eines Anforderers abgeschlossen, und es wird ein **PreRestore** -Ereignis generiert, indem [**IVssBackupComponents::P reitore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore)aufgerufen wird, sodass Writer die tatsächliche Wiederherstellung vorbereiten können.

## <a name="writer-actions-during-restore-preparations"></a>Writer-Aktionen während der Wiederherstellungs Vorbereitung

Die Writer-Vorbereitung für den Wiederherstellungs Vorgang tritt auf, wenn das [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) -Ereignis mit der virtuellen Methode [**CVssWriter:: onprerestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore)verarbeitet wird. Die Standard Implementierung gibt einfach zurück, ohne eine Aktion durchführt. Writer können sich entscheiden, die Standard Implementierung zu überschreiben, um eine bessere Kontrolle zu treffen:

-   Überschreiben von [*Wiederherstellungsmethoden*](vssgloss-r.md) mit [*Wiederherstellungs Zielen*](vssgloss-r.md)
-   Definieren von [ *gerichteten Zielen*](vssgloss-d.md)
-   Erstellen von Fehlermeldungen und zusätzlichen Daten
-   Bereitstellen von Sicherungs Stempel Informationen

Der Ereignishandler [**CVssWriter:: onprerestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore) empfängt eine Instanz von [**ivssschreitercomponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents), von der er [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) -Schnittstellen für die Komponenten abrufen kann, die während der Sicherung explizit im Sicherungs Komponenten Dokument enthalten sind.

Informationen zu unter Komponenten, die implizit in Sicherungs Vorgänge eingeschlossen und explizit in Wiederherstellungen eingeschlossen werden, mithilfe einer Instanz von **IVssComponent** , die der Komponente entspricht, die den zugehörigen Sicherungs [*Komponenten Satz*](vssgloss-c.md)definiert hat.

Die [**IVssComponent:: isselectedforrestore**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-isselectedforrestore) -Methode wird verwendet, um zu bestimmen, ob eine explizit enthaltene Sicherungs Komponente wieder hergestellt werden soll.

Um zu ermitteln, ob eine Unterkomponente der Sicherung explizit in die Wiederherstellung eingeschlossen wurde, verwenden die Writer [**IVssComponent:: getrestoresubcomponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoresubcomponent).

Der Writer sollte den [*Datei Satz*](vssgloss-f.md) in jeder Komponente überprüfen und ermitteln, ob er Maßnahmen zur Unterstützung der Wiederherstellung ausführen muss. Der Writer muss auswerten, ob die aktuellen Dateien überschrieben werden sollen, oder ob er an neuen Speicherorten wieder hergestellt werden muss. Folgende Aktionen sind möglich:

-   Erhalten und reagieren auf alle Writer-oder requestspezifischen Optionen für Wiederherstellungs Vorgänge (siehe [**IVssComponent:: getrestoreoptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoreoptions))
-   Schließen und über schreibbare Dateien, die aktuell geöffnet sind
-   Aktualisieren des Wiederherstellungs Ziels (z.b., um die Wiederherstellung an einer alternativen Speicherort Zuordnung zu erzwingen). Siehe [**IVssComponent:: abtrestoretarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget).
-   Kommunikation mit dem Anforderer über Private Metadaten (siehe [**IVssComponent:: abtrestoremetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata))
-   Gibt an, dass eine Datei wieder hergestellt werden soll, indem die Definition der [*gerichteten Ziele*](vssgloss-d.md) neu zugeordnet wird (siehe [**IVssComponent:: adddirectedtarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget)).

Die verwendete Instanz von [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) wird entweder von der expliziten Einbindung der Komponente in das Sicherungs Komponenten Dokument während der Sicherung erstellt, oder von der Komponente, die den Sicherungs Komponenten Satz definiert, von dem Sie Mitglied war (siehe [Arbeiten mit selekabilität für die Wiederherstellung und unter Komponenten](working-with-selectability-for-restore-and-subcomponents.md)).

 

 
