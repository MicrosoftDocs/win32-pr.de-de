---
description: Ein Schattenkopieanbieter muss den Richtlinien entsprechen, um die Kompatibilität von Anforderungen sicherzustellen.
ms.assetid: 49baeb89-1dc9-45c2-a532-071085a8e52f
title: Erforderliches Verhalten für Schattenkopieanbieter
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f451dea7154a313cd64a3a46fbcc3b5fe663ec12
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "106360199"
---
# <a name="required-behaviors-for-shadow-copy-providers"></a><span data-ttu-id="fd61d-103">Erforderliches Verhalten für Schattenkopieanbieter</span><span class="sxs-lookup"><span data-stu-id="fd61d-103">Required Behaviors for Shadow Copy Providers</span></span>

<span data-ttu-id="fd61d-104">Ein Schattenkopieanbieter muss den Richtlinien entsprechen, um die Kompatibilität von Anforderungen sicherzustellen.</span><span class="sxs-lookup"><span data-stu-id="fd61d-104">A shadow copy provider must conform to guidelines to ensure requester compatibility.</span></span> <span data-ttu-id="fd61d-105">Zur Laufzeit muss eine Sicherungs Anwendung oder ein beliebiger anderer Anforderer, der Schatten Kopien verwendet, ordnungsgemäß funktionieren, ohne dass spezifische Details der Anbieter Implementierung vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="fd61d-105">At runtime, a backup application or any other requester that uses shadow copies must function correctly without any knowledge of specific provider implementation details.</span></span>

## <a name="automagic-resource-management"></a><span data-ttu-id="fd61d-106">Automatisierung der Ressourcenverwaltung</span><span class="sxs-lookup"><span data-stu-id="fd61d-106">Automagic Resource Management</span></span>

<span data-ttu-id="fd61d-107">Es muss möglich sein, dass der Anforderer einem Schattenkopiesatz einfach ein Volume hinzufügt.</span><span class="sxs-lookup"><span data-stu-id="fd61d-107">It must be possible for the requester to simply add a volume to a shadow copy set.</span></span> <span data-ttu-id="fd61d-108">Der Anforderer kann schattenkopieattribute wie **VSS \_ Volsnap \_ attr \_ transportable**, **VSS \_ Volsnap \_ attr \_ Differential** und/oder **VSS \_ Volsnap \_ attr \_ Plex** im [**\_ VSS- \_ Momentaufnahme \_ Kontext**](/windows/desktop/api/Vss/ne-vss-vss_snapshot_context)angeben.</span><span class="sxs-lookup"><span data-stu-id="fd61d-108">The requester can specify shadow copy attributes such as **VSS\_VOLSNAP\_ATTR\_TRANSPORTABLE**, **VSS\_VOLSNAP\_ATTR\_DIFFERENTIAL**, and/or **VSS\_VOLSNAP\_ATTR\_PLEX** in the [**\_VSS\_SNAPSHOT\_CONTEXT**](/windows/desktop/api/Vss/ne-vss-vss_snapshot_context).</span></span> <span data-ttu-id="fd61d-109">Der Anbieter muss diese Attribute berücksichtigen.</span><span class="sxs-lookup"><span data-stu-id="fd61d-109">The provider must honor those attributes.</span></span> <span data-ttu-id="fd61d-110">Wenn diese Attribute nicht berücksichtigt werden können, sollte Sie angeben, dass der Schattenkopiesatz nicht unterstützt wird, indem \* *pbissupported* in [**ivsshardwaresnapshotprovider:: arelunssupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported) auf **false** festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="fd61d-110">If it cannot honor those attributes, then it should indicate that the shadow copy set is unsupported by setting the \**pbIsSupported* in [**IVssHardwareSnapshotProvider::AreLunsSupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported) to **FALSE**.</span></span>

<span data-ttu-id="fd61d-111">Der Anbieter darf nicht die Unterstützung einer Schatten Kopie akzeptieren, die nicht erstellt werden kann.</span><span class="sxs-lookup"><span data-stu-id="fd61d-111">The provider must never agree to support a shadow copy that it cannot create.</span></span> <span data-ttu-id="fd61d-112">Wenn die anfordernde Person kein Plex-oder differenzielle Attribut angibt, muss der Anbieter automaginglogik zum Zuordnen des subsystemraums für die Schatten Kopie einschließen und die Schatten Kopie mithilfe der am besten geeigneten Methode erstellen.</span><span class="sxs-lookup"><span data-stu-id="fd61d-112">If the requester does not specify a plex or differential attribute, the provider must include automagic logic for allocating subsystem space for the shadow copy and create the shadow copy using the most appropriate method.</span></span> <span data-ttu-id="fd61d-113">Der Hardware Anbieter darf keine anbieterspezifische API zum Verwalten der erforderlichen schattenkopieeigenschaften enthalten.</span><span class="sxs-lookup"><span data-stu-id="fd61d-113">The hardware provider must not include a provider-specific API for managing required shadow copy properties.</span></span>

## <a name="created-shadow-copy-volumes-are-read-only-and-hidden"></a><span data-ttu-id="fd61d-114">Erstellte Schattenkopievolumes werden Read-Only und ausgeblendet.</span><span class="sxs-lookup"><span data-stu-id="fd61d-114">Created Shadow Copy Volumes Are Read-Only and Hidden</span></span>

<span data-ttu-id="fd61d-115">VSS legt Flags für jede betroffene LUN fest, sodass die resultierenden Schattenkopievolumes ausgeblendet und schreibgeschützt werden, wenn Sie von einem Computer mit Windows Server 2003 erkannt werden.</span><span class="sxs-lookup"><span data-stu-id="fd61d-115">VSS sets flags on each affected LUN such that the resulting shadow copy volumes will be hidden and read-only when detected by a computer running Windows Server 2003.</span></span> <span data-ttu-id="fd61d-116">Laufwerk Buchstaben und eingebundene Ordner werden nicht automatisch zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="fd61d-116">Drive letters and mounted folders are not automatically assigned.</span></span> <span data-ttu-id="fd61d-117">VSS verwaltet diese Flags während des Lebenszyklus einer Schatten Kopie.</span><span class="sxs-lookup"><span data-stu-id="fd61d-117">VSS maintains these flags throughout the life cycle of a shadow copy.</span></span>

## <a name="hardware-shadow-copy-luns-must-be-readwrite"></a><span data-ttu-id="fd61d-118">Hardware Schatten Kopie-LUNs müssen Lese-/Schreibzugriff aufweisen.</span><span class="sxs-lookup"><span data-stu-id="fd61d-118">Hardware Shadow Copy LUNs Must Be Read/Write</span></span>

<span data-ttu-id="fd61d-119">VSS unterstützt Hardware Schatten Kopien nur dann, wenn die zugrunde liegende LUN als Lese-/Schreibzugriff zugeordnet ist.</span><span class="sxs-lookup"><span data-stu-id="fd61d-119">VSS supports hardware shadow copies only where the underlying LUN is mapped as read/write.</span></span> <span data-ttu-id="fd61d-120">Dies muss erfolgen, bevor die Schatten Kopie erstellt wird. Dies kann nicht nach dem Fakt erfolgen.</span><span class="sxs-lookup"><span data-stu-id="fd61d-120">This must be done before the shadow copy is created; it cannot be done after the fact.</span></span> <span data-ttu-id="fd61d-121">Diese Flags dürfen von Hardware Anbietern nicht geändert werden.</span><span class="sxs-lookup"><span data-stu-id="fd61d-121">Hardware providers should not modify these flags.</span></span> <span data-ttu-id="fd61d-122">Weitere Informationen darüber, wie VSS diese Flags verwendet, finden Sie [unter Erstellen von Schatten Kopien](the-shadow-copy-creation-process.md).</span><span class="sxs-lookup"><span data-stu-id="fd61d-122">For more information about how VSS uses these flags, see [The Shadow Copy Creation Process](the-shadow-copy-creation-process.md).</span></span>

## <a name="auto-import-hardware-shadow-copies-are-not-supported-on-windows-cluster-service"></a><span data-ttu-id="fd61d-123">Hardware Schatten Kopien automatisch importieren werden im Windows-Cluster Dienst nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="fd61d-123">Auto-Import Hardware Shadow Copies Are Not Supported on Windows Cluster Service</span></span>

<span data-ttu-id="fd61d-124">Windows Clusterdienst kann keine LUNs mit doppelten Signaturen und Partitionslayout aufnehmen.</span><span class="sxs-lookup"><span data-stu-id="fd61d-124">Windows Cluster service cannot accommodate LUNs with duplicate signatures and partition layout.</span></span> <span data-ttu-id="fd61d-125">Die schattenkopieluns müssen auf einen Host außerhalb des Clusters übertragen werden.</span><span class="sxs-lookup"><span data-stu-id="fd61d-125">The shadow copy LUNs must be transported to a host outside the cluster.</span></span> <span data-ttu-id="fd61d-126">Weitere Informationen finden Sie unter [schnelle Wiederherstellung mithilfe von transportable-Schattenkopievolumes](fast-recovery-using-transportable-shadow-copied-volumes.md).</span><span class="sxs-lookup"><span data-stu-id="fd61d-126">For more information, see [Fast Recovery Using Transportable Shadow Copied Volumes](fast-recovery-using-transportable-shadow-copied-volumes.md).</span></span>

## <a name="shadow-copies-that-contain-dynamic-disks-must-be-transported-to-a-different-host"></a><span data-ttu-id="fd61d-127">Schatten Kopien, die dynamische Datenträger enthalten, müssen zu einem anderen Host transportiert werden.</span><span class="sxs-lookup"><span data-stu-id="fd61d-127">Shadow Copies That Contain Dynamic Disks Must Be Transported to a Different Host</span></span>

<span data-ttu-id="fd61d-128">**Vor Windows Server 2008:** Die native Unterstützung für dynamische Datenträger kann keine LUNs mit doppelten Signaturen und Konfigurationsdaten Bank Inhalten aufnehmen.</span><span class="sxs-lookup"><span data-stu-id="fd61d-128">**Prior to Windows Server 2008:** The native support for dynamic disks cannot accommodate LUNs with duplicate signatures and configuration database contents.</span></span> <span data-ttu-id="fd61d-129">Die schattenkopieluns müssen auf einen anderen Host übertragen werden.</span><span class="sxs-lookup"><span data-stu-id="fd61d-129">The shadow copy LUNs must be transported to a different host.</span></span> <span data-ttu-id="fd61d-130">VSS erzwingt dies, indem Schatten Kopien dynamischer Datenträger nicht automatisch importiert werden.</span><span class="sxs-lookup"><span data-stu-id="fd61d-130">VSS enforces this by not allowing auto-import shadow copies of dynamic disks.</span></span> <span data-ttu-id="fd61d-131">Ein Anforderer sollte eine austauschen-Schatten Kopie nicht zurück auf denselben Host importieren.</span><span class="sxs-lookup"><span data-stu-id="fd61d-131">A requester should not import a transportable shadow copy back to the same host.</span></span>

<span data-ttu-id="fd61d-132">**Ab Windows Server 2008:** Diese Einschränkung wird entfernt.</span><span class="sxs-lookup"><span data-stu-id="fd61d-132">**Beginning with Windows Server 2008:** This limitation is removed.</span></span>

## <a name="providers-are-out-of-process"></a><span data-ttu-id="fd61d-133">Anbieter sind außerhalb des Prozesses</span><span class="sxs-lookup"><span data-stu-id="fd61d-133">Providers Are Out-of-Process</span></span>

<span data-ttu-id="fd61d-134">Alle Anbieter müssen als Prozess interne com-Komponenten implementiert werden.</span><span class="sxs-lookup"><span data-stu-id="fd61d-134">All providers must be implemented as out-of-process COM components.</span></span>

## <a name="time-critical-operations"></a><span data-ttu-id="fd61d-135">Time-Critical Vorgänge</span><span class="sxs-lookup"><span data-stu-id="fd61d-135">Time-Critical Operations</span></span>

<span data-ttu-id="fd61d-136">Lange Vorgänge, wie z. b. das Synchronisieren von plexes, sollten in [**ivsshardwaresnapshotprovider:: beginpreparesnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-beginpreparesnapshot)initiiert werden.</span><span class="sxs-lookup"><span data-stu-id="fd61d-136">Long operations, such as syncing plexes, should be initiated in [**IVssHardwareSnapshotProvider::BeginPrepareSnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-beginpreparesnapshot).</span></span> <span data-ttu-id="fd61d-137">Diese Funktion sollte die asynchrone Vorbereitungsarbeit starten und schnell zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="fd61d-137">This function should start the asynchronous preparation work and return quickly.</span></span> <span data-ttu-id="fd61d-138">[**Ivssproviderkreatesnapshotset:: EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots) fungiert als "Rendezvous"-Funktion – der Anbieter kann synchron in dieser Methode warten, bis die Vorbereitungsarbeit abgeschlossen ist, die von **beginpreparesnapshot** gestartet wurde.</span><span class="sxs-lookup"><span data-stu-id="fd61d-138">[**IVssProviderCreateSnapshotSet::EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots) serves as a "rendezvous" function—the provider can wait synchronously in this method for the completion of the preparation work that was started by **BeginPrepareSnapshot**.</span></span>

<span data-ttu-id="fd61d-139">Anbieter dürfen in [**ivssproviderkreatesnapshotset keine Verzögerungen hinzufügen::P recommitsnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-precommitsnapshots), [**ivssproviderfroatesnapshotset:: commitsnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots)oder [**ivssproviderkreatesnapshotset::P ostcommitsnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots) , wenn Anwendungen während dieser Aufrufe eingefroren sind.</span><span class="sxs-lookup"><span data-stu-id="fd61d-139">Providers must not add delays in [**IVssProviderCreateSnapshotSet::PreCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-precommitsnapshots), [**IVssProviderCreateSnapshotSet::CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), or [**IVssProviderCreateSnapshotSet::PostCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots) as applications are frozen during these calls.</span></span> <span data-ttu-id="fd61d-140">**Commitmomentaufnahmen** sollten innerhalb von Sekunden zurückgegeben werden, da diese während des Fensters "leeren" und "Speichern" aufgerufen werden und die VSS-Kernel Unterstützung den Löschvorgang abbricht und hält, wenn das Release nicht innerhalb von 10 Sekunden empfangen wird. Dies würde dazu führen, dass VSS den Vorgang zum Erstellen von Schatten Kopien</span><span class="sxs-lookup"><span data-stu-id="fd61d-140">**CommitSnapshots** should return within seconds, because this is called during the Flush and Hold window, and VSS Kernel Support will cancel the Flush and Hold if the release is not received within 10 seconds, which would cause VSS to fail the shadow copy creation process.</span></span> <span data-ttu-id="fd61d-141">Wenn der Anbieter mehr als einige Sekunden Zeit benötigt, um diesen Vorgang abzuschließen, besteht eine hohe Wahrscheinlichkeit, dass die Erstellung von Schatten Kopien fehlschlägt.</span><span class="sxs-lookup"><span data-stu-id="fd61d-141">If the provider takes more than a few seconds to complete this call, there is a high probability that the shadow copy creation will fail.</span></span>

## <a name="careful-io-during-commitsnapshots"></a><span data-ttu-id="fd61d-142">Sorgfältige e/a-Vorgänge während commitmomentaufnahmen</span><span class="sxs-lookup"><span data-stu-id="fd61d-142">Careful I/O During CommitSnapshots</span></span>

<span data-ttu-id="fd61d-143">Hardware Anbieter sollten keine e/a-Vorgänge für die Volumes ausführen müssen, die während der [**commitmomentaufnahmen**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots)an der Schatten Kopie beteiligt sind.</span><span class="sxs-lookup"><span data-stu-id="fd61d-143">Hardware providers should not need to do any I/O to the volumes involved in the shadow copy during [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots).</span></span> <span data-ttu-id="fd61d-144">Wenn e/a-Vorgänge erforderlich sind, dürfen Anbieter keine e/a-Vorgänge für ein ursprüngliches Volume initiieren, während die **commitshots** -Methode verarbeitet wird.</span><span class="sxs-lookup"><span data-stu-id="fd61d-144">If any I/O is required, providers must not initiate any I/O to an original volume while handling the **CommitSnapshots** method.</span></span>

<span data-ttu-id="fd61d-145">Während [**commitmomentaufnahmen**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots)blockieren VSS-Kernel-Unterstützungs Treiber e/a-Vorgänge für die ursprünglichen Volumes, die Schatten Kopien kopiert werden.</span><span class="sxs-lookup"><span data-stu-id="fd61d-145">During [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), VSS Kernel Support drivers block I/O to the original volumes that are being shadow copied.</span></span> <span data-ttu-id="fd61d-146">Wenn der Anbieter synchrone e/a-Vorgänge für ein Volume verwendet, das sich im Schattenkopiesatz befindet, wird der e/a-Vorgang blockiert, und der schattenkopiercommit-Prozess wird blockiert.</span><span class="sxs-lookup"><span data-stu-id="fd61d-146">If the provider uses synchronous I/O to a volume which is in the shadow copy set, then that I/O will be blocked and the shadow copy commit process will be deadlocked.</span></span> <span data-ttu-id="fd61d-147">Der Anbieter sollte während der **commitmomentaufnahmen** keine Win32-APIs aufzurufen, da diese eine hohe Wahrscheinlichkeit haben, dass e/a-Vorgänge und Deadlocks verursacht werden.</span><span class="sxs-lookup"><span data-stu-id="fd61d-147">The provider should not call any Win32 APIs during **CommitSnapshots** as they will have a high probability of causing I/O and a deadlock.</span></span> <span data-ttu-id="fd61d-148">Der Timeout Wert für die VSS-Kernel-Unterstützung unterbricht den Deadlock nach 10 Sekunden. Dies führt jedoch zu einem Fehler bei der Erstellung der Schatten Kopie.</span><span class="sxs-lookup"><span data-stu-id="fd61d-148">The VSS Kernel Support timeout will break this deadlock after 10 seconds, but this will cause the shadow copy creation to fail.</span></span>

<span data-ttu-id="fd61d-149">Wenn ein e/a-Vorgang versucht werden muss, muss Sie asynchron ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="fd61d-149">If I/O must be attempted, it must be performed asynchronously.</span></span> <span data-ttu-id="fd61d-150">Die e/a-Vorgänge werden erst ausgeführt, nachdem alle Anbieter von Ihren [**commitmomentaufnahmen**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots) -Methoden zurückgegeben haben.</span><span class="sxs-lookup"><span data-stu-id="fd61d-150">The I/O will not complete until after all providers have returned from their [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots) methods.</span></span> <span data-ttu-id="fd61d-151">Im Allgemeinen ist es besser, solche Vorgänge im [**postcommitshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots) -Befehl auszuführen.</span><span class="sxs-lookup"><span data-stu-id="fd61d-151">In general, it is better to perform such operations in the [**PostCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots) call.</span></span>

## <a name="readwrite-shadow-copy-luns"></a><span data-ttu-id="fd61d-152">Lese-/schreibschattenkopie-LUNs</span><span class="sxs-lookup"><span data-stu-id="fd61d-152">Read/Write Shadow Copy LUNs</span></span>

<span data-ttu-id="fd61d-153">In dieser Version unterstützt VSS nur Lese-/schreibschattenkopie-LUNs, auch wenn die Volumes schreibgeschützt sind.</span><span class="sxs-lookup"><span data-stu-id="fd61d-153">In this version, VSS supports only read/write shadow copy LUNs even if the volumes are exposed as read-only.</span></span> <span data-ttu-id="fd61d-154">Der Grund hierfür ist, dass das System die Datenstrukturen auf dem Datenträger ändern muss, z. b.:</span><span class="sxs-lookup"><span data-stu-id="fd61d-154">The reason is that the system needs to change on-disk data structures such as:</span></span>

-   <span data-ttu-id="fd61d-155">Datenträger Signatur, die während des schattenkopiervorgangs geändert wird</span><span class="sxs-lookup"><span data-stu-id="fd61d-155">Disk signature, which changes during the shadow copy process</span></span>
-   <span data-ttu-id="fd61d-156">Partitions bezogene Datenstrukturen, einschließlich derjenigen, die angeben, dass die Partition schreibgeschützt, ausgeblendet, eine Schatten Kopie ist und keinem Laufwerk Buchstaben zugewiesen werden soll.</span><span class="sxs-lookup"><span data-stu-id="fd61d-156">Partition-related data structures, including those indicating the partition is read-only, hidden, a shadow copy, and should not be assigned a drive letter.</span></span>

## <a name="unique-page-83-information"></a><span data-ttu-id="fd61d-157">Eindeutige Seite 83-Informationen</span><span class="sxs-lookup"><span data-stu-id="fd61d-157">Unique Page 83 Information</span></span>

<span data-ttu-id="fd61d-158">Sowohl die ursprüngliche LUN als auch die neu erstellte Schatten Kopie-LUN müssen mindestens einen eindeutigen Speicher Bezeichner in den Daten der Seite 83 aufweisen.</span><span class="sxs-lookup"><span data-stu-id="fd61d-158">Both the original LUN and the newly created shadow copy LUN must have at least one unique storage identifier in the page 83 data.</span></span> <span data-ttu-id="fd61d-159">Mindestens ein Speicher \_ Bezeichner mit einem Typ von 1, 2, 3 oder 8 und eine Zuordnung von 0 muss in der ursprünglichen LUN und der neu erstellten schattenkopielun eindeutig sein.</span><span class="sxs-lookup"><span data-stu-id="fd61d-159">At least one STORAGE\_IDENTIFIER with a type of 1, 2, 3, or 8, and an association of 0 must be unique on the original LUN and the newly created shadow copy LUN.</span></span>

 

 



