---
description: Aufgaben vor der Sicherung unter VSS sind darauf ausgerichtet, eine Schatten Kopie der Volumes zu erstellen, die Daten für die Sicherung enthalten.
ms.assetid: e6b082af-719b-4426-8217-0fc940f5884d
title: Übersicht über Aufgaben vor der Sicherung
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 709345b8aa0421699efe26ad2901cc497b7d4ac0
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "106349785"
---
# <a name="overview-of-pre-backup-tasks"></a>Übersicht über Aufgaben vor der Sicherung

Aufgaben vor der Sicherung unter VSS sind darauf ausgerichtet, eine Schatten Kopie der Volumes zu erstellen, die Daten für die Sicherung enthalten. Die Sicherungsanwendung speichert Daten aus der Schattenkopie, nicht aus dem zugrunde liegenden Volume. Weitere Informationen finden Sie [unter Übersicht über die Verarbeitung einer Sicherung unter VSS](overview-of-processing-a-backup-under-vss.md).

Anforderer wartet in der Regel darauf, dass Writer die Sicherung vorbereiten und die Schatten Kopie erstellen. Der Writer muss feststellen, ob er an der Sicherung teilnehmen soll. wenn dies der Fall ist, muss er seine Dateien konfigurieren und sich selbst für die Sicherung und Schatten Kopie entscheiden. In der folgenden Tabelle wird die Abfolge der Aktionen und Ereignisse angezeigt, die für die Vorbereitung eines Sicherungs Vorgangs erforderlich sind.



| Requestaktion                                                                                                                                                                                                                                                                                                            | Ereignis                                                                      | Writer-Aktion                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Der Anforderer kann Sicherungs Optionen festlegen (siehe [**IVssBackupComponents:: setbackupoptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupoptions)).                                                                                                                                                                                          | Keine                                                                       | Keine                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Unterstützung von inkrementellen und differenziellen Sicherungs Vorgängen durch untersuchen gespeicherter Sicherungs Stempel (siehe [**IVssComponent:: getbackupstamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupstamp), [**IVssBackupComponents:: setpreviousbackupstamp**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp))                                               | Keine                                                                       | Keine                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Benachrichtigen von Writern, dass ein Sicherungs Vorgang mithilfe von [ **IVssBackupComponents vorbereitet wird::P Analyse forbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup)                                                                                                                                                                              | [*PrepareForBackup*](vssgloss-p.md)  | Die Writer-Vorbereitung umfasst das bestimmen, ob Dateien gesichert werden sollen, ob der Writer am schattenkopiereinfrieren beteiligt ist, sowie das Erstellen von Writer-spezifischen Metadaten (siehe [**CVssWriter:: onpreparebackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup), [**CVssWriter:: ispathbetroff,**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected) [**ivssschreitercomponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent), [**IVssComponent:: getbackupoptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupoptions), [**CVssWriter:: arecomponentsswählten**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-arecomponentsselected), [**IVssComponent:: setbackupmetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata)und [**IVssComponent:: getpreviousbackupstamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp). |
| Der Anforderer wartet darauf, dass Writer mithilfe von [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync)für die Sicherung eingerichtet werden. Außerdem sollte der Writer-Status überprüft werden (siehe [**IVssBackupComponents:: gatherschreiterstatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents:: getschreiterstatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)).     | Keine                                                                       | Keine                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Der Anforderer fordert mithilfe von [ **IVssBackupComponents eine Schatten Kopie an::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset)                                                                                                                                                                                                    | Keine                                                                       | Keine                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Keine                                                                                                                                                                                                                                                                                                                        | [*Prepareforsnapshot*](vssgloss-p.md) | [**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot): versetzen Sie den Writer in den Zustand "Schatten Kopie bereit".<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Keine                                                                                                                                                                                                                                                                                                                        | [*Einfrieren*](vssgloss-f.md)                      | [**CVssWriter:: OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze): endgültige Einrichtung vor der Schatten Kopie.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Keine                                                                                                                                                                                                                                                                                                                        | [*Reaktivieren*](vssgloss-t.md)                          | [**CVssWriter:: OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw): normale Funktionsweise (einschließlich e/a) kann fortgesetzt werden.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Keine                                                                                                                                                                                                                                                                                                                        | [*PostSnapshot*](vssgloss-p.md)          | [**CVssWriter:: OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot): endgültige Bereinigungen der schattenkopievorbereitung. Weitere Informationen finden Sie unter [**IVssComponent:: AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) und [**IVssComponent:: setbackupstamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp).<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Der Anforderer wartet auf den Abschluss der Schatten Kopie mithilfe von: [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync). Außerdem sollte er den Writer-Status überprüfen (siehe [**IVssBackupComponents:: gatherschreiterstatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents:: getschreiterstatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) ).<br/> | Keine                                                                       | Keine                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |



 

## <a name="requester-pre-backup-tasks"></a>Aufgaben vor der Sicherungs Anforderung

Außerdem kann ein Anforderer vor dem Erstellen eines [**IVssBackupComponents::P Analyse forbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) -Ereignisses auch Sicherungs Optionen für einzelne Writer mithilfe von [**IVssBackupComponents:: setbackupoptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupoptions) festlegen. Dies hängt von den Besonderheiten der einzelnen Writer und davon ab, ob ein Anforderer diese kennt.

Zur Unterstützung von inkrementellen und differenziellen Vorgängen können sich anfordernde Personen zu diesem Zeitpunkt entscheiden, Komponenten für Zeitstempel eines früheren Sicherungs Vorgangs (mit [**IVssComponent:: getbackupstamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupstamp)) zu überprüfen und mithilfe dieser Informationen einen vorherigen Zeitstempel für die Verarbeitung durch einen Writer festzulegen (mit [**IVssBackupComponents:: setpreviousbackupstamp**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp)). Weitere Informationen finden Sie unter [inkrementelle und differenzielle Sicherungen](incremental-and-differential-backups.md) .

Ein Anforderer kann jetzt die Writer des Systems anweisen, die Vorbereitung vor der Sicherung abzuschließen und die Erstellung einer Schatten Kopie zu verarbeiten.

Zuerst generiert der Anforderer ein [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) -Ereignis, indem [**IVssBackupComponents::P Analyse forbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup)aufgerufen wird.

Nachdem alle Beteiligten Writer die Verarbeitung des [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) -Ereignisses (das ein Anforderer mithilfe der Instanz der von **PrepareForBackup** zurückgegebenen Schnittstelle " [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync) " bestimmt) zurückgegeben hat, der Anforderer kann die Schatten Kopie durch Aufrufen von [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset)initiieren, die im Laufe des Vorgangs [*prepareforsnapshot*](vssgloss-p.md)-, [*Freeze*](vssgloss-f.md)-, [*Thaw*](vssgloss-t.md)-und [*PostSnapshot*](vssgloss-p.md) -Ereignisse für die zu behandelnden Writer generiert.

In einigen Fällen muss ein Anforderer möglicherweise keine Schatten Kopie erstellen. Insbesondere verfügt jeder durch eine der-Komponenten eines bestimmten Writers verwaltete [*Datei Satz*](vssgloss-f.md) über eine Sicherungs Maske der Datei Spezifikation (angegeben durch eine bitweise OR- [**VSS \_ - \_ \_ \_ Sicherungstyp**](/windows/desktop/api/Vss/ne-vss-vss_file_spec_backup_type) Werte), die während des [*Identifizierungs*](vssgloss-i.md) Ereignisses festgelegt werden. Diese Maske gibt unter anderem an, ob für einen Datei Satz vor der Sicherung eine Schatten Kopie des Systems erforderlich ist.

Wenn keine auf Volumes zu sichernden Dateigruppen eine Schatten Kopie erfordern, muss [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) nicht aufgerufen werden.

## <a name="writer-pre-backup-tasks"></a>Task für Schreibvorgänge vor der Sicherung

Wenn das [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) -Ereignis verarbeitet wird, ruft VSS die [**CVssWriter:: onpreparebackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) -Methode jedes Writers auf, eine virtuelle Methode, die standardmäßig einfach "true" zurückgibt.

Writer können diese Standard Implementierung überschreiben und mithilfe der Behandlung nach Informationen über die anstehende Sicherung suchen und Maßnahmen ergreifen.

Ein Writer kann Informationen zur Art des Sicherungs Vorgangs ermitteln, die mit den folgenden Methoden in Erwägung gezogen werden:

1.  [**CVssWriter:: getbackuptype**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getbackuptype)
2.  [**CVssWriter:: isbootablestatebackedup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-isbootablesystemstatebackedup)
3.  [**CVssWriter:: arecomponentssgewählt**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-arecomponentsselected)

Ein Writer bestimmt, ob die von ihm verwalteten Dateien mithilfe von [**CVssWriter:: ispathbetroffin**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected)die Schatten Kopie einbezogen werden.

Wichtiger ist Folgendes: wenn VSS die [**CVssWriter:: onpreparebackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) -Methode aufruft, wird eine Instanz der [**ivssschreitercomponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) -Schnittstelle übergeben, die den direkten Zugriff über die [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) -Schnittstelle auf die Komponenten ermöglicht, die explizit im Dokument mit den Sicherungs Komponenten des Anforderers [*enthalten*](vssgloss-e.md) sind. Der Writer hat die Instanzen der **IVssComponent** -Schnittstelle verwendet, die Komponenten Sätze definieren, um Zugriff auf die *implizit enthaltene* Komponente zu erhalten (siehe [selectlichkeit und arbeiten mit Komponenteneigenschaften](selectability-and-working-with-component-properties.md)).

Während der Behandlung des [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) -Ereignisses verwenden Writer die [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) -Schnittstelle zum Ausführen von Komponenten-zu-Komponente-Vorgängen (oder Komponenten, die von Komponenten festgelegt wurden), einschließlich:

1.  Durch Aufrufen von [**IVssComponent:: addpartialfile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile)werden [*partielle Dateien*](vssgloss-p.md) (falls unterstützt) hinzugefügt.
2.  Festlegen privater Metadaten, die der Writer benötigt, um die Wiederherstellung zu verarbeiten.
3.  , Wenn der Writer inkrementelle und differenzielle Sicherungen unterstützt (siehe [inkrementelle und differenzielle Sicherungen](incremental-and-differential-backups.md))
    -   Es wird auf vorherige Sicherungs Zeitstempel durch Aufrufen von [**IVssComponent:: getpreviousbackupstamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp)geprüft.
    -   Hinzufügen Erforderlicher [*differenzierter Dateien*](vssgloss-d.md) durch Aufrufen von [**IVssComponent:: AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime).
    -   Wenn der Writer das Schema für den **VSS- \_ SB \_** -Zeitstempel unterstützt, werden Sicherungs Zeitstempel-Zeichen folgen im eigenen Format des Writers mithilfe von [**IVssComponent:: setbackupstamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp)hinzugefügt.
4.  Initiieren sehr zeitaufwändiger asynchroner Vorgänge, z. b. das Synchronisieren von Daten auf mehreren Datenträgern. Dadurch kann der Writer weiterhin arbeiten, während der Vorgang verarbeitet wird, einschließlich der Verarbeitung anderer VSS-Ereignisse. Diese Vorgänge müssen vor dem [*Freeze*](vssgloss-f.md) -Ereignis beendet werden.

Der Anforderer von [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) initiiert die Schatten Kopie und generiert die folgenden Ereignisse, die von den Writern behandelt werden sollen:

-   [*Prepareforsnapshot*](vssgloss-p.md)
-   [*Einfrieren*](vssgloss-f.md)
-   [*Reaktivieren*](vssgloss-t.md)
-   [*PostSnapshot*](vssgloss-p.md)

Drei der Handlers des Writers –[**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot), [**CVssWriter:: OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze)und [**CVssWriter:: OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)– sind reine virtuelle Methoden, und jeder Writer muss Sie implementieren, anstatt auf Standardwerte zu vertrauen. Abhängig von den Anforderungen eines Writers können Sie als dummymethoden codiert werden, wobei einfach " **true**" zurückgegeben wird.

Da es in der Regel ein enges Zeitfenster zwischen dem Ausgeben eines [*Freeze*](vssgloss-f.md) -Ereignisses und dem Ausgeben eines [*Thaw*](vssgloss-t.md) -Ereignisses gibt, werden die meisten Hauptaufgaben beim Vorbereiten der Schatten Kopie – beispielsweise das Herunterfahren von Prozessen, das Erstellen temporärer Dateien oder das Leeren von e/a-Warteschlangen – in [**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot)behandelt.

Die Art und Weise, in der ein Writer [**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) verwendet, um die e/a-Vorgänge zu verarbeiten, bevor die Erstellung einer Schatten Kopie stark von der eigenen Architektur des Writers abhängig ist.

Writer, die alle Schreibvorgänge speichern und die Daten vor dem [*Einfrieren*](vssgloss-f.md)in einem absoluten konsistenten Zustand belassen können, sollten dies tun.

Wenn der Writer seine e/a nicht fixieren kann, sollte er Maßnahmen ergreifen, um eine stabile Quelle für die Sicherung zu erstellen und die Wiederherstellungszeit für eine Schatten Kopie zu verringern. Beispiele hierfür sind u. a. Warteschlangen für eingehende e/a-Anforderungen oder das Erstellen eines doppelten Satzes von Dateien in einem [*alternativen Pfad*](vssgloss-a.md) , der als Quelle für eine Sicherung verwendet werden soll.

Die [**CVssWriter:: OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) -Methode führt einfache, kurze Aufgaben aus, z. b. zu überprüfen, ob [**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) den e/a-Vorgang im richtigen Zustand aufließ und alle asynchronen Tasks, die von [**CVssWriter:: onpreparebackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) gestartet wurden, abgeschlossen wurden. Diese Methode ist die letzte Chance eines Writers, ein Veto gegen eine Schatten Kopie zu überprüfen (siehe [Writer-Fehler und-Vetos](writer-errors-and-vetoes.md)).

Es ist in der Regel möglich, dass ein Writer nach einem [*Thaw*](vssgloss-t.md) -Ereignis den normalen Betrieb wieder aufnimmt: eine Schatten Kopie ist möglicherweise nicht sofort nach dem Thaw für die Sicherung bereit, aber ein Writer sollte in der Lage sein, den normalen Betrieb wieder aufzunehmen. Daher wird in der Regel [**CVssWriter:: OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw) von Writern verwendet, um zu einem Zustand vor dem Einfrieren zurückzukehren. Allerdings sollten temporäre Dateien, die zur Unterstützung der Schatten Kopie erstellt wurden, bis zum [*PostSnapshot*](vssgloss-p.md) -Ereignis bestehen bleiben. In der Regel verwenden Sie [**CVssWriter:: OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) für diese Art von Cleanup. Da viele Anwendungen diese Art der Bereinigung nicht benötigen, ist **CVssWriter:: OnPostSnapshot** eine virtuelle Methode mit einer Standard Implementierung, die einfach " **true**" zurückgibt. Wenn eine inkrementelle oder differenzielle Sicherung ausgeführt wird, kann der Writer [**IVssComponent:: getpreviousbackupstamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp) und [**IVssComponent:: setbackupstamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp)aufrufen. Weitere Informationen finden Sie unter [Writer-Rolle beim Sichern komplexer Stores](writer-role-in-backing-up-complex-stores.md). Eine andere Methode, die zu diesem Zeitpunkt aufgerufen werden kann, ist [**IVssComponent:: AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime).

 

 




