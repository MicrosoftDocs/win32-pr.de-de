---
description: Aufgaben vor der Sicherung unter VSS konzentrieren sich auf das Erstellen einer Schattenkopie der Volumes, die Daten für die Sicherung enthalten.
ms.assetid: e6b082af-719b-4426-8217-0fc940f5884d
title: Übersicht über Aufgaben vor der Sicherung
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: af8dd6ea99215d486b8be7d07d30bcbdb5258548078fd642028dd6a93ca42796
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/11/2021
ms.locfileid: "119511740"
---
# <a name="overview-of-pre-backup-tasks"></a>Übersicht über Aufgaben vor der Sicherung

Aufgaben vor der Sicherung unter VSS konzentrieren sich auf das Erstellen einer Schattenkopie der Volumes, die Daten für die Sicherung enthalten. Die Sicherungsanwendung speichert Daten aus der Schattenkopie, nicht aus dem zugrunde liegenden Volume. Weitere Informationen finden Sie unter [Übersicht über die Verarbeitung einer Sicherung unter VSS.](overview-of-processing-a-backup-under-vss.md)

Anforderungsersteller warten in der Regel darauf, dass Writer die Sicherung vorbereiten und die Schattenkopie erstellen. Der Writer muss bestimmen, ob er an der Sicherung teilnehmen soll, und, falls dies der Ist, seine Dateien und sich selbst so konfigurieren, dass er für die Sicherung und Schattenkopie bereit ist. Die folgende Tabelle zeigt die Abfolge der Aktionen und Ereignisse, die zur Vorbereitung auf einen Sicherungsvorgang erforderlich sind.



| Aktion des Anfordernden                                                                                                                                                                                                                                                                                                            | Ereignis                                                                      | Writer-Aktion                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Der Anfordernde kann Sicherungsoptionen festlegen (siehe [**IVssBackupComponents::SetBackupOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupoptions)).                                                                                                                                                                                          | Keine                                                                       | Keine                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Unterstützung von inkrementellen und differenziellen Sicherungsvorgängen durch Untersuchen gespeicherter Sicherungsstempel (siehe [**IVssComponent::GetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupstamp), [**IVssBackupComponents::SetPreviousBackupStamp**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp))                                               | Keine                                                                       | Keine                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Benachrichtigen von Writern zur Vorbereitung auf einen [ **Sicherungsvorgang mithilfe von IVssBackupComponents::P repareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup)                                                                                                                                                                              | [*PrepareForBackup*](vssgloss-p.md)  | Writer-Vorbereitungen umfassen die Bestimmung, ob Dateien zu sichern sind, ob der Writer am Einfrieren der Schattenkopie beteiligt ist. sowie das Erstellen writerspezifischer Metadaten (siehe [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup), [**CVssWriter::IsPathAffected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected), [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent), [**IVssComponenent::GetBackupOptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupoptions), [**CVssWriter::AreComponentsSelected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-arecomponentsselected), [**IVssComponent::SetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata)und [**IVssComponent::GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp). |
| Der Anfordernde wartet darauf, dass Writer die Sicherung mithilfe von [**IVssAsync einrichten.**](/windows/desktop/api/Vss/nn-vss-ivssasync) Außerdem sollte der Writerstatus überprüft werden (siehe [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)).     | Keine                                                                       | Keine                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Anfordernde Anforderung einer Schattenkopie mithilfe von [ **IVssBackupComponents::D oSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset)                                                                                                                                                                                                    | Keine                                                                       | Keine                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Keine                                                                                                                                                                                                                                                                                                                        | [*PrepareForSnapshot*](vssgloss-p.md) | [**CVssWriter::OnPrepareSnapshot:**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot)Setzt den Writer in einen Schattenkopiezustand.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Keine                                                                                                                                                                                                                                                                                                                        | [*Freeze*](vssgloss-f.md)                      | [**CVssWriter::OnFreeze:**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze)Endgültige Einrichtung vor der Schattenkopie.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Keine                                                                                                                                                                                                                                                                                                                        | [*Tauwetter*](vssgloss-t.md)                          | [**CVssWriter::OnThaw:**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)Normale Funktionsweise (einschließlich E/A) kann fortgesetzt werden.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Keine                                                                                                                                                                                                                                                                                                                        | [*PostSnapshot*](vssgloss-p.md)          | [**CVssWriter::OnPostSnapshot:**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)Endgültige Bereinigung der Vorbereitungen für Schattenkopien. Siehe [**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) und [**IVssComponent::SetBackupStamp.**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp)<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Der Anfordernde wartet auf den Abschluss der Schattenkopie mit: [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync), er sollte auch den Writerstatus überprüfen (siehe [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)<br/> | Keine                                                                       | Keine                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |



 

## <a name="requester-pre-backup-tasks"></a>Aufgaben vor der Sicherung des Anfordernden

Darüber hinaus kann ein An anfordernder Benutzer vor dem Erstellen eines [**IVssBackupComponents::P repareForBackup-Ereignisses**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) auch Sicherungsoptionen für einzelne Writer festlegen, die [**IVssBackupComponents::SetBackupOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupoptions) verwenden. Dies hängt von den Besonderheiten der einzelnen Writer ab und davon, ob sie von einem Anfordernden bekannt sind.

Um inkrementelle und differenzielle Vorgänge zu unterstützen, können an diesem Punkt Anfordernde komponenten auf Zeitstempel früherer Sicherungsvorgänge überprüfen (mithilfe von [**IVssComponent::GetBackupStamp)**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupstamp)und diese Informationen verwenden, um einen vorherigen Zeitstempel für die Verarbeitung durch einen Writer (mithilfe von [**IVssBackupComponents::SetPreviousBackupStamp)**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp)fest zu legen. Weitere Informationen finden Sie unter [Inkrementelle](incremental-and-differential-backups.md) und differenzielle Sicherungen.

Ein An anfordernde Benutzer kann die Writer des Systems nun an die Durchführung von Vorbereitungen vor der Sicherung und die Erstellung einer Schattenkopie an sie weiter richten.

Zunächst generiert der Anfordernde ein [**PrepareForBackup-Ereignis,**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) indem er [**IVssBackupComponents::P repareForBackup aufruft.**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup)

Nachdem alle beteiligten Writer von der Behandlung des [**PrepareForBackup-Ereignisses**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) (das ein An anfordernder mithilfe der Instanz der [**IVssAsync-Schnittstelle**](/windows/desktop/api/Vss/nn-vss-ivssasync) bestimmt, die von **PrepareForBackup** zurückgegeben wird) zurückgegeben haben, kann der An anfordernde Benutzer die Schattenkopie initiieren, indem er [**IVssBackupComponents::D oSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset)aufruft, wodurch während der Bearbeitung [*PrepareForSnapshot-,*](vssgloss-p.md) [*Freeze-,*](vssgloss-f.md) [*Thaw-*](vssgloss-t.md)und [*PostSnapshot-Ereignisse*](vssgloss-p.md) für die Writer generiert werden.

Es gibt einige Fälle, in denen ein Anfordernde möglicherweise keine Schattenkopie erstellen muss. Jeder Dateisatz, der von einer der Komponenten eines bestimmten Writers verwaltet wird, verfügt über eine Dateispezifikations-Sicherungsmaske (angegeben durch ein bitweises OR von [**VSS \_ FILE SPEC BACKUP \_ \_ \_ TYPE-Werten),**](/windows/desktop/api/Vss/ne-vss-vss_file_spec_backup_type) das während des [*Identify-Ereignisses*](vssgloss-i.md) festgelegt wird. [](vssgloss-f.md) Diese Maske gibt u. a. an, ob ein Dateisatz erfordert, dass das System vor der Sicherung schattenkopiert wird.

Wenn keine Zu sichernden Dateisätze auf Volumes eine Schattenkopie erfordern, muss [**IVssBackupComponents::D oSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) nicht aufgerufen werden.

## <a name="writer-pre-backup-tasks"></a>Aufgaben vor der Writer-Sicherung

Beim Behandeln [**des PrepareForBackup-Ereignisses**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) wird von VSS die [**CVssWriter::OnPrepareBackup-Methode**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) jedes Writers, eine virtuelle Methode, die standardmäßig einfach TRUE zurückgibt, aufrufen.

Writer können diese Standardimplementierung überschreiben und die Behandlung verwenden, um Informationen zur bevorstehenden Sicherung zu finden und Maßnahmen zu ergreifen.

Ein Writer kann Mithilfe der folgenden Methoden Informationen zur Art des Sicherungsvorgang ermitteln:

1.  [**CVssWriter::GetBackupType**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getbackuptype)
2.  [**CVssWriter::IsBootableStateBackedUp**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-isbootablesystemstatebackedup)
3.  [**CVssWriter::AreComponentsSelected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-arecomponentsselected)

Ein Writer bestimmt mithilfe von [**CVssWriter::IsPathAffected,**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected)ob die von ihm verwalteten Dateien an der Schattenkopie beteiligt sind.

Wichtiger noch: Wenn VSS die [**CVssWriter::OnPrepareBackup-Methode**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) aufruft, übergibt es eine Instanz der [**IVssWriterComponents-Schnittstelle,**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) die den direkten Zugriff über die [**IVssComponent-Schnittstelle**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) auf die Komponenten der Komponenten ermöglicht, die explizit [*im*](vssgloss-e.md) Sicherungskomponentendokument des Anfordernden enthalten sind. Der Writer verwendete die Instanzen der **IVssComponent-Schnittstelle,** die  Komponentensätze definieren, um Zugriff auf die implizit eingeschlossene Komponente zu erhalten (siehe Auswählbarkeit und Arbeiten mit [Komponenteneigenschaften](selectability-and-working-with-component-properties.md)).

Während der Behandlung des [**PrepareForBackup-Ereignisses**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) verwenden Writer die [**IVssComponent-Schnittstelle,**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) um Komponentenvorgänge (oder Komponenten, die durch Komponentensatz festgelegt sind) durchzuführen, einschließlich:

1.  Hinzufügen [*von Teildateien*](vssgloss-p.md) (sofern unterstützt) durch Aufrufen von [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile).
2.  Festlegen von privaten Metadaten, die der Writer für die Wiederherstellung benötigt.
3.  Wenn der Writer inkrementelle und differenzielle Sicherungen unterstützt (siehe [Inkrementelle und differenzielle Sicherungen),](incremental-and-differential-backups.md)führen Sie folgende Schritte aus:
    -   Überprüfung auf vorherige Sicherungszeitstempel durch Aufrufen von [**IVssComponent::GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).
    -   Fügen Sie alle erforderlichen [*differenzierten Dateien hinzu,*](vssgloss-d.md) indem [**Sie IVssComponent::AddDifferencedFilesByLastModifyTime aufrufen.**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime)
    -   Wenn der Writer das **VSS \_ BS \_ TIMESTAMPED-Schema** unterstützt, fügen Sie Sicherungs-Zeitstempelzeichenfolgen im eigenen Format des [**Writers mithilfe von IVssComponent::SetBackupStamp hinzu.**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp)
4.  Initiieren sehr zeitaufwändiger asynchroner Vorgänge, z. B. synchronisieren von Daten über mehrere Datenträger hinweg. Dadurch kann der Writer weiterhin arbeiten, während der Vorgang verarbeitet wird, einschließlich der Behandlung anderer VSS-Ereignisse. Diese Vorgänge müssen vor dem [*Freeze-Ereignis beendet*](vssgloss-f.md) werden.

Der Aufruf von [**IVssBackupComponents::D oSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) initiiert die Schattenkopie und generiert die folgenden Ereignisse für die Writer:

-   [*PrepareForSnapshot*](vssgloss-p.md)
-   [*Freeze*](vssgloss-f.md)
-   [*Tauwetter*](vssgloss-t.md)
-   [*PostSnapshot*](vssgloss-p.md)

Drei der Handler des Writers –[**CVssWriter::OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot), [**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze)und [**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)– sind reine virtuelle Methoden, und jeder Writer muss sie implementieren, anstatt sich auf Standardwerte zu verlassen. Abhängig von den Anforderungen eines Writers können sie als Dummymethoden codiert werden und geben einfach **TRUE zurück.**

Da es in der Regel ein schmales [](vssgloss-f.md) Zeitfenster zwischen dem Ausstellen eines Freeze-Ereignisses und dem Ausstellen eines [*Thaw-Ereignisses*](vssgloss-t.md) gibt, werden die meisten wichtigen Vorbereitungen für die Schattenkopie – z. B. das Herunterfahren von Prozessen, das Erstellen temporärer Dateien oder das Leeren von E/A-Warteschlangen – in [**CVssWriter::OnPrepareSnapshot behandelt.**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot)

Wie ein Writer [**CVssWriter::OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) verwenden kann, um seine E/A vor der Erstellung einer Schattenkopie zu verarbeiten, hängt stark von der architekturabhängigen Architektur des Writers ab.

Writer, die es sich leisten können, alle Schreibvorgänge zu halten und die Daten vor dem Einfrieren in einem absolut konsistenten Zustand zu [*halten,*](vssgloss-f.md)sollten dies tun.

Wenn der Writer seine E/A nicht einfrieren kann, sollte er Maßnahmen ergreifen, um eine stabile Quelle für die Sicherung zu erstellen und die Wiederherstellungszeit für eine Schattenkopie zu reduzieren. Beispiele hierfür sind das Einwarteschlangen eingehender E/A-Anforderungen oder das [](vssgloss-a.md) Generieren eines doppelten Satz von Dateien in einem alternativen Pfad, der als Quelle einer Sicherung verwendet werden soll.

Die [**CVssWriter::OnFreeze-Methode**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) führt einfache, kurze Aufgaben aus, z. B. die Überprüfung, ob der [**CVssWriter::OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) die E/A im richtigen Zustand verlassen hat und ob alle asynchronen Aufgaben, die von [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) gestartet wurden, abgeschlossen wurden. Diese Methode ist die letzte Chance eines Schreibers, eine Schattenkopie zu erstellen, wenn Probleme auftreten (siehe [Writer Errors and Shadowes](writer-errors-and-vetoes.md)).

Im Allgemeinen kann ein Writer den normalen Betrieb nach einem [*Thaw-Ereignis*](vssgloss-t.md) fortsetzen: Eine Schattenkopie ist nach dem Thaw möglicherweise nicht sofort für die Sicherung bereit, aber ein Writer sollte in der Lage sein, den normalen Betrieb wieder aufzunehmen. Daher wird [**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw) in der Regel von Writern verwendet, um in einen Zustand vor dem Einfrieren zurückzukehren. Alle temporären Dateien, die zur Unterstützung der Schattenkopie erstellt wurden, sollten jedoch bis zum [*PostSnapshot-Ereignis erhalten*](vssgloss-p.md) bleiben. In der Regel verwenden Sie [**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) für diese Art von Bereinigung. Da viele Anwendungen diese Art von Bereinigung nicht erfordern, ist **CVssWriter::OnPostSnapshot** eine virtuelle Methode mit einer Standardimplementierung, die einfach **TRUE zurückgibt.** Wenn eine inkrementelle oder differenzielle Sicherung ausgeführt wird, kann der Writer [**IVssComponent::GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp) und [**IVssComponent::SetBackupStamp aufrufen.**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp) Weitere Informationen finden Sie unter [Writer-Rolle beim Sichern komplexer Speicher.](writer-role-in-backing-up-complex-stores.md) Eine weitere Methode, die zu diesem Zeitpunkt aufgerufen werden kann, ist [**IVssComponent::AddDifferencedFilesByLastModifyTime.**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime)

 

 




