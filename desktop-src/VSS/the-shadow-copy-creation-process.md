---
description: Der Erstellungs Vorgang für Schatten Kopien
ms.assetid: ca484eec-31c6-4790-9232-3ed67263f6fb
title: Der Erstellungs Vorgang für Schatten Kopien
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4239e2b671edcaeb35b404d9b9411b43316c0212
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "103751600"
---
# <a name="the-shadow-copy-creation-process"></a><span data-ttu-id="2df73-103">Der Erstellungs Vorgang für Schatten Kopien</span><span class="sxs-lookup"><span data-stu-id="2df73-103">The Shadow Copy Creation Process</span></span>

<span data-ttu-id="2df73-104">Im folgenden finden Sie eine ausführliche Beschreibung der Rolle des Hardware Anbieters bei der Erstellung eines schattenkopiesatzes.</span><span class="sxs-lookup"><span data-stu-id="2df73-104">The following is a detailed description of the hardware provider's role in the creation of a shadow copy set.</span></span> <span data-ttu-id="2df73-105">Ein Diagramm dieses Prozesses finden Sie unter [Erstellen von Schatten Kopien für Anbieter](shadow-copy-creation-for-providers.md).</span><span class="sxs-lookup"><span data-stu-id="2df73-105">For a diagram of this process, see [Shadow Copy Creation for Providers](shadow-copy-creation-for-providers.md).</span></span>

1.  <span data-ttu-id="2df73-106">Wenn die anfordernde Person jedes Volume dem Schattenkopiesatz hinzufügt, bestimmt VSS die zugeordneten LUNs.</span><span class="sxs-lookup"><span data-stu-id="2df73-106">As the requester adds each volume to the shadow copy set, VSS determines the associated LUNs.</span></span> <span data-ttu-id="2df73-107">Ein übergreifendes Volume könnte beispielsweise aus mehreren LUNs bestehen.</span><span class="sxs-lookup"><span data-stu-id="2df73-107">For example, a spanned volume could be composed of multiple LUNs.</span></span> <span data-ttu-id="2df73-108">VSS erstellt mithilfe physischer Geräteinformationen für jede LUN eine anfängliche [**VDS- \_ LUN- \_ Information**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) .</span><span class="sxs-lookup"><span data-stu-id="2df73-108">VSS creates an initial [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) using physical device information for each LUN.</span></span>
2.  <span data-ttu-id="2df73-109">VSS ruft [**arelunssupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported) auf, um zu bestimmen, ob der Anbieter eine Schatten Kopie für diese LUN unterstützt.</span><span class="sxs-lookup"><span data-stu-id="2df73-109">VSS calls [**AreLunsSupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported) to determine if the provider supports a shadow copy for that LUN.</span></span> <span data-ttu-id="2df73-110">Der Hardware Anbieter verwendet die [**VDS- \_ LUN- \_ Informationen**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) , um zu bestimmen, ob die LUNs unterstützt werden.</span><span class="sxs-lookup"><span data-stu-id="2df73-110">The hardware provider uses the [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) to determine whether the LUNs are supported.</span></span> <span data-ttu-id="2df73-111">Diese Bestimmung muss alle oder nichts sein – derselbe Hardware Anbieter muss alle LUNs unterstützen, die zu einem bestimmten Volume beitragen.</span><span class="sxs-lookup"><span data-stu-id="2df73-111">This determination must be all or nothing—the same hardware provider must support all LUNs contributing to a specific volume.</span></span> <span data-ttu-id="2df73-112">Im Beispiel mit einem übergreifenden Volume kann der Anbieter nicht angeben, dass er nur eine der LUNs unterstützt, aus denen das Volume besteht.</span><span class="sxs-lookup"><span data-stu-id="2df73-112">In the spanned volume example, the provider cannot indicate that it supports only one of the LUNs that comprise the volume.</span></span>
3.  <span data-ttu-id="2df73-113">Für jedes Volume im Schattenkopiesatz ruft VSS [**ivsshardwaresnapshotprovider:: beginpreparesnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-beginpreparesnapshot) mit dem gleichen Array von [**VDS- \_ LUN- \_ Informations**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) Strukturen auf.</span><span class="sxs-lookup"><span data-stu-id="2df73-113">For each volume in the shadow copy set, VSS calls [**IVssHardwareSnapshotProvider::BeginPrepareSnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-beginpreparesnapshot) with the same array of [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures.</span></span> <span data-ttu-id="2df73-114">In einem einzelnen Aufruf sind alle LUNs im Array eindeutig, aber die gleiche LUN kann in einem nachfolgenden Aufruf vorkommen, wenn die gleiche LUN zu mehreren Volumes beiträgt.</span><span class="sxs-lookup"><span data-stu-id="2df73-114">Within a single call, all LUNs in the array are unique, but the same LUN may appear in a subsequent call whenever the same LUN contributes to multiple volumes.</span></span> <span data-ttu-id="2df73-115">Der Anbieter muss diesen Fall ordnungsgemäß behandeln.</span><span class="sxs-lookup"><span data-stu-id="2df73-115">The provider must handle that case correctly.</span></span>
4.  <span data-ttu-id="2df73-116">Unmittelbar nach [**ivssproviderkreatesnapshotset:: EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots)legt VSS den schreibgeschützten, versteckten, nicht Laufwerksbuchstaben und schattenkopieflags für alle betroffenen LUNs fest.</span><span class="sxs-lookup"><span data-stu-id="2df73-116">Immediately after [**IVssProviderCreateSnapshotSet::EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots), VSS will set the read-only, hidden, no drive letter, and shadow copy flags on all affected LUNs.</span></span> <span data-ttu-id="2df73-117">Die Flags werden mithilfe von ausgeblendeten Sektoren auf MBR-Datenträgern oder betriebssystemspezifischen Bits im Partitions Header Eintrag auf GPT-Datenträgern implementiert.</span><span class="sxs-lookup"><span data-stu-id="2df73-117">The flags are implemented using hidden sectors on MBR disks or operating-system-specific bits in the partition header entry on GPT disks.</span></span> <span data-ttu-id="2df73-118">Die Flags bewirken, dass alle Volumes auf den betroffenen Datenträgern auf den empfangenden Computern als schreibgeschützt und ausgeblendet angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="2df73-118">The flags will cause all volumes on the affected disks to be surfaced on the receiving machines as read-only and hidden.</span></span> <span data-ttu-id="2df73-119">Beachten Sie, dass für die schattenkopierten LUNs in dieser Phase kein Commit ausgeführt wurde, sodass im Falle eines Systemabsturzes die Flags gelöscht werden und die ursprüngliche LUN nicht beeinträchtigt wird.</span><span class="sxs-lookup"><span data-stu-id="2df73-119">Note that the shadow-copied LUNs have not been committed at this stage, so that in the event of a system crash, the flags will be cleared and the original LUN will not be affected.</span></span> <span data-ttu-id="2df73-120">Das heißt, alle Volumes auf der ursprünglichen LUN werden als normal behandelt – und behalten ihre ursprünglichen Laufwerk Buchstaben Zuweisungen, eingebundenen Ordner und Lese-/Schreibstatus bei.</span><span class="sxs-lookup"><span data-stu-id="2df73-120">That is, all volumes on the original LUN will be treated as normal—and keep their original drive-letter assignments, mounted folders, and read/write status.</span></span>
    > [!Note]  
    > <span data-ttu-id="2df73-121">Anbieter sollten nicht versuchen, die LUN-Flags zu ändern.</span><span class="sxs-lookup"><span data-stu-id="2df73-121">Providers should not attempt to modify any of the LUN flags.</span></span>

     

5.  <span data-ttu-id="2df73-122">Bei [**commitmomentaufnahmen**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots)wird ein Commit für die schattenkopieluns ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="2df73-122">At [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), the shadow copy LUNs are committed.</span></span> <span data-ttu-id="2df73-123">**Commitmomentaufnahmen** sollten innerhalb weniger Sekunden zurückgegeben werden, oder der gesamte Vorgang zum Erstellen von Schatten Kopien wird wahrscheinlich fehlschlagen.</span><span class="sxs-lookup"><span data-stu-id="2df73-123">**CommitSnapshots** should be returned within a few seconds or the whole shadow copy creation process will probably fail.</span></span>
6.  <span data-ttu-id="2df73-124">Nach [**commitmomentaufnahmen**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots)löscht VSS die Flags für alle ursprünglichen LUNs, die an der Schatten Kopie beteiligt sind.</span><span class="sxs-lookup"><span data-stu-id="2df73-124">After [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), VSS clears the flags on all original LUNs involved in the shadow copy.</span></span> <span data-ttu-id="2df73-125">Da für die schattenkopieluns an dieser Stelle ein Commit ausgeführt wurde, behalten die schattenkopieluns diese Flags bei.</span><span class="sxs-lookup"><span data-stu-id="2df73-125">Since the shadow copy LUNs have been committed at this point, the shadow copy LUNs retain these flags.</span></span>
7.  <span data-ttu-id="2df73-126">Nach dem [**ivssproviderkreatesnapshotset::P ostcommitsnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots)löscht VSS die LUN-Flags (die nach [**ivssproviderkreatesnapshotset:: EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots)festgelegt sind) und benachrichtigt die Writer, Sie zu überschreiben.</span><span class="sxs-lookup"><span data-stu-id="2df73-126">After [**IVssProviderCreateSnapshotSet::PostCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots), VSS clears the LUN flags (that it set after [**IVssProviderCreateSnapshotSet::EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots)) and notifies the writers to thaw.</span></span> <span data-ttu-id="2df73-127">VSS ruft dann die [**ivssproviderkreatesnapshotset::P verfeinern**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-prefinalcommitsnapshots) -und [**ivssproviderkreatesnapshotset::P ostfinalcommitsnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postfinalcommitsnapshots) -Methoden des Anbieters auf.</span><span class="sxs-lookup"><span data-stu-id="2df73-127">VSS then calls the provider's [**IVssProviderCreateSnapshotSet::PreFinalCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-prefinalcommitsnapshots) and [**IVssProviderCreateSnapshotSet::PostFinalCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postfinalcommitsnapshots) methods.</span></span>
8.  <span data-ttu-id="2df73-128">VSS ruft ein Array von [**VDS- \_ LUN- \_ Informations**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) Strukturen ab, eine für jede neu erstellte schattenkopielun, indem [**ivsshardwaresnapshotprovider:: gettargetluns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns)aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="2df73-128">VSS retrieves an array of [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures, one for each newly created shadow copy LUN, by calling [**IVssHardwareSnapshotProvider::GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns).</span></span> <span data-ttu-id="2df73-129">Der Anbieter muss genügend Informationen bereitstellen, damit VSS und der Anbieter die Schatten Kopien zu einem späteren Zeitpunkt und auf jedem mit dem Subsystem verbundenen System identifizieren können.</span><span class="sxs-lookup"><span data-stu-id="2df73-129">The provider must provide enough information to allow VSS and the provider to identify the shadow copies at any later time and on any system connected to the subsystem.</span></span> <span data-ttu-id="2df73-130">Zu diesem Zeitpunkt sollten die schattenkopieluns für diesen Computer nicht zugänglich sein – der Anbieter muss einen anderen Mechanismus als durch einfaches Lesen der Informationen aus der LUN verwenden.</span><span class="sxs-lookup"><span data-stu-id="2df73-130">At this time, the shadow copy LUNs should be inaccessible to this machine—the provider must use some mechanism other than by simply reading the information from the LUN.</span></span>
9.  <span data-ttu-id="2df73-131">Für austauschen-Schatten Kopien fügt VSS Folgendes an das Dokument mit den Sicherungs Komponenten an, in dem der Schattenkopiesatz beschrieben wird:</span><span class="sxs-lookup"><span data-stu-id="2df73-131">For transportable shadow copies, VSS appends the following to the Backup Components Document describing the shadow copy set:</span></span>
    1.  <span data-ttu-id="2df73-132">Das ursprüngliche LUN [**VDS- \_ LUN- \_ Informations**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) Array.</span><span class="sxs-lookup"><span data-stu-id="2df73-132">The original LUN [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) array.</span></span>
    2.  <span data-ttu-id="2df73-133">Das neue [**VDS- \_ LUN- \_ Informations**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) Array der schattenkopievds.</span><span class="sxs-lookup"><span data-stu-id="2df73-133">The new shadow copy LUN [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) array.</span></span>
    3.  <span data-ttu-id="2df73-134">Die Datenträger Blöcke für jedes Volume im Schattenkopiesatz.</span><span class="sxs-lookup"><span data-stu-id="2df73-134">The disk extents for each volume in the shadow copy set.</span></span>
10. <span data-ttu-id="2df73-135">Beim automatischen Importieren von Schatten Kopien beginnt der Import Vorgang.</span><span class="sxs-lookup"><span data-stu-id="2df73-135">For auto-import shadow copies, the import process begins.</span></span> <span data-ttu-id="2df73-136">In [**ivsshardwaresnapshotprovider:: lokatuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-locateluns)erhält der Anbieter die [**VDS- \_ LUN- \_ Informationen**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) , die zur Erstellungszeit in [**gettargetluns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) generiert werden.</span><span class="sxs-lookup"><span data-stu-id="2df73-136">In [**IVssHardwareSnapshotProvider::LocateLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-locateluns), the provider will be given the [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) generated in [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) at creation time.</span></span> <span data-ttu-id="2df73-137">Während **loeruns** sollte der Anbieter diese schattenkopieluns für das System sichtbar machen.</span><span class="sxs-lookup"><span data-stu-id="2df73-137">During **LocateLuns**, the provider should make those shadow copy LUNs visible to the system.</span></span> <span data-ttu-id="2df73-138">Der Anbieter sollte keinen busneuscan auslösen.</span><span class="sxs-lookup"><span data-stu-id="2df73-138">The provider should not cause a bus rescan.</span></span> <span data-ttu-id="2df73-139">VSS bewirkt, dass bei der erneuten Überprüfung und Enumeration die LUNs von PNP und den Volumes wieder online gestellt werden.</span><span class="sxs-lookup"><span data-stu-id="2df73-139">VSS will cause the rescan and enumeration to allow the LUNs to be discovered by PNP and the volumes to come online.</span></span>
11. <span data-ttu-id="2df73-140">VSS ruft [**ivsshardwaresnapshotprovider:: fillinluninfo**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-fillinluninfo) für die neu eingegangenen Datenträger im System auf.</span><span class="sxs-lookup"><span data-stu-id="2df73-140">VSS calls [**IVssHardwareSnapshotProvider::FillInLunInfo**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-fillinluninfo) for the newly arrived disks in the system.</span></span> <span data-ttu-id="2df73-141">VSS verwendet das VDS-LUNs- [**\_ \_ Informations**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) Array der Schattenkopie von **fillinluninfo** und vergleicht es mit den **VDS- \_ LUN- \_ Informationen** , die während der Erstellung in [**gettargetluns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) generiert werden, und die Datenträger Blöcke für jedes Volume im Schattenkopiesatz, um die neu eingegangenen schattenkopieluns zu identifizieren.</span><span class="sxs-lookup"><span data-stu-id="2df73-141">VSS uses the shadow copy LUN [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) array from **FillInLunInfo**, comparing it with the **VDS\_LUN\_INFORMATION** generated during creation in [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) and the disk extents for each volume in the shadow copy set to identify the newly arrived shadow copy LUNs.</span></span>
12. <span data-ttu-id="2df73-142">An diesem Punkt werden alle in den schattenkopieluns enthaltenen Volumes ausgeblendet und schreibgeschützt bereitgestellt, und VSS verfügt über eine Zuordnung vom ursprünglichen Volume zum Schattenkopievolume.</span><span class="sxs-lookup"><span data-stu-id="2df73-142">At this point, all volumes contained on the shadow copy LUNs are mounted hidden and read-only, and VSS has a mapping from original volume to shadow copy volume.</span></span>

<span data-ttu-id="2df73-143">Da eine einzelne LUN Teile mehrerer Volumes enthalten kann, können die schattenkopieluns "zusätzliche" Volumes enthalten.</span><span class="sxs-lookup"><span data-stu-id="2df73-143">Because a single LUN can contain portions of multiple volumes, the set of shadow copy LUNs may include "extra" volumes.</span></span> <span data-ttu-id="2df73-144">Diese Volumes sind nicht Teil der Schattenkopiesatz und sollten nicht verwendet werden, da Sie nicht sicher sind, dass Sie einheitlich sind.</span><span class="sxs-lookup"><span data-stu-id="2df73-144">Those volumes are not part of the shadow copy set and should not be used as they are not guaranteed to be consistent.</span></span>

<span data-ttu-id="2df73-145">Nach dem Import kann auf die Schatten Kopie über die [**IVssBackupComponents:: Query**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-query) -Methode zugegriffen werden.</span><span class="sxs-lookup"><span data-stu-id="2df73-145">After import, the shadow copy can be accessed via the [**IVssBackupComponents::Query**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-query) method.</span></span> <span data-ttu-id="2df73-146">Eine Schatten Kopie kann auch als Laufwerksbuchstabe, eingebundenes Ordner oder Freigabe mithilfe von [**IVssBackupComponents:: exposesnapshot**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-exposesnapshot)verfügbar gemacht werden.</span><span class="sxs-lookup"><span data-stu-id="2df73-146">A shadow copy can also be exposed as a drive letter, mounted folder, or share using [**IVssBackupComponents::ExposeSnapshot**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-exposesnapshot).</span></span> <span data-ttu-id="2df73-147">Ein Schattenkopiesatz kann auch mit der [**IVssBackupComponents:: breaksnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-breaksnapshotset) -Methode in eine reguläre LUN konvertiert werden.</span><span class="sxs-lookup"><span data-stu-id="2df73-147">A shadow copy set may also be converted to a regular LUN by using the [**IVssBackupComponents::BreakSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-breaksnapshotset) method.</span></span> <span data-ttu-id="2df73-148">Von dort aus können Verwaltungs Anwendungen geeignete Datenträger Verwaltungs-APIs verwenden, um die LUN weiter zu verwalten (z. b. das Ändern der Lese-/Schreibattribute)</span><span class="sxs-lookup"><span data-stu-id="2df73-148">From there management applications can use appropriate disk management APIs to further manage the LUN (such as changing the read/write attributes).</span></span>

### <a name="transportable-shadow-copies-on-a-san"></a><span data-ttu-id="2df73-149">Über transportable Schatten Kopien in einem San</span><span class="sxs-lookup"><span data-stu-id="2df73-149">Transportable Shadow Copies on a SAN</span></span>

<span data-ttu-id="2df73-150">Ab Windows Server 2003, Datacenter Edition und Windows Server 2003 Enterprise Edition ermöglicht VSS die übertragbare schattenkopiesätze in einem San.</span><span class="sxs-lookup"><span data-stu-id="2df73-150">Beginning with Windows Server 2003, Datacenter Edition and Windows Server 2003, Enterprise Edition, VSS enables transportable shadow copy sets on a SAN.</span></span> <span data-ttu-id="2df73-151">Aus Sicht eines Anbieters, der LUNs zwischen Hosts transportieren kann, besteht nur wenig oder kein Unterschied zwischen einem nicht austauschen-und einem austauschen-Schatten Kopiesatz.</span><span class="sxs-lookup"><span data-stu-id="2df73-151">From the point of view of a provider capable of transporting LUNs between hosts, there is little or no difference between a non-transportable and a transportable shadow copy set.</span></span>

<span data-ttu-id="2df73-152">**Windows Server 2003, Standard Edition, Windows Server 2003, Web Edition und Windows XP:** Transportable-schattenkopiesätze werden nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="2df73-152">**Windows Server 2003, Standard Edition, Windows Server 2003, Web Edition and Windows XP:** Transportable shadow copy sets are not supported.</span></span> <span data-ttu-id="2df73-153">Alle Editionen von Windows Server 2003 mit Service Pack 1 (SP1) unterstützen austauschen schattenkopiesätze.</span><span class="sxs-lookup"><span data-stu-id="2df73-153">All editions of Windows Server 2003 with Service Pack 1 (SP1) support transportable shadow copy sets.</span></span>

<span data-ttu-id="2df73-154">Transportable-schattenkopiesätze müssen mit dem VSS-Attribut " **\_ Volsnap \_ attr \_ transportable** " erstellt werden, das dem [**Kontext der Schatten \_ \_ \_ \_**](/windows/desktop/api/Vss/ne-vss-vss_volume_snapshot_attributes) Kopie hinzugefügt wird</span><span class="sxs-lookup"><span data-stu-id="2df73-154">Transportable shadow copy sets must be created with the **VSS\_VOLSNAP\_ATTR\_TRANSPORTABLE** attribute added to the shadow copy context described by the [**\_VSS\_VOLUME\_SNAPSHOT\_ATTRIBUTES**](/windows/desktop/api/Vss/ne-vss-vss_volume_snapshot_attributes) enumeration.</span></span> <span data-ttu-id="2df73-155">Alle Volumes in der Gruppe müssen transportierbar sein.</span><span class="sxs-lookup"><span data-stu-id="2df73-155">All volumes in the set must be transportable.</span></span> <span data-ttu-id="2df73-156">Durch Zurückgeben des Erfolgs von [**ivsshardwaresnapshotprovider:: arelunssupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported)gibt der Anbieter an, dass er nicht nur die LUN unterstützt, sondern auch, dass er die LUN transportieren kann.</span><span class="sxs-lookup"><span data-stu-id="2df73-156">By returning success from [**IVssHardwareSnapshotProvider::AreLunsSupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported), the provider is indicating that not only does it support the LUN, but also that it can transport the LUN.</span></span> <span data-ttu-id="2df73-157">Die Erstellung eines austauschen-schattenkopiesatzes endet, wenn VSS die LUN-Informationen im Dokument mit den Sicherungs Komponenten aufzeichnet.</span><span class="sxs-lookup"><span data-stu-id="2df73-157">The creation of a transportable shadow copy set concludes when VSS records the LUN information in the Backup Components Document.</span></span> <span data-ttu-id="2df73-158">Ein Schattenkopiesatz kann nur einmal nach der anfänglichen Erstellung importiert werden.</span><span class="sxs-lookup"><span data-stu-id="2df73-158">A shadow copy set may only be imported once after initial creation.</span></span>

<span data-ttu-id="2df73-159">Auf dem empfangenden Computer importiert der Anforderer den Schattenkopiesatz.</span><span class="sxs-lookup"><span data-stu-id="2df73-159">On the receiving machine, the requester imports the shadow copy set.</span></span> <span data-ttu-id="2df73-160">Die [**IVssBackupComponents:: importshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) -Methode verwendet das Sicherungs Komponenten Dokument, das den als Eingabe festgelegten Schattenkopiesatz beschreibt.</span><span class="sxs-lookup"><span data-stu-id="2df73-160">The [**IVssBackupComponents::ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) method uses the Backup Components Document describing the shadow copy set as input.</span></span> <span data-ttu-id="2df73-161">Der Import erfolgt durch:</span><span class="sxs-lookup"><span data-stu-id="2df73-161">Importing proceeds by:</span></span>

1.  <span data-ttu-id="2df73-162">VSS erstellt ein Array von [**VDS- \_ LUN- \_ Informations**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) Strukturen mit Schatten Kopien aus dem Dokument mit den Sicherungs Komponenten.</span><span class="sxs-lookup"><span data-stu-id="2df73-162">VSS constructs an array of shadow copy [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures from the Backup Components Document.</span></span>
2.  <span data-ttu-id="2df73-163">Wenn VSS [**ivsshardwaresnapshotprovider:: loeruns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-locateluns)aufruft, wird das Array der [**VDS- \_ LUN- \_ Informations**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) Strukturen, die in [**ivsshardwaresnapshotprovider:: gettargetluns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) generiert werden, an den Anbieter übermittelt.</span><span class="sxs-lookup"><span data-stu-id="2df73-163">When VSS calls [**IVssHardwareSnapshotProvider::LocateLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-locateluns), the array of [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures generated in [**IVssHardwareSnapshotProvider::GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) will be passed to the provider.</span></span> <span data-ttu-id="2df73-164">Beim Verarbeiten dieser Methode sollte der Anbieter diese schattenkopieluns für das System sichtbar machen.</span><span class="sxs-lookup"><span data-stu-id="2df73-164">While processing this method, the provider should make those shadow copy LUNs visible to the system.</span></span> <span data-ttu-id="2df73-165">Der Anbieter sollte keinen busneuscan auslösen.</span><span class="sxs-lookup"><span data-stu-id="2df73-165">The provider should not cause a bus rescan.</span></span> <span data-ttu-id="2df73-166">VSS löst die erneute Überprüfung und Enumeration aus, damit die LUNs von PNP und den Volumes wieder online gestellt werden können.</span><span class="sxs-lookup"><span data-stu-id="2df73-166">VSS will trigger the rescan and enumeration to allow the LUNs to be discovered by PNP and the volumes to come online.</span></span>
3.  <span data-ttu-id="2df73-167">VSS ruft [**ivsshardwaresnapshotprovider:: fillinluninfo**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-fillinluninfo) für die neu eingegangenen Datenträger im System auf.</span><span class="sxs-lookup"><span data-stu-id="2df73-167">VSS calls [**IVssHardwareSnapshotProvider::FillInLunInfo**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-fillinluninfo) for the newly arrived disks in the system.</span></span> <span data-ttu-id="2df73-168">VSS verwendet das schattenkopiearray von [**VDS- \_ LUN- \_ Informations**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) Strukturen aus **fillinluninfo** und vergleicht es mit den **VDS- \_ LUN- \_ Informationen** , die bei der Erstellung von schattenkopietrichten in [**gettargetluns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) generiert werden, und die Datenträger Blöcke für jedes Volume im Schattenkopiesatz, um die neu eingegangenen Schatten Kopien</span><span class="sxs-lookup"><span data-stu-id="2df73-168">VSS uses the shadow copy LUN array of [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures from **FillInLunInfo**, comparing it with the **VDS\_LUN\_INFORMATION** generated during shadow copy set creation in [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) and the disk extents for each volume in the shadow copy set to identify the newly arrived shadow copy LUNs.</span></span>
4.  <span data-ttu-id="2df73-169">An diesem Punkt werden alle Volumes, die in den Transporten LUNs enthalten sind, ausgeblendet und schreibgeschützt bereitgestellt, und VSS verfügt über eine Zuordnung zwischen dem ursprünglichen Volume und dem Schattenkopievolume.</span><span class="sxs-lookup"><span data-stu-id="2df73-169">At this point, all volumes contained on the transported LUNs are mounted hidden and read-only and VSS has a mapping from the original volume to the shadow copy volume.</span></span>

<span data-ttu-id="2df73-170">Für den einzelnen Computer und den austauschen-Fall ähnelt die Sequenz dem Zeitpunkt, an dem [**gettargetluns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="2df73-170">For both the single machine and transportable case, the sequence is similar starting with the point that [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) is called.</span></span> <span data-ttu-id="2df73-171">Für den automatischen Import erfolgen die Schritte direkt nach der Erstellung.</span><span class="sxs-lookup"><span data-stu-id="2df73-171">For auto-import, the steps happen directly after creation.</span></span>

 

 
