---
description: Eine VSS-Sicherungs-und-Wiederherstellungs Anwendung, die eine Notfall Wiederherstellung durchführt (auch als Bare-Metal-Recovery bezeichnet), kann den ASR-Writer (Automated System Recovery) mit Windows Preinstallation Environment (Windows PE) zum Sichern und Wiederherstellen kritischer Volumes und anderer Komponenten des Start fähigen System Status verwenden. Die Sicherungs Anwendung wird als VSS-Anforderer implementiert.
ms.assetid: 13adfd79-f26a-4385-9b59-129d06fa72eb
title: Verwenden der automatisierten VSS-System Wiederherstellung für die Notfall Wiederherstellung
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1e31ef8ba223f40928e2422fa92240656f94592d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "106347769"
---
# <a name="using-vss-automated-system-recovery-for-disaster-recovery"></a><span data-ttu-id="fe077-104">Verwenden der automatisierten VSS-System Wiederherstellung für die Notfall Wiederherstellung</span><span class="sxs-lookup"><span data-stu-id="fe077-104">Using VSS Automated System Recovery for Disaster Recovery</span></span>

<span data-ttu-id="fe077-105">Eine VSS-Sicherungs-und-Wiederherstellungs Anwendung, die eine Notfall Wiederherstellung durchführt (auch als Bare-Metal-Recovery bezeichnet), kann den ASR-Writer (Automated System Recovery) mit Windows Preinstallation Environment (Windows PE) zum Sichern und Wiederherstellen kritischer Volumes und anderer Komponenten des Start fähigen System Status verwenden.</span><span class="sxs-lookup"><span data-stu-id="fe077-105">A VSS backup-and-recovery application that performs disaster recovery (also called bare-metal recovery) can use the Automated System Recovery (ASR) writer together with Windows Preinstallation Environment (Windows PE) to back up and restore critical volumes and other components of the bootable system state.</span></span> <span data-ttu-id="fe077-106">Die Sicherungs Anwendung wird als VSS-Anforderer implementiert.</span><span class="sxs-lookup"><span data-stu-id="fe077-106">The backup application is implemented as a VSS requester.</span></span>

<span data-ttu-id="fe077-107">**Hinweis**  Anwendungen, die ASR verwenden, müssen Windows PE lizenzieren.</span><span class="sxs-lookup"><span data-stu-id="fe077-107">**Note**  Applications that use ASR must license Windows PE.</span></span>

<span data-ttu-id="fe077-108">**Windows Server 2003 und Windows XP:** ASR ist nicht als VSS Writer implementiert.</span><span class="sxs-lookup"><span data-stu-id="fe077-108">**Windows Server 2003 and Windows XP:** ASR is not implemented as a VSS writer.</span></span>

<span data-ttu-id="fe077-109">Informationen zu den Ablauf Verfolgungs Tools, die Sie mit ASR verwenden können, finden Sie unter Verwenden von Ablauf [Verfolgungs Tools mit VSS ASR-Anwendungen](using-tracing-tools-with-vss-asr-applications.md).</span><span class="sxs-lookup"><span data-stu-id="fe077-109">For information about tracing tools that you can use with ASR, see [Using Tracing Tools with VSS ASR Applications](using-tracing-tools-with-vss-asr-applications.md).</span></span>

<span data-ttu-id="fe077-110">**In diesem Artikel:**</span><span class="sxs-lookup"><span data-stu-id="fe077-110">**In this article:**</span></span>

-   [<span data-ttu-id="fe077-111">Übersicht über Sicherungs Phasen Tasks</span><span class="sxs-lookup"><span data-stu-id="fe077-111">Overview of Backup Phase Tasks</span></span>](#overview-of-backup-phase-tasks)
-   [<span data-ttu-id="fe077-112">Auswählen der zu sichernden kritischen Komponenten</span><span class="sxs-lookup"><span data-stu-id="fe077-112">Choosing Which Critical Components to Back Up</span></span>](#choosing-which-critical-components-to-back-up)
-   [<span data-ttu-id="fe077-113">Übersicht über Wiederherstellungs Phasen Tasks</span><span class="sxs-lookup"><span data-stu-id="fe077-113">Overview of Restore Phase Tasks</span></span>](#overview-of-restore-phase-tasks)
-   [<span data-ttu-id="fe077-114">Ausschließen aller Datenträger für ein Volume</span><span class="sxs-lookup"><span data-stu-id="fe077-114">Excluding All Disks for a Volume</span></span>](#excluding-all-disks-for-a-volume)

## <a name="overview-of-backup-phase-tasks"></a><span data-ttu-id="fe077-115">Übersicht über Sicherungs Phasen Tasks</span><span class="sxs-lookup"><span data-stu-id="fe077-115">Overview of Backup Phase Tasks</span></span>

<span data-ttu-id="fe077-116">Zum Zeitpunkt der Sicherung führt der Anforderer die folgenden Schritte aus.</span><span class="sxs-lookup"><span data-stu-id="fe077-116">At backup time, the requester performs the following steps.</span></span>

> [!Note]  
> <span data-ttu-id="fe077-117">Alle Schritte sind erforderlich, sofern nicht anders angegeben.</span><span class="sxs-lookup"><span data-stu-id="fe077-117">All steps are required unless otherwise indicated.</span></span>

 

1.  <span data-ttu-id="fe077-118">Rufen Sie die Funktion " [**foratevssbackupcomponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents) " auf, um eine Instanz der [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) -Schnittstelle zu erstellen, und rufen Sie die [**IVssBackupComponents:: initializeforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) -Methode auf, um die Instanz zum Verwalten einer Sicherung zu initialisieren.</span><span class="sxs-lookup"><span data-stu-id="fe077-118">Call the [**CreateVssBackupComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents) function to create an instance of the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface and call the [**IVssBackupComponents::InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) method to initialize the instance to manage a backup.</span></span>
2.  <span data-ttu-id="fe077-119">Nennen Sie [**IVssBackupComponents:: SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext) , um den Kontext für den Schattenkopievorgang festzulegen.</span><span class="sxs-lookup"><span data-stu-id="fe077-119">Call [**IVssBackupComponents::SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext) to set the context for the shadow copy operation.</span></span>
3.  <span data-ttu-id="fe077-120">Nennen Sie [**IVssBackupComponents:: SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate) , um die Sicherung zu konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="fe077-120">Call [**IVssBackupComponents::SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate) to configure the backup.</span></span> <span data-ttu-id="fe077-121">Legen Sie den Parameter " *bbackupbootablesystemstate* " auf " **true** " fest, um anzugeben, dass die Sicherung einen Start baren Systemstatus enthalten soll.</span><span class="sxs-lookup"><span data-stu-id="fe077-121">Set the *bBackupBootableSystemState* parameter to **true** to indicate that the backup will include a bootable system state.</span></span>
4.  <span data-ttu-id="fe077-122">Wählen Sie die kritischen Komponenten im Writer-Metadatendokument des ASR Writer aus, um die Sicherungskopie zu sichern und [**IVssBackupComponents:: addComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent) für jede dieser Dateien aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="fe077-122">Choose which critical components in the ASR writer's Writer Metadata Document to back up and call [**IVssBackupComponents::AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent) for each of them.</span></span>
5.  <span data-ttu-id="fe077-123">Rufen Sie [**IVssBackupComponents:: startnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset) auf, um einen neuen leeren Schattenkopiesatz zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="fe077-123">Call [**IVssBackupComponents::StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset) to create a new, empty shadow copy set.</span></span>
6.  <span data-ttu-id="fe077-124">Nennen Sie [**IVssBackupComponents:: gatherwritermetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) , um den asynchronen Kontakt mit Writern zu initiieren.</span><span class="sxs-lookup"><span data-stu-id="fe077-124">Call [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) to initiate asynchronous contact with writers.</span></span>
7.  <span data-ttu-id="fe077-125">Rufen Sie [**IVssBackupComponents:: getschreibmetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata) auf, um das Writer-Metadatendokument des ASR Writer abzurufen.</span><span class="sxs-lookup"><span data-stu-id="fe077-125">Call [**IVssBackupComponents::GetWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata) to retrieve the ASR writer's Writer Metadata Document.</span></span> <span data-ttu-id="fe077-126">Die Writer-ID für den ASR-Writer lautet BE000CBE-11FE-4426-9C58-531AA6355FC4, und die Writer-namens Zeichenfolge lautet "ASR Writer".</span><span class="sxs-lookup"><span data-stu-id="fe077-126">The writer ID for the ASR writer is BE000CBE-11FE-4426-9C58-531AA6355FC4, and the writer name string is "ASR Writer".</span></span>
8.  <span data-ttu-id="fe077-127">Nennen Sie [**ivssexaminewrite Metadata:: SaveAsXml**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml) , um eine Kopie des Writer-Metadatendokuments des ASR Writer zu speichern.</span><span class="sxs-lookup"><span data-stu-id="fe077-127">Call [**IVssExamineWriterMetadata::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml) to save a copy of the ASR writer's Writer Metadata Document.</span></span>
9.  <span data-ttu-id="fe077-128">Nennen Sie [**IVssBackupComponents:: adddesnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addtosnapshotset) für jedes Volume, das an Schatten Kopien teilnehmen kann, um das Volume dem Schattenkopiesatz hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="fe077-128">Call [**IVssBackupComponents::AddToSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addtosnapshotset) for each volume that can participate in shadow copies to add the volume to the shadow copy set.</span></span>
10. <span data-ttu-id="fe077-129">Nennen Sie [**IVssBackupComponents::P Analyse forbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) , um Writer zu benachrichtigen, dass ein Sicherungs Vorgang vorbereitet werden soll.</span><span class="sxs-lookup"><span data-stu-id="fe077-129">Call [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) to notify writers to prepare for a backup operation.</span></span>
11. <span data-ttu-id="fe077-130">Nennen Sie [**IVssBackupComponents:: gatherschreiterstatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) und [**IVssBackupComponents:: getschreiterstatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) (oder [**IVssBackupComponentsEx3:: getschreiterstatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex3-getwriterstatusex)), um den Status des ASR-Writers zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="fe077-130">Call [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) and [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) (or [**IVssBackupComponentsEx3::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex3-getwriterstatusex)) to verify the status of the ASR writer.</span></span>
12. <span data-ttu-id="fe077-131">An diesem Punkt können Sie Fehlermeldungen Abfragen, die vom Writer in seiner [**CVssWriter:: onpreparebackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) -Methode festgelegt wurden.</span><span class="sxs-lookup"><span data-stu-id="fe077-131">At this point, you can query for failure messages that were set by the writer in its [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) method.</span></span> <span data-ttu-id="fe077-132">Beispielcode, der zeigt, wie Sie diese Meldungen anzeigen, finden Sie unter [**ivsscomponestex:: getprepareforbackupfailuremsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getprepareforbackupfailuremsg).</span><span class="sxs-lookup"><span data-stu-id="fe077-132">For example code that shows how to view these messages, see [**IVssComponentEx::GetPrepareForBackupFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getprepareforbackupfailuremsg).</span></span>
13. <span data-ttu-id="fe077-133">Rufen Sie [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) auf, um eine Volumeschattenkopie zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="fe077-133">Call [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) to create a volume shadow copy.</span></span>
14. <span data-ttu-id="fe077-134">Nennen Sie [**IVssBackupComponents:: gatherschreiterstatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) und [**IVssBackupComponents:: getschreiterstatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) , um den Status des ASR-Writers zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="fe077-134">Call [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) and [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) to verify the status of the ASR writer.</span></span>
15. <span data-ttu-id="fe077-135">Sichern Sie die Daten.</span><span class="sxs-lookup"><span data-stu-id="fe077-135">Back up the data.</span></span>
16. <span data-ttu-id="fe077-136">Geben Sie an, ob der Sicherungs Vorgang erfolgreich war, indem Sie [**IVssBackupComponents:: setbackuperfolgreicher**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded)aufrufen.</span><span class="sxs-lookup"><span data-stu-id="fe077-136">Indicate whether the backup operation succeeded by calling [**IVssBackupComponents::SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded).</span></span>
17. <span data-ttu-id="fe077-137">Nennen Sie [**IVssBackupComponents:: BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) , um anzugeben, dass der Sicherungs Vorgang abgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="fe077-137">Call [**IVssBackupComponents::BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) to indicate that the backup operation has completed.</span></span>
18. <span data-ttu-id="fe077-138">Nennen Sie [**IVssBackupComponents:: gatherschreiterstatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) und [**IVssBackupComponents:: getschreiterstatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus).</span><span class="sxs-lookup"><span data-stu-id="fe077-138">Call [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) and [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus).</span></span> <span data-ttu-id="fe077-139">Der Schreib Sitzungs Zustands Speicher ist eine begrenzte Ressource, und Writer müssen die Sitzungs Zustände schließlich wieder verwenden.</span><span class="sxs-lookup"><span data-stu-id="fe077-139">The writer session state memory is a limited resource, and writers must eventually reuse session states.</span></span> <span data-ttu-id="fe077-140">Durch diesen Schritt wird der Status der Sicherungs Sitzung des Writers als abgeschlossen markiert und VSS benachrichtigt, dass dieser Sicherungs Sitzungs Slot von einem nachfolgenden Sicherungs Vorgang wieder verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="fe077-140">This step marks the writer’s backup session state as completed and notifies VSS that this backup session slot can be reused by a subsequent backup operation.</span></span>
    > [!Note]  
    > <span data-ttu-id="fe077-141">Dies ist nur auf Windows Server 2008 mit Service Pack 2 (SP2) und früher erforderlich.</span><span class="sxs-lookup"><span data-stu-id="fe077-141">This is only necessary on Windows Server 2008 with Service Pack 2 (SP2) and earlier.</span></span>

     

19. <span data-ttu-id="fe077-142">Nennen Sie [**IVssBackupComponents:: SaveAsXml**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml) , um eine Kopie des Dokuments mit den Sicherungs Komponenten des Anforderers zu speichern.</span><span class="sxs-lookup"><span data-stu-id="fe077-142">Call [**IVssBackupComponents::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml) to save a copy of the requester's Backup Components Document.</span></span> <span data-ttu-id="fe077-143">Die Informationen im Dokument mit den Sicherungs Komponenten werden zum Zeitpunkt der Wiederherstellung verwendet, wenn die anfordernde Person die [**IVssBackupComponents:: initializeforrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore) -Methode aufruft.</span><span class="sxs-lookup"><span data-stu-id="fe077-143">The information in the Backup Components Document is used at restore time when the requester calls the [**IVssBackupComponents::InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore) method.</span></span>

## <a name="choosing-which-critical-components-to-back-up"></a><span data-ttu-id="fe077-144">Auswählen der zu sichernden kritischen Komponenten</span><span class="sxs-lookup"><span data-stu-id="fe077-144">Choosing Which Critical Components to Back Up</span></span>

<span data-ttu-id="fe077-145">In der Initialisierungsphase der Sicherung meldet der ASR Writer die folgenden Typen von Komponenten im Writer-Metadatendokument:</span><span class="sxs-lookup"><span data-stu-id="fe077-145">In the backup initialization phase, the ASR writer reports the following types of components in its Writer Metadata Document:</span></span>

-   <span data-ttu-id="fe077-146">Kritische Volumes, wie z. b. die Volumes Boot, System und Windows Recovery Environment (Windows RE) und die Windows RE-Partition, die mit der derzeit laufenden Instanz von Windows Vista oder Windows Server 2008 verknüpft ist.</span><span class="sxs-lookup"><span data-stu-id="fe077-146">Critical volumes, such as the boot, system, and Windows Recovery Environment (Windows RE) volumes and the Windows RE partition that is associated with the instance of Windows Vista or Windows Server 2008 that is currently running.</span></span> <span data-ttu-id="fe077-147">Ein Volume ist ein *wichtiges Volume* , wenn es Systemstatus Informationen enthält.</span><span class="sxs-lookup"><span data-stu-id="fe077-147">A volume is a *critical volume* if it contains system state information.</span></span> <span data-ttu-id="fe077-148">Die Start-und Systemvolumes werden automatisch eingeschlossen.</span><span class="sxs-lookup"><span data-stu-id="fe077-148">The boot and system volumes are included automatically.</span></span> <span data-ttu-id="fe077-149">Der Anforderer muss alle Volumes mit systemkritischen Komponenten enthalten, die von Writern gemeldet werden, z. b. die Volumes, die die Active Directory enthalten.</span><span class="sxs-lookup"><span data-stu-id="fe077-149">The requester must include all volumes that contain system-critical components reported by writers, such as the volumes that contain the Active Directory.</span></span> <span data-ttu-id="fe077-150">System kritische Komponenten werden als "nicht auswählbar für Sicherung" markiert.</span><span class="sxs-lookup"><span data-stu-id="fe077-150">System-critical components are marked as "not selectable for backup."</span></span> <span data-ttu-id="fe077-151">In VSS bedeutet "nicht wählbar" "nicht optional".</span><span class="sxs-lookup"><span data-stu-id="fe077-151">In VSS, "not selectable" means "not optional."</span></span> <span data-ttu-id="fe077-152">Daher muss die anfordernde Person Sie als Teil des Systemstatus sichern.</span><span class="sxs-lookup"><span data-stu-id="fe077-152">Thus, the requester is required to back them up as part of system state.</span></span> <span data-ttu-id="fe077-153">Weitere Informationen finden Sie unter [Sichern und Wiederherstellen des System Status](locating-additional-system-files.md).</span><span class="sxs-lookup"><span data-stu-id="fe077-153">For more information, see [Backing Up and Restoring System State](locating-additional-system-files.md).</span></span> <span data-ttu-id="fe077-154">Komponenten, für die das VSS \_ CF \_ nicht \_ -systemstatusflag \_ festgelegt ist, sind nicht System kritisch.</span><span class="sxs-lookup"><span data-stu-id="fe077-154">Components for which the VSS\_CF\_NOT\_SYSTEM\_STATE flag is set are not system-critical.</span></span>
    > [!Note]  
    > <span data-ttu-id="fe077-155">Bei der ASR-Komponente handelt es sich um eine systemkritische Komponente, die vom ASR-Writer gemeldet wird.</span><span class="sxs-lookup"><span data-stu-id="fe077-155">The ASR component is a system-critical component that is reported by the ASR writer.</span></span>

     

-   <span data-ttu-id="fe077-156">Datenträger.</span><span class="sxs-lookup"><span data-stu-id="fe077-156">Disks.</span></span> <span data-ttu-id="fe077-157">Jeder Festplatten Datenträger auf dem Computer wird als Komponente in ASR verfügbar gemacht.</span><span class="sxs-lookup"><span data-stu-id="fe077-157">Every fixed disk on the computer is exposed as a component in ASR.</span></span> <span data-ttu-id="fe077-158">Wenn ein Datenträger während der Sicherung nicht ausgeschlossen wurde, wird er während der Wiederherstellung zugewiesen und kann neu erstellt und neu formatiert werden.</span><span class="sxs-lookup"><span data-stu-id="fe077-158">If a disk was not excluded during backup, it will be assigned during restore and can be re-created and reformatted.</span></span> <span data-ttu-id="fe077-159">Beachten Sie, dass die anfordernde Person während der Wiederherstellung weiterhin einen Datenträger erstellen kann, der während der Sicherung ausgeschlossen wurde, indem Sie die [**IVssBackupComponents:: abtrestoreoptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions) -Methode aufgerufen hat.</span><span class="sxs-lookup"><span data-stu-id="fe077-159">Note that during restore, the requester can still re-create a disk that was excluded during backup by calling the [**IVssBackupComponents::SetRestoreOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions) method.</span></span> <span data-ttu-id="fe077-160">Wenn ein Datenträger in einem Dynamic Disk Pack ausgewählt ist, müssen auch alle anderen Datenträger dieses Pakets ausgewählt werden.</span><span class="sxs-lookup"><span data-stu-id="fe077-160">If one disk in a dynamic disk pack is selected, all other disks in that pack must also be selected.</span></span> <span data-ttu-id="fe077-161">Wenn ein Volume ausgewählt ist, weil es sich um ein wichtiges Volume handelt (d. h. ein Volume, das Systemstatus Informationen enthält), muss jeder Datenträger, der einen Wertebereich für dieses Volume enthält, ebenfalls ausgewählt werden.</span><span class="sxs-lookup"><span data-stu-id="fe077-161">If a volume is selected because it is a critical volume (that is, a volume that contains system state information), every disk that contains an extent for that volume must also be selected.</span></span> <span data-ttu-id="fe077-162">Um die Blöcke für ein Volume zu finden, verwenden Sie den Code zum Abrufen von volumedatenträger für Volume Abrufen von Volumes. [**\_ \_ \_ \_ \_**](/windows/win32/api/winioctl/ni-winioctl-ioctl_volume_get_volume_disk_extents)</span><span class="sxs-lookup"><span data-stu-id="fe077-162">To find the extents for a volume, use the [**IOCTL\_VOLUME\_GET\_VOLUME\_DISK\_EXTENTS**](/windows/win32/api/winioctl/ni-winioctl-ioctl_volume_get_volume_disk_extents) control code.</span></span>

    > [!Note]  
    > <span data-ttu-id="fe077-163">Während der Sicherung sollte der Anforderer alle Festplatten Datenträger einschließen.</span><span class="sxs-lookup"><span data-stu-id="fe077-163">During backup, the requester should include all fixed disks.</span></span> <span data-ttu-id="fe077-164">Wenn der Datenträger, der den Sicherungs Satz des Anforderers enthält, ein lokaler Datenträger ist, sollte dieser Datenträger eingeschlossen werden.</span><span class="sxs-lookup"><span data-stu-id="fe077-164">If the disk that contains the requester's backup set is a local disk, this disk should be included.</span></span> <span data-ttu-id="fe077-165">Während der Wiederherstellung muss der Anforderer den Datenträger ausschließen, der den Sicherungs Satz des Anforderers enthält, um zu verhindern, dass er überschrieben wird.</span><span class="sxs-lookup"><span data-stu-id="fe077-165">During restore, the requester must exclude the disk that contains the requester's backup set to prevent it from being overwritten.</span></span>

     

    <span data-ttu-id="fe077-166">In einer Cluster Umgebung erstellt ASR das Layout der freigegebenen Datenträger des Clusters nicht neu.</span><span class="sxs-lookup"><span data-stu-id="fe077-166">In a clustering environment, ASR does not re-create the layout of the cluster's shared disks.</span></span> <span data-ttu-id="fe077-167">Diese Datenträger sollten Online wieder hergestellt werden, nachdem das Betriebssystem in Windows RE wieder hergestellt wurde.</span><span class="sxs-lookup"><span data-stu-id="fe077-167">Those disks should be restored online after the operating system is restored in the Windows RE.</span></span>

-   <span data-ttu-id="fe077-168">Startkonfigurationsdaten (BCD)-Speicher.</span><span class="sxs-lookup"><span data-stu-id="fe077-168">Boot Configuration Data (BCD) store.</span></span> <span data-ttu-id="fe077-169">Diese Komponente gibt den Pfad des Verzeichnisses an, das den BCD-Speicher enthält.</span><span class="sxs-lookup"><span data-stu-id="fe077-169">This component specifies the path of the directory that contains the BCD store.</span></span> <span data-ttu-id="fe077-170">Der Anforderer muss diese Komponente angeben und alle Dateien im BCD-Speicher Verzeichnis sichern.</span><span class="sxs-lookup"><span data-stu-id="fe077-170">The requester must specify this component and back up all of the files in the BCD store directory.</span></span> <span data-ttu-id="fe077-171">Weitere Informationen zum BCD-Speicher finden Sie unter [about BCD (Informationen zu BCD](/previous-versions/windows/desktop/bcd/about-bcd)).</span><span class="sxs-lookup"><span data-stu-id="fe077-171">For more information about the BCD store, see [About BCD](/previous-versions/windows/desktop/bcd/about-bcd).</span></span>
    > [!Note]  
    > <span data-ttu-id="fe077-172">Auf Computern, die die erweiterte Firmware-Schnittstelle (EFI) verwenden, ist die EFI-System Partition (ESP) immer ausgeblendet und kann nicht in eine Volumeschattenkopie eingefügt werden.</span><span class="sxs-lookup"><span data-stu-id="fe077-172">On computers that use the Extended Firmware Interface (EFI), the EFI System Partition (ESP) is always hidden and cannot be included in a volume shadow copy.</span></span> <span data-ttu-id="fe077-173">Der Anforderer muss den Inhalt dieser Partition sichern.</span><span class="sxs-lookup"><span data-stu-id="fe077-173">The requester must back up the contents of this partition.</span></span> <span data-ttu-id="fe077-174">Da diese Partition nicht in eine Volumeschattenkopie eingeschlossen werden kann, kann die Sicherung nur über das Live Volume und nicht über die Schatten Kopie ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="fe077-174">Because this partition cannot be included in a volume shadow copy, the backup can only be performed from the live volume, not from the shadow copy.</span></span> <span data-ttu-id="fe077-175">Weitere Informationen zu EFI und ESP finden Sie im [Leitfaden zur Einführung](/windows-hardware/drivers/bringup/).</span><span class="sxs-lookup"><span data-stu-id="fe077-175">For more information about EFI and ESP, see [Bring up guide](/windows-hardware/drivers/bringup/).</span></span>

<span data-ttu-id="fe077-176">Die Komponentennamen verwenden die folgenden Formate:</span><span class="sxs-lookup"><span data-stu-id="fe077-176">The component names use the following formats:</span></span>

-   <span data-ttu-id="fe077-177">Für Datenträger Komponenten lautet das Format</span><span class="sxs-lookup"><span data-stu-id="fe077-177">For disk components, the format is</span></span>

    <COMPONENT logicalPath="Disks" componentName="harddisk*n*" componentType="filegroup" />

    <span data-ttu-id="fe077-178">Dabei steht *n* für die Datenträger Nummer.</span><span class="sxs-lookup"><span data-stu-id="fe077-178">where *n* is the disk number.</span></span> <span data-ttu-id="fe077-179">Nur die Datenträger Nummer wird aufgezeichnet.</span><span class="sxs-lookup"><span data-stu-id="fe077-179">Only the disk number is recorded.</span></span> <span data-ttu-id="fe077-180">Um die Datenträger Nummer zu erhalten, verwenden Sie den [**IOCTL- \_ Speicher \_ \_ Geräte \_ Nummer**](/windows/win32/api/winioctl/ni-winioctl-ioctl_storage_get_device_number) -Steuerungs Code.</span><span class="sxs-lookup"><span data-stu-id="fe077-180">To get the disk number, use the [**IOCTL\_STORAGE\_GET\_DEVICE\_NUMBER**](/windows/win32/api/winioctl/ni-winioctl-ioctl_storage_get_device_number) control code.</span></span>

-   <span data-ttu-id="fe077-181">Bei volumekomponenten lautet das Format</span><span class="sxs-lookup"><span data-stu-id="fe077-181">For volume components, the format is</span></span>

    <COMPONENT logicalPath="Volumes" componentName="Volume{*GUID*}" componentType="filegroup" />

    <span data-ttu-id="fe077-182">Dabei ist *GUID* die Volume-GUID.</span><span class="sxs-lookup"><span data-stu-id="fe077-182">where *GUID* is the volume GUID.</span></span>

-   <span data-ttu-id="fe077-183">Für die BCD-Speicherkomponente lautet das Format.</span><span class="sxs-lookup"><span data-stu-id="fe077-183">For the BCD store component, the format is</span></span>

    <COMPONENT logicalPath="BCD" componentName="BCD" componentType="filegroup" componentCaption = "This is the path to the boot BCD store and the boot managers...All the files in this directory need to be backed up...">

    <span data-ttu-id="fe077-184">Wenn die Systempartition einen VolumeGuid-Namen aufweist, kann diese Komponente ausgewählt werden.</span><span class="sxs-lookup"><span data-stu-id="fe077-184">If the system partition has a volume GUID name, this component is selectable.</span></span> <span data-ttu-id="fe077-185">Andernfalls ist Sie nicht auswählbar.</span><span class="sxs-lookup"><span data-stu-id="fe077-185">Otherwise, it is not selectable.</span></span>

    > [!Note]  
    > <span data-ttu-id="fe077-186">ASR fügt die Dateien der Datei Gruppe der BCD-Speicherkomponente wie folgt hinzu:</span><span class="sxs-lookup"><span data-stu-id="fe077-186">ASR adds the files to the BCD store component's file group as follows:</span></span>
    >
    > -   <span data-ttu-id="fe077-187">Bei EFI-Datenträgern fügt ASR</span><span class="sxs-lookup"><span data-stu-id="fe077-187">For EFI disks, ASR adds</span></span>
    >
    >     <span data-ttu-id="fe077-188">*Systempartitionpath* \\ EFI \\ Microsoft- \\ Start \\ \* .\*</span><span class="sxs-lookup"><span data-stu-id="fe077-188">*SystemPartitionPath*\\EFI\\Microsoft\\Boot\\\*.\*</span></span>
    >
    >     <span data-ttu-id="fe077-189">Dabei ist " *systempartitionpath* " der Pfad zur Systempartition.</span><span class="sxs-lookup"><span data-stu-id="fe077-189">where *SystemPartitionPath* is the path to the system partition.</span></span>
    >
    > -   <span data-ttu-id="fe077-190">Für GPT-Datenträger fügt ASR</span><span class="sxs-lookup"><span data-stu-id="fe077-190">For GPT disks, ASR adds</span></span>
    >
    >     <span data-ttu-id="fe077-191">*Systempartitionpath* \\ Starten \\ \* .\*</span><span class="sxs-lookup"><span data-stu-id="fe077-191">*SystemPartitionPath*\\Boot\\\*.\*</span></span>
    >
    >     <span data-ttu-id="fe077-192">Dabei ist " *systempartitionpath* " der Pfad zur Systempartition.</span><span class="sxs-lookup"><span data-stu-id="fe077-192">where *SystemPartitionPath* is the path to the system partition.</span></span>
    >
    > -   <span data-ttu-id="fe077-193">Der Pfad der Systempartition befindet sich unter dem folgenden Registrierungsschlüssel: **HKEY \_ local \_ Machine** \\ **System** \\ **Setup** \\ **Systempartition** .</span><span class="sxs-lookup"><span data-stu-id="fe077-193">The system partition path can be found under the following registry key: **HKEY\_LOCAL\_MACHINE**\\**System**\\**Setup**\\**SystemPartition**</span></span>

     

<span data-ttu-id="fe077-194">Bei der Wiederherstellung müssen alle Komponenten, die als kritische Volumes gekennzeichnet sind, wieder hergestellt werden.</span><span class="sxs-lookup"><span data-stu-id="fe077-194">On restore, all components that are marked as critical volumes must be restored.</span></span> <span data-ttu-id="fe077-195">Wenn ein oder mehrere kritische Volumes nicht wieder hergestellt werden können, kann der Wiederherstellungs Vorgang nicht ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="fe077-195">If one or more critical volumes cannot be restored, the restore operation fails.</span></span>

<span data-ttu-id="fe077-196">In der [**vorab**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) Version der Wiederherstellungs Sequenz werden Datenträger, die während der Sicherung nicht ausgeschlossen wurden, neu erstellt und standardmäßig neu formatiert.</span><span class="sxs-lookup"><span data-stu-id="fe077-196">In the [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) phase of the restore sequence, disks that were not excluded during backup are re-created and reformatted by default.</span></span> <span data-ttu-id="fe077-197">Sie werden jedoch nicht neu erstellt oder neu formatiert, wenn Sie die folgenden Bedingungen erfüllen:</span><span class="sxs-lookup"><span data-stu-id="fe077-197">However, they are not re-created or reformatted if they meet the following conditions:</span></span>

-   <span data-ttu-id="fe077-198">Ein Basis Datenträger wird nicht neu erstellt, wenn das Datenträger Layout intakt ist oder nur Additive Änderungen vorgenommen wurden.</span><span class="sxs-lookup"><span data-stu-id="fe077-198">A basic disk is not re-created if its disk layout is intact or only additive changes have been made to it.</span></span> <span data-ttu-id="fe077-199">Das Datenträger Layout ist intakt, wenn die folgenden Bedingungen zutreffen:</span><span class="sxs-lookup"><span data-stu-id="fe077-199">The disk layout is intact if the following conditions are true:</span></span>
    -   <span data-ttu-id="fe077-200">Die Datenträger Signatur, der Datenträger Stil (GPT oder MBR), die logische Sektorgröße und der Offset des volumestarts werden nicht geändert.</span><span class="sxs-lookup"><span data-stu-id="fe077-200">The disk signature, disk style (GPT or MBR), logical sector size, and volume start offset are not changed.</span></span>
    -   <span data-ttu-id="fe077-201">Die Volumegröße wird nicht gesenkt.</span><span class="sxs-lookup"><span data-stu-id="fe077-201">The volume size is not decreased.</span></span>
    -   <span data-ttu-id="fe077-202">Für GPT-Datenträger wird der Partitions Bezeichner nicht geändert.</span><span class="sxs-lookup"><span data-stu-id="fe077-202">For GPT disks, the partition identifier is not changed.</span></span>
-   <span data-ttu-id="fe077-203">Ein dynamischer Datenträger wird nicht neu erstellt, wenn das Datenträger Layout intakt ist oder nur Additive Änderungen vorgenommen wurden.</span><span class="sxs-lookup"><span data-stu-id="fe077-203">A dynamic disk is not re-created if its disk layout is intact or only additive changes have been made to it.</span></span> <span data-ttu-id="fe077-204">Damit ein dynamischer Datenträger intakt ist, müssen alle Bedingungen für eine Basis Festplatte erfüllt werden.</span><span class="sxs-lookup"><span data-stu-id="fe077-204">For a dynamic disk to be intact, all of the conditions for a basic disk must be met.</span></span> <span data-ttu-id="fe077-205">Außerdem muss die Volumestruktur des gesamten Datenträger Pakets intakt sein.</span><span class="sxs-lookup"><span data-stu-id="fe077-205">In addition, the entire disk pack's volume structure must be intact.</span></span> <span data-ttu-id="fe077-206">Die Volumestruktur des Datenträger Pakets ist intakt, wenn die folgenden Bedingungen erfüllt sind, die für MBR-und GPT-Datenträger gelten:</span><span class="sxs-lookup"><span data-stu-id="fe077-206">The disk pack's volume structure is intact if it meets the following conditions, which apply to both MBR and GPT disks:</span></span>
    -   <span data-ttu-id="fe077-207">Die Anzahl der Volumes, die während der Wiederherstellung im physischen Paket verfügbar sind, muss größer oder gleich der Anzahl der Volumes sein, die während der Sicherung in den ASR Writer-Metadaten angegeben wurden.</span><span class="sxs-lookup"><span data-stu-id="fe077-207">The number of volumes that are available in the physical pack during restore must be greater than or equal to the number of volumes that were specified in the ASR writer metadata during backup.</span></span>
    -   <span data-ttu-id="fe077-208">Die Anzahl von [*plexes*](../vds/virtual-disk-service-glossary-all.md) pro Volume muss unverändert bleiben.</span><span class="sxs-lookup"><span data-stu-id="fe077-208">The number of [*plexes*](../vds/virtual-disk-service-glossary-all.md) per volume must be unchanged.</span></span>
    -   <span data-ttu-id="fe077-209">Die Anzahl der [*Elemente muss unverändert*](../vds/virtual-disk-service-glossary-all.md) bleiben.</span><span class="sxs-lookup"><span data-stu-id="fe077-209">The number of [*members*](../vds/virtual-disk-service-glossary-all.md) must be unchanged.</span></span>
    -   <span data-ttu-id="fe077-210">Die Anzahl der Werte für den physischen Datenträger muss größer sein als die Anzahl der in den ASR Writer-Metadaten angegebenen Datenträger Blöcke.</span><span class="sxs-lookup"><span data-stu-id="fe077-210">The number of physical disk extents must be greater than the number of disk extents specified in the ASR writer metadata.</span></span>
    -   <span data-ttu-id="fe077-211">Ein intaktes Paket bleibt intakt, wenn zusätzliche Volumes hinzugefügt werden, oder wenn ein Volume im Paket erweitert wird (z. b. von einem einfachen Volume zu einem übergreifenden Volume).</span><span class="sxs-lookup"><span data-stu-id="fe077-211">An intact pack remains intact when additional volumes are added, or if a volume in the pack is extended (for example, from a simple volume to a spanned volume).</span></span>
        > [!Note]  
        > <span data-ttu-id="fe077-212">Wenn ein einfaches Volume gespiegelt wird, ist das Paket nicht intakt und wird neu erstellt, um sicherzustellen, dass der Status von BCD und Start Volume nach der Wiederherstellung konsistent bleibt.</span><span class="sxs-lookup"><span data-stu-id="fe077-212">If a simple volume is mirrored, the pack is not intact and will be re-created to ensure that the BCD and boot volume state remain consistent after restore.</span></span> <span data-ttu-id="fe077-213">Wenn Volumes gelöscht werden, wird das Paket neu erstellt.</span><span class="sxs-lookup"><span data-stu-id="fe077-213">If volumes are deleted, the pack is re-created.</span></span>

         
-   <span data-ttu-id="fe077-214">Wenn die Volumestruktur des dynamischen Datenträger Pakets intakt ist und nur Additive Änderungen vorgenommen wurden, werden die Datenträger im Paket nicht neu erstellt.</span><span class="sxs-lookup"><span data-stu-id="fe077-214">If the dynamic disk pack's volume structure is intact and only additive changes have been made to it, the disks in the pack are not re-created.</span></span>

    <span data-ttu-id="fe077-215">**Windows Vista:** Dynamische Datenträger werden immer neu erstellt.</span><span class="sxs-lookup"><span data-stu-id="fe077-215">**Windows Vista:** Dynamic disks are always re-created.</span></span> <span data-ttu-id="fe077-216">Beachten Sie, dass sich dieses Verhalten in Windows Server 2008 und Windows Vista mit Service Pack 1 (SP1) geändert hat.</span><span class="sxs-lookup"><span data-stu-id="fe077-216">Note that this behavior has changed with Windows Server 2008 and Windows Vista with Service Pack 1 (SP1).</span></span>

<span data-ttu-id="fe077-217">Der Anforderer kann zu einem beliebigen Zeitpunkt vor Beginn der Wiederherstellungs Phase festlegen, dass die Datenträger schnell formatiert werden sollen, indem Sie den Registrierungsschlüssel **HKEY \_ local \_ Machine** \\ **Software** \\ **Microsoft** \\ **Windows NT** \\ **CurrentVersion** \\ **ASR** \\ **restoresession** festlegen.</span><span class="sxs-lookup"><span data-stu-id="fe077-217">At any time before the beginning of the restore phase, the requester can specify that the disks should be quick-formatted by setting the **HKEY\_LOCAL\_MACHINE**\\**SOFTWARE**\\**Microsoft**\\**Windows NT**\\**CurrentVersion**\\**ASR**\\**RestoreSession** registry key.</span></span> <span data-ttu-id="fe077-218">Unter diesem Schlüssel ist ein Wert mit dem Namen " **Quick Format** " mit dem Datentyp "reg \_ DWORD" vorhanden.</span><span class="sxs-lookup"><span data-stu-id="fe077-218">Under this key, there is a value named **QuickFormat** with the data type REG\_DWORD.</span></span> <span data-ttu-id="fe077-219">Wenn dieser Wert nicht vorhanden ist, sollten Sie ihn erstellen.</span><span class="sxs-lookup"><span data-stu-id="fe077-219">If this value does not exist, you should create it.</span></span> <span data-ttu-id="fe077-220">Legen Sie für die schnelle Formatierung die Daten des **QuickFormat** -Werts auf 1 und für eine langsame Formatierung den Wert 0 fest.</span><span class="sxs-lookup"><span data-stu-id="fe077-220">Set the data of the **QuickFormat** value to 1 for quick formatting or 0 for slow formatting.</span></span>

<span data-ttu-id="fe077-221">Wenn der **QuickFormat** -Wert nicht vorhanden ist, werden die Datenträger langsam formatiert.</span><span class="sxs-lookup"><span data-stu-id="fe077-221">If the **QuickFormat** value does not exist, the disks will be slow-formatted.</span></span>

<span data-ttu-id="fe077-222">Die schnelle Formatierung ist erheblich schneller als eine langsame Formatierung (auch als vollständige Formatierung bezeichnet).</span><span class="sxs-lookup"><span data-stu-id="fe077-222">Quick formatting is significantly faster than slow formatting (also called full formatting).</span></span> <span data-ttu-id="fe077-223">Bei der schnellen Formatierung werden die einzelnen Sektoren auf dem Volume jedoch nicht überprüft.</span><span class="sxs-lookup"><span data-stu-id="fe077-223">However, quick formatting does not verify each sector on the volume.</span></span>

## <a name="overview-of-restore-phase-tasks"></a><span data-ttu-id="fe077-224">Übersicht über Wiederherstellungs Phasen Tasks</span><span class="sxs-lookup"><span data-stu-id="fe077-224">Overview of Restore Phase Tasks</span></span>

<span data-ttu-id="fe077-225">Zum Zeitpunkt der Wiederherstellung führt der Anforderer die folgenden Schritte aus:</span><span class="sxs-lookup"><span data-stu-id="fe077-225">At restore time, the requester performs the following steps:</span></span>

> [!Note]  
> <span data-ttu-id="fe077-226">Alle Schritte sind erforderlich, sofern nicht anders angegeben.</span><span class="sxs-lookup"><span data-stu-id="fe077-226">All steps are required unless otherwise indicated.</span></span>

 

1.  <span data-ttu-id="fe077-227">Rufen Sie die Funktion " [**foratevssbackupcomponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents) " auf, um eine Instanz der [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) -Schnittstelle zu erstellen und die [**IVssBackupComponents:: initializeforrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore) -Methode aufzurufen, um die Instanz für die Wiederherstellung zu initialisieren, indem Sie das Dokument mit den Sicherungs Komponenten der Anforderer</span><span class="sxs-lookup"><span data-stu-id="fe077-227">Call the [**CreateVssBackupComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents) function to create an instance of the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface and call the [**IVssBackupComponents::InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore) method to initialize the instance for restore by loading the requester's Backup Components Document into the instance.</span></span>
2.  <span data-ttu-id="fe077-228">\[Dieser Schritt ist nur erforderlich, wenn die anfordernde Person ändern muss, ob "includdisk" oder "exclutodisk" für einen oder mehrere Datenträger angegeben ist. \] Nennen Sie [**IVssBackupComponents:: setrestoreoptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions) , um die Wiederherstellungsoptionen für die ASR Writer-Komponenten festzulegen.</span><span class="sxs-lookup"><span data-stu-id="fe077-228">\[This step is required only if the requester needs to change whether "IncludeDisk" or "ExcludeDisk" is specified for one or more disks.\] Call [**IVssBackupComponents::SetRestoreOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions) to set the restore options for the ASR writer components.</span></span> <span data-ttu-id="fe077-229">Der ASR Writer unterstützt die folgenden Optionen: "includedisk" ermöglicht dem Anforderer, einen Datenträger auf dem Zielsystem aufzunehmen, der für die Wiederherstellung berücksichtigt werden soll, auch wenn er während der Sicherungs Phase nicht ausgewählt wurde.</span><span class="sxs-lookup"><span data-stu-id="fe077-229">The ASR writer supports the following options: "IncludeDisk" allows the requester to include a disk on the target system to be considered for restore, even if it was not selected during the backup phase.</span></span> <span data-ttu-id="fe077-230">Mithilfe von "excludedisk" kann der Anforderer verhindern, dass ein Datenträger auf dem Zielsystem neu erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="fe077-230">"ExcludeDisk" allows the requester to prevent a disk on the target system from being re-created.</span></span> <span data-ttu-id="fe077-231">Beachten Sie Folgendes: Wenn für einen Datenträger mit einem wichtigen Volume "excludedisk" angegeben wird, tritt beim nachfolgenden Aufrufen von [**IVssBackupComponents::P**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) erneute Ausführung ein Fehler auf.</span><span class="sxs-lookup"><span data-stu-id="fe077-231">Note that if "ExcludeDisk" is specified for a disk that contains a critical volume, the subsequent call to [**IVssBackupComponents::PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) will fail.</span></span>

    <span data-ttu-id="fe077-232">Im folgenden Beispiel wird gezeigt, wie Sie mithilfe von "" [**mithilfe von "**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions) " mithilfe von "" die Datenträger 0 und Disk 1 neu erstellen und Treiber von Drittanbietern in das wiederhergestellte Start Volume einfügen können.</span><span class="sxs-lookup"><span data-stu-id="fe077-232">The following example shows how to use [**SetRestoreOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions) to prevent disk 0 and disk 1 from being re-created and inject third-party drivers into the restored boot volume.</span></span>

    <span data-ttu-id="fe077-233">**Windows Server 2008, Windows Vista, Windows Server 2003 und Windows XP:** Die Injektion von Drittanbieter Treibern wird nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="fe077-233">**Windows Server 2008, Windows Vista, Windows Server 2003 and Windows XP:** Injection of third-party drivers is not supported.</span></span>

    <span data-ttu-id="fe077-234">Im Beispiel wird davon ausgegangen, dass der [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) -Zeiger "m \_ pbackupcomponents" gültig ist.</span><span class="sxs-lookup"><span data-stu-id="fe077-234">The example assumes that the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) pointer, m\_pBackupComponents, is valid.</span></span>

    ```C++
        m_pBackupComponents->SetRestoreOptions(
            AsrWriterId,
            VSS_CT_FILEGROUP,
            NULL,
            TEXT("ASR"),
            TEXT("\"ExcludeDisk\"=\"0\", \"ExcludeDisk\"=\"1\" "),
            TEXT("\"InjectDrivers\"=\"1\" ")
            );
    ```

    

    <span data-ttu-id="fe077-235">Informationen zum Ausschließen aller Datenträger für ein angegebenes Volume finden Sie im folgenden "Ausschließen aller Datenträger für ein Volume".</span><span class="sxs-lookup"><span data-stu-id="fe077-235">To exclude all disks for a specified volume, see the following "Excluding All Disks for a Volume."</span></span>

3.  <span data-ttu-id="fe077-236">Aufrufen von [**IVssBackupComponents::P erneut ausführen**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) , um den ASR-Writer zu benachrichtigen, dass ein Wiederherstellungs Vorgang vorbereitet werden soll.</span><span class="sxs-lookup"><span data-stu-id="fe077-236">Call [**IVssBackupComponents::PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) to notify the ASR writer to prepare for a restore operation.</span></span> <span data-ttu-id="fe077-237">Nennen Sie [**IVssAsync:: QueryStatus**](/windows/desktop/api/Vss/nf-vss-ivssasync-querystatus) so oft wie nötig, bis der Statuswert, der im *phrresult* -Parameter zurückgegeben wird, nicht "VSS" \_ \_ Async \_ Pending ist.</span><span class="sxs-lookup"><span data-stu-id="fe077-237">Call [**IVssAsync::QueryStatus**](/windows/desktop/api/Vss/nf-vss-ivssasync-querystatus) as many times as necessary until the status value returned in the *pHrResult* parameter is not VSS\_S\_ASYNC\_PENDING.</span></span>
4.  <span data-ttu-id="fe077-238">Stellen Sie die Daten wieder her.</span><span class="sxs-lookup"><span data-stu-id="fe077-238">Restore the data.</span></span> <span data-ttu-id="fe077-239">In der Wiederherstellungs Phase konfiguriert ASR den Volume-GUID-Pfad neu ( \\ \\ ? \\ Volume {GUID}) für jedes Volume, das dem Volume-GUID-Pfad entspricht, der während der Sicherungs Phase verwendet wurde.</span><span class="sxs-lookup"><span data-stu-id="fe077-239">In the restore phase, ASR reconfigures the volume GUID path (\\\\?\\Volume{GUID}) for each volume to match the volume GUID path that was used during the backup phase.</span></span> <span data-ttu-id="fe077-240">Laufwerk Buchstaben werden jedoch nicht beibehalten, da dies Konflikte mit den Laufwerk Buchstaben verursachen würde, die automatisch in der Wiederherstellungs Umgebung zugewiesen werden.</span><span class="sxs-lookup"><span data-stu-id="fe077-240">However, drive letters are not preserved, because this would cause collisions with the drive letters that are automatically assigned in the recovery environment.</span></span> <span data-ttu-id="fe077-241">Daher muss die anfordernde Person beim Wiederherstellen von Daten VolumeGuid-Pfade und nicht Laufwerk Buchstaben verwenden, um auf die Volumes zuzugreifen.</span><span class="sxs-lookup"><span data-stu-id="fe077-241">Thus, when restoring data, the requester must use volume GUID paths, not drive letters, to access the volumes.</span></span>
5.  <span data-ttu-id="fe077-242">Legen Sie den Registrierungsschlüssel " **HKLM** \\ **Software** \\ **Microsoft** \\ **Windows NT** \\ **CurrentVersion** \\ **ASR** \\ **restoresession** " fest, um die Gruppe von Volumes anzugeben, die wieder hergestellt oder neu formatiert wurden.</span><span class="sxs-lookup"><span data-stu-id="fe077-242">Set the **HKLM**\\**SOFTWARE**\\**Microsoft**\\**Windows NT**\\**CurrentVersion**\\**ASR**\\**RestoreSession** registry key to indicate the set of volumes that have been restored or reformatted.</span></span>

    <span data-ttu-id="fe077-243">Unter diesem Schlüssel ist ein Wert mit dem Namen **restoredvolumes** mit dem Datentyp reg \_ \_ MultiSZ vorhanden.</span><span class="sxs-lookup"><span data-stu-id="fe077-243">Under this key, there is a value named **RestoredVolumes** with the data type REG\_MULTI\_SZ.</span></span> <span data-ttu-id="fe077-244">Wenn dieser Wert nicht vorhanden ist, sollten Sie ihn erstellen.</span><span class="sxs-lookup"><span data-stu-id="fe077-244">If this value does not exist, you should create it.</span></span> <span data-ttu-id="fe077-245">Unter diesem Wert sollte der Anforderer einen VolumeGuid-Eintrag für jedes wiederhergestellte Volume erstellen.</span><span class="sxs-lookup"><span data-stu-id="fe077-245">Under this value, your requester should create a volume GUID entry for each volume that has been restored.</span></span> <span data-ttu-id="fe077-246">Dieser Eintrag sollte das folgende Format \\ aufweisen: \\ \\ Volume {78618c8a-aefd-11da-a898-806e6f 6e6963}.</span><span class="sxs-lookup"><span data-stu-id="fe077-246">This entry should be in the following format: \\\\?\\Volume{78618c8f-aefd-11da-a898-806e6f6e6963}.</span></span> <span data-ttu-id="fe077-247">Bei jeder Durchführung einer Bare-Metal-Wiederherstellung legt ASR den Wert **restoredvolumes** auf den Satz von Volumes fest, die von ASR wieder hergestellt wurden.</span><span class="sxs-lookup"><span data-stu-id="fe077-247">Each time a bare-metal recovery is performed, ASR sets the **RestoredVolumes** value to the set of volumes that ASR restored.</span></span> <span data-ttu-id="fe077-248">Wenn die anfordernde Person zusätzliche Volumes wieder hergestellt hat, sollte Sie diesen Wert auf die Gesamtmenge der Volumes festlegen, die der Anforderer wieder hergestellt hat, sowie auf die Menge der Volumes, die von ASR wieder hergestellt wurden.</span><span class="sxs-lookup"><span data-stu-id="fe077-248">If the requester restored additional volumes, it should set this value to the union of the set of volumes that the requester restored and the set of volumes that ASR restored.</span></span> <span data-ttu-id="fe077-249">Wenn der Anforderer nicht ASR verwendet hat, sollte er die Liste der Volumes ersetzen.</span><span class="sxs-lookup"><span data-stu-id="fe077-249">If the requester did not use ASR, it should replace the list of volumes.</span></span>

    <span data-ttu-id="fe077-250">Sie sollten auch einen Wert mit dem Namen **LastInstance** mit dem Datentyp reg \_ SZ erstellen.</span><span class="sxs-lookup"><span data-stu-id="fe077-250">You should also create a value named **LastInstance** with the data type REG\_SZ.</span></span> <span data-ttu-id="fe077-251">Dieser Schlüssel sollte ein zufälliges Cookie enthalten, das den aktuellen Wiederherstellungs Vorgang eindeutig identifiziert.</span><span class="sxs-lookup"><span data-stu-id="fe077-251">This key should contain a random cookie that uniquely identifies the current restore operation.</span></span> <span data-ttu-id="fe077-252">Ein solches Cookie kann mit den Funktionen [**uuidcreate**](/windows/win32/api/rpcdce/nf-rpcdce-uuidcreate) und [**uuiddestring**](/windows/win32/api/rpcdce/nf-rpcdce-uuidtostring) erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="fe077-252">Such a cookie can be created by using the [**UuidCreate**](/windows/win32/api/rpcdce/nf-rpcdce-uuidcreate) and [**UuidToString**](/windows/win32/api/rpcdce/nf-rpcdce-uuidtostring) functions.</span></span> <span data-ttu-id="fe077-253">Jedes Mal, wenn eine Bare-Metal-Wiederherstellung durchgeführt wird, setzt ASR diesen Registrierungs Wert zurück, um Anforderer und nicht-VSS-Sicherungs Anwendungen zu benachrichtigen, dass die Wiederherstellung erfolgt ist.</span><span class="sxs-lookup"><span data-stu-id="fe077-253">Each time a bare-metal recovery is performed, ASR resets this registry value to notify requesters and non-VSS backup applications that the recovery has occurred.</span></span>

6.  <span data-ttu-id="fe077-254">Nennen Sie [**IVssBackupComponents::P ostrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) , um das Ende des Wiederherstellungs Vorgangs anzugeben.</span><span class="sxs-lookup"><span data-stu-id="fe077-254">Call [**IVssBackupComponents::PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) to indicate the end of the restore operation.</span></span> <span data-ttu-id="fe077-255">Nennen Sie [**IVssAsync:: QueryStatus**](/windows/desktop/api/Vss/nf-vss-ivssasync-querystatus) so oft wie nötig, bis der Statuswert, der im *phrresult* -Parameter zurückgegeben wird, nicht "VSS" \_ \_ Async \_ Pending ist.</span><span class="sxs-lookup"><span data-stu-id="fe077-255">Call [**IVssAsync::QueryStatus**](/windows/desktop/api/Vss/nf-vss-ivssasync-querystatus) as many times as necessary until the status value returned in the *pHrResult* parameter is not VSS\_S\_ASYNC\_PENDING.</span></span>

<span data-ttu-id="fe077-256">In der Wiederherstellungs Phase kann ASR Partitionen erstellen oder entfernen, um den Computer in seinem vorherigen Zustand wiederherzustellen.</span><span class="sxs-lookup"><span data-stu-id="fe077-256">In the restore phase, ASR may create or remove partitions to restore the computer to its previous state.</span></span> <span data-ttu-id="fe077-257">Anforderer darf nicht versuchen, Datenträger Nummern aus der Sicherungs Phase der Wiederherstellungs Phase zuzuordnen.</span><span class="sxs-lookup"><span data-stu-id="fe077-257">Requesters must not attempt to map disk numbers from the backup phase to the restore phase.</span></span>

<span data-ttu-id="fe077-258">Bei der Wiederherstellung muss der Anforderer den Datenträger ausschließen, der den Sicherungs Satz des Anforderers enthält.</span><span class="sxs-lookup"><span data-stu-id="fe077-258">On restore, the requester must exclude the disk that contains the requester's backup set.</span></span> <span data-ttu-id="fe077-259">Andernfalls kann der Sicherungs Satz durch den Wiederherstellungs Vorgang überschrieben werden.</span><span class="sxs-lookup"><span data-stu-id="fe077-259">Otherwise, the backup set can be overwritten by the restore operation.</span></span>

<span data-ttu-id="fe077-260">Bei der Wiederherstellung wird ein Datenträger ausgeschlossen, wenn er während der Sicherung nicht als Komponente ausgewählt wurde, oder wenn er durch den Aufruf von [**IVssBackupComponents:: abtrestoreoptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions) mit der Option "excludedisk" während der Wiederherstellung explizit ausgeschlossen wird.</span><span class="sxs-lookup"><span data-stu-id="fe077-260">On restore, a disk is excluded if it was not selected as a component during backup, or if it is explicitly excluded by calling [**IVssBackupComponents::SetRestoreOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions) with the "ExcludeDisk" option during restore.</span></span>

<span data-ttu-id="fe077-261">Beachten Sie, dass während der WinPE-Notfall Wiederherstellung die ASR Writer-Funktionalität vorhanden ist, aber keine anderen Writer verfügbar sind und der VSS-Dienst nicht ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="fe077-261">It is important to note that during WinPE disaster recovery, ASR writer functionality is present, but no other writers are available, and the VSS service is not running.</span></span> <span data-ttu-id="fe077-262">Nachdem die WinPE-Notfall Wiederherstellung abgeschlossen wurde, wurde der Computer neu gestartet, und das Windows-Betriebssystem wird normal ausgeführt. der VSS-Dienst kann gestartet werden, und der Anforderer kann alle zusätzlichen Wiederherstellungs Vorgänge durchführen, die eine Teilnahme an anderen Writern als ASR Writer erfordern.</span><span class="sxs-lookup"><span data-stu-id="fe077-262">After WinPE disaster recovery has completed, the computer has restarted, and the Windows operating system is running normally, the VSS service can be started, and the requester can perform any additional restore operations that require participation of writers other than the ASR writer.</span></span>

<span data-ttu-id="fe077-263">Wenn während der Wiederherstellungs Sitzung von der Sicherungs Anwendung erkannt wird, dass die eindeutigen Volume-IDs unverändert bleiben und daher alle Volumes ab dem Zeitpunkt der Sicherung vorhanden und intakt sind, kann die Sicherungs Anwendung mit der Wiederherstellung des Inhalts der Volumes fortfahren, ohne ASR zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="fe077-263">If during the restore session the backup application detects that the volume unique IDs are unchanged, and therefore all volumes from the time of the backup are present and intact in WinPE, the backup application can proceed to restore only the contents of the volumes, without involving ASR.</span></span> <span data-ttu-id="fe077-264">In diesem Fall sollte die Sicherungs Anwendung angeben, dass der Computer wieder hergestellt wurde, indem der folgende Registrierungsschlüssel im wiederhergestellten Betriebssystem festgelegt wird: **HKEY \_ local \_ Machine** \\ **Software** \\ **Microsoft** \\ **Windows NT** \\ **CurrentVersion** \\ **ASR** \\ **restoresession**</span><span class="sxs-lookup"><span data-stu-id="fe077-264">In this case, the backup application should indicate that the computer was restored by setting the following registry key in the restored operating system: **HKEY\_LOCAL\_MACHINE**\\**SOFTWARE**\\**Microsoft**\\**Windows NT**\\**CurrentVersion**\\**ASR**\\**RestoreSession**</span></span>

<span data-ttu-id="fe077-265">Geben Sie unter diesem Schlüssel **LastInstance** als Wert Name, reg \_ SZ für den Werttyp und ein zufälliges Cookie (z. b. eine GUID, die von der [**uuidcreate**](/windows/win32/api/rpcdce/nf-rpcdce-uuidcreate) -Funktion erstellt wurde) für die Wertdaten an.</span><span class="sxs-lookup"><span data-stu-id="fe077-265">Under this key, specify **LastInstance** for the value name, REG\_SZ for the value type, and a random cookie (such as a GUID created by the [**UuidCreate**](/windows/win32/api/rpcdce/nf-rpcdce-uuidcreate) function) for the value data.</span></span>

<span data-ttu-id="fe077-266">Wenn während der Wiederherstellungs Sitzung von der Sicherungs Anwendung erkannt wird, dass ein oder mehrere Volumes geändert werden oder fehlen, sollte die Sicherungs Anwendung ASR zum Durchführen der Wiederherstellung verwenden.</span><span class="sxs-lookup"><span data-stu-id="fe077-266">If during the restore session the backup application detects that one or more volumes are changed or missing, the backup application should use ASR to perform the restore.</span></span> <span data-ttu-id="fe077-267">ASR erstellt die Volumes genauso wie zum Zeitpunkt der Sicherung neu und legt den Registrierungsschlüssel **restoresession** fest.</span><span class="sxs-lookup"><span data-stu-id="fe077-267">ASR will re-create the volumes exactly the way they were at the time of the backup and set the **RestoreSession** registry key.</span></span>

## <a name="excluding-all-disks-for-a-volume"></a><span data-ttu-id="fe077-268">Ausschließen aller Datenträger für ein Volume</span><span class="sxs-lookup"><span data-stu-id="fe077-268">Excluding All Disks for a Volume</span></span>

<span data-ttu-id="fe077-269">Im folgenden Beispiel wird gezeigt, wie alle Datenträger für ein bestimmtes Volume ausgeschlossen werden.</span><span class="sxs-lookup"><span data-stu-id="fe077-269">The following example shows how to exclude all disks for a specified volume.</span></span>


```C++
HRESULT BuildRestoreOptionString
(
    const WCHAR             *pwszVolumeNamePath,
    CMyString               *pstrExclusionList
)
{
    HANDLE                  hVolume           = INVALID_HANDLE_VALUE;
    DWORD                   cbSize            = 0;
    VOLUME_DISK_EXTENTS     * pExtents        = NULL;
    DISK_EXTENT             * pExtent         = NULL;
    ULONG                   i                 = 0;
    BOOL                    fIoRet            = FALSE;
    WCHAR                   wszDest[MAX_PATH] = L"";
    CMyString               strVolumeName;
    CMyString               strRestoreOption;

    // Open a handle to the volume device.
    strVolumeName.Set( pwszVolumeNamePath );
    // If the volume name contains a trailing backslash, remove it.
    strVolumeName.UnTrailing( L'\\' );
    hVolume = ::CreateFile(strVolumeName, 0, FILE_SHARE_READ | FILE_SHARE_WRITE, NULL, OPEN_EXISTING, NULL, 0);
    // Check whether the call to CreateFile succeeded.

    // Get the list of disks used by this volume.
    cbSize = sizeof(VOLUME_DISK_EXTENTS);
    pExtents = (VOLUME_DISK_EXTENTS *)::CoTaskMemAlloc(cbSize);

    ::ZeroMemory(pExtents, cbSize);

    fIoRet = ::DeviceIoControl(hVolume, IOCTL_VOLUME_GET_VOLUME_DISK_EXTENTS, NULL, 0, pExtents, cbSize, &cbSize, 0);
    if ( !fIoRet && GetLastError() == ERROR_MORE_DATA )
    {
        // Allocate more memory.
        cbSize = FIELD_OFFSET(VOLUME_DISK_EXTENTS, Extents) + pExtents->NumberOfDiskExtents * sizeof(DISK_EXTENT);
        ::CoTaskMemFree(pExtents);
        pExtents = NULL;

        pExtents = (VOLUME_DISK_EXTENTS *) ::CoTaskMemAlloc(cbSize);
        // Check whether CoTaskMemAlloc returned an out-of-memory error.
        ::ZeroMemory(pExtents, cbSize);

        // Now the buffer should be big enough.
        ::DeviceIoControl(hVolume, IOCTL_VOLUME_GET_VOLUME_DISK_EXTENTS, NULL, 0, pExtents, cbSize, &cbSize, 0);
        // Check whether the IOCTL succeeded.
    }
    // Check for errors; note that the IOCTL can fail for a reason other than insufficient memory.

    // For each disk, mark it to be excluded in the Restore Option string.
    for (i = 0; i < pExtents->NumberOfDiskExtents; i++)
    {
        pExtent = &pExtents->Extents[i];

        *wszDest = L'\0';
        StringCchPrintf(wszDest, MAX_PATH, L"\"ExcludeDisk\"=\"%d\", ", pExtent->DiskNumber); // check errors

        strRestoreOption.Append(wszDest);
        // Check for an out-of-memory error.
    }

    // Remove the trailing comma.
    strRestoreOption.TrimRight();
    strRestoreOption.UnTrailing(',');

    // Set the output parameter.
    strRestoreOption.Transfer( pstrExclusionList );

Exit:
    if( pExtents )
    {
        ::CoTaskMemFree(pExtents);
        pExtents = NULL;
    }

    if( hVolume != INVALID_HANDLE_VALUE )
    {
        ::CloseHandle(hVolume);
        hVolume = INVALID_HANDLE_VALUE;
    }

    return ( hr );
}

```



 

 
