---
title: Architektur und Komponenten
description: In diesem Thema werden die Komponenten beschrieben, die Microsoft directcomposition bilden.
ms.assetid: 7C79B330-41EA-4BA0-9103-BB5A0C3D4CE2
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fb2de495aa170560b1e7082cacf1893a8c94905a
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/20/2020
ms.locfileid: "104039424"
---
# <a name="architecture-and-components"></a><span data-ttu-id="03489-103">Architektur und Komponenten</span><span class="sxs-lookup"><span data-stu-id="03489-103">Architecture and components</span></span>

> [!NOTE]
> <span data-ttu-id="03489-104">Für apps unter Windows 10 wird die Verwendung von Windows. UI. Composition-APIs anstelle von directcomposition empfohlen.</span><span class="sxs-lookup"><span data-stu-id="03489-104">For apps on Windows 10, we recommend using Windows.UI.Composition APIs instead of DirectComposition.</span></span> <span data-ttu-id="03489-105">Weitere Informationen finden Sie unter [modernisieren ihrer Desktop-App mithilfe der visuellen Ebene](/windows/uwp/composition/visual-layer-in-desktop-apps).</span><span class="sxs-lookup"><span data-stu-id="03489-105">For more info, see [Modernize your desktop app using the Visual layer](/windows/uwp/composition/visual-layer-in-desktop-apps).</span></span>

<span data-ttu-id="03489-106">In diesem Thema werden die Komponenten beschrieben, die Microsoft directcomposition bilden.</span><span class="sxs-lookup"><span data-stu-id="03489-106">This topic describes the components that make up Microsoft DirectComposition.</span></span> <span data-ttu-id="03489-107">Sie besteht aus den folgenden Abschnitten.</span><span class="sxs-lookup"><span data-stu-id="03489-107">It consists of the following sections.</span></span>

-   [<span data-ttu-id="03489-108">Softwarekomponenten</span><span class="sxs-lookup"><span data-stu-id="03489-108">Software components</span></span>](#software-components)
-   [<span data-ttu-id="03489-109">Anwendungsbibliothek</span><span class="sxs-lookup"><span data-stu-id="03489-109">Application library</span></span>](#application-library)
-   [<span data-ttu-id="03489-110">Kompositions Modul</span><span class="sxs-lookup"><span data-stu-id="03489-110">Composition engine</span></span>](#composition-engine)
-   [<span data-ttu-id="03489-111">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="03489-111">Related topics</span></span>](#related-topics)

## <a name="software-components"></a><span data-ttu-id="03489-112">Softwarekomponenten</span><span class="sxs-lookup"><span data-stu-id="03489-112">Software components</span></span>

<span data-ttu-id="03489-113">Directcomposition besteht aus den folgenden Hauptsoftware Komponenten.</span><span class="sxs-lookup"><span data-stu-id="03489-113">DirectComposition consists of the following main software components.</span></span>

-   <span data-ttu-id="03489-114">Eine Benutzermodus-Anwendungsbibliothek (dcomp.dll), die die Component Object Model (com)-basierte öffentliche API implementiert.</span><span class="sxs-lookup"><span data-stu-id="03489-114">A user-mode application library (dcomp.dll) that implements the Component Object Model (COM)-based public API.</span></span>
-   <span data-ttu-id="03489-115">Eine im DWM-dwm.exe Prozess (Desktopfenster-Manager (DWM) gehostete Benutzermodus-Kompositions-Engine (dwmcore.dll), die die tatsächliche Desktop Komposition ausführt.</span><span class="sxs-lookup"><span data-stu-id="03489-115">A user-mode composition engine (dwmcore.dll) that is hosted in the Desktop Window Manager (DWM) process (dwm.exe), and performs the actual desktop composition.</span></span>
-   <span data-ttu-id="03489-116">Eine Kernel Modus-Objektdatenbank (Teil win32k.sys), die Befehle von der Anwendung an die Kompositions-Engine marshunkt.</span><span class="sxs-lookup"><span data-stu-id="03489-116">A kernel-mode object database (part of win32k.sys) that marshals commands from the application to the composition engine.</span></span>

<span data-ttu-id="03489-117">Eine einzelne Instanz der Kompositions-Engine verarbeitet die directcomposition-Kompositions Strukturen für alle Anwendungen und die DWM-Kompositionsstruktur, die den gesamten Desktop darstellt.</span><span class="sxs-lookup"><span data-stu-id="03489-117">A single instance of the composition engine handles the DirectComposition composition trees for all applications and the DWM composition tree, which represents the entire desktop.</span></span> <span data-ttu-id="03489-118">Sowohl die kernelmodusobjektdatenbank als auch die Benutzermodus-Kompositions-Engine werden einmal pro Sitzung instanziiert, sodass ein Terminal Server Computer mit mehreren Benutzern mehrere Instanzen dieser Komponenten aufweist.</span><span class="sxs-lookup"><span data-stu-id="03489-118">Both the kernel-mode object database and the user-mode composition engine are instantiated once per session, so a Terminal Server machine with multiple users has multiple instances of both of those components.</span></span>

<span data-ttu-id="03489-119">Das folgende Diagramm zeigt die Hauptkomponenten von directcomposition und deren Beziehung zueinander.</span><span class="sxs-lookup"><span data-stu-id="03489-119">The following diagram shows the main DirectComposition components and how they relate to one another.</span></span>

![Architektur der obersten Ebene von directcomposition](images/directcomposition-top-level-architecture.png)

## <a name="application-library"></a><span data-ttu-id="03489-121">Anwendungsbibliothek</span><span class="sxs-lookup"><span data-stu-id="03489-121">Application library</span></span>

<span data-ttu-id="03489-122">Die directcomposition-Anwendungsbibliothek ist eine öffentliche com-basierte API mit einem einzelnen flachen Einstiegspunkt, der aus dcomp.dll exportiert wird und einen Schnittstellen Zeiger auf ein Geräte Objekt zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="03489-122">The DirectComposition application library is a public COM-based API with a single flat entry-point that is exported from dcomp.dll and returns an interface pointer to a device object.</span></span> <span data-ttu-id="03489-123">Das Geräte Objekt wiederum verfügt über Methoden zum Erstellen aller anderen Objekte, die jeweils durch einen Schnittstellen Zeiger dargestellt werden.</span><span class="sxs-lookup"><span data-stu-id="03489-123">The device object, in turn, has methods for creating all other objects, each of which is represented by an interface pointer.</span></span> <span data-ttu-id="03489-124">Alle directcomposition-Schnittstellen erben von und implementieren die [**IUnknown**](/windows/desktop/api/unknwn/nn-unknwn-iunknown) -Schnittstelle vollständig.</span><span class="sxs-lookup"><span data-stu-id="03489-124">All DirectComposition interfaces inherit from and fully implement the [**IUnknown**](/windows/desktop/api/unknwn/nn-unknwn-iunknown) interface.</span></span> <span data-ttu-id="03489-125">Alle Methoden, die directcomposition-Schnittstellen akzeptieren, überprüfen, ob die Schnittstelle innerhalb von dcomp.dll implementiert wird oder ob Sie von einer anderen Komponente implementiert wird.</span><span class="sxs-lookup"><span data-stu-id="03489-125">All methods that accept DirectComposition interfaces check whether the interface is implemented inside of dcomp.dll or whether it is implemented by another component.</span></span> <span data-ttu-id="03489-126">Da directcomposition nicht erweiterbar ist, geben Methoden, die Schnittstellen als Parameter annehmen, E \_ invalidArg zurück, wenn die Schnittstellen nicht in dcomp.dll implementiert werden.</span><span class="sxs-lookup"><span data-stu-id="03489-126">Because DirectComposition is not extensible, methods that take interfaces as parameters return E\_INVALIDARG if the interfaces are not implemented in dcomp.dll.</span></span> <span data-ttu-id="03489-127">Die API erfordert keine besonderen Berechtigungen. Sie kann von Prozessen aufgerufen werden, die auf der niedrigsten Zugriffsebene ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="03489-127">The API requires no special privileges; it can be called by processes running at the lowest level of access.</span></span> <span data-ttu-id="03489-128">Da die API jedoch nicht in Sitzung 0 funktioniert, eignet sie sich nicht für Dienste.</span><span class="sxs-lookup"><span data-stu-id="03489-128">However, because the API does not operate in session 0, it is not suitable for services.</span></span> <span data-ttu-id="03489-129">In dieser Hinsicht ähnelt die directcomposition-API anderen Microsoft DirectX-APIs, insbesondere Direct2D, Microsoft Direct3D und Microsoft DirectWrite.</span><span class="sxs-lookup"><span data-stu-id="03489-129">In these respects, the DirectComposition API is similar to other Microsoft DirectX APIs, most notably Direct2D, Microsoft Direct3D, and Microsoft DirectWrite.</span></span>

<span data-ttu-id="03489-130">Da die Kompositions-Engine ausschließlich für die asynchrone Ausführung konzipiert ist, sind Objekteigenschaften in der directcomposition-API schreibgeschützt.</span><span class="sxs-lookup"><span data-stu-id="03489-130">Because the composition engine is designed exclusively for asynchronous execution, object properties in the DirectComposition API are write-only.</span></span> <span data-ttu-id="03489-131">Alle Eigenschaften haben Setter-Methoden, aber keine Getter-Methoden.</span><span class="sxs-lookup"><span data-stu-id="03489-131">All properties have setter methods, but not getter methods.</span></span> <span data-ttu-id="03489-132">Das Lesen von Eigenschaften ist nicht nur ressourcenintensiv, sondern kann auch ungenau sein, da jeder von der Kompositions-Engine zurückgegebene Wert sofort ungültig werden kann.</span><span class="sxs-lookup"><span data-stu-id="03489-132">Reading properties is not only resource intensive, but can also be inaccurate because any value that the composition engine returns can immediately become invalid.</span></span> <span data-ttu-id="03489-133">Dies kann vorkommen, wenn z. b. eine unabhängige Animation an die gelesene Eigenschaft gebunden ist.</span><span class="sxs-lookup"><span data-stu-id="03489-133">This can happen if, for example, an independent animation is bound to the property that is being read.</span></span>

<span data-ttu-id="03489-134">Die API ist Thread sicher.</span><span class="sxs-lookup"><span data-stu-id="03489-134">The API is thread-safe.</span></span> <span data-ttu-id="03489-135">Eine Anwendung kann jederzeit jede Methode von einem beliebigen Thread aus abrufen.</span><span class="sxs-lookup"><span data-stu-id="03489-135">An application can call any method from any thread at any time.</span></span> <span data-ttu-id="03489-136">Da jedoch viele API-Methoden in einer bestimmten Sequenz aufgerufen werden müssen, kann eine Anwendung ohne Synchronisierung ein unvorhersehbares Verhalten aufweisen, je nachdem, wie die Threads interverlassen.</span><span class="sxs-lookup"><span data-stu-id="03489-136">However, because many API methods must be called in a particular sequence, without any synchronization an application can experience unpredictable behavior depending on how the threads interleave.</span></span> <span data-ttu-id="03489-137">Wenn beispielsweise zwei Threads dieselbe Eigenschaft desselben Objekts gleichzeitig in andere Werte ändern, kann die Anwendung nicht vorhersagen, welcher der beiden Werte der endgültige Wert der Eigenschaft ist.</span><span class="sxs-lookup"><span data-stu-id="03489-137">For example, if two threads change the same property of the same object to different values at the same time, the application cannot predict which of the two values will be the final value of the property.</span></span> <span data-ttu-id="03489-138">Wenn zwei Threads einen [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) auf demselben Gerät aufrufen, erhält kein Thread ein wirklich Transaktionales Verhalten, da ein Aufruf von **Commit** in einem Thread den Batch aller Befehle übermittelt, die von beiden Threads ausgegeben werden, nicht nur die, die **Commit** aufgerufen haben.</span><span class="sxs-lookup"><span data-stu-id="03489-138">Similarly, if two threads call [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) on the same device, neither thread gets truly transactional behavior because a call to **Commit** on one thread will submit the batch of all commands issued by both threads, not just the one that called **Commit**.</span></span>

<span data-ttu-id="03489-139">Das System verwaltet den gesamten internen Status pro Geräte Objekt.</span><span class="sxs-lookup"><span data-stu-id="03489-139">The system maintains all internal state per device object.</span></span> <span data-ttu-id="03489-140">Wenn eine Anwendung zwei oder mehr directcomposition-Geräte Objekte erstellt, kann die Anwendung unabhängige Batches und einen anderen Zustand zwischen beiden verwalten.</span><span class="sxs-lookup"><span data-stu-id="03489-140">If an application creates two or more DirectComposition device objects, the application can maintain independent batches and other state between the two.</span></span>

<span data-ttu-id="03489-141">Alle directcomposition-Objekte verfügen über eine Affinität zwischen Geräte Objekten; Objekte, die von einem bestimmten Geräte Objekt erstellt werden, können nur mit diesem Geräte Objekt verwendet werden und können nur anderen Objekten zugeordnet werden, die vom gleichen Geräte Objekt erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="03489-141">All DirectComposition objects have device object affinity; objects created by a particular device object can be used only with that device object, and can be associated only with other objects created by the same device object.</span></span> <span data-ttu-id="03489-142">Das heißt, jedes Geräte Objekt ist eine separate, Zusammenhang lose Insel der Funktionalität.</span><span class="sxs-lookup"><span data-stu-id="03489-142">In other words, each device object is a separate disjoint island of functionality.</span></span> <span data-ttu-id="03489-143">Die einzige Ausnahme ist die Klasse "Visual", die das bilden von visuellen Strukturen ermöglicht, in denen ein visuelles Element zu einem anderen Geräte Objekt als das übergeordnete Element gehören kann.</span><span class="sxs-lookup"><span data-stu-id="03489-143">The one exception is the visual class, which permits the building of visual trees where a visual can belong to a different device object than its parent.</span></span> <span data-ttu-id="03489-144">Dies ermöglicht Szenarien, in denen eine Anwendung und ein Steuerelement eine einzelne Kompositionsstruktur verwalten können, ohne auch ein einzelnes directcomposition-Geräte Objekt freigeben zu müssen.</span><span class="sxs-lookup"><span data-stu-id="03489-144">This enables scenarios where an application and a control can manage a single composition tree without also needing to share a single DirectComposition device object.</span></span>

## <a name="composition-engine"></a><span data-ttu-id="03489-145">Kompositions Modul</span><span class="sxs-lookup"><span data-stu-id="03489-145">Composition engine</span></span>

<span data-ttu-id="03489-146">Die directcomposition-Kompositions-Engine wird bei einem dedizierten Prozess unabhängig von einem beliebigen Anwendungsprozess ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="03489-146">The DirectComposition composition engine runs on a dedicated process, separate from any application process.</span></span> <span data-ttu-id="03489-147">Bei einem einzelnen Kompositionsprozess (dwm.exe) werden alle Anwendungen in einer Sitzung unterstützt.</span><span class="sxs-lookup"><span data-stu-id="03489-147">A single composition process, dwm.exe, supports every application in a session.</span></span> <span data-ttu-id="03489-148">Jede Anwendung kann zwei visuelle Strukturen für jedes Fenster erstellen, das Sie besitzt.</span><span class="sxs-lookup"><span data-stu-id="03489-148">Each application can create two visual trees for each window that it owns.</span></span> <span data-ttu-id="03489-149">Alle Strukturen werden tatsächlich als Teil Strukturen eines größeren visuellen Baums implementiert, der auch die Kompositions Strukturen von DWM umfasst.</span><span class="sxs-lookup"><span data-stu-id="03489-149">All of the trees are actually implemented as subtrees of a larger visual tree that also encompasses the composition structures of DWM.</span></span> <span data-ttu-id="03489-150">Der DWM-Konstruktor erstellt eine große visuelle Struktur für jeden Desktop in einer Sitzung.</span><span class="sxs-lookup"><span data-stu-id="03489-150">The DWM constructs one large visual tree for each desktop in a session.</span></span> <span data-ttu-id="03489-151">Dies sind die wichtigsten Vorteile dieser Architektur:</span><span class="sxs-lookup"><span data-stu-id="03489-151">Here are the key advantages to this architecture:</span></span>

-   <span data-ttu-id="03489-152">Die Kompositions-Engine verfügt über Zugriff auf alle Anwendungs Bitmaps und visuelle Strukturen, die prozessübergreifende Fenster Interoperabilität und-Komposition ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="03489-152">The composition engine has access to all application bitmaps and visual trees, which enables cross-process window interoperability and composition.</span></span>
-   <span data-ttu-id="03489-153">Die Kompositions-Engine wird in einem vertrauenswürdigen System Prozess ausgeführt, der von keinem beliebigen Anwendungsprozess getrennt ist, sodass Anwendungen mit niedrigen Zugriffsrechten geschützte Inhalte sicher verfassen können.</span><span class="sxs-lookup"><span data-stu-id="03489-153">The composition engine runs in a trusted system process that is separate from any application process, enabling applications that have low access rights to securely compose protected content.</span></span>
-   <span data-ttu-id="03489-154">Die Kompositions-Engine kann erkennen, wenn ein bestimmtes Fenster vollständig geledert wird, und vermeiden, dass CPU-und GPU-Ressourcen (Graphics Processing Unit) für das Fenster verschwendet werden.</span><span class="sxs-lookup"><span data-stu-id="03489-154">The composition engine can detect when a particular window is fully occluded and avoid wasting CPU and graphics processing unit (GPU) resources composing for the window.</span></span>
-   <span data-ttu-id="03489-155">Die Kompositions-Engine kann direkt auf den Bildschirm Puffer zurückgesetzt werden, sodass keine zusätzliche Kopie erforderlich ist, die für prozessspezifische Kompositions-Engines erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="03489-155">The composition engine can compose directly to the screen back buffer, avoiding the need for an extra copy that is required for per-process composition engines.</span></span>
-   <span data-ttu-id="03489-156">Alle Anwendungen verwenden ein einzelnes Direct3D-Gerät für die Komposition, das beträchtliche Speicher Einsparungen bietet.</span><span class="sxs-lookup"><span data-stu-id="03489-156">All applications share a single Direct3D device for composition, which offers considerable memory savings</span></span>

<span data-ttu-id="03489-157">Die visuelle Struktur ist eine beibehaltene Struktur.</span><span class="sxs-lookup"><span data-stu-id="03489-157">The visual tree is a retained structure.</span></span> <span data-ttu-id="03489-158">Die directcomposition-API macht Methoden zum Bearbeiten der Struktur in den Änderungen, die atomarisch verarbeitet werden, verfügbar.</span><span class="sxs-lookup"><span data-stu-id="03489-158">The DirectComposition API exposes methods to edit the structure in batches of changes that are processed atomically.</span></span> <span data-ttu-id="03489-159">Das Stamm Objekt in der directcomposition-API ist das Device-Objekt, das als Factory für alle anderen directcomposition-Objekte fungiert und eine Methode namens [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit)enthält.</span><span class="sxs-lookup"><span data-stu-id="03489-159">The root object in the DirectComposition API is the device object, which serves as the factory for all other DirectComposition objects and contains a method called [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit).</span></span> <span data-ttu-id="03489-160">Die Kompositions-Engine reflektiert keine Änderungen, die die Anwendung an der visuellen Struktur vornimmt, bis die Anwendung **Commit** aufruft. an diesem Punkt werden alle Änderungen seit dem letzten **Commit** als einzelne Transaktion verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="03489-160">The composition engine does not reflect any changes that the application makes to the visual tree until the application calls **Commit**, at which point all changes since the last **Commit** are processed as a single transaction.</span></span>

<span data-ttu-id="03489-161">Die Anforderung zum Aufrufen von [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) ähnelt dem Konzept eines "Frames", mit der Ausnahme, dass die Kompositions-Engine asynchron ausgeführt wird, dass Sie mehrere verschiedene Frames zwischen den Aufrufen von **Commit** darstellen kann.</span><span class="sxs-lookup"><span data-stu-id="03489-161">The requirement to call [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) is similar to the concept of a "frame" except that, because the composition engine runs asynchronously, it can present several different frames between calls to **Commit**.</span></span> <span data-ttu-id="03489-162">In directcomposition ist ein *Frame* eine einzelne Iteration der Kompositions-Engine, und das Intervall, das von einer Anwendung zwischen zwei Aufrufen von **Commit** aufgewendet wird, wird als *Batch* bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="03489-162">In DirectComposition, a *frame* is a single iteration of the composition engine, and the interval spent by an application between two calls to **Commit** is called a *batch*.</span></span>

<span data-ttu-id="03489-163">Directcomposition fasst alle Anwendungs Aufrufe an die directcomposition-API um.</span><span class="sxs-lookup"><span data-stu-id="03489-163">DirectComposition batches all application calls to the DirectComposition API.</span></span> <span data-ttu-id="03489-164">Die im win32k.sys-Sitzungs Treiber implementierte Kernel Objektdatenbank speichert alle Zustandsinformationen, die mit den API-aufrufen verknüpft sind.</span><span class="sxs-lookup"><span data-stu-id="03489-164">The kernel object database, which is implemented in the win32k.sys session driver, stores all state information that is associated with the API calls.</span></span>

<span data-ttu-id="03489-165">Die Kompositions-Engine erzeugt einen Frame für jede vertikale leere in der Anzeige.</span><span class="sxs-lookup"><span data-stu-id="03489-165">The composition engine produces one frame for each vertical blank in the display.</span></span> <span data-ttu-id="03489-166">Der Frame wird bei einem vertikalen Leerraum gestartet und zielt auf den nachfolgenden vertikalen Leerraum ab.</span><span class="sxs-lookup"><span data-stu-id="03489-166">The frame is started at a vertical blank and targets the subsequent vertical blank.</span></span> <span data-ttu-id="03489-167">Wenn der Frame gestartet wird, übernimmt die Kompositions-Engine alle ausstehenden Batches und schließt Ihre Befehle in diesen Frame ein.</span><span class="sxs-lookup"><span data-stu-id="03489-167">When the frame starts, the composition engine picks up all pending batches and includes their commands in that frame.</span></span> <span data-ttu-id="03489-168">Batches werden in eine ausstehende Warteschlange eingefügt, wenn die Anwendung [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit)aufruft, und die ausstehende Warteschlange wird atomarisch am Anfang des Frames geleert.</span><span class="sxs-lookup"><span data-stu-id="03489-168">Batches are placed in a pending queue when the application calls [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit), and the pending queue is flushed atomically at the beginning of the frame.</span></span> <span data-ttu-id="03489-169">Daher gibt es einen einzelnen Zeitpunkt, der den Anfang eines Frames markiert.</span><span class="sxs-lookup"><span data-stu-id="03489-169">Therefore, there is a single point in time that marks the beginning of a frame.</span></span> <span data-ttu-id="03489-170">Alle Batches, die vor diesem Punkt übermittelt werden, werden in den Frame eingeschlossen, während alle nach übermittelten Batches warten müssen, bis der nächste Frame verarbeitet wird.</span><span class="sxs-lookup"><span data-stu-id="03489-170">Any batches submitted before this point are included in the frame, while any batches submitted after must wait until the next frame to be processed.</span></span> <span data-ttu-id="03489-171">Die vollständige Kompositions Schleife lautet wie folgt:</span><span class="sxs-lookup"><span data-stu-id="03489-171">The full composition loop is as follows:</span></span>

1.  <span data-ttu-id="03489-172">Schätzen Sie die Zeit des nächsten vertikalen leeren.</span><span class="sxs-lookup"><span data-stu-id="03489-172">Estimate the time of the next vertical blank.</span></span>
2.  <span data-ttu-id="03489-173">Ruft alle ausstehenden Batches ab.</span><span class="sxs-lookup"><span data-stu-id="03489-173">Retrieve all pending batches.</span></span>
3.  <span data-ttu-id="03489-174">Verarbeiten Sie die abgerufenen Batches.</span><span class="sxs-lookup"><span data-stu-id="03489-174">Process the retrieved batches.</span></span>
4.  <span data-ttu-id="03489-175">Aktualisieren Sie alle Animationen mit der in Schritt 1 geschätzten Zeit.</span><span class="sxs-lookup"><span data-stu-id="03489-175">Update all animations using the time estimated in step 1.</span></span>
5.  <span data-ttu-id="03489-176">Bestimmen Sie die Bereiche des Bildschirms, die neu zusammengesetzt werden müssen.</span><span class="sxs-lookup"><span data-stu-id="03489-176">Determine the regions of the screen that need to be re-composed.</span></span>
6.  <span data-ttu-id="03489-177">Erstellen Sie die geänderten Bereiche neu.</span><span class="sxs-lookup"><span data-stu-id="03489-177">Re-compose the dirty regions.</span></span>
7.  <span data-ttu-id="03489-178">Zeigen Sie den Rahmen an, indem Sie die Back-und Front-Puffer für die einzelnen Bildschirme kippen.</span><span class="sxs-lookup"><span data-stu-id="03489-178">Present the frame by flipping the back and front buffers for each screen.</span></span>
8.  <span data-ttu-id="03489-179">Wenn in den Schritten 6 und 7 nichts zusammengesetzt und angezeigt wurde, warten Sie, bis ein Commit für einen Batch ausgeführt wurde.</span><span class="sxs-lookup"><span data-stu-id="03489-179">If nothing was composed and presented in steps 6 and 7, wait for a batch to be committed.</span></span>
9.  <span data-ttu-id="03489-180">Warten Sie auf den nächsten vertikalen Leerraum.</span><span class="sxs-lookup"><span data-stu-id="03489-180">Wait for the next vertical blank.</span></span>

<span data-ttu-id="03489-181">Wenn mehrere Monitore an eine einzelne Grafikkarte angefügt sind, verwendet die Kompositions-Engine den vertikalen Leerraum des primären Monitors, um die Zusammenfassungs Schleife zu steuern und die Zeit für die Animations Stichprobe festzulegen.</span><span class="sxs-lookup"><span data-stu-id="03489-181">If there are multiple monitors attached to a single video adapter, the composition engine uses the vertical blank of the primary monitor to drive the composition loop and set the animation sampling times.</span></span> <span data-ttu-id="03489-182">Jeder Monitor wird durch eine separate voll Bild-Flip-Kette dargestellt. die Kompositions-Engine wiederholt die Schritte 6 und 7 für jeden Monitor im Roundrobin-Verfahren mithilfe eines einzelnen Direct3D-Geräts.</span><span class="sxs-lookup"><span data-stu-id="03489-182">Each monitor is represented by a separate full-screen flip chain; the composition engine repeats steps 6 and 7 for each monitor, in a round-robin fashion, using a single Direct3D device.</span></span> <span data-ttu-id="03489-183">Wenn auch mehrere Videoadapter vorhanden sind, verwendet die Kompositions-Engine in den Schritten 6 und 7 ein separates Direct3D-Gerät für jede Grafikkarte.</span><span class="sxs-lookup"><span data-stu-id="03489-183">If there are also multiple video adapters, the composition engine uses a separate Direct3D device for each video adapter in steps 6 and 7.</span></span>

<span data-ttu-id="03489-184">Kompositions Rahmen werden so geplant, dass Sie immer mit einem vertikalen Leerraum beginnen, wie in der folgenden Abbildung dargestellt.</span><span class="sxs-lookup"><span data-stu-id="03489-184">Composition frames are scheduled to always start at a vertical blank, as the following illustration shows.</span></span>

![Kompositions Rahmenplanung](images/composition-frame-scheduling.png)

<span data-ttu-id="03489-186">Wenn die Kompositions-Engine keine Arbeit hat, da die Kompositionsstruktur nicht geändert wurde, wird der Kompositions Thread beim Warten auf einen neuen Batch nicht angezeigt.</span><span class="sxs-lookup"><span data-stu-id="03489-186">If the composition engine has no work to do because the composition tree has not changed, the composition thread sleeps while waiting for a new batch.</span></span> <span data-ttu-id="03489-187">Wenn ein neuer Batch übermittelt wird, wird der Kompositions Thread reaktiviert, aber sofort wieder in den Standbymodus versetzt, bis der nächste vertikale Leerraum liegt.</span><span class="sxs-lookup"><span data-stu-id="03489-187">When a new batch is submitted, the composition thread wakes up but immediately goes back to sleep until the next vertical blank.</span></span> <span data-ttu-id="03489-188">Durch dieses Verhalten wird die vorhersagbare Frame Start-und Endzeit für Anwendungen und die Kompositions-Engine sichergestellt.</span><span class="sxs-lookup"><span data-stu-id="03489-188">This behavior ensures predictable frame start and end times for applications and for the composition engine.</span></span>

<span data-ttu-id="03489-189">Die Kompositions-Engine veröffentlicht die Frame Präsentations Zeiten und die aktuelle Framerate.</span><span class="sxs-lookup"><span data-stu-id="03489-189">The composition engine publishes the frame presentation times and the current frame rate.</span></span> <span data-ttu-id="03489-190">Durch das Veröffentlichen dieser Informationen können Anwendungen die Präsentationszeit für Ihre eigenen Batches einschätzen, die wiederum das Synchronisieren von Animationen ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="03489-190">Publishing this information enables applications to estimate the presentation time for their own batches, which in turns enables animations to be synchronized.</span></span> <span data-ttu-id="03489-191">Insbesondere kann eine Anwendung eine Kombination aus Frame Statistiken aus der Kompositions-Engine verwenden, und ein Verlaufs Modell, wie lange der UI-Thread benötigt, um einen Batch zu erstellen, um die Zeit für die Stichprobenentnahme für seine eigenen Animationen zu ermitteln.</span><span class="sxs-lookup"><span data-stu-id="03489-191">In particular, an application can use a combination of frame statistics from the composition engine, and a historical model of how long its UI thread takes to produce a batch, to determine the sampling time for its own animations.</span></span>

<span data-ttu-id="03489-192">Beispielsweise kann die Anwendung am Anfang des Anwendungs Batches, der in der obigen Abbildung gezeigt wurde, das Kompositions Modul Abfragen, um die genaue Präsentationszeit des nächsten Frames zu bestimmen.</span><span class="sxs-lookup"><span data-stu-id="03489-192">For example, at the beginning of the application batch shown in the previous illustration, the application can query the composition engine to determine the exact presentation time of the next frame.</span></span> <span data-ttu-id="03489-193">Die Anwendung kann dann die aktuelle Zeit zusammen mit Informationen zu vorherigen Batches verwenden, die Sie erstellt hat, um zu bestimmen, ob die Anwendung den aktuellen Batch vor dem nächsten vertikalen leeren vervollständigen kann.</span><span class="sxs-lookup"><span data-stu-id="03489-193">The application can then use the current time, along with information about previous batches that it has produced, to determine whether the application can complete the current batch before the next vertical blank.</span></span> <span data-ttu-id="03489-194">Daher verwendet die Anwendung die Frame Präsentationszeit als Stichproben Zeit für Ihre eigenen Animationen.</span><span class="sxs-lookup"><span data-stu-id="03489-194">Therefore, the application uses the frame presentation time as the sampling time for its own animations.</span></span> <span data-ttu-id="03489-195">Wenn die Anwendung feststellt, dass es unwahrscheinlich ist, dass die Arbeit im aktuellen vertikalen Leerraum beendet wird, kann die Anwendung stattdessen die nachfolgende Frame Zeit als samplingzeit verwenden, wobei die von der Kompositions-Engine zurückgegebenen Frameraten Informationen verwendet werden, um diese Zeit zu berechnen.</span><span class="sxs-lookup"><span data-stu-id="03489-195">If the application determines that it is unlikely to complete its work in the current vertical blank, the application can use the subsequent frame time as the sampling time instead, using the frame rate information returned by the composition engine to compute that time.</span></span>

## <a name="related-topics"></a><span data-ttu-id="03489-196">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="03489-196">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="03489-197">Directcomposition-Konzepte</span><span class="sxs-lookup"><span data-stu-id="03489-197">DirectComposition Concepts</span></span>](directcomposition-concepts.md)
</dt> </dl>

 

 