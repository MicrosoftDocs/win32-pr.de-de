---
title: Installation bei Bedarf für Spiele
description: In diesem technischen Artikel werden zwei Techniken, die Installation bei Bedarf und die Installation im Hintergrund, mithilfe von Windows Installer erläutert.
ms.assetid: abaaa7bf-8ed8-0425-6845-3671a56fe7fc
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 064dc58c563c372d1320a21040920e492e4e65e4
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/20/2020
ms.locfileid: "106339503"
---
# <a name="install-on-demand-for-games"></a>Installation bei Bedarf für Spiele

In diesem technischen Artikel werden zwei Techniken, die Installation bei Bedarf und die Installation im Hintergrund, mithilfe von [Windows Installer](/windows/desktop/Msi/windows-installer-portal)erläutert. Spiele können diese Installationstechniken nutzen, um für Spieler ein besseres und angenehmeres Spielverhalten zu bieten, indem Sie die Installationszeit verkürzen.

-   [Übersicht](#overview)
-   [Patching-Unterstützung](#patching-support)
-   [Das installondemand SDK-Beispiel](#the-installondemand-sdk-sample)
-   [Die Features und Komponenten des Beispiels](#the-samples-features-and-components)
-   [Installation](#installation)
-   [Einschränkung](#limitation)

## <a name="overview"></a>Übersicht

Die Installation war seit längerer Zeit ein Element von computerbasierten Anwendungen. Bei den meisten Anwendungen ist es erforderlich, dass Sie zuerst auf der lokalen Festplatte des Benutzers installiert werden, bevor Sie verwendet werden können. Computer Spiele sind keine Ausnahme. Wenn ein Consumer ein Microsoft Windows-Spiel kauft und versucht, ihn auszuführen, muss er zunächst einen Installationsvorgang durchlaufen, der die erforderlichen Dateien von der Spiel Platte auf die Festplatte kopiert. Dieser Installationsvorgang ist in der Regel langwierig und kann bis zu einer Stunde dauern. Die Installationszeit ist ein Faktor, mit dem Konsolenspiele besser erwünscht werden als computerbasierte Spiele für einige Spieler, da Sie nach dem Einfügen der Spiel Platte sofort ein Konsolenspiel spielen können. Die in diesem Artikel erörterte Technologie versucht, dies zu beheben, indem die Installationszeit drastisch reduziert wird.

In der Vergangenheit erfordern Spiele, dass alle oder die meisten Dateien vor dem Start installiert werden. Um die Bedarfs gesteuerte Installation zu erzielen, müssen die Spiel Ressourcen modular aufgebaut werden. Das heißt, der Entwickler muss die Ressourcen der Anwendung (Grafiken, Audiodaten usw.) in Komponenten aufteilen. Jede Komponente ist ein Satz von Ressourcen, die als Einheit installiert oder entfernt werden können. Nachdem dies geschehen ist, definiert der Spieleentwickler eine oder mehrere Features, in der Regel eine oder mehrere pro Ebene oder Zone. Jede Funktion einer Anwendung gibt eine Reihe von Komponenten an, die für die Ausführung der jeweiligen Funktion erforderlich sind. Wenn eine Anwendung installiert wird, können die zugehörigen Funktionen als "Install" (auf der lokalen Festplatte zur Installation kopierte Komponenten) oder "angekündigt" gekennzeichnet werden (Komponenten, die nach der Erstinstallation auf die lokale Festplatte kopiert werden, wenn die Anwendung diese Funktion verwendet). Ein Spielentwickler kann die Installationszeit verringern, indem er das Spiel so gestaltet, dass es mit einem minimalen Satz installierter Features gestartet und ausgeführt wird. Die übrigen Features können als angekündigt gekennzeichnet und bei Bedarf installiert werden, wenn die Anwendung tatsächlich Funktionen verwenden muss, die diese Features bereitstellen.

Spiele können [Windows Installer](/windows/desktop/Msi/windows-installer-portal) aufgerufen werden, um ein bestimmtes Feature zu installieren, das möglicherweise nicht installiert wurde. Damit die Installation im Hintergrund angezeigt wird, kann ein Arbeits Thread verwendet werden, um die Aufrufe an das Installationsprogramm vorzunehmen, während der primäre Thread weiterhin Spiellogik verarbeitet und den Bildschirm Renderern kann. Dadurch wird die Unterbrechung des durch die Installation verursachten durch Spiels minimiert. Das Spiel kann die Installation jederzeit initiieren. Da die Installation jedoch Prozessor Zyklen beansprucht, ist es in der Regel nicht empfehlenswert, die Installation durchzuführen, wenn der primäre Thread eine hohe Verarbeitungsleistung benötigt, z. b. wenn der Benutzer in der Mitte der Aktion ist. Ein guter Zeitpunkt für die Installation kann z. b. sein, wenn sich der Benutzer im Menü "Spiel" befindet, wenn das Spiel angehalten oder minimiert wird oder wenn der Benutzer den Einführungsfilm oder die Ausschneide Szenen beobachtet.

## <a name="patching-support"></a>Patching-Unterstützung

Die meisten Spiele müssen heute auch dann aktualisiert werden, wenn die Fehler behoben werden und neue Features hinzugefügt werden. Zum Aktualisieren sind häufig Patches erforderlich, was in der Regel eine einfache Prozedur für Spiele ist. Da alle erforderlichen Dateien auf der Festplatte des Benutzers installiert werden, umfasst das Patchen eines Spiels das Kopieren von überarbeiteten Dateien auf die Festplatte und das Überschreiben vorhandener Dateien. Wenn install-on-Demand verwendet wird, werden nicht alle Dateien installiert und zum Zeitpunkt des Patchens kopiert. Daher kann der Patcher nicht einfach aktualisierte Dateien in den Spiel Ordner schreiben.

[Windows Installer](/windows/desktop/Msi/windows-installer-portal) verfügt über Features zum Patchen von Anwendungen, die install-on-Demand verwenden. Beim Anwenden eines Patches speichert das Installationsprogramm den Patch auf dem System. Diese Funktion eignet sich gut für Patches mit kleinen Delta-Funktionen. Die ursprünglich veröffentlichten Dateien müssen zum Zeitpunkt des Patchens nicht mehr auf dem Datenträger gespeichert werden, sodass diese Dateien angekündigt werden können. Wenn die Anwendung zu einem späteren Zeitpunkt ausgeführt wird und auf die Dateien zugreifen muss, installiert das Installationsprogramm die neueste Version dieser Dateien, indem Sie die ursprünglich veröffentlichte Version von den Medien (z. b. CDs) kopiert und den Patch nach dem Lesen der gespeicherten Patchdaten anwendet.

## <a name="the-installondemand-sdk-sample"></a>Das installondemand SDK-Beispiel

Im Beispiel install-on-Demand for Games werden die in diesem Artikel erläuterten Techniken zum Installieren nach Bedarf veranschaulicht. Im Gegensatz zu anderen Beispielen kann die Installation nach Bedarf für Spiele nicht direkt über den Beispiel Browser ausgeführt werden. Da im Beispiel die- [Windows Installer](/windows/desktop/Msi/windows-installer-portal) zur Verwaltung der-Installation verwendet wird, muss es in der Datenbank installierter Anwendungen des Installers enthalten sein.

**So starten Sie das Beispiel**

1.  Verwenden Sie den Link "Projekt installieren" im Beispiel Browser, um die Beispieldateien in einen Ordner zu kopieren.
2.  Doppelklicken Sie auf InstallOnDemand.msi, um das Beispiel zu installieren.
3.  Wählen Sie typische Installation aus.
4.  Starten Sie das Beispiel, indem Sie die InstallOnDemand.exe im installierten Ordner (in der Regel "Programmdateien \\ installondemand") starten oder indem Sie über das Menü "Start" Starten \\ .

InstallOnDemand.msi ist eine Datenbank, die vom Installationsprogramm erkannt wird. Es definiert den gesamten Installationsvorgang: die Verzeichnisstruktur, die Inhalte, die nicht kopiert werden, welche Ressourcen kopiert werden, welche Registrierungs Werte geschrieben werden sollen, die zu erstellenden Verknüpfungen usw.

Beim Start gibt das Beispiel eine Einführungssequenz aus. Der Spieler kann ihn beenden und das Hauptmenü durch Drücken der ESC-Taste eingeben. Nach der Einführung kann der Spieler ein neues Spiel starten, indem er einen Zeichennamen eingibt und einen Bildlauf durch die Statistiken durchführt. Bevor das Beispiel mit der Wiedergabe der Einführungssequenz beginnt, ruft das Beispiel eine Installer-Funktion auf, um zu überprüfen, ob die Funktion für Ebene 1 installiert ist. Wenn das Feature der Ebene 1 nicht installiert ist, wird im Beispiel ein Hintergrund Thread verwendet, um den Installer aufzufordern, das Spiel zu installieren, während der primäre Thread etwas anderes tut (z. b. das Abspielen der Einführungssequenz, das Rendern des Menüs oder das interagieren mit dem Player bei der Zeichen Erstellung). Das Verhalten unterscheidet sich von der herkömmlichen Spielinstallation darin, dass der Benutzer während der Installation im Spiel beschäftigt ist (während der Einführung oder beim Erstellen eines neuen Zeichens). Nachdem der Spieler das Erstellen eines Zeichens abgeschlossen hat, lädt das Beispiel die Ressourcen für Ebene 1.

Auf der rechten Seite des Bildschirms sehen Sie fünf Schaltflächen, die mit "Wiedergabe Ebene 1" bis "Wiedergabe Ebene 5" gekennzeichnet sind. Diese Schaltflächen simulieren den Abschluss des Players der aktuellen Ebene und den Fortschritt der nächsten. Wenn auf eine dieser Schaltflächen geklickt wird, wird ein Statistik Bildschirm angezeigt, der Informationen über die soeben beendete Ebene anzeigt. Das Beispiel nimmt diese Zeit auch an, das Installationsprogramm aufzufordern, die nächste Ebene zu überprüfen und zu installieren, wenn es nicht bereits installiert ist. Die Installation wird ausgeführt, während der Player den Statistik Bildschirm liest. wenn der Benutzer also auf OK klickt, um die nächste Ebene einzugeben, werden die Ressourcen der Ebene alle installiert und können geladen werden.

## <a name="the-samples-features-and-components"></a>Die Features und Komponenten des Beispiels

In der Vergangenheit erfordern Spiele, dass alle oder die meisten Dateien vor dem Start installiert werden. Um die Bedarfs gesteuerte Installation zu erzielen, müssen die Spiel Ressourcen modular aufgebaut werden. Das heißt, der Entwickler muss die Ressourcen der Anwendung (Grafiken, Audiodaten usw.) in Komponenten aufteilen. Jede Komponente ist ein Satz von Ressourcen, die als Einheit installiert oder entfernt werden können. Nachdem dies geschehen ist, definiert der Spieleentwickler eine oder mehrere Features, in der Regel eine oder mehrere pro Ebene oder Zone. Jede Funktion einer Anwendung gibt eine Reihe von Komponenten an, die für die Ausführung der jeweiligen Funktion erforderlich sind. Wenn eine Anwendung installiert wird, können die zugehörigen Features als "Install" (auf der lokalen Festplatte zur Installation kopierte Komponenten) oder "angekündigt" gekennzeichnet werden (Komponenten, die auf die lokale Festplatte kopiert werden, wenn die Anwendung diese Funktion später verwendet). Ein Spielentwickler kann die Installationszeit verringern, indem er das Spiel für den Start und die Ausführung mit einem minimalen Satz installierter Features entwirft. Die übrigen Features können als angekündigt gekennzeichnet und Bedarfs gesteuert installiert werden, wenn die Anwendung tatsächlich Funktionen verwenden muss, die diese Features bereitstellen.

In der folgenden Tabelle sind die sechs Funktionen der obersten Ebene aufgeführt, die im Beispiel definiert werden.



| Funktionsname | Funktionalität                                                                                                                                                                                                             | Komponenten  | Dateien                                                                     |
|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|---------------------------------------------------------------------------|
| Kernspeicher         | Umfasst unabhängig von der Ebene jederzeit erforderliche Ressourcen. Diese Ressourcen sind: Beispiel ausführbare Datei, Medien, die durch Einführungssequenz und Ladebildschirm benötigt werden, sowie eine FX-Datei, die das gesamte Rendering im Beispiel verarbeitet. | Kernspeicher        | InstallOnDemand.exe, installondemand. FX, Loading.bmp, Level. x             |
| Kernspeicher         | (wie oben)                                                                                                                                                                                                           | Coreui      | Media \\ UI \\ dxutcontrols. DDS, Media \\ UI \\ dxutshared. FX, Media \\ UI \\ Pfeil. x |
| Kernspeicher         | (wie oben)                                                                                                                                                                                                           | Coremisc    | Media \\ misc \\ seafloor. x, Media \\ misc \\seafloor.bmp                        |
| Kernspeicher         | (wie oben)                                                                                                                                                                                                           | Corespeeder | Media \\ PRT Demo \\ Landshark. x, Media \\ PRT Demo \\ Speeder \_diff.jpg          |
| Kernspeicher         | (wie oben)                                                                                                                                                                                                           | Corereg     | N/v (Registrierungs Wert)                                                      |
| Level1       | Stellt Ressourcen bereit, die von Ebene 1 verwendet werden.                                                                                                                                                                                       | Level1      | Level1.jpg                                                                |
| Level1       | (identisch mit dem vorherigen)                                                                                                                                                                                                        | L1Skybox    | Medien \\ Licht testet \\ Galileo \_ Cross. DDS                                   |
| Level2       | Stellt Ressourcen bereit, die von Ebene 2 verwendet werden.                                                                                                                                                                                       | Level2      | Level2.jpg                                                                |
| Level2       | (identisch mit dem vorherigen)                                                                                                                                                                                                        | L2Skybox    | Überprüfungen des Mediums "Media Light"-gegen \\ \\ \_ Überprüfungen                                     |
| Level3       | Stellt Ressourcen bereit, die von Ebene 3 verwendet werden.                                                                                                                                                                                       | Level3      | Level3.jpg                                                                |
| Level3       | (identisch mit dem vorherigen)                                                                                                                                                                                                        | L3Skybox    | Media \\ Light testet \\ RNL- \_ Kreuz. DDS                                       |
| Level4       | Stellt Ressourcen bereit, die von Ebene 4 verwendet werden.                                                                                                                                                                                       | Level4      | Level4.jpg                                                                |
| Level4       | (identisch mit dem vorherigen)                                                                                                                                                                                                        | L4Skybox    | Media \\ Light testet \\ stpeters \_ Cross. DDS                                  |
| Ebene5       | Stellt Ressourcen bereit, die von Ebene 5 verwendet werden.                                                                                                                                                                                       | Ebene5      | Level5.jpg                                                                |
| Ebene5       | (identisch mit dem vorherigen)                                                                                                                                                                                                        | L5Skybox    | Media \\ Light testet \\ Uffizi \_ Cross. DDS                                    |



 

Die Funktionen Level1 through Level5 verfügen über zusätzliche untergeordnete Funktionen, die Dateien enthalten, die nicht direkt von dem Beispiel verwendet werden. Diese Dateien der unter Features wurden hinzugefügt, damit die Installation länger dauert. Dies dient zur Veranschaulichung des laufenden Installationsvorgangs, der im Hintergrund ausgeführt wird, während das Beispiel ausgeführt wird.

In der folgenden Tabelle sind die-unter Funktionen aufgeführt.



| Funktion | Untergeordnete Funktionen                      | Dateien                                                                                                                                                                          |
|---------|-----------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Level1  | L1PH1, L1PH2, L1PH3, L1PH4, L1PH5 | Level1 Platzhalter Daten \\ L1PH1. dat Level1 Platzhalter Daten \\ L1PH2. dat Level1 Platzhalter Daten \\ L1PH3. dat Level1 Platzhalter Daten \\ L1PH4. dat Level1 Platzhalter Daten \\ L1PH5. dat |
| Level2  | L2PH1, L2PH2, L2PH3, L2PH4, L2PH5 | Level2 Platzhalter Daten \\ L2PH1. dat Level2 Platzhalter Daten \\ L2PH2. dat Level2 Platzhalter Daten \\ L2PH3. dat Level2 Platzhalter Daten \\ L2PH4. dat Level2 Platzhalter Daten \\ L2PH5. dat |
| Level3  | L3PH1, L3PH2, L3PH3, L3PH4, L3PH5 | Level3 Platzhalter Daten \\ L3PH1. dat Level3 Platzhalter Daten \\ L3PH2. dat Level3 Platzhalter Daten \\ L3PH3. dat Level3 Platzhalter Daten \\ L3PH4. dat Level3 Platzhalter Daten \\ L3PH5. dat |
| Level4  | L4PH1, L4PH2, L4PH3, L4PH4, L4PH5 | Level4 Platzhalter Daten \\ L4PH1. dat Level4 Platzhalter Daten \\ L4PH2. dat Level4 Platzhalter Daten \\ L4PH3. dat Level4 Platzhalter Daten \\ L4PH4. dat Level4 Platzhalter Daten \\ L4PH5. dat |
| Ebene5  | L5PH1, L5PH2, L5PH3, L5PH4, L5PH5 | Level5 Platzhalter Daten \\ L5PH1. dat Level5 Platzhalter Daten \\ L5PH2. dat Level5 Platzhalter Daten \\ L5PH3. dat Level5 Platzhalter Daten \\ L5PH4. dat Level5 Platzhalter Daten \\ L5PH5. dat |



 

Während der Installation sollte das Kern Feature als "Install" gekennzeichnet werden, und alle anderen Features sollten als "angekündigt" markiert werden. Wenn Sie nur ein Feature anstelle von sechs installieren, muss die Zeit, die der Spieler warten muss, bis das Spiel gestartet wird, erheblich reduziert werden.

## <a name="installation"></a>Installation

Der [Windows Installer](/windows/desktop/Msi/windows-installer-portal) stellt einen Mechanismus bereit, mit dem eine Anwendung anfordern muss, dass ein angekündigtes Feature installiert wird. Der Mechanismus ist jedoch ein synchroner Anwendungs Programmierschnittstellen-Befehl (API), was bedeutet, dass die Anwendung innerhalb des Aufrufes warten muss, bis die Installation beendet ist. Um eine Hintergrund Installation zu erreichen, ist ein Arbeits Thread erforderlich, damit der Hauptanwendungs Thread andere wichtige Aufgaben ausführen kann, wie z. b. das Rendern auf dem Bildschirm, um das visuelle Feedback des Players zu erhalten.

Im Beispiel gibt es drei Status der Installation, die während der Beispiel Ausführung auftreten: aktive Installation, Passive Installation und keine Installation.

-   Die aktive Installation ist eine Anforderung, die durch das Beispiel initiiert wird, wenn Sie auf Ressourcen zugreifen oder diese laden muss, die von mindestens einem Feature bereitgestellt werden. Dies geschieht, wenn der Vorgang nicht fortgesetzt werden kann, bis die Ressource installiert ist.
-   Die passive Installation wird initiiert, wenn das Beispiel keine wichtige Aufgabe ausführt, z. b. wenn sich der Player im Menü befindet oder eine Ausschneide Szene beobachtet. Wenn dies der Fall ist, prüft der Arbeits Thread, ob noch eine Funktion des Beispiels angekündigt wird. Wenn eine solche Funktion gefunden wird, wird das Installationsprogramm aufgerufen, um dieses Feature zu installieren. Dieser Prozess wird wiederholt, bis alle Features des Beispiels installiert sind. Im Wesentlichen werden bei der passiven Installation zusätzliche Prozessor Zyklen verwendet, um die Installation im Hintergrund durchzuführen, wenn Sie das Hauptbeispiel am geringsten aufbringt.
-   Es findet keine Installation statt, wenn der Spieler aktiv an dem Spiel beteiligt ist. Dadurch wird ein Framerate-Drop verhindert, wodurch die Benutzer Leistung beeinträchtigt wird.

Im Beispiel wird eine cmsiutil-Klasse definiert, um alle Installations bezogenen Aufgaben zu verarbeiten. Im Wesentlichen verwendet cmsiutil einen Arbeits Thread, der das Installationsprogramm aufruft, um die Funktionen von Beispielen in einer-Schleife zu installieren. Die-Klasse verfügt über zwei Warteschlangen zum Speichern von Installationsanforderungen: eine Warteschlange mit hoher Priorität für aktive Installation und eine Warteschlange mit niedriger Priorität für die passive Installation. Während der Initialisierung listet die-Klasse alle Features des Produkts auf und fügt Sie der passiven Installations Warteschlange hinzu. Da das gesamte Produkt auf diese Weise in die Warteschlange eingereiht wird, wird das gesamte Produkt schließlich installiert, wenn das Beispiel über genügend freie Prozessor Zyklen verfügt.

Wenn im Beispiel eine aktive Installation angefordert werden muss, kann im Beispiel cmsiutil:: usefeatureset () aufgerufen und der Name der Funktion der obersten Ebene übergeben werden. Usefeatureset () fügt die angeforderte Funktion und alle zugehörigen untergeordneten Funktionen in die Warteschlange für die aktive Installation ein, damit Sie vom Arbeits Thread installiert werden kann.

Beim Ausführen einer Installations Anforderung prüft der Arbeits Thread die aktive Installations Warteschlange sowie die passive Installations Warteschlange, um festzustellen, ob für eine der Warteschlangen zusätzliche Anforderungen vorhanden sind. Jedes Mal, wenn der Thread eine Anforderung findet, wird die Installer-API aufgerufen, um die tatsächliche Installation durchzuführen. Wenn beide Warteschlangen leer sind, wird der Arbeits Thread mit einem Rückruf von [**WaitForSingleObject**](/windows/desktop/api/synchapi/nf-synchapi-waitforsingleobject)in den Standbymodus versetzt. Da das gesamte Produkt während der Initialisierung in der passiven Installations Warteschlange abgelegt wird, bedeutet eine leere Warteschlange, dass das gesamte Produkt installiert wurde.

Das Beispiel ruft cmsiutil:: enablepassiveinstall () auf, um die passive Installation zu aktivieren bzw. zu deaktivieren. Enablepassiveinstall (true) erhöht den Aktivierungs Zähler für die passive Installation, und enablepassiveinstall (false) verringert den Wert. Wenn die Aktivier Anzahl größer als 0 ist, verarbeitet die-Klasse die passive Installations Warteschlange. Im Beispiel wird eine passive Installation ermöglicht, wenn eine der folgenden Punkte zutrifft:

-   Der Benutzer wird die erste Einführungssequenz anzeigen.
-   Der Benutzer navigiert im Menü Beispiel.
-   Der Benutzer kann die Statistiken am Ende einer Ebene anzeigen.
-   Die Beispielanwendung verliert den Fokus und wechselt in den Hintergrund.

Die cmsiutil-Methoden sind unten aufgeführt:



| Methode                | BESCHREIBUNG                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|-----------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Abbrechen von Anforderungen      | Bewirkt, dass die aktuelle Installation abbricht und die aktive Installations Anforderungs Warteschlange leert.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Abortcurrentrequest   | Bewirkt, dass die Installation abgebrochen wird. Der Arbeits Thread verarbeitet dann die nächste Anforderung in der Warteschlange, sofern vorhanden.                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Enablepassivein Stall  | Erhöht oder verringert die Anzahl passiver Installationen. Das Beispiel verwendet diesen-Befehl, um zu steuern, wann eine passive Installation möglich ist und nicht.                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Getcurrentfeaturename | Gibt den Namen der Funktion zurück, die aktiv installiert wird.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Getfeatureprogress    | Gibt die aktuelle Takt Position für das Feature zurück, das installiert wird.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Getfeatureprogressmax | Gibt die maximale Anzahl von Status Takts für die zu installierende Funktion zurück.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Letzten Fehler abrufen          | Verwenden Sie diese Methode, um den Rückgabecode aus der vorherigen Installations Anforderung abzurufen.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Getpassiveprogress    | Gibt die Position der Statusanzeige für die passive Installation zurück.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Getpassiveprogressmax | Gibt die aktuelle Takt Position und die maximale Anzahl von Ticks für die passive Installation zurück. Das Beispiel kann Sie verwenden, um den allgemeinen Fortschritt der passiven Installation anzuzeigen.                                                                                                                                                                                                                                                                                                                                                                                               |
| GetProgress           | Gibt die Position der Statusanzeige für die aktive Funktions Satz Installation zurück. Diese wird verwendet, wenn das Beispiel die Installationsstatus Anzeige rendert. Da der Windows Installer nur Statusinformationen für die installierte Funktion bereitstellt, dividiert die-Methode die Statusanzeige unter den angeforderten Funktionen, sodass der Benutzer die gesamte Installation weiterhin als eine Aufgabe sehen kann.                                                                                                                                                                                           |
| Getprogressmax        | Gibt die maximale Takt Anzahl der Statusanzeige für die aktive Funktions Satz Installation zurück. Diese wird verwendet, wenn das Beispiel die Installationsstatus Anzeige rendert.                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Initialisieren            | Initialisiert die-Klasse mit dem Product Globally Unique Identifier (GUID). Diese Methode listet auch jede Funktion der Anwendung auf, die angekündigt, aber noch nicht installiert wurde, und platziert Sie in der passiven Installations Warteschlange, um die passive Installation einzurichten.                                                                                                                                                                                                                                                                                                           |
| Isinstallinprogress   | Verwenden Sie diese Methode, um herauszufinden, ob eine aktive Installation verarbeitet wird.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Usefeature            | Private Methode, die von usefeatureset aufgerufen wird. Überprüft, ob eine Funktion installiert ist. Wenn das angeforderte Feature installiert ist, gibt die Methode zurück. Wenn das Feature noch nicht installiert ist (angekündigt), fügt die Methode eine neue aktive Installations Anforderung für den Arbeits Thread in die Warteschlange ein und gibt dann zurück. Das optionale Ereignis handle, das signalisiert wird, wenn die angeforderte Installation beendet ist.                                                                                                                                                                                                        |
| Usefeatureset         | Wird durch das Beispiel aufgerufen, wenn es auf Funktionen zugreifen muss, die von einer bestimmten Funktion oder einer ihrer untergeordneten Funktionen bereitgestellt werden. Die-Methode listet alle Features des-Beispiels auf und ruft usefeature () für untergeordnete Funktionen der angegebenen Stamm Funktion auf. Das Beispiel kann ein Ereignis Handle übergeben, das signalisiert wird, wenn die gesamte Funktionsgruppe installiert ist. Da die Features, die als Gruppe installiert sind, das Handle für das letzte Feature, das von usefeature () in die Warteschlange eingereiht wurde, anstelle der einzelnen Features festgelegt wird, wird das Beispiel nach der Installation aller angeforderten Funktionen einmal benachrichtigt. |
| Useproduct            | Fügt eine aktive Installations Anforderung für den Arbeits Thread in die Warteschlange ein, um den Installer zum Ausführen einer vollständigen Produktinstallation aufzurufen. Das optionale Ereignis handle, das signalisiert wird, wenn die angeforderte Installation beendet ist.                                                                                                                                                                                                                                                                                                                                                                |



 

## <a name="limitation"></a>Einschränkung

Die aktuelle Version des Installers ist nicht für den gleichzeitigen Zugriff durch mehrere Threads konzipiert. Daher sollte der Haupt Thread den Installer nicht aufrufen, wenn der Arbeits Thread den Installer aufruft. Ein Beispiel für diese Einschränkung tritt im Beispiel auf, wenn der Haupt Thread eine Funktion anfordert und dann dieselbe Funktion erneut anfordert, bevor der Arbeits Thread die Installation abschließt. Die zweite Anforderung ruft MsiQueryFeatureState () auf, um herauszufinden, ob das angeforderte Feature bereits installiert ist, da das Installationsprogramm manchmal angibt, dass das Feature vollständig installiert ist, wenn der Arbeits Thread die Dateien noch kopiert.

Glücklicherweise gibt es hierfür eine einfache Problem Umgehung. Cmsiutil überprüft, ob eine Funktion vom Arbeits Thread installiert wird, bevor Funktionen wie z. b. MsiQueryFeatureState () oder msiusefeature () aufgerufen werden, um den Installationsstatus des fraglichen Features anzufordern. Beachten Sie, dass diese Einschränkung auch an anderer Stelle zu Problemen führen kann.

Das Patchen kann sich darauf auswirken, wie gut die Installation bei Bedarf auf dem Computer eines Endbenutzers funktioniert. Wenn Sie einen Patch anwenden, der nur Daten enthält, die sich von der vorherigen Version geändert haben, müssen Sie möglicherweise die vorherige Version der aktualisierten Datei installieren, um das Delta anzuwenden. In dieser Situation muss der Patch anfordern, dass der Installer betroffene angekündigte Features installiert, bevor er den Patch auf das Spiel anwendet.

Das Beispiel wird installiert, indem InstallOnDemand.msi gestartet wird, da davon ausgegangen wird, dass die [Windows Installer](/windows/desktop/Msi/windows-installer-portal) auf dem Computer vorhanden ist. Wenn das Installationsprogramm nicht vorhanden ist, werden MSI-Dateien nicht erkannt, und das starten funktioniert nicht. Um dieses Problem zu beheben, sollte eine Anwendung ein Installationsprogramm verwenden, um die Aufgabe auszuführen. Dieses Programm sollte zuerst prüfen, ob das Installationsprogramm vorhanden ist, und wenn ja, seine Version. Wenn die Version die Anforderung der Anwendung nicht erfüllt, sollte das Installationsprogramm den Windows Installer installieren und dann die MSI-Datei starten. Dieser Prozess wird als bootstrapping bezeichnet. Anwendungen benennen das Bootstrap-Installationsprogramm in der Regel Setup.exe. Im Beispiel wird das Bootstrapping nicht behandelt. Ausführliche Informationen zum Bootstrapping finden Sie jedoch im Windows Installer.

Entwickler sollten auch auf die Größe der einzelnen Features in ihren spielen achten. Beim Abbrechen einer laufenden Installation wird der Computer vom Installer vor der Installation wieder in den Zustand versetzt. Dies bedeutet, dass die Installation des Features vollständig rückgängig gemacht wird, und dass es keine Teil Funktions Installation gibt. Ein großes Feature erfordert längere Zeit für die Installation, wodurch die Wahrscheinlichkeit erhöht wird, dass die Installation unterbrochen und abgebrochen wird, oder dass die Installation die Hauptanwendung beeinträchtigt. Ein Beispiel wäre die Aktivierung der passiven Installation, wenn der Benutzer das Menü Spiel in der Mitte der Spiel Wiedergabe aufbringt. Wenn eine Funktion installiert wird und der Benutzer wieder ins Spiel wechselt, kann das Spiel eine der beiden folgenden Aktionen ausführen: die passive Installation kann beendet oder die passive Installation abgebrochen werden. Ein großes Feature wäre bei beiden Modellen unzureichend geeignet. Wenn die große Installation mit dem Spiel fertiggestellt wird, kann die-Installation die Renderingleistung des Spiels lange Zeit behindern. Wenn das Spiel die Installation abbricht, muss der Benutzer für lange Zeit im Menü bleiben, bevor es zum Spiel zurückkehrt. Entwickler sollten eine ausgeglichene Featuregröße finden, die sich am besten für ihre einzelnen Spiele eignet.

 

 