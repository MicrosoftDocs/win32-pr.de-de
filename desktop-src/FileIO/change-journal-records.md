---
description: Beim Hinzufügen, löschen und Ändern von Dateien, Verzeichnissen und anderen NTFS-Dateisystemobjekten werden vom NTFS-Dateisystem Datensätze für Änderungs Journal in Streams eingegeben, eine für jedes Volume auf dem Computer.
ms.assetid: c41aa3a8-c8d8-4bf2-9bbb-d6a6a556c5e4
title: Journal Datensätze ändern
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 56580a28c01ca164af4598cb290a37c8e36828f5
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "106363721"
---
# <a name="change-journal-records"></a><span data-ttu-id="36c79-103">Journal Datensätze ändern</span><span class="sxs-lookup"><span data-stu-id="36c79-103">Change Journal Records</span></span>

<span data-ttu-id="36c79-104">Beim Hinzufügen, löschen und Ändern von Dateien, Verzeichnissen und anderen NTFS-Dateisystemobjekten werden vom NTFS-Dateisystem Datensätze für Änderungs Journal in Streams eingegeben, eine für jedes Volume auf dem Computer.</span><span class="sxs-lookup"><span data-stu-id="36c79-104">As files, directories, and other NTFS file system objects are added, deleted, and modified, the NTFS file system enters change journal records in streams, one for each volume on the computer.</span></span> <span data-ttu-id="36c79-105">Jeder Datensatz gibt den Änderungstyp und das geänderte Objekt an.</span><span class="sxs-lookup"><span data-stu-id="36c79-105">Each record indicates the type of change and the object changed.</span></span> <span data-ttu-id="36c79-106">Der Offset vom Anfang des Streams für einen bestimmten Datensatz wird als Update Sequenznummer (Update Sequence Number, US-v) für den jeweiligen Datensatz bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="36c79-106">The offset from the beginning of the stream for a particular record is called the update sequence number (USN) for the particular record.</span></span> <span data-ttu-id="36c79-107">Neue Datensätze werden am Ende des Streams angefügt.</span><span class="sxs-lookup"><span data-stu-id="36c79-107">New records are appended to the end of the stream.</span></span>

<span data-ttu-id="36c79-108">Das NTFS-Dateisystem kann alte Datensätze löschen, um Speicherplatz zu sparen.</span><span class="sxs-lookup"><span data-stu-id="36c79-108">The NTFS file system may delete old records to conserve space.</span></span> <span data-ttu-id="36c79-109">Wenn erforderliche Datensätze gelöscht wurden, wird der Indizierungs Dienst durch Erneutes Indizieren des Volumes wieder hergestellt. Dies ist auch dann der Fall, wenn kein Änderungs Journal vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="36c79-109">If needed records have been deleted, the indexing service recovers by re-indexing the volume, as it does when no change journal exists.</span></span>

<span data-ttu-id="36c79-110">Im Änderungs Journal wird nur die Tatsache protokolliert, dass eine Datei geändert wurde, und der Grund für die Änderung (z. b. Schreibvorgänge, abschneiden, verlängern, löschen usw.).</span><span class="sxs-lookup"><span data-stu-id="36c79-110">The change journal logs only the fact of a change to a file and the reason for the change (for example, write operations, truncation, lengthening, deletion, and so on).</span></span> <span data-ttu-id="36c79-111">Es werden nicht genügend Informationen aufgezeichnet, um das Umkehren der Änderung zuzulassen.</span><span class="sxs-lookup"><span data-stu-id="36c79-111">It does not record enough information to allow reversing the change.</span></span>

<span data-ttu-id="36c79-112">Darüber hinaus können mehrere Änderungen an derselben Datei dazu führen, dass dem aktuellen Datensatz nur ein Reason-Flag hinzugefügt wird.</span><span class="sxs-lookup"><span data-stu-id="36c79-112">In addition, multiple changes to the same file may result in only one reason flag being added to the current record.</span></span> <span data-ttu-id="36c79-113">Wenn die gleiche Art von Änderung mehrmals auftritt, schreibt das NTFS-Dateisystem keinen neuen Datensatz für die Änderungen nach dem ersten.</span><span class="sxs-lookup"><span data-stu-id="36c79-113">If the same kind of change occurs more than once, the NTFS file system does not write a new record for the changes after the first.</span></span> <span data-ttu-id="36c79-114">Beispielsweise führen mehrere Schreibvorgänge ohne zwischengeschaltete Vorgänge zum Schließen und wieder öffnen zu nur einem Änderungs Daten Satz mit dem Grund Flag "USN-Grund für die \_ \_ Daten \_ Überschreibung".</span><span class="sxs-lookup"><span data-stu-id="36c79-114">For example, several write operations with no intervening close and reopen operations result in only one change record with the reason flag USN\_REASON\_DATA\_OVERWRITE set.</span></span>

<span data-ttu-id="36c79-115">Um zu veranschaulichen, wie das Änderungs Journal funktioniert, wird angenommen, dass ein Benutzer in der folgenden Reihenfolge auf eine Datei zugreift:</span><span class="sxs-lookup"><span data-stu-id="36c79-115">To illustrate how the change journal works, suppose a user accesses a file in the following order:</span></span>

1.  <span data-ttu-id="36c79-116">Schreibt in die Datei.</span><span class="sxs-lookup"><span data-stu-id="36c79-116">Writes to the file.</span></span>
2.  <span data-ttu-id="36c79-117">Legt den Zeitstempel für die Datei fest.</span><span class="sxs-lookup"><span data-stu-id="36c79-117">Sets the time stamp for the file.</span></span>
3.  <span data-ttu-id="36c79-118">Schreibt in die Datei.</span><span class="sxs-lookup"><span data-stu-id="36c79-118">Writes to the file.</span></span>
4.  <span data-ttu-id="36c79-119">Die Datei wird abgeschnitten.</span><span class="sxs-lookup"><span data-stu-id="36c79-119">Truncates the file.</span></span>
5.  <span data-ttu-id="36c79-120">Schreibt in die Datei.</span><span class="sxs-lookup"><span data-stu-id="36c79-120">Writes to the file.</span></span>
6.  <span data-ttu-id="36c79-121">Schließt die Datei.</span><span class="sxs-lookup"><span data-stu-id="36c79-121">Closes the file.</span></span>

<span data-ttu-id="36c79-122">In diesem Fall führt das NTFS-Dateisystem die folgenden Aktionen im Änderungs Journal aus (wobei \| eine bitweise OR-Operation angibt).</span><span class="sxs-lookup"><span data-stu-id="36c79-122">In this case, the NTFS file system takes the following actions in the change journal (where \| indicates a bitwise OR operation).</span></span>



| <span data-ttu-id="36c79-123">Ereignis</span><span class="sxs-lookup"><span data-stu-id="36c79-123">Event</span></span>                                 | <span data-ttu-id="36c79-124">NTFS-Dateisystem Aktion</span><span class="sxs-lookup"><span data-stu-id="36c79-124">NTFS file system action</span></span>                                                                                                                                                                                                                                                    |
|---------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="36c79-125">Anfangs Schreibvorgang</span><span class="sxs-lookup"><span data-stu-id="36c79-125">Initial write operation</span></span><br/>    | <span data-ttu-id="36c79-126">Das NTFS-Dateisystem schreibt einen neuen USN-Datensatz mit dem \_ Grund Flag "USN Reason \_ Data \_ Überschreibungs Grund".</span><span class="sxs-lookup"><span data-stu-id="36c79-126">The NTFS file system writes a new USN record with the USN\_REASON\_DATA\_OVERWRITE reason flag set.</span></span> <span data-ttu-id="36c79-127">Weitere Informationen zu möglichen Reason Flags finden Sie in der Struktur der Struktur des Daten [**\_ Satzes**](/windows/desktop/api/WinIoCtl/ns-winioctl-usn_record_v2) .</span><span class="sxs-lookup"><span data-stu-id="36c79-127">For more information on possible reason flags, see the [**USN\_RECORD**](/windows/desktop/api/WinIoCtl/ns-winioctl-usn_record_v2) structure.</span></span><br/>                                                     |
| <span data-ttu-id="36c79-128">Einstellung des Datei Zeitstempels</span><span class="sxs-lookup"><span data-stu-id="36c79-128">Setting of file time stamp</span></span><br/> | <span data-ttu-id="36c79-129">Das NTFS-Dateisystem schreibt einen neuen USN-Datensatz mit dem Flag Setting USN \_ reason \_ Data \_ Überschreibungs- \| USN Grund \_ \_ grundlegende \_ Informationen \_ ändern.</span><span class="sxs-lookup"><span data-stu-id="36c79-129">The NTFS file system writes a new USN record with the flag setting USN\_REASON\_DATA\_OVERWRITE \| USN\_REASON\_BASIC\_INFO\_CHANGE.</span></span><br/>                                                                                                                            |
| <span data-ttu-id="36c79-130">Zweiter Schreibvorgang</span><span class="sxs-lookup"><span data-stu-id="36c79-130">Second write operation</span></span><br/>     | <span data-ttu-id="36c79-131">Das NTFS-Dateisystem schreibt keinen neuen US-Daten Satz.</span><span class="sxs-lookup"><span data-stu-id="36c79-131">The NTFS file system does not write a new USN record.</span></span> <span data-ttu-id="36c79-132">Da \_ \_ \_ das Überschreiben von Daten aus der Datenbank für den vorhandenen Datensatz bereits festgelegt wurde, werden keine Änderungen am Datensatz vorgenommen.</span><span class="sxs-lookup"><span data-stu-id="36c79-132">Because USN\_REASON\_DATA\_OVERWRITE is already set for the existing record, no changes are made to the record.</span></span><br/>                                                                                           |
| <span data-ttu-id="36c79-133">Dateitrunzierung</span><span class="sxs-lookup"><span data-stu-id="36c79-133">File truncation</span></span><br/>            | <span data-ttu-id="36c79-134">Das NTFS-Dateisystem schreibt einen neuen USN-Datensatz mit dem Flag "USN \_ reason \_ Data Überschreibung USN Reason Data Überschreibung USN Reason \_ \| \_ \_ Basic \_ Info \_ Change \| USN \_ reason \_ Data \_ trunation".</span><span class="sxs-lookup"><span data-stu-id="36c79-134">The NTFS file system writes a new USN record with the flag setting USN\_REASON\_DATA\_OVERWRITE \| USN\_REASON\_BASIC\_INFO\_CHANGE \| USN\_REASON\_DATA\_TRUNCATION.</span></span><br/>                                                                                           |
| <span data-ttu-id="36c79-135">Dritter Schreibvorgang</span><span class="sxs-lookup"><span data-stu-id="36c79-135">Third write operation</span></span><br/>      | <span data-ttu-id="36c79-136">Das NTFS-Dateisystem schreibt keinen neuen US-Daten Satz.</span><span class="sxs-lookup"><span data-stu-id="36c79-136">The NTFS file system does not write a new USN record.</span></span> <span data-ttu-id="36c79-137">Da \_ \_ \_ das Überschreiben von Daten aus der Datenbank für den vorhandenen Datensatz bereits festgelegt wurde, werden keine Änderungen am Datensatz vorgenommen.</span><span class="sxs-lookup"><span data-stu-id="36c79-137">Because USN\_REASON\_DATA\_OVERWRITE is already set for the existing record, no changes are made to the record.</span></span><br/>                                                                                           |
| <span data-ttu-id="36c79-138">Vorgang schließen</span><span class="sxs-lookup"><span data-stu-id="36c79-138">Close operation</span></span><br/>            | <span data-ttu-id="36c79-139">Wenn der Benutzer, der Änderungen vornimmt, der einzige Benutzer der Datei ist, schreibt das NTFS-Dateisystem einen neuen USN-Datensatz mit der folgenden Flag-Einstellung: USN \_ reason \_ Data \_ Überschreibung \| USN \_ reason \_ grundlegende \_ Informationen ändern USN \_ \| \_ Ursache \_ Daten \_ Abschneiden \| USN \_ reason \_ Close.</span><span class="sxs-lookup"><span data-stu-id="36c79-139">If the user making changes is the only user of the file, the NTFS file system writes a new USN record with the following flag setting: USN\_REASON\_DATA\_OVERWRITE \| USN\_REASON\_BASIC\_INFO\_CHANGE \| USN\_REASON\_DATA\_TRUNCATION \| USN\_REASON\_CLOSE.</span></span><br/> |



 

<span data-ttu-id="36c79-140">Das Änderungs Journal sammelt eine Reihe von Datensätzen zwischen dem ersten öffnenden und dem letzten Schließen einer Datei.</span><span class="sxs-lookup"><span data-stu-id="36c79-140">The change journal accumulates a series of records between the first opening and last closing of a file.</span></span> <span data-ttu-id="36c79-141">Für jeden Datensatz wurde ein neues Reason-Flag festgelegt, das angibt, dass eine neue Art von Änderung aufgetreten ist.</span><span class="sxs-lookup"><span data-stu-id="36c79-141">Each record has a new reason flag set, indicating that a new kind of change has occurred.</span></span> <span data-ttu-id="36c79-142">Die Reihenfolge der Datensätze ergibt einen partiellen Verlauf der Datei.</span><span class="sxs-lookup"><span data-stu-id="36c79-142">The sequence of records gives a partial history of the file.</span></span> <span data-ttu-id="36c79-143">Der endgültige Datensatz, der beim Schließen der Datei erstellt wird, fügt das Flag "USN \_ reason Close" hinzu \_ .</span><span class="sxs-lookup"><span data-stu-id="36c79-143">The final record, created when the file is closed, adds the USN\_REASON\_CLOSE flag.</span></span> <span data-ttu-id="36c79-144">Dieser Datensatz stellt eine Zusammenfassung der Änderungen an der Datei dar. im Gegensatz zu den vorherigen Datensätzen gibt es jedoch keinen Hinweis auf die Reihenfolge der Änderungen.</span><span class="sxs-lookup"><span data-stu-id="36c79-144">This record represents a summary of changes to the file, but unlike the prior records, gives no indication of the order of the changes.</span></span>

<span data-ttu-id="36c79-145">Der nächste Benutzer, der auf die Datei zugreifen und diese ändern möchte, generiert einen neuen USN-Datensatz mit einem einzelnen Reason-Flag.</span><span class="sxs-lookup"><span data-stu-id="36c79-145">The next user to access and change the file generates a new USN record with a single reason flag.</span></span>

 

 




