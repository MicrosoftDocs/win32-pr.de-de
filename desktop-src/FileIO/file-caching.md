---
description: Windows speichert Datei Daten, die von Datenträgern gelesen und auf Datenträger geschrieben werden.
ms.assetid: 0865c741-63e3-4246-ba69-801b02153e4a
title: Dateizwischenspeicherung
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1a14fb668af16cfb8a4e42b59b25b73ecefbb7cb
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "103868248"
---
# <a name="file-caching"></a><span data-ttu-id="9d0b5-103">Dateizwischenspeicherung</span><span class="sxs-lookup"><span data-stu-id="9d0b5-103">File Caching</span></span>

<span data-ttu-id="9d0b5-104">Standardmäßig speichert Windows Dateidaten zwischen, die von Datenträgern gelesen und auf Datenträger geschrieben werden.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-104">By default, Windows caches file data that is read from disks and written to disks.</span></span> <span data-ttu-id="9d0b5-105">Dies bedeutet, dass Lesevorgänge Datei Daten aus einem Bereich im Systemspeicher lesen, der als Systemdatei Cache bezeichnet wird, und nicht vom physischen Datenträger.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-105">This implies that read operations read file data from an area in system memory known as the system file cache, rather than from the physical disk.</span></span> <span data-ttu-id="9d0b5-106">Entsprechend schreiben Schreibvorgänge Dateidaten in den Systemdateicache statt auf den Datenträger, und diese Art von Cache wird als Zurückschreibcache bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-106">Correspondingly, write operations write file data to the system file cache rather than to the disk, and this type of cache is referred to as a write-back cache.</span></span> <span data-ttu-id="9d0b5-107">Zwischenspeichern wird auf Dateiobjektbasis verwaltet.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-107">Caching is managed per file object.</span></span>

<span data-ttu-id="9d0b5-108">Das Caching erfolgt in der Richtung des *Cache-Managers*, der fortlaufend ausgeführt wird, während Windows ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-108">Caching occurs under the direction of the *cache manager*, which operates continuously while Windows is running.</span></span> <span data-ttu-id="9d0b5-109">Datei Daten im Systemdatei Cache werden in durch das Betriebssystem festgelegter Intervallen auf den Datenträger geschrieben, und der zuvor von diesen Datei Daten verwendete Arbeitsspeicher wird freigegeben – dies *wird als leeren* des Caches bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-109">File data in the system file cache is written to the disk at intervals determined by the operating system, and the memory previously used by that file data is freed—this is referred to as *flushing* the cache.</span></span> <span data-ttu-id="9d0b5-110">Die Richtlinie, das Schreiben der Daten in die Datei zu verzögern und im Cache zu speichern, bis der Cache geleert wird, wird als lazy writing bezeichnet und wird durch den Cache-Manager in einem bestimmten Zeitintervall ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-110">The policy of delaying the writing of the data to the file and holding it in the cache until the cache is flushed is called lazy writing, and it is triggered by the cache manager at a determinate time interval.</span></span> <span data-ttu-id="9d0b5-111">Die Zeit, zu der ein Dateidatenblock geleert wird, basiert teilweise auf dem Zeitraum, für den er im Cache gespeichert wurde, und auf der Zeit, die seit dem letzten Zugriff auf die Daten in einem Lesevorgang verstrichen ist.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-111">The time at which a block of file data is flushed is partially based on the amount of time it has been stored in the cache and the amount of time since the data was last accessed in a read operation.</span></span> <span data-ttu-id="9d0b5-112">Dadurch wird sichergestellt, dass die Möglichkeit des Zugriffs auf häufig gelesene Dateidaten im Systemdateicache für eine maximale Zeitspanne erhalten bleibt.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-112">This ensures that file data that is frequently read will stay accessible in the system file cache for the maximum amount of time.</span></span>

<span data-ttu-id="9d0b5-113">Dieser Vorgang der Datei Datenspeicherung wird in der folgenden Abbildung veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-113">This file data caching process is illustrated in the following figure.</span></span>

![Zwischenspeichern von Datei Daten](images/fig3.png)

<span data-ttu-id="9d0b5-115">Wie von den voll tonpfeilen in der vorherigen Abbildung dargestellt, wird ein Bereich von 256 KB-Daten in einen Slot-Slot von 256 KB in den System Adressraum eingelesen, wenn er während eines Datei Lesevorgangs erstmalig vom Cache-Manager angefordert wird.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-115">As depicted by the solid arrows in the previous figure, a 256 KB region of data is read into a 256 KB cache "slot" in system address space when it is first requested by the cache manager during a file read operation.</span></span> <span data-ttu-id="9d0b5-116">Ein Benutzermodusprozess kopiert die Daten in diesem Slot dann in seinen eigenen Adressraum.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-116">A user-mode process then copies the data in this slot to its own address space.</span></span> <span data-ttu-id="9d0b5-117">Wenn der Prozess den Datenzugriff abgeschlossen hat, schreibt er die geänderten Daten wieder in denselben Slot im Systemcache, wie mit dem gestrichelten Pfeil zwischen den Adressraum des Prozesses und dem Systemcache dargestellt.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-117">When the process has completed its data access, it writes the altered data back to the same slot in the system cache, as shown by the dotted arrow between the process address space and the system cache.</span></span> <span data-ttu-id="9d0b5-118">Wenn der Cache-Manager festgestellt hat, dass die Daten für einen bestimmten Zeitraum nicht mehr benötigt werden, werden die geänderten Daten in die Datei auf dem Datenträger zurückgeschrieben, wie durch den gepunkteten Pfeil zwischen dem System Cache und dem Datenträger dargestellt.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-118">When the cache manager has determined that the data will no longer be needed for a certain amount of time, it writes the altered data back to the file on the disk, as shown by the dotted arrow between the system cache and the disk.</span></span>

<span data-ttu-id="9d0b5-119">Der Umfang der e/a-Leistungsverbesserung, den das Zwischenspeichern von Datei Daten bietet, hängt von der Größe des gelesenen oder geschriebenen Datei Datenblocks ab.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-119">The amount of I/O performance improvement that file data caching offers depends on the size of the file data block being read or written.</span></span> <span data-ttu-id="9d0b5-120">Wenn große Blöcke von Datei Daten gelesen und geschrieben werden, ist es wahrscheinlicher, dass Lese-und Schreibvorgänge für Datenträger erforderlich sind, um den e/a-Vorgang abzuschließen.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-120">When large blocks of file data are read and written, it is more likely that disk reads and writes will be necessary to finish the I/O operation.</span></span> <span data-ttu-id="9d0b5-121">Die e/a-Leistung wird immer stärker beeinträchtigt, da diese Art von e/a-Vorgängen auftritt.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-121">I/O performance will be increasingly impaired as more of this kind of I/O operation occurs.</span></span>

<span data-ttu-id="9d0b5-122">In diesen Fällen kann das Zwischenspeichern deaktiviert werden.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-122">In these situations, caching can be turned off.</span></span> <span data-ttu-id="9d0b5-123">Dies erfolgt zu dem Zeitpunkt, zu dem die Datei geöffnet wird, indem Sie das **\_ Dateiflag \_ keine \_ Pufferung** als Wert für den *dwflagsandattributsparameter* von " [**kreatefile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea)" übergibt.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-123">This is done at the time the file is opened by passing **FILE\_FLAG\_NO\_BUFFERING** as a value for the *dwFlagsAndAttributes* parameter of [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea).</span></span> <span data-ttu-id="9d0b5-124">Wenn das Caching deaktiviert ist, greifen alle Lese-und Schreibvorgänge direkt auf den physischen Datenträger zu.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-124">When caching is disabled, all read and write operations directly access the physical disk.</span></span> <span data-ttu-id="9d0b5-125">Die Datei Metadaten werden jedoch möglicherweise weiterhin zwischengespeichert.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-125">However, the file metadata may still be cached.</span></span> <span data-ttu-id="9d0b5-126">Verwenden Sie die [**FlushFileBuffers**](/windows/desktop/api/FileAPI/nf-fileapi-flushfilebuffers) -Funktion, um die Metadaten auf den Datenträger zu leeren.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-126">To flush the metadata to disk, use the [**FlushFileBuffers**](/windows/desktop/api/FileAPI/nf-fileapi-flushfilebuffers) function.</span></span>

<span data-ttu-id="9d0b5-127">Die Häufigkeit, mit der die Leerung erfolgt, ist ein wichtiger Aspekt, der die Systemleistung mit der Systemzuverlässigkeit ausgeglichen.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-127">The frequency at which flushing occurs is an important consideration that balances system performance with system reliability.</span></span> <span data-ttu-id="9d0b5-128">Wenn das System den Cache zu häufig leert, wird die Systemleistung durch die Anzahl von leeren Schreibvorgängen bei Schreibvorgängen erheblich beeinträchtigt.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-128">If the system flushes the cache too often, the number of large write operations flushing incurs will degrade system performance significantly.</span></span> <span data-ttu-id="9d0b5-129">Wenn das System nicht oft genug geleert wird, ist die Wahrscheinlichkeit größer, dass entweder der System Arbeitsspeicher durch den Cache erschöpft ist, oder es kommt zu einem plötzlichen Systemausfall (z. b. ein Stromausfall des Computers), der vor dem leeren erfolgt.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-129">If the system is not flushed often enough, then the likelihood is greater that either system memory will be depleted by the cache, or a sudden system failure (such as a loss of power to the computer) will happen before the flush.</span></span> <span data-ttu-id="9d0b5-130">In der letzteren Instanz gehen die zwischengespeicherten Daten verloren.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-130">In the latter instance, the cached data will be lost.</span></span>

<span data-ttu-id="9d0b5-131">Um sicherzustellen, dass die richtige Menge an leeren erfolgt, erzeugt der Cache-Manager jede Sekunde einen Prozess, der als Lazy Writer bezeichnet wird.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-131">To ensure that the right amount of flushing occurs, the cache manager spawns a process every second called a lazy writer.</span></span> <span data-ttu-id="9d0b5-132">Der Lazy Writer-Prozess fügt ein Achtel der Seiten ein, die nicht vor kurzem geleert wurden, um auf den Datenträger geschrieben zu werden.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-132">The lazy writer process queues one-eighth of the pages that have not been flushed recently to be written to disk.</span></span> <span data-ttu-id="9d0b5-133">Es wertet ständig die Menge der Daten aus, die für eine optimale Systemleistung geleert werden, und wenn mehr Daten geschrieben werden müssen, werden mehr Daten in die Warteschlange eingereiht.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-133">It constantly reevaluates the amount of data being flushed for optimal system performance, and if more data needs to be written it queues more data.</span></span> <span data-ttu-id="9d0b5-134">Verzögerte Writer leeren keine temporären Dateien, da davon ausgegangen wird, dass Sie von der Anwendung oder dem System gelöscht werden.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-134">Lazy writers do not flush temporary files, because the assumption is that they will be deleted by the application or system.</span></span>

<span data-ttu-id="9d0b5-135">Einige Anwendungen, z. b. Viren Überprüfungs Software, erfordern, dass Ihre Schreibvorgänge sofort auf den Datenträger geleert werden. Windows bietet diese Möglichkeit durch das Zwischenspeichern von Schreibvorgängen.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-135">Some applications, such as virus-checking software, require that their write operations be flushed to disk immediately; Windows provides this ability through write-through caching.</span></span> <span data-ttu-id="9d0b5-136">Ein Prozess ermöglicht das Zwischenspeichern von Lesevorgängen für einen bestimmten e/a-Vorgang, indem das **\_ Dateiflag zum \_ schreiben \_ durch** das Flag in seinen Aufrufen von " [**kreatefile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea)" übergeht.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-136">A process enables write-through caching for a specific I/O operation by passing the **FILE\_FLAG\_WRITE\_THROUGH** flag into its call to [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea).</span></span> <span data-ttu-id="9d0b5-137">Wenn das Write-Through-Caching aktiviert ist, werden die Daten weiterhin in den Cache geschrieben, aber der Cache-Manager schreibt die Daten sofort auf den Datenträger, anstatt eine Verzögerung mithilfe des Lazy Writer-Diensts zu verursachen.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-137">With write-through caching enabled, data is still written into the cache, but the cache manager writes the data immediately to disk rather than incurring a delay by using the lazy writer.</span></span> <span data-ttu-id="9d0b5-138">Ein Prozess kann auch das Leeren einer Datei erzwingen, die er durch Aufrufen der [**FlushFileBuffers**](/windows/desktop/api/FileAPI/nf-fileapi-flushfilebuffers) -Funktion geöffnet hat.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-138">A process can also force a flush of a file it has opened by calling the [**FlushFileBuffers**](/windows/desktop/api/FileAPI/nf-fileapi-flushfilebuffers) function.</span></span>

<span data-ttu-id="9d0b5-139">Dateisystem Metadaten werden immer zwischengespeichert.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-139">File system metadata is always cached.</span></span> <span data-ttu-id="9d0b5-140">Um Metadatenänderungen auf dem Datenträger zu speichern, muss die Datei daher entweder geleert oder mit einem **\_ Dateiflag \_ mit \_ Schreib** Zugriff geöffnet werden.</span><span class="sxs-lookup"><span data-stu-id="9d0b5-140">Therefore, to store any metadata changes to disk, the file must either be flushed or be opened with **FILE\_FLAG\_WRITE\_THROUGH**.</span></span>

 

 



