---
description: Beispiel für einen Microsoft SMB-Protokoll Paket Austausch zwischen einem Client und einem Server.
ms.assetid: f831d0de-0e38-4141-811c-892a1b5c4037
title: Microsoft SMB Protocol-Paket Austausch Szenario
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e8a03e2f75b00aa93e629b3e698631c5efde4694
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "104343189"
---
# <a name="microsoft-smb-protocol-packet-exchange-scenario"></a><span data-ttu-id="1ac80-103">Microsoft SMB Protocol-Paket Austausch Szenario</span><span class="sxs-lookup"><span data-stu-id="1ac80-103">Microsoft SMB Protocol Packet Exchange Scenario</span></span>

<span data-ttu-id="1ac80-104">Dieses Thema enthält ein Beispiel für einen Microsoft SMB-Protokoll Paket Austausch zwischen einem Client und einem Server.</span><span class="sxs-lookup"><span data-stu-id="1ac80-104">This topic gives an example of a Microsoft SMB Protocol packet exchange between a client and a server.</span></span> <span data-ttu-id="1ac80-105">Die folgenden Schritte sind eine Übersicht über den Prozess:</span><span class="sxs-lookup"><span data-stu-id="1ac80-105">The following steps are an overview of the process:</span></span>

1.  <span data-ttu-id="1ac80-106">Der Client und der Server richten eine NetBIOS-Sitzung ein.</span><span class="sxs-lookup"><span data-stu-id="1ac80-106">The client and server establish a NetBIOS session.</span></span>
2.  <span data-ttu-id="1ac80-107">Der Client und der Server verhandeln den Microsoft SMB-Protokoll Dialekt.</span><span class="sxs-lookup"><span data-stu-id="1ac80-107">The client and server negotiate the Microsoft SMB Protocol dialect.</span></span>
3.  <span data-ttu-id="1ac80-108">Der Client meldet sich am Server an.</span><span class="sxs-lookup"><span data-stu-id="1ac80-108">The client logs on to the server.</span></span>
4.  <span data-ttu-id="1ac80-109">Der Client stellt eine Verbindung mit einer Freigabe auf dem Server her.</span><span class="sxs-lookup"><span data-stu-id="1ac80-109">The client connects to a share on the server.</span></span>
5.  <span data-ttu-id="1ac80-110">Der Client öffnet eine Datei auf der Freigabe.</span><span class="sxs-lookup"><span data-stu-id="1ac80-110">The client opens a file on the share.</span></span>
6.  <span data-ttu-id="1ac80-111">Der Client liest aus der Datei.</span><span class="sxs-lookup"><span data-stu-id="1ac80-111">The client reads from the file.</span></span>

<span data-ttu-id="1ac80-112">Zuerst wird eine Vollduplex-TCP-Verbindung vom Client mit dem Server hergestellt.</span><span class="sxs-lookup"><span data-stu-id="1ac80-112">First, a full-duplex TCP connection is established by the client with the server.</span></span> <span data-ttu-id="1ac80-113">Anschließend erstellt und sendet der Client ein NetBIOS-Sitzungs Anforderungspaket über die TCP-Verbindung.</span><span class="sxs-lookup"><span data-stu-id="1ac80-113">Then the client builds and sends a NetBIOS session request packet over the TCP connection.</span></span> <span data-ttu-id="1ac80-114">Wenn das Paket ordnungsgemäß formatiert wurde, gibt der Server ein Paket zurück, das eine Meldung enthält, die bestätigt, dass die Sitzung eingerichtet wurde.</span><span class="sxs-lookup"><span data-stu-id="1ac80-114">If the packet was formatted correctly, the server then returns a packet that contains a message acknowledging that the session has been established.</span></span> <span data-ttu-id="1ac80-115">Danach sendet der Client die ersten Microsoft SMB-Protokoll Pakete an den Server.</span><span class="sxs-lookup"><span data-stu-id="1ac80-115">After this, the client sends the first Microsoft SMB Protocol packets to the server.</span></span>



|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="1ac80-116">**Paket 1: SMB- \_ com- \_ Aushandlung**</span><span class="sxs-lookup"><span data-stu-id="1ac80-116">**Packet 1:  SMB\_COM\_NEGOTIATE**</span></span><br/> <span data-ttu-id="1ac80-117">**Richtung:** Client zu Server</span><span class="sxs-lookup"><span data-stu-id="1ac80-117">**Direction:** Client to server</span></span><br/> <span data-ttu-id="1ac80-118">**Beschreibung:** Der Client fordert an, dass der Server den Microsoft SMB-Protokoll Dialekt aushandelt.</span><span class="sxs-lookup"><span data-stu-id="1ac80-118">**Description:** The client requests that the server negotiate the Microsoft SMB Protocol dialect.</span></span> <span data-ttu-id="1ac80-119">Eine Liste von Zeichen folgen, die die Dialekte identifizieren, mit denen der Client arbeiten kann, ist im Paket enthalten.</span><span class="sxs-lookup"><span data-stu-id="1ac80-119">A list of strings identifying the dialects that the client can work with is included in the packet.</span></span><br/>                                                                                                                                                                                                                                                                                                                                   |
| <span data-ttu-id="1ac80-120">**Paket 2: SMB- \_ com- \_ Aushandlung**</span><span class="sxs-lookup"><span data-stu-id="1ac80-120">**Packet 2:  SMB\_COM\_NEGOTIATE**</span></span><br/> <span data-ttu-id="1ac80-121">**Richtung:** Server zu Client</span><span class="sxs-lookup"><span data-stu-id="1ac80-121">**Direction:** Server to client</span></span><br/> <span data-ttu-id="1ac80-122">**Beschreibung:** Der Server antwortet auf die Anforderung des Clients, um den Microsoft SMB-Protokoll Dialekt zu identifizieren, der in der Sitzung verwendet werden soll.</span><span class="sxs-lookup"><span data-stu-id="1ac80-122">**Description:** The server responds to the client's request to identify the Microsoft SMB Protocol dialect that is going to be used in the session.</span></span> <span data-ttu-id="1ac80-123">Das zurückgegebene Paket enthält auch eine zufällige 8-Byte-Zeichenfolge, die im nächsten Schritt verwendet wird, um den Client während des Anmeldevorgangs zu authentifizieren.</span><span class="sxs-lookup"><span data-stu-id="1ac80-123">The returned packet also includes an 8-byte random string that will be used in the next step to authenticate the client during the logon process.</span></span><br/>                                                                                                                                                                                                                                   |
| <span data-ttu-id="1ac80-124">**Paket 3: Einrichten der SMB- \_ com- \_ Sitzung \_ \_ AndX**</span><span class="sxs-lookup"><span data-stu-id="1ac80-124">**Packet 3:  SMB\_COM\_SESSION\_SETUP\_ANDX**</span></span><br/> <span data-ttu-id="1ac80-125">**Richtung:** Client zu Server</span><span class="sxs-lookup"><span data-stu-id="1ac80-125">**Direction:** Client to server</span></span><br/> <span data-ttu-id="1ac80-126">**Beschreibung:** Dieses Paket enthält Informationen zu Client Funktionen, sodass dieses Paket auch dann gesendet werden muss, wenn der Server nur die Sicherheit auf Freigabe Ebene implementiert hat.</span><span class="sxs-lookup"><span data-stu-id="1ac80-126">**Description:** This packet includes information about client capabilities, so this packet must be sent even if the server has implemented only share-level security.</span></span><br/> <span data-ttu-id="1ac80-127">**Paket 3: Einrichten der SMB- \_ com- \_ Sitzung \_ \_ AndX**</span><span class="sxs-lookup"><span data-stu-id="1ac80-127">**Packet 3:  SMB\_COM\_SESSION\_SETUP\_ANDX**</span></span><br/> <span data-ttu-id="1ac80-128">**Richtung:** Server zu Client</span><span class="sxs-lookup"><span data-stu-id="1ac80-128">**Direction:** Server to client</span></span><br/> <span data-ttu-id="1ac80-129">**Beschreibung:** Wenn die Anforderung/Antwort vom Server akzeptiert wird, ist eine gültige UID in dem Paket enthalten, das an den Client zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="1ac80-129">**Description:** If the challenge/response is accepted by the server, a valid UID is included in the packet that is returned to the client.</span></span> <span data-ttu-id="1ac80-130">Wenn Sie nicht akzeptiert wird, gibt der Server in diesem Paket einen Fehlercode zurück und verweigert den Zugriff.</span><span class="sxs-lookup"><span data-stu-id="1ac80-130">If it is not accepted, the server will return an error code in this packet and deny access.</span></span><br/> |
| <span data-ttu-id="1ac80-131">**Paket 4: SMB \_ com \_ Tree \_ Connect \_ AndX**</span><span class="sxs-lookup"><span data-stu-id="1ac80-131">**Packet 4:  SMB\_COM\_TREE\_CONNECT\_ANDX**</span></span><br/> <span data-ttu-id="1ac80-132">**Richtung:** Client zu Server</span><span class="sxs-lookup"><span data-stu-id="1ac80-132">**Direction:** Client to server</span></span><br/> <span data-ttu-id="1ac80-133">**Beschreibung:** Der Client fordert den Zugriff auf die Freigabe an.</span><span class="sxs-lookup"><span data-stu-id="1ac80-133">**Description:** The client requests access to the share.</span></span> <span data-ttu-id="1ac80-134">Das Paket enthält den vollständig angegebenen Pfad der Freigabe im UNC-Format.</span><span class="sxs-lookup"><span data-stu-id="1ac80-134">The packet contains the fully specified path of the share in UNC format.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                             |
| <span data-ttu-id="1ac80-135">**Paket 5: SMB \_ com \_ Tree \_ Connect \_ AndX**</span><span class="sxs-lookup"><span data-stu-id="1ac80-135">**Packet 5:  SMB\_COM\_TREE\_CONNECT\_ANDX**</span></span><br/> <span data-ttu-id="1ac80-136">**Richtung:** Server zu Client</span><span class="sxs-lookup"><span data-stu-id="1ac80-136">**Direction:** Server to client</span></span><br/> <span data-ttu-id="1ac80-137">**Beschreibung:** Wenn der Zugriff auf die Freigabe gewährt wird, gibt der Server die 16-Bit-Struktur-ID (TID) zurück, die der Freigabe in diesem Paket entspricht.</span><span class="sxs-lookup"><span data-stu-id="1ac80-137">**Description:** If access to the share is granted, then the server returns the 16-bit tree ID (TID) that corresponds to the share in this packet.</span></span> <span data-ttu-id="1ac80-138">Wenn die Freigabe nicht vorhanden ist oder der Benutzer nicht über ausreichende Anmelde Informationen für den Zugriff auf die Freigabe verfügt, gibt der Server in diesem Paket einen Fehlercode zurück und verweigert den Zugriff auf die Freigabe.</span><span class="sxs-lookup"><span data-stu-id="1ac80-138">If the share does not exist or the user has insufficient credentials to access the share, the server will return an error code in this packet and deny access to the share.</span></span><br/>                                                                                                                                                                                                 |
| <span data-ttu-id="1ac80-139">**Paket 6: SMB \_ com \_ Open \_ AndX**</span><span class="sxs-lookup"><span data-stu-id="1ac80-139">**Packet 6:  SMB\_COM\_OPEN\_ANDX**</span></span><br/> <span data-ttu-id="1ac80-140">**Richtung:** Client zu Server</span><span class="sxs-lookup"><span data-stu-id="1ac80-140">**Direction:** Client to server</span></span><br/> <span data-ttu-id="1ac80-141">**Beschreibung:** Der Client fordert den Server auf, eine Datei auf der Freigabe zu öffnen, auf die im Auftrag des Clients zugegriffen wird.</span><span class="sxs-lookup"><span data-stu-id="1ac80-141">**Description:** The client requests the server to open a file on the accessed share on behalf of the client.</span></span> <span data-ttu-id="1ac80-142">Dieses Paket enthält den Namen der Datei, die geöffnet werden soll.</span><span class="sxs-lookup"><span data-stu-id="1ac80-142">This packet contains the name of the file to be opened.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                   |
| <span data-ttu-id="1ac80-143">**Paket 7: SMB \_ com \_ Open \_ AndX**</span><span class="sxs-lookup"><span data-stu-id="1ac80-143">**Packet 7:  SMB\_COM\_OPEN\_ANDX**</span></span><br/> <span data-ttu-id="1ac80-144">**Richtung:** Server zu Client</span><span class="sxs-lookup"><span data-stu-id="1ac80-144">**Direction:** Server to client</span></span><br/> <span data-ttu-id="1ac80-145">**Beschreibung:** Wenn der Zugriff auf die Datei gewährt wird, gibt der Server die Datei-ID der angeforderten Datei zurück.</span><span class="sxs-lookup"><span data-stu-id="1ac80-145">**Description:** If access to the file is granted, then the server returns the file ID of the requested file.</span></span> <span data-ttu-id="1ac80-146">Wenn die Datei nicht vorhanden ist oder der Benutzer nicht über ausreichende Anmelde Informationen für den Zugriff auf die Datei verfügt, gibt der Server in diesem Paket einen Fehlercode zurück und verweigert den Zugriff auf die Datei.</span><span class="sxs-lookup"><span data-stu-id="1ac80-146">If the file does not exist or the user has insufficient credentials to access the file, the server will return an error code in this packet and deny access to the file.</span></span><br/>                                                                                                                                                                                                                                                  |
| <span data-ttu-id="1ac80-147">**Paket 8: SMB \_ com \_ Read \_ AndX**</span><span class="sxs-lookup"><span data-stu-id="1ac80-147">**Packet 8:  SMB\_COM\_READ\_ANDX**</span></span><br/> <span data-ttu-id="1ac80-148">**Richtung:** Client zu Server</span><span class="sxs-lookup"><span data-stu-id="1ac80-148">**Direction:** Client to server</span></span><br/> <span data-ttu-id="1ac80-149">**Beschreibung:** Der Client fordert den Server auf, Daten aus der geöffneten Datei im Namen des Clients zu lesen und diese Daten an den Client zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="1ac80-149">**Description:** The client requests the server to read data from the opened file on behalf of the client and return this data to the client.</span></span> <span data-ttu-id="1ac80-150">Die Datei-ID, die vom Client beim Öffnen der Datei abgerufen wird, ist in diesem Paket enthalten, um zu ermitteln, von welcher geöffneten Datei der Serverdaten lesen soll.</span><span class="sxs-lookup"><span data-stu-id="1ac80-150">The file ID that is obtained by the client when the file was opened is included in this packet in order to identify which opened file the server should read data from.</span></span><br/>                                                                                                                                                                                                                   |
| <span data-ttu-id="1ac80-151">**Paket 9: SMB \_ com \_ Read \_ AndX**</span><span class="sxs-lookup"><span data-stu-id="1ac80-151">**Packet 9:  SMB\_COM\_READ\_ANDX**</span></span><br/> <span data-ttu-id="1ac80-152">**Richtung:** Server zu Client</span><span class="sxs-lookup"><span data-stu-id="1ac80-152">**Direction:** Server to client</span></span><br/> <span data-ttu-id="1ac80-153">**Beschreibung:** Der Server gibt die angeforderten Datei Daten in diesem Paket zurück.</span><span class="sxs-lookup"><span data-stu-id="1ac80-153">**Description:** The server returns the requested file data in this packet.</span></span> <span data-ttu-id="1ac80-154">Ein Fehler ist hier unwahrscheinlich, wenn der Zugriff auf den Server, die Freigabe und die Datei gewährt wurde.</span><span class="sxs-lookup"><span data-stu-id="1ac80-154">An error here is unlikely given that access to the server, share, and file has been granted.</span></span> <span data-ttu-id="1ac80-155">Dies kann in einigen Situationen vorkommen: z. b. wenn der Zugriff auf eine Freigabe zwischen dem Zeitpunkt, zu dem die Datei geöffnet wird, und dem Zeitpunkt, zu dem Sie gelesen wird, geändert wird.</span><span class="sxs-lookup"><span data-stu-id="1ac80-155">It can happen in some situations, however: for example, if access to a share is changed between the time the file is opened and the time it is read from.</span></span><br/>                                                                                                                                                                                                      |



 

> [!Note]  
> <span data-ttu-id="1ac80-156">Wenn Sie einen CIFS implementieren, der keine Änderungs Benachrichtigungen unterstützt, kann Windows einen ausstehenden Handle für das Dateisystem nicht aufbewahren, und die SMB-Verbindung kann ohne vorherige Ankündigung Weg gehen.</span><span class="sxs-lookup"><span data-stu-id="1ac80-156">If you implement a CIFS that does not support change notifications, Windows cannot keep an outstanding handle to the file system, and the SMB connection can go away without notice.</span></span>

 

 

 




