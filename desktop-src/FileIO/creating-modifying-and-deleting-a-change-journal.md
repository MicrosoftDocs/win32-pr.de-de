---
description: Administratoren können Änderungs Journale erstellen, löschen und neu erstellen.
ms.assetid: 26cbacc2-d26b-434b-91b5-31aedc96da13
title: Erstellen, ändern und Löschen eines Änderungs Journals
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 50c8cf7296f93549e7d9ec05f5d614131cc342ce
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "106355334"
---
# <a name="creating-modifying-and-deleting-a-change-journal"></a><span data-ttu-id="6bfe7-103">Erstellen, ändern und Löschen eines Änderungs Journals</span><span class="sxs-lookup"><span data-stu-id="6bfe7-103">Creating, Modifying, and Deleting a Change Journal</span></span>

<span data-ttu-id="6bfe7-104">Administratoren können Änderungs Journale bei der Erstellung erstellen, löschen und neu erstellen.</span><span class="sxs-lookup"><span data-stu-id="6bfe7-104">Administrators can create, delete, and re-create change journals at will.</span></span> <span data-ttu-id="6bfe7-105">Ein Administrator sollte ein Journal löschen, wenn der aktuelle Wert für die Aktualisierungs Sequenznummer den maximal möglichen Wert für die Aktualisierungs Sequenznummer erreicht, wie vom **maxun** -Member der Datenstruktur des [**\_ Datenblatts " \_ Daten**](/windows/desktop/api/WinIoCtl/ns-winioctl-usn_journal_data_v0) " angezeigt.</span><span class="sxs-lookup"><span data-stu-id="6bfe7-105">An administrator should delete a journal when the current update sequence number (USN) value approaches the maximum possible USN value, as indicated by the **MaxUsn** member of the [**USN\_JOURNAL\_DATA**](/windows/desktop/api/WinIoCtl/ns-winioctl-usn_journal_data_v0) structure.</span></span> <span data-ttu-id="6bfe7-106">Ein Administrator kann auch ein Änderungs Journal löschen und neu erstellen, um Speicherplatz freizugeben.</span><span class="sxs-lookup"><span data-stu-id="6bfe7-106">An administrator might also delete and re-create a change journal to reclaim disk space.</span></span> <span data-ttu-id="6bfe7-107">Um dies und alle anderen nicht programmatischen Änderungs Journal Vorgänge auszuführen, müssen Sie über Systemadministrator Rechte verfügen.</span><span class="sxs-lookup"><span data-stu-id="6bfe7-107">To perform this and all other non-programmatic change journal operations, you must have system administrator privileges.</span></span> <span data-ttu-id="6bfe7-108">Das heißt, Sie müssen Mitglied der Gruppe "Administratoren" sein.</span><span class="sxs-lookup"><span data-stu-id="6bfe7-108">That is, you must be a member of the Administrators group.</span></span>

<span data-ttu-id="6bfe7-109">Zum programmgesteuerten Erstellen oder Ändern eines Änderungs Journals auf einem angegebenen Volume verwenden Sie den [**FSCTL \_ Create \_ \_**](/windows/win32/api/winioctl/ni-winioctl-fsctl_create_usn_journal) -Steuerelement-Steuerelement Code.</span><span class="sxs-lookup"><span data-stu-id="6bfe7-109">To create or modify a change journal on a specified volume programmatically, use the [**FSCTL\_CREATE\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_create_usn_journal) control code.</span></span>

<span data-ttu-id="6bfe7-110">Wenn Sie ein neues Änderungs Journal erstellen oder ein vorhandenes Änderungs Journal ändern, legt das NTFS-Dateisystem Informationen für dieses Änderungs Journal von den Informationen in der Datenstruktur des [**Create- \_ \_ Daten \_ Journal**](/windows/desktop/api/WinIoCtl/ns-winioctl-create_usn_journal_data) fest, die vom [**fisctl Create-Daten \_ \_ \_ Journal**](/windows/win32/api/winioctl/ni-winioctl-fsctl_create_usn_journal) als Eingabe benötigt wird.</span><span class="sxs-lookup"><span data-stu-id="6bfe7-110">When you create a new change journal or modify an existing one, the NTFS file system sets information for that change journal from information in the [**CREATE\_USN\_JOURNAL\_DATA**](/windows/desktop/api/WinIoCtl/ns-winioctl-create_usn_journal_data) structure, which [**FSCTL\_CREATE\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_create_usn_journal) takes as input.</span></span> <span data-ttu-id="6bfe7-111">**Erstellen \_ Sie Die Daten für das \_ \_ Datenblatt des Datenblatts** haben die Mitglieder **MaximumSize** und **Zuweisung**.</span><span class="sxs-lookup"><span data-stu-id="6bfe7-111">**CREATE\_USN\_JOURNAL\_DATA** has the members **MaximumSize** and **AllocationDelta**.</span></span>

<span data-ttu-id="6bfe7-112">**MaximumSize** ist die Ziel maximale Größe für das Änderungs Journal (in Bytes).</span><span class="sxs-lookup"><span data-stu-id="6bfe7-112">**MaximumSize** is the target maximum size for the change journal in bytes.</span></span> <span data-ttu-id="6bfe7-113">Das Änderungs Journal kann größer als dieser Wert sein. bei Prüfpunkten des NTFS-Dateisystems prüft das NTFS-Dateisystem jedoch das Journal und schneidet es ab, wenn seine Größe den Wert von **MaximumSize** zuzüglich des Werts von " **Zustellungs Delta**" überschreitet.</span><span class="sxs-lookup"><span data-stu-id="6bfe7-113">The change journal can grow larger than this value, but at NTFS file system checkpoints the NTFS file system examines the journal and trims it when its size exceeds the value of **MaximumSize** plus the value of **AllocationDelta**.</span></span> <span data-ttu-id="6bfe7-114">(Bei NTFS-Dateisystem Prüfpunkten schreibt das Betriebssystem Datensätze in die NTFS-Dateisystem-Protokolldatei, die es dem NTFS-Dateisystem ermöglicht, zu bestimmen, welche Verarbeitung bei einem Fehler wieder hergestellt werden muss.)</span><span class="sxs-lookup"><span data-stu-id="6bfe7-114">(At NTFS file system checkpoints, the operating system writes records to the NTFS file system log file that allow the NTFS file system to determine what processing is required to recover from a failure.)</span></span>

<span data-ttu-id="6bfe7-115">" **Zuordnende** Bytes" gibt die Anzahl der am Ende hinzugefügten Bytes an und wird jeweils am Anfang des Änderungs Journals entfernt, wenn der Arbeitsspeicher zugeordnet oder die Zuordnung aufgehoben wird.</span><span class="sxs-lookup"><span data-stu-id="6bfe7-115">**AllocationDelta** is the number of bytes added to the end and removed from the beginning of the change journal each time memory is allocated or deallocated.</span></span> <span data-ttu-id="6bfe7-116">Anders ausgedrückt: die Zuordnung und die Aufhebung der Zuordnung erfolgt in Einheiten dieser Größe.</span><span class="sxs-lookup"><span data-stu-id="6bfe7-116">In other words, allocation and deallocation take place in units of this size.</span></span> <span data-ttu-id="6bfe7-117">Ein ganzzahliges Vielfache einer Clustergröße ist ein angemessener Wert für diesen Member.</span><span class="sxs-lookup"><span data-stu-id="6bfe7-117">An integer multiple of a cluster size is a reasonable value for this member.</span></span>

<span data-ttu-id="6bfe7-118">Wenn ein Administrator ein vorhandenes Änderungs Journal geändert hat, sodass es einen größeren **MaximumSize** -Wert hat, z. b. Wenn ein Volume zu häufig neu indiziert wird, empfängt das Änderungs Journal einfach neue Einträge, bis die neue maximale Größe überschritten wird.</span><span class="sxs-lookup"><span data-stu-id="6bfe7-118">If an administrator modifies an existing change journal to have a larger **MaximumSize** value, for example if a volume is being re-indexed too often, the change journal simply receives new entries until it exceeds the new maximum size.</span></span>

<span data-ttu-id="6bfe7-119">Zum Löschen eines Änderungs Journals verwenden Sie den [**FSCTL \_ Delete \_ \_**](/windows/win32/api/winioctl/ni-winioctl-fsctl_delete_usn_journal) -Steuerelement Code für den Löschvorgang.</span><span class="sxs-lookup"><span data-stu-id="6bfe7-119">To delete a change journal, use the [**FSCTL\_DELETE\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_delete_usn_journal) control code.</span></span> <span data-ttu-id="6bfe7-120">Wenn Sie diesen Vorgang verwenden, werden alle Dateien auf dem Volume durchlaufen und die USN für jede Datei auf 0 (null) zurückgesetzt.</span><span class="sxs-lookup"><span data-stu-id="6bfe7-120">When you use this operation, it walks through all of the files on the volume and resets the USN for each file to zero.</span></span> <span data-ttu-id="6bfe7-121">Der Vorgang löscht dann das vorhandene Änderungs Journal.</span><span class="sxs-lookup"><span data-stu-id="6bfe7-121">The operation then deletes the existing change journal.</span></span> <span data-ttu-id="6bfe7-122">Dieser Vorgang wird über Systemneustarts hinweg fortgesetzt, bis er abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="6bfe7-122">This operation persists across system restarts until it completes.</span></span> <span data-ttu-id="6bfe7-123">Bei jedem Versuch, das Änderungs Journal während dieses Prozesses zu lesen, zu erstellen oder zu ändern, tritt ein Fehler auf, dass das Fehler **\_ Journal \_ Delete \_ in \_** Bearbeitung ist.</span><span class="sxs-lookup"><span data-stu-id="6bfe7-123">Any attempt to read, create, or modify the change journal during this process fails with the error code **ERROR\_JOURNAL\_DELETE\_IN\_PROGRESS**.</span></span>

<span data-ttu-id="6bfe7-124">Sie können auch den Code des [**FSCTL \_ Delete \_ USN \_ Journal**](/windows/win32/api/winioctl/ni-winioctl-fsctl_delete_usn_journal) -Steuer Elements verwenden, um zu bestimmen, ob ein Löschvorgang ausgeführt wird, der von einem anderen Prozess gestartet wird.</span><span class="sxs-lookup"><span data-stu-id="6bfe7-124">You can also use the [**FSCTL\_DELETE\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_delete_usn_journal) control code to determine if a deletion started by some other process is in progress.</span></span> <span data-ttu-id="6bfe7-125">Beispielsweise kann Ihre Anwendung, wenn Sie gestartet wird, ermitteln, ob ein Löschvorgang ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="6bfe7-125">For example, your application, when it is started, can determine if a deletion is in progress.</span></span> <span data-ttu-id="6bfe7-126">Da Journal Löschungen über Systemneustarts hinweg beibehalten werden, sollten beim Systemneustart gestartete Dienste und Anwendungen nach einem laufenden Löschvorgang suchen.</span><span class="sxs-lookup"><span data-stu-id="6bfe7-126">Because journal deletions persist across system restarts, services and applications started at system restart should check for an ongoing deletion.</span></span>

<span data-ttu-id="6bfe7-127">Änderungs Journale werden nicht notwendigerweise beim Start erstellt.</span><span class="sxs-lookup"><span data-stu-id="6bfe7-127">Change journals are not necessarily created at startup.</span></span> <span data-ttu-id="6bfe7-128">Zum Erstellen eines Änderungs Journals kann ein Administrator dies explizit durchführen oder einen anderen Dienst starten, für den ein Änderungs Journal erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="6bfe7-128">To create a change journal, an administrator may do so explicitly or start another service that requires a change journal.</span></span>

 

 
