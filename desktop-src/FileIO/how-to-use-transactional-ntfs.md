---
description: Verwalten von transaktiven Datei Handles in Transaktions-NTFS.
ms.assetid: 29879a3f-14b4-462c-a001-46c3c3eb74d1
title: Verwenden von transaktionalen NTFS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 43681f0d5b27f0db03d8b6c44564b792fce4b467
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "106351520"
---
# <a name="how-to-use-transactional-ntfs"></a><span data-ttu-id="c81bb-103">Verwenden von transaktionalen NTFS</span><span class="sxs-lookup"><span data-stu-id="c81bb-103">How to Use Transactional NTFS</span></span>

## <a name="transacted-file-handles"></a><span data-ttu-id="c81bb-104">Transaktive Datei Handles</span><span class="sxs-lookup"><span data-stu-id="c81bb-104">Transacted File Handles</span></span>

<span data-ttu-id="c81bb-105">Transaktionale NTFS (TxF) bindet ein Datei Handle an eine Transaktion.</span><span class="sxs-lookup"><span data-stu-id="c81bb-105">Transactional NTFS (TxF) binds a file handle to a transaction.</span></span> <span data-ttu-id="c81bb-106">Bei Vorgängen, die an einem Handle arbeiten (z. b. die Funktionen "read [**File**](/windows/desktop/api/FileAPI/nf-fileapi-readfile) " und " [**Write File**](/windows/desktop/api/FileAPI/nf-fileapi-writefile) "), wird der tatsächliche API-Funktions Aufrufwert nicht geändert.</span><span class="sxs-lookup"><span data-stu-id="c81bb-106">For operations that work on a handle (for example, the [**ReadFile**](/windows/desktop/api/FileAPI/nf-fileapi-readfile) and [**WriteFile**](/windows/desktop/api/FileAPI/nf-fileapi-writefile) functions), the actual API function call does not change.</span></span> <span data-ttu-id="c81bb-107">Bei Datei Vorgängen, die einen Namen annehmen, gibt es explizite transaktive Funktionen für diese Vorgänge.</span><span class="sxs-lookup"><span data-stu-id="c81bb-107">For file operations that take a name, there are explicit transacted functions for these operations.</span></span> <span data-ttu-id="c81bb-108">Rufen Sie z. b. [**createfiletranshandelten**](/windows/desktop/api/WinBase/nf-winbase-createfiletransacteda)auf, anstatt [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea)aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="c81bb-108">For example, instead of calling [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea), call [**CreateFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-createfiletransacteda).</span></span> <span data-ttu-id="c81bb-109">Dadurch wird ein transaktives Datei Handle erstellt, das dann für alle Datei Vorgänge verwendet werden kann, die ein Handle erfordern.</span><span class="sxs-lookup"><span data-stu-id="c81bb-109">This creates a transacted file handle, which can then be used for all file operations requiring a handle.</span></span> <span data-ttu-id="c81bb-110">Alle nachfolgenden Vorgänge, die dieses Handle verwenden, sind transaktive Vorgänge.</span><span class="sxs-lookup"><span data-stu-id="c81bb-110">All subsequent operations using this handle are transacted operations.</span></span>

## <a name="basic-txf-usage"></a><span data-ttu-id="c81bb-111">Grundlegende TxF-Verwendung</span><span class="sxs-lookup"><span data-stu-id="c81bb-111">Basic TxF Usage</span></span>

<span data-ttu-id="c81bb-112">Die folgenden Schritte sind die grundlegende Verwendung von TxF.</span><span class="sxs-lookup"><span data-stu-id="c81bb-112">The following series of steps represents the most basic usage for TxF.</span></span> <span data-ttu-id="c81bb-113">Komplexere Szenarien werden auch unter dem Ermessen des Anwendungs-Designers unterstützt.</span><span class="sxs-lookup"><span data-stu-id="c81bb-113">More complex scenarios are also supported, at the discretion of the application designer.</span></span>

1.  <span data-ttu-id="c81bb-114">Erstellen Sie eine Transaktion, indem Sie die KTM-Funktion [**CreateTransaction**](/windows/desktop/api/ktmw32/nf-ktmw32-createtransaction) aufrufen, oder indem Sie die **IKernelTransaction** -Schnittstelle des [Distributed Transaction Coordinator](/previous-versions/windows/desktop/mscs/distributed-transaction-coordinator) (DTC) verwenden.</span><span class="sxs-lookup"><span data-stu-id="c81bb-114">Create a transaction by calling the KTM function [**CreateTransaction**](/windows/desktop/api/ktmw32/nf-ktmw32-createtransaction) or by using the **IKernelTransaction** interface of the [Distributed Transaction Coordinator](/previous-versions/windows/desktop/mscs/distributed-transaction-coordinator) (DTC).</span></span>
2.  <span data-ttu-id="c81bb-115">Abrufen von transaktiven Datei Handles durch Aufrufen von [**createfiletranshandelten**](/windows/desktop/api/WinBase/nf-winbase-createfiletransacteda).</span><span class="sxs-lookup"><span data-stu-id="c81bb-115">Get transacted file handle(s) by calling [**CreateFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-createfiletransacteda).</span></span>
3.  <span data-ttu-id="c81bb-116">Ändern Sie die Dateien nach Bedarf mithilfe der transaktiven Datei Handle (en).</span><span class="sxs-lookup"><span data-stu-id="c81bb-116">Modify the file(s) as necessary using the transacted file handle(s).</span></span>
4.  <span data-ttu-id="c81bb-117">Schließen Sie alle Transaktions Datei Handles, die mit der in Schritt 1 erstellten Transaktion verknüpft sind.</span><span class="sxs-lookup"><span data-stu-id="c81bb-117">Close all transacted file handles associated with the transaction created in step 1.</span></span>
5.  <span data-ttu-id="c81bb-118">Commit oder Abbruch der Transaktion durch Aufrufen der entsprechenden KTM-oder DTC-Funktion.</span><span class="sxs-lookup"><span data-stu-id="c81bb-118">Commit or abort the transaction by calling the corresponding KTM or DTC function.</span></span>

## <a name="key-points-of-the-txf-programming-model"></a><span data-ttu-id="c81bb-119">Wichtige Punkte des TxF-Programmiermodells</span><span class="sxs-lookup"><span data-stu-id="c81bb-119">Key Points of the TxF Programming Model</span></span>

<span data-ttu-id="c81bb-120">Das TxF-Programmiermodell bietet die folgenden wichtigen Punkte, die Sie beim Entwickeln einer TxF-Anwendung beachten sollten:</span><span class="sxs-lookup"><span data-stu-id="c81bb-120">The TxF programming model has the following key points for you to consider when you develop a TxF application:</span></span>

-   <span data-ttu-id="c81bb-121">Es wird dringend empfohlen, dass eine Anwendung alle Transaktions Datei Handles schließt, bevor ein Commit oder Rollback einer Transaktion ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="c81bb-121">It is highly recommended that an application close all transacted file handles before committing or rolling back a transaction.</span></span> <span data-ttu-id="c81bb-122">Das System macht alle Transaktions Handles ungültig, wenn eine Transaktion beendet wird.</span><span class="sxs-lookup"><span data-stu-id="c81bb-122">The system invalidates all transacted handles when a transaction ends.</span></span> <span data-ttu-id="c81bb-123">Jeder Vorgang, außer Close, wird für ein transaktives Handle nach Ende der Transaktion ausgeführt, gibt den folgenden Fehler zurück: das **Fehler \_ handle ist \_ nicht \_ mehr \_ gültig**.</span><span class="sxs-lookup"><span data-stu-id="c81bb-123">Any operation, except close, performed on a transacted handle after the transaction ends returns the following error: **ERROR\_HANDLE\_NO\_LONGER\_VALID**.</span></span>
-   <span data-ttu-id="c81bb-124">Eine Datei wird als Speichereinheit angezeigt.</span><span class="sxs-lookup"><span data-stu-id="c81bb-124">A file is viewed as a unit of storage.</span></span> <span data-ttu-id="c81bb-125">Teil Updates und vollständige über schreibungen von Dateien werden unterstützt.</span><span class="sxs-lookup"><span data-stu-id="c81bb-125">Partial updates and complete file overwrites are supported.</span></span> <span data-ttu-id="c81bb-126">Mehrere Transaktionen können dieselbe Datei nicht gleichzeitig ändern.</span><span class="sxs-lookup"><span data-stu-id="c81bb-126">Multiple transactions cannot concurrently modify the same file.</span></span>
-   <span data-ttu-id="c81bb-127">Die Speicher Abbild-e/a ist transparent und konsistent mit der regulären Datei-e/a.</span><span class="sxs-lookup"><span data-stu-id="c81bb-127">Memory mapped I/O is transparent and consistent with the regular file I/O.</span></span> <span data-ttu-id="c81bb-128">Eine Anwendung muss einen geöffneten Abschnitt leeren und schließen, bevor ein Commit für eine Transaktion ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="c81bb-128">An application must flush and close an opened section before committing a transaction.</span></span> <span data-ttu-id="c81bb-129">Wenn dies nicht der Fall ist, kann dies zu partiellen Änderungen an der zugeordneten Datei innerhalb der Transaktion führen.</span><span class="sxs-lookup"><span data-stu-id="c81bb-129">Failure to do this can result in partial changes to the mapped file within the transaction.</span></span> <span data-ttu-id="c81bb-130">Ein Rollback schlägt fehl, wenn dies nicht der Fall ist.</span><span class="sxs-lookup"><span data-stu-id="c81bb-130">A rollback fails if this is not done.</span></span>

## <a name="common-programming-errors"></a><span data-ttu-id="c81bb-131">Allgemeine Programmierfehler</span><span class="sxs-lookup"><span data-stu-id="c81bb-131">Common Programming Errors</span></span>

<span data-ttu-id="c81bb-132">Folgende häufige Fehler können bei der Entwicklung von transaktiven Anwendungen auftreten:</span><span class="sxs-lookup"><span data-stu-id="c81bb-132">The following common errors can occur when developing transacted applications:</span></span>

-   <span data-ttu-id="c81bb-133">Verwenden eines Datei Handles, nachdem eine Transaktion abgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="c81bb-133">Using a file handle after a transaction is completed.</span></span>
-   <span data-ttu-id="c81bb-134">Fehler beim Schließen von Handles in gelöschten Dateien und Verzeichnissen, bevor ein Commit für eine Transaktion ausgeführt wird. Dadurch wird verhindert, dass Löschvorgänge ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="c81bb-134">Failing to close handles to deleted files and directories before committing a transaction, which will prevent the delete operations from occurring.</span></span> <span data-ttu-id="c81bb-135">Dieses Ereignis muss eintreten, bevor der Commit für den Löschvorgang ausgeführt wird, um als Teil der Transaktion angesehen zu werden.</span><span class="sxs-lookup"><span data-stu-id="c81bb-135">This event must occur before performing the commit for the delete operation to be considered part of the transaction.</span></span> <span data-ttu-id="c81bb-136">Dies liegt daran, dass das System eine Datei erst dann löscht, wenn das letzte Handle geschlossen wurde, auch wenn der Vorgang nicht als Teil des Windows-Datei-e/a-Subsystems behandelt wird.</span><span class="sxs-lookup"><span data-stu-id="c81bb-136">This is because the system does not actually delete a file until the last handle to it is closed, even when the operation is not transacted, as part of the Windows file I/O subsystem.</span></span>
-   <span data-ttu-id="c81bb-137">Fehler beim berücksichtigen der vom System initiierten Transaktions Rollbacks, die zu einem beliebigen Zeitpunkt auftreten können. Beispielsweise wird für eine Transaktion ein Rollback ausgeführt, wenn die Systemressourcen erschöpft sind.</span><span class="sxs-lookup"><span data-stu-id="c81bb-137">Failing to account for system-initiated transaction rollbacks, which may happen at any time; for example, a transaction is rolled back if the system resources are exhausted.</span></span>

 

 
