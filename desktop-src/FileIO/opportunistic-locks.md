---
description: Eine opportunistische Sperre (auch als "Oplock" bezeichnet) ist eine Sperre, die von einem Client in einer Datei, die sich auf einem Server befindet, platziert wird.
ms.assetid: b4c2f5f0-a29b-4598-a49b-da99e93d2991
title: Opportunistische Sperren
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: faec833caae05bff247a7a3655885b1a967f3435
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "103752400"
---
# <a name="opportunistic-locks"></a><span data-ttu-id="fe926-103">Opportunistische Sperren</span><span class="sxs-lookup"><span data-stu-id="fe926-103">Opportunistic Locks</span></span>

<span data-ttu-id="fe926-104">Eine opportunistische Sperre (auch als "Oplock" bezeichnet) ist eine Sperre, die von einem Client in einer Datei, die sich auf einem Server befindet, platziert wird.</span><span class="sxs-lookup"><span data-stu-id="fe926-104">An opportunistic lock (also called an oplock) is a lock placed by a client on a file residing on a server.</span></span> <span data-ttu-id="fe926-105">In den meisten Fällen fordert ein Client eine opportunistische Sperre an, damit Daten lokal zwischengespeichert werden können, wodurch der Netzwerkverkehr reduziert und die offensichtliche Reaktionszeit verbessert wird.</span><span class="sxs-lookup"><span data-stu-id="fe926-105">In most cases, a client requests an opportunistic lock so it can cache data locally, thus reducing network traffic and improving apparent response time.</span></span> <span data-ttu-id="fe926-106">Opportunistische Sperren werden von netzwerkredirectors auf Clients mit Remote Servern sowie von Client Anwendungen auf lokalen Servern verwendet.</span><span class="sxs-lookup"><span data-stu-id="fe926-106">Opportunistic locks are used by network redirectors on clients with remote servers, as well as by client applications on local servers.</span></span>

<span data-ttu-id="fe926-107">Opportunistische Sperren koordinieren das Zwischenspeichern von Daten und die Kohärenz zwischen Clients und Servern sowie zwischen mehreren Clients.</span><span class="sxs-lookup"><span data-stu-id="fe926-107">Opportunistic locks coordinate data caching and coherency between clients and servers and among multiple clients.</span></span> <span data-ttu-id="fe926-108">Daten, die kohärent sind, sind Daten, die im gesamten Netzwerk identisch sind.</span><span class="sxs-lookup"><span data-stu-id="fe926-108">Data that is coherent is data that is the same across the network.</span></span> <span data-ttu-id="fe926-109">Anders ausgedrückt: Wenn Daten kohärent sind, werden die Daten auf dem Server und allen Clients synchronisiert.</span><span class="sxs-lookup"><span data-stu-id="fe926-109">In other words, if data is coherent, data on the server and all the clients is synchronized.</span></span>

<span data-ttu-id="fe926-110">Opportunistische Sperren sind keine Befehle vom Client zum Server.</span><span class="sxs-lookup"><span data-stu-id="fe926-110">Opportunistic locks are not commands by the client to the server.</span></span> <span data-ttu-id="fe926-111">Dabei handelt es sich um Anforderungen vom Client an den Server.</span><span class="sxs-lookup"><span data-stu-id="fe926-111">They are requests from the client to the server.</span></span> <span data-ttu-id="fe926-112">Aus Sicht des Clients sind Sie opportunistisch.</span><span class="sxs-lookup"><span data-stu-id="fe926-112">From the point of view of the client, they are opportunistic.</span></span> <span data-ttu-id="fe926-113">Das heißt, der Server gewährt solche Sperren, wenn andere Faktoren die Sperren ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="fe926-113">In other words, the server grants such locks whenever other factors make the locks possible.</span></span>

<span data-ttu-id="fe926-114">Wenn eine lokale Anwendung den Zugriff auf eine Remote Datei anfordert, ist die Implementierung von opportunistischen Sperren für die Anwendung transparent.</span><span class="sxs-lookup"><span data-stu-id="fe926-114">When a local application requests access to a remote file, the implementation of opportunistic locks is transparent to the application.</span></span> <span data-ttu-id="fe926-115">Der Netzwerkredirector und der Beteiligte Server öffnen und schließen die opportunistischen Sperren automatisch.</span><span class="sxs-lookup"><span data-stu-id="fe926-115">The network redirector and the server involved open and close the opportunistic locks automatically.</span></span> <span data-ttu-id="fe926-116">Opportunistische Sperren können jedoch auch verwendet werden, wenn eine lokale Anwendung den Zugriff auf eine lokale Datei anfordert und der Zugriff durch andere Anwendungen und Prozesse delegiert werden muss, um eine Beschädigung der Datei zu verhindern.</span><span class="sxs-lookup"><span data-stu-id="fe926-116">However, opportunistic locks can also be used when a local application requests access to a local file, and access by other applications and processes must be delegated to prevent corruption of the file.</span></span> <span data-ttu-id="fe926-117">In diesem Fall fordert die lokale Anwendung direkt eine opportunistische Sperre aus dem lokalen Dateisystem an und speichert die Datei lokal zwischen.</span><span class="sxs-lookup"><span data-stu-id="fe926-117">In this case, the local application directly requests an opportunistic lock from the local file system and caches the file locally.</span></span> <span data-ttu-id="fe926-118">Wenn Sie auf diese Weise verwendet wird, ist die opportunistische Sperre tatsächlich ein Semaphor, das vom lokalen Server verwaltet wird. Sie wird hauptsächlich für die Datenkonsistenz in der Datei-und Datei Zugriffs Benachrichtigung verwendet.</span><span class="sxs-lookup"><span data-stu-id="fe926-118">When used in this way, the opportunistic lock is effectively a semaphore managed by the local server, and is mainly used for the purposes of data coherency in the file and file access notification.</span></span>

<span data-ttu-id="fe926-119">Bevor Sie opportunistische Sperren in Ihrer Anwendung verwenden können, sollten Sie mit den Datei Zugriffs-und Freigabe Modi vertraut sein, die unter [Erstellen und Öffnen von Dateien](creating-and-opening-files.md)beschrieben werden.</span><span class="sxs-lookup"><span data-stu-id="fe926-119">Before using opportunistic locks in your application, you should be familiar with the file access and sharing modes described in [Creating and Opening Files](creating-and-opening-files.md).</span></span>

<span data-ttu-id="fe926-120">Die maximale Anzahl von gleichzeitigen opportunistischen Sperren, die Sie erstellen können, ist nur durch die Menge des verfügbaren Arbeitsspeichers beschränkt.</span><span class="sxs-lookup"><span data-stu-id="fe926-120">The maximum number of concurrent opportunistic locks that you can create is limited only by the amount of available memory.</span></span>

<span data-ttu-id="fe926-121">Lokale Anwendungen sollten nicht versuchen, opportunistische Sperren von Remote Servern anzufordern.</span><span class="sxs-lookup"><span data-stu-id="fe926-121">Local applications should not attempt to request opportunistic locks from remote servers.</span></span> <span data-ttu-id="fe926-122">[**DeviceIoControl**](/windows/desktop/api/ioapiset/nf-ioapiset-deviceiocontrol) wird ein Fehler zurückgegeben, wenn versucht wird, dies zu tun.</span><span class="sxs-lookup"><span data-stu-id="fe926-122">An error will be returned by [**DeviceIoControl**](/windows/desktop/api/ioapiset/nf-ioapiset-deviceiocontrol) if an attempt is made to do this.</span></span>

<span data-ttu-id="fe926-123">Opportunistische Sperren sind für Anwendungen sehr eingeschränkt.</span><span class="sxs-lookup"><span data-stu-id="fe926-123">Opportunistic locks are of very limited use for applications.</span></span> <span data-ttu-id="fe926-124">Der einzige praktische Verwendungszweck ist das Testen eines netzwerkredirectors oder eines Server opportunistischen Lock-Handlers.</span><span class="sxs-lookup"><span data-stu-id="fe926-124">The only practical use is to test a network redirector or a server opportunistic lock handler.</span></span> <span data-ttu-id="fe926-125">In der Regel implementieren Dateisysteme Unterstützung für opportunistische sperren.</span><span class="sxs-lookup"><span data-stu-id="fe926-125">Typically, file systems implement support for opportunistic locks.</span></span> <span data-ttu-id="fe926-126">Anwendungen lassen die opportunistische Sperr Verwaltung in der Regel auf die Dateisystem Treiber aus.</span><span class="sxs-lookup"><span data-stu-id="fe926-126">Applications generally leave opportunistic lock management to the file system drivers.</span></span> <span data-ttu-id="fe926-127">Jeder, der ein Dateisystem implementiert, sollte das [IFS-Kit (Installable File System)](https://www.microsoft.com/whdc/devtools/ifskit/default.mspx)verwenden.</span><span class="sxs-lookup"><span data-stu-id="fe926-127">Anyone implementing a file system should use the [Installable File System (IFS) Kit](https://www.microsoft.com/whdc/devtools/ifskit/default.mspx).</span></span> <span data-ttu-id="fe926-128">Jeder, der einen anderen Gerätetreiber als ein installier bares Dateisystem entwickelt, sollte das [Windows-Treiberkit (WDK)](https://www.microsoft.com/?ref=go)verwenden.</span><span class="sxs-lookup"><span data-stu-id="fe926-128">Anyone developing a device driver other than an installable file system should use the [Windows Driver Kit (WDK)](https://www.microsoft.com/?ref=go).</span></span>

<span data-ttu-id="fe926-129">Opportunistische Sperren und die zugehörigen Vorgänge stellen eine übergeordnete Komponente des opportunistischen Sperr Teils des CIFS-Protokolls (Common Internet File System) dar, einem Internet Entwurf.</span><span class="sxs-lookup"><span data-stu-id="fe926-129">Opportunistic locks and the associated operations are a superset of the opportunistic lock portion of the Common Internet File System (CIFS) protocol, an Internet Draft.</span></span> <span data-ttu-id="fe926-130">Das CIFS-Protokoll ist eine erweiterte Version des SMB-Protokolls (Server Message Block).</span><span class="sxs-lookup"><span data-stu-id="fe926-130">The CIFS protocol is an enhanced version of the Server Message Block (SMB) protocol.</span></span> <span data-ttu-id="fe926-131">Weitere Informationen finden Sie unter [Übersicht über das Microsoft SMB-Protokoll und CIFS-Protokoll](microsoft-smb-protocol-and-cifs-protocol-overview.md).</span><span class="sxs-lookup"><span data-stu-id="fe926-131">For more information, see [Microsoft SMB Protocol and CIFS Protocol Overview](microsoft-smb-protocol-and-cifs-protocol-overview.md).</span></span> <span data-ttu-id="fe926-132">Der CIFS-Internet Entwurf identifiziert explizit, dass eine CIFS-Implementierung opportunistische Sperren implementieren kann, indem er sie ablehnt.</span><span class="sxs-lookup"><span data-stu-id="fe926-132">The CIFS Internet Draft explicitly identifies that a CIFS implementation may implement opportunistic locks by refusing to grant them.</span></span>

<span data-ttu-id="fe926-133">In den folgenden Themen werden opportunistische Sperren identifiziert.</span><span class="sxs-lookup"><span data-stu-id="fe926-133">The following topics identify opportunistic locks.</span></span>

## <a name="in-this-section"></a><span data-ttu-id="fe926-134">In diesem Abschnitt</span><span class="sxs-lookup"><span data-stu-id="fe926-134">In this section</span></span>



| <span data-ttu-id="fe926-135">Thema</span><span class="sxs-lookup"><span data-stu-id="fe926-135">Topic</span></span>                                                                                                               | <span data-ttu-id="fe926-136">BESCHREIBUNG</span><span class="sxs-lookup"><span data-stu-id="fe926-136">Description</span></span>                                                                                                                                                                                                                                                                                       |
|---------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="fe926-137">Lokales Caching</span><span class="sxs-lookup"><span data-stu-id="fe926-137">Local Caching</span></span>](local-caching.md)<br/>                                                                       | <span data-ttu-id="fe926-138">Das *lokale Zwischenspeichern* von Daten ist eine Technik, mit der der Netzwerk Zugriff auf Datendateien beschleunigt werden kann.</span><span class="sxs-lookup"><span data-stu-id="fe926-138">*Local caching* of data is a technique used to speed network access to data files.</span></span> <span data-ttu-id="fe926-139">Dies umfasst das Zwischenspeichern von Daten auf Clients und nicht auf Servern, wenn dies möglich ist.</span><span class="sxs-lookup"><span data-stu-id="fe926-139">It involves caching data on clients rather than on servers when possible.</span></span><br/>                                                                                                                           |
| [<span data-ttu-id="fe926-140">Datenkohärenz</span><span class="sxs-lookup"><span data-stu-id="fe926-140">Data Coherency</span></span>](data-coherency.md)<br/>                                                                     | <span data-ttu-id="fe926-141">Wenn die Daten kohärent sind, werden die Daten auf dem Server und alle Clients synchronisiert.</span><span class="sxs-lookup"><span data-stu-id="fe926-141">If data is coherent, data on the server and all the clients is synchronized.</span></span> <span data-ttu-id="fe926-142">Eine Art von Softwaresystem, das Datenkonsistenz bereitstellt, ist ein Revisions Steuerungssystem (RCS).</span><span class="sxs-lookup"><span data-stu-id="fe926-142">One type of software system that provides data coherency is a revision control system (RCS).</span></span><br/>                                                                                                              |
| [<span data-ttu-id="fe926-143">Anfordern einer opportunistischen Sperre</span><span class="sxs-lookup"><span data-stu-id="fe926-143">How to Request an Opportunistic Lock</span></span>](how-to-request-an-opportunistic-lock.md)<br/>                         | <span data-ttu-id="fe926-144">Opportunistische Sperren werden angefordert, indem zuerst eine Datei mit Berechtigungen und Flags geöffnet wird, die für die Anwendung geeignet sind, die die Datei öffnet.</span><span class="sxs-lookup"><span data-stu-id="fe926-144">Opportunistic locks are requested by first opening a file with permissions and flags appropriate to the application opening the file.</span></span> <span data-ttu-id="fe926-145">Alle Dateien, für die opportunistische Sperren angefordert werden, müssen für einen überlappenden (asynchronen) Vorgang geöffnet werden.</span><span class="sxs-lookup"><span data-stu-id="fe926-145">All files for which opportunistic locks will be requested must be opened for overlapped (asynchronous) operation.</span></span><br/>                                |
| [<span data-ttu-id="fe926-146">Server Antwort auf geöffnete Anforderungen für gesperrte Dateien</span><span class="sxs-lookup"><span data-stu-id="fe926-146">Server Response to Open Requests on Locked Files</span></span>](server-response-to-open-requests-on-locked-files.md)<br/> | <span data-ttu-id="fe926-147">Sie können die Auswirkung ihrer Anwendung auf andere Clients und deren Auswirkungen auf Ihre Anwendung minimieren, indem Sie so viele Freigabe Möglichkeiten wie möglich gewähren, die erforderliche Mindestzugriffsebene anfordern und die am wenigsten eindringliche opportunistische Sperre verwenden, die für Ihre Anwendung geeignet ist.</span><span class="sxs-lookup"><span data-stu-id="fe926-147">You can minimize the impact your application has on other clients and the impact they have on your application by granting as much sharing as possible, requesting the minimum access level necessary, and using the least intrusive opportunistic lock suitable for your application.</span></span><br/> |
| [<span data-ttu-id="fe926-148">Typen von opportunistischen Sperren</span><span class="sxs-lookup"><span data-stu-id="fe926-148">Types of Opportunistic Locks</span></span>](types-of-opportunistic-locks.md)<br/>                                         | <span data-ttu-id="fe926-149">Beschreibt die opportunistischen Sperren auf Ebene 1, Ebene 2, Batch und Filter.</span><span class="sxs-lookup"><span data-stu-id="fe926-149">Describes level 1, level 2, batch, and filter opportunistic locks.</span></span><br/>                                                                                                                                                                                                                     |
| [<span data-ttu-id="fe926-150">Unterbrechen opportunistischer Sperren</span><span class="sxs-lookup"><span data-stu-id="fe926-150">Breaking Opportunistic Locks</span></span>](breaking-opportunistic-locks.md)<br/>                                         | <span data-ttu-id="fe926-151">Die Unterbrechung einer opportunistischen Sperre ist der Prozess der Herabwürdigung der Sperre, die ein Client in einer Datei hat, damit ein anderer Client die Datei mit oder ohne opportunistische Sperre öffnen kann.</span><span class="sxs-lookup"><span data-stu-id="fe926-151">Breaking an opportunistic lock is the process of degrading the lock that one client has on a file so that another client can open the file, with or without an opportunistic lock.</span></span><br/>                                                                                                     |
| [<span data-ttu-id="fe926-152">Beispiele für die opportunistische Sperre</span><span class="sxs-lookup"><span data-stu-id="fe926-152">Opportunistic Lock Examples</span></span>](opportunistic-lock-examples.md)<br/>                                           | <span data-ttu-id="fe926-153">Diagramme von Netzwerkverkehrs Ansichten für eine opportunistische Sperre der Ebene 1, eine opportunistische Batch Sperre und eine opportunistische Filter-Sperre.</span><span class="sxs-lookup"><span data-stu-id="fe926-153">Diagrams of network-traffic views for a level 1 opportunistic lock, a batch opportunistic lock, and a filter opportunistic lock.</span></span><br/>                                                                                                                                                       |
| [<span data-ttu-id="fe926-154">Opportunistische Sperr Vorgänge</span><span class="sxs-lookup"><span data-stu-id="fe926-154">Opportunistic Lock Operations</span></span>](opportunistic-lock-operations.md)<br/>                                       | <span data-ttu-id="fe926-155">Wenn eine Anwendung opportunistische Sperren anfordert, müssen alle Dateien, für die Sie Sperren anfordert, für überlappende (asynchrone) Eingaben und Ausgaben geöffnet werden, indem [**die Funktion "**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) Funktion" mit dem überlappenden Flag für das **\_ Dateiflag \_** verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="fe926-155">If an application requests opportunistic locks, all files for which it requests locks must be opened for overlapped (asynchronous) input and output by using the [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) function with the **FILE\_FLAG\_OVERLAPPED** flag.</span></span><br/>                                   |



 

<span data-ttu-id="fe926-156">Weitere Informationen zu opportunistischen Sperren finden Sie im CIFS Internet Draft-Dokument.</span><span class="sxs-lookup"><span data-stu-id="fe926-156">For additional information about opportunistic locks, see the CIFS Internet Draft document.</span></span> <span data-ttu-id="fe926-157">Alle Diskrepanzen zwischen diesem Thema und dem aktuellen CIFS-Internet Entwurf sollten zugunsten des CIFS-Internet Entwurfs gelöst werden.</span><span class="sxs-lookup"><span data-stu-id="fe926-157">Any discrepancies between this topic and the current CIFS Internet Draft should be resolved in favor of the CIFS Internet Draft.</span></span>

 

