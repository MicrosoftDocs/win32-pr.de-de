---
description: Diagramme von Netzwerkverkehrs Ansichten für eine opportunistische Sperre der Ebene 1, eine opportunistische Batch Sperre und eine opportunistische Filter-Sperre.
ms.assetid: 78830113-b18e-40c7-8ec4-8896dbc58030
title: Beispiele für die opportunistische Sperre
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ae8b8a0c5b04897ddc2fc8f2e3bdec20f2fdb02d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "104529264"
---
# <a name="opportunistic-lock-examples"></a><span data-ttu-id="9298d-103">Beispiele für die opportunistische Sperre</span><span class="sxs-lookup"><span data-stu-id="9298d-103">Opportunistic Lock Examples</span></span>

<span data-ttu-id="9298d-104">In den folgenden Beispielen werden Daten-und SMB-Nachrichten Bewegungen angezeigt, wenn opportunistische Sperren erstellt und beschädigt werden.</span><span class="sxs-lookup"><span data-stu-id="9298d-104">The following examples show data and SMB message movements as opportunistic locks are made and broken.</span></span> <span data-ttu-id="9298d-105">Beachten Sie, dass Clients Datei Attributdaten und Datei Daten zwischenspeichern können.</span><span class="sxs-lookup"><span data-stu-id="9298d-105">Note that clients can cache file attribute data as well as file data.</span></span>

<span data-ttu-id="9298d-106">Beachten Sie auch, dass diese Beispiele auf Situationen basieren, in denen Client Anwendungen opportunistische Sperren von Remote Servern anfordern.</span><span class="sxs-lookup"><span data-stu-id="9298d-106">Also note that these examples are based on situations where client applications are requesting opportunistic locks from remote servers.</span></span> <span data-ttu-id="9298d-107">Diese Prozesse werden automatisch vom Netzwerkredirector und dem Remote Server initiiert – es gibt keine direkte Beteiligung durch die Client Anwendung oder Anwendungen.</span><span class="sxs-lookup"><span data-stu-id="9298d-107">These processes are automatically initiated by the network redirector and the remote server—there is no direct involvement by the client application or applications.</span></span> <span data-ttu-id="9298d-108">Die in diesen Beispielen beschriebenen Prozesse können in Situationen verallgemeinert werden, in denen lokale Client Anwendungen direkt opportunistische Sperren aus dem lokalen Dateisystem anfordern, mit der Ausnahme, dass kein Datenaustausch über das Netzwerk beteiligt ist.</span><span class="sxs-lookup"><span data-stu-id="9298d-108">The processes described by these examples can be generalized into situations where local client applications are directly requesting opportunistic locks from the local file system, with the exception that no exchange of data over the network is involved.</span></span>

## <a name="level-1-opportunistic-lock"></a><span data-ttu-id="9298d-109">Opportunistische Sperre der Ebene 1</span><span class="sxs-lookup"><span data-stu-id="9298d-109">Level 1 Opportunistic Lock</span></span>

<span data-ttu-id="9298d-110">Das folgende Diagramm zeigt eine Netzwerkverkehrs Ansicht einer opportunistischen Sperre auf Ebene 1 für eine Datei.</span><span class="sxs-lookup"><span data-stu-id="9298d-110">The following diagram shows a network-traffic view of a level 1 opportunistic lock on a file.</span></span> <span data-ttu-id="9298d-111">Die Pfeile geben die Richtung der Daten Verschiebung an, falls vorhanden.</span><span class="sxs-lookup"><span data-stu-id="9298d-111">The arrows indicate the direction of data movement, if any.</span></span>



| <span data-ttu-id="9298d-112">Ereignis</span><span class="sxs-lookup"><span data-stu-id="9298d-112">Event</span></span> | <span data-ttu-id="9298d-113">Client X</span><span class="sxs-lookup"><span data-stu-id="9298d-113">Client X</span></span>                                          | <span data-ttu-id="9298d-114">Server</span><span class="sxs-lookup"><span data-stu-id="9298d-114">Server</span></span>                                   | <span data-ttu-id="9298d-115">Client Y</span><span class="sxs-lookup"><span data-stu-id="9298d-115">Client Y</span></span>                                          |
|-------|---------------------------------------------------|------------------------------------------|---------------------------------------------------|
| <span data-ttu-id="9298d-116">1</span><span class="sxs-lookup"><span data-stu-id="9298d-116">1</span></span>     | <span data-ttu-id="9298d-117">Öffnet die Datei, fordert Ebene 1 Sperre = =></span><span class="sxs-lookup"><span data-stu-id="9298d-117">Opens file, requests level 1 lock ==></span></span>          |                                          |                                                   |
| <span data-ttu-id="9298d-118">2</span><span class="sxs-lookup"><span data-stu-id="9298d-118">2</span></span>     |                                                   | <span data-ttu-id="9298d-119"><= = gibt eine opportunistische Sperre der Ebene 1 aus.</span><span class="sxs-lookup"><span data-stu-id="9298d-119"><== Grants level 1 opportunistic lock</span></span> |                                                   |
| <span data-ttu-id="9298d-120">3</span><span class="sxs-lookup"><span data-stu-id="9298d-120">3</span></span>     | <span data-ttu-id="9298d-121">Führt Lese-, Schreib-und andere Vorgänge aus = =></span><span class="sxs-lookup"><span data-stu-id="9298d-121">Performs read, write, and other operations ==></span></span> |                                          |                                                   |
| <span data-ttu-id="9298d-122">4</span><span class="sxs-lookup"><span data-stu-id="9298d-122">4</span></span>     |                                                   |                                          | <span data-ttu-id="9298d-123"><= = Anforderungen zum Öffnen der Datei</span><span class="sxs-lookup"><span data-stu-id="9298d-123"><== Requests to open file</span></span>                      |
| <span data-ttu-id="9298d-124">5</span><span class="sxs-lookup"><span data-stu-id="9298d-124">5</span></span>     |                                                   | <span data-ttu-id="9298d-125"><= = opportunistische Sperre wird unterbrochen</span><span class="sxs-lookup"><span data-stu-id="9298d-125"><== Breaks opportunistic lock</span></span>         |                                                   |
| <span data-ttu-id="9298d-126">6</span><span class="sxs-lookup"><span data-stu-id="9298d-126">6</span></span>     | <span data-ttu-id="9298d-127">Verwirft Read-Ahead-Daten</span><span class="sxs-lookup"><span data-stu-id="9298d-127">Discards read-ahead data</span></span>                          |                                          |                                                   |
| <span data-ttu-id="9298d-128">7</span><span class="sxs-lookup"><span data-stu-id="9298d-128">7</span></span>     | <span data-ttu-id="9298d-129">Schreibt Data = =></span><span class="sxs-lookup"><span data-stu-id="9298d-129">Writes data ==></span></span>                                |                                          |                                                   |
| <span data-ttu-id="9298d-130">8</span><span class="sxs-lookup"><span data-stu-id="9298d-130">8</span></span>     | <span data-ttu-id="9298d-131">Sendet "Close" oder "Done" Message = =></span><span class="sxs-lookup"><span data-stu-id="9298d-131">Sends "close" or "done" message ==></span></span>            |                                          |                                                   |
| <span data-ttu-id="9298d-132">9</span><span class="sxs-lookup"><span data-stu-id="9298d-132">9</span></span>     |                                                   | <span data-ttu-id="9298d-133">Okays-Öffnungsvorgang = =></span><span class="sxs-lookup"><span data-stu-id="9298d-133">Okays open operation ==></span></span>              |                                                   |
| <span data-ttu-id="9298d-134">10</span><span class="sxs-lookup"><span data-stu-id="9298d-134">10</span></span>    | <span data-ttu-id="9298d-135">Führt Lese-, Schreib-und andere Vorgänge aus = =></span><span class="sxs-lookup"><span data-stu-id="9298d-135">Performs read, write, and other operations ==></span></span> |                                          | <span data-ttu-id="9298d-136"><= = führt Lese-, Schreib-und andere Vorgänge aus.</span><span class="sxs-lookup"><span data-stu-id="9298d-136"><== Performs read, write, and other operations</span></span> |



 

<span data-ttu-id="9298d-137">In Ereignis 1 öffnet Client X eine Datei und fordert im Rahmen des Öffnungs Vorgangs eine opportunistische Sperre der Ebene 1 für die Datei an.</span><span class="sxs-lookup"><span data-stu-id="9298d-137">In event 1, client X opens a file and as part of the open operation requests a level 1 opportunistic lock on the file.</span></span> <span data-ttu-id="9298d-138">In Ereignis 2 gewährt der Server die Sperre der Ebene 1, da die Datei von keinem anderen Client geöffnet ist.</span><span class="sxs-lookup"><span data-stu-id="9298d-138">In event 2, the server grants the level 1 lock because no other client has the file open.</span></span> <span data-ttu-id="9298d-139">Der Client greift in Ereignis 3 auf die übliche Weise auf die Datei zu.</span><span class="sxs-lookup"><span data-stu-id="9298d-139">The client proceeds to access the file in the usual manner in event 3.</span></span>

<span data-ttu-id="9298d-140">In Ereignis 4 versucht Client Y, die Datei zu öffnen und eine opportunistische Sperre zu anfordern.</span><span class="sxs-lookup"><span data-stu-id="9298d-140">In event 4, client Y attempts to open the file and requests an opportunistic lock.</span></span> <span data-ttu-id="9298d-141">Der Server sieht, dass die Datei in Client X geöffnet ist.</span><span class="sxs-lookup"><span data-stu-id="9298d-141">The server sees that client X has the file open.</span></span> <span data-ttu-id="9298d-142">Der Server ignoriert die Anforderung von Y, während der Client X alle Schreib Daten leert und den Lesecache für die Datei verlässt.</span><span class="sxs-lookup"><span data-stu-id="9298d-142">The server ignores Y's request while client X flushes any write data and abandons its read cache for the file.</span></span>

<span data-ttu-id="9298d-143">Der Server erzwingt das Bereinigen von x, indem er eine SMB-Nachricht sendet, die die opportunistische Sperre, Ereignis 5, unterbricht.</span><span class="sxs-lookup"><span data-stu-id="9298d-143">The server forces X to clean up by sending to X an SMB message breaking the opportunistic lock, event 5.</span></span> <span data-ttu-id="9298d-144">Client X "im Hintergrund" löscht alle Read-Ahead-Daten; Dies bedeutet, dass dieser Prozess keinen Netzwerk Datenverkehr generiert.</span><span class="sxs-lookup"><span data-stu-id="9298d-144">Client X "silently" discards any read-ahead data; in other words, this process generates no network traffic.</span></span> <span data-ttu-id="9298d-145">In Ereignis 7 schreibt Client X alle zwischengespeicherten Schreib Daten auf den Server.</span><span class="sxs-lookup"><span data-stu-id="9298d-145">In event 7, client X writes any cached write data to the server.</span></span> <span data-ttu-id="9298d-146">Wenn Client x das Schreiben zwischen gespeicherter Daten auf den Server abgeschlossen hat, sendet Client x entweder eine "Close"-oder eine "Done"-Meldung an den Server, Ereignis 8.</span><span class="sxs-lookup"><span data-stu-id="9298d-146">When client X is done writing cached data to the server, client X sends either a "close" or a "done" message to the server, event 8.</span></span>

<span data-ttu-id="9298d-147">Nachdem der Server benachrichtigt wurde, dass Client X den Schreib Cache auf den Server geleert hat oder die Datei geschlossen hat, kann der Server die Datei für den Client Y öffnen, und zwar in Ereignis 9.</span><span class="sxs-lookup"><span data-stu-id="9298d-147">After the server has been notified that client X is done flushing its write cache to the server or has closed the file, then the server can open the file for client Y, in event 9.</span></span> <span data-ttu-id="9298d-148">Da auf dem Server nun zwei Clients mit derselben Datei geöffnet sind, wird für keine dieser beiden Clients eine opportunistische Sperre erteilt.</span><span class="sxs-lookup"><span data-stu-id="9298d-148">Because the server now has two clients with the same file open, it grants an opportunistic lock to neither.</span></span> <span data-ttu-id="9298d-149">Beide Clients fahren mit dem Lesen aus der Datei fort, und eine oder keines von beiden wird in die Datei geschrieben.</span><span class="sxs-lookup"><span data-stu-id="9298d-149">Both clients proceed to read from the file, and one or neither writes to the file.</span></span>

## <a name="batch-opportunistic-lock"></a><span data-ttu-id="9298d-150">Batch-opportunistische Sperre</span><span class="sxs-lookup"><span data-stu-id="9298d-150">Batch Opportunistic Lock</span></span>

<span data-ttu-id="9298d-151">Das folgende Diagramm zeigt eine Netzwerkverkehrs Ansicht einer Batch opportunistischen Sperre.</span><span class="sxs-lookup"><span data-stu-id="9298d-151">The following diagram shows a network-traffic view of a batch opportunistic lock.</span></span> <span data-ttu-id="9298d-152">Die Pfeile geben die Richtung der Daten Verschiebung an, falls vorhanden.</span><span class="sxs-lookup"><span data-stu-id="9298d-152">The arrows indicate the direction of data movement, if any.</span></span>



| <span data-ttu-id="9298d-153">Ereignis</span><span class="sxs-lookup"><span data-stu-id="9298d-153">Event</span></span> | <span data-ttu-id="9298d-154">Client X</span><span class="sxs-lookup"><span data-stu-id="9298d-154">Client X</span></span>                               | <span data-ttu-id="9298d-155">Server</span><span class="sxs-lookup"><span data-stu-id="9298d-155">Server</span></span>                                 | <span data-ttu-id="9298d-156">Client Y</span><span class="sxs-lookup"><span data-stu-id="9298d-156">Client Y</span></span>                                          |
|-------|----------------------------------------|----------------------------------------|---------------------------------------------------|
| <span data-ttu-id="9298d-157">1</span><span class="sxs-lookup"><span data-stu-id="9298d-157">1</span></span>     | <span data-ttu-id="9298d-158">Öffnet die Datei, fordert Batch Sperre = =></span><span class="sxs-lookup"><span data-stu-id="9298d-158">Opens file, requests batch lock ==></span></span> |                                        |                                                   |
| <span data-ttu-id="9298d-159">2</span><span class="sxs-lookup"><span data-stu-id="9298d-159">2</span></span>     |                                        | <span data-ttu-id="9298d-160"><= = erteilt eine opportunistische Batch Sperre</span><span class="sxs-lookup"><span data-stu-id="9298d-160"><== Grants batch opportunistic lock</span></span> |                                                   |
| <span data-ttu-id="9298d-161">3</span><span class="sxs-lookup"><span data-stu-id="9298d-161">3</span></span>     | <span data-ttu-id="9298d-162">Lese Datei = =></span><span class="sxs-lookup"><span data-stu-id="9298d-162">Reads file ==></span></span>                      |                                        |                                                   |
| <span data-ttu-id="9298d-163">4</span><span class="sxs-lookup"><span data-stu-id="9298d-163">4</span></span>     |                                        | <span data-ttu-id="9298d-164"><= = sendet Daten</span><span class="sxs-lookup"><span data-stu-id="9298d-164"><== Sends data</span></span>                      |                                                   |
| <span data-ttu-id="9298d-165">5</span><span class="sxs-lookup"><span data-stu-id="9298d-165">5</span></span>     | <span data-ttu-id="9298d-166">Schließt die Datei.</span><span class="sxs-lookup"><span data-stu-id="9298d-166">Closes file</span></span>                            |                                        |                                                   |
| <span data-ttu-id="9298d-167">6</span><span class="sxs-lookup"><span data-stu-id="9298d-167">6</span></span>     | <span data-ttu-id="9298d-168">Öffnet die Datei.</span><span class="sxs-lookup"><span data-stu-id="9298d-168">Opens file</span></span>                             |                                        |                                                   |
| <span data-ttu-id="9298d-169">7</span><span class="sxs-lookup"><span data-stu-id="9298d-169">7</span></span>     | <span data-ttu-id="9298d-170">Sucht nach Daten</span><span class="sxs-lookup"><span data-stu-id="9298d-170">Searches for data</span></span>                      |                                        |                                                   |
| <span data-ttu-id="9298d-171">8</span><span class="sxs-lookup"><span data-stu-id="9298d-171">8</span></span>     | <span data-ttu-id="9298d-172">Reads Data = =></span><span class="sxs-lookup"><span data-stu-id="9298d-172">Reads data ==></span></span>                      |                                        |                                                   |
| <span data-ttu-id="9298d-173">9</span><span class="sxs-lookup"><span data-stu-id="9298d-173">9</span></span>     |                                        | <span data-ttu-id="9298d-174"><= = sendet Daten</span><span class="sxs-lookup"><span data-stu-id="9298d-174"><== Sends data</span></span>                      |                                                   |
| <span data-ttu-id="9298d-175">10</span><span class="sxs-lookup"><span data-stu-id="9298d-175">10</span></span>    | <span data-ttu-id="9298d-176">Schließt die Datei.</span><span class="sxs-lookup"><span data-stu-id="9298d-176">Closes file</span></span>                            |                                        |                                                   |
| <span data-ttu-id="9298d-177">11</span><span class="sxs-lookup"><span data-stu-id="9298d-177">11</span></span>    |                                        |                                        | <span data-ttu-id="9298d-178"><= = öffnet die Datei.</span><span class="sxs-lookup"><span data-stu-id="9298d-178"><== Opens file</span></span>                                 |
| <span data-ttu-id="9298d-179">12</span><span class="sxs-lookup"><span data-stu-id="9298d-179">12</span></span>    |                                        | <span data-ttu-id="9298d-180"><= = opportunistische Sperre wird unterbrochen</span><span class="sxs-lookup"><span data-stu-id="9298d-180"><== Breaks opportunistic lock</span></span>       |                                                   |
| <span data-ttu-id="9298d-181">13</span><span class="sxs-lookup"><span data-stu-id="9298d-181">13</span></span>    | <span data-ttu-id="9298d-182">Schließt File = =></span><span class="sxs-lookup"><span data-stu-id="9298d-182">Closes file ==></span></span>                     |                                        |                                                   |
| <span data-ttu-id="9298d-183">14</span><span class="sxs-lookup"><span data-stu-id="9298d-183">14</span></span>    |                                        | <span data-ttu-id="9298d-184">Okays-Öffnungsvorgang = =></span><span class="sxs-lookup"><span data-stu-id="9298d-184">Okays open operation ==></span></span>            |                                                   |
| <span data-ttu-id="9298d-185">15</span><span class="sxs-lookup"><span data-stu-id="9298d-185">15</span></span>    |                                        |                                        | <span data-ttu-id="9298d-186"><= = führt Lese-, Schreib-und andere Vorgänge aus.</span><span class="sxs-lookup"><span data-stu-id="9298d-186"><== Performs read, write, and other operations</span></span> |



 

<span data-ttu-id="9298d-187">In der opportunistischen Batch-Sperre öffnet Client x eine Datei, Ereignis 1, und der Server erteilt Client x eine Batch Sperre in Ereignis 2.</span><span class="sxs-lookup"><span data-stu-id="9298d-187">In the batch opportunistic lock, client X opens a file, event 1, and the server grants client X a batch lock in event 2.</span></span> <span data-ttu-id="9298d-188">Client X versucht, Daten, Ereignis 3, zu lesen, auf die der Server mit Daten antwortet, Ereignis 4.</span><span class="sxs-lookup"><span data-stu-id="9298d-188">Client X attempts to read data, event 3, to which the server responds with data, event 4.</span></span>

<span data-ttu-id="9298d-189">Das Ereignis 5 zeigt die opportunistische Sperre des Batches bei der Arbeit.</span><span class="sxs-lookup"><span data-stu-id="9298d-189">Event 5 shows the batch opportunistic lock at work.</span></span> <span data-ttu-id="9298d-190">Die Anwendung auf dem Client X schließt die Datei.</span><span class="sxs-lookup"><span data-stu-id="9298d-190">The application on Client X closes the file.</span></span> <span data-ttu-id="9298d-191">Der Netzwerkredirector filtert jedoch den Close-Vorgang heraus und überträgt keine close-Nachricht und führt so eine "Stille" Schließung durch.</span><span class="sxs-lookup"><span data-stu-id="9298d-191">However, the network redirector filters out the close operation and does not transmit a close message, thus performing a "silent" close.</span></span> <span data-ttu-id="9298d-192">Der Netzwerkredirector kann dies tun, weil der Client X den alleinigen Besitz der Datei besitzt.</span><span class="sxs-lookup"><span data-stu-id="9298d-192">The network redirector can do this because client X has sole ownership of the file.</span></span> <span data-ttu-id="9298d-193">Später wird die Datei in Ereignis 6 von der Anwendung erneut geöffnet.</span><span class="sxs-lookup"><span data-stu-id="9298d-193">Later on, in event 6, the application reopens the file.</span></span> <span data-ttu-id="9298d-194">Auch hier werden keine Daten über das Netzwerk übertragen.</span><span class="sxs-lookup"><span data-stu-id="9298d-194">Again, no data flows across the network.</span></span> <span data-ttu-id="9298d-195">Soweit der Server betroffen ist, wurde die Datei auf diesem Client seit Ereignis 2 geöffnet.</span><span class="sxs-lookup"><span data-stu-id="9298d-195">As far as the server is concerned, this client has had the file open since event 2.</span></span>

<span data-ttu-id="9298d-196">Die Ereignisse 7, 8 und 9 zeigen den üblichen Kurs des Netzwerkverkehrs.</span><span class="sxs-lookup"><span data-stu-id="9298d-196">Events 7, 8, and 9 show the usual course of network traffic.</span></span> <span data-ttu-id="9298d-197">In Ereignis 10 tritt ein weiterer automatischer Schluss Vorgang auf.</span><span class="sxs-lookup"><span data-stu-id="9298d-197">In event 10, another silent close occurs.</span></span>

<span data-ttu-id="9298d-198">In Ereignis 11 versucht Client Y, die Datei zu öffnen.</span><span class="sxs-lookup"><span data-stu-id="9298d-198">In event 11, client Y attempts to open the file.</span></span> <span data-ttu-id="9298d-199">Der Server zeigt die Datei an, die der Client x geöffnet hat, obwohl Sie von der Anwendung auf dem Client x geschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="9298d-199">The server's view of the file is that client X has it open, even though the application on client X has closed it.</span></span> <span data-ttu-id="9298d-200">Daher sendet der Server eine Nachricht, die die opportunistische Sperre an den Client x unterbricht. Client x sendet nun die Close-Nachricht über das Netzwerk, Ereignis 13.</span><span class="sxs-lookup"><span data-stu-id="9298d-200">Therefore, the server sends an a message breaking the opportunistic lock to client X. Client X now sends the close message across the network, event 13.</span></span> <span data-ttu-id="9298d-201">Das Ereignis 14 folgt, wenn der Server die Datei für den Client Y öffnet. Die Anwendung auf dem Client X hat die Datei geschlossen und führt somit keine Übertragung zum oder vom Server für diese Datei durch.</span><span class="sxs-lookup"><span data-stu-id="9298d-201">Event 14 follows as the server opens the file for client Y. The application on client X has closed the file, so it does no more transfers to or from the server for that file.</span></span> <span data-ttu-id="9298d-202">Der Client Y startet Datenübertragungen wie gewohnt in Ereignis 15.</span><span class="sxs-lookup"><span data-stu-id="9298d-202">Client Y begins data transfers as usual in event 15.</span></span>

<span data-ttu-id="9298d-203">Zwischen dem Zeitpunkt, zu dem Client X die Sperre für die Datei in Ereignis 2 erhält, und dem abschließenden schließen bei Ereignis 13, sind alle Datei Daten, die vom Client zwischengespeichert wurden, gültig, und zwar trotz der zwischengeschalteten und schließenden Anwendungs Vorgänge.</span><span class="sxs-lookup"><span data-stu-id="9298d-203">Between the time client X is granted the lock on the file in event 2 and the final close at event 13, any file data that the client has cached is valid, in spite of the intervening application open and close operations.</span></span> <span data-ttu-id="9298d-204">Nachdem die opportunistische Sperre jedoch abgebrochen wurde, können zwischengespeicherte Daten nicht als gültig betrachtet werden.</span><span class="sxs-lookup"><span data-stu-id="9298d-204">However, after the opportunistic lock is broken, cached data cannot be considered valid.</span></span>

## <a name="filter-opportunistic-lock"></a><span data-ttu-id="9298d-205">Opportunistische Sperre Filtern</span><span class="sxs-lookup"><span data-stu-id="9298d-205">Filter Opportunistic Lock</span></span>

<span data-ttu-id="9298d-206">Das folgende Diagramm zeigt eine Netzwerkverkehrs Ansicht einer Filter opportunistischen Sperre.</span><span class="sxs-lookup"><span data-stu-id="9298d-206">The following diagram shows a network-traffic view of a filter opportunistic lock.</span></span> <span data-ttu-id="9298d-207">Die Pfeile geben die Richtung der Daten Verschiebung an, falls vorhanden.</span><span class="sxs-lookup"><span data-stu-id="9298d-207">The arrows indicate the direction of data movement, if any.</span></span>



| <span data-ttu-id="9298d-208">Ereignis</span><span class="sxs-lookup"><span data-stu-id="9298d-208">Event</span></span> | <span data-ttu-id="9298d-209">Client X</span><span class="sxs-lookup"><span data-stu-id="9298d-209">Client X</span></span>                                | <span data-ttu-id="9298d-210">Server</span><span class="sxs-lookup"><span data-stu-id="9298d-210">Server</span></span>                   | <span data-ttu-id="9298d-211">Client Y</span><span class="sxs-lookup"><span data-stu-id="9298d-211">Client Y</span></span>                    |
|-------|-----------------------------------------|--------------------------|-----------------------------|
| <span data-ttu-id="9298d-212">1</span><span class="sxs-lookup"><span data-stu-id="9298d-212">1</span></span>     | <span data-ttu-id="9298d-213">Öffnet die Datei ohne Zugriffsrechte = =></span><span class="sxs-lookup"><span data-stu-id="9298d-213">Opens file with no access rights ==></span></span> |                          |                             |
| <span data-ttu-id="9298d-214">2</span><span class="sxs-lookup"><span data-stu-id="9298d-214">2</span></span>     |                                         | <span data-ttu-id="9298d-215"><= = öffnet die Datei.</span><span class="sxs-lookup"><span data-stu-id="9298d-215"><== Opens the file</span></span>    |                             |
| <span data-ttu-id="9298d-216">3</span><span class="sxs-lookup"><span data-stu-id="9298d-216">3</span></span>     | <span data-ttu-id="9298d-217">Anforderungs Filter Sperre = =></span><span class="sxs-lookup"><span data-stu-id="9298d-217">Requests filter lock==></span></span>              |                          |                             |
| <span data-ttu-id="9298d-218">4</span><span class="sxs-lookup"><span data-stu-id="9298d-218">4</span></span>     |                                         | <span data-ttu-id="9298d-219"><= = erteilt Sperre</span><span class="sxs-lookup"><span data-stu-id="9298d-219"><== Grants lock</span></span>       |                             |
| <span data-ttu-id="9298d-220">5</span><span class="sxs-lookup"><span data-stu-id="9298d-220">5</span></span>     | <span data-ttu-id="9298d-221">Öffnet die Datei zum Lesen = =></span><span class="sxs-lookup"><span data-stu-id="9298d-221">Opens file for reading ==></span></span>           |                          |                             |
| <span data-ttu-id="9298d-222">6</span><span class="sxs-lookup"><span data-stu-id="9298d-222">6</span></span>     |                                         | <span data-ttu-id="9298d-223"><= = öffnet die Datei erneut.</span><span class="sxs-lookup"><span data-stu-id="9298d-223"><== Reopens the file</span></span>  |                             |
| <span data-ttu-id="9298d-224">7</span><span class="sxs-lookup"><span data-stu-id="9298d-224">7</span></span>     | <span data-ttu-id="9298d-225">Liest Daten mithilfe des Read-Handles = =></span><span class="sxs-lookup"><span data-stu-id="9298d-225">Reads data using the read handle ==></span></span> |                          |                             |
| <span data-ttu-id="9298d-226">8</span><span class="sxs-lookup"><span data-stu-id="9298d-226">8</span></span>     |                                         | <span data-ttu-id="9298d-227"><= = sendet Daten</span><span class="sxs-lookup"><span data-stu-id="9298d-227"><== Sends data</span></span>        |                             |
| <span data-ttu-id="9298d-228">9</span><span class="sxs-lookup"><span data-stu-id="9298d-228">9</span></span>     |                                         | <span data-ttu-id="9298d-229"><= = sendet Daten</span><span class="sxs-lookup"><span data-stu-id="9298d-229"><== Sends data</span></span>        |                             |
| <span data-ttu-id="9298d-230">10</span><span class="sxs-lookup"><span data-stu-id="9298d-230">10</span></span>    |                                         | <span data-ttu-id="9298d-231"><= = sendet Daten</span><span class="sxs-lookup"><span data-stu-id="9298d-231"><== Sends data</span></span>        |                             |
| <span data-ttu-id="9298d-232">11</span><span class="sxs-lookup"><span data-stu-id="9298d-232">11</span></span>    |                                         |                          | <span data-ttu-id="9298d-233"><= = öffnet die Datei.</span><span class="sxs-lookup"><span data-stu-id="9298d-233"><== Opens the file</span></span>       |
| <span data-ttu-id="9298d-234">12</span><span class="sxs-lookup"><span data-stu-id="9298d-234">12</span></span>    |                                         | <span data-ttu-id="9298d-235">Öffnet die Datei = =></span><span class="sxs-lookup"><span data-stu-id="9298d-235">Opens the file ==></span></span>    |                             |
| <span data-ttu-id="9298d-236">13</span><span class="sxs-lookup"><span data-stu-id="9298d-236">13</span></span>    |                                         |                          | <span data-ttu-id="9298d-237"><= = fordert Filter Sperre an</span><span class="sxs-lookup"><span data-stu-id="9298d-237"><== Requests filter lock</span></span> |
| <span data-ttu-id="9298d-238">14</span><span class="sxs-lookup"><span data-stu-id="9298d-238">14</span></span>    |                                         | <span data-ttu-id="9298d-239">Verweigert Filter Lock = =></span><span class="sxs-lookup"><span data-stu-id="9298d-239">Denies filter lock==></span></span> |                             |
| <span data-ttu-id="9298d-240">15</span><span class="sxs-lookup"><span data-stu-id="9298d-240">15</span></span>    |                                         |                          | <span data-ttu-id="9298d-241"><= = liest Daten</span><span class="sxs-lookup"><span data-stu-id="9298d-241"><== Reads data</span></span>           |
| <span data-ttu-id="9298d-242">16</span><span class="sxs-lookup"><span data-stu-id="9298d-242">16</span></span>    |                                         | <span data-ttu-id="9298d-243">Daten werden gesendet = =></span><span class="sxs-lookup"><span data-stu-id="9298d-243">Sends data ==></span></span>        |                             |
| <span data-ttu-id="9298d-244">17</span><span class="sxs-lookup"><span data-stu-id="9298d-244">17</span></span>    | <span data-ttu-id="9298d-245">Liest (zwischengespeicherte) Daten</span><span class="sxs-lookup"><span data-stu-id="9298d-245">Reads (cached) data</span></span>                     |                          |                             |
| <span data-ttu-id="9298d-246">18</span><span class="sxs-lookup"><span data-stu-id="9298d-246">18</span></span>    | <span data-ttu-id="9298d-247">Schließt File = =></span><span class="sxs-lookup"><span data-stu-id="9298d-247">Closes file ==></span></span>                      |                          |                             |
| <span data-ttu-id="9298d-248">19</span><span class="sxs-lookup"><span data-stu-id="9298d-248">19</span></span>    |                                         |                          | <span data-ttu-id="9298d-249"><= = schließt die Datei.</span><span class="sxs-lookup"><span data-stu-id="9298d-249"><== Closes file</span></span>          |



 

<span data-ttu-id="9298d-250">In der opportunistischen Filter-Sperre öffnet Client X eine Datei, Ereignis 1, und der Server antwortet in Ereignis 2.</span><span class="sxs-lookup"><span data-stu-id="9298d-250">In the filter opportunistic lock, client X opens a file, event 1, and the server responds in event 2.</span></span> <span data-ttu-id="9298d-251">Der Client fordert dann eine opportunistische Filter Sperre in Ereignis 3 an, gefolgt vom Server, der die opportunistische Sperre in Ereignis 4 erteilt.</span><span class="sxs-lookup"><span data-stu-id="9298d-251">The client then requests a filter opportunistic lock in event 3, followed by the server granting the opportunistic lock in event 4.</span></span> <span data-ttu-id="9298d-252">Client X öffnet die Datei dann erneut zum Lesen in Ereignis 5, auf den der Server in Ereignis 6 antwortet.</span><span class="sxs-lookup"><span data-stu-id="9298d-252">Client X then opens the file again for reading in event 5, to which the server responds in event 6.</span></span> <span data-ttu-id="9298d-253">Der Client versucht dann, Daten zu lesen, auf die der Server mit Daten antwortet, Ereignis 8.</span><span class="sxs-lookup"><span data-stu-id="9298d-253">The client then attempts to read data, to which the server responds with data, event 8.</span></span>

<span data-ttu-id="9298d-254">Das Ereignis 9 zeigt die opportunistische Sperre des Filters bei der Arbeit.</span><span class="sxs-lookup"><span data-stu-id="9298d-254">Event 9 shows the filter opportunistic lock at work.</span></span> <span data-ttu-id="9298d-255">Der Server liest den Client vor und sendet die Daten über das Netzwerk, auch wenn der Client ihn nicht angefordert hat.</span><span class="sxs-lookup"><span data-stu-id="9298d-255">The server reads ahead of the client and sends the data over the network even though the client has not requested it.</span></span> <span data-ttu-id="9298d-256">Der Client speichert die Daten zwischen.</span><span class="sxs-lookup"><span data-stu-id="9298d-256">The client caches the data.</span></span> <span data-ttu-id="9298d-257">In Ereignis 10 erwartet der Server auch eine zukünftige Daten Anforderung und sendet einen anderen Teil der Datei, damit der Client zwischengespeichert wird.</span><span class="sxs-lookup"><span data-stu-id="9298d-257">In event 10, the server also anticipates a future request for data and sends another portion of the file for the client to cache.</span></span>

<span data-ttu-id="9298d-258">In Ereignis 11 und 12 wird die Datei von einem anderen Client, Y, geöffnet.</span><span class="sxs-lookup"><span data-stu-id="9298d-258">In event 11 and 12, another client, Y, opens the file.</span></span> <span data-ttu-id="9298d-259">Client Y fordert außerdem eine opportunistische Filter Sperre an.</span><span class="sxs-lookup"><span data-stu-id="9298d-259">Client Y also requests a filter opportunistic lock.</span></span> <span data-ttu-id="9298d-260">In Ereignis 14 verweigert der Server Sie.</span><span class="sxs-lookup"><span data-stu-id="9298d-260">In event 14, the server denies it.</span></span> <span data-ttu-id="9298d-261">In Ereignis 15 fordert Client Y Daten an, die der Server in Ereignis 16 sendet.</span><span class="sxs-lookup"><span data-stu-id="9298d-261">In event 15, client Y requests data, which the server sends in event 16.</span></span> <span data-ttu-id="9298d-262">Keines dieser Auswirkungen wirkt sich auf den Client X aus. Diese Datei kann jederzeit von einem anderen Client für den Lesezugriff geöffnet werden.</span><span class="sxs-lookup"><span data-stu-id="9298d-262">None of this affects client X. At any time, another client can open this file for read access.</span></span> <span data-ttu-id="9298d-263">Kein anderer Client wirkt sich auf die Filter Sperre von Client X aus.</span><span class="sxs-lookup"><span data-stu-id="9298d-263">No other client affects client X's filter lock.</span></span>

<span data-ttu-id="9298d-264">Das Ereignis 17 zeigt Client X-Lesedaten.</span><span class="sxs-lookup"><span data-stu-id="9298d-264">Event 17 shows client X reading data.</span></span> <span data-ttu-id="9298d-265">Da der Server die Daten jedoch bereits gesendet hat und diese vom Client zwischengespeichert wurden, überschreitet der Datenverkehr das Netzwerk nicht.</span><span class="sxs-lookup"><span data-stu-id="9298d-265">However, because the server has already sent the data and the client has cached it, no traffic crosses the network.</span></span>

<span data-ttu-id="9298d-266">In diesem Beispiel versucht Client X nie, alle Daten in der Datei zu lesen, sodass der Read-Ahead-Vorgang, der durch die Ereignisse 9 und 10 angegeben wird, "verschwendet" wird. Das heißt, dass die Daten nie tatsächlich verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="9298d-266">In this example, client X never tries to read all the data in the file, so the read-ahead indicated by events 9 and 10 is "wasted"; that is, the data is never actually used.</span></span> <span data-ttu-id="9298d-267">Dies ist ein akzeptabler Verlust, da der Lesevorgang die Anwendung bereinigt hat.</span><span class="sxs-lookup"><span data-stu-id="9298d-267">This is an acceptable loss because the read-ahead has sped up the application.</span></span>

<span data-ttu-id="9298d-268">In Ereignis 18 schließt Client X die Datei.</span><span class="sxs-lookup"><span data-stu-id="9298d-268">In event 18, client X closes the file.</span></span> <span data-ttu-id="9298d-269">Der Netzwerkredirector des Clients bricht die zwischengespeicherten Daten ab.</span><span class="sxs-lookup"><span data-stu-id="9298d-269">The client's network redirector abandons the cached data.</span></span> <span data-ttu-id="9298d-270">Der Server schließt die Datei.</span><span class="sxs-lookup"><span data-stu-id="9298d-270">The server closes the file.</span></span>

 

 



