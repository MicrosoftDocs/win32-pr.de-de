---
description: Eine Datei, die als verschlüsselt gekennzeichnet ist, wird vom NTFS-Dateisystem mithilfe des aktuellen Verschlüsselungs Treibers verschlüsselt.
ms.assetid: 166bfb8c-b97d-4cc7-bf6b-399837cb8ad0
title: Behandeln von verschlüsselten Dateien und Verzeichnissen
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2718656a28eb678c10076e228e08a2a95cabd1fc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "103960648"
---
# <a name="handling-encrypted-files-and-directories"></a><span data-ttu-id="0aa70-103">Behandeln von verschlüsselten Dateien und Verzeichnissen</span><span class="sxs-lookup"><span data-stu-id="0aa70-103">Handling Encrypted Files and Directories</span></span>

<span data-ttu-id="0aa70-104">Ein Programmierer oder Benutzer kann ein Verzeichnis oder eine Datei als verschlüsselt markieren.</span><span class="sxs-lookup"><span data-stu-id="0aa70-104">A programmer or user may mark a directory or file as encrypted.</span></span> <span data-ttu-id="0aa70-105">Eine Datei, die als verschlüsselt gekennzeichnet ist, wird vom NTFS-Dateisystem mithilfe des aktuellen Verschlüsselungs Treibers verschlüsselt.</span><span class="sxs-lookup"><span data-stu-id="0aa70-105">A file marked encrypted is encrypted by the NTFS file system by using the current encryption driver.</span></span> <span data-ttu-id="0aa70-106">Wenn die Datei zu einem späteren Zeitpunkt als nicht verschlüsselt gekennzeichnet ist, wird sie entschlüsselt und in einem nur-Text-Zustand (unsicher) belassen.</span><span class="sxs-lookup"><span data-stu-id="0aa70-106">If at a later date the file is marked as not encrypted, it is decrypted and left in a plain text (unsecured) state.</span></span>

<span data-ttu-id="0aa70-107">Verzeichnisse werden nicht selbst verschlüsselt.</span><span class="sxs-lookup"><span data-stu-id="0aa70-107">Directories are not themselves encrypted.</span></span> <span data-ttu-id="0aa70-108">In einem "verschlüsselten" Verzeichnis werden standardmäßig alle neuen Dateien im Verzeichnis bei der Erstellung verschlüsselt.</span><span class="sxs-lookup"><span data-stu-id="0aa70-108">Rather, by default, in an "encrypted" directory all new files in the directory are encrypted at creation.</span></span> <span data-ttu-id="0aa70-109">Ein Benutzer muss den Status einer neuen Datei explizit ändern, um entschlüsselt zu werden, wenn der Benutzer nicht möchten, dass die Datei verschlüsselt wird.</span><span class="sxs-lookup"><span data-stu-id="0aa70-109">A user must specifically change the status of a new file to decrypted if the user does not want the file to be encrypted.</span></span> <span data-ttu-id="0aa70-110">Ein verschlüsseltes Verzeichnis ist sichtbar.</span><span class="sxs-lookup"><span data-stu-id="0aa70-110">An encrypted directory is visible.</span></span> <span data-ttu-id="0aa70-111">Verwenden Sie die Standardmethoden für die Zugriffs Steuerung, damit andere Benutzer nicht auf ein Verzeichnis zugreifen können.</span><span class="sxs-lookup"><span data-stu-id="0aa70-111">To make a directory inaccessible to other users, use the standard methods of access control.</span></span>

<span data-ttu-id="0aa70-112">Die Verschlüsselungsfunktionen können nicht mit der [Backup-API](/windows/desktop/Backup/backup)verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="0aa70-112">The encryption functions cannot be used with the [Backup API](/windows/desktop/Backup/backup).</span></span>

<span data-ttu-id="0aa70-113">Verwenden Sie [**die Funktion "**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) Funktion", um eine neue Datei zu verschlüsseln **. \_ \_**</span><span class="sxs-lookup"><span data-stu-id="0aa70-113">To encrypt a new file, use the [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) function with the **FILE\_ATTRIBUTE\_ENCRYPTED** flag.</span></span> <span data-ttu-id="0aa70-114">Verwenden Sie die Funktion " [**verschlüsseltfile**](/windows/desktop/api/WinBase/nf-winbase-encryptfilea) ", um eine vorhandene Datei zu verschlüsseln.</span><span class="sxs-lookup"><span data-stu-id="0aa70-114">To encrypt an existing file, use the [**EncryptFile**](/windows/desktop/api/WinBase/nf-winbase-encryptfilea) function.</span></span> <span data-ttu-id="0aa70-115">Alle Datenströme in der Datei werden verschlüsselt.</span><span class="sxs-lookup"><span data-stu-id="0aa70-115">All data streams in the file are encrypted.</span></span> <span data-ttu-id="0aa70-116">Wenn die Datei bereits verschlüsselt ist, führt " **verschlüsseltfile** " nichts aus, sondern gibt einen Wert ungleich 0 (null) zurück, was den Erfolg angibt.</span><span class="sxs-lookup"><span data-stu-id="0aa70-116">If the file is already encrypted, **EncryptFile** does nothing but returns a nonzero value, which indicates success.</span></span> <span data-ttu-id="0aa70-117">Wenn die Datei komprimiert ist, wird die Datei von **Verschlüsselungsdatei** vor der Verschlüsselung dekomprimiert.</span><span class="sxs-lookup"><span data-stu-id="0aa70-117">If the file is compressed, **EncryptFile** decompresses the file before encrypting it.</span></span>

<span data-ttu-id="0aa70-118">Verwenden Sie die [**DecryptFile**](/windows/desktop/api/WinBase/nf-winbase-decryptfilea) -Funktion, um eine verschlüsselte Datei zu entschlüsseln.</span><span class="sxs-lookup"><span data-stu-id="0aa70-118">To decrypt an encrypted file, use the [**DecryptFile**](/windows/desktop/api/WinBase/nf-winbase-decryptfilea) function.</span></span> <span data-ttu-id="0aa70-119">Wenn die Datei nicht verschlüsselt ist, führt **DecryptFile** keine Aktion aus, sondern gibt einen Wert ungleich NULL zurück, der den Erfolg angibt.</span><span class="sxs-lookup"><span data-stu-id="0aa70-119">If the file is not encrypted, **DecryptFile** does nothing but returns a nonzero value indicating success.</span></span>

<span data-ttu-id="0aa70-120">Die Funktion " [**verschlüsselungsdeaktivieren**](/windows/desktop/api/WinEfs/nf-winefs-encryptiondisable) " deaktiviert oder aktiviert die Verschlüsselung des bestimmten Verzeichnisses und der darin aufgeführten Dateien.</span><span class="sxs-lookup"><span data-stu-id="0aa70-120">The [**EncryptionDisable**](/windows/desktop/api/WinEfs/nf-winefs-encryptiondisable) function disables or enables the encryption of the indicated directory and the files in it.</span></span> <span data-ttu-id="0aa70-121">Die Verschlüsselung von Unterverzeichnissen unter dem angegebenen Verzeichnis wird nicht beeinträchtigt.</span><span class="sxs-lookup"><span data-stu-id="0aa70-121">It does not affect the encryption of subdirectories below the indicated directory.</span></span>

<span data-ttu-id="0aa70-122">Verwenden Sie die [**fileverschlüsseltionstatus**](/windows/desktop/api/WinBase/nf-winbase-fileencryptionstatusa) -Funktion, um den Verschlüsselungs Status einer Datei abzurufen.</span><span class="sxs-lookup"><span data-stu-id="0aa70-122">To retrieve the encryption status of a file, use the [**FileEncryptionStatus**](/windows/desktop/api/WinBase/nf-winbase-fileencryptionstatusa) function.</span></span> <span data-ttu-id="0aa70-123">Rufen Sie alternativ die [**getfileattributfunktion**](/windows/desktop/api/FileAPI/nf-fileapi-getfileattributesa) auf, und untersuchen Sie das **\_ Dateiattribut \_ verschlüsselte** Flag im Rückgabewert.</span><span class="sxs-lookup"><span data-stu-id="0aa70-123">Alternatively, call the [**GetFileAttributes**](/windows/desktop/api/FileAPI/nf-fileapi-getfileattributesa) function and examine the **FILE\_ATTRIBUTE\_ENCRYPTED** flag in the return value.</span></span>

<span data-ttu-id="0aa70-124">[**CopyFile**](/windows/desktop/api/WinBase/nf-winbase-copyfile) und [**CopyFileEx**](/windows/desktop/api/WinBase/nf-winbase-copyfileexa) versuchen, die Zieldatei mit den Schlüsseln zu verschlüsseln, die bei der Verschlüsselung der Quelldatei verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="0aa70-124">[**CopyFile**](/windows/desktop/api/WinBase/nf-winbase-copyfile) and [**CopyFileEx**](/windows/desktop/api/WinBase/nf-winbase-copyfileexa) attempt to encrypt the destination file with the keys used in the encryption of the source file.</span></span> <span data-ttu-id="0aa70-125">Wenn dies nicht möglich ist, versuchen beide Funktionen, die Zieldatei mit Standard Schlüsseln zu verschlüsseln.</span><span class="sxs-lookup"><span data-stu-id="0aa70-125">If this cannot be done, both functions attempt to encrypt the destination file with default keys.</span></span> <span data-ttu-id="0aa70-126">Wenn beide Methoden nicht ausgeführt werden können, schlagen **CopyFile** und **CopyFileEx** mit einem Fehler bei der **Fehler \_ Verschlüsselung \_** fehl.</span><span class="sxs-lookup"><span data-stu-id="0aa70-126">If both of these methods cannot be done, **CopyFile** and **CopyFileEx** fail with an **ERROR\_ENCRYPTION\_FAILED** error.</span></span> <span data-ttu-id="0aa70-127">Wenn Sie **möchten, dass** **CopyFileEx** den Kopiervorgang abschließt, auch wenn die Zieldatei nicht verschlüsselt werden kann, schließen Sie das Flag zum Zulassen des **\_ \_ \_ entschlüsselten \_ Ziels** in den Wert des Parameters dwcopyflags in den Wert des Parameters *dwcopyflags* ein.</span><span class="sxs-lookup"><span data-stu-id="0aa70-127">If you want **CopyFileEx** to complete the copy operation even when the destination file cannot be encrypted, include the **COPY\_FILE\_ALLOW\_DECRYPTED\_DESTINATION** flag in the value of the *dwCopyFlags* parameter in your call to **CopyFileEx**.</span></span>

 

 
