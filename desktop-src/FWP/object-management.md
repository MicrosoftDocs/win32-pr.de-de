---
title: Objekt Verwaltung
description: In diesem Abschnitt wird die korrekte Verwendung von API-Objekttypen der Windows-Filter Plattform (WFP) behandelt.
ms.assetid: 2625ef9a-0e62-4e21-ba93-047965d0d782
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: dc41560bb85a7e79c0262d77c0b34fe6c1d9bfd6
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/19/2020
ms.locfileid: "104472908"
---
# <a name="object-management"></a><span data-ttu-id="149d3-103">Objekt Verwaltung</span><span class="sxs-lookup"><span data-stu-id="149d3-103">Object Management</span></span>

<span data-ttu-id="149d3-104">In diesem Abschnitt wird die korrekte Verwendung von API-Objekttypen der Windows-Filter Plattform (WFP) behandelt.</span><span class="sxs-lookup"><span data-stu-id="149d3-104">This section covers the correct use of Windows Filtering Platform (WFP) API object types.</span></span>

## <a name="sessions"></a><span data-ttu-id="149d3-105">Sitzungen</span><span class="sxs-lookup"><span data-stu-id="149d3-105">Sessions</span></span>

<span data-ttu-id="149d3-106">Die WFP-API ist Sitzungs orientiert, und die meisten Funktionsaufrufe werden innerhalb des Kontexts einer Sitzung durchgeführt.</span><span class="sxs-lookup"><span data-stu-id="149d3-106">The WFP API is session-oriented, and most function calls are made within the context of a session.</span></span> <span data-ttu-id="149d3-107">Eine neue Client Sitzung wird durch Aufrufen von [**FwpmEngineOpen0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineopen0)erstellt.</span><span class="sxs-lookup"><span data-stu-id="149d3-107">A new client session is created by calling [**FwpmEngineOpen0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineopen0).</span></span> <span data-ttu-id="149d3-108">Die Sitzung endet, wenn der Client [**FwpmEngineClose0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineclose0) aufruft oder der Client Prozess beendet wird.</span><span class="sxs-lookup"><span data-stu-id="149d3-108">The session ends either when the client calls [**FwpmEngineClose0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineclose0) or the client process terminates.</span></span> <span data-ttu-id="149d3-109">Wenn eine Sitzung entweder zum Zweck oder durch den RPC-Rundown zerstört wird, bricht die Basis Filter-Engine (BFE) zuerst jede vorhandene Transaktion ab.</span><span class="sxs-lookup"><span data-stu-id="149d3-109">When a session is destroyed, either on purpose or by the RPC rundown, the Base Filtering Engine (BFE) first aborts any existing transaction.</span></span>

<span data-ttu-id="149d3-110">Beim Erstellen einer neuen Sitzung kann der Aufrufer eine dynamische Sitzung erstellen, indem er das Flag für das [**dynamische fwpm- \_ \_ sitzungsflag \_**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_session0) an [**FwpmEngineOpen0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineopen0)übergibt.</span><span class="sxs-lookup"><span data-stu-id="149d3-110">When creating a new session, the caller can create a dynamic session by passing the [**FWPM\_SESSION\_FLAG\_DYNAMIC**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_session0) flag to [**FwpmEngineOpen0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineopen0).</span></span> <span data-ttu-id="149d3-111">Alle Objekte, die während einer dynamischen Sitzung hinzugefügt werden, werden automatisch gelöscht, wenn die Sitzung beendet wird.</span><span class="sxs-lookup"><span data-stu-id="149d3-111">Any objects added during a dynamic session are automatically deleted when the session ends.</span></span>

## <a name="transactions"></a><span data-ttu-id="149d3-112">Transaktionen</span><span class="sxs-lookup"><span data-stu-id="149d3-112">Transactions</span></span>

<span data-ttu-id="149d3-113">Die WFP-API ist transaktional, und die meisten Funktionsaufrufe werden innerhalb des Kontexts einer Transaktion durchgeführt.</span><span class="sxs-lookup"><span data-stu-id="149d3-113">The WFP API is transactional, and most function calls are made within the context of a transaction.</span></span> <span data-ttu-id="149d3-114">Aufrufer können [**FwpmTransactionBegin0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionbegin0), [**FwpmTransactionCommit0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactioncommit0)und [**FwpmTransactionAbort0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionabort0) verwenden, um Transaktionen explizit zu steuern.</span><span class="sxs-lookup"><span data-stu-id="149d3-114">Callers can use [**FwpmTransactionBegin0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionbegin0), [**FwpmTransactionCommit0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactioncommit0), and [**FwpmTransactionAbort0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionabort0) to explicitly control transactions.</span></span> <span data-ttu-id="149d3-115">Wenn ein Funktions Aufrufvorgang jedoch außerhalb einer expliziten Transaktion erfolgt, wird er innerhalb einer impliziten Transaktion ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="149d3-115">However, if a function call is made outside of an explicit transaction, it will be executed within an implicit transaction.</span></span> <span data-ttu-id="149d3-116">Wenn eine Transaktion ausgeführt wird, wird Sie automatisch abgebrochen, wenn eine Sitzung beendet wird.</span><span class="sxs-lookup"><span data-stu-id="149d3-116">If a transaction is in progress, when a session terminates, it is automatically aborted.</span></span> <span data-ttu-id="149d3-117">Implizite Transaktionen werden nie erzwungen.</span><span class="sxs-lookup"><span data-stu-id="149d3-117">Implicit transactions are never forcibly aborted.</span></span>

<span data-ttu-id="149d3-118">Transaktionen sind entweder schreibgeschützt oder Lese-/Schreibzugriff und erzwingen eine strikte atomarische konsistente isolierte dauerhafte Semantik ([Acid](../cossdk/acid-properties.md)).</span><span class="sxs-lookup"><span data-stu-id="149d3-118">Transactions are either read-only or read/write and enforce rigorous Atomic Consistent Isolated Durable ([ACID](../cossdk/acid-properties.md)) semantics.</span></span>

<span data-ttu-id="149d3-119">Für jede Client Sitzung kann jeweils nur eine Transaktion ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="149d3-119">Each client session can have only one transaction in progress at a time.</span></span> <span data-ttu-id="149d3-120">Wenn der Aufrufer versucht, eine zweite Transaktion zu starten, bevor er einen Commit oder Abbruch des ersten Vorgangs ausführt, gibt BFE einen Fehler zurück.</span><span class="sxs-lookup"><span data-stu-id="149d3-120">If the caller attempts to begin a second transaction before committing or aborting the first, BFE returns an error.</span></span>

<span data-ttu-id="149d3-121">Wenn ein Vorgang im Verlauf einer Transaktion fehlschlägt, wirkt sich dies nicht auf den Gesamtstatus der Transaktion aus.</span><span class="sxs-lookup"><span data-stu-id="149d3-121">If an operation fails during the course of a transaction, it does not affect the overall state of the transaction.</span></span> <span data-ttu-id="149d3-122">Nehmen wir beispielsweise an, dass der Client eine Transaktion startet und [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0) dreimal erfolgreich aufruft, bevor ein vierter Aufruf fehlschlägt.</span><span class="sxs-lookup"><span data-stu-id="149d3-122">For example, suppose the client begins a transaction and successfully calls [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0) three times before a fourth call fails.</span></span> <span data-ttu-id="149d3-123">Der Client hat jetzt die Option:</span><span class="sxs-lookup"><span data-stu-id="149d3-123">The client now has the option of:</span></span>

-   <span data-ttu-id="149d3-124">Abbrechen der Transaktion. in diesem Fall wird keiner der Filter hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="149d3-124">Aborting the transaction, in which case none of the filters will be added.</span></span>
-   <span data-ttu-id="149d3-125">Commit für die Transaktion wird ausgeführt. in diesem Fall werden die ersten drei Filter hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="149d3-125">Committing the transaction, in which case the first three filters will be added.</span></span>
-   <span data-ttu-id="149d3-126">Fortfahren mit weiteren Vorgängen, einschließlich potenziell wiederholtem fehlgeschlagener [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0).</span><span class="sxs-lookup"><span data-stu-id="149d3-126">Continuing with more operations including potentially retrying the failed [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0).</span></span>

<span data-ttu-id="149d3-127">Wenn eine Transaktion gestartet wird, wartet BFE, bis die [**txnwaittimeoutinmsec**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_session0) der Sitzung abläuft, um die Sperre zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="149d3-127">When beginning a transaction, BFE will wait until the session's [**txnWaitTimeoutInMSec**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_session0) expires to acquire the lock.</span></span> <span data-ttu-id="149d3-128">Wenn die Sperre innerhalb dieses Zeitraums nicht abgerufen wird, schlagen die Sperr Abruf (und der [**FwpmTransactionBegin0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionbegin0) -Aufruf) fehl.</span><span class="sxs-lookup"><span data-stu-id="149d3-128">If the lock is not acquired within this time, the lock acquisition (and the [**FwpmTransactionBegin0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionbegin0) call) will fail.</span></span> <span data-ttu-id="149d3-129">Dadurch wird verhindert, dass Clients unbegrenzt reagieren.</span><span class="sxs-lookup"><span data-stu-id="149d3-129">This prevents clients from indefinitely failing to respond.</span></span> <span data-ttu-id="149d3-130">Wenn der Client kein Sperr Timeout angegeben hat, wird der Standardwert auf 15 Sekunden festgelegt.</span><span class="sxs-lookup"><span data-stu-id="149d3-130">If the client did not specify a lock timeout, it defaults to 15 seconds.</span></span>

<span data-ttu-id="149d3-131">Jede Transaktion verfügt auch über ein Sperr Timeout.</span><span class="sxs-lookup"><span data-stu-id="149d3-131">Each transaction also has a lock timeout.</span></span> <span data-ttu-id="149d3-132">Dies ist die maximale Zeitspanne, die die Sperre besitzen kann.</span><span class="sxs-lookup"><span data-stu-id="149d3-132">This is the maximum amount of time that it can own the lock.</span></span> <span data-ttu-id="149d3-133">Wenn der Besitzer die Sperre nicht innerhalb dieses Zeitraums freigibt, wird die Transaktion erzwungen, wodurch die Sperre aufgehoben wird.</span><span class="sxs-lookup"><span data-stu-id="149d3-133">If the owner does not release the lock within this time, the transaction is forcibly aborted, causing the lock to be released.</span></span> <span data-ttu-id="149d3-134">Das Sperr Timeout ist nicht konfigurierbar.</span><span class="sxs-lookup"><span data-stu-id="149d3-134">The lock timeout is not configurable.</span></span> <span data-ttu-id="149d3-135">Es ist unendlich für Aufrufer im Kernelmodus und eine Stunde für Aufrufer im Benutzermodus.</span><span class="sxs-lookup"><span data-stu-id="149d3-135">It is infinite for kernel-mode callers and one hour for user-mode callers.</span></span> <span data-ttu-id="149d3-136">Wenn eine Transaktion erzwungen wird, schlägt der nächste innerhalb dieser Transaktion vorgenommene-Vorgang fehl, und **FWP \_ E \_ TXn wird \_ abgebrochen**.</span><span class="sxs-lookup"><span data-stu-id="149d3-136">If a transaction is forcibly aborted, the next call made within that transaction will fail with **FWP\_E\_TXN\_ABORTED**.</span></span>

## <a name="object-lifetimes"></a><span data-ttu-id="149d3-137">Objekt Lebensdauer</span><span class="sxs-lookup"><span data-stu-id="149d3-137">Object Lifetimes</span></span>

<span data-ttu-id="149d3-138">Objekte können eine von vier möglichen Lebens dauern aufweisen:</span><span class="sxs-lookup"><span data-stu-id="149d3-138">Objects can have one of four possible lifetimes:</span></span>

-   <span data-ttu-id="149d3-139">Dynamisch – ein Objekt ist nur dann dynamisch, wenn es mithilfe eines dynamischen Sitzungs Handles hinzugefügt wird.</span><span class="sxs-lookup"><span data-stu-id="149d3-139">Dynamic — An object is dynamic only if it is added using a dynamic session handle.</span></span> <span data-ttu-id="149d3-140">Dynamische Objekte sind so lange Live, bis Sie gelöscht werden oder die besitzende Sitzung beendet wird.</span><span class="sxs-lookup"><span data-stu-id="149d3-140">Dynamic objects live until they are deleted or the owning session terminates.</span></span>
-   <span data-ttu-id="149d3-141">Statische –-Objekte sind standardmäßig statisch.</span><span class="sxs-lookup"><span data-stu-id="149d3-141">Static — Objects are static by default.</span></span> <span data-ttu-id="149d3-142">Statische Objekte sind so lange Live, bis Sie gelöscht werden, BFE beendet oder das System heruntergefahren wird.</span><span class="sxs-lookup"><span data-stu-id="149d3-142">Static objects live until they are deleted, BFE stops, or the system is shutdown.</span></span>
-   <span data-ttu-id="149d3-143">Persistente – persistente Objekte werden erstellt, indem das entsprechende **fwpm- \_ \* \_ Flag \_ persistentes** Flag an eine **fwpm \* Add0** -Funktion übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="149d3-143">Persistent — Persistent objects are created by passing the appropriate **FWPM\_\*\_FLAG\_PERSISTENT** flag to an **Fwpm\*Add0** function.</span></span> <span data-ttu-id="149d3-144">Persistente Objekte sind Live, bis Sie gelöscht werden.</span><span class="sxs-lookup"><span data-stu-id="149d3-144">Persistent objects live until they are deleted.</span></span>
-   <span data-ttu-id="149d3-145">Integrierte – integrierte Objekte werden von BFE vordefiniert und können nicht hinzugefügt oder gelöscht werden.</span><span class="sxs-lookup"><span data-stu-id="149d3-145">Built-in — Built-in objects are predefined by BFE and cannot be added or deleted.</span></span> <span data-ttu-id="149d3-146">Sie leben immer wieder.</span><span class="sxs-lookup"><span data-stu-id="149d3-146">They live forever.</span></span>

<span data-ttu-id="149d3-147">Filter in Kernel Modus-Schichten können als Start Zeitfilter gekennzeichnet werden, indem das entsprechende Flag an [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0)übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="149d3-147">Filters in kernel-mode layers can be marked as boot-time filters by passing the appropriate flag to [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0).</span></span> <span data-ttu-id="149d3-148">Start Zeitfilter werden dem System hinzugefügt, wenn der TCP/IP-Treiber gestartet wird, und entfernt, wenn die Initialisierung von BFE abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="149d3-148">Boot-time filters are added to the system when the TCP/IP driver starts, and removed when BFE finishes initialization.</span></span> <span data-ttu-id="149d3-149">Persistente Objekte werden hinzugefügt, wenn BFE gestartet wird.</span><span class="sxs-lookup"><span data-stu-id="149d3-149">Persistent objects are added when BFE starts.</span></span>

<span data-ttu-id="149d3-150">In vielen Fällen soll ein Richtlinien Anbieter die permanente Richtlinie möglicherweise nicht erzwingen, wenn der Anbieter deaktiviert wurde.</span><span class="sxs-lookup"><span data-stu-id="149d3-150">In many cases, a policy provider may not want its persistent policy enforced if the provider has been disabled.</span></span> <span data-ttu-id="149d3-151">Wenn Sie einen Anbieter hinzufügen, kann der Aufrufer einen optionalen Windows-Dienstnamen angeben.</span><span class="sxs-lookup"><span data-stu-id="149d3-151">When adding a provider, the caller can specify an optional Windows service name.</span></span> <span data-ttu-id="149d3-152">Beim Hinzufügen von permanenten Objekten kann der Aufrufer optional den Anbieter angeben, der das Objekt "besitzt".</span><span class="sxs-lookup"><span data-stu-id="149d3-152">When adding persistent objects, the caller can optionally specify the provider that "owns" that object.</span></span> <span data-ttu-id="149d3-153">Beim Dienst Start fügt BFE nur persistente Objekte zum System hinzu, wenn Sie keinem Anbieter zugeordnet sind, oder der zugeordnete Anbieter hat keinen Windows-Dienstnamen, oder der zugehörige Windows-Dienst ist auf automatischen Start festgelegt.</span><span class="sxs-lookup"><span data-stu-id="149d3-153">At service start, BFE only adds persistent objects to the system if they are not associated with a provider, or the associated provider has no Windows service name, or the associated Windows service is set to auto-start.</span></span>

## <a name="object-associations"></a><span data-ttu-id="149d3-154">Objekt Zuordnungen</span><span class="sxs-lookup"><span data-stu-id="149d3-154">Object Associations</span></span>

<span data-ttu-id="149d3-155">Einige Objekte verfügen über Verweise auf andere Objekte.</span><span class="sxs-lookup"><span data-stu-id="149d3-155">Some objects have references to other objects.</span></span> <span data-ttu-id="149d3-156">Ein Filter verweist z. b. immer auf eine Ebene und verweist möglicherweise auf einen Legenden-und einen Anbieter Kontext.</span><span class="sxs-lookup"><span data-stu-id="149d3-156">For example, a filter always references a layer and may reference a callout and a provider context.</span></span> <span data-ttu-id="149d3-157">Objekte können nicht auf Objekte verweisen, die eine kürzere Lebensdauer aufweisen können.</span><span class="sxs-lookup"><span data-stu-id="149d3-157">Objects cannot refer to objects that may have a shorter lifetime.</span></span> <span data-ttu-id="149d3-158">Folglich kann ein dynamisches Objekt nicht auf ein dynamisches Objekt aus einer anderen Sitzung verweisen.</span><span class="sxs-lookup"><span data-stu-id="149d3-158">Thus, a dynamic object cannot refer to a dynamic object from a different session.</span></span> <span data-ttu-id="149d3-159">Ein statisches Objekt kann nicht auf ein dynamisches Objekt verweisen.</span><span class="sxs-lookup"><span data-stu-id="149d3-159">A static object cannot refer to a dynamic object.</span></span> <span data-ttu-id="149d3-160">Ein persistentes Objekt kann nicht auf ein dynamisches Objekt, ein statisches Objekt oder ein dauerhaftes Objekt verweisen, das im Besitz eines anderen Anbieters ist.</span><span class="sxs-lookup"><span data-stu-id="149d3-160">A persistent object cannot refer to a dynamic object, a static object, or a persistent object owned by a different provider.</span></span>

<span data-ttu-id="149d3-161">Ein Objekt kann erst gelöscht werden, wenn alle Objekte, die darauf verweisen, gelöscht wurden.</span><span class="sxs-lookup"><span data-stu-id="149d3-161">An object cannot be deleted until all objects that reference it have first been deleted.</span></span>

## <a name="luids-and-guids"></a><span data-ttu-id="149d3-162">LUIDs und GUIDs</span><span class="sxs-lookup"><span data-stu-id="149d3-162">LUIDs and GUIDs</span></span>

<span data-ttu-id="149d3-163">Alle Benutzermodus-WFP-API-Objekte (swpm) werden durch eine Globally Unique Identifier (**GUID**) identifiziert, und es wird über Ihre **GUID** s auf andere Objekte verwiesen.</span><span class="sxs-lookup"><span data-stu-id="149d3-163">All user mode WFP API objects (FWPM) are identified by a globally unique identifier (**GUID**) and reference other objects by their **GUID** s.</span></span> <span data-ttu-id="149d3-164">Der **GUID** muss nur innerhalb des Objekt Typs eindeutig sein.</span><span class="sxs-lookup"><span data-stu-id="149d3-164">The **GUID** need only be unique within the object type.</span></span> <span data-ttu-id="149d3-165">Beispielsweise können ein Filter und ein Anbieter Kontext dieselbe **GUID** aufweisen, aber zwei Filter sind nicht möglich.</span><span class="sxs-lookup"><span data-stu-id="149d3-165">For example, a filter and a provider context can have the same **GUID**, but two filters cannot.</span></span> <span data-ttu-id="149d3-166">Beim Hinzufügen eines neuen Objekts können Aufrufer die **GUID** des Objekts zuweisen oder Sie mit 0 (null) initialisieren lassen, und die **GUID** kann von BFE zugewiesen werden.</span><span class="sxs-lookup"><span data-stu-id="149d3-166">When adding a new object, callers can assign the object's **GUID** or leave it zero-initialized and let BFE assign the **GUID**.</span></span>

<span data-ttu-id="149d3-167">Alle Kernelmodus-WFP-API-Objekte (SWPS) werden durch einen lokalen eindeutigen Bezeichner (**LUID**) identifiziert und über Ihre LUID auf andere Objekte verweisen.</span><span class="sxs-lookup"><span data-stu-id="149d3-167">All kernel mode WFP API objects (FWPS) are identified by a locally unique identifier (**LUID**) and reference other objects by their LUID.</span></span> <span data-ttu-id="149d3-168">Der Switch von **GUID** zu **LUID** ermöglicht WFP, den nicht auslagerten Pool zu sparen und die Lauf Zeit Verarbeitung zu optimieren.</span><span class="sxs-lookup"><span data-stu-id="149d3-168">The switch from **GUID** to **LUID** enables WFP to conserve non-paged pool and optimize run-time processing.</span></span> <span data-ttu-id="149d3-169">Die Breite der **LUID** hängt von dem Objekttyp und den Bereichen von einem **UInt16** zu einem **UINT64** ab.</span><span class="sxs-lookup"><span data-stu-id="149d3-169">The width of the **LUID** depends on the object type and ranges from a **UINT16** to a **UINT64**.</span></span> <span data-ttu-id="149d3-170">**LUID** s werden immer von BFE zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="149d3-170">**LUID** s are always assigned by BFE.</span></span>

 

 