---
description: Behandlung von Cookies in WinHTTP
ms.assetid: ef0f0847-05f6-4477-8e48-e0bea66314ab
title: Behandlung von Cookies in WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8e3b596225dc3c741ab9ed0139a63e343e7afb3d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "106349725"
---
# <a name="cookie-handling-in-winhttp"></a><span data-ttu-id="3d97b-103">Behandlung von Cookies in WinHTTP</span><span class="sxs-lookup"><span data-stu-id="3d97b-103">Cookie Handling in WinHTTP</span></span>

<span data-ttu-id="3d97b-104">HTTP-Sitzungsdaten werden zwischen dem Client und dem Server im Cookie-Header der Anforderung oder der Antwort übermittelt.</span><span class="sxs-lookup"><span data-stu-id="3d97b-104">HTTP session data is passed between the client and server in the cookie header of the request or the response.</span></span> <span data-ttu-id="3d97b-105">Der Server sendet Cookies im Set-Cookie-Header der Antwort an den Client, und die WinHTTP-API sendet das Server Cookie erneut an den Server im Cookieheader der Anforderung.</span><span class="sxs-lookup"><span data-stu-id="3d97b-105">The server sends cookies to the client in the Set-cookie header of the response and the WinHTTP API resends the server cookie to the server in the cookie header of the request.</span></span> <span data-ttu-id="3d97b-106">Die in RFC 2109 (http State Management-Mechanismus) beschriebenen Spezifikationen zur Behandlung von Cookies werden standardmäßig in WinHTTP implementiert.</span><span class="sxs-lookup"><span data-stu-id="3d97b-106">The cookie handling specifications, described in rfc 2109 (HTTP State Management Mechanism), are implemented by default in WinHTTP.</span></span> <span data-ttu-id="3d97b-107">Die aktuellen Spezifikationen für die Behandlung von Cookies, die in RFC 2964 beschrieben werden, werden von WinHTTP nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="3d97b-107">Recent cookie handling specifications, described in rfc 2964, are not supported by WinHTTP.</span></span>

<span data-ttu-id="3d97b-108">WinHTTP Ruft das Cookie von der Server Set-Cookie Kopfzeile ab und speichert es pro Sitzung in einem Cache.</span><span class="sxs-lookup"><span data-stu-id="3d97b-108">WinHTTP obtains the cookie from the servers Set-Cookie header and stores it in a cache on a per-session basis.</span></span> <span data-ttu-id="3d97b-109">Dieses Cookie wird bei nachfolgenden Anforderungen in derselben WinHTTP-Sitzung erneut gesendet, in der das Ziel mit der Quelle des Cookies übereinstimmt.</span><span class="sxs-lookup"><span data-stu-id="3d97b-109">This cookie is resent on subsequent requests in the same WinHTTP session where the target matches the source of the cookie.</span></span> <span data-ttu-id="3d97b-110">Die WinHTTP-API generiert den Anforderungs Cookie-Header für jeden Abschnitt in der Anforderung erneut.</span><span class="sxs-lookup"><span data-stu-id="3d97b-110">The WinHTTP API regenerates the request cookie header for each leg in the request.</span></span>

<span data-ttu-id="3d97b-111">In der folgenden Liste werden verschiedene Optionen beschrieben, die WinHTTP-Client Anwendungen zum Verarbeiten von Cookies verwenden können:</span><span class="sxs-lookup"><span data-stu-id="3d97b-111">The follow list describes several options that WinHTTP client applications can use to handle cookies:</span></span>

-   <span data-ttu-id="3d97b-112">Automatische Cookiebehandlung: mit WinHTTP werden Cookies automatisch verarbeitet, und die Client Anwendung führt keine benutzerdefinierte Cookiebehandlung aus.</span><span class="sxs-lookup"><span data-stu-id="3d97b-112">Automatic Cookie Handling - WinHTTP automatically handles cookies and the client application performs no custom cookie handling.</span></span>
-   <span data-ttu-id="3d97b-113">Deaktivieren der automatischen Cookiebehandlung: die Automatische Cookiebehandlung in der WinHTTP-API ist deaktiviert, und es werden keine Cookies gesendet.</span><span class="sxs-lookup"><span data-stu-id="3d97b-113">Disable Automatic Cookie Handling - Automatic cookie handling in the WinHTTP API is disabled and no cookies are sent.</span></span>
-   <span data-ttu-id="3d97b-114">Manuelles angeben aller Cookies – die Automatische Cookiebehandlung ist deaktiviert, und die Client Anwendung fügt alle Cookie-Header für jede Anforderung in der Sitzung hinzu bzw. entfernt Sie.</span><span class="sxs-lookup"><span data-stu-id="3d97b-114">Manually specify all Cookies – Automatic cookie handling is disabled and the client application adds or removes all cookie headers for each request in the session.</span></span>
-   <span data-ttu-id="3d97b-115">Manuelle und automatische Cookie-Behandlung: kombinieren Sie die automatische und manuelle Behandlung von Cookies.</span><span class="sxs-lookup"><span data-stu-id="3d97b-115">Manual and Automatic Cookie Handling - Combine automatic and manual cookie handling.</span></span>

## <a name="disabling-automatic-cookie-handling"></a><span data-ttu-id="3d97b-116">Deaktivieren der automatischen Behandlung von Cookies</span><span class="sxs-lookup"><span data-stu-id="3d97b-116">Disabling Automatic Cookie Handling</span></span>

<span data-ttu-id="3d97b-117">Zum Deaktivieren der Cookiebehandlung Ruft die WinHTTP-Client Anwendung die [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) -Funktion auf, wobei der Parameter *dwOption* auf WinHTTP \_ \_ -Option deaktivierte \_ Funktion und der *lpBuffer* -Parameter auf WinHTTP- \_ Deaktivierte Cookies festgelegt ist \_ .</span><span class="sxs-lookup"><span data-stu-id="3d97b-117">To disable cookie handling, the WinHTTP client application calls the [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) function with the *dwOption* parameter set to WINHTTP\_OPTION\_DISABLE\_FEATURE, and the *lpBuffer* parameter set to WINHTTP\_DISABLE\_COOKIES.</span></span> <span data-ttu-id="3d97b-118">Der *HINTERNET* -Parameter kann entweder ein Sitzungs handle oder ein Anforderungs Handle sein.</span><span class="sxs-lookup"><span data-stu-id="3d97b-118">The *hInternet* parameter can be either a session handle or a request handle.</span></span> <span data-ttu-id="3d97b-119">Wenn die Cookie-Verarbeitung für ein Anforderungs handle deaktiviert ist, das eine vorherige Anforderung gesendet hat, sollte der Client vorhandene Anforderungs Cookie-Header manuell mit der [**winhttpadressquestheaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) -Funktion entfernen, bevor die nächste Anforderung gesendet wird.</span><span class="sxs-lookup"><span data-stu-id="3d97b-119">When cookie handling is disabled on a request handle that has sent a previous request, the client should manually remove existing request cookie headers with the [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) function before sending the next request.</span></span> <span data-ttu-id="3d97b-120">Weitere Informationen finden Sie unter [Entfernen von Cookie-Headern](#removing-cookie-headers).</span><span class="sxs-lookup"><span data-stu-id="3d97b-120">For more information, see [Removing Cookie Headers](#removing-cookie-headers).</span></span>

<span data-ttu-id="3d97b-121">**Hinweis**  Die Client Anwendung muss alle Cookies in der Sitzung festlegen, nachdem der automatische Modus deaktiviert wurde.</span><span class="sxs-lookup"><span data-stu-id="3d97b-121">**Note**  The client application must set all cookies on the session after automatic mode has been disabled.</span></span>

## <a name="manually-specifying-all-cookies"></a><span data-ttu-id="3d97b-122">Manuelles angeben aller Cookies</span><span class="sxs-lookup"><span data-stu-id="3d97b-122">Manually Specifying All Cookies</span></span>

<span data-ttu-id="3d97b-123">Wenn die Automatische Cookiebehandlung deaktiviert ist, kann die WinHTTP-Client Anwendung alle Cookies manuell angeben.</span><span class="sxs-lookup"><span data-stu-id="3d97b-123">When automatic cookie handling is disabled, the WinHTTP client application has the option to manually specify all cookies.</span></span> <span data-ttu-id="3d97b-124">Um das Cookie manuell festzulegen, ruft die Anwendung [**winhttpadressquestheaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) auf und gibt den Cookie-Header im *pwszheaders* -Parameter an.</span><span class="sxs-lookup"><span data-stu-id="3d97b-124">To manually set the cookie, the application calls [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) specifying the cookie header in the *pwszHeaders* parameter.</span></span> <span data-ttu-id="3d97b-125">Die Client Anwendung sollte vor dem erneuten Senden der Anforderung alle Cookie-Header löschen.</span><span class="sxs-lookup"><span data-stu-id="3d97b-125">The client application should clear all cookie headers before resending the request.</span></span>

<span data-ttu-id="3d97b-126">Die Client Anwendung sollte auch den Cookie-Header ändern, wenn die Anforderung umgeleitet wurde.</span><span class="sxs-lookup"><span data-stu-id="3d97b-126">The client application should also change the cookie header when the request has been redirected.</span></span> <span data-ttu-id="3d97b-127">Um das Cookie für umgeleitete Anforderungen zu ändern, gibt der Client eine Rückruffunktion mit [**winhttpsetstatus Callback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback) an, die auf den Umleitungs Rückruf Fall antwortet.</span><span class="sxs-lookup"><span data-stu-id="3d97b-127">To change the cookie on redirected requests, the client specifies a callback function with [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback) that responds to the redirect callback case.</span></span> <span data-ttu-id="3d97b-128">Der Rückruf Handler sollte das Cookie, das zuvor in der Anforderung gesendet wurde, durch Aufrufen von [**winhttpadressquestheaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders)löschen.</span><span class="sxs-lookup"><span data-stu-id="3d97b-128">The callback handler should clear the cookie previously sent on the request by calling [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders).</span></span> <span data-ttu-id="3d97b-129">Weitere Informationen zum Entfernen von Cookie-Headern finden Sie unter [Entfernen von Cookie-Headern](#removing-cookie-headers).</span><span class="sxs-lookup"><span data-stu-id="3d97b-129">For more information about removing cookie headers, see [Removing Cookie Headers](#removing-cookie-headers).</span></span>

## <a name="manual-and-automatic-cookie-handling"></a><span data-ttu-id="3d97b-130">Manuelle und automatische Behandlung von Cookies</span><span class="sxs-lookup"><span data-stu-id="3d97b-130">Manual and Automatic Cookie Handling</span></span>

<span data-ttu-id="3d97b-131">WinHTTP-Client Anwendungen können den automatischen WinHTTP-Cookie-Behandlungs Mechanismus mit manueller Behandlung von Cookies kombinieren.</span><span class="sxs-lookup"><span data-stu-id="3d97b-131">WinHTTP client applications can combine the WinHTTP automatic cookie handling mechanism with manual cookie handling.</span></span> <span data-ttu-id="3d97b-132">Die Anwendung fügt dem automatisch generierten Cookieheader benutzerdefinierte Cookies hinzu, bevor die Anforderung mit der [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) -Funktion gesendet wird.</span><span class="sxs-lookup"><span data-stu-id="3d97b-132">The application adds custom cookies to the automatically generated cookie header before sending the request with the [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) function.</span></span> <span data-ttu-id="3d97b-133">Das benutzerdefinierte Cookie sollte der erste Cookie-Header in der Anforderung für die WinHTTP-API sein, um das Cookie ordnungsgemäß zwischenzuspeichern.</span><span class="sxs-lookup"><span data-stu-id="3d97b-133">The custom cookie should be the first cookie header in the request for the WinHTTP API to properly cache the cookie.</span></span> <span data-ttu-id="3d97b-134">Die Client Anwendung sollte auch Cookies entfernen, die für vorherige Anforderungen gesendet wurden, bevor eine Anforderung für dasselbe Anforderungs handle erneut gesendet wird.</span><span class="sxs-lookup"><span data-stu-id="3d97b-134">The client application should also remove cookies sent on previous requests before resending a request on the same request handle.</span></span> <span data-ttu-id="3d97b-135">Weitere Informationen finden Sie unter Entfernen von Cookie-Headern.</span><span class="sxs-lookup"><span data-stu-id="3d97b-135">For more information, see Removing Cookie Headers.</span></span>

<span data-ttu-id="3d97b-136">Cookies, die einer Anforderung vor dem Aufruf von [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) hinzugefügt werden, sind in allen WinHTTP-Anforderungen enthalten, die im Auftrag der nächsten **WinHttpSendRequest** -und [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) -Aufrufe gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="3d97b-136">Cookies added to a request before the call to [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) are included in all WinHTTP requests sent on behalf of the next **WinHttpSendRequest** and [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) calls.</span></span> <span data-ttu-id="3d97b-137">Die Client Anwendung muss möglicherweise den Cookie-Header löschen, wenn die Anforderung umgeleitet wurde.</span><span class="sxs-lookup"><span data-stu-id="3d97b-137">The client application may need to clear the cookie header when the request has been redirected.</span></span> <span data-ttu-id="3d97b-138">Um das Cookie für umgeleitete Anforderungen zu löschen, gibt der Client eine Rückruffunktion mit [**winhttpsetstatus Callback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback) an, die auf den Umleitungs Rückruf Fall antwortet.</span><span class="sxs-lookup"><span data-stu-id="3d97b-138">To clear the cookie on redirected requests, the client specifies a callback function with [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback) that responds to the redirect callback case.</span></span> <span data-ttu-id="3d97b-139">Der Rückruf Handler sollte das Cookie, das zuvor in der Anforderung gesendet wurde, durch Aufrufen von [**winhttpadressquestheaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders)löschen.</span><span class="sxs-lookup"><span data-stu-id="3d97b-139">The callback handler should clear the cookie that was previously sent on the request by calling [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders).</span></span> <span data-ttu-id="3d97b-140">Die Rückruffunktion legt möglicherweise keine neuen benutzerdefinierten Cookies für den Umleitungs Rückruf fest.</span><span class="sxs-lookup"><span data-stu-id="3d97b-140">The callback function may not set new custom cookies on the redirect callback.</span></span> <span data-ttu-id="3d97b-141">Der Client muss auf den Abschluss von **WinHttpReceiveResponse** warten, bevor neue Cookies für den nächsten **WinHttpSendRequest** -Befehl hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="3d97b-141">The client must wait for **WinHttpReceiveResponse** to complete before adding new cookies for the next **WinHttpSendRequest** call.</span></span>

## <a name="removing-cookie-headers"></a><span data-ttu-id="3d97b-142">Entfernen der Cookie-Header</span><span class="sxs-lookup"><span data-stu-id="3d97b-142">Removing Cookie Headers</span></span>

<span data-ttu-id="3d97b-143">Die WinHTTP-Client Anwendung muss möglicherweise das vorhandene Anforderungs Cookie löschen, bevor eine Anforderung erneut gesendet wird, um zu verhindern, dass Cookies, die für vorherige Anforderungen gesendet wurden, bei der aktuellen Anforderung erneut gesendet werden. Weitere Informationen finden Sie in der folgenden Notiz.</span><span class="sxs-lookup"><span data-stu-id="3d97b-143">The WinHTTP client application may need to clear the existing request cookie before resending a request to prevent cookies that were sent on previous requests from being sent again on the current request; for more information, see the following Note.</span></span> <span data-ttu-id="3d97b-144">Beachten Sie auch, dass Cookies nicht gelöscht werden müssen, bevor die erste Anforderung für das Anforderungs handle gesendet wird.</span><span class="sxs-lookup"><span data-stu-id="3d97b-144">Also be aware that Cookies do not have to be cleared before the first request is sent on the request handle.</span></span> <span data-ttu-id="3d97b-145">Der Client kann vorhandene Cookies löschen, indem er [**winhttpadressquestheaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) mit einem leeren Cookieheader im *pwszheaders* -Parameter und das \_ \_ \_ im Parameter " *dwmodifier* " festgelegte Flag "WinHTTP-adressflag ersetzen" aufruft.</span><span class="sxs-lookup"><span data-stu-id="3d97b-145">The client can clear existing cookies by calling [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) with an empty cookie header in the *pwszHeaders* parameter and the WINHTTP\_ADDREQ\_FLAG\_REPLACE flag set in the *dwModifier* parameter.</span></span> <span data-ttu-id="3d97b-146">Im folgenden Codebeispiel wird gezeigt, wie der Cookie-Header für die Anforderung gelöscht wird.</span><span class="sxs-lookup"><span data-stu-id="3d97b-146">The following code example shows how to clear the cookie header on the request.</span></span>

``` syntax
WinHttpAddRequestHeaders( hRequest, 
                          L"Cookie:", 
                          -1, 
                          WINHTTP_ADDREQ_FLAG_REPLACE);
```

<span data-ttu-id="3d97b-147">Die WinHTTP-API verfügt über unterschiedliche Verhalten beim Verhalten von Cookies für Versionen des Betriebssystems vor Windows XP mit Service Pack 2 (SP2) und Windows Server 2003 mit Service Pack 1 (SP1).</span><span class="sxs-lookup"><span data-stu-id="3d97b-147">The WinHTTP API has different cookie handling behaviors for versions of the operating system earlier than Windows XP with Service Pack 2 (SP2) and Windows Server 2003 with Service Pack 1 (SP1).</span></span>

<span data-ttu-id="3d97b-148">\* \* Windows XP mit SP2 und höher und Windows Server 2003 mit SP1 und höher: \* \*</span><span class="sxs-lookup"><span data-stu-id="3d97b-148">\*\*Windows XP with SP2 and later and Windows Server 2003 with SP1 and later:  \*\*</span></span>

<span data-ttu-id="3d97b-149">Die WinHTTP-API löscht alle Cookies, die für vorherige Anforderungen für das Anforderungs handle gesendet wurden.</span><span class="sxs-lookup"><span data-stu-id="3d97b-149">The WinHTTP API clears all cookies sent on previous requests for the request handle.</span></span> <span data-ttu-id="3d97b-150">Der Client kann vor jedem WinHttpSendRequest-Rückruf manuell neue Cookie-Header hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="3d97b-150">The client can manually add new cookie headers before each call to WinHttpSendRequest.</span></span> <span data-ttu-id="3d97b-151">Wenn die Funktion zur automatischen Behandlung von Cookies der WinHTTP-API nicht deaktiviert wurde, fügt die WinHTTP-API den neuen Cookie-Header an (oder fügt einen neuen Cookie-Header hinzu, wenn die Client Anwendung keinen manuell hinzugefügt hat) mit dem Cookie vom Server.</span><span class="sxs-lookup"><span data-stu-id="3d97b-151">If the automatic cookie handling functionality of the WinHTTP API has not been disabled, the WinHTTP API will append the new cookie header (or add a new cookie header if the client application did not add one manually) with the cookie from the server.</span></span>

<span data-ttu-id="3d97b-152">\* \* Windows XP mit SP2 und Windows Server 2003 mit SP1: \* \*</span><span class="sxs-lookup"><span data-stu-id="3d97b-152">\*\*Windows XP with SP2 and Windows Server 2003 with SP1:  \*\*</span></span>

<span data-ttu-id="3d97b-153">Die WinHTTP-API löscht den Anforderungs Cookie-Header nicht, nachdem [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) abgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="3d97b-153">The WinHTTP API does not clear the request cookie header after [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) completes.</span></span> <span data-ttu-id="3d97b-154">In früheren Anforderungen gesendete Cookies werden bei nachfolgenden Aufrufen von " [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest)" erneut gesendet.</span><span class="sxs-lookup"><span data-stu-id="3d97b-154">Cookies sent in previous requests will be resent in subsequent calls to [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest).</span></span> <span data-ttu-id="3d97b-155">Die WinHTTP-Client Anwendung sollte vor dem erneuten Senden einer Anforderung für das Anforderungs handle vorhandene Cookies-Header löschen.</span><span class="sxs-lookup"><span data-stu-id="3d97b-155">The WinHTTP client application should clear existing cookies headers before resending a request on the request handle.</span></span>

 

 



