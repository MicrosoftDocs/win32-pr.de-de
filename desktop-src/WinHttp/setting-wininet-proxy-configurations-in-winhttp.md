---
description: Anwendungen, die von WinInet zu WinHTTP portieren, müssen möglicherweise dieselben aktivierter automatischer Proxy-Einstellungen verwenden, die Sie unter WinInet oder Internet Explorer (IE) abrufen können.
ms.assetid: c3e867d8-9d67-4e6a-8551-1fa846e089ed
title: Festlegen von WinInet-Proxy Konfigurationen in WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 91306f6591e0aab0f96fa010ee2a83d3f32c8fb4
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "103960798"
---
# <a name="setting-wininet-proxy-configurations-in-winhttp"></a><span data-ttu-id="d6fad-103">Festlegen von WinInet-Proxy Konfigurationen in WinHTTP</span><span class="sxs-lookup"><span data-stu-id="d6fad-103">Setting WinINet Proxy Configurations in WinHTTP</span></span>

## <a name="setting-automatic-proxy-on-winhttp-51"></a><span data-ttu-id="d6fad-104">Festlegen des automatischen Proxys unter WinHTTP 5,1</span><span class="sxs-lookup"><span data-stu-id="d6fad-104">Setting Automatic Proxy on WinHTTP 5.1</span></span>

<span data-ttu-id="d6fad-105">Anwendungen, die von WinInet zu WinHTTP portieren, müssen möglicherweise dieselben aktivierter automatischer Proxy-Einstellungen verwenden, die Sie unter WinInet oder Internet Explorer (IE) abrufen können.</span><span class="sxs-lookup"><span data-stu-id="d6fad-105">Applications that port from WinINet to WinHTTP may need to use the same autoproxy settings that they can retrieve under WinINet or Internet Explorer (IE).</span></span> <span data-ttu-id="d6fad-106">Die WinHTTP-API, Version 5,1, kann diese Proxy Einstellungen abrufen und verwenden.</span><span class="sxs-lookup"><span data-stu-id="d6fad-106">The WinHTTP version 5.1 API can retrieve and use these proxy settings.</span></span> <span data-ttu-id="d6fad-107">Im Allgemeinen gibt WinHTTP die Proxy-und Proxy Umgehungs Server auf Sitzungs Basis an, wenn die Sitzung erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="d6fad-107">In general, WinHTTP specifies the proxy and proxy bypass servers on a per-session basis when the session is created.</span></span> <span data-ttu-id="d6fad-108">Diese Einstellungen können auf Anforderungs Basis überschrieben werden.</span><span class="sxs-lookup"><span data-stu-id="d6fad-108">These settings can be overridden on a per-request basis.</span></span>

<span data-ttu-id="d6fad-109">Um dieselbe Proxykonfiguration wie WinInet oder IE zu verwenden, sollte der WinHTTP-Client Proxy Einstellungen für die Sitzung festlegen.</span><span class="sxs-lookup"><span data-stu-id="d6fad-109">To use the same proxy configuration as WinINet or IE, the WinHTTP client should set proxy settings for the session.</span></span> <span data-ttu-id="d6fad-110">Wenn IE oder WinInet für die Verwendung von Web Proxy Auto-Discovery (WPAD) konfiguriert ist, muss der WinHTTP-Client, der diese Einstellungen verwendet, die Proxy Einstellungen pro Anforderung festlegen.</span><span class="sxs-lookup"><span data-stu-id="d6fad-110">In addition, if IE or WinINet are configured to use Web Proxy Auto-Discovery (WPAD), the WinHTTP client that uses those settings must set proxy settings on a per-request basis.</span></span> <span data-ttu-id="d6fad-111">In den folgenden Abschnitten wird beschrieben, wie Sie die Proxy Einstellungen für eine Sitzung und eine Anforderung angeben:</span><span class="sxs-lookup"><span data-stu-id="d6fad-111">The following sections describe how to specify the proxy settings for a session and a request:</span></span>

-   [<span data-ttu-id="d6fad-112">Festlegen der Proxy Konfiguration für eine Sitzung</span><span class="sxs-lookup"><span data-stu-id="d6fad-112">Setting the Proxy Configuration on a Session</span></span>](#setting-the-proxy-configuration-on-a-session)
-   [<span data-ttu-id="d6fad-113">Festlegen der Proxy Konfiguration für eine einzelne Anforderung</span><span class="sxs-lookup"><span data-stu-id="d6fad-113">Setting the Proxy Configuration on a Single Request</span></span>](#setting-the-proxy-configuration-on-a-single-request)

## <a name="setting-the-proxy-configuration-on-a-session"></a><span data-ttu-id="d6fad-114">Festlegen der Proxy Konfiguration für eine Sitzung</span><span class="sxs-lookup"><span data-stu-id="d6fad-114">Setting the Proxy Configuration on a Session</span></span>

## <a name="the-application-is-running-on-a-user-account"></a><span data-ttu-id="d6fad-115">Die Anwendung wird auf einem Benutzerkonto ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="d6fad-115">The Application is Running on a User Account</span></span>

<span data-ttu-id="d6fad-116">Bevor eine Sitzung erstellt wird, ruft die Anwendung [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) auf, um die Internet Explorer-Proxy Einstellungen zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="d6fad-116">Before a session is created, the application calls [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) to get the IE proxy settings.</span></span> <span data-ttu-id="d6fad-117">Die Anwendung muss als Benutzerkonto ausgeführt werden, um diese Einstellungen zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="d6fad-117">The application must be running as a user account to obtain these settings.</span></span> <span data-ttu-id="d6fad-118">Der *pproxyconfig* -Parameter ist ein Zeiger auf eine aktuelle WinHTTP-Benutzer-/proxykonfigurationsstruktur, die den Proxy Namen (*lpszProxy*) und Proxy Umgehungs Server (*lpszProxyBypass*) enthält. [**\_ \_ \_ \_ \_**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config)</span><span class="sxs-lookup"><span data-stu-id="d6fad-118">The *pProxyConfig* parameter is a pointer to a [**WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) structure that contains the proxy name (*lpszProxy*) and proxy bypass (*lpszProxyBypass*) servers.</span></span> <span data-ttu-id="d6fad-119">Der Proxy Name und die Proxy Umgehungs Werte der Kontext Konfigurations Struktur des **aktuellen WinHTTP- \_ \_ Benutzers \_ \_ \_** werden dann verwendet, um die WinHTTP-Sitzung zu initialisieren.</span><span class="sxs-lookup"><span data-stu-id="d6fad-119">The proxy name and proxy bypass values of the **WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG** structure are then used to initialize the WinHTTP session.</span></span> <span data-ttu-id="d6fad-120">Die Sitzung wird durch Aufrufen von [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) mit den Parametern *pwszproxyname* und *pwszproxybypass* initialisiert, die von den **lpszProxy** -und **lpszProxyBypass** -Membern der Konfigurations Struktur des **aktuellen WinHTTP- \_ Benutzers ( \_ \_ IE \_ \_** ) abgerufen wurden.</span><span class="sxs-lookup"><span data-stu-id="d6fad-120">The session is initialized by calling [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) with the *pwszProxyName* and *pwszProxyBypass* parameters obtained from the **lpszProxy** and **lpszProxyBypass** members of the **WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG** structure.</span></span>

## <a name="the-application-is-running-as-a-service"></a><span data-ttu-id="d6fad-121">Die Anwendung wird als Dienst ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="d6fad-121">The Application is Running as a Service</span></span>

<span data-ttu-id="d6fad-122">Die Anwendung muss sicherstellen, dass die Registrierungs Einstellungen für einen einzelnen Benutzer in die Registrierung geladen werden, bevor [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser)aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="d6fad-122">The application must ensure that the registry settings for an individual user are loaded into the registry before calling [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser).</span></span> <span data-ttu-id="d6fad-123">Wenn diese Einstellungen nicht in die Registrierung geladen werden, kann **WinHttpGetIEProxyConfigForCurrentUser** die Proxy Einstellungen nicht abrufen.</span><span class="sxs-lookup"><span data-stu-id="d6fad-123">If these settings are not loaded into the registry, **WinHttpGetIEProxyConfigForCurrentUser** cannot obtain the proxy settings.</span></span> <span data-ttu-id="d6fad-124">Registrierungs Einstellungen für einen einzelnen Benutzer können durch Aufrufen der **LoadUserProfile** -Funktion in die Registrierung geladen werden.</span><span class="sxs-lookup"><span data-stu-id="d6fad-124">Registry settings for an individual user can be loaded into the registry by calling the **LoadUserProfile** function.</span></span> <span data-ttu-id="d6fad-125">Wenn das Laden der Registrierungs Einstellungen des Benutzers keine Option ist, kann die Anwendung [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) mit dem **Standard Proxy für den WinHTTP- \_ \_ Zugriffstyp \_ \_** aufrufen, der im *dwacesstype* -Parameter angegeben ist.</span><span class="sxs-lookup"><span data-stu-id="d6fad-125">If loading the user's registry settings is not an option, the application can call [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) with the **WINHTTP\_ACCESS\_TYPE\_DEFAULT\_PROXY** specified in the *dwAcessType* parameter.</span></span> <span data-ttu-id="d6fad-126">Das Angeben des Standard Proxys im Aufrufen von **WinHttpOpen** weist die WinHTTP-API an, den Proxy Konfigurationssatz mithilfe des WinHTTP- [**proxycfg.exe**](proxycfg-exe--a-proxy-configuration-tool.md) Hilfsprogramms abzurufen.</span><span class="sxs-lookup"><span data-stu-id="d6fad-126">Specifying the default proxy in the call to **WinHttpOpen** tells the WinHTTP API to retrieve the proxy configuration set by using the WinHTTP [**proxycfg.exe**](proxycfg-exe--a-proxy-configuration-tool.md) utility.</span></span> <span data-ttu-id="d6fad-127">Nachdem die Registrierungs Einstellungen für einen einzelnen Benutzer geladen wurden, führt die Anwendung die unter [der Anwendung wird auf einem Benutzerkonto ausgeführt wird](#the-application-is-running-on-a-user-account) beschriebenen Schritte aus, um den Proxy Namen und die Proxy Umgehungs Server festzulegen.</span><span class="sxs-lookup"><span data-stu-id="d6fad-127">After the registry settings for an individual user have been loaded, the application follows the steps outlined under [The application is running on a user account](#the-application-is-running-on-a-user-account) to set the proxy name and proxy bypass servers.</span></span>

## <a name="setting-the-proxy-configuration-on-a-single-request"></a><span data-ttu-id="d6fad-128">Festlegen der Proxy Konfiguration für eine einzelne Anforderung</span><span class="sxs-lookup"><span data-stu-id="d6fad-128">Setting the Proxy Configuration on a Single Request</span></span>

<span data-ttu-id="d6fad-129">Bevor die Sitzung erstellt wird, ruft die Anwendung [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) auf, um zu ermitteln, ob WinInet und IE für die Verwendung von WPAD konfiguriert sind.</span><span class="sxs-lookup"><span data-stu-id="d6fad-129">Before the session is created, the application calls [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) to determine if WinINet and IE are configured to use WPAD.</span></span> <span data-ttu-id="d6fad-130">**WinHttpGetIEProxyConfigForCurrentUser** gibt die Struktur des [**aktuellen WinHTTP- \_ Benutzers der IE- \_ \_ \_ Proxy \_ Konfiguration**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) zurück, die das **fAutoDetect** -Element enthält.</span><span class="sxs-lookup"><span data-stu-id="d6fad-130">**WinHttpGetIEProxyConfigForCurrentUser** returns the [**WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) structure that contains the **fAutoDetect** member.</span></span> <span data-ttu-id="d6fad-131">Der Wert **true** für diesen Member gibt an, dass WPAD verwendet wird und der Member **lpszAutoConfigUrl** die WPAD-URL enthält.</span><span class="sxs-lookup"><span data-stu-id="d6fad-131">A value of **TRUE** for this member indicates that WPAD is used, and the **lpszAutoConfigUrl** member contains the WPAD URL.</span></span>

## <a name="automatic-proxy-configuration-is-used"></a><span data-ttu-id="d6fad-132">Automatische Proxy Konfiguration wird verwendet</span><span class="sxs-lookup"><span data-stu-id="d6fad-132">Automatic Proxy Configuration Is Used</span></span>

<span data-ttu-id="d6fad-133">Wenn WPAD verwendet wird, ruft die Anwendung [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) zum Abrufen des Proxys für die Anforderung auf.</span><span class="sxs-lookup"><span data-stu-id="d6fad-133">If WPAD is used, the application calls [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) to retrieve the proxy for the request.</span></span> <span data-ttu-id="d6fad-134">Der *lpwszurl* -Parameter enthält die URL, an die die Anforderung gesendet wird, und der Parameter " *pautoproxyoptions* " enthält einen Zeiger auf die Struktur ([**WinHTTP \_ aktivierter automatischer Proxy- \_ Optionen**](/windows/win32/api/winhttp/ns-winhttp-winhttp_autoproxy_options)), die die aktivierter automatischer Proxy-Optionen enthält.</span><span class="sxs-lookup"><span data-stu-id="d6fad-134">The *lpwszUrl* parameter contains the URL that the request is being sent to, and the *pAutoProxyOptions* parameter contains a pointer to the structure ([**WINHTTP\_AUTOPROXY\_OPTIONS**](/windows/win32/api/winhttp/ns-winhttp-winhttp_autoproxy_options)) that contains the autoproxy options.</span></span> <span data-ttu-id="d6fad-135">Die Anwendung initialisiert die **WinHTTP \_ AutoProxy \_ options** -Struktur mit den Einstellungen, die von der WinHTTP-Struktur des [**\_ aktuellen \_ Benutzers der IE- \_ \_ Proxy \_ Konfiguration**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) im Aufrufen von [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser)zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="d6fad-135">The application initializes the **WINHTTP\_AUTOPROXY\_OPTIONS** structure with the settings returned from the [**WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) structure in the call to [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser).</span></span> <span data-ttu-id="d6fad-136">Das Flag " **WinHTTP \_ AutoProxy \_ config \_ URL** " ist im **dwFlags** -Member der **WinHTTP- \_ AutoProxy \_ options** -Struktur angegeben, und das **lpszAutoConfigUrl** -Element enthält die URL für die automatische Proxykonfiguration aus der **\_ \_ \_ \_ \_ Konfigurations Struktur des aktuellen WinHTTP-Benutzers** .</span><span class="sxs-lookup"><span data-stu-id="d6fad-136">The **WINHTTP\_AUTOPROXY\_CONFIG\_URL** flag is specified in the **dwFlags** member of the **WINHTTP\_AUTOPROXY\_OPTIONS** structure, and the **lpszAutoconfigUrl** member contains the proxy auto-configuration URL from the **WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG** structure.</span></span> <span data-ttu-id="d6fad-137">Die **WinHttpGetProxyForUrl** -Funktion gibt den Proxy Namen und die Proxy Umgehungs Liste in den **lpszProxy** -und **lpszProxyBypass** -Membern der [**WinHTTP- \_ Proxy \_ Info**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) -Struktur zurück.</span><span class="sxs-lookup"><span data-stu-id="d6fad-137">The **WinHttpGetProxyForUrl** function returns the proxy name and the proxy bypass list in the **lpszProxy** and **lpszProxyBypass** members of the [**WINHTTP\_PROXY\_INFO**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) structure.</span></span>

<span data-ttu-id="d6fad-138">Nachdem der Proxy für die Anforderung von [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl)abgerufen wurde, erstellt die Anwendung die Anforderung mit [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span><span class="sxs-lookup"><span data-stu-id="d6fad-138">After the proxy for the request is obtained from [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl), the application creates the request with [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span></span> <span data-ttu-id="d6fad-139">Anschließend wird " [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) " aufgerufen, um den Proxy für die Anforderung festzulegen, indem das Anforderungs Handle im *HINTERNET* -Parameter angegeben wird.</span><span class="sxs-lookup"><span data-stu-id="d6fad-139">Then [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) is called to set the proxy for the request by specifying the request handle in the *hInternet* parameter.</span></span> <span data-ttu-id="d6fad-140">Der Parameter " *dwOption* " im Aufrufen von " **WinHttpSetOption** " sollte auf die **WinHTTP- \_ Option " \_ Proxy** " festgelegt werden, und der *lpBuffer* -Parameter ist ein Zeiger auf eine [**WinHTTP- \_ Proxy \_ Informations**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) Struktur, die den Proxy und die Proxy Umgehung enthält, die für die Anforderung verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="d6fad-140">The *dwOption* parameter in the call to **WinHttpSetOption** should be set to **WINHTTP\_OPTION\_PROXY** and the *lpBuffer* parameter is a pointer to a [**WINHTTP\_PROXY\_INFO**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) structure that contains the proxy and proxy bypass to be used for the request.</span></span>

## <a name="automatic-proxy-configuration-is-not-used"></a><span data-ttu-id="d6fad-141">Die automatische Proxy Konfiguration wird nicht verwendet.</span><span class="sxs-lookup"><span data-stu-id="d6fad-141">Automatic Proxy Configuration Is Not Used</span></span>

<span data-ttu-id="d6fad-142">Wenn der Aufrufen von [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) anzeigt, dass aktivierter automatischer Proxy nicht verwendet wird, kann die Anwendung die Anforderung einfach mit [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest)erstellen.</span><span class="sxs-lookup"><span data-stu-id="d6fad-142">If the call to [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) indicates that autoproxy is not used, the application can simply create the request with [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span></span> <span data-ttu-id="d6fad-143">Die Proxykonfiguration ist für die gesamte Sitzung identisch, und Anforderungs spezifische Änderungen sind nicht erforderlich.</span><span class="sxs-lookup"><span data-stu-id="d6fad-143">The proxy configuration is the same for the entire session, and per-request changes are not needed.</span></span>

 

 



