---
description: 'In C++ können Sie die Sicherheit für den gesamten Prozess festlegen, indem Sie CoInitializeSecurity aufrufen, bevor Sie eine Verbindung mit WMI über IWbemLocator:: ConnectServer herstellen.'
ms.assetid: 83c04a96-3829-4c07-91a7-06e5b75b2c12
ms.tgt_platform: multiple
title: Festlegen der Sicherheit für IWbemServices und andere Proxys
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d593c52091182b1f0580908624e0b4068ed3f8d3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "106360847"
---
# <a name="setting-the-security-on-iwbemservices-and-other-proxies"></a><span data-ttu-id="96b18-103">Festlegen der Sicherheit für IWbemServices und andere Proxys</span><span class="sxs-lookup"><span data-stu-id="96b18-103">Setting the Security on IWbemServices and Other Proxies</span></span>

<span data-ttu-id="96b18-104">In C++ können Sie die Sicherheit für den gesamten Prozess festlegen, indem Sie [**CoInitializeSecurity**](/windows/win32/api/combaseapi/nf-combaseapi-coinitializesecurity) aufrufen, bevor Sie eine Verbindung mit WMI über [**IWBEMLocator:: ConnectServer**](/windows/desktop/api/Wbemcli/nf-wbemcli-iwbemlocator-connectserver)herstellen.</span><span class="sxs-lookup"><span data-stu-id="96b18-104">While in C++ you can set the security on the entire process by calling [**CoInitializeSecurity**](/windows/win32/api/combaseapi/nf-combaseapi-coinitializesecurity) before connecting to WMI through [**IWbemLocator::ConnectServer**](/windows/desktop/api/Wbemcli/nf-wbemcli-iwbemlocator-connectserver).</span></span> <span data-ttu-id="96b18-105">Sie können auch die Authentifizierungs Ebene, die Identitätswechsel Ebene oder den Authentifizierungsdienst in einem Aufruf ändern, der einen Zeiger auf einen WMI-Proxy (z. b. [**IWbemServices**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemservices) oder [**iwbemcallresult**](/windows/desktop/api/Wbemcli/nn-wbemcli-iwbemcallresult)) erhält.</span><span class="sxs-lookup"><span data-stu-id="96b18-105">You can also change the authentication level, impersonation level, or the authentication service in a call that obtains a pointer to a WMI proxy, such as [**IWbemServices**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemservices) or [**IWbemCallResult**](/windows/desktop/api/Wbemcli/nn-wbemcli-iwbemcallresult).</span></span> <span data-ttu-id="96b18-106">Durch Aufrufen von [**CoSetProxyBlanket**](/windows/win32/api/combaseapi/nf-combaseapi-cosetproxyblanket) können Sie auch den Authentifizierungsdienst (Kerberos, NTLM oder aushandeln) ändern.</span><span class="sxs-lookup"><span data-stu-id="96b18-106">Calling [**CoSetProxyBlanket**](/windows/win32/api/combaseapi/nf-combaseapi-cosetproxyblanket) also allows you to change the authentication service (Kerberos, NTLM, or negotiate).</span></span>

<span data-ttu-id="96b18-107">Skripts und Visual Basic Anwendungen legen die Sicherheit für Proxys nur indirekt durch Aufrufe von [**Swap Services**](swbemservices.md) und anderen Automatisierungs Objekten fest.</span><span class="sxs-lookup"><span data-stu-id="96b18-107">Scripts and Visual Basic applications only set security on proxies indirectly through calls to [**SWbemServices**](swbemservices.md) and other automation objects.</span></span> <span data-ttu-id="96b18-108">Weitere Informationen zum Festlegen und Ändern der Authentifizierung und des Identitäts Wechsels in Skripts finden [Sie unter Festlegen der standardmäßigen Prozess Sicherheitsstufe mithilfe von VBScript](setting-the-default-process-security-level-using-vbscript.md).</span><span class="sxs-lookup"><span data-stu-id="96b18-108">For more information about setting and changing authentication and impersonation in script, see [Setting the Default Process Security Level Using VBScript](setting-the-default-process-security-level-using-vbscript.md).</span></span>

<span data-ttu-id="96b18-109">Beim Herstellen einer Verbindung mit WMI auf einem Remote Computer, auf dem ein anderes Betriebssystem ausgeführt wird, ist das Ändern von Sicherheitsstufen oder Diensten vor allem von Bedeutung.</span><span class="sxs-lookup"><span data-stu-id="96b18-109">Changing security levels or services is primarily a concern when connecting to WMI on a remote computer that is running a different operating system.</span></span> <span data-ttu-id="96b18-110">Weitere Informationen finden Sie unter [Herstellen einer Verbindung zwischen verschiedenen Betriebssystemen](/windows/desktop/WmiSdk/troubleshooting-a-remote-wmi-connection).</span><span class="sxs-lookup"><span data-stu-id="96b18-110">For more information, see [Connecting Between Different Operating Systems](/windows/desktop/WmiSdk/troubleshooting-a-remote-wmi-connection).</span></span>

<span data-ttu-id="96b18-111">Eine Client Anwendung stellt eine Verbindung mit einem WMI-Proxy mithilfe einer Identität her.</span><span class="sxs-lookup"><span data-stu-id="96b18-111">A client application connects to a WMI proxy using an identity.</span></span> <span data-ttu-id="96b18-112">Eine Identität ist ein Datenobjekt, das aus den Einstellungen Benutzername, Kennwort und Autorität besteht.</span><span class="sxs-lookup"><span data-stu-id="96b18-112">An identity is a data object that consists of a user name, password, and authority settings.</span></span> <span data-ttu-id="96b18-113">Bei einer WMI-Client Anwendung wird durch den-Befehl an die [**IWBEMLocator:: ConnectServer**](/windows/desktop/api/Wbemcli/nf-wbemcli-iwbemlocator-connectserver) -Schnittstelle die anfängliche Identität erstellt.</span><span class="sxs-lookup"><span data-stu-id="96b18-113">For a WMI client application, the call to the [**IWbemLocator::ConnectServer**](/windows/desktop/api/Wbemcli/nf-wbemcli-iwbemlocator-connectserver) interface creates the initial identity.</span></span> <span data-ttu-id="96b18-114">Die Methode [**ConnectServer**](swbemlocator-connectserver.md) übernimmt die Identität in einem Satz von drei Parametern, die Sie auf **null** festlegen können, um den aktuellen Benutzer anzugeben.</span><span class="sxs-lookup"><span data-stu-id="96b18-114">The [**ConnectServer**](swbemlocator-connectserver.md) method takes the identity in a set of three parameters, which you can set to **NULL** to indicate the current user.</span></span> <span data-ttu-id="96b18-115">Sie können auch einen nicht-**null** -Parameter angeben, um einen bestimmten Benutzer und eine bestimmte Domäne anzugeben.</span><span class="sxs-lookup"><span data-stu-id="96b18-115">You can also specify a non-**NULL** parameter to indicate a specific user and domain.</span></span> <span data-ttu-id="96b18-116">Wenn der-Vorgang erfolgreich ist, gibt **ConnectServer** einen Zeiger zurück, über den Sie auf eine Vielzahl von Remote Prozessen zugreifen können, z. b. auf einen WMI-Dienst oder das Windows-Betriebssystem.</span><span class="sxs-lookup"><span data-stu-id="96b18-116">If the call is successful, **ConnectServer** returns a pointer through which you can access a variety of remote processes, such as a WMI service or the Windows operating system directly.</span></span>

<span data-ttu-id="96b18-117">Wie viele COM-Schnittstellen gibt [**ConnectServer**](swbemlocator-connectserver.md) einen Zeiger auf einen Proxy zurück.</span><span class="sxs-lookup"><span data-stu-id="96b18-117">Like many COM interfaces, [**ConnectServer**](swbemlocator-connectserver.md) returns a pointer to a proxy.</span></span> <span data-ttu-id="96b18-118">Bei einem Proxy handelt es sich um ein Datenobjekt, das einen Remote Prozess darstellt, z. b. WMI oder einen Remote Anbieter.</span><span class="sxs-lookup"><span data-stu-id="96b18-118">A proxy is a data object that represents a remote process, such as WMI or a remote provider.</span></span> <span data-ttu-id="96b18-119">COM verwendet einen Proxy, um Entwicklern den Zugriff auf Remote Daten zu ermöglichen, als wären die Daten lokal.</span><span class="sxs-lookup"><span data-stu-id="96b18-119">COM uses a proxy to allow developers access to remote data as though the data were local.</span></span>

<span data-ttu-id="96b18-120">Die folgenden WMI-Schnittstellen verwenden Proxys:</span><span class="sxs-lookup"><span data-stu-id="96b18-120">The following WMI interfaces use proxies:</span></span>

-   <span data-ttu-id="96b18-121">[**IWbemServices**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemservices) (Skript Objekt für [**Austausch**](swbemservices.md) Vorgänge)</span><span class="sxs-lookup"><span data-stu-id="96b18-121">[**IWbemServices**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemservices) ([**SWbemServices**](swbemservices.md) scripting object)</span></span>
-   [<span data-ttu-id="96b18-122">**Ienumwbemclassobject**</span><span class="sxs-lookup"><span data-stu-id="96b18-122">**IEnumWbemClassObject**</span></span>](/windows/desktop/api/Wbemcli/nn-wbemcli-ienumwbemclassobject)
-   [<span data-ttu-id="96b18-123">**Iwbemcallresult**</span><span class="sxs-lookup"><span data-stu-id="96b18-123">**IWbemCallResult**</span></span>](/windows/desktop/api/Wbemcli/nn-wbemcli-iwbemcallresult)
-   <span data-ttu-id="96b18-124">[**Iwbemaktualisierer**](/windows/desktop/api/Wbemcli/nn-wbemcli-iwbemrefresher) (Skript Objekt für [**Austausch**](swbemrefresher.md) Vorgänge)</span><span class="sxs-lookup"><span data-stu-id="96b18-124">[**IWbemRefresher**](/windows/desktop/api/Wbemcli/nn-wbemcli-iwbemrefresher) ([**SWbemRefresher**](swbemrefresher.md) scripting object)</span></span>

    <span data-ttu-id="96b18-125">Das WMI-Aktualisierungs Programm ist ein Sonderfall, da es einen [**IWbemServices**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemservices) -Zeiger gibt, dessen Sicherheitseinstellungen ordnungsgemäß festgelegt werden müssen.</span><span class="sxs-lookup"><span data-stu-id="96b18-125">The WMI Refresher is a special case because it is passed an [**IWbemServices**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemservices) pointer, whose security settings must be properly set.</span></span> <span data-ttu-id="96b18-126">Weitere Informationen zum Verwenden von Aktualisierungs Objekten finden Sie unter [zugreifen auf Leistungsdaten in C++](accessing-performance-data-in-c--.md).</span><span class="sxs-lookup"><span data-stu-id="96b18-126">For more information about using refresher objects, see [Accessing Performance Data in C++](accessing-performance-data-in-c--.md).</span></span>

<span data-ttu-id="96b18-127">Nachdem Sie einen Zeiger auf einen Remote Prozess erhalten haben, können Sie eine von zwei Aktionen ausführen.</span><span class="sxs-lookup"><span data-stu-id="96b18-127">After you receive a pointer to a remote process, you can do one of two things.</span></span> <span data-ttu-id="96b18-128">Wenn Sie wissen, wie der Prozess funktioniert, können Sie festlegen, dass die Sicherheit für den Zeiger festgelegt wird, und auf den Prozess normal zugreifen.</span><span class="sxs-lookup"><span data-stu-id="96b18-128">If you know what the process does, you can choose to set the security on the pointer and access the process normally.</span></span> <span data-ttu-id="96b18-129">Dies ist der Fall bei den meisten Zeigern auf einen WMI-Dienst.</span><span class="sxs-lookup"><span data-stu-id="96b18-129">This is the case with most pointers to a WMI service.</span></span> <span data-ttu-id="96b18-130">Weitere Informationen finden Sie unter [Festlegen der Sicherheitsstufen für eine WMI-Verbindung](setting-the-security-levels-on-a-wmi-connection.md).</span><span class="sxs-lookup"><span data-stu-id="96b18-130">For more information, see [Setting the Security Levels on a WMI Connection](setting-the-security-levels-on-a-wmi-connection.md).</span></span> <span data-ttu-id="96b18-131">Alternativ müssen Sie auf eine andere COM-Schnittstelle auf dem Proxy zugreifen, z. b. [**IUnknown:: Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release), indem Sie die [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) -Schnittstelle des Proxys aufrufen.</span><span class="sxs-lookup"><span data-stu-id="96b18-131">Alternately, you need to access a different COM interface on the proxy, such as [**IUnknown::Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release), through a call to the [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) interface on the proxy.</span></span>

## <a name="defaults-and-recommendations"></a><span data-ttu-id="96b18-132">Standardwerte und Empfehlungen</span><span class="sxs-lookup"><span data-stu-id="96b18-132">Defaults and Recommendations</span></span>

<span data-ttu-id="96b18-133">Die verteilte Version des Component Object Model (DCOM) aushandelt den Standard Authentifizierungsdienst (Kerberos, NTLM oder Aushandlung), und Sie können den Standard Authentifizierungsdienst nicht mithilfe von [**CoInitializeSecurity**](/windows/win32/api/combaseapi/nf-combaseapi-coinitializesecurity)angeben.</span><span class="sxs-lookup"><span data-stu-id="96b18-133">The distributed version of the Component Object Model (DCOM) negotiates the default authentication service (Kerberos, NTLM, or Negotiate), and you cannot specify the default authentication service using [**CoInitializeSecurity**](/windows/win32/api/combaseapi/nf-combaseapi-coinitializesecurity).</span></span> <span data-ttu-id="96b18-134">Wenn Sie den **RPC \_ C \_ authn \_ default** im Authentifizierungsdienst Parameter von [**CoSetProxyBlanket**](/windows/win32/api/combaseapi/nf-combaseapi-cosetproxyblanket) angeben, kann DCOM den entsprechenden Dienst auswählen.</span><span class="sxs-lookup"><span data-stu-id="96b18-134">Specifying **RPC\_C\_AUTHN\_DEFAULT** in the authentication service parameter of [**CoSetProxyBlanket**](/windows/win32/api/combaseapi/nf-combaseapi-cosetproxyblanket) allows DCOM to select the appropriate service.</span></span> <span data-ttu-id="96b18-135">Bei Remote Verbindungen wird der Standard Dienst ausgehandelt. Dies ist der empfohlene Dienst für Anwendungen, die in Kerberos-und nicht-Kerberos-Domänen funktionieren.</span><span class="sxs-lookup"><span data-stu-id="96b18-135">For remote connections the default service is Negotiate, which is the recommended service for applications functioning in both Kerberos and non-Kerberos domains.</span></span> <span data-ttu-id="96b18-136">Für lokale Verbindungen ist der Standard Authentifizierungsdienst NT-LAN-Manager (NTLM).</span><span class="sxs-lookup"><span data-stu-id="96b18-136">For local connections, the default authentication service is NT LAN Manager (NTLM).</span></span>

<span data-ttu-id="96b18-137">Das folgende Codebeispiel zeigt den verwendeten Standard Authentifizierungsdienst.</span><span class="sxs-lookup"><span data-stu-id="96b18-137">The following code example shows the default authentication service being used.</span></span>


```C++
// The pWbemServices variable is of type IWbemServices*

HRESULT hr = CoSetProxyBlanket(
     pWbemServices,                //Proxy
     RPC_C_AUTHN_DEFAULT,          //Authentication service 
     RPC_C_AUTHZ_DEFAULT,          //Authorization service 
     COLE_DEFAULT_PRINCIPAL,       //Server principal name used 
                                       // by authentication service
     RPC_C_AUTHN_LEVEL_DEFAULT,    //Authentication level
     RPC_C_IMP_LEVEL_IMPERSONATE,  //Impersonation level
     COLE_DEFAULT_AUTHINFO,       //Client identity
     EOAC_DEFAULT                  //Capability flags
     );
```



<span data-ttu-id="96b18-138">Für das Codebeispiel in diesem Thema sind die folgenden Referenz-und \# include-Anweisungen erforderlich.</span><span class="sxs-lookup"><span data-stu-id="96b18-138">The code example in this topic requires the following reference and \#include statements.</span></span>


```C++
#define _WIN32_DCOM
#include <wbemidl.h>
#include <comdef.h>

#pragma comment(lib, "wbemuuid.lib")
```



<span data-ttu-id="96b18-139">Bei der Skripterstellung wird empfohlen, die Standardwerte zu verwenden, die von DCOM für Remote Aufrufe ausgewählt werden.</span><span class="sxs-lookup"><span data-stu-id="96b18-139">For scripting, it is recommended that you use the defaults that DCOM selects for remote calls.</span></span> <span data-ttu-id="96b18-140">Auf dem lokalen Computer können Sie keinen Authentifizierungsdienst für Aufrufe von WMI angeben.</span><span class="sxs-lookup"><span data-stu-id="96b18-140">On the local machine you cannot specify an authentication service for calls to WMI.</span></span> <span data-ttu-id="96b18-141">Weitere Informationen finden Sie unter [Festlegen des Authentifizierungs Dienstanbieter mithilfe von VBScript](setting-the-authentication-service-using-vbscript.md) und [Erstellen einer Monikerzeichenfolge](constructing-a-moniker-string.md).</span><span class="sxs-lookup"><span data-stu-id="96b18-141">For more information, see [Setting the Authentication Service Using VBScript](setting-the-authentication-service-using-vbscript.md) and [Constructing a Moniker String](constructing-a-moniker-string.md).</span></span>

 

 
