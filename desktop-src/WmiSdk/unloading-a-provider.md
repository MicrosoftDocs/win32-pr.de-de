---
description: Nachdem der WMI-Dienst mit einem Anbieter fertig ist, entlädt er den Anbieter aus dem Arbeitsspeicher.
ms.assetid: 6116769f-3402-42b3-835d-9bdb0fc27ce0
ms.tgt_platform: multiple
title: Entladen eines Anbieters
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 123d8c4f6b9d9155cdc22dc435635466956bdb0a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "104528466"
---
# <a name="unloading-a-provider"></a><span data-ttu-id="4da7f-103">Entladen eines Anbieters</span><span class="sxs-lookup"><span data-stu-id="4da7f-103">Unloading a Provider</span></span>

<span data-ttu-id="4da7f-104">Nachdem der WMI-Dienst mit einem Anbieter fertig ist, entlädt er den Anbieter aus dem Arbeitsspeicher.</span><span class="sxs-lookup"><span data-stu-id="4da7f-104">After WMI is finished with a provider, it unloads the provider from memory.</span></span> <span data-ttu-id="4da7f-105">Der Hauptgrund, warum WMI einen Anbieter entlädt, besteht darin, Systemressourcen zu sparen.</span><span class="sxs-lookup"><span data-stu-id="4da7f-105">The primary reason WMI unloads a provider is to conserve system resources.</span></span> <span data-ttu-id="4da7f-106">Aus diesem Grund müssen Sie Code hinzufügen, der es WMI ermöglicht, den Anbieter auf effiziente Weise zu entladen.</span><span class="sxs-lookup"><span data-stu-id="4da7f-106">Therefore, you must add code that allows WMI to unload your provider in an efficient manner.</span></span> <span data-ttu-id="4da7f-107">Das Intervall, das im Cache Steuerelement angegeben ist, wird für das zweimalige Intervall von WMI zum Entladen eines Anbieters benötigt.</span><span class="sxs-lookup"><span data-stu-id="4da7f-107">It takes anywhere from the interval specified in the cache control to twice that interval for WMI to unload a provider.</span></span>

<span data-ttu-id="4da7f-108">WMI entlädt einen Anbieter auf eine der folgenden Arten:</span><span class="sxs-lookup"><span data-stu-id="4da7f-108">WMI unloads a provider in one of the following ways:</span></span>

-   <span data-ttu-id="4da7f-109">Entladen Sie einen Anbieter, nachdem der Anbieter die ihm gegebenen Aufgaben abgeschlossen hat.</span><span class="sxs-lookup"><span data-stu-id="4da7f-109">Unload a provider after the provider finishes the tasks given to it.</span></span>
-   <span data-ttu-id="4da7f-110">Alle Anbieter schnell entladen, wenn der Benutzer das System herunterfährt.</span><span class="sxs-lookup"><span data-stu-id="4da7f-110">Quickly unload all providers when the user shuts down the system.</span></span> <span data-ttu-id="4da7f-111">Beachten Sie, dass WMI in-Process-Anbieter entladen wird, wenn der WMI-Dienst von der Befehlszeile aus heruntergefahren wird.</span><span class="sxs-lookup"><span data-stu-id="4da7f-111">Note that WMI unloads in-process providers when the WMI service is shut down from the command line.</span></span>

<span data-ttu-id="4da7f-112">Während das erste Szenario häufiger ist, müssen Sie Ihren Anbieter für beide Möglichkeiten schreiben.</span><span class="sxs-lookup"><span data-stu-id="4da7f-112">While the first scenario is more common, you must write your provider for both possibilities.</span></span>

<span data-ttu-id="4da7f-113">In diesem Thema werden die folgenden Abschnitte erläutert:</span><span class="sxs-lookup"><span data-stu-id="4da7f-113">The following sections are discussed in this topic:</span></span>

-   [<span data-ttu-id="4da7f-114">Entladen eines Leerlauf Anbieters</span><span class="sxs-lookup"><span data-stu-id="4da7f-114">Unloading an Idle Provider</span></span>](#unloading-an-idle-provider)
-   [<span data-ttu-id="4da7f-115">Zugreifen auf die Leerlaufzeit eines Anbieters</span><span class="sxs-lookup"><span data-stu-id="4da7f-115">Accessing the Idle Time for a Provider</span></span>](#accessing-the-idle-time-for-a-provider)
-   [<span data-ttu-id="4da7f-116">Entladen eines Anbieters, der auch ein WMI-Client ist</span><span class="sxs-lookup"><span data-stu-id="4da7f-116">Unloading a Provider That Is Also a WMI Client</span></span>](#unloading-a-provider-that-is-also-a-wmi-client)
-   [<span data-ttu-id="4da7f-117">Entladen eines Anbieters beim Herunterfahren</span><span class="sxs-lookup"><span data-stu-id="4da7f-117">Unloading a Provider During Shutdown</span></span>](#unloading-a-provider-during-shutdown)
-   [<span data-ttu-id="4da7f-118">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="4da7f-118">Related topics</span></span>](#related-topics)

## <a name="unloading-an-idle-provider"></a><span data-ttu-id="4da7f-119">Entladen eines Leerlauf Anbieters</span><span class="sxs-lookup"><span data-stu-id="4da7f-119">Unloading an Idle Provider</span></span>

<span data-ttu-id="4da7f-120">WMI führt beim Entladen eines inaktiven Anbieters die folgenden Aktionen aus:</span><span class="sxs-lookup"><span data-stu-id="4da7f-120">WMI performs the following actions when it unloads an idle provider:</span></span>

-   <span data-ttu-id="4da7f-121">Bestimmt, ob sich der Anbieter im Leerlauf befindet.</span><span class="sxs-lookup"><span data-stu-id="4da7f-121">Determines if the provider is idle.</span></span>

    <span data-ttu-id="4da7f-122">WMI verwendet die **clearafter** -Eigenschaft, um zu bestimmen, wie lange ein Anbieter im Leerlauf bleiben kann, bevor der Anbieter entladen wird.</span><span class="sxs-lookup"><span data-stu-id="4da7f-122">WMI uses the **ClearAfter** property to determine how long a provider may stay idle before unloading that provider.</span></span> <span data-ttu-id="4da7f-123">Weitere Informationen finden Sie unter [zugreifen auf die Leerlaufzeit eines Anbieters](#accessing-the-idle-time-for-a-provider).</span><span class="sxs-lookup"><span data-stu-id="4da7f-123">For more information, see [Accessing the Idle Time for a Provider](#accessing-the-idle-time-for-a-provider).</span></span>

-   <span data-ttu-id="4da7f-124">Ruft die [**releasemethode**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release) des Anbieters auf.</span><span class="sxs-lookup"><span data-stu-id="4da7f-124">Calls the [**Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release) method of the provider.</span></span>

    <span data-ttu-id="4da7f-125">Wenn es sich bei dem Anbieter um einen reinen Anbieter handelt, wird der Anbieter durch [**Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release) vollständig aus dem aktiven Speicher entfernt.</span><span class="sxs-lookup"><span data-stu-id="4da7f-125">If the provider was a pure provider, then [**Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release) completely removes the provider from active memory.</span></span> <span data-ttu-id="4da7f-126">Ein nicht reiner Anbieter kann jedoch nach der **Veröffentlichung** von WMI weiterhin ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="4da7f-126">However, a nonpure provider may continue to run after WMI calls **Release**.</span></span>

## <a name="accessing-the-idle-time-for-a-provider"></a><span data-ttu-id="4da7f-127">Zugreifen auf die Leerlaufzeit eines Anbieters</span><span class="sxs-lookup"><span data-stu-id="4da7f-127">Accessing the Idle Time for a Provider</span></span>

<span data-ttu-id="4da7f-128">Die minimale Zeitspanne, für die ein Anbieter aktiv bleibt, hängt von der **clearafter** -Eigenschaft ab.</span><span class="sxs-lookup"><span data-stu-id="4da7f-128">The minimum amount of time a provider remains active is determined by the **ClearAfter** property.</span></span> <span data-ttu-id="4da7f-129">**Clearafter** finden Sie in Instanzen von Klassen, die von der WMI-System Klasse [**\_ \_ CacheControl**](--cachecontrol.md) im \\ Root-Namespace abgeleitet sind.</span><span class="sxs-lookup"><span data-stu-id="4da7f-129">You can find **ClearAfter** in instances of classes derived from the WMI system class [**\_\_CacheControl**](--cachecontrol.md) in the \\root namespace.</span></span>

<span data-ttu-id="4da7f-130">In der folgenden Liste werden die Klassen beschrieben, die von [**\_ \_ CacheControl**](--cachecontrol.md)abgeleitet werden und das Entladen des Anbieters steuert:</span><span class="sxs-lookup"><span data-stu-id="4da7f-130">The following list describes the classes that are derived from [**\_\_CacheControl**](--cachecontrol.md), which controls provider unloading:</span></span>

-   [<span data-ttu-id="4da7f-131">**\_\_Eventconsumerprovidercachecontrol**</span><span class="sxs-lookup"><span data-stu-id="4da7f-131">**\_\_EventConsumerProviderCacheControl**</span></span>](--eventconsumerprovidercachecontrol.md)
-   [<span data-ttu-id="4da7f-132">**\_\_Eventprovidercachecontrol**</span><span class="sxs-lookup"><span data-stu-id="4da7f-132">**\_\_EventProviderCacheControl**</span></span>](--eventprovidercachecontrol.md)
-   [<span data-ttu-id="4da7f-133">**\_\_EventSink Cache econtrol**</span><span class="sxs-lookup"><span data-stu-id="4da7f-133">**\_\_EventSinkCacheControl**</span></span>](--eventsinkcachecontrol.md)
-   [<span data-ttu-id="4da7f-134">**\_\_Objectprovidercachecontrol**</span><span class="sxs-lookup"><span data-stu-id="4da7f-134">**\_\_ObjectProviderCacheControl**</span></span>](--objectprovidercachecontrol.md)
-   [<span data-ttu-id="4da7f-135">**\_\_Propertyprovidercachecontrol**</span><span class="sxs-lookup"><span data-stu-id="4da7f-135">**\_\_PropertyProviderCacheControl**</span></span>](--propertyprovidercachecontrol.md)

<span data-ttu-id="4da7f-136">Sie können die minimale Zeitspanne ändern, in der ein Anbieter von WMI inaktiv bleiben kann, indem Sie die **clearafter** -Eigenschaft in der Cache Steuerungs Instanz für einen bestimmten Anbietertyp bearbeiten.</span><span class="sxs-lookup"><span data-stu-id="4da7f-136">You can change the minimum amount of time that WMI allows a provider to remain inactive by editing the **ClearAfter** property in the cache control instance for a specific type of provider.</span></span> <span data-ttu-id="4da7f-137">Um z. b. die Zeitspanne zu begrenzen, in der sich ein Eigenschaften Anbieter im Leerlauf befinden kann, bearbeiten Sie die **clearafter** -Eigenschaft einer [**\_ \_ propertyprovidercachecontrol**](--propertyprovidercachecontrol.md) -Instanz im \\ Root-Namespace.</span><span class="sxs-lookup"><span data-stu-id="4da7f-137">For example, to limit the amount of time a property provider can remain idle, you would edit the **ClearAfter** property of a [**\_\_PropertyProviderCacheControl**](--propertyprovidercachecontrol.md) instance in the \\root namespace.</span></span>

## <a name="unloading-a-provider-that-is-also-a-wmi-client"></a><span data-ttu-id="4da7f-138">Entladen eines Anbieters, der auch ein WMI-Client ist</span><span class="sxs-lookup"><span data-stu-id="4da7f-138">Unloading a Provider That Is Also a WMI Client</span></span>

<span data-ttu-id="4da7f-139">Der Anbieter muss möglicherweise einen WMI-Client erhalten, nachdem er die von ihm aufgerufenen Anbieter Funktionen abgeschlossen hat.</span><span class="sxs-lookup"><span data-stu-id="4da7f-139">Your provider may need to remain a client of WMI after it has completed the provider functions it was called to perform.</span></span> <span data-ttu-id="4da7f-140">Beispielsweise muss ein pushanbieter möglicherweise Abfragen an WMI ausgeben.</span><span class="sxs-lookup"><span data-stu-id="4da7f-140">For example, a push provider may need to issue queries to WMI.</span></span> <span data-ttu-id="4da7f-141">Weitere Informationen finden Sie unter [bestimmen des Push-oder Pull-Status](determining-push-or-pull-status.md).</span><span class="sxs-lookup"><span data-stu-id="4da7f-141">For more information, see [Determining Push or Pull Status](determining-push-or-pull-status.md).</span></span> <span data-ttu-id="4da7f-142">In diesem Fall sollte die **Pure** -Eigenschaft der [**\_ \_ Win32Provider**](--win32provider.md) -Instanz, die den Anbieter darstellt, auf **true** festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="4da7f-142">In this case, the **Pure** property of the [**\_\_Win32Provider**](--win32provider.md) instance that represents the provider should be set to **TRUE**.</span></span> <span data-ttu-id="4da7f-143">Wenn die **Pure** -Eigenschaft auf **false** festgelegt ist, bereitet der Anbieter die Entladung vor, indem er [**IUnknown:: Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release) für alle ausstehenden Schnittstellen Punkte aufruft, wenn WMI die releasemethode der primären Schnittstelle aufruft.</span><span class="sxs-lookup"><span data-stu-id="4da7f-143">If the **Pure** property is set to **FALSE**, the provider prepares to unload by calling [**IUnknown::Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release) on all outstanding interface points when WMI calls the Release method of its primary interface.</span></span> <span data-ttu-id="4da7f-144">Weitere Informationen finden Sie im Abschnitt "Hinweise" unter [**\_ \_ Win32Provider**](--win32provider.md).</span><span class="sxs-lookup"><span data-stu-id="4da7f-144">For more information, see the Remarks section in [**\_\_Win32Provider**](--win32provider.md).</span></span>

<span data-ttu-id="4da7f-145">Im folgenden Verfahren wird beschrieben, wie eine releasemethode für die primäre Schnittstelle des Anbieters implementiert wird.</span><span class="sxs-lookup"><span data-stu-id="4da7f-145">The following procedure describes how to implement a release method for the primary interface of your provider.</span></span>

<span data-ttu-id="4da7f-146">**So entladen Sie einen Anbieter**</span><span class="sxs-lookup"><span data-stu-id="4da7f-146">**To unload a provider**</span></span>

1.  <span data-ttu-id="4da7f-147">Gibt alle für WMI gespeicherten Schnittstellen Zeiger frei, wenn WMI die [**releasemethode**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release) der primären Schnittstelle des Anbieters aufruft.</span><span class="sxs-lookup"><span data-stu-id="4da7f-147">Release all interface pointers held against WMI when WMI calls the [**Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release) method of the primary interface of your provider.</span></span>

    <span data-ttu-id="4da7f-148">In der Regel enthält ein Anbieter Zeiger auf die Schnittstellen " [**IWbemServices**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemservices) " und " [**IWbemContext**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemcontext) ", die in [**iwbemproviderinit:: Initialize**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemproviderinit-initialize)bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="4da7f-148">Typically, a provider holds pointers to the [**IWbemServices**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemservices) and [**IWbemContext**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemcontext) interfaces supplied in [**IWbemProviderInit::Initialize**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemproviderinit-initialize).</span></span>

2.  <span data-ttu-id="4da7f-149">Wenn die **Pure** -Eigenschaft in der zugeordneten [**\_ \_ Win32Provider**](--win32provider.md) -Instanz auf **false** festgelegt ist, kann der Anbieter nach der [**Freigabe**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release)von WMI auf die Rolle der Client Anwendung umstellen.</span><span class="sxs-lookup"><span data-stu-id="4da7f-149">If the **Pure** property in the associated [**\_\_Win32Provider**](--win32provider.md) instance is set to **FALSE**, the provider can transition to the role of client application after WMI calls [**Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span></span> <span data-ttu-id="4da7f-150">WMI kann jedoch keinen Anbieter entladen, der als Client System betrieben wird, was den System Aufwand erhöht.</span><span class="sxs-lookup"><span data-stu-id="4da7f-150">However, WMI cannot unload a provider that is operating as a client system, which increases the system overhead.</span></span>

    <span data-ttu-id="4da7f-151">Ein Anbieter, bei dem **Pure** auf **true** festgelegt ist, ist nur für Service Requests vorhanden.</span><span class="sxs-lookup"><span data-stu-id="4da7f-151">A provider with **Pure** set to **TRUE** exists only to service requests.</span></span> <span data-ttu-id="4da7f-152">Daher kann diese Art von Anbieter die Rolle einer Client Anwendung nicht annehmen, und Sie kann von WMI entladen werden.</span><span class="sxs-lookup"><span data-stu-id="4da7f-152">Therefore, this type of provider cannot take on the role of a client application and WMI can unload it.</span></span>

## <a name="unloading-a-provider-during-shutdown"></a><span data-ttu-id="4da7f-153">Entladen eines Anbieters beim Herunterfahren</span><span class="sxs-lookup"><span data-stu-id="4da7f-153">Unloading a Provider During Shutdown</span></span>

<span data-ttu-id="4da7f-154">Unter normalen Umständen ermöglicht die Verwendung der Richtlinien zum [Entladen eines Anbieters, der auch ein WMI-Client ist](#unloading-a-provider-that-is-also-a-wmi-client) , das ordnungsgemäße Entladen des Anbieters durch WMI.</span><span class="sxs-lookup"><span data-stu-id="4da7f-154">Under normal circumstances, using the guidelines in [Unloading a Provider That is Also a WMI Client](#unloading-a-provider-that-is-also-a-wmi-client) allows WMI to unload your provider properly.</span></span> <span data-ttu-id="4da7f-155">Es kann jedoch vorkommen, dass WMI die normalen Entlade Prozeduren nicht initiieren kann, z. b. wenn der Benutzer das System heruntergefahren hat.</span><span class="sxs-lookup"><span data-stu-id="4da7f-155">However, you may run into situations where WMI is unable to instigate the normal unloading procedures, such as when the user chooses to shut the system down.</span></span> <span data-ttu-id="4da7f-156">Wenn Sie ein Transaktionsmodell der Datenspeicherung verwenden, können Sie zusätzlich zur Implementierung einer guten Bereinigungs Strategie sicherstellen, dass der Anbieter ordnungsgemäß entladen wurde.</span><span class="sxs-lookup"><span data-stu-id="4da7f-156">By using a transaction model of data storage, in addition to implementing a good cleanup strategy, you can ensure that your provider is properly unloaded.</span></span>

<span data-ttu-id="4da7f-157">Der Benutzer kann WMI jederzeit abbrechen.</span><span class="sxs-lookup"><span data-stu-id="4da7f-157">The user may stop WMI at any time.</span></span> <span data-ttu-id="4da7f-158">In einer solchen Situation werden von WMI keine Anbieter entladen oder der [**DllCanUnloadNow**](/windows/win32/api/combaseapi/nf-combaseapi-dllcanunloadnow) -Einstiegspunkt auf einem in-Process-Anbieter aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="4da7f-158">In such a situation, WMI does not unload any providers or call the [**DllCanUnloadNow**](/windows/win32/api/combaseapi/nf-combaseapi-dllcanunloadnow) entry point on any in-process provider.</span></span> <span data-ttu-id="4da7f-159">Wenn ein Prozess interner Anbieter zum Zeitpunkt des herunter Fahrens in der Mitte eines Methoden Aufrufes ist, kann WMI den ausgeführten Thread in der Mitte des Aufrufes möglicherweise beenden.</span><span class="sxs-lookup"><span data-stu-id="4da7f-159">Moreover, if an in-process provider is in the middle of a method call at the time of the shutdown, WMI can possibly terminate the executing thread in the middle of the call.</span></span> <span data-ttu-id="4da7f-160">In diesem Fall ruft WMI keine Routinen auf, die normalerweise Cleanup verarbeiten, z. b. einen objektdekonstruktor.</span><span class="sxs-lookup"><span data-stu-id="4da7f-160">In this circumstance, WMI does not call routines that normally handle cleanup, such as an object destructor.</span></span> <span data-ttu-id="4da7f-161">WMI ruft höchstens [**DllMain**](/windows/desktop/Dlls/dllmain) auf.</span><span class="sxs-lookup"><span data-stu-id="4da7f-161">At most, WMI will call [**DllMain**](/windows/desktop/Dlls/dllmain) only.</span></span>

<span data-ttu-id="4da7f-162">Wenn das Betriebssystem WMI herunterfährt, gibt das System automatisch den gesamten Arbeitsspeicher frei, der einem in-Process-Anbieter zugeordnet ist.</span><span class="sxs-lookup"><span data-stu-id="4da7f-162">When the operating system shuts down WMI, the system automatically releases all memory allocated to an in-process provider.</span></span> <span data-ttu-id="4da7f-163">Das Betriebssystem schließt außerdem die meisten Ressourcen des Anbieters, z. b. Datei Handles, Fenster Handles usw.</span><span class="sxs-lookup"><span data-stu-id="4da7f-163">The operating system also closes most resources held by the provider, such as file handles, window handles, and so on.</span></span> <span data-ttu-id="4da7f-164">Der Anbieter muss eine bestimmte Aktion nicht durchführen, um dies zu erreichen.</span><span class="sxs-lookup"><span data-stu-id="4da7f-164">The provider does not need to take any specific action to make this happen.</span></span>

<span data-ttu-id="4da7f-165">Da WMI in der Mitte eines Aufrufes heruntergefahren werden kann, sollte ein Anbieter die Datenquellen nicht in einem inkonsistenten Status belassen.</span><span class="sxs-lookup"><span data-stu-id="4da7f-165">Because WMI may shut down in the middle of a call, a provider should not leave data sources in an inconsistent state.</span></span> <span data-ttu-id="4da7f-166">Wenn Sie Ihre Daten in einem inkonsistenten Zustand belassen, ist dies für schreibgeschützte Anbieter kein Problem.</span><span class="sxs-lookup"><span data-stu-id="4da7f-166">Leaving your data in an inconsistent state is not a problem for read-only providers.</span></span> <span data-ttu-id="4da7f-167">Anbieter mit Schreibfunktionen möchten jedoch möglicherweise eine beliebige Art von Transaktionsmodell implementieren, um nach einer abrupten Beendigung ein sicheres Rollback zu ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="4da7f-167">However, providers with write capabilities may want to implement some sort of transaction model to allow a safe rollback after an abrupt termination.</span></span>

<span data-ttu-id="4da7f-168">Das Betriebssystem kann zwar einige allgemeine Systemressourcen freigeben, das System gibt jedoch nicht automatisch alle Ressourcen frei.</span><span class="sxs-lookup"><span data-stu-id="4da7f-168">While the operating system may release some general system resources, the system does not automatically release all resources.</span></span> <span data-ttu-id="4da7f-169">Beispielsweise kann das Betriebssystem keine Socket-oder Datenbankverbindung freigeben.</span><span class="sxs-lookup"><span data-stu-id="4da7f-169">For example, the operating system may not release a socket or a database connection.</span></span> <span data-ttu-id="4da7f-170">Der Anbieter muss diese Ressourcen stattdessen manuell bereinigen.</span><span class="sxs-lookup"><span data-stu-id="4da7f-170">Instead, the provider may need to manually clean up such resources.</span></span> <span data-ttu-id="4da7f-171">Um diese Probleme zu vermeiden, können Sie den Anbieter entweder außerhalb des Prozesses implementieren, oder Sie können Bereinigungs Code hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="4da7f-171">To avoid these problems, you can either implement your provider out-of-process, or you can add cleanup code.</span></span>

<span data-ttu-id="4da7f-172">Die einfachste Lösung ist die Implementierung des Anbieters außerhalb des Prozesses.</span><span class="sxs-lookup"><span data-stu-id="4da7f-172">The simplest solution is to implement your provider out-of-process.</span></span> <span data-ttu-id="4da7f-173">Ein Out-of-Process-Anbieter wird nicht beendet, wenn WMI heruntergefahren wird, obwohl WMI den Anbieter nach einem com-Timeout freigibt.</span><span class="sxs-lookup"><span data-stu-id="4da7f-173">An out-of-process provider is not killed when WMI shuts down, although WMI will release the provider after a COM timeout.</span></span> <span data-ttu-id="4da7f-174">Anbieter, für die Probleme mit der Bereinigungs-und Beendigungs Stabilität wichtiger sind als die Leistung ist möglicherweise außerhalb des Prozesses.</span><span class="sxs-lookup"><span data-stu-id="4da7f-174">Providers for whom cleanup and termination robustness issues are more important than performance may be out-of-process.</span></span>

<span data-ttu-id="4da7f-175">Wenn Sie Bereinigungs Code in Ihrem Anbieter platzieren müssen, stehen Ihnen zwei Optionen zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="4da7f-175">If you must place cleanup code in your provider, you have two options.</span></span> <span data-ttu-id="4da7f-176">Ein Ort zum Ausführen dieser Bereinigungs Art ist " [**DllMain**](/windows/desktop/Dlls/dllmain)", die DLL-Einstiegspunkt Funktion, die das Betriebssystem beim Entladen der DLL aufruft.</span><span class="sxs-lookup"><span data-stu-id="4da7f-176">One place to perform this sort of cleanup is [**DllMain**](/windows/desktop/Dlls/dllmain), the DLL entry point function the operating system calls when unloading the DLL.</span></span> <span data-ttu-id="4da7f-177">Der Bereinigungs Code kann direkt in " **DllMain**" eingefügt werden und als Reaktion auf das **Trennen des DLL- \_ Prozesses \_** ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="4da7f-177">Cleanup code can be added directly into **DllMain**, executing it in response to **DLL\_PROCESS\_DETACH**.</span></span> <span data-ttu-id="4da7f-178">Das Implementieren von Bereinigungs Code in **DllMain** kann etwas schwierig zu gestalten sein, insbesondere in Programmierumgebungen wie MFC oder ATL.</span><span class="sxs-lookup"><span data-stu-id="4da7f-178">Implementing cleanup code in **DllMain** can be somewhat difficult to arrange, especially in programming environments such as MFC or ATL.</span></span> <span data-ttu-id="4da7f-179">Weitere Informationen finden Sie im Microsoft Knowledge Base-Artikel Q148791, "*How to Add your own DllMain in a MFC Regular dll".*</span><span class="sxs-lookup"><span data-stu-id="4da7f-179">For more information, see the Microsoft Knowledge Base article Q148791, "*How to Provide Your Own DllMain in an MFC Regular DLL.*"</span></span> <span data-ttu-id="4da7f-180">(Diese Ressource ist möglicherweise in einigen Sprachen und Ländern oder Regionen nicht verfügbar.)</span><span class="sxs-lookup"><span data-stu-id="4da7f-180">(This resource may not be available in some languages and countries or regions.)</span></span>

<span data-ttu-id="4da7f-181">Alternativ dazu können Sie auch den Bereinigungs Code im Dekonstruktor einer globalen Klasse platzieren.</span><span class="sxs-lookup"><span data-stu-id="4da7f-181">Alternately, you could also place the cleanup code in the destructor of a global class.</span></span> <span data-ttu-id="4da7f-182">Weitere Informationen finden Sie unter Entladen eines Anbieters.</span><span class="sxs-lookup"><span data-stu-id="4da7f-182">For more information, see Unloading a Provider.</span></span> <span data-ttu-id="4da7f-183">Das Windows-Betriebssystem weist dem Heap keine globalen Objekte zu.</span><span class="sxs-lookup"><span data-stu-id="4da7f-183">The Windows operating system does not allocate global objects on the heap.</span></span> <span data-ttu-id="4da7f-184">Stattdessen ruft das Betriebssystem beim Entladen der dll die Dekonstruktoren auf.</span><span class="sxs-lookup"><span data-stu-id="4da7f-184">Instead, the operating system calls the destructors during DLL unload.</span></span>

<span data-ttu-id="4da7f-185">Im folgenden wird eine einfache Bereinigungs Prozedur beschrieben, die in ein globales WMI-Objekt passen könnte.</span><span class="sxs-lookup"><span data-stu-id="4da7f-185">The following is a simple cleanup procedure that could fit inside a global object for WMI.</span></span>


```C++
class CMyCleanup
{
    ~CMyCleanup()
    {
        CloseHandle(m_hOpenFile);
        CloseDatabaseConnection(g_hDatabase);
    }
} g_Cleanup;
```



<span data-ttu-id="4da7f-186">Es gibt zahlreiche Einschränkungen hinsichtlich der Vorgänge, die im Bereinigungs Code mit beiden Ansätzen durchgeführt werden können.</span><span class="sxs-lookup"><span data-stu-id="4da7f-186">There are many restrictions as to what can be done in the cleanup code with either approach.</span></span> <span data-ttu-id="4da7f-187">Beispielsweise kann auf beliebige Threads und DLLs, die nicht implizit verknüpft sind, auf beliebige Weise zugegriffen werden.</span><span class="sxs-lookup"><span data-stu-id="4da7f-187">For example, neither threads nor any DLLs that are not implicitly linked may be accessed in any way.</span></span> <span data-ttu-id="4da7f-188">Außerdem können Sie unter keinen Umständen COM-Aufrufe durchführen.</span><span class="sxs-lookup"><span data-stu-id="4da7f-188">Further, you cannot make COM calls under any circumstances.</span></span>

## <a name="related-topics"></a><span data-ttu-id="4da7f-189">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="4da7f-189">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="4da7f-190">Festlegen von namepace-Sicherheits Deskriptoren</span><span class="sxs-lookup"><span data-stu-id="4da7f-190">Setting Namepace Security Descriptors</span></span>](setting-namespace-security-descriptors.md)
</dt> <dt>

[<span data-ttu-id="4da7f-191">Sichern Ihres Anbieters</span><span class="sxs-lookup"><span data-stu-id="4da7f-191">Securing Your Provider</span></span>](securing-your-provider.md)
</dt> <dt>

[<span data-ttu-id="4da7f-192">Entwickeln eines WMI-Anbieters</span><span class="sxs-lookup"><span data-stu-id="4da7f-192">Developing a WMI Provider</span></span>](developing-a-wmi-provider.md)
</dt> </dl>

 

 
