---
description: Temporäre und permanente Consumer verfügen über verschiedene Methoden zum Sichern der Ereignis Übermittlung.
ms.assetid: cd02e5db-f9e2-438b-9632-0a1387a6d4e3
ms.tgt_platform: multiple
title: Sicheres empfangen von Ereignissen
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f27d156213553ee17a346d780cbea0ff82beca83
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "106362337"
---
# <a name="receiving-events-securely"></a><span data-ttu-id="f73ee-103">Sicheres empfangen von Ereignissen</span><span class="sxs-lookup"><span data-stu-id="f73ee-103">Receiving Events Securely</span></span>

<span data-ttu-id="f73ee-104">Temporäre und permanente Consumer verfügen über verschiedene Methoden zum Sichern der Ereignis Übermittlung.</span><span class="sxs-lookup"><span data-stu-id="f73ee-104">Temporary and permanent consumers have different methods of securing event delivery.</span></span>

<span data-ttu-id="f73ee-105">In diesem Thema werden die folgenden Abschnitte erläutert:</span><span class="sxs-lookup"><span data-stu-id="f73ee-105">The following sections are discussed in this topic:</span></span>

-   [<span data-ttu-id="f73ee-106">Sichern von temporären Consumern</span><span class="sxs-lookup"><span data-stu-id="f73ee-106">Securing Temporary Consumers</span></span>](#securing-temporary-consumers)
-   [<span data-ttu-id="f73ee-107">Sichern dauerhafter Consumer</span><span class="sxs-lookup"><span data-stu-id="f73ee-107">Securing Permanent Consumers</span></span>](#securing-permanent-consumers)
-   [<span data-ttu-id="f73ee-108">Sichern des permanenten Abonnements</span><span class="sxs-lookup"><span data-stu-id="f73ee-108">Securing the Permanent Subscription</span></span>](#securing-the-permanent-subscription)
-   [<span data-ttu-id="f73ee-109">Festlegen einer Administrator-Only SD</span><span class="sxs-lookup"><span data-stu-id="f73ee-109">Setting an Administrator-Only SD</span></span>](#setting-an-administrator-only-sd)
-   [<span data-ttu-id="f73ee-110">Identität der Identität des Ereignis Anbieters annehmen</span><span class="sxs-lookup"><span data-stu-id="f73ee-110">Impersonating the Event Provider Identity</span></span>](#impersonating-the-event-provider-identity)
-   [<span data-ttu-id="f73ee-111">SIDs und permanente Abonnements</span><span class="sxs-lookup"><span data-stu-id="f73ee-111">SIDs and Permanent Subscriptions</span></span>](#sids-and-permanent-subscriptions)
-   [<span data-ttu-id="f73ee-112">Erstellen dauerhafter Abonnements mithilfe von Domänen Konten</span><span class="sxs-lookup"><span data-stu-id="f73ee-112">Creating Permanent Subscriptions Using Domain Accounts</span></span>](#creating-permanent-subscriptions-using-domain-accounts)
-   [<span data-ttu-id="f73ee-113">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="f73ee-113">Related topics</span></span>](#related-topics)

## <a name="securing-temporary-consumers"></a><span data-ttu-id="f73ee-114">Sichern von temporären Consumern</span><span class="sxs-lookup"><span data-stu-id="f73ee-114">Securing Temporary Consumers</span></span>

<span data-ttu-id="f73ee-115">[*Temporäre*](gloss-t.md) Consumer werden so lange ausgeführt, bis das System neu gestartet oder WMI beendet wird, aber nicht gestartet werden kann, wenn ein bestimmtes Ereignis ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="f73ee-115">A [*temporary consumers*](gloss-t.md) runs until the system is rebooted or WMI is stopped but cannot be started if a specific event is raised.</span></span> <span data-ttu-id="f73ee-116">Beispielsweise erstellt ein Aufruf von [**SWbemServices.Execnotificationqueryasync**](swbemservices-execnotificationqueryasync.md) einen temporären Consumer.</span><span class="sxs-lookup"><span data-stu-id="f73ee-116">For example, a call to [**SWbemServices.ExecNotificationQueryAsync**](swbemservices-execnotificationqueryasync.md) creates a temporary consumer.</span></span>

<span data-ttu-id="f73ee-117">Mit den Aufrufen [**SWbemServices.Execnotificationquery**](swbemservices-execnotificationquery.md) oder [**IWbemServices:: ExecNotificationQuery**](/windows/desktop/api/WbemCli/nf-wbemcli-iwbemservices-execnotificationquery) werden temporäre Ereignisconsumer erstellt.</span><span class="sxs-lookup"><span data-stu-id="f73ee-117">The calls [**SWbemServices.ExecNotificationQuery**](swbemservices-execnotificationquery.md) or [**IWbemServices::ExecNotificationQuery**](/windows/desktop/api/WbemCli/nf-wbemcli-iwbemservices-execnotificationquery) create temporary event consumers.</span></span> <span data-ttu-id="f73ee-118">Temporäre Consumer können nicht steuern, wer Ereignisse für die von Ihnen erstellte Ereignis [*Senke*](gloss-s.md) bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="f73ee-118">Temporary consumers cannot control who provides events to the event [*sink*](gloss-s.md) they create.</span></span>

<span data-ttu-id="f73ee-119">Aufrufe der [**ExecNotificationQuery**](swbemservices-execnotificationquery.md) -Methoden können synchron, [*halb synchron*](gloss-s.md)oder asynchron erfolgen.</span><span class="sxs-lookup"><span data-stu-id="f73ee-119">Calls to [**ExecNotificationQuery**](swbemservices-execnotificationquery.md) methods can be made synchronously, [*semisynchronously*](gloss-s.md), or asynchronously.</span></span> <span data-ttu-id="f73ee-120">Beispielsweise ist [**SWbemServices.Execnotificationquery**](swbemservices-execnotificationquery.md) eine synchrone Methode, die in Abhängigkeit davon, wie der *IFlags* -Parameter festgelegt ist, SemiSynchron aufgerufen werden kann.</span><span class="sxs-lookup"><span data-stu-id="f73ee-120">For example, [**SWbemServices.ExecNotificationQuery**](swbemservices-execnotificationquery.md) is a synchronous method that can be called semisynchronously, depending on how the *iflags* parameter is set.</span></span> <span data-ttu-id="f73ee-121">[**SWbemServices.Execnotificationqueryasync**](swbemservices-execnotificationqueryasync.md) ist ein asynchroner Aufruf.</span><span class="sxs-lookup"><span data-stu-id="f73ee-121">[**SWbemServices.ExecNotificationQueryAsync**](swbemservices-execnotificationqueryasync.md) is an asynchronous call.</span></span>

<span data-ttu-id="f73ee-122">Beachten Sie, dass der Rückruf der Senke für die asynchronen Versionen dieser Aufrufe möglicherweise nicht auf derselben Authentifizierungs Ebene wie der Aufruf des Skripts zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="f73ee-122">Be aware that the callback to the sink for the asynchronous versions of these calls might not be returned at the same authentication level as the call the script made.</span></span> <span data-ttu-id="f73ee-123">Daher wird empfohlen, semisynchrone anstelle von asynchronen Aufrufen zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="f73ee-123">Therefore, it is recommended that you use semisynchronous instead of asynchronous calls.</span></span> <span data-ttu-id="f73ee-124">Wenn Sie asynchrone Kommunikation benötigen, finden Sie weitere Informationen unter [Aufrufen einer Methode](calling-a-method.md) und [Festlegen der Sicherheit für einen asynchronen Aufruf](setting-security-on-an-asynchronous-call.md).</span><span class="sxs-lookup"><span data-stu-id="f73ee-124">If you require asynchronous communication, see [Calling a Method](calling-a-method.md) and [Setting Security on an Asynchronous Call](setting-security-on-an-asynchronous-call.md).</span></span>

<span data-ttu-id="f73ee-125">Skript Abonnenten können die Zugriffsrechte eines Ereignis Anbieters nicht überprüfen, um Ereignisse für die Senke bereitzustellen, die vom Skript erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="f73ee-125">Scripting subscribers cannot check the access rights of an event provider to provide events to the sink created by the script.</span></span> <span data-ttu-id="f73ee-126">Daher wird empfohlen, dass Aufrufe von [**SWbemServices.Execnotificationquery**](swbemservices-execnotificationquery.md) die semisynchrone Form des Aufrufs verwenden und bestimmte Sicherheitseinstellungen verwenden.</span><span class="sxs-lookup"><span data-stu-id="f73ee-126">Therefore, it is recommended that calls to [**SWbemServices.ExecNotificationQuery**](swbemservices-execnotificationquery.md) use the semisynchronous form of the call and use specific security settings.</span></span> <span data-ttu-id="f73ee-127">Weitere Informationen finden Sie unter [Erstellen eines semisynchronen Aufrufes mit VBScript](making-a-semisynchronous-call-with-vbscript.md).</span><span class="sxs-lookup"><span data-stu-id="f73ee-127">For more information, see [Making a Semisynchronous Call with VBScript](making-a-semisynchronous-call-with-vbscript.md).</span></span>

## <a name="securing-permanent-consumers"></a><span data-ttu-id="f73ee-128">Sichern dauerhafter Consumer</span><span class="sxs-lookup"><span data-stu-id="f73ee-128">Securing Permanent Consumers</span></span>

<span data-ttu-id="f73ee-129">Ein [*dauerhafter*](gloss-p.md) Consumer verfügt über ein dauerhaftes Abonnement für Ereignisse eines Ereignis Anbieters, die nach dem Neustart des Betriebssystems persistent gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="f73ee-129">A [*permanent consumers*](gloss-p.md) has a permanent subscription to events from an event provider that will persist after the operating system is restarted.</span></span> <span data-ttu-id="f73ee-130">Ein Ereignis Anbieter, der permanente Consumer unterstützt, ist ein [*Ereignisconsumeranbieter*](gloss-e.md).</span><span class="sxs-lookup"><span data-stu-id="f73ee-130">An event provider that supports permanent consumers is a [*event consumer provider*](gloss-e.md).</span></span> <span data-ttu-id="f73ee-131">Wenn der Ereignis Anbieter nicht ausgeführt wird, wenn ein Ereignis auftritt, startet WMI den Anbieter, wenn er Ereignisse übermitteln muss.</span><span class="sxs-lookup"><span data-stu-id="f73ee-131">If the event provider is not running when an event occurs, then WMI starts the provider when it needs to deliver events.</span></span> <span data-ttu-id="f73ee-132">WMI identifiziert den Consumeranbieter, an den die Ereignisse übermittelt werden sollen, basierend auf der [**\_ \_ eventconsumerproviderregistration**](--eventconsumerproviderregistration.md) -Instanz, die die [**\_ \_ Win32Provider**](--win32provider.md) -Instanz des consumeranbieters einer vom Consumeranbieter definierten [*logischen Consumerklasse*](gloss-l.md) zuordnet.</span><span class="sxs-lookup"><span data-stu-id="f73ee-132">WMI identifies which consumer provider the events should be delivered to, based on the [**\_\_EventConsumerProviderRegistration**](--eventconsumerproviderregistration.md) instance, which associates the consumer provider [**\_\_Win32Provider**](--win32provider.md) instance with a [*logical consumer class*](gloss-l.md) defined by the consumer provider.</span></span> <span data-ttu-id="f73ee-133">Weitere Informationen zur Rolle von consumeranbietern finden Sie unter [Schreiben eines Ereignisconsumeranbieters](writing-an-event-consumer-provider.md).</span><span class="sxs-lookup"><span data-stu-id="f73ee-133">For more information about the role of consumer providers, see [Writing an Event Consumer Provider](writing-an-event-consumer-provider.md).</span></span>

<span data-ttu-id="f73ee-134">Permanente Consumer können steuern, wer Sie an Ereignisse sendet, und Ereignis Anbieter können steuern, wer auf Ihre Ereignisse zugreift.</span><span class="sxs-lookup"><span data-stu-id="f73ee-134">Permanent consumers can control who sends them events and event providers can control who accesses their events.</span></span>

<span data-ttu-id="f73ee-135">Client Skripts und Anwendungen erstellen Instanzen der logischen Consumerklasse als Teil eines Abonnements.</span><span class="sxs-lookup"><span data-stu-id="f73ee-135">Client scripts and applications create instances of the logical consumer class as part of a subscription.</span></span> <span data-ttu-id="f73ee-136">Die Klasse logischer Consumer definiert, welche Informationen das Ereignis enthält, wie der Client mit dem Ereignis Vorgehen kann und wie das Ereignis übermittelt wird.</span><span class="sxs-lookup"><span data-stu-id="f73ee-136">The logical consumer class defines what information the event contains, what the client can do with the event, and how the event is delivered.</span></span>

<span data-ttu-id="f73ee-137">Die WMI- [standardconsumerklassen](standard-consumer-classes.md) stellen Beispiele für die Rolle logischer Consumerklassen bereit.</span><span class="sxs-lookup"><span data-stu-id="f73ee-137">The WMI [Standard Consumer Classes](standard-consumer-classes.md) provide examples of the role of logical consumer classes.</span></span> <span data-ttu-id="f73ee-138">Weitere Informationen finden Sie unter über [wachen und reagieren auf Ereignisse mit Standard](monitoring-and-responding-to-events-with-standard-consumers.md)Consumern.</span><span class="sxs-lookup"><span data-stu-id="f73ee-138">For more information, see [Monitoring and Responding to Events with Standard Consumers](monitoring-and-responding-to-events-with-standard-consumers.md).</span></span>

## <a name="securing-the-permanent-subscription"></a><span data-ttu-id="f73ee-139">Sichern des permanenten Abonnements</span><span class="sxs-lookup"><span data-stu-id="f73ee-139">Securing the Permanent Subscription</span></span>

<span data-ttu-id="f73ee-140">Permanente Abonnements haben größere Möglichkeiten, Sicherheitsprobleme in WMI zu verursachen und müssen daher die folgenden Sicherheitsanforderungen erfüllen:</span><span class="sxs-lookup"><span data-stu-id="f73ee-140">Permanent subscriptions have greater potential to cause security problems in WMI and therefore have the following security requirements:</span></span>

-   <span data-ttu-id="f73ee-141">Die logische consumerinstanz, die [**\_ \_ EventFilter**](--eventfilter.md)-Instanz und die [**\_ \_ filtertoconsumerbinding**](--filtertoconsumerbinding.md) -Instanz müssen in der Eigenschaft " **kreatorsid** " dieselbe individuelle Sicherheits-ID (SID) aufweisen.</span><span class="sxs-lookup"><span data-stu-id="f73ee-141">The logical consumer instance, the [**\_\_EventFilter**](--eventfilter.md), and the [**\_\_FilterToConsumerBinding**](--filtertoconsumerbinding.md) instances must have the same individual security identifier (SID) in the **CreatorSID** property.</span></span> <span data-ttu-id="f73ee-142">Weitere Informationen finden Sie unter [beibehalten der gleichen SID in allen Instanzen eines permanenten Abonnements](#sids-and-permanent-subscriptions).</span><span class="sxs-lookup"><span data-stu-id="f73ee-142">For more information, see [Keeping the same SID in all instances of a permanent subscription](#sids-and-permanent-subscriptions).</span></span>
-   <span data-ttu-id="f73ee-143">Das Konto, mit dem das Abonnement erstellt wird, muss entweder ein Domänen Konto mit lokalen Administratorrechten oder das Konto der lokalen Administratoren Gruppe sein.</span><span class="sxs-lookup"><span data-stu-id="f73ee-143">The account that creates the subscription must be either a domain account with local administrator privileges or the local Administrators group account.</span></span> <span data-ttu-id="f73ee-144">Die Verwendung der Administratoren Gruppen-SID ermöglicht, dass das Abonnement weiterhin auf dem lokalen Computer funktioniert, auch wenn es vom Netzwerk getrennt ist.</span><span class="sxs-lookup"><span data-stu-id="f73ee-144">Using the Administrators group SID allows the subscription to continue to work on the local computer, even if it is disconnected from the network.</span></span> <span data-ttu-id="f73ee-145">Die Verwendung eines Domänen Kontos ermöglicht die genaue Identifizierung des Benutzers.</span><span class="sxs-lookup"><span data-stu-id="f73ee-145">Using a domain account allows exact identification of the user.</span></span>

    <span data-ttu-id="f73ee-146">Wenn der Computer jedoch nicht verbunden ist und das erstellende Konto ein Domänen Konto ist, schlägt der Consumer fehl, da die Identität des Kontos von WMI nicht überprüft werden kann.</span><span class="sxs-lookup"><span data-stu-id="f73ee-146">However, if the computer is not connected and the creating account is a domain account, the consumer fails because WMI cannot verify the identity of the account.</span></span> <span data-ttu-id="f73ee-147">Verwenden Sie zum Vermeiden eines Abonnement Fehlers, wenn der Computer nicht mit dem Netzwerk getrennt ist, die SID der Administratoren Gruppe für ein Abonnement.</span><span class="sxs-lookup"><span data-stu-id="f73ee-147">To avoid subscription failure if the computer is disconnected from the network, use the Administrators group SID for a subscription.</span></span> <span data-ttu-id="f73ee-148">In diesem Fall sollten Sie sicherstellen, dass das LocalSystem-Konto auf Gruppen Mitgliedschafts Daten in der Domäne zugreifen kann.</span><span class="sxs-lookup"><span data-stu-id="f73ee-148">In this case, you should ensure that the LocalSystem account can access group membership data on the domain.</span></span> <span data-ttu-id="f73ee-149">Einige Ereignisconsumeranbieter haben besonders hohe Sicherheitsanforderungen, da ein nicht autorisiertes Abonnement große Schäden verursachen kann.</span><span class="sxs-lookup"><span data-stu-id="f73ee-149">Some event consumer providers have particularly high security requirements, since a rogue subscription can cause great damage.</span></span> <span data-ttu-id="f73ee-150">Beispiele hierfür sind die [**Standardconsumer activescripteventconsumer**](activescripteventconsumer.md) und [**commandlineeventconsumer**](commandlineeventconsumer.md).</span><span class="sxs-lookup"><span data-stu-id="f73ee-150">Examples are the standard consumers, [**ActiveScriptEventConsumer**](activescripteventconsumer.md) and [**CommandLineEventConsumer**](commandlineeventconsumer.md).</span></span>

-   <span data-ttu-id="f73ee-151">Sie können das permanente Abonnement so konfigurieren, dass nur Ereignisse von bestimmten Ereignis Anbieter Identitäten akzeptiert werden.</span><span class="sxs-lookup"><span data-stu-id="f73ee-151">You can configure the permanent subscription to only accept events from specific event provider identities.</span></span> <span data-ttu-id="f73ee-152">Legen Sie die Sicherheits Beschreibung in der **eventaccess** -Eigenschaft der [**\_ \_ EventFilter**](--eventfilter.md) -Instanz auf die Ereignis Anbieter Identitäten fest.</span><span class="sxs-lookup"><span data-stu-id="f73ee-152">Set the security descriptor in the **EventAccess** property of the [**\_\_EventFilter**](--eventfilter.md) instance to the event provider identities.</span></span> <span data-ttu-id="f73ee-153">WMI vergleicht die Identität des Ereignis Anbieters mit der Sicherheits Beschreibung, um zu bestimmen, ob der Anbieter über **WBEM \_ rechten \_ Veröffentlichungs** Zugriff verfügt.</span><span class="sxs-lookup"><span data-stu-id="f73ee-153">WMI compares the identity of the event provider to the security descriptor to determine if the provider has **WBEM\_RIGHT\_PUBLISH** access.</span></span> <span data-ttu-id="f73ee-154">Weitere Informationen finden Sie unter [WMI-Sicherheits Konstanten](wmi-security-constants.md).</span><span class="sxs-lookup"><span data-stu-id="f73ee-154">For more information, see [WMI Security Constants](wmi-security-constants.md).</span></span>

    <span data-ttu-id="f73ee-155">Wenn der Filter den Zugriff auf die Identität des Ereignis Anbieters zulässt, vertraut Sie auch dem-Ereignis.</span><span class="sxs-lookup"><span data-stu-id="f73ee-155">If the filter allows access to the event provider identity, then it also trusts the event.</span></span> <span data-ttu-id="f73ee-156">Dadurch kann der Consumer, der das Ereignis empfangen hat, ein delegiertes Ereignis aufwecken.</span><span class="sxs-lookup"><span data-stu-id="f73ee-156">This allows the consumer that received the event to raise a delegated event.</span></span>

    <span data-ttu-id="f73ee-157">**Hinweis**  Der Standardwert für die Sicherheits Beschreibung in **eventaccess** ist **null**, was den Zugriff auf alle ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="f73ee-157">**Note**  The default for the security descriptor in **EventAccess** is **NULL**, which allows access to everyone.</span></span> <span data-ttu-id="f73ee-158">Es wird empfohlen, den Zugriff auf die Abonnement Instanz von [**\_ \_ EventFilter**](--eventfilter.md) einzuschränken, um die Sicherheit zu verbessern.</span><span class="sxs-lookup"><span data-stu-id="f73ee-158">Limiting access in the subscription instance of [**\_\_EventFilter**](--eventfilter.md) is recommended for better event security.</span></span>

## <a name="setting-an-administrator-only-sd"></a><span data-ttu-id="f73ee-159">Festlegen einer Administrator-Only SD</span><span class="sxs-lookup"><span data-stu-id="f73ee-159">Setting an Administrator-Only SD</span></span>

<span data-ttu-id="f73ee-160">Im folgenden C++-Codebeispiel wird eine Sicherheits Beschreibung für den Administrator auf der [**\_ \_ EventFilter**](--eventfilter.md) -Instanz erstellt.</span><span class="sxs-lookup"><span data-stu-id="f73ee-160">The following C++ code example creates an administrator-only security descriptor on the [**\_\_EventFilter**](--eventfilter.md) instance.</span></span> <span data-ttu-id="f73ee-161">In diesem Beispiel wird die Sicherheits Beschreibung mithilfe von SDDL ( [Security Deskriptor Definition Language](/windows/desktop/SecAuthZ/security-descriptor-definition-language) ) erstellt.</span><span class="sxs-lookup"><span data-stu-id="f73ee-161">This example creates the security descriptor using [Security Descriptor Definition Language](/windows/desktop/SecAuthZ/security-descriptor-definition-language) (SDDL).</span></span> <span data-ttu-id="f73ee-162">Weitere Informationen zum **\_ richtigen \_ Abonnieren von WBEM** finden Sie unter [WMI-Sicherheits Konstanten](wmi-security-constants.md).</span><span class="sxs-lookup"><span data-stu-id="f73ee-162">For more information about **WBEM\_RIGHT\_SUBSCRIBE**, see [WMI Security Constants](wmi-security-constants.md).</span></span>


```C++
// Create SD that allows only administrators 
//    to send events to this filter. 
// The SDDL settings are O:BAG:BAD:(A;;0x80;;;BA)
// Set the EventAccess property in the 
//    IWbemClassObject of the __EventFilter instance. 
   long lMask = WBEM_RIGHT_PUBLISH;
     WCHAR wBuf[MAX_PATH];
     _ltow( lMask, wBuf, 16 );
 
HRESULT hRes = pEventFilterInstance->Put( L"EventAccess", 0,
    &_variant_t( L"O:BAG:BAD:(A;;0x80;;;BA)" ), NULL );
```



<span data-ttu-id="f73ee-163">Für das vorherige Codebeispiel sind die folgenden Reference-und \# include-Anweisungen erforderlich.</span><span class="sxs-lookup"><span data-stu-id="f73ee-163">The previous code example requires the following reference and \#include statements.</span></span>


```C++
#define _WIN32_DCOM
#include <wbemidl.h>
#include <comdef.h>

#pragma comment(lib, "wbemuuid.lib")
```



## <a name="impersonating-the-event-provider-identity"></a><span data-ttu-id="f73ee-164">Identität der Identität des Ereignis Anbieters annehmen</span><span class="sxs-lookup"><span data-stu-id="f73ee-164">Impersonating the Event Provider Identity</span></span>

<span data-ttu-id="f73ee-165">Ein dauerhafter Consumer muss möglicherweise die Identität des Ereignis Anbieters annehmen, um das Ereignis zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="f73ee-165">A permanent consumer may need to impersonate the event provider to process the event.</span></span> <span data-ttu-id="f73ee-166">Permanente Consumer können nur dann die Identität des Ereignis Anbieters annehmen, wenn die folgenden Bedingungen erfüllt sind:</span><span class="sxs-lookup"><span data-stu-id="f73ee-166">Permanent consumers can only impersonate the event provider when the following conditions exist:</span></span>

-   <span data-ttu-id="f73ee-167">Für die Instanz von [**\_ \_ filtertoconsumerbinding**](--filtertoconsumerbinding.md) ist die **wart SecurityContext** -Eigenschaft auf **true** festgelegt.</span><span class="sxs-lookup"><span data-stu-id="f73ee-167">The instance of [**\_\_FilterToConsumerBinding**](--filtertoconsumerbinding.md) has the **MaintainSecurityContext** property set to **True**.</span></span>
-   <span data-ttu-id="f73ee-168">Ein Ereignis wird im gleichen Sicherheitskontext bereitgestellt, in dem sich der Anbieter beim Generieren des Ereignisses befand.</span><span class="sxs-lookup"><span data-stu-id="f73ee-168">An event is delivered in the same security context that the provider was in when it generated the event.</span></span> <span data-ttu-id="f73ee-169">Nur ein Consumer, der als DLL, ein Prozess interner Consumer, implementiert ist, kann Ereignisse im Sicherheitskontext des Anbieters empfangen.</span><span class="sxs-lookup"><span data-stu-id="f73ee-169">Only a consumer implemented as a DLL, an in-process consumer, can receive events in the security context of the provider.</span></span> <span data-ttu-id="f73ee-170">Weitere Informationen zur Sicherheit von in-Process-Anbietern und-Consumern finden Sie unter [Anbieter Hosting und-Sicherheit](provider-hosting-and-security.md).</span><span class="sxs-lookup"><span data-stu-id="f73ee-170">For more information about security of in-process providers and consumers, see [Provider Hosting and Security](provider-hosting-and-security.md).</span></span>
-   <span data-ttu-id="f73ee-171">Der Ereignis Anbieter wird in einem Prozess ausgeführt, der Identitätswechsel zulässt.</span><span class="sxs-lookup"><span data-stu-id="f73ee-171">The event provider is running in a process that allows impersonation.</span></span>

<span data-ttu-id="f73ee-172">Das Konto, unter dem der consumerprozess ausgeführt wird, muss über **vollen \_ Schreib** Zugriff auf das WMI-Repository (auch als CIM-Repository bezeichnet) verfügen.</span><span class="sxs-lookup"><span data-stu-id="f73ee-172">The account running the consumer process must have **FULL\_WRITE** access to the WMI repository (also known as the CIM repository).</span></span> <span data-ttu-id="f73ee-173">Im Abonnement müssen die Instanzen [**\_ \_ filtertoconsumerbinding**](--filtertoconsumerbinding.md), [**\_ \_ eventconsumer**](--eventconsumer.md)und [**\_ \_ EventFilter**](--eventfilter.md) in der Eigenschaft " **kreatorsid** " denselben Wert für die individuelle Sicherheits-ID (SID) aufweisen.</span><span class="sxs-lookup"><span data-stu-id="f73ee-173">In the subscription, the [**\_\_FilterToConsumerBinding**](--filtertoconsumerbinding.md), [**\_\_EventConsumer**](--eventconsumer.md), and [**\_\_EventFilter**](--eventfilter.md) instances must have the same individual security identifier (SID) value in the **CreatorSID** property.</span></span> <span data-ttu-id="f73ee-174">WMI speichert die sid für jede Instanz in der " **kreatorsid** ".</span><span class="sxs-lookup"><span data-stu-id="f73ee-174">WMI stores the SID in the **CreatorSID** for each instance.</span></span>

## <a name="sids-and-permanent-subscriptions"></a><span data-ttu-id="f73ee-175">SIDs und permanente Abonnements</span><span class="sxs-lookup"><span data-stu-id="f73ee-175">SIDs and Permanent Subscriptions</span></span>

<span data-ttu-id="f73ee-176">Ein dauerhaftes Abonnement funktioniert nicht, wenn die Bindung, der Consumer und der Filter nicht durch denselben Benutzer erstellt werden, was bedeutet, dass [**\_ \_ filtertoconsumerbinding**](--filtertoconsumerbinding.md), [**\_ \_ eventconsumer**](--eventconsumer.md)und [**\_ \_ EventFilter**](--eventfilter.md) denselben Wert für die individuelle Sicherheits-ID (SID) in der Eigenschaft " **kreatorsid** " aufweisen müssen.</span><span class="sxs-lookup"><span data-stu-id="f73ee-176">A permanent subscription does not work when the binding, the consumer, and the filter are not created by the same user, which means that the [**\_\_FilterToConsumerBinding**](--filtertoconsumerbinding.md), [**\_\_EventConsumer**](--eventconsumer.md), and [**\_\_EventFilter**](--eventfilter.md) must have the same individual security identifier (SID) value in the **CreatorSID** property.</span></span> <span data-ttu-id="f73ee-177">Windows-Verwaltungsinstrumentation (WMI) speichert diesen Wert.</span><span class="sxs-lookup"><span data-stu-id="f73ee-177">Windows Management Instrumentation (WMI) stores this value.</span></span>

## <a name="creating-permanent-subscriptions-using-domain-accounts"></a><span data-ttu-id="f73ee-178">Erstellen dauerhafter Abonnements mithilfe von Domänen Konten</span><span class="sxs-lookup"><span data-stu-id="f73ee-178">Creating Permanent Subscriptions Using Domain Accounts</span></span>

<span data-ttu-id="f73ee-179">Bei der Verwendung von Domänen Konten zum Erstellen dauerhafter Abonnements müssen mehrere Probleme berücksichtigt werden.</span><span class="sxs-lookup"><span data-stu-id="f73ee-179">Several issues must be considered when using domain accounts to create permanent subscriptions.</span></span> <span data-ttu-id="f73ee-180">Alle permanenten Abonnements sollten immer noch funktionieren, wenn kein Benutzer angemeldet ist. Dies bedeutet, dass Sie unter dem integrierten LocalSystem-Konto funktionieren.</span><span class="sxs-lookup"><span data-stu-id="f73ee-180">Every permanent subscription should still work when no user is logged on, which means they function under the built-in LocalSystem account.</span></span>

<span data-ttu-id="f73ee-181">Wenn ein Domänen Benutzer der Ersteller eines permanenten Abonnements für sicherheitssensible Consumer ist ([**activescripteventconsumer**](activescripteventconsumer.md), [**commandlineeventconsumer**](commandlineeventconsumer.md)), überprüft WMI, ob die Eigenschaft " **kreatorsid** " der [**\_ \_ EventFilter**](--eventfilter.md) -Klasse, die [**\_ \_ filtertoconsumerbinding**](--filtertoconsumerbinding.md) -Klasse und die consumerinstanzen zu einem Benutzer gehören, der Mitglied der lokalen Administrator Gruppe ist.</span><span class="sxs-lookup"><span data-stu-id="f73ee-181">If a domain user is the creator of a permanent subscription for security sensitive consumers ([**ActiveScriptEventConsumer**](activescripteventconsumer.md), [**CommandLineEventConsumer**](commandlineeventconsumer.md)), then WMI verifies whether the **CreatorSID** property of the [**\_\_EventFilter**](--eventfilter.md) class, [**\_\_FilterToConsumerBinding**](--filtertoconsumerbinding.md) class, and the consumer instances belong to a user who is member of local Administrators group.</span></span>

<span data-ttu-id="f73ee-182">Im folgenden Codebeispiel wird gezeigt, wie Sie die Eigenschaft " **kreatorsid** " angeben können.</span><span class="sxs-lookup"><span data-stu-id="f73ee-182">The following code example shows how you can specify the **CreatorSID** property.</span></span>

``` syntax
 instance of __EventFilter as $FILTER
    {
        // this is the Administrators SID in array of bytes format
        CreatorSID = {1,2,0,0,0,0,0,5,32,0,0,0,32,2,0,0};    
        // Add filter code here ...
    }

    instance of ActiveScriptEventConsumer as $CONSUMER
    {
       CreatorSID = {1,2,0,0,0,0,0,5,32,0,0,0,32,2,0,0};
       // Add consumer code here ...
    }

    instance of __FilterToConsumerBinding
    {
       CreatorSID = {1,2,0,0,0,0,0,5,32,0,0,0,32,2,0,0};
       Consumer = $CONSUMER;
       Filter = $FILTER;
       // Add binding code here ...
    }
```

<span data-ttu-id="f73ee-183">Fügen Sie für Domänen übergreifende Situationen der "Windows-Autorisierungs Zugriffs Gruppe" authentifizierte Benutzer hinzu.</span><span class="sxs-lookup"><span data-stu-id="f73ee-183">For cross domain situations, add Authenticated Users to the "Windows Authorization Access Group".</span></span>

## <a name="related-topics"></a><span data-ttu-id="f73ee-184">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="f73ee-184">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f73ee-185">Sichern von WMI-Ereignissen</span><span class="sxs-lookup"><span data-stu-id="f73ee-185">Securing WMI Events</span></span>](securing-wmi-events.md)
</dt> <dt>

[<span data-ttu-id="f73ee-186">Empfangen eines WMI-Ereignisses</span><span class="sxs-lookup"><span data-stu-id="f73ee-186">Receiving a WMI Event</span></span>](receiving-a-wmi-event.md)
</dt> </dl>

 

 
