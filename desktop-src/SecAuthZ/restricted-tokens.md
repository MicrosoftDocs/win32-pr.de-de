---
description: Ein eingeschränktes Token ist ein primäres Token oder ein Identitätswechsel-Zugriffs Token, das von der Funktion "| aterestrictedtoken" geändert wurde.
ms.assetid: 06580ab9-ff58-4aa9-bf88-9536a2e1981d
title: Eingeschränkte Token
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fee8e6c89915e3edd0a9206f84a0d3d5697a3cb9
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "104129912"
---
# <a name="restricted-tokens"></a><span data-ttu-id="c42d0-103">Eingeschränkte Token</span><span class="sxs-lookup"><span data-stu-id="c42d0-103">Restricted Tokens</span></span>

<span data-ttu-id="c42d0-104">Ein eingeschränktes Token ist ein [*Primäres*](/windows/desktop/SecGloss/p-gly) Token oder ein Identitätswechsel- [*Zugriffs Token*](/windows/desktop/SecGloss/a-gly) , das von der Funktion "| [**aterestrictedtoken**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-createrestrictedtoken) " geändert wurde.</span><span class="sxs-lookup"><span data-stu-id="c42d0-104">A restricted token is a [*primary*](/windows/desktop/SecGloss/p-gly) or impersonation [*access token*](/windows/desktop/SecGloss/a-gly) that has been modified by the [**CreateRestrictedToken**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-createrestrictedtoken) function.</span></span> <span data-ttu-id="c42d0-105">Ein [*Prozess*](/windows/desktop/SecGloss/p-gly) oder der Identitätswechsel in einem Thread, der im [*Sicherheitskontext*](/windows/desktop/SecGloss/s-gly) eines eingeschränkten Tokens ausgeführt wird, ist darauf beschränkt, auf Sicherungs fähige Objekte zuzugreifen oder privilegierte Vorgänge auszuführen.</span><span class="sxs-lookup"><span data-stu-id="c42d0-105">A [*process*](/windows/desktop/SecGloss/p-gly) or impersonating thread running in the [*security context*](/windows/desktop/SecGloss/s-gly) of a restricted token is restricted in its ability to access securable objects or perform privileged operations.</span></span> <span data-ttu-id="c42d0-106">Die **Funktion "** Funktion" kann ein Token auf folgende Weise einschränken:</span><span class="sxs-lookup"><span data-stu-id="c42d0-106">The **CreateRestrictedToken** function can restrict a token in the following ways:</span></span>

-   <span data-ttu-id="c42d0-107">Entfernen Sie [Berechtigungen](privileges.md) aus dem Token.</span><span class="sxs-lookup"><span data-stu-id="c42d0-107">Remove [privileges](privileges.md) from the token.</span></span>
-   <span data-ttu-id="c42d0-108">Wenden Sie das Attribut Deny auf SIDs im Token an, damit Sie nicht für den Zugriff auf gesicherte Objekte verwendet werden können.</span><span class="sxs-lookup"><span data-stu-id="c42d0-108">Apply the deny-only attribute to SIDs in the token so that they cannot be used to access secured objects.</span></span> <span data-ttu-id="c42d0-109">Weitere Informationen zum Deny-only-Attribut finden Sie unter [SID-Attribute in einem Zugriffs Token](sid-attributes-in-an-access-token.md).</span><span class="sxs-lookup"><span data-stu-id="c42d0-109">For more information about the deny-only attribute, see [SID Attributes in an Access Token](sid-attributes-in-an-access-token.md).</span></span>
-   <span data-ttu-id="c42d0-110">Geben Sie eine Liste mit einschränkenden SIDs an, die den Zugriff auf Sicherungs fähige Objekte einschränken kann.</span><span class="sxs-lookup"><span data-stu-id="c42d0-110">Specify a list of restricting SIDs, which can limit access to securable objects.</span></span>

<span data-ttu-id="c42d0-111">Das System verwendet die Liste der einschränkenden SIDs, wenn der Zugriff des Tokens auf ein Sicherungs fähiges Objekt überprüft wird.</span><span class="sxs-lookup"><span data-stu-id="c42d0-111">The system uses the list of restricting SIDs when it checks the token's access to a securable object.</span></span> <span data-ttu-id="c42d0-112">Wenn ein eingeschränkter Prozess oder Thread versucht, auf ein Sicherungs fähiges Objekt zuzugreifen, führt das System zwei Zugriffs Überprüfungen durch: einen, der die aktivierten SIDs des Tokens verwendet, und einen anderen, der die Liste der einschränkenden SIDs verwendet.</span><span class="sxs-lookup"><span data-stu-id="c42d0-112">When a restricted process or thread tries to access a securable object, the system performs two access checks: one using the token's enabled SIDs, and another using the list of restricting SIDs.</span></span> <span data-ttu-id="c42d0-113">Der Zugriff wird nur gewährt, wenn beide Zugriffs Überprüfungen die angeforderten Zugriffsrechte zulassen.</span><span class="sxs-lookup"><span data-stu-id="c42d0-113">Access is granted only if both access checks allow the requested access rights.</span></span> <span data-ttu-id="c42d0-114">Weitere Informationen zu Zugriffs Überprüfungen finden [Sie Untersteuern des Zugriffs auf ein Objekt durch DACLs](how-dacls-control-access-to-an-object.md).</span><span class="sxs-lookup"><span data-stu-id="c42d0-114">For more information about access checks, see [How DACLs Control Access to an Object](how-dacls-control-access-to-an-object.md).</span></span>

<span data-ttu-id="c42d0-115">Sie können ein eingeschränktes [*primäres Token*](/windows/desktop/SecGloss/p-gly) in einem aufzurufenden Befehl an die Funktion "| [**ateprocessasuser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) " verwenden.</span><span class="sxs-lookup"><span data-stu-id="c42d0-115">You can use a restricted [*primary token*](/windows/desktop/SecGloss/p-gly) in a call to the [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) function.</span></span> <span data-ttu-id="c42d0-116">In der Regel muss der Prozess, der " **itateprocessasuser** " aufruft, die namens Berechtigung "SE zuweist" \_ \_ , die in der Regel nur durch Systemcode oder Dienste, die im Konto "LocalSystem" ausgeführt werden, enthalten.</span><span class="sxs-lookup"><span data-stu-id="c42d0-116">Typically, the process that calls **CreateProcessAsUser** must have the SE\_ASSIGNPRIMARYTOKEN\_NAME privilege, which is usually held only by system code or by services running in the LocalSystem account.</span></span> <span data-ttu-id="c42d0-117">Wenn der Aufruf von "| **ateprocessasuser** " jedoch eine eingeschränkte Version des primären Tokens des Aufrufers angibt, ist dieses Privileg nicht erforderlich.</span><span class="sxs-lookup"><span data-stu-id="c42d0-117">However, if the **CreateProcessAsUser** call specifies a restricted version of the caller's primary token, this privilege is not required.</span></span> <span data-ttu-id="c42d0-118">Dadurch können normale Anwendungen eingeschränkte Prozesse erstellen.</span><span class="sxs-lookup"><span data-stu-id="c42d0-118">This enables ordinary applications to create restricted processes.</span></span>

<span data-ttu-id="c42d0-119">Sie können in der Identität [**ateloggedonuser**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) -Funktion auch ein eingeschränktes primär-oder Identitäts [*Token*](/windows/desktop/SecGloss/i-gly) verwenden.</span><span class="sxs-lookup"><span data-stu-id="c42d0-119">You can also use a restricted primary or [*impersonation token*](/windows/desktop/SecGloss/i-gly) in the [**ImpersonateLoggedOnUser**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) function.</span></span>

<span data-ttu-id="c42d0-120">Um zu ermitteln, ob ein Token über eine Liste mit einschränkenden SIDs verfügt, müssen Sie die [**istokenrestricted**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-istokenrestricted) -Funktion aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="c42d0-120">To determine whether a token has a list of restricting SIDs, call the [**IsTokenRestricted**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-istokenrestricted) function.</span></span>

> [!Note]  
> <span data-ttu-id="c42d0-121">Anwendungen, die eingeschränkte Token verwenden, sollten die eingeschränkte Anwendung auf Desktops außer dem Standard Desktop ausführen.</span><span class="sxs-lookup"><span data-stu-id="c42d0-121">Applications that use restricted tokens should run the restricted application on desktops other than the default desktop.</span></span> <span data-ttu-id="c42d0-122">Dies ist erforderlich, um Angriffe durch eine eingeschränkte Anwendung, die **SendMessage** oder **PostMessage**, an unbeschränkte Anwendungen auf dem Standard Desktop zu verhindern.</span><span class="sxs-lookup"><span data-stu-id="c42d0-122">This is necessary to prevent an attack by a restricted application, using **SendMessage** or **PostMessage**, to unrestricted applications on the default desktop.</span></span> <span data-ttu-id="c42d0-123">Wechseln Sie ggf. zwischen den Desktops für Ihre Anwendung.</span><span class="sxs-lookup"><span data-stu-id="c42d0-123">If necessary, switch between desktops for your application purposes.</span></span>

 

 

 
