---
description: Eine Serveranwendung kann die Funktion "-Funktion" aufrufen, um einen neuen Prozess zu erstellen, der im Sicherheitskontext eines Clients ausgeführt wird.
ms.assetid: bd416109-fe76-4d55-bc63-3ebbcf32b92a
title: Prozesse im Client Sicherheitskontext
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 29c9bafb576bd0d195ae762c69be885ac32f1071
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "106372877"
---
# <a name="processes-in-the-client-security-context"></a><span data-ttu-id="0d34c-103">Prozesse im Client Sicherheitskontext</span><span class="sxs-lookup"><span data-stu-id="0d34c-103">Processes in the Client Security Context</span></span>

<span data-ttu-id="0d34c-104">Eine Serveranwendung [**kann die Funktion**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) "-Funktion" aufrufen, um einen neuen Prozess zu erstellen, der im [*Sicherheitskontext*](/windows/desktop/SecGloss/s-gly)eines Clients ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="0d34c-104">A server application can call the [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) function to create a new process that runs in a client's [*security context*](/windows/desktop/SecGloss/s-gly).</span></span> <span data-ttu-id="0d34c-105">Wenn der Aufruf mit dem [*Zugriffs Token*](/windows/desktop/SecGloss/a-gly)eines Clients erfolgt, benötigt " **fiateprocessasuser** " den Namen "SE zuordnername" \_ \_ und "SE \_ Erhöhung \_ Quota Name" \_ , die von Windows-Diensten, die im [LocalSystem-Konto](/windows/desktop/Services/localsystem-account)ausgeführt werden, gehalten werden.</span><span class="sxs-lookup"><span data-stu-id="0d34c-105">When called with a client's [*access token*](/windows/desktop/SecGloss/a-gly), **CreateProcessAsUser** requires the SE\_ASSIGNPRIMARYTOKEN\_NAME and SE\_INCREASE\_QUOTA\_NAME privileges, which are held by Windows services running in the [LocalSystem Account](/windows/desktop/Services/localsystem-account).</span></span>

<span data-ttu-id="0d34c-106">Die Funktion " [**fiateprocessasuser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) " erfordert auch ein [*Primäres Zugriffs Token*](/windows/desktop/SecGloss/p-gly).</span><span class="sxs-lookup"><span data-stu-id="0d34c-106">The [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) function also requires a [*primary access token*](/windows/desktop/SecGloss/p-gly).</span></span> <span data-ttu-id="0d34c-107">Ein Server kann ein primäres Zugriffs Token für einen Client abrufen, indem er entweder [eine Anmelde Sitzung](client-logon-sessions.md) für den Client startet oder die Identität [des Clients](client-impersonation.md) annimmt und das Identitätswechsel [*Token*](/windows/desktop/SecGloss/i-gly)duplizieren.</span><span class="sxs-lookup"><span data-stu-id="0d34c-107">A server can get a primary access token for a client either by [starting a logon session](client-logon-sessions.md) for the client or by [impersonating the client](client-impersonation.md) and duplicating the [*impersonation token*](/windows/desktop/SecGloss/i-gly).</span></span>

<span data-ttu-id="0d34c-108">In den folgenden Verfahren werden zwei Möglichkeiten zum Erstellen eines Client Prozesses beschrieben.</span><span class="sxs-lookup"><span data-stu-id="0d34c-108">The following procedures describe two ways to create a client process.</span></span>

<span data-ttu-id="0d34c-109">**So erstellen Sie einen Client Prozess durch Anmelden beim Client**</span><span class="sxs-lookup"><span data-stu-id="0d34c-109">**To create a client process by logging on to the client**</span></span>

1.  <span data-ttu-id="0d34c-110">Melden Sie den Client mithilfe der Anmelde Informationen des Clients bei einem [**LogonUser**](/windows/desktop/api/winbase/nf-winbase-logonusera)- [*Anmelde*](/windows/desktop/SecGloss/c-gly) Name auf dem lokalen Computer an.</span><span class="sxs-lookup"><span data-stu-id="0d34c-110">Log the client on to the local computer using the client's [*credentials*](/windows/desktop/SecGloss/c-gly) in a call to [**LogonUser**](/windows/desktop/api/winbase/nf-winbase-logonusera).</span></span> <span data-ttu-id="0d34c-111">**LogonUser** erstellt ein primäres Token für die [*Anmelde Sitzung*](/windows/desktop/SecGloss/l-gly)des Clients.</span><span class="sxs-lookup"><span data-stu-id="0d34c-111">**LogonUser** produces a primary token for the client's [*logon session*](/windows/desktop/SecGloss/l-gly).</span></span>
2.  <span data-ttu-id="0d34c-112">Wenn der Server den Sicherheitskontext des Clients verwenden muss, erhalten Sie Zugriff auf die ausführbare Datei für den Client [*Prozess*](/windows/desktop/SecGloss/p-gly) , indem Sie das primäre Token in einem Aufrufen der Identität [**ateloggedonuser**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) -Funktion verwenden.</span><span class="sxs-lookup"><span data-stu-id="0d34c-112">If the server needs to use the client's security context, get access to the executable file for the client [*process*](/windows/desktop/SecGloss/p-gly) by using the primary token in a call to the [**ImpersonateLoggedOnUser**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) function.</span></span>
3.  <span data-ttu-id="0d34c-113">Erstellen Sie einen Prozess im Sicherheitskontext des [**Clients, indem Sie das**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera)primäre Token in einem aufzurufenden aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="0d34c-113">Create a process in the client's security context by using the primary token in a call to [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera).</span></span>

> [!Note]  
> <span data-ttu-id="0d34c-114">Ein mit der folgenden Technik erstellter Prozess kann möglicherweise nicht auf Netzwerkressourcen zugreifen, es sei denn, er verfügt über die [*Anmelde*](/windows/desktop/SecGloss/c-gly)Informationen des Clients.</span><span class="sxs-lookup"><span data-stu-id="0d34c-114">A process created by using the following technique may not be able to access network resources unless it has the client's [*credentials*](/windows/desktop/SecGloss/c-gly).</span></span>

 

<span data-ttu-id="0d34c-115">**So erstellen Sie einen Client Prozess durch annehmen der Identität des Clients**</span><span class="sxs-lookup"><span data-stu-id="0d34c-115">**To create a client process by impersonating the client**</span></span>

1.  <span data-ttu-id="0d34c-116">Starten Sie den Identitätswechsel, indem Sie eine Identitätswechsel Funktion verwenden, z. b. "Identität- [**amedpipeclient**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-impersonatenamedpipeclient)".</span><span class="sxs-lookup"><span data-stu-id="0d34c-116">Start the impersonation by using an impersonation function, such as [**ImpersonateNamedPipeClient**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-impersonatenamedpipeclient).</span></span>
2.  <span data-ttu-id="0d34c-117">Zum Abrufen eines Identitätswechsel Tokens, das den Sicherheitskontext des Clients enthält, können Sie die [**openthread Token**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-openthreadtoken) -Funktion abrufen.</span><span class="sxs-lookup"><span data-stu-id="0d34c-117">Call the [**OpenThreadToken**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-openthreadtoken) function to get an impersonation token that has the security context of the client.</span></span>
3.  <span data-ttu-id="0d34c-118">Aufrufen der [**Dupli-etokenex**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetokenex) -Funktion, um das Identitätswechsel Token in ein primäres Token zu konvertieren.</span><span class="sxs-lookup"><span data-stu-id="0d34c-118">Call the [**DuplicateTokenEx**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetokenex) function to convert the impersonation token into a primary token.</span></span>
4.  <span data-ttu-id="0d34c-119">Verwenden Sie das primäre Token in einem Aufrufen der [**Funktion "**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) ", um einen Prozess im Sicherheitskontext des Clients zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="0d34c-119">Use the primary token in a call to the [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) function to create a process in the client's security context.</span></span>

<span data-ttu-id="0d34c-120">Standard [**mäßig erstellt der**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) Client [*Prozess*](/windows/desktop/SecGloss/p-gly) in einer nicht interaktiven Fenster Station und einem Desktop.</span><span class="sxs-lookup"><span data-stu-id="0d34c-120">By default, [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) creates the client [*process*](/windows/desktop/SecGloss/p-gly) on a noninteractive window station and desktop.</span></span> <span data-ttu-id="0d34c-121">Um einen interaktiven Prozess zu erstellen, muss der Server zunächst die freigegebenen [*Zugriffs Steuerungs Listen*](/windows/desktop/SecGloss/d-gly) (DACLs) der interaktiven Fenster Station und des Desktops festlegen, um sicherzustellen, dass dem Client der Zugriff gewährt wird.</span><span class="sxs-lookup"><span data-stu-id="0d34c-121">To create an interactive process, the server must first set the [*discretionary access control lists*](/windows/desktop/SecGloss/d-gly) (DACLs) of the interactive window station and desktop to ensure that the client is allowed access to them.</span></span> <span data-ttu-id="0d34c-122">Die bevorzugte Vorgehensweise besteht darin, den Client zu protokollieren, [die Sicherheits-ID (SID) der Anmelde Sitzung des Clients zu erhalten](/previous-versions//aa446670(v=vs.85))und diese SID dann in Zugriffs zulässigen ACEs sowohl auf der interaktiven Fenster Station als auch auf dem Desktop zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="0d34c-122">The preferred way to do this is to log the client on, [get the security identifier (SID) of the client's logon session](/previous-versions//aa446670(v=vs.85)), and then use that SID in access-allowed ACEs on both the interactive window station and desktop.</span></span> <span data-ttu-id="0d34c-123">Der Server kann dann " **kreateprocessasuser**" aufrufen, wobei die interaktive Fenster Station und der Desktop WinSta0 Standard angegeben werden \\ .</span><span class="sxs-lookup"><span data-stu-id="0d34c-123">The server can then call **CreateProcessAsUser**, specifying the interactive window station and desktop winsta0\\default.</span></span> <span data-ttu-id="0d34c-124">Ein Beispiel für diese Prozedur finden Sie unter [Starten eines interaktiven Client Prozesses in C++](/previous-versions//aa379608(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="0d34c-124">For an example that shows this procedure, see [Starting an Interactive Client Process in C++](/previous-versions//aa379608(v=vs.85)).</span></span>

 

 
