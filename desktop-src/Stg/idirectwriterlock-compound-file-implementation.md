---
title: Implementierung von idirectschreiterlock-Verbund Dateien
description: Die Implementierung der Verbund Datei von idirectschreiterlock bietet eine Möglichkeit zum Öffnen einer Verbund Datei im direkten Modus mit einem einzigen Writer und mehreren Lesern.
ms.assetid: 4b247dae-d937-430a-bdb7-c47fa3c026b6
keywords:
- Idirectwrite terlock-geg, Implementierung von Verbund Dateien
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 861935a4c373ce03408c0e633e581e56d39623da
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/16/2019
ms.locfileid: "103708453"
---
# <a name="idirectwriterlock---compound-file-implementation"></a><span data-ttu-id="493ed-104">Implementierung von idirectschreiterlock-Verbund Dateien</span><span class="sxs-lookup"><span data-stu-id="493ed-104">IDirectWriterLock - Compound File Implementation</span></span>

<span data-ttu-id="493ed-105">Die Implementierung der Verbund Datei von [**idirectschreiterlock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) bietet eine Möglichkeit zum Öffnen einer Verbund Datei im direkten Modus mit einem einzigen Writer und mehreren Lesern.</span><span class="sxs-lookup"><span data-stu-id="493ed-105">The compound file implementation of [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) provides a way to open a compound file in direct mode with a single writer and multiple readers.</span></span>

<span data-ttu-id="493ed-106">Verbund Dateien können im direkt Modus mit dem STGM Direct- \_ Flag geöffnet werden.</span><span class="sxs-lookup"><span data-stu-id="493ed-106">Compound files can be opened in direct mode using the STGM\_DIRECT flag.</span></span> <span data-ttu-id="493ed-107">Die [**idirectschreiterlock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) -Schnittstelle legt das STGM- \_ \| Schreib kennflag "Read Write STGM" \_ \_ \_ als gültig im direkten Modus fest, ohne dass der Aufwand einer Momentaufnahme Kopie erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="493ed-107">The [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) interface sets the STGM\_READWRITE\|STGM\_SHARE\_DENY\_WRITE flag as valid in direct mode without requiring the overhead of a snapshot copy.</span></span>

<span data-ttu-id="493ed-108">Wenn eine Verbund Datei mit dem transaktiven STGM-Flag im transaktiven Modus geöffnet wird \_ , können Sie auch mehrere Reader und einen einzigen Writer verwenden, indem Sie das kennflag zum Schreiben von "STGM" für "read \_ Write \| STGM" verwenden \_ \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="493ed-108">When a compound file is opened in transacted mode using the STGM\_TRANSACTED flag, you can also have multiple readers and a single writer using the STGM\_READWRITE\|STGM\_SHARE\_DENY\_WRITE flag.</span></span> <span data-ttu-id="493ed-109">In diesem Fall wird jedoch eine Momentaufnahme Kopie der Datei für die Leser erstellt.</span><span class="sxs-lookup"><span data-stu-id="493ed-109">However, in this case, a snapshot copy of the file is made for the readers.</span></span> <span data-ttu-id="493ed-110">Der Aufwand für eine Scratch-Kopie ist häufig zu erhöhen.</span><span class="sxs-lookup"><span data-stu-id="493ed-110">There is often overhead of a scratch copy.</span></span>

## <a name="when-to-use"></a><span data-ttu-id="493ed-111">Verwendungs Zeitpunkt</span><span class="sxs-lookup"><span data-stu-id="493ed-111">When to Use</span></span>

<span data-ttu-id="493ed-112">Verwenden Sie die vom System bereitgestellte Implementierung von [**idirectschreiterlock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) , wenn Sie einen Speicher im direkten Modus (STGM \_ Direct) mit der STGM-Schreib Schreib-/Schreib-Schreib-Kennzeichnungen für den STGM- \_ Lesevorgang \| \_ \_ \_</span><span class="sxs-lookup"><span data-stu-id="493ed-112">Use the system-supplied implementation of [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) when you open a storage in direct mode (STGM\_DIRECT) with the STGM\_READWRITE\|STGM\_SHARE\_DENY\_WRITE flags.</span></span>

<span data-ttu-id="493ed-113">Rufen Sie zum Abrufen eines Zeigers auf [**idirectschreiterlock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) **QueryInterface** für [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) auf, um das Stamm Speicher Objekt für die Verbund Datei abzurufen.</span><span class="sxs-lookup"><span data-stu-id="493ed-113">To obtain a pointer to [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock), call **QueryInterface** on [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) to get the root storage object for the compound file.</span></span>

<span data-ttu-id="493ed-114">Rufen Sie [**idirectschreiterlock:: waitforschreiteaccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) auf, um exklusiven Schreibzugriff auf eine Verbund Datei zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="493ed-114">Call [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) to obtain exclusive write access to a compound file.</span></span> <span data-ttu-id="493ed-115">Aufrufen von [**idirectschreiterlock:: releaseschreiteaccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-releasewriteaccess) , um exklusiven Schreibzugriff freizugeben.</span><span class="sxs-lookup"><span data-stu-id="493ed-115">Call [**IDirectWriterLock::ReleaseWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-releasewriteaccess) to release exclusive write access.</span></span>

<span data-ttu-id="493ed-116">[**Idirectschreiterlock:: haveschreiteaccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-havewriteaccess) gibt an, ob die Datei zurzeit gesperrt ist.</span><span class="sxs-lookup"><span data-stu-id="493ed-116">[**IDirectWriterLock::HaveWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-havewriteaccess) indicates whether the file is currently locked.</span></span>

## <a name="remarks"></a><span data-ttu-id="493ed-117">Bemerkungen</span><span class="sxs-lookup"><span data-stu-id="493ed-117">Remarks</span></span>

<span data-ttu-id="493ed-118">Die Implementierung der Verbund Datei des Single Writer-Features mit mehreren Lese Vorlesern basiert auf Bereichs sperren.</span><span class="sxs-lookup"><span data-stu-id="493ed-118">The compound file implementation of the single-writer, multiple-reader feature is based on range locking.</span></span> <span data-ttu-id="493ed-119">Der Writer erhält exklusiven Zugriff auf den zu schreibende Speicher, nachdem alle aktuellen Reader den Speicher geschlossen haben.</span><span class="sxs-lookup"><span data-stu-id="493ed-119">The writer obtains exclusive access to the storage to write after all current readers have closed the storage.</span></span> <span data-ttu-id="493ed-120">Während der Writer aktiv ist, können nachfolgende Reader den Speicher nicht öffnen.</span><span class="sxs-lookup"><span data-stu-id="493ed-120">While the writer is active, subsequent readers cannot open the storage.</span></span> <span data-ttu-id="493ed-121">Der Writer ruft [**idirectbeschreib terlock:: waitforschreiteaccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) auf, um exklusiven Schreibzugriff zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="493ed-121">The writer calls [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) to obtain exclusive write access.</span></span> <span data-ttu-id="493ed-122">Der Writer muss dann " [**idirectschreiterlock:: releaseschreiteaccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-releasewriteaccess) " aufrufen, um den Speicher freizugeben.</span><span class="sxs-lookup"><span data-stu-id="493ed-122">The writer must then call [**IDirectWriterLock::ReleaseWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-releasewriteaccess) to release the storage.</span></span>

<span data-ttu-id="493ed-123">Der Aufrufen von [**idirectwriterlock:: waitforwriteaccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) ist vor dem Schreiben in diesem Single Reader-, Multiple Writer-Modus erforderlich.</span><span class="sxs-lookup"><span data-stu-id="493ed-123">The call to [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) is required before writing in this single-reader, multiple-writer mode.</span></span> <span data-ttu-id="493ed-124">Versucht, in die Datei zu schreiben, ohne **idirectbeschreib terlock:: waitforschreiteaccess** zuerst aufrufen zu können \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="493ed-124">Attempts to write to the file without calling **IDirectWriterLock::WaitForWriteAccess** first result in STG\_E\_ACCESSDENIED.</span></span> <span data-ttu-id="493ed-125">Dieser Fehler wird auch dann zurückgegeben, wenn der Writer die Datei anfänglich geöffnet hat und derzeit keine Datei geöffnet ist.</span><span class="sxs-lookup"><span data-stu-id="493ed-125">This error is returned even if the writer opened the file initially, and no readers currently have the file open.</span></span>

## <a name="marshaling-considerations"></a><span data-ttu-id="493ed-126">Überlegungen zu Marshalling</span><span class="sxs-lookup"><span data-stu-id="493ed-126">Marshaling Considerations</span></span>

<span data-ttu-id="493ed-127">Das benutzerdefinierte Marshalling wird normalerweise verwendet, wenn eine Verbund Datei an einen anderen Prozess auf demselben Computer gemarshallt wird.</span><span class="sxs-lookup"><span data-stu-id="493ed-127">Custom marshaling is typically used when a compound file is marshaled to another process on the same machine.</span></span> <span data-ttu-id="493ed-128">Beim Marshalling von Speicher werden keine Zugriffsrechte berücksichtigt, und der [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) -Zeiger wird an den neuen Prozess mit denselben Zugriffs Modi und denselben Zugriffs Modi wie der ursprüngliche Marshallingprozess übermittelt.</span><span class="sxs-lookup"><span data-stu-id="493ed-128">When marshaling storages, access rights are not considered, and the [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) pointer is passed to the new process with the same access modes and rights as the original marshaling process.</span></span> <span data-ttu-id="493ed-129">Weitere Informationen zu Zugriffs Modi finden Sie unter [**STGM-Konstanten**](stgm-constants.md).</span><span class="sxs-lookup"><span data-stu-id="493ed-129">For more information about access modes, see [**STGM Constants**](stgm-constants.md).</span></span> <span data-ttu-id="493ed-130">Beim Marshalling werden keine Sperren erstellt oder überprüft, um exklusiven Schreibzugriff sicherzustellen.</span><span class="sxs-lookup"><span data-stu-id="493ed-130">During marshaling, no locks are taken or verified to ensure exclusive write access.</span></span> <span data-ttu-id="493ed-131">In diesem Fall gibt es keine Erzwingung der Richtlinie für den einzelnen Writer für Verbund Dateien, die im Single Writer-Modus (mehrfach Lese Modus) geöffnet sind.</span><span class="sxs-lookup"><span data-stu-id="493ed-131">In this case, there is no enforcement of the single-writer policy for compound files opened in the single-writer, multiple-reader mode.</span></span> <span data-ttu-id="493ed-132">Stattdessen wird die Erzwingung intern von der Implementierung der Verbund Datei verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="493ed-132">Instead, enforcement is handled internally by the compound file implementation.</span></span>

<span data-ttu-id="493ed-133">Da der [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) -Zeiger während des Marshalling an einen anderen Prozess übermittelt wird, kann es vorkommen, dass zwei Prozesse gleichzeitig auf dieselbe Verbund Datei zugreifen können.</span><span class="sxs-lookup"><span data-stu-id="493ed-133">Because the [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) pointer is passed to another process during marshaling, it is possible for two processes to have simultaneous access to the same compound file.</span></span> <span data-ttu-id="493ed-134">Obwohl ein Aufrufer exklusiven Schreibzugriff auf den Speicher erhalten hat, indem er [**idirectbeschreib terlock:: waitforschreiteaccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess)aufgerufen hat, kann die gemarshallte Version auch gleichzeitig Zugriff haben.</span><span class="sxs-lookup"><span data-stu-id="493ed-134">Even though a caller may have obtained exclusive write access to the storage by calling [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess), the marshaled version can also have access simultaneously.</span></span> <span data-ttu-id="493ed-135">Die gemarshallten Versionen müssen nicht geschlossen werden, während der einzelne Writer auf die Datei zugreift.</span><span class="sxs-lookup"><span data-stu-id="493ed-135">The marshaled versions are not forced to close while the single writer accesses the file.</span></span> <span data-ttu-id="493ed-136">In diesem Fall synchronisiert die Implementierung der Verbund Datei die Schreibvorgänge intern.</span><span class="sxs-lookup"><span data-stu-id="493ed-136">In this case, the compound file implementation synchronizes the writes internally.</span></span>

<span data-ttu-id="493ed-137">Wenn ein einzelner Writer exklusiven Zugriff erhält, indem er, [**idirectschreiterlock:: waitforschreiteaccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess)aufruft, verfügt der gemarshallte Speicher auch über Schreibzugriff und muss nicht **idirectschreiterlock:: waitforschreiteaccess** aufrufen.</span><span class="sxs-lookup"><span data-stu-id="493ed-137">If a single writer obtains exclusive access by calling, [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess), the marshaled storage also has write access and does not have to call **IDirectWriterLock::WaitForWriteAccess**.</span></span> <span data-ttu-id="493ed-138">Beide Prozesse haben Schreibzugriff, und die Synchronisierung wird von der internen Implementierung der Verbund Datei gesteuert.</span><span class="sxs-lookup"><span data-stu-id="493ed-138">Both processes have write access and synchronization is controlled by the internal compound file implementation.</span></span>

## <a name="related-topics"></a><span data-ttu-id="493ed-139">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="493ed-139">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="493ed-140">**Idirectschreiblock**</span><span class="sxs-lookup"><span data-stu-id="493ed-140">**IDirectWriterLock**</span></span>](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock)
</dt> </dl>

 

 




