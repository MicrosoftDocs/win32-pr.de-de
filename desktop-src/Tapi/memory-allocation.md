---
description: Anwendungen müssen für diese Daten Arbeitsspeicher zuweisen. TAPI und der Dienstanbieter stellen die Daten bereit. Wenn der Vorgang asynchron ist, sind die Daten erst verfügbar, wenn die asynchrone Antwortnachricht einen Erfolg angibt.
ms.assetid: 61313fe3-74a1-4195-b5af-37463dad02c1
title: Speicherzuweisung
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f192e34fdc652293c480277631c3839ecd2435fc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "106344237"
---
# <a name="memory-allocation"></a><span data-ttu-id="5253b-104">Speicherzuweisung</span><span class="sxs-lookup"><span data-stu-id="5253b-104">Memory Allocation</span></span>

<span data-ttu-id="5253b-105">Anwendungen müssen für diese Daten Arbeitsspeicher zuweisen. TAPI und der Dienstanbieter stellen die Daten bereit.</span><span class="sxs-lookup"><span data-stu-id="5253b-105">Applications must allocate memory for this data; TAPI and the service provider provide the data.</span></span> <span data-ttu-id="5253b-106">Wenn der Vorgang asynchron ist, sind die Daten erst verfügbar, wenn die asynchrone Antwortnachricht einen Erfolg angibt.</span><span class="sxs-lookup"><span data-stu-id="5253b-106">If the operation is asynchronous, the data is not available until the asynchronous reply message indicates success.</span></span>

<span data-ttu-id="5253b-107">Alle Datenstrukturen, die zum Übergeben von Daten zwischen der Anwendung und der TAPI *verwendet werden, werden vereinfacht.*</span><span class="sxs-lookup"><span data-stu-id="5253b-107">All data structures used to pass data between the application and the TAPI are *flattened*.</span></span> <span data-ttu-id="5253b-108">Das heißt, Datenstrukturen enthalten keine Zeiger auf Unterstrukturen, die Daten Komponenten variabler Größen enthalten.</span><span class="sxs-lookup"><span data-stu-id="5253b-108">That is, data structures do not contain pointers to substructures that contain variably sized data components.</span></span> <span data-ttu-id="5253b-109">Stattdessen müssen Datenstrukturen, die verwendet werden, um Variable Datenmengen an die Anwendung zurückzugeben, die folgende Metastruktur aufweisen:</span><span class="sxs-lookup"><span data-stu-id="5253b-109">Instead, data structures used to pass variable amounts of data back to the application must have the following metastructure:</span></span>

``` syntax
  DWORD  dwTotalSize;
  DWORD  dwNeededSize;
  DWORD  dwUsedSize; 
    <fixed size fields> 
  DWORD  dw<VarSizeField1>Size;
  DWORD  dw<VarSizeField1>Offset; 
    <fixed size fields> 
  DWORD  dw<VarSizeField2>Size;
  DWORD  dw<VarSizeField2>Offset; 
    <common extensions> 
    <var sized field1> 
    <var sized field2>
```

<span data-ttu-id="5253b-110">Der **dwtotalsize** -Member ist die Größe (in Bytes), die dieser Datenstruktur zugeordnet ist.</span><span class="sxs-lookup"><span data-stu-id="5253b-110">The **dwTotalSize** member is the size, in bytes, allocated to this data structure.</span></span> <span data-ttu-id="5253b-111">Sie markiert das Ende der Datenstruktur und wird von der Anwendung festgelegt, bevor die Funktion aufgerufen wird, die diese Datenstruktur verwendet.</span><span class="sxs-lookup"><span data-stu-id="5253b-111">It marks the end of the data structure and is set by the application before it invokes the function that uses this data structure.</span></span> <span data-ttu-id="5253b-112">Die Funktion liest oder schreibt nicht über diese Größe hinaus.</span><span class="sxs-lookup"><span data-stu-id="5253b-112">The function does not read or write beyond this size.</span></span> <span data-ttu-id="5253b-113">Eine Anwendung muss den **dwtotalsize** -Member so festlegen, dass die Gesamtzahl der Bytes angegeben wird, die TAPI für die Rückgabe des Inhalts der Struktur zugeordnet ist.</span><span class="sxs-lookup"><span data-stu-id="5253b-113">An application must set the **dwTotalSize** member to indicate the total number of bytes allocated for TAPI to return the contents of the structure.</span></span>

<span data-ttu-id="5253b-114">TAPI füllt den **dwneeddsize** -Member aus.</span><span class="sxs-lookup"><span data-stu-id="5253b-114">TAPI fills in the **dwNeededSize** member.</span></span> <span data-ttu-id="5253b-115">Gibt an, wie viele Bytes erforderlich sind, um alle angeforderten Daten zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="5253b-115">It indicates how many bytes are required to return all the requested data.</span></span> <span data-ttu-id="5253b-116">Das vorhanden sein von Feldern mit variabler Größe macht es für die Anwendung oft unmöglich, die für die Zuteilung erforderliche Datenstruktur einzuschätzen.</span><span class="sxs-lookup"><span data-stu-id="5253b-116">The existence of variably sized fields often makes it impossible for the application to estimate the data structure size required to allocate.</span></span> <span data-ttu-id="5253b-117">Dieses Feld gibt die Anzahl der Bytes zurück, die tatsächlich für die Daten erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="5253b-117">This field returns the number of bytes actually required for the data.</span></span> <span data-ttu-id="5253b-118">Diese Zahl kann kleiner, gleich oder größer als **dwtotalsize** sein, und Sie enthält Platz für den **dwtotalsize** -Member selbst.</span><span class="sxs-lookup"><span data-stu-id="5253b-118">This number could be smaller than, equal to, or larger than **dwTotalSize**, and it includes space for the **dwTotalSize** member itself.</span></span> <span data-ttu-id="5253b-119">Wenn der Wert größer ist, wird die zurückgegebene Struktur nur teilweise ausgefüllt.</span><span class="sxs-lookup"><span data-stu-id="5253b-119">If larger, the returned structure is only partially filled.</span></span> <span data-ttu-id="5253b-120">Wenn die von der Anwendung benötigten Felder in der Teilstruktur verfügbar sind, muss nichts anderes ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="5253b-120">If the fields the application requires are available in the partial structure, nothing else must be done.</span></span> <span data-ttu-id="5253b-121">Andernfalls sollte die Anwendung eine Struktur mindestens der Größe von **dwneeundsize** zuordnen und die Funktion erneut aufrufen.</span><span class="sxs-lookup"><span data-stu-id="5253b-121">Otherwise, the application should allocate a structure at least the size of **dwNeededSize** and invoke the function again.</span></span> <span data-ttu-id="5253b-122">In der Regel ist ausreichend Speicherplatz verfügbar, um alle Informationen zurückzugeben, obwohl es möglich ist, dass sich die Größe nochmals erhöhen könnte.</span><span class="sxs-lookup"><span data-stu-id="5253b-122">Usually, enough space is available this time to return all the information, although it is possible the size could have increased again.</span></span>

<span data-ttu-id="5253b-123">TAPI füllt den **dwusedsize** -Member aus, wenn er Daten an die Anwendung zurückgibt, um die tatsächliche Größe (in Bytes) des Teils der Datenstruktur anzugeben, die nützliche Daten enthält.</span><span class="sxs-lookup"><span data-stu-id="5253b-123">TAPI fills the **dwUsedSize** member if it returns data to the application to indicate the actual size, in bytes, of the portion of the data structure that contains useful data.</span></span> <span data-ttu-id="5253b-124">Wenn z. b. eine zugeordnete Struktur zu klein war und das abgeschnittene Feld ein Feld mit variabler Größe ist, ist **dwneededsize** größer als **dwtotalsize**, und das gekürzte Feld bleibt leer.</span><span class="sxs-lookup"><span data-stu-id="5253b-124">If, for example, a structure that was allocated was too small and the truncated field is a variably sized field, **dwNeededSize** is larger than **dwTotalSize**, and the truncated field is left empty.</span></span> <span data-ttu-id="5253b-125">Der **dwusedsize** -Member könnte daher kleiner als **dwtotalsize** sein.</span><span class="sxs-lookup"><span data-stu-id="5253b-125">The **dwUsedSize** member could therefore be smaller than **dwTotalSize**.</span></span> <span data-ttu-id="5253b-126">Partielle Feldwerte werden nicht zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="5253b-126">Partial field values are not returned.</span></span>

<span data-ttu-id="5253b-127">Das Befolgen dieses Headers ist der fixierte Teil der Datenstruktur.</span><span class="sxs-lookup"><span data-stu-id="5253b-127">Following this header is the fixed part of the data structure.</span></span> <span data-ttu-id="5253b-128">Sie enthält reguläre Felder und Größe/Offset-Paare, die die eigentlichen Felder mit variabler Größe beschreiben.</span><span class="sxs-lookup"><span data-stu-id="5253b-128">It contains regular fields and size/offset pairs that describe the actual variably sized fields.</span></span> <span data-ttu-id="5253b-129">Das Offset-Feld enthält den Offset des Felds mit variabler Größe vom Anfang des Datensatzes in Byte.</span><span class="sxs-lookup"><span data-stu-id="5253b-129">The offset field contains the offset in bytes of the variably sized field from the beginning of the record.</span></span> <span data-ttu-id="5253b-130">Das Größen Feld enthält die Größe des Felds mit variabler Größe in Byte.</span><span class="sxs-lookup"><span data-stu-id="5253b-130">The size field contains the size in bytes of the variably sized field.</span></span> <span data-ttu-id="5253b-131">Wenn ein Feld mit variabler Größe leer ist, ist das Größen Feld NULL, und der Offset wird auf 0 (null) festgelegt.</span><span class="sxs-lookup"><span data-stu-id="5253b-131">If a variably sized field is empty, then the size field is zero and the offset is set to zero.</span></span> <span data-ttu-id="5253b-132">Felder mit variabler Größe, die abgeschnitten werden, wenn die Gesamtstruktur Größe unzureichend ist, werden leer gelassen.</span><span class="sxs-lookup"><span data-stu-id="5253b-132">Variably sized fields that would be truncated if the total structure size is insufficient are left empty.</span></span> <span data-ttu-id="5253b-133">Das heißt, das Größen Feld ist auf NULL festgelegt, und der Offset wird auf 0 (null) festgelegt.</span><span class="sxs-lookup"><span data-stu-id="5253b-133">That is, their size field is set to zero and the offset is set to zero.</span></span> <span data-ttu-id="5253b-134">Die Felder mit variabler Größe folgen den Fixed-Feldern.</span><span class="sxs-lookup"><span data-stu-id="5253b-134">The variably sized fields follow the fixed fields.</span></span>

<span data-ttu-id="5253b-135">Wenn der Dienstanbieter ein Variablenmember ausfüllen muss, initialisiert TAPI die entsprechenden Größen-und Offset Elemente auf 0 (null).</span><span class="sxs-lookup"><span data-stu-id="5253b-135">If the service provider must fill a variable member, TAPI initializes the corresponding size and offset members to zero.</span></span> <span data-ttu-id="5253b-136">Wenn der Dienstanbieter den Variablenmember füllt, muss er die entsprechenden Größen-und Offset Elemente auf entsprechende Werte festlegen, einschließlich **dwusedsize** und **dwneededsize** , wenn Variablen Elemente festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="5253b-136">If the service provider fills in the variable member, it must set the corresponding size and offset members to appropriate values, including **dwUsedSize** and **dwNeededSize** if it sets variable members.</span></span> <span data-ttu-id="5253b-137">Der Dienstanbieter darf einen Variablen Member nicht abschneiden, damit er in den verfügbaren Speicherplatz passt.</span><span class="sxs-lookup"><span data-stu-id="5253b-137">The service provider must not truncate a variable member to make it fit into the available space.</span></span>

<span data-ttu-id="5253b-138">Der Dienstanbieter muss Variablen Elemente unmittelbar nach den fixierten Membern der Struktur starten und zusätzlichen Speicherplatz am Ende des zugeordneten Arbeitsspeichers belassen, damit TAPI ihn für die Member variabler Länge verwenden kann.</span><span class="sxs-lookup"><span data-stu-id="5253b-138">The service provider must start variable members immediately after the fixed members of the structure, and leave any extra space at the end of the allocated memory so that TAPI can use it for the variable-length members.</span></span> <span data-ttu-id="5253b-139">Die Variablen Elemente können in beliebiger Reihenfolge platziert werden, aber die Elemente müssen zusammenhängend sein.</span><span class="sxs-lookup"><span data-stu-id="5253b-139">It can place the variable members in any order, but the members must be contiguous.</span></span>

 

 



