---
description: Im folgenden Verfahren wird beschrieben, wie ein MSP mithilfe von ATL-Version 2,1 oder ATL-Version 3,0 und den MSP-Basisklassen implementiert wird.
ms.assetid: 7485c34a-3c8a-412f-9cb9-8eb895084292
title: Verwenden der TAPI 3-MSP-Basisklassen
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: eb8ad4fd160cf0fc4c7dd682a44f3a4ff0bcec25
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "106352744"
---
# <a name="using-the-tapi-3-msp-base-classes"></a><span data-ttu-id="2291e-103">Verwenden der TAPI 3-MSP-Basisklassen</span><span class="sxs-lookup"><span data-stu-id="2291e-103">Using The TAPI 3 MSP Base Classes</span></span>

<span data-ttu-id="2291e-104">Im folgenden Verfahren wird beschrieben, wie ein MSP mithilfe von ATL-Version 2,1 oder ATL-Version 3,0 und den MSP-Basisklassen implementiert wird.</span><span class="sxs-lookup"><span data-stu-id="2291e-104">The following procedure describes how to implement an MSP using ATL version 2.1 or ATL version 3.0 and the MSP base classes.</span></span> <span data-ttu-id="2291e-105">Weitere Informationen und eine Liste von Bibliotheken und Headern finden Sie unter [TAPI 3 MSP-Basisklassen](tapi-3-msp-base-classes.md).</span><span class="sxs-lookup"><span data-stu-id="2291e-105">For more information and a list of libraries and headers, see [TAPI 3 MSP Base Classes](tapi-3-msp-base-classes.md).</span></span> <span data-ttu-id="2291e-106">Der in diesem Thema enthaltene Inhalt setzt voraus, dass der Entwickler über ein funktionierendes Verständnis von ATL und com verfügt und über Erfahrung mit der Implementierung von COM-DLLs mithilfe von ATL verfügt.</span><span class="sxs-lookup"><span data-stu-id="2291e-106">The content contained in this topic assumes that the developer has a working understanding of ATL and COM, and has experience implementing COM DLLs using ATL.</span></span>

<span data-ttu-id="2291e-107">**So implementieren Sie und MSP mithilfe von ATL 2,1 oder ATL 3,0**</span><span class="sxs-lookup"><span data-stu-id="2291e-107">**To implement and MSP using ATL 2.1 or ATL 3.0**</span></span>

1.  <span data-ttu-id="2291e-108">Erstellen Sie eine IDL-Datei für Ihren MSP.</span><span class="sxs-lookup"><span data-stu-id="2291e-108">Create an IDL file for your MSP.</span></span> <span data-ttu-id="2291e-109">Diese Datei definiert eine CLSID für Ihren MSP.</span><span class="sxs-lookup"><span data-stu-id="2291e-109">This file defines a CLSID for your MSP.</span></span> <span data-ttu-id="2291e-110">Deklarieren Sie Ihre msp-"Co-Klasse" als Implementierung der [**itmspaddress**](/windows/desktop/api/msp/nn-msp-itmspaddress) -Schnittstelle, und deklarieren Sie diese Schnittstelle als Standardschnittstelle für Ihr Klassenobjekt.</span><span class="sxs-lookup"><span data-stu-id="2291e-110">Declare your MSP "coclass" as implementing the [**ITMSPAddress**](/windows/desktop/api/msp/nn-msp-itmspaddress) interface, and declare this interface as the default interface on your class object.</span></span> <span data-ttu-id="2291e-111">Importieren Sie die Datei "MSP. idl" für die Definition von **itmspaddress**.</span><span class="sxs-lookup"><span data-stu-id="2291e-111">For the definition of **ITMSPAddress**, import the file "msp.idl".</span></span> <span data-ttu-id="2291e-112">Fügen Sie Ihre msp-"Co-Klasse" in eine Typbibliothek für Ihr MSP ein.</span><span class="sxs-lookup"><span data-stu-id="2291e-112">Include your MSP "coclass" in a type library for your MSP.</span></span> <span data-ttu-id="2291e-113">Wenn Ihr MSP private (benutzerdefinierte) Schnittstellen unterstützt, definieren Sie Sie hier, und fügen Sie Sie in die Typbibliothek ein.</span><span class="sxs-lookup"><span data-stu-id="2291e-113">If your MSP supports private (custom) interfaces, define them here and include them in your type library.</span></span> <span data-ttu-id="2291e-114">Das folgende Codebeispiel ist eine IDL-Datei, wie oben beschrieben, ohne benutzerdefinierte Schnittstellen.</span><span class="sxs-lookup"><span data-stu-id="2291e-114">The following code example is an IDL file as described above, without custom interfaces.</span></span>

    ``` syntax
    import "msp.idl";
    [
          uuid(4DDB6D35-3BC1-11d2-86F2-006008B0E5D2),
          version(2.0),
          helpstring("Wave MSP 2.0 Type Library")
    ]
    library WAVEMSPLib
    {
    importlib("stdole32.tlb");
    importlib("stdole2.tlb");

    [
    uuid(4DDB6D36-3BC1-11d2-86F2-006008B0E5D2),
    helpstring("Wave MSP Class")
    ]
    coclass WaveMSP
    {
    [default] interface ITMSPAddress;
    };
    };
    ```

2.  <span data-ttu-id="2291e-115">Ändern Sie den TSP so, dass die CLSID Ihres MSP angekündigt wird, wenn Tapi3.dll ihn anfordert.</span><span class="sxs-lookup"><span data-stu-id="2291e-115">Modify your TSP to advertise the CLSID of your MSP when Tapi3.dll requests it.</span></span> <span data-ttu-id="2291e-116">Stellen Sie sicher, dass (1) Ihr TSP TAPI \_ VERSION3 \_ 0 oder höher in der TSPI-Funktion [**TSPI \_ linenegotiatetspiversion**](/windows/win32/api/tspi/nf-tspi-tspi_linenegotiatetspiversion)aushandeln kann, (2) für die TSP- [**linedevcaps**](/windows/win32/api/tapi/ns-tapi-linedevcaps) -Struktur ist das linedevcapflags- \_ MSP-Flag im **dwdevcapflags** -Member festgelegt, und (3) Ihr TSP gibt Ihre MSP-CLSID in der TSPI-Funktion [**TSPI \_ linemspidentify**](/windows/win32/api/tspi/nf-tspi-tspi_linemspidentify)zurück.</span><span class="sxs-lookup"><span data-stu-id="2291e-116">Ensure that (1) your TSP can negotiate TAPI\_VERSION3\_0 or higher in the TSPI function [**TSPI\_lineNegotiateTSPIVersion**](/windows/win32/api/tspi/nf-tspi-tspi_linenegotiatetspiversion), (2) your TSP [**LINEDEVCAPS**](/windows/win32/api/tapi/ns-tapi-linedevcaps) structure has the LINEDEVCAPFLAGS\_MSP flag set in the **dwDevCapFlags** member, and (3) your TSP returns your MSP CLSID in the TSPI function [**TSPI\_lineMSPIdentify**](/windows/win32/api/tspi/nf-tspi-tspi_linemspidentify).</span></span> <span data-ttu-id="2291e-117">Dies sollte die gleiche CLSID sein, die in ihrer IDL-Datei angegeben ist. beispielsweise die zweite Zeile "uuid" in der Beispiel-IDL-Datei im vorherigen Schritt.</span><span class="sxs-lookup"><span data-stu-id="2291e-117">This should be the same CLSID specified in your IDL file; for example, the second "uuid" line in the example IDL file in the previous step.</span></span>
3.  <span data-ttu-id="2291e-118">Kompilieren Sie die mspbase-Beispielanwendung, die sich im Platform Software Development Kit (SDK) befindet, um die mspbasesample. lib-Bibliothek zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="2291e-118">Compile the MSPBase sample application, located in the Platform Software Development Kit (SDK), to create the MSPBaseSample.lib library.</span></span>
4.  <span data-ttu-id="2291e-119">Verknüpfen Sie Ihre MSP-dll mit der mspbasesample. lib-Bibliothek.</span><span class="sxs-lookup"><span data-stu-id="2291e-119">Link your MSP DLL with the MSPBaseSample.lib library.</span></span>
5.  <span data-ttu-id="2291e-120">Fügen Sie mspbase. h aus dem SDK für MSP-Basisklassen Definitionen ein.</span><span class="sxs-lookup"><span data-stu-id="2291e-120">Include Mspbase.h from the SDK for MSP base class definitions.</span></span>
6.  <span data-ttu-id="2291e-121">Implementieren Sie Ihre DLL-Exporte (z. b. DllMain).</span><span class="sxs-lookup"><span data-stu-id="2291e-121">Implement your DLL exports (for example, DllMain).</span></span> <span data-ttu-id="2291e-122">Microsoft Visual C++ werden diese für Sie generieren.</span><span class="sxs-lookup"><span data-stu-id="2291e-122">Microsoft Visual C++ will generate these for you.</span></span> <span data-ttu-id="2291e-123">Verwenden Sie in DllMain unter \_ dll \_ -Prozess anfügen und dll- \_ Prozess \_ trennen die Makros **msplogregister** und **msplogderegister** , um die Protokollierungsfunktionen für die dll zu aktivieren.</span><span class="sxs-lookup"><span data-stu-id="2291e-123">In DllMain, on DLL\_PROCESS\_ATTACH and DLL\_PROCESS\_DETACH, respectively, use the **MSPLOGREGISTER** and **MSPLOGDEREGISTER** macros to enable up logging features for your DLL.</span></span> <span data-ttu-id="2291e-124">Geben Sie den Namen der dll im **msplogderegiester** -Befehl an.</span><span class="sxs-lookup"><span data-stu-id="2291e-124">Specify the name of your DLL in the **MSPLOGDEREGISTER** call.</span></span>
7.  <span data-ttu-id="2291e-125">Verwenden Sie das in msplog. h definierte Log-Makro, um Ablauf Verfolgungs Meldungen auf die gleiche Weise wie die Basisklassen auszugeben.</span><span class="sxs-lookup"><span data-stu-id="2291e-125">Use the LOG macro, defined in Msplog.h, to output trace messages in the same fashion as the base classes.</span></span> <span data-ttu-id="2291e-126">Definieren Sie das msplog-Präprozessorsymbol, um die Protokollierung in die dll einzubeziehen. lassen Sie es nicht definiert, um eine DLL zu erstellen, die keine Protokollierung enthält.</span><span class="sxs-lookup"><span data-stu-id="2291e-126">Define the MSPLOG preprocessor symbol to include logging in your DLL; leave it undefined to build a DLL that does not have logging.</span></span>
8.  <span data-ttu-id="2291e-127">Leiten Sie eine Klasse von cmspaddress ab, die Adressen für Ihr MSP implementiert.</span><span class="sxs-lookup"><span data-stu-id="2291e-127">Derive a class from CMSPAddress that implements addresses for your MSP.</span></span> <span data-ttu-id="2291e-128">Deklarieren Sie eine globale ATL-Objekt Zuordnung, die ATL anweist, eine Instanz Ihrer Address-Klasse zu erstellen, wenn Sie zu **CoCreate** für die CLSID aufgefordert werden, die Sie in ihrer IDL-Datei angegeben haben.</span><span class="sxs-lookup"><span data-stu-id="2291e-128">Declare a global ATL object map which instructs ATL to create an instance of your address class when asked to **CoCreate** on the CLSID you specified in your IDL file.</span></span> <span data-ttu-id="2291e-129">Leiten Sie außerdem Ihre Address-Klasse aus der ATL- **CComCoClass** -Vorlage ab, und fügen Sie \_ \_ in ihrer Address-Klasse eine Deklaration der ResourceId-Deklaration ein.</span><span class="sxs-lookup"><span data-stu-id="2291e-129">Also, derive your address class from the ATL **CComCoClass** template, and include a DECLARE\_REGISTRY\_RESOURCEID declaration in your address class.</span></span> <span data-ttu-id="2291e-130">Erstellen Sie ein entsprechendes Ressourcen Skript und eine Header Datei, wie für jede andere ATL-COM-DLL.</span><span class="sxs-lookup"><span data-stu-id="2291e-130">Construct a corresponding resource script and header file, as for any other ATL COM DLL.</span></span>
9.  <span data-ttu-id="2291e-131">Implementieren Sie die erforderlichen cmspaddress-über Schreibungen für Ihre Address-Klasse.</span><span class="sxs-lookup"><span data-stu-id="2291e-131">Implement the required CMSPAddress overrides for your address class.</span></span> <span data-ttu-id="2291e-132">Für [**mspaddressaddressf**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-mspaddressaddref) und [**mspaddressrelease**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-mspaddressrelease)müssen Sie die bereitgestellten hilfsfunktions Vorlagen aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="2291e-132">For [**MSPAddressAddRef**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-mspaddressaddref) and [**MSPAddressRelease**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-mspaddressrelease), call the provided helper function templates.</span></span> <span data-ttu-id="2291e-133">Geben Sie für " [**getcallmediatypes**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-getcallmediatypes)" einfach eine **DWORD** -Bitmap mit allen MSP-unterstützten tapimediamodes "ORed" zurück.</span><span class="sxs-lookup"><span data-stu-id="2291e-133">For [**GetCallMediaTypes**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-getcallmediatypes), simply return a **DWORD** bitmap with all of your MSP-supported TAPIMEDIAMODEs ORed together.</span></span> <span data-ttu-id="2291e-134">Geben Sie für " [**comatemspcallcenter**](/windows/desktop/api/msp/nf-msp-itmspaddress-createmspcall) " und " [**shutdownmspcallcenter**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdownmspcall)" \_ den Wert E notimpl ein, und kompilieren und verknüpfen Sie den MSP zu diesem Zeitpunkt.</span><span class="sxs-lookup"><span data-stu-id="2291e-134">For [**CreateMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-createmspcall) and [**ShutdownMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdownmspcall), return E\_NOTIMPL and compile and link your MSP at this point.</span></span> <span data-ttu-id="2291e-135">Stellen Sie jetzt sicher, dass Sie Ihr MSP von TAPI 3-Anwendungen registrieren und instanziieren, aber keine Aufrufe erfolgreich erstellen können.</span><span class="sxs-lookup"><span data-stu-id="2291e-135">Now, verify that you can register and instantiate your MSP from TAPI 3 applications, but not successfully create calls.</span></span>
10. <span data-ttu-id="2291e-136">Leiten Sie eine Klasse von cmspcallmultigraph ab, um Ihre MSP-Aufruf Objekte zu implementieren.</span><span class="sxs-lookup"><span data-stu-id="2291e-136">Derive a class from CMSPCallMultiGraph to implement your MSP call objects.</span></span> <span data-ttu-id="2291e-137">Möglicherweise möchten Sie von [**cmspcallbase**](/windows/desktop/api/Mspcall/nl-mspcall-cmspcallbase) anstelle von [**cmspcallmultigraph**](/windows/desktop/api/Mspcall/nl-mspcall-cmspcallmultigraph) ableiten, wenn das Filter-Graph-pro-Stream-Modell nicht Ihren Anforderungen entspricht. Dadurch wird die Komplexität der Aufgabe erhöht (zum Zeitpunkt der Erstellung dieses Artikels leiten alle MSPs Aufruf Objekte direkt von **cmspcallmultigraph** ab).</span><span class="sxs-lookup"><span data-stu-id="2291e-137">You may want to derive from [**CMSPCallBase**](/windows/desktop/api/Mspcall/nl-mspcall-cmspcallbase) instead of [**CMSPCallMultiGraph**](/windows/desktop/api/Mspcall/nl-mspcall-cmspcallmultigraph) if the filter-graph-per-stream model does not fit your requirements; this will increase the complexity of the task (as of this writing, all MSPs derive call objects directly from **CMSPCallMultiGraph**).</span></span> <span data-ttu-id="2291e-138">Implementieren Sie in Ihrem Adress Objekt " [**anatemspcall"**](/windows/desktop/api/msp/nf-msp-itmspaddress-createmspcall) und " [**shutdownmspcall"**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdownmspcall) , um Ihren spezifischen Typ von "callobject" mithilfe der bereitgestellten hilfsfunktions Vorlagen zu erstellen und zu beenden.</span><span class="sxs-lookup"><span data-stu-id="2291e-138">In your address object, implement [**CreateMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-createmspcall) and [**ShutdownMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdownmspcall) to create and shut down your specific type of call object using the provided helper function templates.</span></span> <span data-ttu-id="2291e-139">Überschreiben Sie in Ihrem "Callcenter"-Objekt " [**", um**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-createstreamobject) "E \_ notimpl" zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="2291e-139">In your call object, override [**CreateStreamObject**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-createstreamobject) to return E\_NOTIMPL.</span></span> <span data-ttu-id="2291e-140">Überschreiben Sie [**mspcalladressf**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-mspcalladdref) und [**mspcallrelease**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-mspcallrelease) auf eine Weise, die mit den entsprechenden Adress Methoden identisch ist.</span><span class="sxs-lookup"><span data-stu-id="2291e-140">Override [**MSPCallAddRef**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-mspcalladdref) and [**MSPCallRelease**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-mspcallrelease) in a manner identical to the corresponding address methods.</span></span> <span data-ttu-id="2291e-141">Auch hier sollten Sie in der Lage sein, ihren MSP zu kompilieren und zu verknüpfen. Er sollte nun in der Lage sein, Aufrufe zu erstellen und herunterzufahren, aber die Aufrufe führen kein nützliches Streaming aus.</span><span class="sxs-lookup"><span data-stu-id="2291e-141">Again, you should be able to compile and link your MSP; it should now be able to create and shut down calls, but the calls will not do any useful streaming.</span></span>
11. <span data-ttu-id="2291e-142">Leiten Sie eine Klasse von cmspstream ab, um Ihre MSP-Streamobjekte zu implementieren.</span><span class="sxs-lookup"><span data-stu-id="2291e-142">Derive a class from CMSPStream to implement your MSP stream objects.</span></span> <span data-ttu-id="2291e-143">Implementieren Sie in Ihrem Call-Objekt [**createstreamobject**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-createstreamobject) , um das Streamobjekt zu erstellen und zu initialisieren (in der Regel durch Aufrufen der ATL **CreateInstance** , gefolgt von der ATL **\_ InternalQueryInterface** für [**itstream**](/windows/win32/api/tapi3if/nn-tapi3if-itstream) , gefolgt vom Aufruf von **Init** für das Stream-Objekt).</span><span class="sxs-lookup"><span data-stu-id="2291e-143">In your call object, implement [**CreateStreamObject**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-createstreamobject) to create and initialize your stream object (typically by calling the ATL **CreateInstance** followed by the ATL **\_InternalQueryInterface** for [**ITStream**](/windows/win32/api/tapi3if/nn-tapi3if-itstream) followed by calling **Init** on your stream object).</span></span> <span data-ttu-id="2291e-144">Um eine festgelegte Anzahl von Streams zu unterstützen (Dies ist bei MSPs üblich, die keine Änderungen der streamkonfigurationen durch andere Endpunkte im-Befehl unterstützen), überschreiben Sie **Init**, " [**kreatestream**](/windows/win32/api/tapi3if/nf-tapi3if-itstreamcontrol-createstream)" und " [**removestream**](/windows/win32/api/tapi3if/nf-tapi3if-itstreamcontrol-removestream) " in Ihrem calltobjekt.</span><span class="sxs-lookup"><span data-stu-id="2291e-144">To support a fixed number of streams (this is common for MSPs which do not support modification of stream configurations by other endpoints on the call), override **Init**, [**CreateStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstreamcontrol-createstream), and [**RemoveStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstreamcontrol-removestream) on your call object.</span></span> <span data-ttu-id="2291e-145">(Der Befehl " **Init** " erstellt zunächst alle ihre Streams, und " **anatestream** " und " **removestream** " geben die entsprechenden TAPI-Fehlercodes zurück, um zu verhindern, dass die Anwendung Streams erstellt oder entfernt).</span><span class="sxs-lookup"><span data-stu-id="2291e-145">(The call **Init** creates all of your streams initially, and **CreateStream** and **RemoveStream** return the appropriate TAPI error codes to prevent the application from creating or removing streams).</span></span> <span data-ttu-id="2291e-146">Überschreiben Sie andernfalls die **Init** -Methode des Aufrufes, um eine anfängliche Standardkonfiguration von Streams mithilfe der für den-Befehl angeforderten Medientypen zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="2291e-146">Otherwise, override the call's **Init** method to create some initial default configuration of streams using the media types requested for the call.</span></span> <span data-ttu-id="2291e-147">Wenn Sie in der **Init** -Methode Ihres Aufrufes die standardmäßigen Streamobjekte erstellen, verwenden Sie die Hilfsmethode [**internalkreatestream**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-internalcreatestream) .</span><span class="sxs-lookup"><span data-stu-id="2291e-147">When creating any default stream objects in your call's **Init** method, use the [**InternalCreateStream**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-internalcreatestream) helper method.</span></span>
12. <span data-ttu-id="2291e-148">Implementieren Sie das Stream-Objekt.</span><span class="sxs-lookup"><span data-stu-id="2291e-148">Implement your stream object.</span></span> <span data-ttu-id="2291e-149">Die einzige erforderliche außer Kraft Setzung ist die [**get \_ Name**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-get_name) -Methode, die einen anzeigen Amen für den Datenstrom zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="2291e-149">The only required override is the [**get\_Name**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-get_name) method, which simply returns a friendly name for the stream.</span></span> <span data-ttu-id="2291e-150">Außerdem müssen Sie mehrere andere Methoden außer Kraft setzen.</span><span class="sxs-lookup"><span data-stu-id="2291e-150">In addition, you will need to override several other methods.</span></span> <span data-ttu-id="2291e-151">Welche Methoden außer Kraft gesetzt werden müssen, hängt von ihrer Implementierung und von der Ausführung der verschiedenen Aufgaben ab, die beim Erstellen und dekonstruieren des Filter Diagramms beteiligt sind.</span><span class="sxs-lookup"><span data-stu-id="2291e-151">Exactly which methods to override depends on your implementation and when you decide to perform the various tasks involved in constructing and deconstructing your filter graph.</span></span> <span data-ttu-id="2291e-152">Zu diesen Aufgaben gehören das Erstellen der entsprechenden Transport Filter, Codecs usw. und das Einfügen und Entfernen der Filter Diagramme zu den entsprechenden Zeitpunkten.</span><span class="sxs-lookup"><span data-stu-id="2291e-152">These tasks include creating the appropriate "transport" filters, codecs, and so on, and inserting them and removing them from the filter graphs at the appropriate times.</span></span> <span data-ttu-id="2291e-153">Sie müssen auch die [**itterminalcontrol**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol) -Schnittstelle für Terminal Objekte verwenden, um die ausgewählten Terminals mit ihren Streams zu verbinden.</span><span class="sxs-lookup"><span data-stu-id="2291e-153">You will also have to use the [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol) interface on terminal objects to connect the selected terminals to your streams.</span></span> <span data-ttu-id="2291e-154">Möglicherweise möchten Sie [**selectterminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal) und [**unselectterminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) für das Datenstrom Objekt überschreiben, um die Terminal Konfigurationen einzuschränken, die ihre Streams akzeptieren werden. Wenn Sie die einzelnen Datenströme auf ein einzelnes Terminal beschränken, wird die Erstellung Ihrer Filter Diagramme besonders vereinfacht, aber die Anwendungs Funktionalität wird durch die Video Vorschau geopfert.</span><span class="sxs-lookup"><span data-stu-id="2291e-154">You may want to override [**SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal) and [**UnselectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) on your stream object to limit the terminal configurations that your streams will accept; limiting each stream to a single terminal will especially simplify construction of your filter graphs, but will sacrifice application functionality such as video preview.</span></span> <span data-ttu-id="2291e-155">Abhängig von ihrer Implementierung platzieren Sie den diagrammkonstruktions-, Dekonstruktions-und Terminal Verbindungs Code in den Methoden [**startstream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-startstream), [**stopstream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-stopstream), [**pausestream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-pausestream), [**Initialize**](/windows/desktop/api/msp/nf-msp-itmspaddress-initialize), [**Shutdown**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdown), [**selectterminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal)und [**unselectterminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) oder in ihren eigenen Methoden auf der Grundlage privater TSP-Kommunikation.</span><span class="sxs-lookup"><span data-stu-id="2291e-155">Depending on your implementation, you will place your graph construction, deconstruction, and terminal connection code in the [**StartStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-startstream), [**StopStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-stopstream), [**PauseStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-pausestream), [**Initialize**](/windows/desktop/api/msp/nf-msp-itmspaddress-initialize), [**Shutdown**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdown), [**SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal), and [**UnselectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) methods, or in your own methods based on private TSP communication.</span></span> <span data-ttu-id="2291e-156">Beachten Sie, dass ein Datenstrom ohne ausgewählte Terminals den gewünschten Diagramm Zustand nachverfolgen muss. ein **startstream** -Befehl, gefolgt von einem **selectterminal** -Befehl für einen solchen Stream, muss einen Datenstream ergeben.</span><span class="sxs-lookup"><span data-stu-id="2291e-156">Be aware that a stream with no terminals selected must track the desired graph state; a **StartStream** call followed by a **SelectTerminal** call on such a stream must result in a data stream.</span></span> <span data-ttu-id="2291e-157">Überschreiben Sie die meisten dieser Methoden, um sicherzustellen, dass die korrekte Erstellung, Dekonstruktion, Verbindung und Trennung in jedem Fall abhängig vom Status des Streams erfolgt.</span><span class="sxs-lookup"><span data-stu-id="2291e-157">Override most of these methods to ensure that the correct construction, deconstruction, connection, and disconnection happens in each case depending on the state of the stream.</span></span>
13. <span data-ttu-id="2291e-158">Implementieren Sie die TSP-Kommunikation.</span><span class="sxs-lookup"><span data-stu-id="2291e-158">Implement your TSP communication.</span></span> <span data-ttu-id="2291e-159">Überschreiben Sie [**cmspaddress:: receivetspaddressdata**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-receivetspaddressdata) und/oder [**cmspcallbase:: receivetspcalldata**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-receivetspcalldata), und/oder indem Sie " [**postEvent**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-postevent) " für Ihr Adress Objekt aufrufen, oder " [**handstreamevent**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-handlestreamevent) " für das Call-Objekt (entweder aus den Call-oder Streamobjekten).</span><span class="sxs-lookup"><span data-stu-id="2291e-159">Override [**CMSPAddress::ReceiveTSPAddressData**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-receivetspaddressdata) and/or [**CMSPCallBase::ReceiveTSPCallData**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-receivetspcalldata), and/or by calling [**PostEvent**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-postevent) on your address object, or [**HandleStreamEvent**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-handlestreamevent) on your call object (from either your call or stream objects).</span></span>
14. <span data-ttu-id="2291e-160">Verwenden Sie "postEvent" für Ihr Adress Objekt oder "handstreamevent" für Ihr calltobjekt (aus den aufrufen-oder Streamobjekten), um über Tapi3.dll Ereignisse für das Aufrufen von Medien an die Anwendung zu senden.</span><span class="sxs-lookup"><span data-stu-id="2291e-160">Use PostEvent on your address object, or HandleStreamEvent on your call object (from either your call or stream objects) to send call media events to the application via Tapi3.dll.</span></span> <span data-ttu-id="2291e-161">Dies erfolgt in der Regel für das Datenstrom Objekt in überschriebenen Methoden, einschließlich der Methoden [**processgraphevent**](/windows/desktop/api/Mspstrm/nf-mspstrm-cmspstream-processgraphevent), [**stopstream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-stopstream), [**startstream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-startstream), [**pausestream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-pausestream), [**selectterminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal)und [**unselectterminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) , je nachdem, wie Sie Ihre Streams implementieren.</span><span class="sxs-lookup"><span data-stu-id="2291e-161">You will typically do this on your stream object, in overridden methods including the [**ProcessGraphEvent**](/windows/desktop/api/Mspstrm/nf-mspstrm-cmspstream-processgraphevent), [**StopStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-stopstream), [**StartStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-startstream), [**PauseStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-pausestream), [**SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal), and [**UnselectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) methods, depending on how you implement your streams.</span></span>
15. <span data-ttu-id="2291e-162">Implementieren Sie alle gewünschten privaten Schnittstellen oder untergeordneten Datenströme für die vorhandenen Objekte (Address, Callund Stream).</span><span class="sxs-lookup"><span data-stu-id="2291e-162">Implement any desired private interfaces or substreams on your existing objects (address, call, and stream).</span></span> <span data-ttu-id="2291e-163">Normalerweise gibt es keine.</span><span class="sxs-lookup"><span data-stu-id="2291e-163">Usually there are none.</span></span> <span data-ttu-id="2291e-164">Beachten Sie, dass Sie bei der Implementierung Ihrer privaten Schnittstellen die LIBID der Typbibliothek aus der IDL-Datei angeben.</span><span class="sxs-lookup"><span data-stu-id="2291e-164">Be aware that when implementing your private interfaces, specify the LIBID of your type library from your IDL file.</span></span> <span data-ttu-id="2291e-165">Das heißt, dass Anwendungsprogrammierer ihre MSP-Typbibliothek verwenden müssen, wenn Sie benutzerdefinierte Schnittstellen verwenden.</span><span class="sxs-lookup"><span data-stu-id="2291e-165">That is, application programmers must use your MSP type library when using your custom interfaces.</span></span> <span data-ttu-id="2291e-166">Die standardmäßigen MSP-Schnittstellen, die in den MSP-Basisklassen implementiert werden, verwenden den Tapi3.dll LIBID und sind daher für alle TAPI 3-Anwendungen zugänglich.</span><span class="sxs-lookup"><span data-stu-id="2291e-166">The standard MSP interfaces, implemented in the MSP base classes, use the Tapi3.dll LIBID and are therefore accessible to all TAPI 3 applications.</span></span>
16. <span data-ttu-id="2291e-167">Bei der Implementierung von MSP-spezifischen statischen oder dynamischen Terminal Objekten oder Ersetzungen für die statischen Standard Terminals (nicht typisch) können Sie die bereitgestellten Terminal Basisklassen verwenden.</span><span class="sxs-lookup"><span data-stu-id="2291e-167">If implementing MSP-specific static or dynamic terminal objects or replacements for the default static terminals (not typical), you can use the provided terminal base classes.</span></span> <span data-ttu-id="2291e-168">Sie müssen verschiedene Methoden für das Adress Objekt überschreiben, um alternative oder zusätzliche Methoden zum Erstellen von Terminal Objekten bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="2291e-168">You will have to override various methods on your address object to provide alternative or additional methods of creating terminal objects.</span></span>
17. <span data-ttu-id="2291e-169">Implementieren Sie die IObjectSafety-Schnittstelle für Adress-, Call-, Stream-und Terminal Objekte.</span><span class="sxs-lookup"><span data-stu-id="2291e-169">Implement the IObjectSafety interface on your Address, Call, Stream, and Terminal objects.</span></span> <span data-ttu-id="2291e-170">Wenn Sie die [Dispatchzuordnung](dispatch-mapper.md) verwenden möchten, um Schnittstellen für Ihre MSP-Objekte abzufragen, markieren Sie die Objekte für die Skripterstellung für diese Schnittstellen als sicher</span><span class="sxs-lookup"><span data-stu-id="2291e-170">To use [Dispatch Mapper](dispatch-mapper.md) to query for interfaces on your MSP objects, mark your objects as safe for scripting on these interfaces.</span></span> <span data-ttu-id="2291e-171">Zu diesem Zweck implementieren Sie die **iobjectorafety** -Schnittstelle für Ihr Objekt.</span><span class="sxs-lookup"><span data-stu-id="2291e-171">To do this, implement the **IObjectSafety** interface on your object.</span></span> <span data-ttu-id="2291e-172">Die Ableitung von **cmspobjectafetyimpl** (eine Hilfsklasse, die in "msputils. h" bereitgestellt wird) und Hinzufügen von **iobjectafety** zur ATL-COM-Zuordnung Ihrer Klasse \_ macht die Objekte für die Skripterstellung für alle Schnittstellen, die Sie verfügbar machen, sicher</span><span class="sxs-lookup"><span data-stu-id="2291e-172">Deriving from **CMSPObjectSafetyImpl** (a helper class provided in Msputils.h) and adding **IObjectSafety** to your class's ATL COM\_MAP will make your objects safe for scripting on all the interfaces they expose.</span></span> <span data-ttu-id="2291e-173">Beachten Sie, dass die Verwendung von Dispatch-Mapper für MSP-Objekte implizit sein könnte.</span><span class="sxs-lookup"><span data-stu-id="2291e-173">Be aware that using Dispatch Mapper on MSP objects could be implicit.</span></span> <span data-ttu-id="2291e-174">MSP-Adresse und MSP-Aufrufe werden durch TAPI-address-und TAPI-calltobjekte aggregiert.</span><span class="sxs-lookup"><span data-stu-id="2291e-174">MSP Address and MSP Call are aggregated by TAPI Address and TAPI Call objects.</span></span> <span data-ttu-id="2291e-175">Wenn Dispatch-Mapper für die TAPI-Objekte verwendet wird, um die Schnittstellen abzufragen, die von den aggregierten MSP-Objekten verfügbar gemacht werden, werden die aggregierten MSP-Objekte auf Sicherheit der angeforderten Schnittstellen abgefragt.</span><span class="sxs-lookup"><span data-stu-id="2291e-175">If Dispatch Mapper is used on the TAPI objects to query for the interfaces exposed by the aggregated MSP objects, the aggregated MSP objects will be queried for safety of the requested interfaces.</span></span>

 

 
