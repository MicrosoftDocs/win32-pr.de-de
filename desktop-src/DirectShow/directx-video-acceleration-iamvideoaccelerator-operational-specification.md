---
description: DirectX-Video Beschleunigung iamvideoaccelerator-Betriebs Spezifikation
ms.assetid: 25ee05d5-8554-4739-9122-e3c0255bf965
title: DirectX-Video Beschleunigung iamvideoaccelerator-Betriebs Spezifikation
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3360e18e91197f2a15a36fb112f0419b6382e915
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/06/2021
ms.locfileid: "103957729"
---
# <a name="directx-video-acceleration-iamvideoaccelerator-operational-specification"></a>DirectX-Video Beschleunigung iamvideoaccelerator-Betriebs Spezifikation

Der genaue Vorgangs Mechanismus lautet wie folgt:

1.  Jedes in diesem Dokument definierte Profil mit eingeschränktem Modus verfügt über eine zugehörige DirectX-VA-GUID, die von der [**IPin:: queryaccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) -und [**IPin:: receiveconnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) -Eigenschaft einer downstreameingabe-Pin unterstützt und in [**iamvideoaccelerator:: getvideoacceleratorguids**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getvideoacceleratorguids)aufgelistet werden kann.
2.  Ebenso muss jeder Verschlüsselungs Protokolltyp, der mit DirectX VA verwendet werden kann, über eine zugeordnete Verschlüsselungs Protokolltyp-GUID verfügen, die durch die [**IPin:: queryaccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) -und [**IPin:: receiveconnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) -Eigenschaft der Downstream-Eingabe-PIN unterstützt und in **iamvideoaccelerator:: getvideoacceleratorguids** aufgelistet werden kann Die GUID "keine Verschlüsselung" DXVA \_ NoEncryption darf nicht in dieser Liste gesendet werden, da Sie erforderlich und daher implizit ist.
3.  Nach dem Aufrufen von [**IPin:: receiveconnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) zum Versuch, eine Verbindung mit der downstreameingabepin herzustellen, gibt der [**iamvideoacceleratornotify:: getcreatevideoacceleratordata**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoacceleratornotify-getcreatevideoacceleratordata) des Decoders einen Zeiger auf eine DXVA- \_ ConnectMode-Datenstruktur zurück, die die Verbindungs Modus-Informationen für die Verbindung enthält. [**Iamvideoaccelerator:: getcompbufferinfo**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getcompbufferinfo) muss mit \* pdwnumtypescompbuffers = 16 aufgerufen werden und gibt komprimierte Puffer Informationen auf der Grundlage der Konvention zurück, dass die Typnummer jedes Puffers (wie in Abschnitt 3,4 der DirectX-Spezifikation definiert) direkt als NULL basierter Index in das Array der zurückgegebenen **amvacompbufferinfo** -Datenstrukturen verwendet werden kann. Hierfür ist es erforderlich, dass für alle Puffer Typen, die nicht verwendet werden (einschließlich Puffertyp 0), da es keine definierte Verwendung dieses Puffer Typs gibt, stellt der Zugriffstasten Treiber amvacompbufferinfo-Datenstrukturen mit einer Form von "Dummy"-Parameterwerten bereit (z. b. dwnumcompbuffers = 0, dwwidthtocreate = 0, dwheighttocreate = 0 und dwbytestoallo= 0).
4.  DXVA-Funktions Hinweise und zugehörige Datenpuffer werden mithilfe von [**iamvideoaccelerator:: Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute)gesendet. Die DXVA-Funktion wird im dwfunction-Parameter des-Aufrufes angegeben. Die einzigen DXVA-Funktionen, die für die Initialisierung relevant sind, sind DXVA \_ configqueryorreplyfunc und DXVA " \_ verschlüsseltprotocolfunc".
    -   Wenn dwfunction eine DXVA \_ configqueryorreplyfunc enthält, muss der lpprivateinputdata-Zeiger für die Weitergabe von Daten an die Zugriffstaste in diesem-Befehl auf eine Konfigurationsdaten Struktur zeigen. der lpprivateoutputdata-Zeiger zum Empfangen von Informationen von der Zugriffstaste muss auf einen Bereich zeigen, in dem eine Alternative oder eine doppelte Konfigurationsdaten Struktur platziert werden kann. der pamvabufferinfo-Zeiger für ein Array von amvabufferinfo muss **null** sein, und dwnumbuffers muss NULL sein. Das zurückgegebene HRESULT enthält den Wert " \_ false" oder " \_ false" \_ (falsch) oder e Fail oder e \_ invalidArg oder einen anderen Fehler Indikator "HRESULT" im Falle eines schwerwiegenden Problems bei der Protokoll Ausführung (z. b. ein ungültiger Konfigurationsparameter). Alle Aufrufe von **iamvideoaccelerator:: Execute** für alle Verwendungen von DXVA \_ configqueryorreplyfunc müssen allen anderen Aufrufen von **iamvideoaccelerator:: Execute** vorangestellt sein.
    -   Wenn dwfunction eine DXVA- \_ Verschlüsselung enthält, muss der lpprivateinputdata-Zeiger für das Übergeben von Daten an die Zugriffstaste in diesem-Befehl auf eine Verschlüsselungsprotokoll-Datenstruktur verweisen, die mit DXVA \_ verschlüsseltprotocolheader beginnt. der lpprivateoutputdata-Zeiger zum Empfangen von Informationen von der Zugriffstaste muss auf einen Bereich verweisen, in dem die zurück zugegenden Daten (z. b. ein Zertifikat) durch das Verschlüsselungsprotokoll (das mit DXVA " \_ verschlüsseltprotocolheader" beginnt) eingefügt werden können. der pamvabufferinfo-Zeiger für ein Array von amvabufferinfo muss **null** sein, und dwnumbuffers muss NULL sein. Der zurückgegebene HRESULT-Wert enthält "S OK", solange \_ das Verschlüsselungsprotokoll normal funktioniert und e \_ Fail oder e \_ invalidArg enthält, oder ein anderes Fehler Anzeichen für ein HRESULT im Falle eines schwerwiegenden Problems bei der Protokoll Ausführung.

        Nach der Initialisierung des Vorgangs in der obigen Weise wird der tatsächliche Vorgang des Decoders wie folgt fortgesetzt:

5.  **Iamvideoaccelerator:: beginFrame** muss vor dem Senden von bdxva \_ Func mit komprimierten Puffer Parametern aufgerufen werden, die Schreibvorgänge auf eine nicht komprimierte Ziel Oberfläche verursachen. Der Zweck von [**iamvideoaccelerator:: beginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) in DirectX VA besteht darin, Ziel Oberflächen Indexwerten zuzuordnen und den Video Zugriffstasten Treiber darüber zu informieren, dass die Absicht, eine Oberfläche zu initiieren, eine Oberfläche zu initiieren, damit der Treiber mit einem Hinweis darauf antwortet, ob die Oberfläche überschrieben werden kann. Die in **iamvideoaccelerator:: beginFrame** übergebenen **amvabeginframeinfo** -Struktur muss einen pinputdata-Zeiger auf einen einzelnen Word-wbeginpictureindex-Parameter enthalten, der mit dem an **iamvideoaccelerator:: beginFrame** übergebenen Frame Index übereinstimmt (und dwsizeinputdata muss 2 sein). Dies ist der Index, der in einem komprimierten Puffer zum Schreiben eines Schreibzugriffs auf die Oberfläche verwendet werden soll (z. b. zur Verwendung als wdecodedpictureindex, wdeblockedpictureindex, wblendeddestinationindex oder wpikresampledestpicindex). Jeder **iamvideoaccelerator:: beginFrame** -Aufrufe muss mit einem entsprechenden [**iamvideoaccelerator:: Endframe**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) -Befehl gekoppelt werden, wie unten beschrieben. Wenn z. b. ein komprimiertes Bild decodiert und dann mit einer Kombination aus Front-End-Puffer zu Puffer und einem Grafik Bild gemischt werden soll, wird **iamvideoaccelerator:: beginFrame** aufgerufen, bevor das komprimierte Bild in eine in wdecodedpictureindex angegebene Oberfläche decodiert wird. ein Aufruf von **iamvideoaccelerator:: Endframe** nach dem übergeben aller komprimierten Puffer, die zum Decodieren des Bilds verwendet werden, und dann ein zweiter Aufruf von **iamvideoaccelerator:: beginFrame** vor dem übermitteln der Alpha Mischung aus der Grafik Quelle mit dem decodierten Bild in eine Ober **Fläche, die** in wblendeddestinationindex angegeben ist Der Zeiger poutputdata in amvabeginframeinfo muss **null** sein (und dwsizeoutputdata muss den Wert "0" aufweisen). Das von **iamvideoaccelerator:: beginFrame** zurückgegebene HRESULT muss wie folgt lauten:
    -   S \_ OK, wenn die unkomprimierte Oberfläche verfügbar und einsatzbereit ist.
    -   E steht \_ aus, wenn die nicht komprimierte Oberfläche noch nicht zur Verwendung verfügbar ist, aber bald verfügbar ist (wenn die nicht komprimierte Oberfläche für die Anzeige gelesen wird und das Lesen/Anzeigen der Oberfläche noch nicht abgeschlossen ist).
    -   E \_ Fail oder e \_ gibt nur eine andere Fehlermeldung zurück, wenn ein Datenformat oder ein Protokollfehler erkannt wird (z. b. ein falscher Wert von dwsizeinputdata oder ein nicht-**null** -poutputdata).
6.  DXVA-Funktions Hinweise und zugehörige Datenpuffer werden mithilfe von **iamvideoaccelerator:: Execute** gesendet. \_Im gleichen [**iamvideoaccelerator:: Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute)-Befehl können mehrere bdxva-Func-Werte angegeben werden. Die bdxva- \_ Func-Werte müssen in den dwfunction-Parameter des-Aufrufers gepackt werden, mit dem ersten Funktionsbefehl in den acht MSBS, dem nächsten Befehl in den nächsten acht Bits usw., wobei alle verbleibenden Bits mit Nullen aufgefüllt werden. Der Wert 0xFF für bdxva \_ Func gibt an, dass der bdxva- \_ Func auf zwei oder vier Bytes erweitert wird. Wenn das zweite Byte auch 0xFF ist, bedeutet dies, dass bdxva \_ Func auf vier Bytes erweitert wird. Wenn die oberen vier Bits des dritten Bytes 0xF oder 0x0 sind, gibt dies an, dass bdxva \_ Func eine DXVA \_ configqueryorreplyfunc oder DXVA \_ verschlüsseltprotocolfunc enthält. Multibyte-Befehle dürfen keine Fortsetzung nach dem Ende von dwfunction angeben. Der Decoder muss darauf achten, dass keine sequenziellen Abhängigkeiten zwischen verschiedenen bdxva-Func-Werten vorhanden sind, \_ die im gleichen **iamvideoaccelerator** -Angleich angegeben sind: führen Sie aus, und dass alle potenziellen Racebedingungen (z. b. zwischen Bild Decodierung und Teil Bild Mischung, zwischen Bild Ladevorgängen und subbild-Blending usw.) durch die entsprechenden Aufrufe von **iamvideoaccelerator:: beginFrame** und [**iamvideoaccelerator:: queryrenderstatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) vor nachfolgenden Aufrufen von **iamvideoaccelerator:: Execute** verhindert werden.
    -   Wenn dwfunction eine DXVA \_ configqueryorreplyfunc enthält, muss der lpprivateinputdata-Zeiger für die Weitergabe von Daten an die Zugriffstaste in diesem-Befehl auf eine Konfigurationsdaten Struktur zeigen. der lpprivateoutputdata-Zeiger zum Empfangen von Informationen von der Zugriffstaste muss auf einen Bereich zeigen, in dem eine Alternative oder eine doppelte Konfigurationsdaten Struktur platziert werden kann. der pamvabufferinfo-Zeiger für ein Array von amvabufferinfo muss **null** sein, und dwnumbuffers muss NULL sein. Das zurückgegebene HRESULT enthält die \_ Fehlermeldung "s OK" oder " \_ false" als Antwort auf die Abfrage, oder e \_ Fail bzw \_ . ein anderes Fehler Anzeichen für ein HRESULT im Falle eines schwerwiegenden Problems bei der Protokoll Ausführung (z. b. ein invalid.configurations Parameter). Alle Aufrufe von **iamvideoaccelerator:: Execute** für alle Verwendungen von DXVA \_ configqueryorreplyfunc müssen allen anderen Aufrufen von **iamvideoaccelerator:: Execute** vorangestellt sein.
    -   Wenn dwfunction eine DXVA- \_ Verschlüsselung enthält, muss der lpprivateinputdata-Zeiger für das Übergeben von Daten an die Zugriffstaste in diesem-Befehl auf eine Verschlüsselungsprotokoll-Datenstruktur verweisen, die mit DXVA \_ verschlüsseltprotocolheader beginnt. der lpprivateoutputdata-Zeiger zum Empfangen von Informationen von der Zugriffstaste muss auf einen Bereich verweisen, in dem die zurück zugegenden Daten (z. b. ein Zertifikat) durch das Verschlüsselungsprotokoll (das mit DXVA " \_ verschlüsseltprotocolheader" beginnt) eingefügt werden können. der pamvabufferinfo-Zeiger für ein Array von amvabufferinfo muss **null** sein, und dwnumbuffers muss NULL sein. Der zurückgegebene HRESULT-Wert enthält "S OK", solange \_ das Verschlüsselungsprotokoll normal funktioniert und e \_ Fail oder e \_ invalidArg enthält, oder ein anderes Fehler Anzeichen für ein HRESULT im Falle eines schwerwiegenden Problems bei der Protokoll Ausführung.
    -   Wenn dwfunction kein DXVA \_ configqueryorreplyfunc oder DXVA- \_ verschlüsselungprotocolfunc enthält, muss der lpprivateinputdata-Zeiger zum Übergeben von Daten an die Zugriffstaste auf eine Puffer Beschreibungs Liste zeigen. Die ersten vier Einträge in der Puffer Beschreibungs-Listenstruktur für jeden Puffer (dwtypeindex, dwbufferindex, dwdataoffset und dwDataSize) müssen mit denen in der amvabufferinfo-Datenstruktur für denselben Puffer identisch sein. Wenn "bdxva \_ Func" gleich "1" ist, wird in "dwfunction" und "bpikreadbackrequests" den Wert "1" festgelegt. der lpprivateoutputdata-Zeiger zum Empfangen von Informationen von der Zugriffstaste muss auf einen Bereich des permanenten Arbeitsspeichers (z. b. Heap) zeigen, der mit den Daten aus der Zugriffstaste mit einem Read-Back-Makro (z. b. "Heap") gefüllt werden soll (solche Daten sind bis **iamvideoaccelerator: queryrenderstatus** zum Schreiben in denselben Bildparameter Puffer gibt S OK an, \_ wie in Item 10 weiter unten beschrieben. Andernfalls muss der lpprivateoutputdata-Zeiger zum Empfangen von Informationen von der Zugriffstaste auf ein einzelnes DWORD zeigen, das auf einen der folgenden Indikatorwerte festgelegt werden soll (besonders nützlich für die Berichterstellung von Bitstrom-Fehlern in einem Out-Host-VLD-Vorgang).

        | Wert | BESCHREIBUNG                                     |
        |-------|-------------------------------------------------|
        | 0     | Ausführung ist OK.                                   |
        | 1     | Kleinere Probleme im Datenformat.       |
        | 2     | Im Datenformat ist ein erhebliches Problem aufgetreten. |
        | 3     | Schwerwiegendes Problem im Datenformat.      |
        | 4     | Anderer schwerwiegendes Problem ist aufgetreten.               |

        

         

        Wenn ein "schwerwiegendes" Problem angegeben ist, sollte der Software Decoder den Betrieb der Funktion (en) beenden, es sei denn, es kann eine Korrekturmaßnahme durchgeführt werden. Diese Daten, die von der Zugriffstaste zurückgegeben werden, dürfen vom Host erst gelesen werden, nachdem das Puffer Rendering für das Bild abgeschlossen ist, wie von [**iamvideoaccelerator:: queryrenderstatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus)getestet werden kann. Das zurückgegebene HRESULT enthält den Wert "OK", solange \_ der Schnittstellen Vorgang normal funktioniert und "e \_ Fail" oder "e \_ invalidArg" oder ein anderes Fehler Anzeichen für ein schwerwiegendes Problem zurückgeben kann.

7.  Der Puffer für die Decodierung von Bildern muss zu den ersten Puffern gehören, die für die Decodierung der einzelnen Bilder gesendet werden, wenn [**iamvideoaccelerator:: Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute) mit bdxva \_ Func gleich "1" verwendet wird. alle Puffer für das Decodieren eines Bilds in einem Bitstrom müssen vor allen Puffern zum Decodieren der nachfolgenden Bilder gesendet werden. Wenn ein Makroblock-Steuerelement-Befehls Puffer gesendet wird, muss ein entsprechender Datenpuffer für die restdifferenz gesendet werden (mit Daten für die gleichen Makroblöcke) mit demselben **iamvideoaccelerator:: Execute** -Befehl.
8.  [**Iamvideoaccelerator:: Endframe**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) muss aufgerufen werden, nachdem alle komprimierten Puffer gesendet wurden, die die Erstellung des Ausgabe Inhalts in einer angegebenen nicht komprimierten Oberfläche bewirken (das Ergebnis der Vorgänge, die für wdecodedpictureindex, wdeblockedpictureindex, wblendeddestinationindex oder wpicresampledestpicindex angegeben wurden). Der Zweck dieses Aufrufens von **iamvideoaccelerator:: Endframe** besteht darin, die Video Zugriffstaste zu benachrichtigen, dass alle Daten, die für den angegebenen Vorgang erforderlich sind, gesendet wurden. Der Zeiger auf die Daten, die durch die **iamvideoaccelerator:: Endframe** -Schnittstelle gesendet werden sollen, muss auf ein einzelnes Word-"wendpictureindex" zeigen, das den Index des enden Frames enthält. Dieser Parameter muss mit dem wbeginpictureindex-Wert verglichen werden, der im vorherigen [**iamvideoaccelerator:: beginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) vor dem Senden der relevanten komprimierten Puffer angegeben wurde. Im Anschluss an einen **iamvideoaccelerator:: Endframe**-Aufrufe sollte die nicht komprimierte Oberfläche mit dem Index "wendpictureindex" nicht in wdecodedpictureindex eines Bilds gefunden werden. wdeblockedpictureindex, wblendeddestinationindex oder wpicresampledestpicindex, bis nach einem weiteren Aufruf von **iamvideoaccelerator:: beginFrame** ausgegeben wird, um anzugeben, dass dies auftritt und ein s \_ OK-Ergebnis zurückgegeben wurde. Allerdings kann dieser Ziel Oberflächen Index in nachfolgenden Lese Zugriffs Befehlen auftreten, wie z. b. wforwardrefpictureindex, wbackwardrefpictureindex, wpikresamplesourcepicindex oder brefpicselect \[ i \] . Der von **iamvideoaccelerator:: Endframe** zurückgegebene HRESULT-Wert muss S \_ OK sein, es sei denn, es gibt eine Art von Datenformat oder Protokollfehler. in diesem Fall kann es sich um e \_ Fail oder e \_ invalidArg oder eine andere Fehleranzeige handeln.
9.  Bei der Feld basierten Decodierung (z. b. in MPEG-2-Bitstreams) gibt es keine 1: Eins-Zuordnung von funktionalen Bildern im Bitstrom zu unkomprimierten Oberflächen in der Zugriffstasten Schnittstelle. Beim Decodieren von Feld Bildern in einem MPEG-2-Bitstream werden zwei "Bilder" decodiert, um eine gesamte nicht komprimierte Ausgabe Oberfläche zu erhalten. In der DirectX-VA-Schnittstellen Definition entspricht jeder Frame jeder Verwendung von wdecodedpictureindex, wdeblockedpictureindex, wblendeddestinationindex oder wpikresampledestpicindex. Daher sind zwei Paare von Aufrufen von **iamvideoaccelerator:: beginFrame** und **iamvideoaccelerator:: Endframe** für das Decodieren von Feld Bildern in nicht komprimierte Ausgabe Oberflächen erforderlich.
10. Ein [**iamvideoaccelerator:: queryrenderstatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) -Befehl mit dwFlags gleich 0 (null), der nach einem **iamvideoaccelerator:: Endframe mit einem bestimmten wendpictureindex nach einem iamvideoaccelerator:: Endframe** -Befehl mit einem bestimmten wendpictureindex angezeigt wird und den Status eines gesendeten Puffers in wdecodedpictureindex überprüft, wdeblockedpictureindex, wblendeddestinationindex oder wpikresampledestpicindex gibt eine \_ OK-Angabe zurück, wenn alle Vorgänge zum Schreiben der Daten auf die nicht komprimierte Oberfläche abgeschlossen sind und "E Pending" zurückgibt, \_ Wenn der Vorgang noch nicht abgeschlossen wurde. E \_ Fail oder e \_ invalidArg oder ein anderer Fehler Hinweis kann im Fall eines Protokoll Fehlers zurückgegeben werden.

## <a name="related-topics"></a>Zugehörige Themen

<dl> <dt>

[Zuordnung von DirectX-Video Beschleunigung zu iamvideoaccelerator](mapping-directx-video-acceleration-to-iamvideoaccelerator.md)
</dt> </dl>

 

 



