---
description: DirectX-Video Beschleunigung iamvideoaccelerator-Betriebs Spezifikation
ms.assetid: 25ee05d5-8554-4739-9122-e3c0255bf965
title: DirectX-Video Beschleunigung iamvideoaccelerator-Betriebs Spezifikation
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3360e18e91197f2a15a36fb112f0419b6382e915
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/06/2021
ms.locfileid: "103957729"
---
# <a name="directx-video-acceleration-iamvideoaccelerator-operational-specification"></a><span data-ttu-id="59f39-103">DirectX-Video Beschleunigung iamvideoaccelerator-Betriebs Spezifikation</span><span class="sxs-lookup"><span data-stu-id="59f39-103">DirectX Video Acceleration IAMVideoAccelerator Operational Specification</span></span>

<span data-ttu-id="59f39-104">Der genaue Vorgangs Mechanismus lautet wie folgt:</span><span class="sxs-lookup"><span data-stu-id="59f39-104">The precise mechanism of operation is as follows:</span></span>

1.  <span data-ttu-id="59f39-105">Jedes in diesem Dokument definierte Profil mit eingeschränktem Modus verfügt über eine zugehörige DirectX-VA-GUID, die von der [**IPin:: queryaccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) -und [**IPin:: receiveconnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) -Eigenschaft einer downstreameingabe-Pin unterstützt und in [**iamvideoaccelerator:: getvideoacceleratorguids**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getvideoacceleratorguids)aufgelistet werden kann.</span><span class="sxs-lookup"><span data-stu-id="59f39-105">Each restricted mode profile defined herein has an associated DirectX VA GUID which can be supported by a downstream input pin's [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) and [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) and listed in [**IAMVideoAccelerator::GetVideoAcceleratorGUIDs**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getvideoacceleratorguids).</span></span>
2.  <span data-ttu-id="59f39-106">Ebenso muss jeder Verschlüsselungs Protokolltyp, der mit DirectX VA verwendet werden kann, über eine zugeordnete Verschlüsselungs Protokolltyp-GUID verfügen, die durch die [**IPin:: queryaccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) -und [**IPin:: receiveconnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) -Eigenschaft der Downstream-Eingabe-PIN unterstützt und in **iamvideoaccelerator:: getvideoacceleratorguids** aufgelistet werden kann</span><span class="sxs-lookup"><span data-stu-id="59f39-106">Similarly, each encryption protocol type for use with DirectX VA shall have an associated encryption protocol type GUID which can be supported by a downstream input pin's [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) and [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) and listed in **IAMVideoAccelerator::GetVideoAcceleratorGUIDs**.</span></span> <span data-ttu-id="59f39-107">Die GUID "keine Verschlüsselung" DXVA \_ NoEncryption darf nicht in dieser Liste gesendet werden, da Sie erforderlich und daher implizit ist.</span><span class="sxs-lookup"><span data-stu-id="59f39-107">The "no encryption" GUID DXVA\_NoEncrypt shall not be sent in this list, as support for it is required and therefore implicit.</span></span>
3.  <span data-ttu-id="59f39-108">Nach dem Aufrufen von [**IPin:: receiveconnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) zum Versuch, eine Verbindung mit der downstreameingabepin herzustellen, gibt der [**iamvideoacceleratornotify:: getcreatevideoacceleratordata**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoacceleratornotify-getcreatevideoacceleratordata) des Decoders einen Zeiger auf eine DXVA- \_ ConnectMode-Datenstruktur zurück, die die Verbindungs Modus-Informationen für die Verbindung enthält.</span><span class="sxs-lookup"><span data-stu-id="59f39-108">After calling [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) to attempt a connection to the downstream input pin, the decoder's [**IAMVideoAcceleratorNotify::GetCreateVideoAcceleratorData**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoacceleratornotify-getcreatevideoacceleratordata) shall return a pointer to a DXVA\_ConnectMode data structure containing the connection mode information for the connection.</span></span> <span data-ttu-id="59f39-109">[**Iamvideoaccelerator:: getcompbufferinfo**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getcompbufferinfo) muss mit \* pdwnumtypescompbuffers = 16 aufgerufen werden und gibt komprimierte Puffer Informationen auf der Grundlage der Konvention zurück, dass die Typnummer jedes Puffers (wie in Abschnitt 3,4 der DirectX-Spezifikation definiert) direkt als NULL basierter Index in das Array der zurückgegebenen **amvacompbufferinfo** -Datenstrukturen verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="59f39-109">[**IAMVideoAccelerator::GetCompBufferInfo**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getcompbufferinfo) shall be called with \*pdwNumTypesCompBuffers = 16 and shall return compressed buffer information based on the convention that the type number of each buffer (as defined in Section 3.4 of the DirectX VA specification) can be used directly as the zero-based index into the array of **AMVACompBufferInfo** data structures that is returned.</span></span> <span data-ttu-id="59f39-110">Hierfür ist es erforderlich, dass für alle Puffer Typen, die nicht verwendet werden (einschließlich Puffertyp 0), da es keine definierte Verwendung dieses Puffer Typs gibt, stellt der Zugriffstasten Treiber amvacompbufferinfo-Datenstrukturen mit einer Form von "Dummy"-Parameterwerten bereit (z. b. dwnumcompbuffers = 0, dwwidthtocreate = 0, dwheighttocreate = 0 und dwbytestoallo= 0).</span><span class="sxs-lookup"><span data-stu-id="59f39-110">This requires that for any buffer types that will not be used (including buffer type 0, since there is no defined use of that buffer type), the accelerator driver will provide AMVACompBufferInfo data structures with some form of "dummy" parameter values (such as dwNumCompBuffers=0, dwWidthToCreate=0, dwHeightToCreate=0, and dwBytesToAllocate=0).</span></span>
4.  <span data-ttu-id="59f39-111">DXVA-Funktions Hinweise und zugehörige Datenpuffer werden mithilfe von [**iamvideoaccelerator:: Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute)gesendet.</span><span class="sxs-lookup"><span data-stu-id="59f39-111">DXVA function indications and associated data buffers are sent using [**IAMVideoAccelerator::Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute).</span></span> <span data-ttu-id="59f39-112">Die DXVA-Funktion wird im dwfunction-Parameter des-Aufrufes angegeben.</span><span class="sxs-lookup"><span data-stu-id="59f39-112">The DXVA function is indicated in the dwFunction parameter of the call.</span></span> <span data-ttu-id="59f39-113">Die einzigen DXVA-Funktionen, die für die Initialisierung relevant sind, sind DXVA \_ configqueryorreplyfunc und DXVA " \_ verschlüsseltprotocolfunc".</span><span class="sxs-lookup"><span data-stu-id="59f39-113">The only DXVA functions that are relevant for initialization are DXVA\_ConfigQueryOrReplyFunc and DXVA\_EncryptProtocolFunc.</span></span>
    -   <span data-ttu-id="59f39-114">Wenn dwfunction eine DXVA \_ configqueryorreplyfunc enthält, muss der lpprivateinputdata-Zeiger für die Weitergabe von Daten an die Zugriffstaste in diesem-Befehl auf eine Konfigurationsdaten Struktur zeigen. der lpprivateoutputdata-Zeiger zum Empfangen von Informationen von der Zugriffstaste muss auf einen Bereich zeigen, in dem eine Alternative oder eine doppelte Konfigurationsdaten Struktur platziert werden kann. der pamvabufferinfo-Zeiger für ein Array von amvabufferinfo muss **null** sein, und dwnumbuffers muss NULL sein.</span><span class="sxs-lookup"><span data-stu-id="59f39-114">If dwFunction contains a DXVA\_ConfigQueryOrReplyFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to a configuration data structure, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where an alternative or duplicate configuration data structure can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="59f39-115">Das zurückgegebene HRESULT enthält den Wert " \_ false" oder " \_ false" \_ (falsch) oder e Fail oder e \_ invalidArg oder einen anderen Fehler Indikator "HRESULT" im Falle eines schwerwiegenden Problems bei der Protokoll Ausführung (z. b. ein ungültiger Konfigurationsparameter).</span><span class="sxs-lookup"><span data-stu-id="59f39-115">The returned HRESULT contains the S\_OK or S\_FALSE indication, or E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem in protocol execution (such as an invalid configuration parameter).</span></span> <span data-ttu-id="59f39-116">Alle Aufrufe von **iamvideoaccelerator:: Execute** für alle Verwendungen von DXVA \_ configqueryorreplyfunc müssen allen anderen Aufrufen von **iamvideoaccelerator:: Execute** vorangestellt sein.</span><span class="sxs-lookup"><span data-stu-id="59f39-116">All calls to **IAMVideoAccelerator::Execute** for all uses of DXVA\_ConfigQueryOrReplyFunc shall precede all other calls to **IAMVideoAccelerator::Execute**.</span></span>
    -   <span data-ttu-id="59f39-117">Wenn dwfunction eine DXVA- \_ Verschlüsselung enthält, muss der lpprivateinputdata-Zeiger für das Übergeben von Daten an die Zugriffstaste in diesem-Befehl auf eine Verschlüsselungsprotokoll-Datenstruktur verweisen, die mit DXVA \_ verschlüsseltprotocolheader beginnt. der lpprivateoutputdata-Zeiger zum Empfangen von Informationen von der Zugriffstaste muss auf einen Bereich verweisen, in dem die zurück zugegenden Daten (z. b. ein Zertifikat) durch das Verschlüsselungsprotokoll (das mit DXVA " \_ verschlüsseltprotocolheader" beginnt) eingefügt werden können. der pamvabufferinfo-Zeiger für ein Array von amvabufferinfo muss **null** sein, und dwnumbuffers muss NULL sein.</span><span class="sxs-lookup"><span data-stu-id="59f39-117">If dwFunction contains a DXVA\_EncryptProtocolFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to an encryption protocol data structure that begins with DXVA\_EncryptProtocolHeader, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where the data to be returned (such as a certificate) by the encryption protocol (which will begin with DXVA\_EncryptProtocolHeader) can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="59f39-118">Der zurückgegebene HRESULT-Wert enthält "S OK", solange \_ das Verschlüsselungsprotokoll normal funktioniert und e \_ Fail oder e \_ invalidArg enthält, oder ein anderes Fehler Anzeichen für ein HRESULT im Falle eines schwerwiegenden Problems bei der Protokoll Ausführung.</span><span class="sxs-lookup"><span data-stu-id="59f39-118">The returned HRESULT contains S\_OK as long as the encryption protocol is functioning normally and contains E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem in protocol execution.</span></span>

        <span data-ttu-id="59f39-119">Nach der Initialisierung des Vorgangs in der obigen Weise wird der tatsächliche Vorgang des Decoders wie folgt fortgesetzt:</span><span class="sxs-lookup"><span data-stu-id="59f39-119">After initialization of operation in the above fashion, the actual operation of the decoder proceeds as follows:</span></span>

5.  <span data-ttu-id="59f39-120">**Iamvideoaccelerator:: beginFrame** muss vor dem Senden von bdxva \_ Func mit komprimierten Puffer Parametern aufgerufen werden, die Schreibvorgänge auf eine nicht komprimierte Ziel Oberfläche verursachen.</span><span class="sxs-lookup"><span data-stu-id="59f39-120">**IAMVideoAccelerator::BeginFrame** shall be called prior to sending any bDXVA\_Func with compressed buffer parameters which cause writes to an uncompressed destination surface.</span></span> <span data-ttu-id="59f39-121">Der Zweck von [**iamvideoaccelerator:: beginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) in DirectX VA besteht darin, Ziel Oberflächen Indexwerten zuzuordnen und den Video Zugriffstasten Treiber darüber zu informieren, dass die Absicht, eine Oberfläche zu initiieren, eine Oberfläche zu initiieren, damit der Treiber mit einem Hinweis darauf antwortet, ob die Oberfläche überschrieben werden kann.</span><span class="sxs-lookup"><span data-stu-id="59f39-121">The purpose of [**IAMVideoAccelerator::BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) in DirectX VA is to associate destination surfaces with index values and to notify the video accelerator driver of the intent to initiate writes a surface so that the driver can respond with an indication of whether the surface is ready to be overwritten.</span></span> <span data-ttu-id="59f39-122">Die in **iamvideoaccelerator:: beginFrame** übergebenen **amvabeginframeinfo** -Struktur muss einen pinputdata-Zeiger auf einen einzelnen Word-wbeginpictureindex-Parameter enthalten, der mit dem an **iamvideoaccelerator:: beginFrame** übergebenen Frame Index übereinstimmt (und dwsizeinputdata muss 2 sein).</span><span class="sxs-lookup"><span data-stu-id="59f39-122">The **AMVABeginFrameInfo** structure passed in **IAMVideoAccelerator::BeginFrame** shall contain a pInputData pointer to single WORD wBeginPictureIndex parameter matching the frame index passed into **IAMVideoAccelerator::BeginFrame** (and dwSizeInputData shall be 2).</span></span> <span data-ttu-id="59f39-123">Dies ist der Index, der in einem komprimierten Puffer zum Schreiben eines Schreibzugriffs auf die Oberfläche verwendet werden soll (z. b. zur Verwendung als wdecodedpictureindex, wdeblockedpictureindex, wblendeddestinationindex oder wpikresampledestpicindex).</span><span class="sxs-lookup"><span data-stu-id="59f39-123">This is the index to be used in a compressed buffer to command a write to the surface (for example, to be used as wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex).</span></span> <span data-ttu-id="59f39-124">Jeder **iamvideoaccelerator:: beginFrame** -Aufrufe muss mit einem entsprechenden [**iamvideoaccelerator:: Endframe**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) -Befehl gekoppelt werden, wie unten beschrieben.</span><span class="sxs-lookup"><span data-stu-id="59f39-124">Each call to **IAMVideoAccelerator::BeginFrame** shall be paired with a corresponding call to [**IAMVideoAccelerator::EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) as described below.</span></span> <span data-ttu-id="59f39-125">Wenn z. b. ein komprimiertes Bild decodiert und dann mit einer Kombination aus Front-End-Puffer zu Puffer und einem Grafik Bild gemischt werden soll, wird **iamvideoaccelerator:: beginFrame** aufgerufen, bevor das komprimierte Bild in eine in wdecodedpictureindex angegebene Oberfläche decodiert wird. ein Aufruf von **iamvideoaccelerator:: Endframe** nach dem übergeben aller komprimierten Puffer, die zum Decodieren des Bilds verwendet werden, und dann ein zweiter Aufruf von **iamvideoaccelerator:: beginFrame** vor dem übermitteln der Alpha Mischung aus der Grafik Quelle mit dem decodierten Bild in eine Ober **Fläche, die** in wblendeddestinationindex angegeben ist Der Zeiger poutputdata in amvabeginframeinfo muss **null** sein (und dwsizeoutputdata muss den Wert "0" aufweisen).</span><span class="sxs-lookup"><span data-stu-id="59f39-125">For example, if a compressed picture is to be decoded and then alpha blended using front-end buffer-to-buffer blending with a graphic image, there would be a call to **IAMVideoAccelerator::BeginFrame** prior to decoding the compressed picture into a surface specified in wDecodedPictureIndex, then a call to **IAMVideoAccelerator::EndFrame** after passing all compressed buffers used to decode the picture, then a second call to **IAMVideoAccelerator::BeginFrame** prior to commanding alpha blending combination of the graphic source with the decoded picture into a surface specified in wBlendedDestinationIndex, and then a second call to **IAMVideoAccelerator::EndFrame** after the alpha blend combination operation.The pointer pOutputData in AMVABeginFrameInfo shall be **NULL** (and dwSizeOutputData shall be "0").</span></span> <span data-ttu-id="59f39-126">Das von **iamvideoaccelerator:: beginFrame** zurückgegebene HRESULT muss wie folgt lauten:</span><span class="sxs-lookup"><span data-stu-id="59f39-126">The HRESULT that is returned by **IAMVideoAccelerator::BeginFrame** shall be:</span></span>
    -   <span data-ttu-id="59f39-127">S \_ OK, wenn die unkomprimierte Oberfläche verfügbar und einsatzbereit ist.</span><span class="sxs-lookup"><span data-stu-id="59f39-127">S\_OK if the uncompressed surface is available and ready for use.</span></span>
    -   <span data-ttu-id="59f39-128">E steht \_ aus, wenn die nicht komprimierte Oberfläche noch nicht zur Verwendung verfügbar ist, aber bald verfügbar ist (wenn die nicht komprimierte Oberfläche für die Anzeige gelesen wird und das Lesen/Anzeigen der Oberfläche noch nicht abgeschlossen ist).</span><span class="sxs-lookup"><span data-stu-id="59f39-128">E\_PENDING if the uncompressed surface is not yet available for use but will become available soon (if the uncompressed surface is being read for display and the reading/display of the surface has not yet been completed).</span></span>
    -   <span data-ttu-id="59f39-129">E \_ Fail oder e \_ gibt nur eine andere Fehlermeldung zurück, wenn ein Datenformat oder ein Protokollfehler erkannt wird (z. b. ein falscher Wert von dwsizeinputdata oder ein nicht-**null** -poutputdata).</span><span class="sxs-lookup"><span data-stu-id="59f39-129">E\_FAIL or E\_INVALIDARG some other error indication only if a data format or protocol error is detected (such as an incorrect value of dwSizeInputData or a non-**NULL** pOutputData).</span></span>
6.  <span data-ttu-id="59f39-130">DXVA-Funktions Hinweise und zugehörige Datenpuffer werden mithilfe von **iamvideoaccelerator:: Execute** gesendet.</span><span class="sxs-lookup"><span data-stu-id="59f39-130">DXVA function indications and associated data buffers are sent using **IAMVideoAccelerator::Execute**.</span></span> <span data-ttu-id="59f39-131">\_Im gleichen [**iamvideoaccelerator:: Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute)-Befehl können mehrere bdxva-Func-Werte angegeben werden.</span><span class="sxs-lookup"><span data-stu-id="59f39-131">More than one bDXVA\_Func value may be indicated in the same call to [**IAMVideoAccelerator::Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute).</span></span> <span data-ttu-id="59f39-132">Die bdxva- \_ Func-Werte müssen in den dwfunction-Parameter des-Aufrufers gepackt werden, mit dem ersten Funktionsbefehl in den acht MSBS, dem nächsten Befehl in den nächsten acht Bits usw., wobei alle verbleibenden Bits mit Nullen aufgefüllt werden.</span><span class="sxs-lookup"><span data-stu-id="59f39-132">The bDXVA\_Func values shall be packed into the dwFunction parameter of the call, with the first function command in the eight MSBs, the next command in the next eight bits, and so on, with any remaining bits padded out with zeros.</span></span> <span data-ttu-id="59f39-133">Der Wert 0xFF für bdxva \_ Func gibt an, dass der bdxva- \_ Func auf zwei oder vier Bytes erweitert wird.</span><span class="sxs-lookup"><span data-stu-id="59f39-133">The value 0xFF for bDXVA\_Func indicates that the bDXVA\_Func is extended to two or four bytes.</span></span> <span data-ttu-id="59f39-134">Wenn das zweite Byte auch 0xFF ist, bedeutet dies, dass bdxva \_ Func auf vier Bytes erweitert wird.</span><span class="sxs-lookup"><span data-stu-id="59f39-134">If the second byte is also 0xFF, this indicates that bDXVA\_Func is extended to four bytes.</span></span> <span data-ttu-id="59f39-135">Wenn die oberen vier Bits des dritten Bytes 0xF oder 0x0 sind, gibt dies an, dass bdxva \_ Func eine DXVA \_ configqueryorreplyfunc oder DXVA \_ verschlüsseltprotocolfunc enthält.</span><span class="sxs-lookup"><span data-stu-id="59f39-135">If the upper four bits of the third byte are 0xF or 0x0, this indicates that bDXVA\_Func contains a DXVA\_ConfigQueryOrReplyFunc or DXVA\_EncryptProtocolFunc.</span></span> <span data-ttu-id="59f39-136">Multibyte-Befehle dürfen keine Fortsetzung nach dem Ende von dwfunction angeben.</span><span class="sxs-lookup"><span data-stu-id="59f39-136">Multi-byte commands shall not indicate continuation past the end of dwFunction.</span></span> <span data-ttu-id="59f39-137">Der Decoder muss darauf achten, dass keine sequenziellen Abhängigkeiten zwischen verschiedenen bdxva-Func-Werten vorhanden sind, \_ die im gleichen **iamvideoaccelerator** -Angleich angegeben sind: führen Sie aus, und dass alle potenziellen Racebedingungen (z. b. zwischen Bild Decodierung und Teil Bild Mischung, zwischen Bild Ladevorgängen und subbild-Blending usw.) durch die entsprechenden Aufrufe von **iamvideoaccelerator:: beginFrame** und [**iamvideoaccelerator:: queryrenderstatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) vor nachfolgenden Aufrufen von **iamvideoaccelerator:: Execute** verhindert werden.</span><span class="sxs-lookup"><span data-stu-id="59f39-137">Care must be taken by the decoder to ensure that no sequential dependencies are present between different bDXVA\_Func values specified in the same call to **IAMVideoAccelerator::Execute** and that all potential race conditions (such as between picture decoding and sub-picture blending, between sub-picture loading and sub-picture blending, and so on) are prevented by appropriate calls to **IAMVideoAccelerator::BeginFrame** and [**IAMVideoAccelerator::QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) before subsequent calls to **IAMVideoAccelerator::Execute**.</span></span>
    -   <span data-ttu-id="59f39-138">Wenn dwfunction eine DXVA \_ configqueryorreplyfunc enthält, muss der lpprivateinputdata-Zeiger für die Weitergabe von Daten an die Zugriffstaste in diesem-Befehl auf eine Konfigurationsdaten Struktur zeigen. der lpprivateoutputdata-Zeiger zum Empfangen von Informationen von der Zugriffstaste muss auf einen Bereich zeigen, in dem eine Alternative oder eine doppelte Konfigurationsdaten Struktur platziert werden kann. der pamvabufferinfo-Zeiger für ein Array von amvabufferinfo muss **null** sein, und dwnumbuffers muss NULL sein.</span><span class="sxs-lookup"><span data-stu-id="59f39-138">If dwFunction contains a DXVA\_ConfigQueryOrReplyFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to a configuration data structure, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where an alternative or duplicate configuration data structure can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="59f39-139">Das zurückgegebene HRESULT enthält die \_ Fehlermeldung "s OK" oder " \_ false" als Antwort auf die Abfrage, oder e \_ Fail bzw \_ . ein anderes Fehler Anzeichen für ein HRESULT im Falle eines schwerwiegenden Problems bei der Protokoll Ausführung (z. b. ein invalid.configurations Parameter).</span><span class="sxs-lookup"><span data-stu-id="59f39-139">The returned HRESULT contains the S\_OK or S\_FALSE indication in response to the query, or E\_FAIL or E\_INVALIDARG some other error indication HRESULT in the event of a severe problem in protocol execution (such as an invalid.configuration parameter).</span></span> <span data-ttu-id="59f39-140">Alle Aufrufe von **iamvideoaccelerator:: Execute** für alle Verwendungen von DXVA \_ configqueryorreplyfunc müssen allen anderen Aufrufen von **iamvideoaccelerator:: Execute** vorangestellt sein.</span><span class="sxs-lookup"><span data-stu-id="59f39-140">All calls to **IAMVideoAccelerator::Execute** for all uses of DXVA\_ConfigQueryOrReplyFunc shall precede all other calls to **IAMVideoAccelerator::Execute**.</span></span>
    -   <span data-ttu-id="59f39-141">Wenn dwfunction eine DXVA- \_ Verschlüsselung enthält, muss der lpprivateinputdata-Zeiger für das Übergeben von Daten an die Zugriffstaste in diesem-Befehl auf eine Verschlüsselungsprotokoll-Datenstruktur verweisen, die mit DXVA \_ verschlüsseltprotocolheader beginnt. der lpprivateoutputdata-Zeiger zum Empfangen von Informationen von der Zugriffstaste muss auf einen Bereich verweisen, in dem die zurück zugegenden Daten (z. b. ein Zertifikat) durch das Verschlüsselungsprotokoll (das mit DXVA " \_ verschlüsseltprotocolheader" beginnt) eingefügt werden können. der pamvabufferinfo-Zeiger für ein Array von amvabufferinfo muss **null** sein, und dwnumbuffers muss NULL sein.</span><span class="sxs-lookup"><span data-stu-id="59f39-141">If dwFunction contains a DXVA\_EncryptProtocolFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to an encryption protocol data structure that begins with DXVA\_EncryptProtocolHeader, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where the data to be returned (such as a certificate) by the encryption protocol (which will begin with DXVA\_EncryptProtocolHeader) can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="59f39-142">Der zurückgegebene HRESULT-Wert enthält "S OK", solange \_ das Verschlüsselungsprotokoll normal funktioniert und e \_ Fail oder e \_ invalidArg enthält, oder ein anderes Fehler Anzeichen für ein HRESULT im Falle eines schwerwiegenden Problems bei der Protokoll Ausführung.</span><span class="sxs-lookup"><span data-stu-id="59f39-142">The returned HRESULT contains S\_OK as long as the encryption protocol is functioning normally and contains E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem in protocol execution.</span></span>
    -   <span data-ttu-id="59f39-143">Wenn dwfunction kein DXVA \_ configqueryorreplyfunc oder DXVA- \_ verschlüsselungprotocolfunc enthält, muss der lpprivateinputdata-Zeiger zum Übergeben von Daten an die Zugriffstaste auf eine Puffer Beschreibungs Liste zeigen.</span><span class="sxs-lookup"><span data-stu-id="59f39-143">If dwFunction does not contain a DXVA\_ConfigQueryOrReplyFunc or DXVA\_EncryptProtocolFunc, the lpPrivateInputData pointer for passing data to the accelerator shall point to a buffer description list.</span></span> <span data-ttu-id="59f39-144">Die ersten vier Einträge in der Puffer Beschreibungs-Listenstruktur für jeden Puffer (dwtypeindex, dwbufferindex, dwdataoffset und dwDataSize) müssen mit denen in der amvabufferinfo-Datenstruktur für denselben Puffer identisch sein.</span><span class="sxs-lookup"><span data-stu-id="59f39-144">The first four entries in the buffer description list structure for each buffer (dwTypeIndex, dwBufferIndex, dwDataOffset, and dwDataSize) shall be equal to those in the AMVABUFFERINFO data structure for the same buffer.</span></span> <span data-ttu-id="59f39-145">Wenn "bdxva \_ Func" gleich "1" ist, wird in "dwfunction" und "bpikreadbackrequests" den Wert "1" festgelegt. der lpprivateoutputdata-Zeiger zum Empfangen von Informationen von der Zugriffstaste muss auf einen Bereich des permanenten Arbeitsspeichers (z. b. Heap) zeigen, der mit den Daten aus der Zugriffstaste mit einem Read-Back-Makro (z. b. "Heap") gefüllt werden soll (solche Daten sind bis **iamvideoaccelerator: queryrenderstatus** zum Schreiben in denselben Bildparameter Puffer gibt S OK an, \_ wie in Item 10 weiter unten beschrieben.</span><span class="sxs-lookup"><span data-stu-id="59f39-145">If bDXVA\_Func is equal to "1" is specified within dwFunction and bPicReadbackRequests is "1", the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area of persistent memory (for example heap) to be filled in with read-back macroblock data from the accelerator (such data not guaranteed to be present until **IAMVideoAccelerator::QueryRenderStatus** for writing to the same picture parameters buffer indicates S\_OK as described in item 10 below).</span></span> <span data-ttu-id="59f39-146">Andernfalls muss der lpprivateoutputdata-Zeiger zum Empfangen von Informationen von der Zugriffstaste auf ein einzelnes DWORD zeigen, das auf einen der folgenden Indikatorwerte festgelegt werden soll (besonders nützlich für die Berichterstellung von Bitstrom-Fehlern in einem Out-Host-VLD-Vorgang).</span><span class="sxs-lookup"><span data-stu-id="59f39-146">Otherwise, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to a single DWORD to be set to one of the following indication values (particularly useful for reporting bitstream errors in off-host VLD operation).</span></span>

        | <span data-ttu-id="59f39-147">Wert</span><span class="sxs-lookup"><span data-stu-id="59f39-147">Value</span></span> | <span data-ttu-id="59f39-148">BESCHREIBUNG</span><span class="sxs-lookup"><span data-stu-id="59f39-148">Description</span></span>                                     |
        |-------|-------------------------------------------------|
        | <span data-ttu-id="59f39-149">0</span><span class="sxs-lookup"><span data-stu-id="59f39-149">0</span></span>     | <span data-ttu-id="59f39-150">Ausführung ist OK.</span><span class="sxs-lookup"><span data-stu-id="59f39-150">Execution OK.</span></span>                                   |
        | <span data-ttu-id="59f39-151">1</span><span class="sxs-lookup"><span data-stu-id="59f39-151">1</span></span>     | <span data-ttu-id="59f39-152">Kleinere Probleme im Datenformat.</span><span class="sxs-lookup"><span data-stu-id="59f39-152">Minor problem in data format encountered.</span></span>       |
        | <span data-ttu-id="59f39-153">2</span><span class="sxs-lookup"><span data-stu-id="59f39-153">2</span></span>     | <span data-ttu-id="59f39-154">Im Datenformat ist ein erhebliches Problem aufgetreten.</span><span class="sxs-lookup"><span data-stu-id="59f39-154">Significant problem in data format encountered.</span></span> |
        | <span data-ttu-id="59f39-155">3</span><span class="sxs-lookup"><span data-stu-id="59f39-155">3</span></span>     | <span data-ttu-id="59f39-156">Schwerwiegendes Problem im Datenformat.</span><span class="sxs-lookup"><span data-stu-id="59f39-156">Severe problem in data format encountered.</span></span>      |
        | <span data-ttu-id="59f39-157">4</span><span class="sxs-lookup"><span data-stu-id="59f39-157">4</span></span>     | <span data-ttu-id="59f39-158">Anderer schwerwiegendes Problem ist aufgetreten.</span><span class="sxs-lookup"><span data-stu-id="59f39-158">Other severe problem encountered.</span></span>               |

        

         

        <span data-ttu-id="59f39-159">Wenn ein "schwerwiegendes" Problem angegeben ist, sollte der Software Decoder den Betrieb der Funktion (en) beenden, es sei denn, es kann eine Korrekturmaßnahme durchgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="59f39-159">If either type of "severe" problem is indicated, the software decoder should cease to operate the function(s) unless corrective action can be taken.</span></span> <span data-ttu-id="59f39-160">Diese Daten, die von der Zugriffstaste zurückgegeben werden, dürfen vom Host erst gelesen werden, nachdem das Puffer Rendering für das Bild abgeschlossen ist, wie von [**iamvideoaccelerator:: queryrenderstatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus)getestet werden kann.</span><span class="sxs-lookup"><span data-stu-id="59f39-160">This data returned from the accelerator shall not be read by the host until after the buffer rendering for the picture has completed, as can be tested by [**IAMVideoAccelerator::QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus).</span></span> <span data-ttu-id="59f39-161">Das zurückgegebene HRESULT enthält den Wert "OK", solange \_ der Schnittstellen Vorgang normal funktioniert und "e \_ Fail" oder "e \_ invalidArg" oder ein anderes Fehler Anzeichen für ein schwerwiegendes Problem zurückgeben kann.</span><span class="sxs-lookup"><span data-stu-id="59f39-161">The returned HRESULT contains S\_OK as long as the interface operation is functioning normally and may return E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem.</span></span>

7.  <span data-ttu-id="59f39-162">Der Puffer für die Decodierung von Bildern muss zu den ersten Puffern gehören, die für die Decodierung der einzelnen Bilder gesendet werden, wenn [**iamvideoaccelerator:: Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute) mit bdxva \_ Func gleich "1" verwendet wird. alle Puffer für das Decodieren eines Bilds in einem Bitstrom müssen vor allen Puffern zum Decodieren der nachfolgenden Bilder gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="59f39-162">The picture decoding parameters buffer shall be among the first buffers sent for the decoding of each picture when using [**IAMVideoAccelerator::Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute) with bDXVA\_Func equal to "1", and all the buffers for decoding a picture in a bitstream shall be sent before any buffers for decoding subsequent pictures.</span></span> <span data-ttu-id="59f39-163">Wenn ein Makroblock-Steuerelement-Befehls Puffer gesendet wird, muss ein entsprechender Datenpuffer für die restdifferenz gesendet werden (mit Daten für die gleichen Makroblöcke) mit demselben **iamvideoaccelerator:: Execute** -Befehl.</span><span class="sxs-lookup"><span data-stu-id="59f39-163">If a macroblock control command buffer is sent, a corresponding residual difference data buffer shall be sent (containing data for the same macroblocks) with the same **IAMVideoAccelerator::Execute** call.</span></span>
8.  <span data-ttu-id="59f39-164">[**Iamvideoaccelerator:: Endframe**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) muss aufgerufen werden, nachdem alle komprimierten Puffer gesendet wurden, die die Erstellung des Ausgabe Inhalts in einer angegebenen nicht komprimierten Oberfläche bewirken (das Ergebnis der Vorgänge, die für wdecodedpictureindex, wdeblockedpictureindex, wblendeddestinationindex oder wpicresampledestpicindex angegeben wurden).</span><span class="sxs-lookup"><span data-stu-id="59f39-164">[**IAMVideoAccelerator::EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) shall be called after all compressed buffers have been sent that will cause the creation of the output content in a specified uncompressed surface (a result of operations specified for wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex).</span></span> <span data-ttu-id="59f39-165">Der Zweck dieses Aufrufens von **iamvideoaccelerator:: Endframe** besteht darin, die Video Zugriffstaste zu benachrichtigen, dass alle Daten, die für den angegebenen Vorgang erforderlich sind, gesendet wurden.</span><span class="sxs-lookup"><span data-stu-id="59f39-165">The purpose of this call to **IAMVideoAccelerator::EndFrame** is to notify the video accelerator hardware that all data needed for the specified operation has been sent.</span></span> <span data-ttu-id="59f39-166">Der Zeiger auf die Daten, die durch die **iamvideoaccelerator:: Endframe** -Schnittstelle gesendet werden sollen, muss auf ein einzelnes Word-"wendpictureindex" zeigen, das den Index des enden Frames enthält.</span><span class="sxs-lookup"><span data-stu-id="59f39-166">The pointer to data to send downstream through **IAMVideoAccelerator::EndFrame** shall point to a single WORD wEndPictureIndex containing the index of the frame that is ending.</span></span> <span data-ttu-id="59f39-167">Dieser Parameter muss mit dem wbeginpictureindex-Wert verglichen werden, der im vorherigen [**iamvideoaccelerator:: beginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) vor dem Senden der relevanten komprimierten Puffer angegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="59f39-167">This parameter shall match the wBeginPictureIndex value specified in the prior call to [**IAMVideoAccelerator::BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) before the sending of the relevant compressed buffers.</span></span> <span data-ttu-id="59f39-168">Im Anschluss an einen **iamvideoaccelerator:: Endframe**-Aufrufe sollte die nicht komprimierte Oberfläche mit dem Index "wendpictureindex" nicht in wdecodedpictureindex eines Bilds gefunden werden. wdeblockedpictureindex, wblendeddestinationindex oder wpicresampledestpicindex, bis nach einem weiteren Aufruf von **iamvideoaccelerator:: beginFrame** ausgegeben wird, um anzugeben, dass dies auftritt und ein s \_ OK-Ergebnis zurückgegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="59f39-168">Subsequent to a call to **IAMVideoAccelerator::EndFrame**, the uncompressed surface with index wEndPictureIndex shall not be found in any picture's wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex until after another call to **IAMVideoAccelerator::BeginFrame** is issued to announce that this will occur and an S\_OK has been returned as a result.</span></span> <span data-ttu-id="59f39-169">Allerdings kann dieser Ziel Oberflächen Index in nachfolgenden Lese Zugriffs Befehlen auftreten, wie z. b. wforwardrefpictureindex, wbackwardrefpictureindex, wpikresamplesourcepicindex oder brefpicselect \[ i \] .</span><span class="sxs-lookup"><span data-stu-id="59f39-169">However, that destination surface index may occur in subsequent read access commands such as wForwardRefPictureIndex, wBackwardRefPictureIndex, wPicResampleSourcePicIndex, or bRefPicSelect\[i\].</span></span> <span data-ttu-id="59f39-170">Der von **iamvideoaccelerator:: Endframe** zurückgegebene HRESULT-Wert muss S \_ OK sein, es sei denn, es gibt eine Art von Datenformat oder Protokollfehler. in diesem Fall kann es sich um e \_ Fail oder e \_ invalidArg oder eine andere Fehleranzeige handeln.</span><span class="sxs-lookup"><span data-stu-id="59f39-170">The HRESULT returned by **IAMVideoAccelerator::EndFrame** shall be S\_OK unless there is some kind of data format or protocol error, in which case it can be E\_FAIL or E\_INVALIDARG or some other error indication.</span></span>
9.  <span data-ttu-id="59f39-171">Bei der Feld basierten Decodierung (z. b. in MPEG-2-Bitstreams) gibt es keine 1: Eins-Zuordnung von funktionalen Bildern im Bitstrom zu unkomprimierten Oberflächen in der Zugriffstasten Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="59f39-171">In the case of field based decoding (for example, in MPEG-2 bitstreams) there will not be a one-to-one mapping of functional pictures in the bitstream to uncompressed surfaces in the accelerator interface.</span></span> <span data-ttu-id="59f39-172">Beim Decodieren von Feld Bildern in einem MPEG-2-Bitstream werden zwei "Bilder" decodiert, um eine gesamte nicht komprimierte Ausgabe Oberfläche zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="59f39-172">When decoding field pictures in an MPEG-2 bitstream, there will be two "pictures" decoded to produce one complete output uncompressed surface.</span></span> <span data-ttu-id="59f39-173">In der DirectX-VA-Schnittstellen Definition entspricht jeder Frame jeder Verwendung von wdecodedpictureindex, wdeblockedpictureindex, wblendeddestinationindex oder wpikresampledestpicindex.</span><span class="sxs-lookup"><span data-stu-id="59f39-173">In the DirectX VA interface definition, each frame corresponds to each use of wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex.</span></span> <span data-ttu-id="59f39-174">Daher sind zwei Paare von Aufrufen von **iamvideoaccelerator:: beginFrame** und **iamvideoaccelerator:: Endframe** für das Decodieren von Feld Bildern in nicht komprimierte Ausgabe Oberflächen erforderlich.</span><span class="sxs-lookup"><span data-stu-id="59f39-174">Thus two pairs of calls to **IAMVideoAccelerator::BeginFrame** and **IAMVideoAccelerator::EndFrame** are required for the decoding of field pictures into output uncompressed surfaces.</span></span>
10. <span data-ttu-id="59f39-175">Ein [**iamvideoaccelerator:: queryrenderstatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) -Befehl mit dwFlags gleich 0 (null), der nach einem **iamvideoaccelerator:: Endframe mit einem bestimmten wendpictureindex nach einem iamvideoaccelerator:: Endframe** -Befehl mit einem bestimmten wendpictureindex angezeigt wird und den Status eines gesendeten Puffers in wdecodedpictureindex überprüft, wdeblockedpictureindex, wblendeddestinationindex oder wpikresampledestpicindex gibt eine \_ OK-Angabe zurück, wenn alle Vorgänge zum Schreiben der Daten auf die nicht komprimierte Oberfläche abgeschlossen sind und "E Pending" zurückgibt, \_ Wenn der Vorgang noch nicht abgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="59f39-175">A call to [**IAMVideoAccelerator::QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) with dwFlags equal to zero which occurs sometime after a call to **IAMVideoAccelerator::EndFrame** with a particular wEndPictureIndex and checks the status of a buffer that was sent that contained the wEndPictureIndex in wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex will return an S\_OK indication if all of the operations to write the data to the uncompressed surface have completed and will return E\_PENDING if the operation has not yet completed.</span></span> <span data-ttu-id="59f39-176">E \_ Fail oder e \_ invalidArg oder ein anderer Fehler Hinweis kann im Fall eines Protokoll Fehlers zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="59f39-176">E\_FAIL or E\_INVALIDARG or some other error indication may be returned in the event of a protocol error.</span></span>

## <a name="related-topics"></a><span data-ttu-id="59f39-177">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="59f39-177">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="59f39-178">Zuordnung von DirectX-Video Beschleunigung zu iamvideoaccelerator</span><span class="sxs-lookup"><span data-stu-id="59f39-178">Mapping DirectX Video Acceleration to IAMVideoAccelerator</span></span>](mapping-directx-video-acceleration-to-iamvideoaccelerator.md)
</dt> </dl>

 

 



