---
description: Beispiele und Zuweisungen
ms.assetid: 1fbea741-f29a-4815-9885-94ca9cf4bb95
title: Beispiele und Zuweisungen
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6f9132ff2c70b5ade63f8853b5c03bacb7a25371
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/06/2021
ms.locfileid: "104567190"
---
# <a name="samples-and-allocators"></a><span data-ttu-id="e2ffd-103">Beispiele und Zuweisungen</span><span class="sxs-lookup"><span data-stu-id="e2ffd-103">Samples and Allocators</span></span>

<span data-ttu-id="e2ffd-104">Wenn eine PIN Mediendaten an eine andere Pin übergibt, übergibt sie keinen direkten Zeiger auf den Speicherpuffer.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-104">When a pin delivers media data to another pin, it does not pass a direct pointer to the memory buffer.</span></span> <span data-ttu-id="e2ffd-105">Stattdessen übermittelt Sie einen Zeiger auf ein COM-Objekt, das den Arbeitsspeicher verwaltet.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-105">Instead, it delivers a pointer to a COM object that manages the memory.</span></span> <span data-ttu-id="e2ffd-106">Dieses Objekt, das als *Medien Beispiel* bezeichnet wird, macht die [**imediasample**](/windows/desktop/api/Strmif/nn-strmif-imediasample) -Schnittstelle verfügbar.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-106">This object, called a *media sample*, exposes the [**IMediaSample**](/windows/desktop/api/Strmif/nn-strmif-imediasample) interface.</span></span> <span data-ttu-id="e2ffd-107">Die empfangende Pin greift durch Aufrufen von **imediasample** -Methoden (z. b. [**imediasample:: getpointer**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getpointer), [**imediasample:: GetSize**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getsize)) und [**imediasample:: getactualdatalength**](/windows/win32/api/strmif/nf-strmif-imediasample-getactualdatalength)auf den Speicherpuffer zu.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-107">The receiving pin accesses the memory buffer by calling **IMediaSample** methods, such as [**IMediaSample::GetPointer**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getpointer), [**IMediaSample::GetSize**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getsize), and [**IMediaSample::GetActualDataLength**](/windows/win32/api/strmif/nf-strmif-imediasample-getactualdatalength).</span></span>

<span data-ttu-id="e2ffd-108">Beispiele sind immer Downstream, von der Ausgabe-PIN an die Eingabe-PIN.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-108">Samples always travel downstream, from output pin to input pin.</span></span> <span data-ttu-id="e2ffd-109">Im Push-Modell liefert die Ausgabepin ein Beispiel, indem [**IMemInputPin:: Receive**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive) für die Eingabe-PIN aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-109">In the push model, the output pin delivers a sample by calling [**IMemInputPin::Receive**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive) on the input pin.</span></span> <span data-ttu-id="e2ffd-110">Die Eingabe-PIN verarbeitet die Daten entweder synchron (d. h. vollständig innerhalb der **Receive** -Methode) oder verarbeitet sie asynchron in einem Arbeits Thread.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-110">The input pin will either process the data synchronously (that is, completely inside the **Receive** method), or process it asynchronously on a worker thread.</span></span> <span data-ttu-id="e2ffd-111">Die eingabepin darf innerhalb der **Receive** -Methode blockiert werden, wenn Sie auf Ressourcen warten muss.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-111">The input pin is allowed to block within the **Receive** method, if it needs to wait for resources.</span></span>

<span data-ttu-id="e2ffd-112">Ein anderes com-Objekt, das als *Zuweisung* bezeichnet wird, ist für das Erstellen und Verwalten von Medien Beispielen verantwortlich.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-112">Another COM object, called an *allocator*, is responsible for creating and managing media samples.</span></span> <span data-ttu-id="e2ffd-113">Zuweisungen machen die [**imemzuzucator**](/windows/desktop/api/Strmif/nn-strmif-imemallocator) -Schnittstelle verfügbar.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-113">Allocators expose the [**IMemAllocator**](/windows/desktop/api/Strmif/nn-strmif-imemallocator) interface.</span></span> <span data-ttu-id="e2ffd-114">Wenn ein Filter ein Medien Beispiel mit einem leeren Puffer benötigt, ruft er die [**imemzuzucator:: GetBuffer**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getbuffer) -Methode auf, die einen Zeiger auf das Beispiel zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-114">Whenever a filter needs a media sample with an empty buffer, it calls the [**IMemAllocator::GetBuffer**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getbuffer) method, which returns a pointer to the sample.</span></span> <span data-ttu-id="e2ffd-115">Jede Pin-Verbindung hat eine Zuweisung gemeinsam.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-115">Every pin connection shares one allocator.</span></span> <span data-ttu-id="e2ffd-116">Wenn zwei Pins eine Verbindung herstellen, entscheiden Sie, welchen Filter die Zuweisung bereitstellen soll.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-116">When two pins connect, they decide which filter will provide the allocator.</span></span> <span data-ttu-id="e2ffd-117">Die Pins legen auch Eigenschaften für die Zuweisung fest, z. b. die Anzahl der Puffer und die Größe der einzelnen Puffer.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-117">The pins also set properties on the allocator, such as the number of buffers and the size of each buffer.</span></span> <span data-ttu-id="e2ffd-118">(Ausführliche Informationen finden Sie unter Gewusst [wie: Filtern](how-filters-connect.md) von Verbindungen und [Aushandeln von Zuweisungen](negotiating-allocators.md).)</span><span class="sxs-lookup"><span data-stu-id="e2ffd-118">(For details, see [How Filters Connect](how-filters-connect.md) and [Negotiating Allocators](negotiating-allocators.md).)</span></span>

<span data-ttu-id="e2ffd-119">Die folgende Abbildung zeigt die Beziehungen zwischen der Zuweisung, den Medien Beispielen und dem Filter.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-119">The following illustration shows the relationships among the allocator, the media samples, and the filter.</span></span>

![Medien Beispiele und-Zuweisungen](images/mediasamples.png)

<span data-ttu-id="e2ffd-121">**Verweis Zähler für Medien Beispiele**</span><span class="sxs-lookup"><span data-stu-id="e2ffd-121">**Media Sample Reference Counts**</span></span>

<span data-ttu-id="e2ffd-122">Eine Zuweisung erstellt einen begrenzten Pool von Beispielen.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-122">An allocator creates a finite pool of samples.</span></span> <span data-ttu-id="e2ffd-123">Einige Beispiele werden möglicherweise verwendet, andere sind für **GetBuffer** -Aufrufe verfügbar.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-123">At any time, some samples may be in use, while others are available for **GetBuffer** calls.</span></span> <span data-ttu-id="e2ffd-124">Der Zuweiser verwendet die Verweis Zählung, um die Beispiele nachzuverfolgen.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-124">The allocator uses reference counting to keep track of the samples.</span></span> <span data-ttu-id="e2ffd-125">Die **GetBuffer** -Methode gibt ein Beispiel mit einem Verweis Zähler von 1 zurück.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-125">The **GetBuffer** method returns a sample with a reference count of 1.</span></span> <span data-ttu-id="e2ffd-126">Wenn der Verweis Zähler auf NULL wechselt, wechselt das Beispiel zurück in den Pool des zuordcators, wo es im nächsten **GetBuffer** -Befehl verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-126">If the reference count goes to zero, the sample goes back into the allocator's pool, where it can be used in the next **GetBuffer** call.</span></span> <span data-ttu-id="e2ffd-127">Solange der Verweis Zähler über 0 (null) bleibt, ist das Beispiel für **GetBuffer** nicht verfügbar.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-127">As long as the reference count remains above zero, the sample is not available to **GetBuffer**.</span></span> <span data-ttu-id="e2ffd-128">Wenn jedes zu der Zuweisung gehörende Beispiel verwendet wird, blockiert die **GetBuffer** -Methode, bis eine Stichprobe verfügbar wird.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-128">If every sample belonging to the allocator is in use, the **GetBuffer** method blocks until a sample becomes available.</span></span>

<span data-ttu-id="e2ffd-129">Angenommen, eine Eingabe-PIN empfängt ein Beispiel.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-129">For example, suppose that an input pin receives a sample.</span></span> <span data-ttu-id="e2ffd-130">Wenn das Beispiel synchron in der **Receive** -Methode verarbeitet wird, erhöht es nicht den Verweis Zähler.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-130">If it processes the sample synchronously, inside the **Receive** method, it does not increment the reference count.</span></span> <span data-ttu-id="e2ffd-131">Nach dem **Empfang** gibt die Ausgabe-PIN das Beispiel frei, der Verweis Zähler wird auf 0 (null) zurückgesetzt, und das Beispiel kehrt in den Pool des zuordcators zurück.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-131">After **Receive** returns, the output pin releases the sample, the reference count goes to zero, and the sample returns to the allocator's pool.</span></span> <span data-ttu-id="e2ffd-132">Wenn die Eingabe-PIN dagegen das Beispiel auf einem Arbeits Thread verarbeitet, erhöht es den Verweis Zähler, bevor die **Receive** -Methode verlassen wird.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-132">On the other hand, if the input pin processes the sample on a worker thread, it increments the reference count before leaving the **Receive** method.</span></span> <span data-ttu-id="e2ffd-133">Der Verweis Zähler ist jetzt 2.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-133">The reference count is now 2.</span></span> <span data-ttu-id="e2ffd-134">Wenn die Ausgabe-PIN das Beispiel freigibt, wird die Anzahl auf 1 gesetzt. Das Beispiel wird noch nicht in den Pool zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-134">When the output pin releases the sample, the count goes to 1; the sample does not yet return to the pool.</span></span> <span data-ttu-id="e2ffd-135">Nachdem der Arbeits Thread mit dem Beispiel erstellt wurde, wird Release aufgerufen, um das Beispiel frei **zugeben** .</span><span class="sxs-lookup"><span data-stu-id="e2ffd-135">After the worker thread is done with the sample, it calls **Release** to free the sample.</span></span> <span data-ttu-id="e2ffd-136">Nun wird das Beispiel in den Pool zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-136">Now the sample returns to the pool.</span></span>

<span data-ttu-id="e2ffd-137">Wenn eine PIN eine Stichprobe empfängt, kann Sie die Daten in ein anderes Beispiel kopieren oder das ursprüngliche Beispiel ändern und diese an den nächsten Filter übermitteln.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-137">When a pin receives a sample, it can copy the data to another sample, or it can modify the original sample and deliver that one to the next filter.</span></span> <span data-ttu-id="e2ffd-138">Möglicherweise kann ein Beispiel die gesamte Länge des Diagramms übertragen, wobei jeder Filter die **adressf** aufrufen und die **Freigabe wiederum freigibt** .</span><span class="sxs-lookup"><span data-stu-id="e2ffd-138">Potentially, a sample can travel the entire length of the graph, each filter calling **AddRef** and **Release** in turn.</span></span> <span data-ttu-id="e2ffd-139">Daher muss die Ausgabepin nach dem Aufruf von **Receive** nie ein Beispiel wieder verwenden, da das Beispiel für einen downstreamfilter verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-139">Therefore, the output pin must never re-use a sample after it calls **Receive**, because a downstream filter may be using the sample.</span></span> <span data-ttu-id="e2ffd-140">Die Ausgabe-PIN muss immer **GetBuffer** aufrufen, um ein neues Beispiel zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-140">The output pin must always call **GetBuffer** to get a new sample.</span></span>

<span data-ttu-id="e2ffd-141">Dieser Mechanismus verringert die Menge an Speicher Belegung, da Filter die gleichen Puffer wieder verwenden.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-141">This mechanism reduces the amount of memory allocation, because filters re-use the same buffers.</span></span> <span data-ttu-id="e2ffd-142">Außerdem wird verhindert, dass Filter versehentlich Daten schreiben, die noch nicht verarbeitet wurden, da die Zuweisung eine Liste der verfügbaren Beispiele beibehält.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-142">It also prevents filters from accidentally writing over data that has not been processed, because the allocator maintains a list of available samples.</span></span>

<span data-ttu-id="e2ffd-143">Ein Filter kann separate Zuweisungen für die Eingabe und die Ausgabe verwenden.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-143">A filter can use separate allocators for input and output.</span></span> <span data-ttu-id="e2ffd-144">Dies kann der Fall sein, wenn die Eingabedaten erweitert werden (z. b. durch das komprimieren).</span><span class="sxs-lookup"><span data-stu-id="e2ffd-144">It might do this if it expands the input data (for example, by decompressing it).</span></span> <span data-ttu-id="e2ffd-145">Wenn die Ausgabe nicht größer als die Eingabe ist, kann ein Filter die Daten direkt verarbeiten, ohne Sie in ein neues Beispiel zu kopieren.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-145">If the output is no larger than the input, a filter might process the data in place, without copying it to a new sample.</span></span> <span data-ttu-id="e2ffd-146">In diesem Fall können zwei oder mehr Pin-Verbindungen eine Zuweisung gemeinsam verwenden.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-146">In that case, two or more pin connections can share one allocator.</span></span>

<span data-ttu-id="e2ffd-147">**Commit und Commit von Zuweisungen**</span><span class="sxs-lookup"><span data-stu-id="e2ffd-147">**Committing and Decommitting Allocators**</span></span>

<span data-ttu-id="e2ffd-148">Wenn ein Filter zuerst eine Zuweisung erstellt, hat die Zuweisung keine Speicherpuffer reserviert.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-148">When a filter first creates an allocator, the allocator has not reserved any memory buffers.</span></span> <span data-ttu-id="e2ffd-149">An diesem Punkt treten beim Aufrufen der **GetBuffer** -Methode Fehler auf.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-149">At this point, any calls to the **GetBuffer** method will fail.</span></span> <span data-ttu-id="e2ffd-150">Beim Starten des Streamings Ruft die Ausgabepin [**imemallocator:: Commit**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-commit)auf, wodurch die Zuweisung für die Zuweisung ausgeführt wird, wodurch Arbeitsspeicher belegt wird.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-150">When streaming starts, the output pin calls [**IMemAllocator::Commit**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-commit), which commits the allocator, causing it to allocate memory.</span></span> <span data-ttu-id="e2ffd-151">Pins können nun **GetBuffer** aufrufen.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-151">Pins can now call **GetBuffer**.</span></span>

<span data-ttu-id="e2ffd-152">Wenn das Streaming beendet wird, ruft die PIN [**imemzuzucator::D ecommit**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-decommit)auf, der die Zuweisung decommittet.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-152">When streaming stops, the pin calls [**IMemAllocator::Decommit**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-decommit), which decommits the allocator.</span></span> <span data-ttu-id="e2ffd-153">Alle nachfolgenden Aufrufe von **GetBuffer** schlagen fehl, bis für die Zuweisung erneut ein Commit ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-153">All subsequent calls to **GetBuffer** fail until the allocator is committed again.</span></span> <span data-ttu-id="e2ffd-154">Wenn derzeit Aufrufe von **GetBuffer** blockiert werden, die auf eine Stichprobe warten, geben Sie sofort einen Fehlercode zurück.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-154">Also, if any calls to **GetBuffer** are currently blocked waiting for a sample, they immediately return a failure code.</span></span> <span data-ttu-id="e2ffd-155">Die **Decommit** -Methode kann den Arbeitsspeicher in Abhängigkeit von der Implementierung freigeben.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-155">The **Decommit** method may or may not free the memory, depending on the implementation.</span></span> <span data-ttu-id="e2ffd-156">Beispielsweise wartet die [**cmemzuordcator**](cmemallocator.md) -Klasse, bis die dekonstruktormethode Arbeitsspeicher freigibt.</span><span class="sxs-lookup"><span data-stu-id="e2ffd-156">For example, the [**CMemAllocator**](cmemallocator.md) class waits until its destructor method to free memory.</span></span>

## <a name="related-topics"></a><span data-ttu-id="e2ffd-157">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="e2ffd-157">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="e2ffd-158">Datenfluss im Filter Diagramm</span><span class="sxs-lookup"><span data-stu-id="e2ffd-158">Data Flow in the Filter Graph</span></span>](data-flow-in-the-filter-graph.md)
</dt> </dl>

 

 
