---
description: In diesem Thema wird beschrieben, wie ein benutzerdefinierter Quell Filter für DirectShow geschrieben wird.
ms.assetid: 032f7624-2237-41cd-844a-18ed4a2e420d
title: Schreiben eines Quell Filters für DirectShow
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 87af99595a43c86be0e2f4ecaa51768a211e9674
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/06/2021
ms.locfileid: "104522520"
---
# <a name="how-to-write-a-source-filter-for-directshow"></a><span data-ttu-id="8327a-103">Schreiben eines Quell Filters für DirectShow</span><span class="sxs-lookup"><span data-stu-id="8327a-103">How to Write a Source Filter for DirectShow</span></span>

<span data-ttu-id="8327a-104">In diesem Thema wird beschrieben, wie ein benutzerdefinierter Quell Filter für DirectShow geschrieben wird.</span><span class="sxs-lookup"><span data-stu-id="8327a-104">This topic describes how to write a custom source filter for DirectShow.</span></span>

> [!Note]  
> <span data-ttu-id="8327a-105">In diesem Thema werden nur pushquellen beschrieben. Es werden keine pullquellen, z. b. der Async-Reader-Filter, oder Splitter Filter beschrieben, die eine Verbindung mit Pull-Quellen herstellen.</span><span class="sxs-lookup"><span data-stu-id="8327a-105">This topic describes push sources only; it does not describe pull sources, such as the Async Reader Filter, or splitter filters that connect to pull sources.</span></span> <span data-ttu-id="8327a-106">Informationen zu den Unterschieden zwischen *Push* -und *Pull* -Quellen finden Sie unter [Datenfluss für Filter Entwickler](data-flow-for-filter-developers.md).</span><span class="sxs-lookup"><span data-stu-id="8327a-106">For the distinction between *push* and *pull* sources, see [Data Flow for Filter Developers](data-flow-for-filter-developers.md).</span></span>

 

## <a name="the-directshow-streaming-model"></a><span data-ttu-id="8327a-107">Das DirectShow-Streamingmodell</span><span class="sxs-lookup"><span data-stu-id="8327a-107">The DirectShow Streaming Model</span></span>

<span data-ttu-id="8327a-108">Wenn Sie einen Quell Filter schreiben, ist es wichtig zu verstehen, dass eine pushquelle nicht dasselbe wie eine Live Quelle ist.</span><span class="sxs-lookup"><span data-stu-id="8327a-108">When you write a source filter, it is important to understand that a push source is not the same thing as a live source.</span></span> <span data-ttu-id="8327a-109">Eine Live Quelle ruft Daten aus einer externen Quelle, z. b. einer Kamera oder einem Netzwerkstream, ab.</span><span class="sxs-lookup"><span data-stu-id="8327a-109">A live source gets data from some external source, such as a camera or a network stream.</span></span> <span data-ttu-id="8327a-110">Im Allgemeinen kann eine Live Quelle die eingehende Daten Rate nicht steuern.</span><span class="sxs-lookup"><span data-stu-id="8327a-110">Generally, a live source cannot control the incoming rate of data.</span></span> <span data-ttu-id="8327a-111">Wenn die downstreamfilter die Daten nicht schnell genug verarbeiten, muss die Quelle Beispiele ablegen.</span><span class="sxs-lookup"><span data-stu-id="8327a-111">If the downstream filters do not consume the data fast enough, the source will need to drop samples.</span></span>

<span data-ttu-id="8327a-112">Eine pushquelle muss jedoch keine Live Quelle sein.</span><span class="sxs-lookup"><span data-stu-id="8327a-112">But a push source does not have to be a live source.</span></span> <span data-ttu-id="8327a-113">Beispielsweise kann eine pushquelle Daten aus einer lokalen Datei lesen.</span><span class="sxs-lookup"><span data-stu-id="8327a-113">For example, a push source can read data from a local file.</span></span> <span data-ttu-id="8327a-114">In diesem Fall bestimmen die nachgeschalteten rendererfilter, wie schnell die Daten aus der Quelle genutzt werden, basierend auf der Referenzuhr und den Beispiel Zeitstempeln.</span><span class="sxs-lookup"><span data-stu-id="8327a-114">In that case, the downstream renderer filters determine how fast they consume the data from the source, based on the reference clock and the sample time stamps.</span></span> <span data-ttu-id="8327a-115">Der Quell Filter liefert Stichproben so schnell wie möglich, aber der tatsächliche Datenfluss wird durch die Renderer eingeschränkt.</span><span class="sxs-lookup"><span data-stu-id="8327a-115">The source filter delivers samples as quickly as possible, but the actual data flow is gated limited by the renderers.</span></span> <span data-ttu-id="8327a-116">Die Mechanismen zum Durchlaufen des Datenflusses werden im [Datenfluss für Filter Entwickler](data-flow-for-filter-developers.md)beschrieben.</span><span class="sxs-lookup"><span data-stu-id="8327a-116">The mechanisms for gating the data flow are described in [Data Flow for Filter Developers](data-flow-for-filter-developers.md).</span></span>

<span data-ttu-id="8327a-117">Jede Ausgabe-PIN im Quell Filter erstellt einen Thread, der als *streamingthread* bezeichnet wird.</span><span class="sxs-lookup"><span data-stu-id="8327a-117">Each output pin on the source filter creates a thread called a *streaming thread*.</span></span> <span data-ttu-id="8327a-118">Die PIN liefert Beispiele für den streamingthread.</span><span class="sxs-lookup"><span data-stu-id="8327a-118">The pin delivers samples on the streaming thread.</span></span> <span data-ttu-id="8327a-119">In der Regel erfolgen alle Decodierungs-, Verarbeitungs-und Rendering-Vorgänge in diesem Thread, obwohl einige downstreamfilter zusätzliche Threads erstellen können, um Ihre Ausgabe Beispiele in die Warteschlange zu stellen</span><span class="sxs-lookup"><span data-stu-id="8327a-119">Typically, all of the decoding, processing, and rendering happens on this thread, although some downstream filters might create additional threads to queue their output samples.</span></span>

<span data-ttu-id="8327a-120">Der streamingthread führt eine-Schleife mit der folgenden Struktur aus:</span><span class="sxs-lookup"><span data-stu-id="8327a-120">The streaming thread runs a loop with the following structure:</span></span>

``` syntax
until (stopped)
  1. Get a media sample from the allocator.
  2. Fill the sample with data.
  3. Time stamp the sample. 
  4. Deliver the sample downstream.
```

<span data-ttu-id="8327a-121">Wenn keine Beispiele verfügbar sind, blockiert Schritt 1, bis eine Stichprobe verfügbar wird.</span><span class="sxs-lookup"><span data-stu-id="8327a-121">If no samples are available, step 1 blocks until a sample becomes available.</span></span> <span data-ttu-id="8327a-122">Schritt 4 kann auch blockieren. Beispielsweise kann dies blockiert werden, während das Diagramm angehalten wird.</span><span class="sxs-lookup"><span data-stu-id="8327a-122">Step 4 can also block; for example, it can block while the graph is paused.</span></span>

<span data-ttu-id="8327a-123">Die-Schleife wird so schnell wie möglich ausgeführt, aber Sie ist darauf beschränkt, wie schnell der rendererfilter die einzelnen Beispiele rendert.</span><span class="sxs-lookup"><span data-stu-id="8327a-123">The loop runs as quickly as possible, but is limited by how quickly the renderer filter renders each sample.</span></span> <span data-ttu-id="8327a-124">Wenn das Filter Diagramm eine Referenzuhr aufweist, wird die Rate durch die Präsentations Zeiten der Stichproben bestimmt.</span><span class="sxs-lookup"><span data-stu-id="8327a-124">Assuming the filter graph has a reference clock, the rate is determined by the presentation times on the samples.</span></span> <span data-ttu-id="8327a-125">Wenn keine Referenzuhr vorhanden ist, verarbeitet der Renderer die Stichproben so schnell wie möglich.</span><span class="sxs-lookup"><span data-stu-id="8327a-125">If there is no reference clock, the renderer consumes samples as quickly as possible.</span></span>

## <a name="using-csource-and-csourcestream"></a><span data-ttu-id="8327a-126">Verwenden von CSource und csourcestream</span><span class="sxs-lookup"><span data-stu-id="8327a-126">Using CSource and CSourceStream</span></span>

<span data-ttu-id="8327a-127">Die DirectShow-Basisklassen enthalten zwei Klassen, die pushquellen unterstützen: [**CSource**](csource.md) und [**csourcestream**](csourcestream.md).</span><span class="sxs-lookup"><span data-stu-id="8327a-127">The DirectShow base classes include two classes that support push sources: [**CSource**](csource.md) and [**CSourceStream**](csourcestream.md).</span></span>

-   <span data-ttu-id="8327a-128">[**CSource**](csource.md) ist die Basisklasse für den Filter und implementiert die [**ibasefilter**](/windows/desktop/api/Strmif/nn-strmif-ibasefilter) -Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="8327a-128">[**CSource**](csource.md) is the base class for the filter and implements the [**IBaseFilter**](/windows/desktop/api/Strmif/nn-strmif-ibasefilter) interface.</span></span>
-   <span data-ttu-id="8327a-129">[**Csourcestream**](csourcestream.md) ist die Basisklasse für die Ausgabe Pins und implementiert die [**IPin**](/windows/desktop/api/Strmif/nn-strmif-ipin) -Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="8327a-129">[**CSourceStream**](csourcestream.md) is the base class for the output pins, and implements the [**IPin**](/windows/desktop/api/Strmif/nn-strmif-ipin) interface.</span></span>

### <a name="output-pins"></a><span data-ttu-id="8327a-130">Ausgabe Pins</span><span class="sxs-lookup"><span data-stu-id="8327a-130">Output Pins</span></span>

<span data-ttu-id="8327a-131">Ein Quell Filter kann über mehr als eine Ausgabepin verfügen.</span><span class="sxs-lookup"><span data-stu-id="8327a-131">A source filter can have more than one output pin.</span></span> <span data-ttu-id="8327a-132">Erstellen Sie in der Konstruktormethode Ihres Filters mindestens eine PIN, die von [**csourcestream**](csourcestream.md) (eine PIN pro Ausgabestream) abgeleitet ist.</span><span class="sxs-lookup"><span data-stu-id="8327a-132">In your filter's constructor method, create one or more pins derived from [**CSourceStream**](csourcestream.md) (one pin per output stream).</span></span> <span data-ttu-id="8327a-133">Sie müssen keine Zeiger auf die Pins speichern. die Pins werden automatisch dem Filter hinzugefügt, wenn Sie erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="8327a-133">You don't need to store pointers to the pins; the pins automatically add themselves to the filter when they are created.</span></span>

### <a name="output-formats"></a><span data-ttu-id="8327a-134">Ausgabeformate</span><span class="sxs-lookup"><span data-stu-id="8327a-134">Output Formats</span></span>

<span data-ttu-id="8327a-135">Die Ausgabe-PIN verarbeitet die formataushandlung mit den folgenden [**csourcestream**](csourcestream.md) -Methoden:</span><span class="sxs-lookup"><span data-stu-id="8327a-135">The output pin handles format negotiation with the following [**CSourceStream**](csourcestream.md) methods:</span></span>



| <span data-ttu-id="8327a-136">Methode</span><span class="sxs-lookup"><span data-stu-id="8327a-136">Method</span></span>                                                 | <span data-ttu-id="8327a-137">BESCHREIBUNG</span><span class="sxs-lookup"><span data-stu-id="8327a-137">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|--------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="8327a-138">**Getmediatype**</span><span class="sxs-lookup"><span data-stu-id="8327a-138">**GetMediaType**</span></span>](csourcestream-getmediatype.md)     | <span data-ttu-id="8327a-139">Ruft einen Medientyp aus der Ausgabe-PIN ab.</span><span class="sxs-lookup"><span data-stu-id="8327a-139">Gets a media type from the output pin.</span></span> <br/> <span data-ttu-id="8327a-140">Die PIN muss mindestens einen Medientyp vorschlagen, da der Downstream-Filter möglicherweise keine Typen vorschlägt.</span><span class="sxs-lookup"><span data-stu-id="8327a-140">The pin must propose at least one media type, because the downstream filter might not propose any types.</span></span> <span data-ttu-id="8327a-141">In den meisten Fällen ist der Downstream-Filter ein Decoder oder ein Renderer, je nachdem, ob der Quell Filter komprimierte oder nicht komprimierte Daten bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="8327a-141">In most cases, the downstream filter will be a decoder or a renderer, depending on whether the source filter delivers compressed or uncompressed data.</span></span> <span data-ttu-id="8327a-142">Ein rendererfilter erfordert in der Regel einen vollständigen Medientyp, der alle zum Rendern des Streams erforderlichen Formatierungsinformationen enthält.</span><span class="sxs-lookup"><span data-stu-id="8327a-142">A renderer filter usually requires a complete media type, containing all of the format information needed to render the stream.</span></span> <span data-ttu-id="8327a-143">Bei einem Decoder hängt die Menge der Informationen, die im Medientyp erforderlich ist, stark vom Codierungsformat ab.</span><span class="sxs-lookup"><span data-stu-id="8327a-143">For a decoder, the amount of information that is required in the media type depends very much on the encoding format.</span></span><br/> |
| [<span data-ttu-id="8327a-144">**Checkmediatype**</span><span class="sxs-lookup"><span data-stu-id="8327a-144">**CheckMediaType**</span></span>](csourcestream-checkmediatype.md) | <span data-ttu-id="8327a-145">Überprüft, ob die Ausgabepin einen bestimmten Medientyp akzeptiert.</span><span class="sxs-lookup"><span data-stu-id="8327a-145">Checks if the output pin accepts a given media type.</span></span> <span data-ttu-id="8327a-146">Das Überschreiben dieser Methode ist optional, je nachdem, wie Sie " [**getmediatype**](csourcestream-getmediatype.md)" implementieren.</span><span class="sxs-lookup"><span data-stu-id="8327a-146">Overriding this method is optional, depending on how you implement [**GetMediaType**](csourcestream-getmediatype.md).</span></span>                                                                                                                                                                                                                                                                                                                                                                                                         |



 

<span data-ttu-id="8327a-147">Die [**getmediatype**](csourcestream-getmediatype.md) -Methode ist überladen:</span><span class="sxs-lookup"><span data-stu-id="8327a-147">The [**GetMediaType**](csourcestream-getmediatype.md) method is overloaded:</span></span>

-   <span data-ttu-id="8327a-148">[**Getmediatype**](csourcestream-getmediatype.md) (1) übernimmt einen einzelnen Parameter, einen Zeiger auf ein [**cmediatype**](cmediatype.md) -Objekt.</span><span class="sxs-lookup"><span data-stu-id="8327a-148">[**GetMediaType**](csourcestream-getmediatype.md) (1) takes a single parameter, a pointer to a [**CMediaType**](cmediatype.md) object.</span></span>
-   <span data-ttu-id="8327a-149">[**Getmediatype**](csourcestream-getmediatype2.md) (2) nimmt eine Index Variable und einen Zeiger auf ein [**cmediatype**](cmediatype.md) -Objekt an.</span><span class="sxs-lookup"><span data-stu-id="8327a-149">[**GetMediaType**](csourcestream-getmediatype2.md) (2) takes an index variable and a pointer to a [**CMediaType**](cmediatype.md) object.</span></span>

<span data-ttu-id="8327a-150">Wenn die Ausgabe-PIN des Quell Filters genau ein Medienformat unterstützt, sollten Sie (1) überschreiben, um das [**cmediatype**](cmediatype.md) -Objekt mit diesem Format zu initialisieren.</span><span class="sxs-lookup"><span data-stu-id="8327a-150">If the source filter's output pin supports exactly one media format, you should override (1) to initialize the [**CMediaType**](cmediatype.md) object with that format.</span></span> <span data-ttu-id="8327a-151">Belassen Sie die Standard Implementierung von (2), und belassen Sie auch die Standard Implementierung von [**checkmediatype**](csourcestream-checkmediatype.md).</span><span class="sxs-lookup"><span data-stu-id="8327a-151">Leave the default implementation of (2) and also leave the default implementation of [**CheckMediaType**](csourcestream-checkmediatype.md).</span></span>

<span data-ttu-id="8327a-152">Wenn die PIN mehr als ein Format unterstützt, überschreiben Sie (2).</span><span class="sxs-lookup"><span data-stu-id="8327a-152">If the pin supports more than one format, override (2).</span></span> <span data-ttu-id="8327a-153">Initialisieren Sie das [**cmediatype**](cmediatype.md) -Objekt gemäß dem Wert der Index Variable.</span><span class="sxs-lookup"><span data-stu-id="8327a-153">Initialize the [**CMediaType**](cmediatype.md) object according to the value of the index variable.</span></span> <span data-ttu-id="8327a-154">Die PIN sollte die Formate als geordnete Liste zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="8327a-154">The pin should return the formats as an ordered list.</span></span> <span data-ttu-id="8327a-155">In diesem Fall müssen Sie auch den [**checkmediatype**](csourcestream-checkmediatype.md) außer Kraft setzen, um den Medientyp mit der Liste der Formate zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="8327a-155">In this case, you must also override the [**CheckMediaType**](csourcestream-checkmediatype.md) to check the media type against your list of formats.</span></span>

<span data-ttu-id="8327a-156">Beachten Sie, dass der Downstream-Filter für nicht komprimierte Videoformate Formate mit verschiedenen Stride-Werten vorschlagen kann.</span><span class="sxs-lookup"><span data-stu-id="8327a-156">For uncompressed video formats, remember that the downstream filter can propose formats with various stride values.</span></span> <span data-ttu-id="8327a-157">Der Filter sollte jeden gültigen Stride-Wert akzeptieren.</span><span class="sxs-lookup"><span data-stu-id="8327a-157">Your filter should accept any valid stride value.</span></span> <span data-ttu-id="8327a-158">Weitere Informationen finden Sie unter [**BITMAPINFOHEADER**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfoheader).</span><span class="sxs-lookup"><span data-stu-id="8327a-158">For more information, see [**BITMAPINFOHEADER**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfoheader).</span></span>

<span data-ttu-id="8327a-159">Sie müssen auch die pure-Virtual [**cbaseoutputpin::D ecidebuffersize**](cbaseoutputpin-decidebuffersize.md) -Methode überschreiben.</span><span class="sxs-lookup"><span data-stu-id="8327a-159">You must also override the pure-virtual [**CBaseOutputPin::DecideBufferSize**](cbaseoutputpin-decidebuffersize.md) method.</span></span> <span data-ttu-id="8327a-160">Verwenden Sie diese Methode, um die Größe der Beispiel Puffer festzulegen.</span><span class="sxs-lookup"><span data-stu-id="8327a-160">Use this method to set the size of the sample buffers.</span></span>

### <a name="streaming"></a><span data-ttu-id="8327a-161">Streaming</span><span class="sxs-lookup"><span data-stu-id="8327a-161">Streaming</span></span>

<span data-ttu-id="8327a-162">Die [**csourcestream**](csourcestream.md) -Klasse erstellt den streamingthread für die PIN.</span><span class="sxs-lookup"><span data-stu-id="8327a-162">The [**CSourceStream**](csourcestream.md) class creates the streaming thread for the pin.</span></span> <span data-ttu-id="8327a-163">Die Thread Prozedur wird in der [**csourcestream::D obufferprocessingloop**](csourcestream-dobufferprocessingloop.md) -Methode implementiert.</span><span class="sxs-lookup"><span data-stu-id="8327a-163">The thread procedure is implemented in the [**CSourceStream::DoBufferProcessingLoop**](csourcestream-dobufferprocessingloop.md) method.</span></span> <span data-ttu-id="8327a-164">Diese Methode ruft die pure-Virtual [**csourcestream:: FillBuffer**](csourcestream-fillbuffer.md) -Methode auf, die von der abgeleiteten Klasse überschrieben werden muss.</span><span class="sxs-lookup"><span data-stu-id="8327a-164">This method calls the pure-virtual [**CSourceStream::FillBuffer**](csourcestream-fillbuffer.md) method, which the derived class must override.</span></span> <span data-ttu-id="8327a-165">Bei dieser Methode füllt der PIN den Puffer mit Daten.</span><span class="sxs-lookup"><span data-stu-id="8327a-165">This method is where the pin fills the buffer with data.</span></span> <span data-ttu-id="8327a-166">Wenn Ihr Filter beispielsweise unkomprimierte Videos bereitstellt, können Sie die Video Frames zeichnen.</span><span class="sxs-lookup"><span data-stu-id="8327a-166">For example, if your filter delivers uncompressed video, this is where you would draw the video frames.</span></span>

<span data-ttu-id="8327a-167">Die-Basisklasse startet und beendet automatisch die Thread Schleife, wenn der Filter anhält oder angehalten wird.</span><span class="sxs-lookup"><span data-stu-id="8327a-167">The base class automatically starts and stops the thread loop at the right times, when the filter pauses or stops.</span></span> <span data-ttu-id="8327a-168">In diesem Fall ruft die [**csourcestream**](csourcestream.md) -Klasse einige Methoden auf, um die abgeleitete Klasse zu benachrichtigen:</span><span class="sxs-lookup"><span data-stu-id="8327a-168">When this happens, the [**CSourceStream**](csourcestream.md) class calls some methods to notify your derived class:</span></span>

-   [<span data-ttu-id="8327a-169">**Csourcestream:: onthreadcreate**</span><span class="sxs-lookup"><span data-stu-id="8327a-169">**CSourceStream::OnThreadCreate**</span></span>](csourcestream-onthreadcreate.md)
-   [<span data-ttu-id="8327a-170">**Csourcestream:: onthreaddestroy**</span><span class="sxs-lookup"><span data-stu-id="8327a-170">**CSourceStream::OnThreadDestroy**</span></span>](csourcestream-onthreaddestroy.md)
-   [<span data-ttu-id="8327a-171">**Csourcestream:: onthreadstartplay**</span><span class="sxs-lookup"><span data-stu-id="8327a-171">**CSourceStream::OnThreadStartPlay**</span></span>](csourcestream-onthreadstartplay.md)

<span data-ttu-id="8327a-172">Sie können diese Methoden überschreiben, wenn Sie eine spezielle Behandlung hinzufügen müssen.</span><span class="sxs-lookup"><span data-stu-id="8327a-172">You can override these methods if you need to add any special handling.</span></span> <span data-ttu-id="8327a-173">Andernfalls geben die Standard Implementierungen einfach **S \_ OK** zurück.</span><span class="sxs-lookup"><span data-stu-id="8327a-173">Otherwise, the default implementations simply return **S\_OK**.</span></span>

## <a name="seeking"></a><span data-ttu-id="8327a-174">Diejenigen</span><span class="sxs-lookup"><span data-stu-id="8327a-174">Seeking</span></span>

<span data-ttu-id="8327a-175">Wenn Sie über einen Quell Filter mit einem Ausgabepin verfügen, können Sie die [**csourceseeking**](csourceseeking.md) -Klasse als Ausgangspunkt für die Implementierung der Suche verwenden.</span><span class="sxs-lookup"><span data-stu-id="8327a-175">If you have a source filter with one output pin, you can use the [**CSourceSeeking**](csourceseeking.md) class as a starting point for implementing seeking.</span></span> <span data-ttu-id="8327a-176">Erben Sie Ihre PIN-Klasse sowohl aus [**csourcestream**](csourcestream.md) als auch aus **csourceseeking**.</span><span class="sxs-lookup"><span data-stu-id="8327a-176">Inherit your pin class from both [**CSourceStream**](csourcestream.md) and **CSourceSeeking**.</span></span>

> [!Note]  
> <span data-ttu-id="8327a-177">[**Csourceseeking**](csourceseeking.md) wird nicht für einen Filter mit mehr als einer Ausgabe-PIN empfohlen.</span><span class="sxs-lookup"><span data-stu-id="8327a-177">[**CSourceSeeking**](csourceseeking.md) is not recommended for a filter with more than one output pin.</span></span> <span data-ttu-id="8327a-178">Das Hauptproblem besteht darin, dass nur eine PIN auf Suchanforderungen reagieren soll.</span><span class="sxs-lookup"><span data-stu-id="8327a-178">The main issue is that only one pin should respond to seeking requests.</span></span> <span data-ttu-id="8327a-179">Dies erfordert in der Regel die Kommunikation zwischen den Pins und dem Filter.</span><span class="sxs-lookup"><span data-stu-id="8327a-179">Typically this requires communication among the pins and the filter.</span></span>

 

<span data-ttu-id="8327a-180">Die [**csourceseeking**](csourceseeking.md) -Klasse verwaltet die Wiedergabe Rate, die Startzeit, die Endzeit und die Dauer.</span><span class="sxs-lookup"><span data-stu-id="8327a-180">The [**CSourceSeeking**](csourceseeking.md) class manages the playback rate, start time, stop time, and duration.</span></span> <span data-ttu-id="8327a-181">Die abgeleitete Klasse sollte die anfängliche Endzeit und die Dauer festlegen.</span><span class="sxs-lookup"><span data-stu-id="8327a-181">Your derived class should set the initial stop time and duration.</span></span> <span data-ttu-id="8327a-182">Wenn sich einer dieser Werte ändert, wird die [**csourceseeking:: changerate**](csourceseeking-changerate.md)-, [**csourceseeking:: changestart**](csourceseeking-changestart.md)-oder [**csourceseeking:: changestoppt**](csourceseeking-changestop.md) -Methode entsprechend aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="8327a-182">Whenever one of these values changes, the [**CSourceSeeking::ChangeRate**](csourceseeking-changerate.md), [**CSourceSeeking::ChangeStart**](csourceseeking-changestart.md), or [**CSourceSeeking::ChangeStop**](csourceseeking-changestop.md) method is called, as appropriate.</span></span> <span data-ttu-id="8327a-183">Bei den Methoden handelt es sich um reine virtuelle Methoden.</span><span class="sxs-lookup"><span data-stu-id="8327a-183">The methods are all pure virtual methods.</span></span> <span data-ttu-id="8327a-184">Die abgeleitete Pin-Klasse überschreibt diese Methoden, um Folgendes durchzuführen:</span><span class="sxs-lookup"><span data-stu-id="8327a-184">The derived pin class overrides these methods to do the following:</span></span>

1.  <span data-ttu-id="8327a-185">Aufrufen von [**IPin:: beginflush**](/windows/desktop/api/Strmif/nf-strmif-ipin-beginflush) auf der Downstream-PIN.</span><span class="sxs-lookup"><span data-stu-id="8327a-185">Call [**IPin::BeginFlush**](/windows/desktop/api/Strmif/nf-strmif-ipin-beginflush) on the downstream pin.</span></span> <span data-ttu-id="8327a-186">Dies bewirkt, dass Downstream-Filter Stichproben freigeben und neue Beispiele ablehnen.</span><span class="sxs-lookup"><span data-stu-id="8327a-186">This causes downstream filters to release samples they are holding and reject new samples.</span></span>
2.  <span data-ttu-id="8327a-187">[**Csourcestream:: Beendigung**](csourcestream-stop.md) aufrufen, um den Streaminginhalt zu verhindern.</span><span class="sxs-lookup"><span data-stu-id="8327a-187">Call [**CSourceStream::Stop**](csourcestream-stop.md) to stop the streaming thread.</span></span> <span data-ttu-id="8327a-188">Der Quell Filter hält die Erstellung neuer Daten an.</span><span class="sxs-lookup"><span data-stu-id="8327a-188">The source filter suspends producing new data.</span></span>
3.  <span data-ttu-id="8327a-189">Nennen Sie [**IPin:: endflush**](/windows/desktop/api/Strmif/nf-strmif-ipin-endflush) für die downstreampin.</span><span class="sxs-lookup"><span data-stu-id="8327a-189">Call [**IPin::EndFlush**](/windows/desktop/api/Strmif/nf-strmif-ipin-endflush) on the downstream pin.</span></span> <span data-ttu-id="8327a-190">Dies signalisiert den downstreamfiltern, neue Daten zu akzeptieren.</span><span class="sxs-lookup"><span data-stu-id="8327a-190">This signals the downstream filters to accept new data.</span></span>
4.  <span data-ttu-id="8327a-191">Nennen Sie [**IPin:: newsegment**](/windows/desktop/api/Strmif/nf-strmif-ipin-newsegment) mit den neuen Start-und Endzeit Zeiten und der Geschwindigkeit.</span><span class="sxs-lookup"><span data-stu-id="8327a-191">Call [**IPin::NewSegment**](/windows/desktop/api/Strmif/nf-strmif-ipin-newsegment) with the new start and stop times and rate.</span></span>
5.  <span data-ttu-id="8327a-192">Legen Sie die Diskontinuität-Eigenschaft für das nächste Beispiel fest.</span><span class="sxs-lookup"><span data-stu-id="8327a-192">Set the discontinuity property on the next sample.</span></span>

<span data-ttu-id="8327a-193">Weitere Informationen finden Sie [unter unterstützen von Such Vorschauen in einem Quell Filter](supporting-seeking-in-a-source-filter.md).</span><span class="sxs-lookup"><span data-stu-id="8327a-193">For more information, see [Supporting Seeking in a Source Filter](supporting-seeking-in-a-source-filter.md).</span></span>

<span data-ttu-id="8327a-194">Wenn der Filter Suchvorgänge unterstützt, ist die Streamposition jetzt unabhängig von der Präsentationszeit.</span><span class="sxs-lookup"><span data-stu-id="8327a-194">If your filter supports seeking, the stream position is now independent of the presentation time.</span></span> <span data-ttu-id="8327a-195">Nach einer Suche werden Zeitstempel auf 0 (null) zurückgesetzt.</span><span class="sxs-lookup"><span data-stu-id="8327a-195">After a seek, time stamps reset to zero.</span></span> <span data-ttu-id="8327a-196">Die allgemeine Formel für Zeitstempel lautet:</span><span class="sxs-lookup"><span data-stu-id="8327a-196">The general formula for time stamps is:</span></span>

-   <span data-ttu-id="8327a-197">Beispiel Startzeit = verstrichene Zeit/Wiedergabe Rate</span><span class="sxs-lookup"><span data-stu-id="8327a-197">sample start time = time elapsed / playback rate</span></span>
-   <span data-ttu-id="8327a-198">Beispiel Endzeit = Stichproben Startzeit + (Zeit pro Frame/Wiedergabe Rate)</span><span class="sxs-lookup"><span data-stu-id="8327a-198">sample end time = sample start time + (time per frame / playback rate)</span></span>

<span data-ttu-id="8327a-199">die *verstrichene Zeit* ist die verstrichene Zeit seit Beginn der Ausführung des Filters oder seit dem letzten Seek-Befehl.</span><span class="sxs-lookup"><span data-stu-id="8327a-199">where *time elapsed* is the time that has elapsed since the filter started running or since the last seek command.</span></span>

### <a name="time-formats-for-seeking"></a><span data-ttu-id="8327a-200">Zeitformate für Suchvorgänge</span><span class="sxs-lookup"><span data-stu-id="8327a-200">Time Formats for Seeking</span></span>

<span data-ttu-id="8327a-201">Standardmäßig befinden sich Such Befehle in Einheiten von 100-Nanosekunden.</span><span class="sxs-lookup"><span data-stu-id="8327a-201">By default, seek commands are in units of 100-nanoseconds.</span></span> <span data-ttu-id="8327a-202">Der Quell Filter kann zusätzliche Zeitformate unterstützen, z. b. die Suche nach Frame Nummer.</span><span class="sxs-lookup"><span data-stu-id="8327a-202">Your source filter can support additional time formats, such as seeking by frame number.</span></span> <span data-ttu-id="8327a-203">Jedes Zeitformat wird durch eine GUID identifiziert. siehe [**Zeit Format-GUIDs**](time-format-guids.md).</span><span class="sxs-lookup"><span data-stu-id="8327a-203">Each time format is identified by a GUID; see [**Time Format GUIDs**](time-format-guids.md).</span></span>

<span data-ttu-id="8327a-204">Um zusätzliche Zeitformate zu unterstützen, müssen Sie die folgenden Methoden für die Ausgabepin implementieren:</span><span class="sxs-lookup"><span data-stu-id="8327a-204">To support additional time formats, you must implement the following methods on your output pin:</span></span>

-   [<span data-ttu-id="8327a-205">**Imediaseeking:: converttimeformat**</span><span class="sxs-lookup"><span data-stu-id="8327a-205">**IMediaSeeking::ConvertTimeFormat**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-converttimeformat)
-   [<span data-ttu-id="8327a-206">**Imediaseeking:: getTimeFormat**</span><span class="sxs-lookup"><span data-stu-id="8327a-206">**IMediaSeeking::GetTimeFormat**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-gettimeformat)
-   [<span data-ttu-id="8327a-207">**Imediaseeking:: isformatsupported**</span><span class="sxs-lookup"><span data-stu-id="8327a-207">**IMediaSeeking::IsFormatSupported**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-isformatsupported)
-   [<span data-ttu-id="8327a-208">**Imediaseeking:: isusingtimeformat**</span><span class="sxs-lookup"><span data-stu-id="8327a-208">**IMediaSeeking::IsUsingTimeFormat**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-isusingtimeformat)
-   [<span data-ttu-id="8327a-209">**Imediaseeking:: querypreferredformat**</span><span class="sxs-lookup"><span data-stu-id="8327a-209">**IMediaSeeking::QueryPreferredFormat**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-querypreferredformat)
-   [<span data-ttu-id="8327a-210">**Imediaseeking:: settimeformat**</span><span class="sxs-lookup"><span data-stu-id="8327a-210">**IMediaSeeking::SetTimeFormat**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-settimeformat)

<span data-ttu-id="8327a-211">Wenn die Anwendung ein neues Zeitformat festlegt, werden alle Positions Parameter in den [**imediaseeking**](/windows/desktop/api/Strmif/nn-strmif-imediaseeking) -Methoden im Hinblick auf das neue Zeitformat interpretiert.</span><span class="sxs-lookup"><span data-stu-id="8327a-211">If the application sets a new time format, all of the position parameters in the [**IMediaSeeking**](/windows/desktop/api/Strmif/nn-strmif-imediaseeking) methods are interpreted in terms of the new time format.</span></span> <span data-ttu-id="8327a-212">Wenn das Zeitformat z. b. Frames ist, muss die [**imediaseeking:: getduration**](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-getduration) -Methode die Dauer in Frames zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="8327a-212">For example, if the time format is frames, the [**IMediaSeeking::GetDuration**](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-getduration) method must return the duration in frames.</span></span>

<span data-ttu-id="8327a-213">In der Praxis unterstützen nur wenige DirectShow-Filter zusätzliche Zeitformate. Folglich nutzen einige DirectShow-Anwendungen diese Funktion.</span><span class="sxs-lookup"><span data-stu-id="8327a-213">In practice, few DirectShow filters support additional time formats, and as a result, few DirectShow applications make use of this capability.</span></span>

## <a name="related-topics"></a><span data-ttu-id="8327a-214">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="8327a-214">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="8327a-215">Schreiben von Quell Filtern</span><span class="sxs-lookup"><span data-stu-id="8327a-215">Writing Source Filters</span></span>](writing-source-filters.md)
</dt> </dl>

 

 




