---
description: Bereitstellen eines benutzerdefinierten Allocator-Presenter für VMR-9
ms.assetid: 61bb6b0d-25b5-481b-a241-74c6e421f109
title: Bereitstellen eines benutzerdefinierten Allocator-Presenter für VMR-9
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f004e119fc1cbfc167c2130852a4f59700706fcc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "106369064"
---
# <a name="supplying-a-custom-allocator-presenter-for-vmr-9"></a><span data-ttu-id="f29e0-103">Bereitstellen eines benutzerdefinierten Allocator-Presenter für VMR-9</span><span class="sxs-lookup"><span data-stu-id="f29e0-103">Supplying a Custom Allocator-Presenter for VMR-9</span></span>

<span data-ttu-id="f29e0-104">Führen Sie die folgenden Schritte aus, um eine benutzerdefinierte Zuordnung mit dem Filter Video Mischungs-Renderer 9 (VMR-9) zu verwenden:</span><span class="sxs-lookup"><span data-stu-id="f29e0-104">To use a custom allocator-presenter with the Video Mixing Renderer 9 (VMR-9) filter, perform the following steps:</span></span>

1.  <span data-ttu-id="f29e0-105">Implementieren Sie eine Klasse, die die Schnittstellen [**IVMRSurfaceAllocator9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrsurfaceallocator9) und [**IVMRImagePresenter9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrimagepresenter9) unterstützt.</span><span class="sxs-lookup"><span data-stu-id="f29e0-105">Implement a class that supports the [**IVMRSurfaceAllocator9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrsurfaceallocator9) and [**IVMRImagePresenter9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrimagepresenter9) interfaces.</span></span>
2.  <span data-ttu-id="f29e0-106">Ruft **QueryInterface** für den VMR-9-Filter für die [**IVMRFilterConfig9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrfilterconfig9) -Schnittstelle auf.</span><span class="sxs-lookup"><span data-stu-id="f29e0-106">Call **QueryInterface** on the VMR-9 filter for the [**IVMRFilterConfig9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrfilterconfig9) interface.</span></span>
3.  <span data-ttu-id="f29e0-107">Nennen Sie die [**IVMRFilterConfig9:: setrenderingmode**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrfilterconfig9-setrenderingmode) -Methode, und übergeben Sie das **VMR9Mode \_ Renderless** -Flag.</span><span class="sxs-lookup"><span data-stu-id="f29e0-107">Call the [**IVMRFilterConfig9::SetRenderingMode**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrfilterconfig9-setrenderingmode) method and pass in the **VMR9Mode\_Renderless** flag.</span></span>
4.  <span data-ttu-id="f29e0-108">**QueryInterface** für den VMR-9-Filter für die [**IVMRSurfaceAllocatorNotify9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrsurfaceallocatornotify9) -Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="f29e0-108">**QueryInterface** on the VMR-9 filter for the [**IVMRSurfaceAllocatorNotify9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrsurfaceallocatornotify9) interface.</span></span>
5.  <span data-ttu-id="f29e0-109">Nennen Sie die [**IVMRSurfaceAllocatorNotify9:: advisesurfacezuweisung**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-advisesurfaceallocator) -Methode, und übergeben Sie einen Zeiger auf die [**IVMRSurfaceAllocator9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrsurfaceallocator9) -Methode Ihres Zuordners.</span><span class="sxs-lookup"><span data-stu-id="f29e0-109">Call the [**IVMRSurfaceAllocatorNotify9::AdviseSurfaceAllocator**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-advisesurfaceallocator) method and pass in a pointer to your allocator-presenter's [**IVMRSurfaceAllocator9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrsurfaceallocator9) method.</span></span>
6.  <span data-ttu-id="f29e0-110">Nennen Sie die [**IVMRSurfaceAllocator9:: advisenotify**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocator9-advisenotify) -Methode Ihres Zuordners und übergeben Sie einen Zeiger auf die [**IVMRSurfaceAllocatorNotify9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrsurfaceallocatornotify9) -Schnittstelle des VMR-9-Filters.</span><span class="sxs-lookup"><span data-stu-id="f29e0-110">Call your allocator-presenter's [**IVMRSurfaceAllocator9::AdviseNotify**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocator9-advisenotify) method and pass in a pointer to the VMR-9 filter's [**IVMRSurfaceAllocatorNotify9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrsurfaceallocatornotify9) interface.</span></span>
7.  <span data-ttu-id="f29e0-111">Geben Sie in ihrer Implementierung von [**IVMRSurfaceAllocator9:: advisenotify**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocator9-advisenotify)den Befehl [**IVMRSurfaceAllocatorNotify9:: SetD3DDevice**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-setd3ddevice) Pass an einen Zeiger auf das Direct3D-Gerät und ein Handle für den Monitor an, in dem das Video angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="f29e0-111">In your implementation of [**IVMRSurfaceAllocator9::AdviseNotify**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocator9-advisenotify), call [**IVMRSurfaceAllocatorNotify9::SetD3DDevice**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-setd3ddevice) Pass in a pointer to the Direct3D device and a handle to the monitor where the video will appear.</span></span>
8.  <span data-ttu-id="f29e0-112">Erstellen Sie in ihrer Implementierung der [**IVMRSurfaceAllocator9:: initializedevice**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocator9-initializedevice) -Methode Direct3D-Oberflächen, die den in der **initializedevice** -Methode angegebenen Parametern entsprechen.</span><span class="sxs-lookup"><span data-stu-id="f29e0-112">In your implementation of the [**IVMRSurfaceAllocator9::InitializeDevice**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocator9-initializedevice) method, Create Direct3D surfaces that match the parameters given in the **InitializeDevice** method.</span></span> <span data-ttu-id="f29e0-113">Optional können Sie die [**IVMRSurfaceAllocatorNotify9:: alloskiesurfacehelper**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-allocatesurfacehelper) -Methode des VMR-9-Filters verwenden, um diese Oberflächen zuzuordnen.</span><span class="sxs-lookup"><span data-stu-id="f29e0-113">Optionally, you can use the VMR-9 filter's [**IVMRSurfaceAllocatorNotify9::AllocateSurfaceHelper**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-allocatesurfacehelper) method to allocate these surfaces.</span></span> <span data-ttu-id="f29e0-114">Speichert die Oberflächen Zeiger in einem Array.</span><span class="sxs-lookup"><span data-stu-id="f29e0-114">Store the surface pointers in an array.</span></span>
    > [!Note]  
    > <span data-ttu-id="f29e0-115">Wenn die Video Frames von VMR-9 auf eine Textur Oberfläche gezeichnet werden sollen, fügen Sie der [**VMR9AllocationInfo**](/previous-versions/windows/desktop/api/Vmr9/ns-vmr9-vmr9allocationinfo) -Struktur das **VMR9AllocFlag \_ texturesurface** -Flag hinzu.</span><span class="sxs-lookup"><span data-stu-id="f29e0-115">If you want the VMR-9 to draw the video frames onto a texture surface, add the **VMR9AllocFlag\_TextureSurface** flag to the [**VMR9AllocationInfo**](/previous-versions/windows/desktop/api/Vmr9/ns-vmr9-vmr9allocationinfo) structure.</span></span> <span data-ttu-id="f29e0-116">Wenn das Gerät keine Texturen im systemeigenen Videoformat unterstützt, müssen Sie möglicherweise eine separate Textur Oberfläche erstellen und dann die Video Frames von der Video Oberfläche in die Textur kopieren.</span><span class="sxs-lookup"><span data-stu-id="f29e0-116">If the device does not support textures in the native video format, you might need to create a separate texture surface, and then copy the video frames from the video surface to the texture.</span></span>

     

9.  <span data-ttu-id="f29e0-117">Während des Streamings ruft VMR-9 Oberflächen aus dem zuordnerpresenter ab, indem die [**IVMRSurfaceAllocator9:: getSurface**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocator9-getsurface) -Methode aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="f29e0-117">During streaming, the VMR-9 gets surfaces from the allocator-presenter by calling the [**IVMRSurfaceAllocator9::GetSurface**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocator9-getsurface) method.</span></span> <span data-ttu-id="f29e0-118">VMR-9 gibt die Oberfläche nach dem Index innerhalb des Oberflächen Arrays an (Schritt 8).</span><span class="sxs-lookup"><span data-stu-id="f29e0-118">The VMR-9 specifies the surface by its index within the surface array (step 8).</span></span>
10. <span data-ttu-id="f29e0-119">Präsentieren Sie das Bild, wenn VMR-9 die [**IVMRImagePresenter9::P resentimage**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrimagepresenter9-presentimage) -Methode aufruft.</span><span class="sxs-lookup"><span data-stu-id="f29e0-119">Present the image when the VMR-9 calls the [**IVMRImagePresenter9::PresentImage**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrimagepresenter9-presentimage) method.</span></span> <span data-ttu-id="f29e0-120">Die Parameter enthalten einen Zeiger auf die Direct3D-Oberfläche, die das Video Bild enthält.</span><span class="sxs-lookup"><span data-stu-id="f29e0-120">The parameters include a pointer to the Direct3D surface that contains the video image.</span></span>
11. <span data-ttu-id="f29e0-121">Wenn das Direct3D-Gerät zu einem beliebigen Zeitpunkt verloren geht, muss der zuordnerpresenter das Gerät wiederherstellen und die Oberflächen neu erstellen.</span><span class="sxs-lookup"><span data-stu-id="f29e0-121">If the Direct3D device is lost at any time, the allocator-presenter must restore the device and recreate the surfaces.</span></span> <span data-ttu-id="f29e0-122">Beispielsweise kann das Gerät verloren gehen, wenn sich der Anzeigemodus ändert oder der Benutzer das Fenster auf einen anderen Monitor verschiebt.</span><span class="sxs-lookup"><span data-stu-id="f29e0-122">For example, the device can be lost if the display mode changes or the user moves the window to another monitor.</span></span> <span data-ttu-id="f29e0-123">Wenn das Direct3D-Gerät geändert wird, wird die [**IVMRSurfaceAllocatorNotify9:: ChangeD3DDevice**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-changed3ddevice) -Methode des VMR-9-Filters aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="f29e0-123">If the Direct3D device changes, call the VMR-9 filter's [**IVMRSurfaceAllocatorNotify9::ChangeD3DDevice**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-changed3ddevice) method.</span></span>
12. <span data-ttu-id="f29e0-124">Wenn das Streaming beendet wird, ruft VMR-9 die [**IVMRSurfaceAllocator9:: terminatedevice**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocator9-terminatedevice) -Methode auf.</span><span class="sxs-lookup"><span data-stu-id="f29e0-124">When streaming stops, the VMR-9 calls the [**IVMRSurfaceAllocator9::TerminateDevice**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocator9-terminatedevice) method.</span></span> <span data-ttu-id="f29e0-125">Der Zuweiser-Presenter sollte alle seine Direct3D-Ressourcen freigeben.</span><span class="sxs-lookup"><span data-stu-id="f29e0-125">The allocator-presenter should release all of its Direct3D resources.</span></span>

<span data-ttu-id="f29e0-126">Es gibt einige Unterschiede zwischen VMR-7 und VMR-9 in der Art und Weise, wie benutzerdefinierte zuordcator-Moderatoren verwaltet werden:</span><span class="sxs-lookup"><span data-stu-id="f29e0-126">There are some differences between the VMR-7 and the VMR-9 in the way custom allocator-presenters are managed:</span></span>

-   <span data-ttu-id="f29e0-127">Die [**Zuweisungs Methode "Zuweisungs**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-allocatesurfacehelper) Methode" des VMR-9-Filters ist für die Zuweisung von Oberflächen verfügbar.</span><span class="sxs-lookup"><span data-stu-id="f29e0-127">The VMR-9 filter's [**AllocateSurfaceHelper**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-allocatesurfacehelper) method is available for the allocator-presenter to use when allocating surfaces.</span></span> <span data-ttu-id="f29e0-128">Diese Methode macht es unnötig, dass ein benutzerdefinierter zuordnerpresenter alle Aufrufe an den standardzuweicator-Presenter weitergibt.</span><span class="sxs-lookup"><span data-stu-id="f29e0-128">This method makes it unnecessary for a custom allocator-presenter to forward any calls to the default allocator-presenter.</span></span> <span data-ttu-id="f29e0-129">Aus diesem Grund wird die CLSID des standardmäßigen "zuordcators-Presenter" des VMR-9-Filters nicht veröffentlicht.</span><span class="sxs-lookup"><span data-stu-id="f29e0-129">For this reason, the CLSID of the VMR-9 filter's default allocator-presenter is not published.</span></span>
-   <span data-ttu-id="f29e0-130">Anders als bei VMR-7 bietet VMR-9 keinen speziellen DirectDraw Exclusive Mode-Zuweiser.</span><span class="sxs-lookup"><span data-stu-id="f29e0-130">Unlike the VMR-7, the VMR-9 does not provide a special DirectDraw Exclusive Mode allocator-presenter.</span></span> <span data-ttu-id="f29e0-131">Mit der [**IVMRSurfaceAllocatorNotify9:: depingesurfacehelper**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-allocatesurfacehelper) -Methode ist dieses Objekt unnötig.</span><span class="sxs-lookup"><span data-stu-id="f29e0-131">The [**IVMRSurfaceAllocatorNotify9::AllocateSurfaceHelper**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-allocatesurfacehelper) method makes this object unnecessary.</span></span>
-   <span data-ttu-id="f29e0-132">Bei einem Video mit Zeilen Sprung wird das Video von VMR-9 immer deformatiert, bevor es dargestellt wird.</span><span class="sxs-lookup"><span data-stu-id="f29e0-132">For interlaced video, the VMR-9 always de-interlaces the video before it presents the image.</span></span> <span data-ttu-id="f29e0-133">Der zuordnerpräsentator ist nicht mehr für die Deaktivierung des Bilds verantwortlich, bevor es angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="f29e0-133">The allocator-presenter is no longer responsible for de-interlacing the image before displaying it.</span></span>

## <a name="related-topics"></a><span data-ttu-id="f29e0-134">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="f29e0-134">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f29e0-135">VMR-renderlosen Wiedergabemodus (benutzerdefinierter Zuweiser)</span><span class="sxs-lookup"><span data-stu-id="f29e0-135">VMR Renderless Playback Mode (Custom Allocator-Presenters)</span></span>](vmr-renderless-playback-mode--custom-allocator-presenters.md)
</dt> </dl>

 

 



