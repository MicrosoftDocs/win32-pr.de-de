---
description: Queryaccept (Downstream)
ms.assetid: 3ca30f62-c320-40ea-9bf5-022abad912c4
title: Queryaccept (Downstream)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9015e0a246abb9fb996c0771e4bc935cccda054d
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/06/2021
ms.locfileid: "104554229"
---
# <a name="queryaccept-downstream"></a><span data-ttu-id="f23c3-103">Queryaccept (Downstream)</span><span class="sxs-lookup"><span data-stu-id="f23c3-103">QueryAccept (Downstream)</span></span>

<span data-ttu-id="f23c3-104">Dieser Mechanismus ermöglicht es einer Ausgabepin, dem downstreampeer ein neues Format vorzuschlagen.</span><span class="sxs-lookup"><span data-stu-id="f23c3-104">This mechanism enables an output pin to propose a new format to its downstream peer.</span></span> <span data-ttu-id="f23c3-105">Das neue Format darf keine größere Puffergröße erfordern.</span><span class="sxs-lookup"><span data-stu-id="f23c3-105">The new format must not require a larger buffer size.</span></span> <span data-ttu-id="f23c3-106">Die Ausgabe-PIN führt folgende Aktionen aus:</span><span class="sxs-lookup"><span data-stu-id="f23c3-106">The output pin does the following:</span></span>

1.  <span data-ttu-id="f23c3-107">Ruft [**IPin:: queryaccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) oder [**ipinconnection::D ynamicqueryaccept**](/windows/desktop/api/Strmif/nf-strmif-ipinconnection-dynamicqueryaccept) auf der Downstream-PIN auf, um zu überprüfen, ob die andere Pin den neuen Medientyp akzeptieren kann (siehe Abbildung, Schritt A).</span><span class="sxs-lookup"><span data-stu-id="f23c3-107">Calls [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) or [**IPinConnection::DynamicQueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipinconnection-dynamicqueryaccept) on the downstream pin, to verify whether the other pin can accept the new media type (see illustration, step A).</span></span>
2.  <span data-ttu-id="f23c3-108">Wenn der Rückgabewert aus Schritt 1 S \_ OK ist, fügt die PIN den Medientyp an das nächste Beispiel an.</span><span class="sxs-lookup"><span data-stu-id="f23c3-108">If the return value from step 1 is S\_OK, the pin attaches the media type to the next sample.</span></span> <span data-ttu-id="f23c3-109">Zu diesem Zweck wird zuerst [**imemzucator:: GetBuffer**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getbuffer) aufgerufen, um das Beispiel (B) zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="f23c3-109">To do this, first it calls [**IMemAllocator::GetBuffer**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getbuffer) to obtain the sample (B).</span></span> <span data-ttu-id="f23c3-110">Anschließend wird [**imediasample:: setmediatype**](/windows/desktop/api/Strmif/nf-strmif-imediasample-setmediatype) aufgerufen, um den Medientyp an dieses Beispiel (C) anzufügen.</span><span class="sxs-lookup"><span data-stu-id="f23c3-110">Then it calls [**IMediaSample::SetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-setmediatype) to attach the media type to that sample (C).</span></span> <span data-ttu-id="f23c3-111">Durch Anfügen des Medientyps an das Beispiel gibt der Filter an, dass sich das Format geändert hat, beginnend mit diesem Beispiel.</span><span class="sxs-lookup"><span data-stu-id="f23c3-111">By attaching the media type to the sample, the filter indicates that the format has changed, starting with that sample.</span></span>
3.  <span data-ttu-id="f23c3-112">Die PIN liefert das Beispiel (D).</span><span class="sxs-lookup"><span data-stu-id="f23c3-112">The pin delivers the sample (D).</span></span>
4.  <span data-ttu-id="f23c3-113">Wenn der Downstream-Filter das Beispiel empfängt, ruft er [**imediasample:: getmediatype**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getmediatype) auf, um den neuen Medientyp abzurufen.</span><span class="sxs-lookup"><span data-stu-id="f23c3-113">When the downstream filter receives the sample, it calls [**IMediaSample::GetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getmediatype) to retrieve the new media type.</span></span>

    ![queryaccept (Downstream)](images/dynformat3.png)

<span data-ttu-id="f23c3-115">Alle Pins unterstützen die- `QueryAccept` Methode.</span><span class="sxs-lookup"><span data-stu-id="f23c3-115">All pins support the `QueryAccept` method.</span></span> <span data-ttu-id="f23c3-116">Diese Methode ist jedoch etwas mehrdeutig, da der Rückgabewert S \_ OK nicht immer garantiert, dass Sie das Format ändern können, während das Diagramm aktiv ist.</span><span class="sxs-lookup"><span data-stu-id="f23c3-116">However, this method is slightly ambiguous, because a return value of S\_OK does not always guarantee that you can change the format while the graph is active.</span></span> <span data-ttu-id="f23c3-117">Einige Filter geben möglicherweise S OK zurück, \_ lehnen die Änderung jedoch ab, wenn das Diagramm aktiv ist.</span><span class="sxs-lookup"><span data-stu-id="f23c3-117">Some filters might return S\_OK but reject the change if the graph is active.</span></span> <span data-ttu-id="f23c3-118">Die **dynamicqueryaccept** -Methode, die von einigen Eingabe Pins unterstützt wird, definiert e OK explizit, \_ um zu bedeuten, dass die PIN Formate ändern kann, während Sie aktiv ist.</span><span class="sxs-lookup"><span data-stu-id="f23c3-118">The **DynamicQueryAccept** method, which is supported by some input pins, explicitly defines S\_OK to mean the pin can change formats while active.</span></span> <span data-ttu-id="f23c3-119">Wenn eine Eingabe-PIN die **ipinconnection** -Schnittstelle unterstützt, sollte **dynamicqueryaccept** anstelle von aufgerufen werden `QueryAccept` .</span><span class="sxs-lookup"><span data-stu-id="f23c3-119">If an input pin supports the **IPinConnection** interface, you should call **DynamicQueryAccept** rather than `QueryAccept`.</span></span>

<span data-ttu-id="f23c3-120">In den meisten Fällen lässt dieser Mechanismus keine drastischen Änderungen am Format zu, wie z. b. das Ändern der Bittiefe.</span><span class="sxs-lookup"><span data-stu-id="f23c3-120">In most cases, this mechanism does not allow for drastic changes to the format, such as changing the bit depth.</span></span> <span data-ttu-id="f23c3-121">Eine Situation, in der Sie verwendet werden kann, ist, wenn ein Video Decoder Paletten wechselt.</span><span class="sxs-lookup"><span data-stu-id="f23c3-121">One situation in which it can be used is when a video decoder switches palettes.</span></span> <span data-ttu-id="f23c3-122">Die grundlegenden Details des Formats bleiben unverändert, wie z. b. die Bild Dimensionen und die Bittiefe, aber der neue Medientyp verfügt über einen anderen Satz von paletteneinträgen.</span><span class="sxs-lookup"><span data-stu-id="f23c3-122">The basic details of the format stay the same, such as the image dimensions and the bit depth, but the new media type has a different set of palette entries.</span></span>

<span data-ttu-id="f23c3-123">**Implementierungs Hinweis**</span><span class="sxs-lookup"><span data-stu-id="f23c3-123">**Implementation Note**</span></span>

<span data-ttu-id="f23c3-124">In den DirectShow-Basisklassen ruft [**cbasepin:: queryaccept**](cbasepin-queryaccept.md) die **checkmediatype** -Methode auf, die auch während der anfänglichen Pin-Verbindung aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="f23c3-124">In the DirectShow base classes, [**CBasePin::QueryAccept**](cbasepin-queryaccept.md) calls the **CheckMediaType** method, which is also called during the initial pin connection.</span></span> <span data-ttu-id="f23c3-125">Bei einem Transformations Filter sollte die **checkmediatype** -Methode der Eingabe-PIN immer überprüfen, ob die Ausgabe-PIN verbunden ist, und wenn dies der Fall ist, ob der Eingabe Medientyp mit dem Ausgabe Medientyp kompatibel ist.</span><span class="sxs-lookup"><span data-stu-id="f23c3-125">In the case of a transform filter, the input pin's **CheckMediaType** method should always check whether the output pin is connected, and if so, whether the input media type is compatible with the output media type.</span></span> <span data-ttu-id="f23c3-126">Daher wird diese Implementierung wahrscheinlich für gültig sein `QueryAccept` .</span><span class="sxs-lookup"><span data-stu-id="f23c3-126">Therefore, this implementation will likely be valid for `QueryAccept`.</span></span> <span data-ttu-id="f23c3-127">Andernfalls sollten Sie außer Kraft setzen, um `QueryAccept` zusätzliche Überprüfungen durchzuführen, die benötigt werden.</span><span class="sxs-lookup"><span data-stu-id="f23c3-127">If not, you should override `QueryAccept` in order to perform any additional checks that are needed.</span></span> <span data-ttu-id="f23c3-128">Beachten Sie außerdem, dass die [**ctransformfilter**](ctransformfilter.md) -Klasse diese Logik innerhalb der Methoden **checkinputtype** und **checktransform** kapselt.</span><span class="sxs-lookup"><span data-stu-id="f23c3-128">Also, note that the [**CTransformFilter**](ctransformfilter.md) class encapsulates this logic within the **CheckInputType** and **CheckTransform** methods.</span></span> <span data-ttu-id="f23c3-129">Die [**ctransinplacefilter**](ctransinplacefilter.md) -Klasse hingegen ruft immer `QueryAccept` für den nächsten Upstream-oder downstreamfilter auf.</span><span class="sxs-lookup"><span data-stu-id="f23c3-129">The [**CTransInPlaceFilter**](ctransinplacefilter.md) class, on the other hand, always calls `QueryAccept` on the next upstream or downstream filter.</span></span>

<span data-ttu-id="f23c3-130">Die [**cbaseinputpin:: Receive**](cbaseinputpin-receive.md) -Methode überprüft, ob ein Medientyp für das eingehende Beispiel vorhanden ist. ist dies der Fall, wird **checkmediatype** aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="f23c3-130">The [**CBaseInputPin::Receive**](cbaseinputpin-receive.md) method checks for a media type on the incoming sample, and if there is one, calls **CheckMediaType**.</span></span> <span data-ttu-id="f23c3-131">Der **m \_ MT** -Member der PIN, der den aktuellen Medientyp enthält, wird jedoch nicht aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="f23c3-131">However, it does not update the pin's **m\_mt** member, which holds the current media type.</span></span> <span data-ttu-id="f23c3-132">Wenn Ihr Filter das Beispiel verarbeitet, sollten Sie das Beispiel auf einen Medientyp überprüfen.</span><span class="sxs-lookup"><span data-stu-id="f23c3-132">When your filter processes the sample, you should check the sample for a media type.</span></span> <span data-ttu-id="f23c3-133">Wenn ein neuer Typ vorhanden ist, müssen Sie ihn wahrscheinlich speichern, indem Sie entweder **setmediatype** auf der PIN aufrufen oder den Wert von **m \_ MT** direkt festlegen.</span><span class="sxs-lookup"><span data-stu-id="f23c3-133">If there is a new type, you will probably need to store it, either by calling **SetMediaType** on your pin or by setting the value of **m\_mt** directly.</span></span> <span data-ttu-id="f23c3-134">Andererseits speichert die [**cvideotransformfilter**](cvideotransformfilter.md) -Klasse, die für Video Transformations Filter entwickelt wurde, den Medientyp, wenn Sie sich ändert.</span><span class="sxs-lookup"><span data-stu-id="f23c3-134">On the other hand, the [**CVideoTransformFilter**](cvideotransformfilter.md) class, which is designed for video transform filters, stores the media type when it changes.</span></span> <span data-ttu-id="f23c3-135">Weitere Informationen finden Sie im Quellcode für [**cvideotransformfilter:: Receive**](cvideotransformfilter-receive.md) in der DirectShow-Basisklassen Bibliothek.</span><span class="sxs-lookup"><span data-stu-id="f23c3-135">For details, see the source code for [**CVideoTransformFilter::Receive**](cvideotransformfilter-receive.md) in the DirectShow base class library.</span></span>

<span data-ttu-id="f23c3-136">In einigen Fällen können Sie einfach den-Befehl `QueryAccept` Downstream übergeben und dann den Medientyp an das Ausgabe Beispiel anfügen und den downstreamfilter das Format ändern.</span><span class="sxs-lookup"><span data-stu-id="f23c3-136">In some cases, you might simply pass the `QueryAccept` call downstream, then attach the media type to the output sample and let the downstream filter handle the format change.</span></span>

 

 



