---
description: Eine IME-fähige Anwendung, die die WM \_ IME COMPOSITION-Nachricht verarbeitet, \_ testet die Bits im lParam-Parameter und ruft die ImmGetCompositionString-Funktion auf, um die angegebene Zeichenfolge oder die daten abzurufen.
ms.assetid: 6d9cb9e2-f30e-4299-9af5-a705cd40b185
title: Verarbeiten der WM_IME_COMPOSITION-Nachricht
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5cb7237c986270f2684552fb19b1ad31a1dd369a723b0c8ef47189de95021022
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/11/2021
ms.locfileid: "120040660"
---
# <a name="processing-the-wm_ime_composition-message"></a>Verarbeiten der WM \_ IME \_ COMPOSITION-Nachricht

Eine IME-fähige Anwendung, die die [**WM \_ IME \_ COMPOSITION-Nachricht**](wm-ime-composition.md) verarbeitet, testet die Bits im *lParam-Parameter* und ruft die [**ImmGetCompositionString-Funktion**](/windows/desktop/api/Imm/nf-imm-immgetcompositionstringa) auf, um die angegebene Zeichenfolge oder die daten abzurufen. Im folgenden Beispiel wird nach der Ergebniszeichenfolge gesucht, genügend Arbeitsspeicher für die Zeichenfolge belegt und die Ergebniszeichenfolge aus der IME abgerufen.


```C++
HIMC hIMC;
DWORD dwSize;
HGLOBAL hstr;
LPSTR lpstr;

case WM_IME_COMPOSITION:
    if (lParam & GCS_RESULTSTR) 
    {
        hIMC = ImmGetContext(hWnd);

        if (!hIMC)
            MyError(ERROR_NULLCONTEXT);

        // Get the size of the result string. 
        dwSize = ImmGetCompositionString(hIMC, GCS_RESULTSTR, NULL, 0);

        // increase buffer size for terminating null character,  
        //   maybe it is in UNICODE 
        dwSize += sizeof(WCHAR);

        hstr = GlobalAlloc(GHND,dwSize);
        if (hstr == NULL)
             MyError(ERROR_GLOBALALLOC);

        lpstr = (LPSTR)GlobalLock(hstr);
        if (lpstr == NULL)
             MyError(ERROR_GLOBALLOCK);

        // Get the result strings that is generated by IME into lpstr. 
        ImmGetCompositionString(hIMC, GCS_RESULTSTR, lpstr, dwSize);
        ImmReleaseContext(hWnd, hIMC);

        // add this string into text buffer of application 

        GlobalUnlock(hstr);
        GlobalFree(hstr);
    }
```



## <a name="related-topics"></a>Zugehörige Themen

<dl> <dt>

[Verwenden des Eingabemethoden-Managers](using-input-method-manager.md)
</dt> </dl>

 

 



