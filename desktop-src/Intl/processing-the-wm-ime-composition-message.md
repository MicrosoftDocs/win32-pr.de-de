---
description: Eine IME-fähige Anwendung, die die WM \_ IME- \_ Kompositions Nachricht verarbeitet, testet die Bits im lParam-Parameter und ruft die immgetcompositionstring-Funktion auf, um die festgestellte Zeichenfolge oder die Daten abzurufen.
ms.assetid: 6d9cb9e2-f30e-4299-9af5-a705cd40b185
title: Verarbeiten der WM_IME_COMPOSITION Nachricht
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 059ff6f38531cfdea781d5633226d32d054f13b2
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "104214534"
---
# <a name="processing-the-wm_ime_composition-message"></a>Verarbeiten der WM- \_ IME- \_ Kompositions Nachricht

Eine IME-fähige Anwendung, die die [**WM \_ IME- \_ Kompositions**](wm-ime-composition.md) Nachricht verarbeitet, testet die Bits im *LPARAM* -Parameter und ruft die [**immgetcompositionstring**](/windows/desktop/api/Imm/nf-imm-immgetcompositionstringa) -Funktion auf, um die festgestellte Zeichenfolge oder die Daten abzurufen. Im folgenden Beispiel wird die Ergebnis Zeichenfolge überprüft, ausreichend Arbeitsspeicher für die Zeichenfolge zugewiesen und die Ergebnis Zeichenfolge aus dem IME abgerufen.


```C++
HIMC hIMC;
DWORD dwSize;
HGLOBAL hstr;
LPSTR lpstr;

case WM_IME_COMPOSITION:
    if (lParam & GCS_RESULTSTR) 
    {
        hIMC = ImmGetContext(hWnd);

        if (!hIMC)
            MyError(ERROR_NULLCONTEXT);

        // Get the size of the result string. 
        dwSize = ImmGetCompositionString(hIMC, GCS_RESULTSTR, NULL, 0);

        // increase buffer size for terminating null character,  
        //   maybe it is in UNICODE 
        dwSize += sizeof(WCHAR);

        hstr = GlobalAlloc(GHND,dwSize);
        if (hstr == NULL)
             MyError(ERROR_GLOBALALLOC);

        lpstr = (LPSTR)GlobalLock(hstr);
        if (lpstr == NULL)
             MyError(ERROR_GLOBALLOCK);

        // Get the result strings that is generated by IME into lpstr. 
        ImmGetCompositionString(hIMC, GCS_RESULTSTR, lpstr, dwSize);
        ImmReleaseContext(hWnd, hIMC);

        // add this string into text buffer of application 

        GlobalUnlock(hstr);
        GlobalFree(hstr);
    }
```



## <a name="related-topics"></a>Zugehörige Themen

<dl> <dt>

[Verwenden des Eingabemethoden-Managers](using-input-method-manager.md)
</dt> </dl>

 

 



