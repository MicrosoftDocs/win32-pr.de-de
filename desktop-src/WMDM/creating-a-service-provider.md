---
title: Erstellen eines Dienstanbieters
description: Erstellen eines Dienstanbieters
ms.assetid: 7da27fe2-8a57-4adb-94b2-448b6362dc33
keywords:
- Windows Media Device Manager, Erstellen von Dienstanbietern
- Device Manager, Erstellen von Dienstanbietern
- Windows Media Device Manager, Programmier Handbuch
- Device Manager, Programmier Handbuch
- Programmier Handbuch, Dienstanbieter
- Programmier Handbuch, Windows Media Device Manager
- Programmier Handbuch, Erstellen von Dienstanbietern
- Windows Media Device Manager, Dienstanbieter
- Device Manager, Dienstanbieter
- Dienstanbieter, erstellen
- Erstellen von Dienstanbietern, Informationen zu
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8469c3d656d151457ed818ea6b4192a3c79ed061
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/20/2020
ms.locfileid: "106337226"
---
# <a name="creating-a-service-provider"></a><span data-ttu-id="0ce02-114">Erstellen eines Dienstanbieters</span><span class="sxs-lookup"><span data-stu-id="0ce02-114">Creating a Service Provider</span></span>

<span data-ttu-id="0ce02-115">Ein Dienstanbieter ist eine Komponente, die als middlemann zwischen einer Anwendung und einem Gerät fungiert.</span><span class="sxs-lookup"><span data-stu-id="0ce02-115">A service provider is component that serves as a middleman between an application and a device.</span></span> <span data-ttu-id="0ce02-116">Windows Media Device Manager leitet Anforderungen von der Anwendung an den Dienstanbieter weiter, der dann für die Kommunikation mit dem Gerät oder das Ausführen der angeforderten Aktion zuständig ist.</span><span class="sxs-lookup"><span data-stu-id="0ce02-116">Windows Media Device Manager routes requests from the application to the service provider, which is then responsible for communicating with the device or performing the requested action.</span></span> <span data-ttu-id="0ce02-117">Ein Dienstanbieter kommuniziert in der Regel mit einem Treiber, um die Kommunikation mit dem Gerät zu ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="0ce02-117">A service provider usually communicates with a driver to enable communication with the device.</span></span> <span data-ttu-id="0ce02-118">Ein Dienstanbieter ist eine COM-Komponente, die die Schnittstellen implementiert, die von Windows Media Device Manager aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="0ce02-118">A service provider is a COM component that implements the interfaces called by Windows Media Device Manager.</span></span> <span data-ttu-id="0ce02-119">Die Stamm Schnittstelle des Dienstanbieter Objekts ist [**imdserviceprovider**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider).</span><span class="sxs-lookup"><span data-stu-id="0ce02-119">The root interface of the service provider object is [**IMDServiceProvider**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider).</span></span> <span data-ttu-id="0ce02-120">Nachdem Sie diese Schnittstelle erhalten haben, können Windows Media Device Manager andere Schnittstellen durch die Implementierung verschiedener Methoden des Dienstanbieters abrufen.</span><span class="sxs-lookup"><span data-stu-id="0ce02-120">After obtaining this interface, Windows Media Device Manager can obtain other interfaces through the service provider's implementation of various methods.</span></span> <span data-ttu-id="0ce02-121">Die Schnittstellen, die ein Dienstanbieter implementieren muss, sind in [obligatorische und optionale Schnittstellen](mandatory-and-optional-interfaces.md)aufgeführt.</span><span class="sxs-lookup"><span data-stu-id="0ce02-121">The interfaces that a service provider must implement are listed in [Mandatory and Optional Interfaces](mandatory-and-optional-interfaces.md).</span></span> <span data-ttu-id="0ce02-122">Die Hierarchie der Schnittstellen wird in [Schnittstellen für Dienstanbieter](interfaces-for-service-providers.md)angezeigt.</span><span class="sxs-lookup"><span data-stu-id="0ce02-122">The hierarchy of interfaces is shown in [Interfaces for Service Providers](interfaces-for-service-providers.md).</span></span>

> [!Note]  
> <span data-ttu-id="0ce02-123">Sie sollten nicht versuchen, einen MTP-Dienstanbieter zu erstellen; Stattdessen sollten Sie den MTP-Dienstanbieter und die von Microsoft bereitgestellten Treiber verwenden.</span><span class="sxs-lookup"><span data-stu-id="0ce02-123">You should not try to create an MTP service provider; instead, you should use the MTP service provider and drivers provided by Microsoft.</span></span>

 

<span data-ttu-id="0ce02-124">Bevor Sie versuchen, einen Dienstanbieter zu erstellen, sollten Sie gründlich verstehen, welche Aufrufe eine Anwendung für einen Dienstanbieter durchführt.</span><span class="sxs-lookup"><span data-stu-id="0ce02-124">Before trying to create a service provider, you should thoroughly understand what calls an application will make on a service provider.</span></span> <span data-ttu-id="0ce02-125">Weitere Informationen zu den grundlegenden Aufgaben und aufrufen, die eine Anwendung für einen Dienstanbieter durchführt, wenn versucht wird, mit einem Gerät zu kommunizieren, finden Sie unter [Erstellen einer Windows Media Device Manager-Anwendung](creating-a-windows-media-device-manager-application.md) .</span><span class="sxs-lookup"><span data-stu-id="0ce02-125">Read [Creating a Windows Media Device Manager Application](creating-a-windows-media-device-manager-application.md) to get some idea of the basic tasks and calls that an application will make on a service provider when it is attempting to communicate with a device.</span></span>

<span data-ttu-id="0ce02-126">In der folgenden Liste sind die wichtigsten Schritte beim Entwickeln eines Dienstanbieters aufgeführt:</span><span class="sxs-lookup"><span data-stu-id="0ce02-126">The following list shows the key steps in developing a service provider:</span></span>

1.  <span data-ttu-id="0ce02-127">Schließen Sie die erforderlichen Header-und Bibliotheksdateien für das Projekt ein (und optional auch die Kompilierung).</span><span class="sxs-lookup"><span data-stu-id="0ce02-127">Include (and optionally compile) the required header and library files for your project.</span></span> <span data-ttu-id="0ce02-128">Die Liste der erforderlichen Dateien finden Sie unter [erforderliche Bibliotheken und Header für einen Dienstanbieter](required-libraries-and-headers-for-a-service-provider.md) .</span><span class="sxs-lookup"><span data-stu-id="0ce02-128">See [Required Libraries and Headers for a Service Provider](required-libraries-and-headers-for-a-service-provider.md) for the list of required files.</span></span>
2.  <span data-ttu-id="0ce02-129">Implementieren Sie alle anderen erforderlichen oder optionalen Dienstanbieter Schnittstellen (siehe [obligatorische und optionale Schnittstellen](mandatory-and-optional-interfaces.md)).</span><span class="sxs-lookup"><span data-stu-id="0ce02-129">Implement all the other required or optional service provider interfaces (see [Mandatory and Optional Interfaces](mandatory-and-optional-interfaces.md)).</span></span> <span data-ttu-id="0ce02-130">Schnittstellen werden in der Regel in dieser Reihenfolge aufgerufen:</span><span class="sxs-lookup"><span data-stu-id="0ce02-130">Typically, interfaces will be called in this order:</span></span>
    -   [<span data-ttu-id="0ce02-131">**Icomponentauthenticate**</span><span class="sxs-lookup"><span data-stu-id="0ce02-131">**IComponentAuthenticate**</span></span>](/windows/desktop/api/mswmdm/nn-mswmdm-icomponentauthenticate)
    -   <span data-ttu-id="0ce02-132">[**Imdserviceprovider**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider)/2</span><span class="sxs-lookup"><span data-stu-id="0ce02-132">[**IMDServiceProvider**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider)/2</span></span>
    -   [<span data-ttu-id="0ce02-133">**Imdspenum Device**</span><span class="sxs-lookup"><span data-stu-id="0ce02-133">**IMDSPEnumDevice**</span></span>](/windows/desktop/api/mswmdm/nn-mswmdm-imdspenumdevice)
    -   <span data-ttu-id="0ce02-134">[**Imdspdevice**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice)/2</span><span class="sxs-lookup"><span data-stu-id="0ce02-134">[**IMDSPDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice)/2</span></span>
    -   [<span data-ttu-id="0ce02-135">**Imdspenum Storage**</span><span class="sxs-lookup"><span data-stu-id="0ce02-135">**IMDSPEnumStorage**</span></span>](/windows/desktop/api/mswmdm/nn-mswmdm-imdspenumstorage)
    -   <span data-ttu-id="0ce02-136">[**Imdspstorage**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspstorage)/2/3</span><span class="sxs-lookup"><span data-stu-id="0ce02-136">[**IMDSPStorage**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspstorage)/2/3</span></span>
3.  <span data-ttu-id="0ce02-137">Stellen Sie sicher, dass der Dienstanbieter oder das Gerät während der Installation die richtigen Registrierungsschlüssel installiert.</span><span class="sxs-lookup"><span data-stu-id="0ce02-137">Be sure your service provider or device installs the proper registry keys during installation.</span></span> <span data-ttu-id="0ce02-138">Diese Schlüssel geben Geräteparameter an, registrieren den Dienstanbieter als Plug-in und aktivieren Plug & Play Benachrichtigungen für das eintreffen und Entfernen von Geräten.</span><span class="sxs-lookup"><span data-stu-id="0ce02-138">These keys specify device parameters, register the service provider as a plug-in, and enable Plug and Play notifications for device arrival and removal.</span></span> <span data-ttu-id="0ce02-139">Weitere Informationen finden Sie unter [Geräteparameter](device-parameters.md), [Registrieren des Dienstanbieters](registering-the-service-provider.md)und [Aktivieren von PNP für Geräte](enabling-pnp-for-devices.md).</span><span class="sxs-lookup"><span data-stu-id="0ce02-139">See [Device Parameters](device-parameters.md), [Registering the Service Provider](registering-the-service-provider.md), and [Enabling PnP for Devices](enabling-pnp-for-devices.md).</span></span>
4.  <span data-ttu-id="0ce02-140">Authentifizieren Sie den Dienstanbieter bei der Instanziierung der Klasse im Konstruktor.</span><span class="sxs-lookup"><span data-stu-id="0ce02-140">On instantiation of your class, authenticate the service provider in the constructor.</span></span> <span data-ttu-id="0ce02-141">Erstellen Sie hierzu eine [csecurechannelserver](csecurechannelserver-class.md) -Klasse, und legen Sie das Zertifikat fest.</span><span class="sxs-lookup"><span data-stu-id="0ce02-141">To do this, create a [CSecureChannelServer](csecurechannelserver-class.md) class and set the certificate.</span></span> <span data-ttu-id="0ce02-142">Implementieren Sie die [**icomponentauthenticate**](/windows/desktop/api/mswmdm/nn-mswmdm-icomponentauthenticate) -Schnittstelle, und nennen Sie die zuvor instanziierten Methoden der csecurechannelserver-Klasse.</span><span class="sxs-lookup"><span data-stu-id="0ce02-142">Implement the [**IComponentAuthenticate**](/windows/desktop/api/mswmdm/nn-mswmdm-icomponentauthenticate) interface and call the methods of the CSecureChannelServer class instantiated previously.</span></span> <span data-ttu-id="0ce02-143">Weitere Informationen zum Instanziieren der csecurechannelserver-Klasse und Implementieren der icomponentauthenticate-Methoden finden Sie unter [Authentifizieren des Dienstanbieters](authenticating-the-service-provider.md) .</span><span class="sxs-lookup"><span data-stu-id="0ce02-143">See [Authenticating the Service Provider](authenticating-the-service-provider.md) to learn how to instantiate the CSecureChannelServer class and implement the IComponentAuthenticate methods.</span></span>
5.  <span data-ttu-id="0ce02-144">Windows Media Device Manager fragt Ihren Dienstanbieter nach einer Liste verbundener Geräte durch Aufrufen von [**IMDServiceProvider2:: createdevice**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider2-createdevice) oder [**imdserviceprovider:: enumdevices**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider-enumdevices)ab, je nachdem, ob der Dienstanbieter Plug & Play Geräte verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="0ce02-144">Windows Media Device Manager will query your service provider for a list of connected devices by calling [**IMDServiceProvider2::CreateDevice**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider2-createdevice) or [**IMDServiceProvider::EnumDevices**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider-enumdevices), depending on whether the service provider handles Plug and Play devices.</span></span> <span data-ttu-id="0ce02-145">Der Dienstanbieter muss eine Liste von [**imdspdevice**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice) -Objekten zurückgeben, die verbundene Geräte darstellen.</span><span class="sxs-lookup"><span data-stu-id="0ce02-145">The service provider must return a list of [**IMDSPDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice) objects representing connected devices.</span></span> <span data-ttu-id="0ce02-146">Weitere Informationen finden Sie unter Auflisten von [Geräten](enumerating-devices-service-provider.md) .</span><span class="sxs-lookup"><span data-stu-id="0ce02-146">See [Enumerating Devices](enumerating-devices-service-provider.md) for more details.</span></span>
6.  <span data-ttu-id="0ce02-147">Vergewissern Sie sich vor der Behandlung von anrufen, dass ein sicherer Kanal eingerichtet wurde.</span><span class="sxs-lookup"><span data-stu-id="0ce02-147">Before handling any call, verify that a secure channel has been established.</span></span> <span data-ttu-id="0ce02-148">Nennen Sie [**csecurechannelserver:: fisauthenticated**](/previous-versions/bb231600(v=vs.85)) , bevor Sie Aktionen ausführen.</span><span class="sxs-lookup"><span data-stu-id="0ce02-148">Call [**CSecureChannelServer::fIsAuthenticated**](/previous-versions/bb231600(v=vs.85)) before performing any actions.</span></span> <span data-ttu-id="0ce02-149">Wenn bei diesem Vorgang ein Fehler auftritt, geben Sie WMDM \_ E \_ notcertified zurück.</span><span class="sxs-lookup"><span data-stu-id="0ce02-149">If this call fails, return WMDM\_E\_NOTCERTIFIED.</span></span>
7.  <span data-ttu-id="0ce02-150">Sie benötigen ein von Microsoft ausgestelltes Zertifikat-/Schlüsselpaar, um von DRM geschütztes Material verarbeiten zu können.</span><span class="sxs-lookup"><span data-stu-id="0ce02-150">You will need a certificate/key pair issued by Microsoft to be able to handle DRM-protected material.</span></span> <span data-ttu-id="0ce02-151">Weitere Informationen finden Sie [unter behandeln geschützter Inhalte im Dienstanbieter](handling-protected-content-in-the-service-provider.md) .</span><span class="sxs-lookup"><span data-stu-id="0ce02-151">See [Handling Protected Content in the Service Provider](handling-protected-content-in-the-service-provider.md) for more information.</span></span>
8.  <span data-ttu-id="0ce02-152">Damit Ihr Gerät automatisch mit Windows Media Player synchronisiert werden kann, muss es die unter [Aktivieren der Synchronisierung mit Windows Media Player](enabling-synchronization-with-windows-media-player.md)aufgeführten Anforderungen erfüllen.</span><span class="sxs-lookup"><span data-stu-id="0ce02-152">To enable your device to synchronize automatically with Windows Media Player, it must fulfill the requirements listed in [Enabling Synchronization with Windows Media Player](enabling-synchronization-with-windows-media-player.md).</span></span>
9.  <span data-ttu-id="0ce02-153">Damit Ihr Gerät in Windows-Explorer angezeigt werden kann, müssen Sie einige besondere Schritte ausführen, die unter [Anforderungen für tragbare Audioplayer in Windows-Explorer angezeigt](requirements-for-portable-audio-players-to-appear-in-windows-explorer.md)werden.</span><span class="sxs-lookup"><span data-stu-id="0ce02-153">To enable your device to appear in Windows Explorer, you must take a few special steps, detailed in [Requirements for Portable Audio Players to Appear in Windows Explorer](requirements-for-portable-audio-players-to-appear-in-windows-explorer.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="0ce02-154">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="0ce02-154">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="0ce02-155">**Programmierhandbuch**</span><span class="sxs-lookup"><span data-stu-id="0ce02-155">**Programming Guide**</span></span>](programming-guide.md)
</dt> </dl>

 

 