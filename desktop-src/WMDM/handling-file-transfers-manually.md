---
title: Manuelles Verarbeiten von Dateiübertragungen
description: Manuelles Verarbeiten von Dateiübertragungen
ms.assetid: ff94191b-a0f2-4118-996c-d040f214fb9b
keywords:
- Windows Media Device Manager, manuelle Dateiübertragungen
- Device Manager, manuelle Dateiübertragungen
- Programmier Handbuch, manuelle Dateiübertragungen
- Desktop Anwendungen, manuelle Dateiübertragungen
- Erstellen von Windows Media Device Manager-Anwendungen, manuelle Dateiübertragungen
- manuelle Dateiübertragungen
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a2bf12404e8cd83b6f0c0e4f1c8ec8b0b7bda205
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/20/2020
ms.locfileid: "103728937"
---
# <a name="handling-file-transfers-manually"></a><span data-ttu-id="a7327-109">Manuelles Verarbeiten von Dateiübertragungen</span><span class="sxs-lookup"><span data-stu-id="a7327-109">Handling File Transfers Manually</span></span>

<span data-ttu-id="a7327-110">Die Anwendung kann die [**iwmdmoperation**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmoperation) -Schnittstelle implementieren, um einen Teil des Lese-oder Schreibvorgangs zu verwalten.</span><span class="sxs-lookup"><span data-stu-id="a7327-110">Your application can implement the [**IWMDMOperation**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmoperation) interface to manage part of the reading or writing process.</span></span> <span data-ttu-id="a7327-111">Bei einem Lesevorgang von einem Gerät ermöglicht die-Implementierung der Anwendung den Empfang von Blöcken von Rohdaten aus einer Gerätedatei.</span><span class="sxs-lookup"><span data-stu-id="a7327-111">On a read from device, the implementation enables the application to receive blocks of raw data from a device file.</span></span> <span data-ttu-id="a7327-112">Auf einem Schreibzugriff auf ein Gerät ermöglicht es der Anwendung, Blöcke von Rohdaten an eine Datei auf dem Gerät zu senden.</span><span class="sxs-lookup"><span data-stu-id="a7327-112">On a write to device, it enables the application to send blocks of raw data to a file on the device.</span></span>

<span data-ttu-id="a7327-113">Bei Lese-und Schreibvorgängen übergibt die [**iwmdmoperation:: transferobjectdata**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) -Methode die Daten zwischen dem Computer und dem Gerät.</span><span class="sxs-lookup"><span data-stu-id="a7327-113">In both read and write operations, the [**IWMDMOperation::TransferObjectData**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) method passes the data between the computer and the device.</span></span> <span data-ttu-id="a7327-114">Um die Richtung der Datenübertragung zu erkennen, muss Ihre Anwendung ein Flag festlegen, wenn Windows Media Device Manager [**BeginRead**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginread) oder [**BeginWrite**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginwrite)aufruft.</span><span class="sxs-lookup"><span data-stu-id="a7327-114">To know the direction of the data transfer, your application must set a flag when Windows Media Device Manager calls [**BeginRead**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginread) or [**BeginWrite**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginwrite).</span></span> <span data-ttu-id="a7327-115">Wenn die [**End**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) -Methode aufgerufen wird, sollte die Anwendung dieses Flag zurücksetzen.</span><span class="sxs-lookup"><span data-stu-id="a7327-115">When the [**End**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) method is called, the application should reset this flag.</span></span>

> [!Note]  
> <span data-ttu-id="a7327-116">Wenn der Dienstanbieter und das Gerät [**IMDSPObject2**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspobject2)ordnungsgemäß implementieren, wird zuerst die [IWMDMOperation3:: transferobjectdataonclearchannel](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation3-transferobjectdataonclearchannel) -Methode der Anwendung aufgerufen, sofern diese implementiert ist.</span><span class="sxs-lookup"><span data-stu-id="a7327-116">If the service provider and device properly implement [**IMDSPObject2**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspobject2), it will first call the application's [IWMDMOperation3::TransferObjectDataOnClearChannel](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation3-transferobjectdataonclearchannel) method, if implemented.</span></span> <span data-ttu-id="a7327-117">Diese Methode ist eine effizientere Methode zum Übertragen von Daten.</span><span class="sxs-lookup"><span data-stu-id="a7327-117">This method is a more efficient way of transferring data.</span></span> <span data-ttu-id="a7327-118">**Transferobjectdataonclearchannel** wird auf die gleiche Weise wie **transferobjectdata** behandelt, mit dem Unterschied, dass die Daten niemals verschlüsselt werden und keine Mac-Werte zur Überprüfung verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="a7327-118">**TransferObjectDataOnClearChannel** is handled the same way as **TransferObjectData**, except that the data is never encrypted and has no MAC values to verify.</span></span>

 

<span data-ttu-id="a7327-119">In den folgenden Abschnitten werden sowohl der Lesevorgang als auch der Schreibvorgang beschrieben, wenn die Anwendung **iwmdmoperation** implementiert.</span><span class="sxs-lookup"><span data-stu-id="a7327-119">The following sections describe both the reading and the writing process, when your application implements **IWMDMOperation**.</span></span>

<span data-ttu-id="a7327-120">**Lesen von einem Gerät**</span><span class="sxs-lookup"><span data-stu-id="a7327-120">**Reading from a device**</span></span>

<span data-ttu-id="a7327-121">Beim Lesen einer Datei von einem Gerät ruft Windows Media Device Manager die folgenden **iwmdmoperation** -Methoden in der angegebenen Reihenfolge auf:</span><span class="sxs-lookup"><span data-stu-id="a7327-121">When reading a file from a device, Windows Media Device Manager calls the following **IWMDMOperation** methods in order:</span></span>

-   <span data-ttu-id="a7327-122">[**BeginRead**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginread) Wird aufgerufen, um die Anwendung darüber zu benachrichtigen, dass ein Lesevorgang vom Gerät gestartet wird.</span><span class="sxs-lookup"><span data-stu-id="a7327-122">[**BeginRead**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginread) Called to notify the application that a read from device is beginning.</span></span>
-   <span data-ttu-id="a7327-123">[**Transferobjectdata**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) Wird einmal oder mehrmals aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="a7327-123">[**TransferObjectData**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) Called one or more times.</span></span> <span data-ttu-id="a7327-124">Die Verarbeitung von Daten wird in den folgenden Schritten beschrieben:</span><span class="sxs-lookup"><span data-stu-id="a7327-124">The processing of data is described in the following steps:</span></span>
    1.  <span data-ttu-id="a7327-125">**Transferobjectdata** empfängt einen Puffer, *pData*, Größe von *pdwSize* (Bytes), gefüllt mit Daten und einen Mac zum Überprüfen der eingehenden Daten.</span><span class="sxs-lookup"><span data-stu-id="a7327-125">**TransferObjectData** receives a buffer, *pData*, of size *pdwSize* bytes, filled with data, and a MAC to verify the incoming data.</span></span>
    2.  <span data-ttu-id="a7327-126">Die Anwendung überprüft die eingehenden Parameter mit dem eingehenden Daten-Mac.</span><span class="sxs-lookup"><span data-stu-id="a7327-126">The application verifies the incoming parameters with the incoming data MAC.</span></span>
    3.  <span data-ttu-id="a7327-127">Die Anwendung entschlüsselt und liest so viele Daten wie möglich in *pData* und ändert den zurückgegebenen Wert von " *pdwSize* ", um anzugeben, wie viele Bytes tatsächlich gelesen wurden.</span><span class="sxs-lookup"><span data-stu-id="a7327-127">The application decrypts and reads as much of the data in *pData* as it can, and modifies the returned value of *pdwSize* to indicate how many bytes were actually read.</span></span>
    4.  <span data-ttu-id="a7327-128">Die Anwendung entschlüsselt die Daten mithilfe von [**csecurechannelclient::D ecryptparam**](/previous-versions/bb231586(v=vs.85)), speichert Sie oder verwendet Sie nach Bedarf.</span><span class="sxs-lookup"><span data-stu-id="a7327-128">The application decrypts the data, using [**CSecureChannelClient::DecryptParam**](/previous-versions/bb231586(v=vs.85)), and stores it or uses it, as needed.</span></span>
    5.  <span data-ttu-id="a7327-129">**Transferobjectdata** gibt S \_ OK zurück.</span><span class="sxs-lookup"><span data-stu-id="a7327-129">**TransferObjectData** returns S\_OK.</span></span>
    6.  <span data-ttu-id="a7327-130">Windows Media Device Manager ruft **transferobjectdata** weiterhin auf, bis die Anwendung alle Daten aus der Datei gelesen hat, oder die Anwendung gibt zurück, dass der WMDM E-Benutzer abgebrochen wurde, \_ \_ \_ um den Vorgang abzubrechen (in diesem Fall wird der Lesevorgang abgebrochen, und Windows Media Device Manager-Aufrufe **enden**).</span><span class="sxs-lookup"><span data-stu-id="a7327-130">Windows Media Device Manager continues to call **TransferObjectData** until the application has read all the data from the file, or the application returns WMDM\_E\_USER\_CANCELLED to cancel the operation (in which case the read is canceled, and Windows Media Device Manager calls **End**).</span></span>
-   <span data-ttu-id="a7327-131">[**Ende**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) Wird aufgerufen, um die Anwendung zu benachrichtigen, dass ein Lesevorgang von einem Gerät beendet wird.</span><span class="sxs-lookup"><span data-stu-id="a7327-131">[**End**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) Called to notify the application that a read from device is ending.</span></span>

<span data-ttu-id="a7327-132">**Schreiben auf ein Gerät**</span><span class="sxs-lookup"><span data-stu-id="a7327-132">**Writing to a device**</span></span>

<span data-ttu-id="a7327-133">Wenn Sie eine Datei auf das Gerät schreiben, ruft Windows Media Device Manager die folgenden **iwmdmoperation** -Methoden in der angegebenen Reihenfolge auf:</span><span class="sxs-lookup"><span data-stu-id="a7327-133">When writing a file to the device, Windows Media Device Manager calls the following **IWMDMOperation** methods in order:</span></span>

-   <span data-ttu-id="a7327-134">[**Getobjectname**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjectname) Wird aufgerufen, um der Anwendung das Angeben eines Namens für den neuen Speicher zu ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="a7327-134">[**GetObjectName**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjectname) Called to allow the application to specify a name for the new storage.</span></span> <span data-ttu-id="a7327-135">Diese Methode wird nur aufgerufen, wenn die Anwendung keinen Namen in der **Insert** -Methode angegeben hat.</span><span class="sxs-lookup"><span data-stu-id="a7327-135">This method is only called if the application did not specify a name in the **Insert** method.</span></span>
-   <span data-ttu-id="a7327-136">[**Getobjectattributes**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjectattributes) Wird aufgerufen, damit die Anwendung Attribute für den neuen Speicher auf dem Gerät angeben kann.</span><span class="sxs-lookup"><span data-stu-id="a7327-136">[**GetObjectAttributes**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjectattributes) Called to allow the application to specify attributes for the new storage on the device.</span></span>
-   <span data-ttu-id="a7327-137">[**BeginWrite**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginwrite) Wird aufgerufen, um zu benachrichtigen, dass ein Schreibvorgang auf das Gerät beginnt.</span><span class="sxs-lookup"><span data-stu-id="a7327-137">[**BeginWrite**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginwrite) Called to notify that that a write to device is beginning.</span></span>
-   <span data-ttu-id="a7327-138">[**Getobjecttotalsize**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjecttotalsize) Wird aufgerufen, um die Gesamtgröße des Objekts abzurufen, das auf das Gerät geschrieben wird, um die Optimierung der Übertragung zu ermöglichen und Windows Media Device Manager die Möglichkeit zu geben, die Übertragung abzubrechen, wenn die Datei für das Gerät zu groß ist.</span><span class="sxs-lookup"><span data-stu-id="a7327-138">[**GetObjectTotalSize**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjecttotalsize) Called to retrieve the total size of the object being written to the device, to enable optimization of the transfer, and also to give Windows Media Device Manager an opportunity to cancel the transfer if the file is too large for the device.</span></span>
-   <span data-ttu-id="a7327-139">[**Transferobjectdata**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) Wird einmal oder mehrmals aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="a7327-139">[**TransferObjectData**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) Called one or more times.</span></span> <span data-ttu-id="a7327-140">Die Verarbeitung von Daten wird in den folgenden Schritten beschrieben:</span><span class="sxs-lookup"><span data-stu-id="a7327-140">The processing of data is described in the following steps:</span></span>
    1.  <span data-ttu-id="a7327-141">**Transferobjectdata** erhält einen Zeiger auf einen Puffer mit einer Größe von *pdwSize* -bytes.</span><span class="sxs-lookup"><span data-stu-id="a7327-141">**TransferObjectData** receives a pointer to a buffer of size *pdwSize* bytes.</span></span>
    2.  <span data-ttu-id="a7327-142">Die Anwendung ruft einen Datenblock ab, der an das Gerät gesendet werden soll, in der Regel durchlesen von Daten aus einer Datei und füllt den empfangenen Puffer mit bis zu *pdwSize* -Bytes aus.</span><span class="sxs-lookup"><span data-stu-id="a7327-142">The application gets a block of data to send to the device, usually by reading data from a file, and fills the received buffer with up to *pdwSize* bytes.</span></span> <span data-ttu-id="a7327-143">Sie sollte *pdwSize* (falls erforderlich) ändern, um widerzuspiegeln, wie viele Bytes dem Puffer hinzugefügt wurden.</span><span class="sxs-lookup"><span data-stu-id="a7327-143">It should modify *pdwSize* (if necessary) to reflect how many bytes were added to the buffer.</span></span>
    3.  <span data-ttu-id="a7327-144">Die Anwendung erstellt einen Mac aller Methoden Parameter.</span><span class="sxs-lookup"><span data-stu-id="a7327-144">The application creates a MAC of all the method parameters.</span></span>
    4.  <span data-ttu-id="a7327-145">Die Anwendung verschlüsselt die Daten im Puffer mithilfe von [**csecurechannelclient:: verschlüsseltparam**](/previous-versions/bb231587(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="a7327-145">The application encrypts the data in the buffer, using [**CSecureChannelClient::EncryptParam**](/previous-versions/bb231587(v=vs.85)).</span></span>
    5.  <span data-ttu-id="a7327-146">**Transferobjectdata** gibt s \_ OK zurück, um anzugeben, dass mehr Daten vorhanden sind, oder s \_ false, um anzugeben, dass keine Daten mehr vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="a7327-146">**TransferObjectData** returns S\_OK to indicate that there is more data, or S\_FALSE to indicate that there is no more data.</span></span> <span data-ttu-id="a7327-147">Wenn die Anwendung den WMDM \_ E \_ \_ -Benutzer abgebrochen zurückgibt, wird der Schreibvorgang abgebrochen, und Windows Media Device Manager ruft **End** auf.</span><span class="sxs-lookup"><span data-stu-id="a7327-147">If the application returns WMDM\_E\_USER\_CANCELLED, the write operation is canceled and Windows Media Device Manager will call **End**.</span></span>
    6.  <span data-ttu-id="a7327-148">Windows Media Device Manager setzt das Abrufen von **transferobjectdata** fort, solange die Anwendung S \_ OK zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="a7327-148">Windows Media Device Manager continues to call **TransferObjectData** as long as the application returns S\_OK.</span></span>
-   <span data-ttu-id="a7327-149">[**Ende**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) Wird aufgerufen, um zu benachrichtigen, dass ein Schreibvorgang auf das Gerät endet.</span><span class="sxs-lookup"><span data-stu-id="a7327-149">[**End**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) Called to notify that a write to device is ending.</span></span>

<span data-ttu-id="a7327-150">Ein Codebeispiel finden Sie unter [Verschlüsselung und Entschlüsselung](encryption-and-decryption.md).</span><span class="sxs-lookup"><span data-stu-id="a7327-150">For a code example, see [Encryption and Decryption](encryption-and-decryption.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="a7327-151">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="a7327-151">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a7327-152">**Erstellen einer Windows Media Device Manager-Anwendung**</span><span class="sxs-lookup"><span data-stu-id="a7327-152">**Creating a Windows Media Device Manager Application**</span></span>](creating-a-windows-media-device-manager-application.md)
</dt> </dl>

 

 