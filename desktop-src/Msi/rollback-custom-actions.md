---
description: Wenn das Installationsskript vom Installationsprogramm verarbeitet wird, wird gleichzeitig ein Rollback-Skript generiert.
ms.assetid: 5b9bfc5a-6a78-4b0e-aed8-f25aba089af1
title: Zurücksetzen von benutzerdefinierten Aktionen
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1c4ad91f8f94145399d51ed2ef53999ab0a91d65
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "103863540"
---
# <a name="rollback-custom-actions"></a><span data-ttu-id="9a16e-103">Zurücksetzen von benutzerdefinierten Aktionen</span><span class="sxs-lookup"><span data-stu-id="9a16e-103">Rollback Custom Actions</span></span>

<span data-ttu-id="9a16e-104">Wenn das Installationsskript vom Installationsprogramm verarbeitet wird, wird gleichzeitig ein Rollback-Skript generiert.</span><span class="sxs-lookup"><span data-stu-id="9a16e-104">When the installer processes the installation script, it simultaneously generates a rollback script.</span></span> <span data-ttu-id="9a16e-105">Zusätzlich zum Rollback-Skript speichert das Installationsprogramm eine Kopie jeder Datei, die während der Installation gelöscht wird.</span><span class="sxs-lookup"><span data-stu-id="9a16e-105">In addition to the rollback script, the installer saves a copy of every file it deletes during the installation.</span></span> <span data-ttu-id="9a16e-106">Diese Dateien werden in einem verborgenen System Verzeichnis gespeichert.</span><span class="sxs-lookup"><span data-stu-id="9a16e-106">These files are kept in a hidden system directory.</span></span> <span data-ttu-id="9a16e-107">Nach Abschluss der Installation werden das Rollback-Skript und die gespeicherten Dateien gelöscht.</span><span class="sxs-lookup"><span data-stu-id="9a16e-107">Once the installation is complete, the rollback script and the saved files are deleted.</span></span> <span data-ttu-id="9a16e-108">Wenn eine Installation nicht erfolgreich ist, versucht das Installationsprogramm, die während der Installation vorgenommenen Änderungen zurückzusetzen und den ursprünglichen Zustand des Computers wiederherzustellen.</span><span class="sxs-lookup"><span data-stu-id="9a16e-108">If an installation is unsuccessful, the installer attempts to rollback the changes made during the installation and restore the original state of the computer.</span></span>

<span data-ttu-id="9a16e-109">Obwohl benutzerdefinierte Aktionen, durch die System Vorgänge durch Einfügen von Zeilen in die Datenbanktabelle geplant werden, durch ein Rollback der Installation rückgängig gemacht werden, können benutzerdefinierte Aktionen, die das System direkt ändern oder Befehle an andere Systemdienste ausgeben, nicht durch ein Rollback umgekehrt werden.</span><span class="sxs-lookup"><span data-stu-id="9a16e-109">Although custom actions that schedule system operations by inserting rows into database table are reversed by a rollback of the installation, custom actions that change the system directly, or that issue commands to other system services, cannot always be reversed by a rollback.</span></span> <span data-ttu-id="9a16e-110">Eine benutzerdefinierte Rollback-Aktion ist eine Aktion, die vom Installationsprogramm nur während eines Installations Rollbacks ausgeführt wird, und der Zweck besteht darin, eine benutzerdefinierte Aktion umzukehren, die Änderungen am System vorgenommen hat.</span><span class="sxs-lookup"><span data-stu-id="9a16e-110">A rollback custom action is an action that the installer executes only during an installation rollback, and its purpose is to reverse a custom action that has made changes to the system.</span></span>

<span data-ttu-id="9a16e-111">Bei einer benutzerdefinierten Rollback-Aktion handelt es sich um eine [benutzerdefinierte Aktion der verzögerten Ausführung](deferred-execution-custom-actions.md), da ihre Ausführung verzögert wird, wenn Sie während der Installations Sequenz aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="9a16e-111">A rollback custom action is a type of [deferred execution custom action](deferred-execution-custom-actions.md), because its execution is deferred when it is invoked during the installation sequence.</span></span> <span data-ttu-id="9a16e-112">Dies unterscheidet sich von einer regulären verzögerten benutzerdefinierten Aktion darin, dass Sie nur während eines Rollbacks ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="9a16e-112">It differs from a regular deferred custom action in that it is only executed during a rollback.</span></span> <span data-ttu-id="9a16e-113">Eine benutzerdefinierte Rollback-Aktion muss immer vor der verzögerten benutzerdefinierten Aktion stehen, die in der Aktions Sequenz zurückgesetzt wird.</span><span class="sxs-lookup"><span data-stu-id="9a16e-113">A rollback custom action must always precede the deferred custom action it rolls back in the action sequence.</span></span> <span data-ttu-id="9a16e-114">Eine benutzerdefinierte Rollback-Aktion sollte auch den Fall behandeln, in dem die verzögerte benutzerdefinierte Aktion während der Ausführung unterbrochen wird.</span><span class="sxs-lookup"><span data-stu-id="9a16e-114">A rollback custom action should also handle the case where the deferred custom action is interrupted in the middle of execution.</span></span> <span data-ttu-id="9a16e-115">Beispielsweise, wenn der Benutzer die Schaltfläche Abbrechen beim Ausführen der benutzerdefinierten Aktion gedrückt hat.</span><span class="sxs-lookup"><span data-stu-id="9a16e-115">For example, if the user were to press the Cancel button while the custom action was executing.</span></span>

<span data-ttu-id="9a16e-116">Beachten Sie, dass benutzerdefinierte Rollbacks-Aktionen nicht asynchron ausgeführt werden können.</span><span class="sxs-lookup"><span data-stu-id="9a16e-116">Note that Rollback Custom Actions cannot run asynchronously.</span></span> <span data-ttu-id="9a16e-117">Siehe [synchrone und asynchrone benutzerdefinierte Aktionen](synchronous-and-asynchronous-custom-actions.md).</span><span class="sxs-lookup"><span data-stu-id="9a16e-117">See [Synchronous and Asynchronous Custom Actions](synchronous-and-asynchronous-custom-actions.md).</span></span>

<span data-ttu-id="9a16e-118">Die Ergänzung zu einer benutzerdefinierten Rollback-Aktion ist eine [benutzerdefinierte Commit-Aktion](commit-custom-actions.md).</span><span class="sxs-lookup"><span data-stu-id="9a16e-118">The complement to a rollback custom action is a [commit custom action](commit-custom-actions.md).</span></span> <span data-ttu-id="9a16e-119">Der Installer führt während der Installations Sequenz eine benutzerdefinierte Commit-Aktion aus, kopiert die benutzerdefinierte Aktion in das Rollback-Skript, führt die Aktion während des Rollbacks jedoch nicht aus.</span><span class="sxs-lookup"><span data-stu-id="9a16e-119">The installer executes a commit custom action during the installation sequence, copies the custom action into the rollback script, but does not execute the action during rollback.</span></span>

<span data-ttu-id="9a16e-120">Beachten Sie, dass eine benutzerdefinierte Rollback-Aktion möglicherweise nicht alle Änderungen entfernt, die durch benutzerdefinierte COMMIT-Aktionen vorgenommen werden.</span><span class="sxs-lookup"><span data-stu-id="9a16e-120">Note that a rollback custom action may not be able to remove all of the changes made by commit custom actions.</span></span> <span data-ttu-id="9a16e-121">Obwohl der Installer sowohl Rollback als auch Commit für benutzerdefinierte Aktionen in das Rollback-Skript schreibt, werden benutzerdefinierte Aktionen nur ausgeführt, nachdem das Installationsskript vom Installationsprogramm erfolgreich verarbeitet wurde.</span><span class="sxs-lookup"><span data-stu-id="9a16e-121">Although the installer writes both rollback and commit custom actions into the rollback script, commit custom actions only run after the installer has successfully processed the installation script.</span></span> <span data-ttu-id="9a16e-122">Commit für benutzerdefinierte Aktionen sind die ersten Aktionen, die im Rollback-Skript ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="9a16e-122">Commit custom actions are the first actions to run in the rollback script.</span></span> <span data-ttu-id="9a16e-123">Wenn bei einer benutzerdefinierten Commit-Aktion ein Fehler auftritt, wird ein Rollback vom Installationsprogramm initiiert</span><span class="sxs-lookup"><span data-stu-id="9a16e-123">If a commit custom action fails, the installer initiates rollback but can only rollback those operations already written to the rollback script.</span></span> <span data-ttu-id="9a16e-124">Dies bedeutet, dass ein Rollback abhängig von der benutzerdefinierten Aktion "Commit" möglicherweise die von der Aktion vorgenommenen Änderungen nicht rückgängig machen kann.</span><span class="sxs-lookup"><span data-stu-id="9a16e-124">This means that depending on the commit custom action, a rollback may not be able to undo the changes made by the action.</span></span> <span data-ttu-id="9a16e-125">Sie können Fehler in benutzerdefinierten COMMIT-Aktionen ignorieren, indem Sie die benutzerdefinierte Aktion erstellen, um Rückgabecodes zu ignorieren.</span><span class="sxs-lookup"><span data-stu-id="9a16e-125">You can ignore failures in commit custom actions by authoring the custom action to ignore return codes.</span></span>

<span data-ttu-id="9a16e-126">Wenn das Installationsprogramm eine benutzerdefinierte Rollback-Aktion ausführt, wird der einzige Mode-Parameter, der festgelegt wird, das msirunmode- \_ Rollback.</span><span class="sxs-lookup"><span data-stu-id="9a16e-126">When the installer runs a rollback custom action, the only mode parameter it will set is MSIRUNMODE\_ROLLBACK.</span></span> <span data-ttu-id="9a16e-127">Unter [**msigetmode**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) finden Sie eine Beschreibung der Parameter für den Testlauf.</span><span class="sxs-lookup"><span data-stu-id="9a16e-127">See [**MsiGetMode**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) for a description of the run mode parameters.</span></span>

<span data-ttu-id="9a16e-128">Eine benutzerdefinierte Rollback-Aktion kann angegeben werden, indem dem type-Feld der [CustomAction-Tabelle](customaction-table.md)ein Optionsflag hinzugefügt wird.</span><span class="sxs-lookup"><span data-stu-id="9a16e-128">A rollback custom action can be specified by adding an option flag to the Type field of the [CustomAction table](customaction-table.md).</span></span> <span data-ttu-id="9a16e-129">Weitere Informationen finden Sie unter [benutzerdefinierte Aktion In-Script Ausführungs Optionen](custom-action-in-script-execution-options.md) für das Optionsflag zum Festlegen einer benutzerdefinierten Aktion Zurücksetzen.</span><span class="sxs-lookup"><span data-stu-id="9a16e-129">See [Custom Action In-Script Execution Options](custom-action-in-script-execution-options.md) for the option flag designating a rollback custom action.</span></span>

<span data-ttu-id="9a16e-130">Die benutzerdefinierten Aktionen Rollback und Commit werden nicht ausgeführt, wenn das Rollback deaktiviert ist.</span><span class="sxs-lookup"><span data-stu-id="9a16e-130">Rollback and commit custom actions do not run when rollback is disabled.</span></span> <span data-ttu-id="9a16e-131">Wenn ein Paket Autor diese Art von benutzerdefinierten Aktionen für die ordnungsgemäße Installation erfordert, sollten Sie die [**rollbackdeaktiviert**](rollbackdisabled.md) -Eigenschaft in einer Bedingung verwenden, die verhindert, dass die Installation fortgesetzt wird, wenn das Rollback deaktiviert ist.</span><span class="sxs-lookup"><span data-stu-id="9a16e-131">If a package author requires these types of custom actions for proper installation, they should use the [**RollbackDisabled**](rollbackdisabled.md) property in a condition that prevents the installation from continuing when rollback is disabled.</span></span> <span data-ttu-id="9a16e-132">Weitere Informationen zum Deaktivieren des Rollbacks finden Sie unter [Rollback Installation (Windows Installer)](rollback-installation.md).</span><span class="sxs-lookup"><span data-stu-id="9a16e-132">For information on how to disable rollback see [Rollback Installation (Windows Installer)](rollback-installation.md).</span></span>

 

 



