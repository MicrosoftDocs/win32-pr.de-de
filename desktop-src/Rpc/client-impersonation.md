---
title: Client Identitätswechsel (RPC)
description: Der Identitätswechsel ist in einer verteilten Computerumgebung hilfreich, wenn Server Client Anforderungen an andere Server Prozesse oder an das Betriebssystem übergeben müssen.
ms.assetid: 49d833d8-c61c-4746-91cf-c0753847cd3d
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d03ad3b4d9e2984708e8b274ab9bc57c3235808b
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/20/2020
ms.locfileid: "104102126"
---
# <a name="client-impersonation"></a><span data-ttu-id="83074-103">Clientidentitätswechsel</span><span class="sxs-lookup"><span data-stu-id="83074-103">Client Impersonation</span></span>

<span data-ttu-id="83074-104">Der Identitätswechsel ist in einer verteilten Computerumgebung hilfreich, wenn Server Client Anforderungen an andere Server Prozesse oder an das Betriebssystem übergeben müssen.</span><span class="sxs-lookup"><span data-stu-id="83074-104">Impersonation is useful in a distributed computing environment when servers must pass client requests to other server processes or to the operating system.</span></span> <span data-ttu-id="83074-105">In diesem Fall nimmt ein Server einen Identitätswechsel für den Sicherheitskontext des Clients vor.</span><span class="sxs-lookup"><span data-stu-id="83074-105">In this case, a server impersonates the client's security context.</span></span> <span data-ttu-id="83074-106">Andere Server Prozesse können dann die Anforderung so verarbeiten, als ob Sie vom ursprünglichen Client erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="83074-106">Other server processes can then handle the request as if the original client made it.</span></span>

![der Server nimmt die Identität eines aufrufenden Clients an, wenn er im Auftrag des Clients nachfolgende Aufrufe ausführt.](images/impr.png)

<span data-ttu-id="83074-108">Beispielsweise sendet ein Client eine Anforderung an Server a. Wenn Server a Server b Abfragen muss, um die Anforderung abzuschließen, nimmt Server a die Identität des Client Sicherheits Kontexts an und sendet die Anforderung an Server b im Auftrag des Clients.</span><span class="sxs-lookup"><span data-stu-id="83074-108">For example, a client makes a request to Server A. If Server A must query Server B to complete the request, Server A impersonates the client security context and makes the request to Server B on behalf of the client.</span></span> <span data-ttu-id="83074-109">Server B verwendet den Sicherheitskontext des ursprünglichen Clients anstelle der Sicherheitsidentität für Server A, um zu bestimmen, ob die Aufgabe ausgeführt werden soll.</span><span class="sxs-lookup"><span data-stu-id="83074-109">Server B uses the original client's security context, instead of the security identity for Server A, to determine whether to complete the task.</span></span>

<span data-ttu-id="83074-110">Der Server ruft [**RpcImpersonateClient**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcimpersonateclient) auf, um die Sicherheit für den Server Thread mit dem Client Sicherheitskontext zu überschreiben.</span><span class="sxs-lookup"><span data-stu-id="83074-110">The server calls [**RpcImpersonateClient**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcimpersonateclient) to overwrite the security for the server thread with the client security context.</span></span> <span data-ttu-id="83074-111">Nachdem die Aufgabe abgeschlossen ist, ruft der Server [**rpkrevertstoself**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcreverttoself) oder [**rpkrevertstarselfex**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcreverttoselfex) auf, um den für den Server Thread definierten Sicherheitskontext wiederherzustellen.</span><span class="sxs-lookup"><span data-stu-id="83074-111">After the task is completed, the server calls [**RpcRevertToSelf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcreverttoself) or [**RpcRevertToSelfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcreverttoselfex) to restore the security context defined for the server thread.</span></span>

<span data-ttu-id="83074-112">Bei der Bindung kann der Client Quality of Service-Informationen zur Sicherheit angeben, die angibt, wie der Server die Identität des Clients annehmen kann.</span><span class="sxs-lookup"><span data-stu-id="83074-112">When binding, the client can specify quality-of-service information about security which specifies how the server can impersonate the client.</span></span> <span data-ttu-id="83074-113">Beispielsweise kann der Client mit einer der-Einstellungen angeben, dass der Server die Identität des Servers nicht annehmen darf.</span><span class="sxs-lookup"><span data-stu-id="83074-113">For example, one of the settings lets the client specify that the server is not allowed to impersonate it.</span></span> <span data-ttu-id="83074-114">Weitere Informationen finden Sie unter [Quality of Service](quality-of-service.md).</span><span class="sxs-lookup"><span data-stu-id="83074-114">For more information, see [Quality of Service](quality-of-service.md).</span></span>

<span data-ttu-id="83074-115">Die Funktion, andere Server beim Annehmen der Identität des ursprünglichen Clients aufzurufen, wird als *Delegierung* bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="83074-115">The capability to call other servers while impersonating the original client is called *delegation*.</span></span> <span data-ttu-id="83074-116">Bei Verwendung der Delegierung kann ein Server, der die Identität eines Clients annimmt, einen anderen Server aufrufen und Netzwerk Aufrufe mit den Anmelde Informationen des Clients durchführen.</span><span class="sxs-lookup"><span data-stu-id="83074-116">When delegation is used, a server impersonating a client can call another server, and can make network calls with the credentials of the client.</span></span> <span data-ttu-id="83074-117">Das heißt aus der Perspektive des zweiten Servers, dass Anforderungen vom ersten Server nicht von den Anforderungen des Clients unterschieden werden können.</span><span class="sxs-lookup"><span data-stu-id="83074-117">That is, from the perspective of the second server, requests coming from the first server are indistinguishable from requests coming from the client.</span></span> <span data-ttu-id="83074-118">Die Delegierung wird nicht von allen Sicherheitsanbietern unterstützt.</span><span class="sxs-lookup"><span data-stu-id="83074-118">Not all security providers support delegation.</span></span> <span data-ttu-id="83074-119">Microsoft umfasst nur einen Sicherheitsanbieter, der die Delegierung unterstützt: Kerberos.</span><span class="sxs-lookup"><span data-stu-id="83074-119">Microsoft ships only one security provider that supports delegation: Kerberos.</span></span>

<span data-ttu-id="83074-120">Die Delegierung kann aufgrund der Berechtigungen, die der Client während eines Remote Prozedur Aufrufes dem Server erteilt, eine gefährliche Möglichkeit darstellen.</span><span class="sxs-lookup"><span data-stu-id="83074-120">Delegation can be a dangerous capability due to the privileges the client gives the server during a remote procedure call.</span></span> <span data-ttu-id="83074-121">Der Grund hierfür ist, dass Kerberos Aufrufe mit der Identitätswechsel Ebene nur dann zulässt, wenn eine gegenseitige Authentifizierung angefordert wird.</span><span class="sxs-lookup"><span data-stu-id="83074-121">This is why Kerberos allows calls with the impersonation level of delegation only if mutual authentication is requested.</span></span> <span data-ttu-id="83074-122">Domänen Administratoren können die Computer einschränken, auf die Aufrufe mit Delegierungs Identitätswechsel Ebene vorgenommen werden, um zu verhindern, dass ahnungslose Clients Aufrufe an Server durchführen, die ihre Anmelde Informationen missbrauchen.</span><span class="sxs-lookup"><span data-stu-id="83074-122">Domain administrators can limit the computers to which calls with delegation impersonation level are made to prevent unsuspecting clients from making calls to servers that could abuse their credentials.</span></span>

<span data-ttu-id="83074-123">Eine Ausnahme von der Delegierungs Regel besteht: Aufrufe mit [**Ncalrpc**](/windows/desktop/Midl/ncalrpc).</span><span class="sxs-lookup"><span data-stu-id="83074-123">One exception to the delegation rule exists: calls using [**ncalrpc**](/windows/desktop/Midl/ncalrpc).</span></span> <span data-ttu-id="83074-124">Wenn diese Aufrufe durchgeführt werden, erhält der Server Delegierungs Rechte, auch wenn eine Identitätswechsel Ebene mit Identitätswechsel angegeben wird.</span><span class="sxs-lookup"><span data-stu-id="83074-124">When these calls are made the server gets delegation rights, even if an impersonation level of impersonate is specified.</span></span> <span data-ttu-id="83074-125">Das heißt, ein Server kann andere Server im Namen des Clients anrufen.</span><span class="sxs-lookup"><span data-stu-id="83074-125">That is, a server can call other servers on behalf of the client.</span></span> <span data-ttu-id="83074-126">Dies funktioniert nur für einen Remote-Rückruf.</span><span class="sxs-lookup"><span data-stu-id="83074-126">This works for one remote call only.</span></span> <span data-ttu-id="83074-127">Wenn der Client A z. b. den lokalen Server-lb mithilfe des lokalen **Ncalrpc** -Servers aufruft, kann er einen Identitätswechsel durchgeführt und Remote Server RB aufrufen</span><span class="sxs-lookup"><span data-stu-id="83074-127">For example, if client A calls local server LB using **ncalrpc** local server LB can impersonate and call remote server RB.</span></span> <span data-ttu-id="83074-128">RB kann im Auftrag von Client A agieren, aber nur auf dem Remote Computer, auf dem RB ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="83074-128">RB will be able to act on behalf of client A, but only on the remote computer that RB is running on.</span></span> <span data-ttu-id="83074-129">Es kann keinen weiteren Netzwerk Aufruf an den Remote Computer C ausführen, es sei denn, der Lastenausgleich hat beim Aufruf von RB eine Identitätswechsel Ebene angegeben.</span><span class="sxs-lookup"><span data-stu-id="83074-129">It cannot make another network call to remote computer C unless LB specified an impersonation level of delegate when it called RB.</span></span>

> [!Note]  
> <span data-ttu-id="83074-130">Der Begriff *Identitäts* Wechsel stellt zwei überlappende Bedeutungen dar.</span><span class="sxs-lookup"><span data-stu-id="83074-130">The term *impersonation* represents two overlapping meanings.</span></span> <span data-ttu-id="83074-131">Die erste Bedeutung des Identitäts Wechsels ist der allgemeine Prozess der Durchsetzung von im Auftrag eines Clients.</span><span class="sxs-lookup"><span data-stu-id="83074-131">The first meaning of impersonation is the general process of acting on behalf of a client.</span></span> <span data-ttu-id="83074-132">Die zweite Bedeutung ist die spezifische Identitätswechsel Ebene, die als Identitätswechsel bezeichnet wird.</span><span class="sxs-lookup"><span data-stu-id="83074-132">The second meaning is the specific impersonation level called impersonation.</span></span> <span data-ttu-id="83074-133">Im allgemeinen verdeutlicht der Kontext des Texts die Bedeutung.</span><span class="sxs-lookup"><span data-stu-id="83074-133">The context of the text generally clarifies the meaning.</span></span>

 

 

 