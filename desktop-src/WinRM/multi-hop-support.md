---
title: Unterstützung von Multi-Hop in WinRM
description: Windows-Remoteverwaltung (WinRM) unterstützt die Delegierung von Benutzer Anmelde Informationen auf mehrere Remote Computer.
ms.assetid: 0e6c8966-bb05-4dfb-b154-300fa76e8d9c
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f22c3d66e8605e932fe15b812f92d51350da2d69
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "104482806"
---
# <a name="multi-hop-support-in-winrm"></a><span data-ttu-id="b9be5-103">Unterstützung von Multi-Hop in WinRM</span><span class="sxs-lookup"><span data-stu-id="b9be5-103">Multi-Hop Support in WinRM</span></span>

<span data-ttu-id="b9be5-104">Windows-Remoteverwaltung (WinRM) unterstützt die Delegierung von Benutzer Anmelde Informationen auf mehrere Remote Computer.</span><span class="sxs-lookup"><span data-stu-id="b9be5-104">Windows Remote Management (WinRM) supports the delegation of user credentials across multiple remote computers.</span></span> <span data-ttu-id="b9be5-105">Die Multi-Hop-Unterstützungsfunktion kann nun Anmelde Informationen Security Service Provider (kredssp) für die Authentifizierung verwenden.</span><span class="sxs-lookup"><span data-stu-id="b9be5-105">The multi-hop support functionality can now use Credential Security Service Provider (CredSSP) for authentication.</span></span> <span data-ttu-id="b9be5-106">Mit "kredssp" kann eine Anwendung die Anmelde Informationen des Benutzers vom Client Computer an den Zielserver delegieren.</span><span class="sxs-lookup"><span data-stu-id="b9be5-106">CredSSP enables an application to delegate the user's credentials from the client computer to the target server.</span></span>

<span data-ttu-id="b9be5-107">Die Authentifizierung mit der Authentifizierung ist für Umgebungen vorgesehen, in denen die Kerberos-Delegierung nicht verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="b9be5-107">CredSSP authentication is intended for environments where Kerberos delegation cannot be used.</span></span> <span data-ttu-id="b9be5-108">Die Unterstützung für "kredssp" wurde hinzugefügt, damit ein Benutzer eine Verbindung mit einem Remote Server herstellen und auf einen Computer mit einem zweiten Hop (z. b. auf eine Dateifreigabe) zugreifen kann.</span><span class="sxs-lookup"><span data-stu-id="b9be5-108">Support for CredSSP was added to allow a user to connect to a remote server and have the ability to access a second-hop machine, such as a file share.</span></span>

<span data-ttu-id="b9be5-109">Weitere Informationen zu "kredssp" finden Sie in [KB 951608](https://support.microsoft.com/kb/951608).</span><span class="sxs-lookup"><span data-stu-id="b9be5-109">For more information about CredSSP, see [KB 951608](https://support.microsoft.com/kb/951608).</span></span>

> [!Note]  
> <span data-ttu-id="b9be5-110">WinRM-Clients und-Server unterstützen die kredssp-Authentifizierung nur mit expliziten Anmelde Informationen.</span><span class="sxs-lookup"><span data-stu-id="b9be5-110">WinRM clients and servers will support CredSSP authentication only with explicit credentials.</span></span>

 

## <a name="multi-hop-support-configuration-setup-and-details"></a><span data-ttu-id="b9be5-111">Setup und Details zur Unterstützung der Multihop-Unterstützung</span><span class="sxs-lookup"><span data-stu-id="b9be5-111">Multi-Hop Support Configuration Setup and Details</span></span>

<span data-ttu-id="b9be5-112">Es gibt mehrere Mechanismen zum Konfigurieren von WinRM-Einstellungen.</span><span class="sxs-lookup"><span data-stu-id="b9be5-112">There are multiple mechanisms for configuring WinRM settings.</span></span> <span data-ttu-id="b9be5-113">Im folgenden Verfahren werden das **WinRM** -Hilfsprogramm und der Gruppenrichtlinie-Editor (**gpeer dit. msc**) verwendet.</span><span class="sxs-lookup"><span data-stu-id="b9be5-113">In the following procedure, the **winrm** utility and Group Policy editor (**GPEdit.msc**) are used.</span></span> <span data-ttu-id="b9be5-114">"Kredssp" kann auch mithilfe von Windows PowerShell für WinRM aktiviert werden.</span><span class="sxs-lookup"><span data-stu-id="b9be5-114">CredSSP can also be enabled for WinRM by using Windows PowerShell.</span></span> <span data-ttu-id="b9be5-115">Ausführliche Informationen zu den Konfigurationsinformationen und Verwendungs Beispielen finden Sie in den Windows PowerShell-Cmdlets " [enable-wsmankredssp](/powershell/module/Microsoft.WsMan.Management/Enable-WSManCredSSP?view=powershell-5.1&preserve-view=true)", " [Get-wsmankredssp](/powershell/module/Microsoft.WsMan.Management/Get-WSManCredSSP?view=powershell-5.1&preserve-view=true)" und " [Deaktivierte wsmankredssp](/powershell/module/Microsoft.WsMan.Management/Disable-WSManCredSSP?view=powershell-5.1&preserve-view=true) ".</span><span class="sxs-lookup"><span data-stu-id="b9be5-115">See the [Enable-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Enable-WSManCredSSP?view=powershell-5.1&preserve-view=true), [Get-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Get-WSManCredSSP?view=powershell-5.1&preserve-view=true), and [Disable-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Disable-WSManCredSSP?view=powershell-5.1&preserve-view=true) Windows PowerShell cmdlets for detailed configuration information and usage examples.</span></span>

<span data-ttu-id="b9be5-116">Die erstellungskredssp-Delegierung muss in den Client Einstellungen und in den Dienst Einstellungen auf dem Remote Computer aktiviert sein.</span><span class="sxs-lookup"><span data-stu-id="b9be5-116">CredSSP delegation must be enabled in the client settings and in the service settings on the remote computer.</span></span> <span data-ttu-id="b9be5-117">Darüber hinaus erfordert die Verwendung von "up-SP" das Einrichten eines HTTP-oder HTTPS- [*Listener*](windows-remote-management-glossary.md) auf dem Server.</span><span class="sxs-lookup"><span data-stu-id="b9be5-117">In addition, using CredSSP requires setting up an HTTP or HTTPS [*listener*](windows-remote-management-glossary.md) on the server.</span></span>

<span data-ttu-id="b9be5-118">**So konfigurieren Sie die Unterstützung von Multi-Hop mithilfe der-Authentifizierung für WinRM**</span><span class="sxs-lookup"><span data-stu-id="b9be5-118">**To configure multi-hop support using CredSSP authentication for WinRM**</span></span>

1.  <span data-ttu-id="b9be5-119">"Kredssp" muss in den Client Konfigurationseinstellungen aktiviert werden.</span><span class="sxs-lookup"><span data-stu-id="b9be5-119">CredSSP must be enabled in the client configuration settings.</span></span> <span data-ttu-id="b9be5-120">Dieses Flag kann manuell oder über eine Gruppenrichtlinie Einstellung aktiviert werden.</span><span class="sxs-lookup"><span data-stu-id="b9be5-120">This flag can be enabled manually or through a Group Policy setting.</span></span> <span data-ttu-id="b9be5-121">Die Standardeinstellung lautet **Falsch**.</span><span class="sxs-lookup"><span data-stu-id="b9be5-121">The default setting is **False**.</span></span> <span data-ttu-id="b9be5-122">Die Richtlinie zum **Zulassen der Autorisierung** für die Authentifizierung befindet sich unter folgendem Pfad: Computer Konfiguration \\ Administrative Vorlage \\ Windows-Komponenten \\ Windows-Remoteverwaltung (WinRM) \\ WinRM-Client.</span><span class="sxs-lookup"><span data-stu-id="b9be5-122">The **Allow CredSSP authentication** policy is located at the following path: Computer Configuration\\Administrative template\\Windows Components\\Windows Remote Management (WinRM)\\WinRM Client.</span></span>

    <span data-ttu-id="b9be5-123">Der folgende Befehl veranschaulicht, wie Sie das WinRM-Hilfsprogramm zum Aktivieren von "kredssp" auf dem WinRM-Client verwenden:</span><span class="sxs-lookup"><span data-stu-id="b9be5-123">The following command demonstrates how to use the winrm utility to enable CredSSP on the WinRM client:</span></span>

    <span data-ttu-id="b9be5-124">**WinRM Set WinRM/config/Client/auth @ {condssp = "true"}**</span><span class="sxs-lookup"><span data-stu-id="b9be5-124">**winrm set winrm/config/client/auth @{CredSSP="true"}**</span></span>

2.  <span data-ttu-id="b9be5-125">"Kredssp" muss in den WinRM-Dienst Konfigurationseinstellungen aktiviert werden.</span><span class="sxs-lookup"><span data-stu-id="b9be5-125">CredSSP must be enabled in the WinRM service configuration settings.</span></span> <span data-ttu-id="b9be5-126">Dieses Flag kann manuell oder über eine Gruppenrichtlinie Einstellung aktiviert werden.</span><span class="sxs-lookup"><span data-stu-id="b9be5-126">This flag can be enabled manually or through a Group Policy setting.</span></span> <span data-ttu-id="b9be5-127">Die Standardeinstellung lautet **Falsch**.</span><span class="sxs-lookup"><span data-stu-id="b9be5-127">The default setting is **False**.</span></span> <span data-ttu-id="b9be5-128">Die Richtlinie zum **Zulassen der Autorisierung** für die Authentifizierung befindet sich unter folgendem Pfad: Computer Konfiguration \\ Administrative Vorlage \\ Windows-Komponenten \\ Windows-Remoteverwaltung (WinRM) \\ WinRM-Dienst.</span><span class="sxs-lookup"><span data-stu-id="b9be5-128">The **Allow CredSSP authentication** policy is located at the following path: Computer Configuration\\Administrative template\\Windows Components\\Windows Remote Management (WinRM)\\WinRM Service.</span></span>

    <span data-ttu-id="b9be5-129">Der folgende Befehl veranschaulicht, wie Sie das WinRM-Hilfsprogramm zum Aktivieren von "kredssp" für den WinRM-Dienst verwenden:</span><span class="sxs-lookup"><span data-stu-id="b9be5-129">The following command demonstrates how to use the winrm utility to enable CredSSP on the WinRM service:</span></span>

    <span data-ttu-id="b9be5-130">**WinRM Set WinRM/config/Service/auth @ {condssp = "true"}**</span><span class="sxs-lookup"><span data-stu-id="b9be5-130">**winrm set winrm/config/service/auth @{CredSSP="true"}**</span></span>

3.  <span data-ttu-id="b9be5-131">Die Richtlinien Einstellung Delegierung neuer Anmelde Informationen zulassen (**allowfreshanmeldeinformationen**) muss auf dem WinRM-Client aktiviert sein, und ein Dienst Prinzipal Name (Service Principal Name, SPN) mit dem WSMAN-Präfix muss der Richtlinie hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="b9be5-131">The Allow Delegating Fresh Credentials (**AllowFreshCredentials**) policy setting must be enabled on the WinRM client, and a Service Principal Name (SPN) with the WSMAN prefix must be added to the policy.</span></span> <span data-ttu-id="b9be5-132">Der SPN stellt den Zielcomputer dar, an den die Anmelde Informationen des Benutzers delegiert werden können.</span><span class="sxs-lookup"><span data-stu-id="b9be5-132">The SPN represents the target computer to which the user credentials can be delegated.</span></span> <span data-ttu-id="b9be5-133">Der SPN kann auf einen oder mehrere Computer festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="b9be5-133">The SPN can be set to one or more computers.</span></span> <span data-ttu-id="b9be5-134">In der folgenden Tabelle finden Sie Beispiele für gültige Formate für SPNs.</span><span class="sxs-lookup"><span data-stu-id="b9be5-134">The following table contains examples of valid formats for SPNs.</span></span>

    

    | <span data-ttu-id="b9be5-135">SPN</span><span class="sxs-lookup"><span data-stu-id="b9be5-135">SPN</span></span>                                       | <span data-ttu-id="b9be5-136">BESCHREIBUNG</span><span class="sxs-lookup"><span data-stu-id="b9be5-136">Description</span></span>                                                                         |
    |-------------------------------------------|-------------------------------------------------------------------------------------|
    | <span data-ttu-id="b9be5-137">WSMAN/MyComputer. mydomain. com</span><span class="sxs-lookup"><span data-stu-id="b9be5-137">WSMAN/myComputer.myDomain.com</span></span><br/>  | <span data-ttu-id="b9be5-138">WinRM-Server, der auf myComputer.mydomain.com ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="b9be5-138">WinRM server running on myComputer.myDomain.com.</span></span><br/>                         |
    | <span data-ttu-id="b9be5-139">WSMAN/ \* . mydomain.com</span><span class="sxs-lookup"><span data-stu-id="b9be5-139">WSMAN/\*.myDomain.com</span></span><br/>          | <span data-ttu-id="b9be5-140">Alle WinRM-Server, die in mydomain.com ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="b9be5-140">All WinRM servers running in myDomain.com.</span></span><br/>                               |
    | <span data-ttu-id="b9be5-141">WSMAN/ \* . fabrikam.mydomain.com</span><span class="sxs-lookup"><span data-stu-id="b9be5-141">WSMAN/\*.fabrikam.myDomain.com</span></span><br/> | <span data-ttu-id="b9be5-142">Alle WinRM-Server, die in ausgeführt werden, auf allen Computern in. fabrikam.mydomain.com.</span><span class="sxs-lookup"><span data-stu-id="b9be5-142">All WinRM servers running in on all computers in .fabrikam.myDomain.com.</span></span><br/> |

    

     

    <span data-ttu-id="b9be5-143">Weitere Informationen zum Festlegen von Gruppenrichtlinien finden Sie unter [Installation und Konfiguration für Windows-Remoteverwaltung](installation-and-configuration-for-windows-remote-management.md).</span><span class="sxs-lookup"><span data-stu-id="b9be5-143">For more information about setting Group Policies, see [Installation and Configuration for Windows Remote Management](installation-and-configuration-for-windows-remote-management.md).</span></span>

    <span data-ttu-id="b9be5-144">Weitere Informationen zur Richtlinie **allowfreshanmeldeinformationen** finden Sie in der Richtlinien Beschreibung, die vom Gruppenrichtlinie-Editor bereitgestellt wird, und [KB 951608](https://support.microsoft.com/kb/951608).</span><span class="sxs-lookup"><span data-stu-id="b9be5-144">For more information about the **AllowFreshCredentials** policy, see the policy description provided by the Group Policy editor and [KB 951608](https://support.microsoft.com/kb/951608).</span></span> <span data-ttu-id="b9be5-145">Die Richtlinie " **allowfresh-Anmelde** Informationen" befindet sich unter folgendem Pfad: Computer Konfiguration \\ Administrative Vorlagen \\ \\ Delegierung von System Anmelde Informationen.</span><span class="sxs-lookup"><span data-stu-id="b9be5-145">The **AllowFreshCredentials** policy is located at the following path: Computer Configuration\\Administrative Templates\\System\\Credentials Delegation.</span></span>

4.  <span data-ttu-id="b9be5-146">Ein HTTPS-oder http- [*Listener*](windows-remote-management-glossary.md) muss auf dem Server konfiguriert werden.</span><span class="sxs-lookup"><span data-stu-id="b9be5-146">An HTTPS or HTTP [*listener*](windows-remote-management-glossary.md) must be configured on the server.</span></span> <span data-ttu-id="b9be5-147">Der Zertifikat Fingerabdruck, der zum Konfigurieren des HTTPS- *Listener* verwendet wird, wird auch zum Konfigurieren der Einstellung "certifikatethenbprint" unter den WinRM-Dienst Einstellungen verwendet.</span><span class="sxs-lookup"><span data-stu-id="b9be5-147">The certificate thumbprint used for configuring the HTTPS *listener* is also used to configure the CertificateThumbprint setting under the WinRM service settings.</span></span>

    <span data-ttu-id="b9be5-148">Der folgende Befehl veranschaulicht, wie Sie mit dem WinRM-Hilfsprogramm einen HTTPS- [*Listener*](windows-remote-management-glossary.md)konfigurieren:</span><span class="sxs-lookup"><span data-stu-id="b9be5-148">The following command demonstrates how to use the winrm utility to configure an HTTPS [*listener*](windows-remote-management-glossary.md):</span></span>

    <span data-ttu-id="b9be5-149">**WinRM quickconfig-Transport: https**</span><span class="sxs-lookup"><span data-stu-id="b9be5-149">**winrm quickconfig -transport:https**</span></span>

<span data-ttu-id="b9be5-150">Wenn die Kerberos-Authentifizierung zwischen Client und Server nicht möglich ist, muss der Benutzer eine der folgenden Einstellungen für die Unterstützung von Multi-Hop konfigurieren:</span><span class="sxs-lookup"><span data-stu-id="b9be5-150">If Kerberos authentication between the client and server is not possible, the user must configure one of the following settings for multi-hop support:</span></span>

-   <span data-ttu-id="b9be5-151">Um die Sicherheit zu verbessern, sollte der Benutzer der WinRM-Dienst Einstellung das **certifiupethumschlag** -Attribut hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="b9be5-151">For better security, the user should add the **CertificateThumbprint** attribute to the WinRM service setting.</span></span> <span data-ttu-id="b9be5-152">Wenn der WinRM-Dienst mit einem **certifikatethbibprint** -Attribut konfiguriert ist, versucht der Dienst, das entsprechende Zertifikat im Speicher des lokalen Computers zu finden, und verwendet dieses Zertifikat für die Authentifizierung mit dem lokalen Computer.</span><span class="sxs-lookup"><span data-stu-id="b9be5-152">If the WinRM service is configured with a **CertificateThumbprint** attribute, the service attempts to locate the corresponding certificate in the Local Machine store and uses this certificate for the CredSSP authentication.</span></span> <span data-ttu-id="b9be5-153">Wenn der WinRM-Dienst ein Zertifikat aus dem lokalen Computerspeicher zum Authentifizieren des Servers verwendet, muss dem Netzwerkdienst Konto der Zugriff auf den privaten Schlüssel des Zertifikats gestattet sein.</span><span class="sxs-lookup"><span data-stu-id="b9be5-153">If the WinRM service uses a certificate from the Local Machine store to authenticate the server, the Network Service account must be allowed access to the private key of the certificate.</span></span>

    > [!Note]  
    > <span data-ttu-id="b9be5-154">Wenn die Dienst Einstellung nicht konfiguriert ist, verwendet der WinRM-Server ein selbst signiertes Zertifikat, das im Arbeitsspeicher erstellt wird, um die an den Client gesendeten Nachrichten zu verschlüsseln.</span><span class="sxs-lookup"><span data-stu-id="b9be5-154">If the service setting is not configured, the WinRM server uses a self-signed certificate that is created in memory to encrypt messages sent to the client.</span></span> <span data-ttu-id="b9be5-155">Dieses Zertifikat wird jedoch nicht für die Authentifizierung verwendet.</span><span class="sxs-lookup"><span data-stu-id="b9be5-155">However, this certificate is not used for authentication.</span></span>

     

-   <span data-ttu-id="b9be5-156">Wenn weder die Kerberos-Authentifizierung noch die Zertifikat Fingerabdrücke verfügbar sind, kann der Benutzer die NTLM-Authentifizierung aktivieren.</span><span class="sxs-lookup"><span data-stu-id="b9be5-156">If neither Kerberos authentication nor certificate thumbprints are available, the user can enable NTLM authentication.</span></span> <span data-ttu-id="b9be5-157">Wenn die NTLM-Authentifizierung verwendet wird, muss die Richtlinie neue Anmelde Informationen mit nur NTLM-Server Authentifizierung zulassen (**allowfreshkredentials. ntlmonly**) aktiviert sein, und der Richtlinie muss ein SPN mit dem WSMAN-Präfix hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="b9be5-157">If NTLM authentication is used, the Allow Fresh Credentials with NTLM-only Server Authentication (**AllowFreshCredentialsWhenNTLMOnly**) policy must be enabled, and an SPN with the WSMAN prefix must be added to the policy.</span></span> <span data-ttu-id="b9be5-158">Diese Einstellung ist weniger sicher als die Kerberos-Authentifizierung und Zertifikat Fingerabdrücke, weil Anmelde Informationen an einen nicht authentifizierten Server gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="b9be5-158">This setting is less secure than both Kerberos authentication and certificate thumbprints, because credentials are sent to an unauthenticated server.</span></span>

    <span data-ttu-id="b9be5-159">Weitere Informationen zur Richtlinie **allowfreshkredentialseinsntlmonly** finden Sie in der Richtlinien Beschreibung, die vom Gruppenrichtlinie-Editor bereitgestellt wird, und [KB 951608](https://support.microsoft.com/kb/951608).</span><span class="sxs-lookup"><span data-stu-id="b9be5-159">For more information about the **AllowFreshCredentialsWhenNTLMOnly** policy, see the policy description provided by the Group Policy editor and [KB 951608](https://support.microsoft.com/kb/951608).</span></span> <span data-ttu-id="b9be5-160">Die Richtlinie " **allowfreshkredentials. ntlmonly** " befindet sich unter folgendem Pfad: Computer Konfiguration \\ Administrative Vorlagen \\ \\ Delegierung von System Anmelde Informationen.</span><span class="sxs-lookup"><span data-stu-id="b9be5-160">The **AllowFreshCredentialsWhenNTLMOnly** policy is located at the following path: Computer Configuration\\Administrative Templates\\System\\Credentials Delegation.</span></span>

## <a name="using-credssp-authentication-with-explicit-credentials"></a><span data-ttu-id="b9be5-161">Verwenden der fordssp-Authentifizierung mit expliziten Anmelde Informationen</span><span class="sxs-lookup"><span data-stu-id="b9be5-161">Using CredSSP Authentication with Explicit Credentials</span></span>

<span data-ttu-id="b9be5-162">Ein Benutzer kann sowohl über HTTP als auch über HTTPS explizite Anmelde Informationen angeben.</span><span class="sxs-lookup"><span data-stu-id="b9be5-162">A user can specify explicit credentials over both HTTP and HTTPS.</span></span> <span data-ttu-id="b9be5-163">Mit dem folgenden Befehl wird veranschaulicht, wie das WinRM-Hilfsprogramm verwendet wird, um einen Remote Vorgang mithilfe der-Authentifizierung mit der Authentifizierung mit expliziten Anmelde Informationen über HTTPS auszuführen</span><span class="sxs-lookup"><span data-stu-id="b9be5-163">The following command demonstrates how to use the winrm utility to perform a remote operation using CredSSP authentication with explicit credentials over HTTPS:</span></span>

<span data-ttu-id="b9be5-164">**WinRM-Vorgang-Remote: https://myMachine -Authentication: "kredssp-username: MyUserName-Password: mypassword"**</span><span class="sxs-lookup"><span data-stu-id="b9be5-164">**winrm OPERATION -remote:https://myMachine -authentication:CredSSP -username:myUsername -password:myPassword**</span></span>

 

