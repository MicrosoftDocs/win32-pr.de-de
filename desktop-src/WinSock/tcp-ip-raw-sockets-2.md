---
description: Ein unformatierte Socket ist ein Typ von Socket, der den Zugriff auf den zugrunde liegenden Transportanbieter ermöglicht.
ms.assetid: 4cbe5505-75e7-454f-9e6b-f38bdc60bf6d
title: TCP/IP-Rohdaten Sockets
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 25cc08d59d80089a4e655f363e4a899edac8d2b8
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "106345880"
---
# <a name="tcpip-raw-sockets"></a><span data-ttu-id="d9de0-103">TCP/IP-Rohdaten Sockets</span><span class="sxs-lookup"><span data-stu-id="d9de0-103">TCP/IP Raw Sockets</span></span>

<span data-ttu-id="d9de0-104">Ein unformatierte Socket ist ein Typ von Socket, der den Zugriff auf den zugrunde liegenden Transportanbieter ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="d9de0-104">A raw socket is a type of socket that allows access to the underlying transport provider.</span></span> <span data-ttu-id="d9de0-105">In diesem Thema geht es nur um RAW-Sockets und IPv4-und IPv6-Protokolle.</span><span class="sxs-lookup"><span data-stu-id="d9de0-105">This topic focuses only on raw sockets and the IPv4 and IPv6 protocols.</span></span> <span data-ttu-id="d9de0-106">Dies liegt daran, dass die meisten anderen Protokolle mit Ausnahme von ATM keine Rohdaten Sockets unterstützen.</span><span class="sxs-lookup"><span data-stu-id="d9de0-106">This is because most other protocols with the exception of ATM do not support raw sockets.</span></span> <span data-ttu-id="d9de0-107">Um Unformatierte Sockets zu verwenden, benötigt eine Anwendung ausführliche Informationen über das zugrunde liegende Protokoll, das verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="d9de0-107">To use raw sockets, an application needs to have detailed information on the underlying protocol being used.</span></span>

<span data-ttu-id="d9de0-108">Winsock-Dienstanbieter für das IP-Protokoll unterstützen möglicherweise einen *Sockettyp* von **Sock- \_ RAW**.</span><span class="sxs-lookup"><span data-stu-id="d9de0-108">Winsock service providers for the IP protocol may support a socket *type* of **SOCK\_RAW**.</span></span> <span data-ttu-id="d9de0-109">Der in Windows enthaltene Windows Sockets 2-Anbieter für TCP/IP unterstützt diesen Sockettyp mit **\_ socketrohdaten** .</span><span class="sxs-lookup"><span data-stu-id="d9de0-109">The Windows Sockets 2 provider for TCP/IP included on Windows supports this **SOCK\_RAW** socket type.</span></span>

<span data-ttu-id="d9de0-110">Es gibt zwei grundlegende Arten von rohsockets:</span><span class="sxs-lookup"><span data-stu-id="d9de0-110">There are two basic types of such raw sockets:</span></span>

-   <span data-ttu-id="d9de0-111">Der erste Typ verwendet einen bekannten Protokolltyp, der im IP-Header geschrieben ist, der von einem Winsock-Dienstanbieter erkannt wird.</span><span class="sxs-lookup"><span data-stu-id="d9de0-111">The first type uses a known protocol type written in the IP header that is recognized by a Winsock service provider.</span></span> <span data-ttu-id="d9de0-112">Ein Beispiel für den ersten Sockettyp ist ein Socket für das ICMP-Protokoll (IP-Protokolltyp = 1) oder das ICMPv6-Protokoll (IP Procotol Type = 58).</span><span class="sxs-lookup"><span data-stu-id="d9de0-112">An example of the first type of socket is a socket for the ICMP protocol (IP protocol type = 1) or the ICMPv6 protocol (IP procotol type = 58).</span></span>
-   <span data-ttu-id="d9de0-113">Der zweite Typ ermöglicht das Angeben eines beliebigen Protokoll Typs.</span><span class="sxs-lookup"><span data-stu-id="d9de0-113">The second type allows any protocol type to be specified.</span></span> <span data-ttu-id="d9de0-114">Ein Beispiel für den zweiten Typ wäre ein experimentelles Protokoll, das nicht direkt vom Winsock-Dienstanbieter, wie z. b. dem Stream Control Transmission Protocol (SCTP), unterstützt wird.</span><span class="sxs-lookup"><span data-stu-id="d9de0-114">An example of the second type would be an experimental protocol that is not directly supported by the Winsock service provider such as the Stream Control Transmission Protocol (SCTP).</span></span>

## <a name="determining-if-raw-sockets-are-supported"></a><span data-ttu-id="d9de0-115">Ermitteln, ob RAW-Sockets unterstützt werden</span><span class="sxs-lookup"><span data-stu-id="d9de0-115">Determining if Raw Sockets are Supported</span></span>

<span data-ttu-id="d9de0-116">Wenn ein Winsock-Dienstanbieter **Sock- \_ RAW** -Sockets für die AF- \_ oder AF \_ inet6-Adressfamilien unterstützt, sollte der socketyp von **Sock \_ RAW** in der von der [**wsaenumprotokolls**](/windows/desktop/api/Winsock2/nf-winsock2-wsaenumprotocolsa) -Funktion für einen oder mehrere der verfügbaren Transportanbieter zurückgegebenen [**\_ wsaenumprotokolle**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) -Struktur enthalten sein.</span><span class="sxs-lookup"><span data-stu-id="d9de0-116">If a Winsock service provider supports **SOCK\_RAW** sockets for the AF\_INET or AF\_INET6 address families, the socket type of **SOCK\_RAW** should be included in the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure returned by [**WSAEnumProtocols**](/windows/desktop/api/Winsock2/nf-winsock2-wsaenumprotocolsa) function for one or more of the available transport providers.</span></span>

<span data-ttu-id="d9de0-117">Der Member " **iaddressfamily** " in der [**wsaprotocol- \_ Informations**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) Struktur sollte "AF inet" oder "AF inet6" angeben, \_ \_ und der Member " **isockettype** " der **wsaprotocol- \_ Informations** Struktur sollte " **Sock \_ RAW** " für einen der Transportanbieter angeben.</span><span class="sxs-lookup"><span data-stu-id="d9de0-117">The **iAddressFamily** member in the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure should specify AF\_INET or AF\_INET6 and the **iSocketType** member of the **WSAPROTOCOL\_INFO** structure should specify **SOCK\_RAW** for one of the transport providers.</span></span>

<span data-ttu-id="d9de0-118">Der **iProtocol** -Member der [**wsaprotocol- \_ Informations**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) Struktur kann auf **iproto \_ IP** festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="d9de0-118">The **iProtocol** member of the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure may be set to **IPROTO\_IP**.</span></span> <span data-ttu-id="d9de0-119">Der **iProtocol** -Member der **wsaprotocol- \_ Informations** Struktur kann auch auf 0 (null) festgelegt werden, wenn der Dienstanbieter es einer Anwendung ermöglicht, einen Socket- **\_ rohsocketyp** für andere Netzwerkprotokolle als das Internet Protokoll für die Adressfamilie zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="d9de0-119">The **iProtocol** member of the **WSAPROTOCOL\_INFO** structure may also be set to zero if the service provider allows an application to use a **SOCK\_RAW** socket type for other network protocols other than the Internet Protocol for the address family.</span></span>

<span data-ttu-id="d9de0-120">Die anderen Elemente in der [**wsaprotocol- \_ Informations**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) Struktur geben andere Eigenschaften der Protokoll Unterstützung für **Sock \_ RAW** an und geben an, wie ein Socket von **Sock- \_ RAW** behandelt werden soll.</span><span class="sxs-lookup"><span data-stu-id="d9de0-120">The other members in the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure indicate other properties of the protocol support for **SOCK\_RAW** and indicate how a socket of **SOCK\_RAW** should be treated.</span></span> <span data-ttu-id="d9de0-121">Diese anderen **Member der wsaprotocol- \_ Informationen** für **Sock \_ RAW** geben normalerweise an, dass das Protokoll verbindungslose und Nachrichten orientiert ist, unterstützt Broadcast/Multicast (die XP1 \_ Connectionless, XP1 \_ Message \_ Oriented, XP1 \_ Support \_ Broadcast und XP1 \_ Support \_ Multipoint Bits werden im dwServiceFlags1-Member festgelegt) und kann eine maximale Nachrichtengröße von 65.467 Bytes aufweisen.</span><span class="sxs-lookup"><span data-stu-id="d9de0-121">These other members of the **WSAPROTOCOL\_INFO** for **SOCK\_RAW** normally specify that the protocol is connectionless, message-oriented, supports broadcast/multicast (the XP1\_CONNECTIONLESS, XP1\_MESSAGE\_ORIENTED, XP1\_SUPPORT\_BROADCAST, and XP1\_SUPPORT\_MULTIPOINT bits are set in the dwServiceFlags1 member), and can have a maximum message size of 65,467 bytes.</span></span>

<span data-ttu-id="d9de0-122">Unter Windows XP und höher kann der *NetSh.exe* -Befehl verwendet werden, um zu bestimmen, ob RAW-Sockets unterstützt werden.</span><span class="sxs-lookup"><span data-stu-id="d9de0-122">On Windows XP and later, the *NetSh.exe* command can be used to determine if raw sockets are supported.</span></span> <span data-ttu-id="d9de0-123">Der folgende Befehl, der in einem cmd-Fenster ausgeführt wird, zeigt Daten aus dem Winsock-Katalog auf der Konsole an:</span><span class="sxs-lookup"><span data-stu-id="d9de0-123">The following command run from a CMD window will display data from the Winsock catalog on the console:</span></span>

<span data-ttu-id="d9de0-124">**netsh Winsock Show Catalog**</span><span class="sxs-lookup"><span data-stu-id="d9de0-124">**netsh winsock show catalog**</span></span>

<span data-ttu-id="d9de0-125">Die Ausgabe enthält eine Liste mit einigen der Daten aus den [**wsaprotocol- \_ Informations**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) Strukturen, die auf dem lokalen Computer unterstützt werden.</span><span class="sxs-lookup"><span data-stu-id="d9de0-125">The output will include a list that contains some of the data from the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structures supported on the local computer.</span></span> <span data-ttu-id="d9de0-126">Suchen Sie im Feld Beschreibung nach dem Begriff Raw/IP oder RAW/IPv6, um die Protokolle zu suchen, die unformatierte Sockets unterstützen.</span><span class="sxs-lookup"><span data-stu-id="d9de0-126">Search for the term RAW/IP or RAW/IPv6 in the Description field to find those protocols that support raw sockets.</span></span>

## <a name="creating-a-raw-socket"></a><span data-ttu-id="d9de0-127">Erstellen eines RAW-Sockets</span><span class="sxs-lookup"><span data-stu-id="d9de0-127">Creating a Raw Socket</span></span>

<span data-ttu-id="d9de0-128">Um einen Socket des Typs **Sock \_ RAW** zu erstellen, rufen Sie die [**Socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) -oder [**wsasocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) -Funktion mit dem *AF* -Parameter (Adressfamilie) auf, der auf AF \_ inet oder AF inet6 festgelegt ist, und legen Sie den Parameter "Type" auf " \_ **Sock \_ RAW**" und  den *Protokoll* Parameter auf die erforderliche Protokollnummer fest</span><span class="sxs-lookup"><span data-stu-id="d9de0-128">To create a socket of type **SOCK\_RAW**, call the [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) or [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) function with the *af* parameter (address family) set to AF\_INET or AF\_INET6, the *type* parameter set to **SOCK\_RAW**, and the *protocol* parameter set to the protocol number required.</span></span> <span data-ttu-id="d9de0-129">Der *Protokoll* Parameter wird zum Protokoll Wert im IP-Header (z. b. SCTP ist 132).</span><span class="sxs-lookup"><span data-stu-id="d9de0-129">The *protocol* parameter becomes the protocol value in the IP header (SCTP is 132, for example).</span></span>

> [!Note]  
> <span data-ttu-id="d9de0-130">Eine Anwendung darf nicht NULL (0) als *Protokoll* Parameter für die Funktionen [**Socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket), [**wsasocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa)und [**wspsocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) angeben, wenn der *Typparameter* auf **Sock \_ RAW** festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="d9de0-130">An application may not specify zero (0) as the *protocol* parameter for the [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket), [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa), and [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) functions if the *type* parameter is set to **SOCK\_RAW**.</span></span>

 

<span data-ttu-id="d9de0-131">Rohsockets bieten die Möglichkeit, den zugrunde liegenden Transport zu manipulieren, sodass Sie für schädliche Zwecke verwendet werden können, die eine Sicherheitsbedrohung darstellen.</span><span class="sxs-lookup"><span data-stu-id="d9de0-131">Raw sockets offer the capability to manipulate the underlying transport, so they can be used for malicious purposes that pose a security threat.</span></span> <span data-ttu-id="d9de0-132">Daher können nur Mitglieder der Gruppe "Administratoren" Sockets vom Typ "Sock \_ RAW" unter Windows 2000 und höher erstellen.</span><span class="sxs-lookup"><span data-stu-id="d9de0-132">Therefore, only members of the Administrators group can create sockets of type SOCK\_RAW on Windows 2000 and later.</span></span>

## <a name="send-and-receive-operations"></a><span data-ttu-id="d9de0-133">Sende-und Empfangs Vorgänge</span><span class="sxs-lookup"><span data-stu-id="d9de0-133">Send and Receive Operations</span></span>

<span data-ttu-id="d9de0-134">Sobald eine Anwendung einen Socket vom Typ **Sock \_ RAW** erstellt, kann dieser Socket zum Senden und empfangen von Daten verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="d9de0-134">Once an application creates a socket of type **SOCK\_RAW**, this socket may be used to send and receive data.</span></span> <span data-ttu-id="d9de0-135">Alle an einen Socket vom Typ " **Sock \_ RAW** " gesendeten oder empfangenen Pakete werden als Datagramme auf einem nicht verbundenen Socket behandelt.</span><span class="sxs-lookup"><span data-stu-id="d9de0-135">All packets sent or received on a socket of type **SOCK\_RAW** are treated as datagrams on an unconnected socket.</span></span>

<span data-ttu-id="d9de0-136">Die folgenden Regeln gelten für die Vorgänge über **\_ socketrohsockets** :</span><span class="sxs-lookup"><span data-stu-id="d9de0-136">The following rules apply to the operations over **SOCK\_RAW** sockets:</span></span>

-   <span data-ttu-id="d9de0-137">Die [**SendTo**](/windows/desktop/api/winsock/nf-winsock-sendto) -oder [**WSASendTo**](/windows/desktop/api/Winsock2/nf-winsock2-wsasendto) -Funktion wird normalerweise zum Senden von Daten an einen Socket vom Typ " **Sock \_ RAW**" verwendet.</span><span class="sxs-lookup"><span data-stu-id="d9de0-137">The [**sendto**](/windows/desktop/api/winsock/nf-winsock-sendto) or [**WSASendTo**](/windows/desktop/api/Winsock2/nf-winsock2-wsasendto) function is normally used to send data on a socket of type **SOCK\_RAW**.</span></span> <span data-ttu-id="d9de0-138">Die Zieladresse kann eine beliebige gültige Adresse in der Adressfamilie des Sockets sein, einschließlich einer Broadcast-oder Multicast Adresse.</span><span class="sxs-lookup"><span data-stu-id="d9de0-138">The destination address can be any valid address in the socket's address family, including a broadcast or multicast address.</span></span> <span data-ttu-id="d9de0-139">Damit eine Anwendung an eine Broadcast Adresse gesendet werden kann, muss [**setsockopt**](/windows/desktop/api/winsock/nf-winsock-setsockopt) mit \_ aktiviertem Broadcast verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="d9de0-139">To send to a broadcast address, an application must have used [**setsockopt**](/windows/desktop/api/winsock/nf-winsock-setsockopt) with SO\_BROADCAST enabled.</span></span> <span data-ttu-id="d9de0-140">Andernfalls schlägt ' **SendTo** ' oder ' **WSASendTo** ' mit dem Fehlercode ' [WSAEACCES](windows-sockets-error-codes-2.md)' fehl.</span><span class="sxs-lookup"><span data-stu-id="d9de0-140">Otherwise, **sendto** or **WSASendTo** will fail with the error code [WSAEACCES](windows-sockets-error-codes-2.md).</span></span> <span data-ttu-id="d9de0-141">Bei IP kann eine Anwendung an eine beliebige Multicast Adresse (ohne Gruppenmitglied) senden.</span><span class="sxs-lookup"><span data-stu-id="d9de0-141">For IP, an application can send to any multicast address (without becoming a group member).</span></span>
-   <span data-ttu-id="d9de0-142">Beim Senden von IPv4-Daten kann eine Anwendung entscheiden, ob der IPv4-Header an der Vorderseite des ausgehenden Datagramms für das Paket angegeben werden soll.</span><span class="sxs-lookup"><span data-stu-id="d9de0-142">When sending IPv4 data, an application has a choice on whether to specify the IPv4 header at the front of the outgoing datagram for the packet.</span></span> <span data-ttu-id="d9de0-143">Wenn die Option **IP \_ hdrincl** Socket für einen IPv4-Socket (Adressfamilie von AF inet) auf true festgelegt ist \_ , muss die Anwendung den IPv4-Header in den ausgehenden Daten für Sende Vorgänge bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="d9de0-143">If the **IP\_HDRINCL** socket option is set to true for an IPv4 socket (address family of AF\_INET), the application must supply the IPv4 header in the outgoing data for send operations.</span></span> <span data-ttu-id="d9de0-144">Wenn diese Socketoption auf false festgelegt ist (Standardeinstellung), sollte der IPv4-Header nicht in den ausgehenden Daten für Sende Vorgänge enthalten sein.</span><span class="sxs-lookup"><span data-stu-id="d9de0-144">If this socket option is false (the default setting), then the IPv4 header should not be in included the outgoing data for send operations.</span></span>
-   <span data-ttu-id="d9de0-145">Beim Senden von IPv6-Daten kann eine Anwendung auswählen, ob der IPv6-Header an der Vorderseite des ausgehenden Datagramms für das Paket angegeben werden soll.</span><span class="sxs-lookup"><span data-stu-id="d9de0-145">When sending IPv6 data, an application has a choice on whether to specify the IPv6 header at the front of the outgoing datagram for the packet.</span></span> <span data-ttu-id="d9de0-146">Wenn die **IPv6- \_ hdrincl** -Socketoption für einen IPv6-Socket (Adressfamilie von AF inet6) auf true festgelegt ist \_ , muss die Anwendung den IPv6-Header in den ausgehenden Daten für Sende Vorgänge bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="d9de0-146">If the **IPV6\_HDRINCL** socket option is set to true for an IPv6 socket (address family of AF\_INET6), the application must supply the IPv6 header in the outgoing data for send operations.</span></span> <span data-ttu-id="d9de0-147">Die Standardeinstellung für diese Option ist false.</span><span class="sxs-lookup"><span data-stu-id="d9de0-147">The default setting for this option is false.</span></span> <span data-ttu-id="d9de0-148">Wenn diese Socketoption auf false festgelegt ist (Standardeinstellung), sollte der IPv6-Header nicht in den ausgehenden Daten für Sende Vorgänge enthalten sein.</span><span class="sxs-lookup"><span data-stu-id="d9de0-148">If this socket option is false (the default setting), then the IPv6 header should not be included in the outgoing data for send operations.</span></span> <span data-ttu-id="d9de0-149">Für IPv6 sollte es nicht erforderlich sein, den IPv6-Header einzuschließen.</span><span class="sxs-lookup"><span data-stu-id="d9de0-149">For IPv6, there should be no need to include the IPv6 header.</span></span> <span data-ttu-id="d9de0-150">Wenn Informationen mithilfe von Socketfunktionen verfügbar sind, sollte der IPv6-Header nicht eingeschlossen werden, um in Zukunft Kompatibilitätsprobleme zu vermeiden.</span><span class="sxs-lookup"><span data-stu-id="d9de0-150">If information is available using socket functions, then the IPv6 header should not be included to avoid compatibility problems in the future.</span></span> <span data-ttu-id="d9de0-151">Diese Probleme werden in RFC 3542 erläutert, die vom IETF veröffentlicht werden.</span><span class="sxs-lookup"><span data-stu-id="d9de0-151">These issues are discussed in RFC 3542 published by the IETF.</span></span> <span data-ttu-id="d9de0-152">Die Verwendung der **IPv6- \_ hdrincl** -Socketoption wird nicht empfohlen und ist in Zukunft möglicherweise veraltet.</span><span class="sxs-lookup"><span data-stu-id="d9de0-152">Using the **IPV6\_HDRINCL** socket option is not recommended and may be deprecated in future.</span></span>
-   <span data-ttu-id="d9de0-153">Die Funktion " [**recvfrom**](/windows/desktop/api/winsock/nf-winsock-recvfrom) " oder " [**WSARecvFrom**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvfrom) " wird normalerweise verwendet, um Daten für einen Socket vom Typ " **Sock \_ RAW**" zu empfangen.</span><span class="sxs-lookup"><span data-stu-id="d9de0-153">The [**recvfrom**](/windows/desktop/api/winsock/nf-winsock-recvfrom) or [**WSARecvFrom**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvfrom) function is normally used to receive data on a socket of type **SOCK\_RAW**.</span></span> <span data-ttu-id="d9de0-154">Beide Funktionen verfügen über eine Option zum Zurückgeben der Quell-IP-Adresse, von der das Paket gesendet wurde.</span><span class="sxs-lookup"><span data-stu-id="d9de0-154">Both of these functions have an option to return the source IP address where the packet was sent from.</span></span> <span data-ttu-id="d9de0-155">Die empfangenen Daten sind ein Datagramm von einem nicht verbundenen Socket.</span><span class="sxs-lookup"><span data-stu-id="d9de0-155">The received data is a datagram from an unconnected socket.</span></span>
-   <span data-ttu-id="d9de0-156">Für IPv4 (Adressfamilie von AF \_ inet) empfängt eine Anwendung unabhängig von der **IP \_ hdrincl-** Socketoption den IP-Header an der Vorderseite jedes empfangenen Datagramms.</span><span class="sxs-lookup"><span data-stu-id="d9de0-156">For IPv4 (address family of AF\_INET), an application receives the IP header at the front of each received datagram regardless of the **IP\_HDRINCL** socket option.</span></span>
-   <span data-ttu-id="d9de0-157">Für IPv6 (Adressfamilie von AF \_ inet6) empfängt eine Anwendung alle Elemente, die sich nach dem letzten IPv6-Header in jedem empfangenen Datagramm befinden, unabhängig von der **IPv6- \_ hdrincl** -Socketoption.</span><span class="sxs-lookup"><span data-stu-id="d9de0-157">For IPv6 (address family of AF\_INET6), an application receives everything after the last IPv6 header in each received datagram regardless of the **IPV6\_HDRINCL** socket option.</span></span> <span data-ttu-id="d9de0-158">Die Anwendung empfängt keine IPv6-Header mithilfe eines RAW-Sockets.</span><span class="sxs-lookup"><span data-stu-id="d9de0-158">The application does not receive any IPv6 headers using a raw socket.</span></span>
-   <span data-ttu-id="d9de0-159">Empfangene Datagramme werden in alle **\_ socketrohsockets** kopiert, die die folgenden Bedingungen erfüllen:</span><span class="sxs-lookup"><span data-stu-id="d9de0-159">Received datagrams are copied into all **SOCK\_RAW** sockets that satisfy the following conditions:</span></span>

    -   <span data-ttu-id="d9de0-160">Die im *Protokoll* Parameter angegebene Protokollnummer, als der Socket erstellt wurde, sollte der Protokollnummer im IP-Header des empfangenen Datagramms entsprechen.</span><span class="sxs-lookup"><span data-stu-id="d9de0-160">The protocol number specified in the *protocol* parameter when the socket was created should match the protocol number in the IP header of the received datagram.</span></span>
    -   <span data-ttu-id="d9de0-161">Wenn eine lokale IP-Adresse für den Socket definiert ist, sollte Sie der Zieladresse entsprechen, wie im IP-Header des empfangenen Datagramms angegeben.</span><span class="sxs-lookup"><span data-stu-id="d9de0-161">If a local IP address is defined for the socket, it should correspond to the destination address as specified in the IP header of the received datagram.</span></span> <span data-ttu-id="d9de0-162">Eine Anwendung kann die lokale IP-Adresse durch Aufrufen der [**Bind**](/windows/desktop/api/winsock/nf-winsock-bind) -Funktion angeben.</span><span class="sxs-lookup"><span data-stu-id="d9de0-162">An application may specify the local IP address by calling the [**bind**](/windows/desktop/api/winsock/nf-winsock-bind) function.</span></span> <span data-ttu-id="d9de0-163">Wenn für den Socket keine lokale IP-Adresse angegeben ist, werden die Datagramme unabhängig von der Ziel-IP-Adresse im IP-Header des empfangenen Datagramms in das Socket kopiert.</span><span class="sxs-lookup"><span data-stu-id="d9de0-163">If no local IP address is specified for the socket, the datagrams are copied into the socket regardless of the destination IP address in the IP header of the received datagram.</span></span>
    -   <span data-ttu-id="d9de0-164">Wenn eine fremd Adresse für den Socket definiert ist, sollte Sie der Quelladresse entsprechen, wie im IP-Header des empfangenen Datagramms angegeben.</span><span class="sxs-lookup"><span data-stu-id="d9de0-164">If a foreign address is defined for the socket, it should correspond to the source address as specified in the IP header of the received datagram.</span></span> <span data-ttu-id="d9de0-165">Eine Anwendung kann die fremde IP-Adresse durch Aufrufen der [**Connect**](/windows/desktop/api/Winsock2/nf-winsock2-connect) -oder [**wsaconnetct**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) -Funktion angeben.</span><span class="sxs-lookup"><span data-stu-id="d9de0-165">An application may specify the foreign IP address by calling the [**connect**](/windows/desktop/api/Winsock2/nf-winsock2-connect) or [**WSAConnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) function.</span></span> <span data-ttu-id="d9de0-166">Wenn für den Socket keine fremde IP-Adresse angegeben wird, werden die Datagramme unabhängig von der Quell-IP-Adresse im IP-Header des empfangenen Datagramms in das Socket kopiert.</span><span class="sxs-lookup"><span data-stu-id="d9de0-166">If no foreign IP address is specified for the socket, the datagrams are copied into the socket regardless of the source IP address in the IP header of the received datagram.</span></span>

<span data-ttu-id="d9de0-167">Es ist wichtig zu verstehen, dass einige Sockets des Typs **Sock \_ RAW** viele unerwartete Datagramme erhalten.</span><span class="sxs-lookup"><span data-stu-id="d9de0-167">It is important to understand that some sockets of type **SOCK\_RAW** may receive many unexpected datagrams.</span></span> <span data-ttu-id="d9de0-168">Beispielsweise kann ein Ping-Programm einen Socket vom Typ " **Sock \_ RAW** " erstellen, um ICMP-Echo Anforderungen zu senden und Antworten zu empfangen.</span><span class="sxs-lookup"><span data-stu-id="d9de0-168">For example, a PING program may create a socket of type **SOCK\_RAW** to send ICMP echo requests and receive responses.</span></span> <span data-ttu-id="d9de0-169">Obwohl die Anwendung ICMP-Echo Antworten erwartet, können alle anderen ICMP-Nachrichten (z. b. der ICMP-Host \_ nicht erreichbar) auch an diese Anwendung übermittelt werden.</span><span class="sxs-lookup"><span data-stu-id="d9de0-169">While the application is expecting ICMP echo responses, all other ICMP messages (such as ICMP HOST\_UNREACHABLE) may also be delivered to this application.</span></span> <span data-ttu-id="d9de0-170">Wenn darüber hinaus mehrere **\_ socketrohsockets** gleichzeitig auf einem Computer geöffnet sind, werden möglicherweise dieselben Datagramme an alle geöffneten Sockets übermittelt.</span><span class="sxs-lookup"><span data-stu-id="d9de0-170">Moreover, if several **SOCK\_RAW** sockets are open on a computer at the same time, the same datagrams may be delivered to all the open sockets.</span></span> <span data-ttu-id="d9de0-171">Eine Anwendung muss über einen Mechanismus verfügen, um die von Interesse betroffenen Datagramme zu erkennen und alle anderen zu ignorieren.</span><span class="sxs-lookup"><span data-stu-id="d9de0-171">An application must have a mechanism to recognize the datagrams of interest and to ignore all others.</span></span> <span data-ttu-id="d9de0-172">Bei einem Ping-Programm kann ein solcher Mechanismus die Überprüfung des empfangenen IP-Headers auf eindeutige Bezeichner im ICMP-Header (z. b. die Prozess-ID der Anwendung) beinhalten.</span><span class="sxs-lookup"><span data-stu-id="d9de0-172">For a PING program, such a mechanism might include inspecting the received IP header for unique identifiers in the ICMP header (the application's process ID, for example).</span></span>

> [!Note]  
> <span data-ttu-id="d9de0-173">Um einen Socket des Typs " **Sock \_ RAW** " verwenden zu können, sind Administratorrechte erforderlich.</span><span class="sxs-lookup"><span data-stu-id="d9de0-173">To use a socket of type **SOCK\_RAW** requires administrative privileges.</span></span> <span data-ttu-id="d9de0-174">Benutzer, die Winsock-Anwendungen ausführen, die unformatierte Sockets verwenden, müssen ein Mitglied der Gruppe "Administratoren" auf dem lokalen Computer sein. andernfalls schlagen unformatierte Socket-Aufrufe mit dem Fehlercode " [WSAEACCES](windows-sockets-error-codes-2.md)" fehl.</span><span class="sxs-lookup"><span data-stu-id="d9de0-174">Users running Winsock applications that use raw sockets must be a member of the Administrators group on the local computer, otherwise raw socket calls will fail with an error code of [WSAEACCES](windows-sockets-error-codes-2.md).</span></span> <span data-ttu-id="d9de0-175">Unter Windows Vista und höher wird der Zugriff für RAW-Sockets bei der Socket-Erstellung erzwungen.</span><span class="sxs-lookup"><span data-stu-id="d9de0-175">On Windows Vista and later, access for raw sockets is enforced at socket creation.</span></span> <span data-ttu-id="d9de0-176">In früheren Versionen von Windows wird der Zugriff auf unformatierte Sockets bei anderen Socketvorgängen erzwungen.</span><span class="sxs-lookup"><span data-stu-id="d9de0-176">In earlier versions of Windows, access for raw sockets is enforced during other socket operations.</span></span>

 

## <a name="common-uses-of-raw-sockets"></a><span data-ttu-id="d9de0-177">Häufige Verwendungsmöglichkeiten von rohsockets</span><span class="sxs-lookup"><span data-stu-id="d9de0-177">Common Uses of Raw Sockets</span></span>

<span data-ttu-id="d9de0-178">Eine häufige Verwendung von rohsockets ist die Problembehandlung bei Anwendungen, bei denen IP-Pakete und Header ausführlich untersucht werden müssen.</span><span class="sxs-lookup"><span data-stu-id="d9de0-178">One common use of raw sockets are troubleshooting applications that need to examine IP packets and headers in detail.</span></span> <span data-ttu-id="d9de0-179">Beispielsweise kann ein RAW-Socket mit der "sio \_ rcvall"-IOCTL verwendet werden, damit ein Socket alle IPv4-oder IPv6-Pakete empfangen kann, die über eine Netzwerkschnittstelle übergeben werden.</span><span class="sxs-lookup"><span data-stu-id="d9de0-179">For example, a raw socket can be used with the SIO\_RCVALL IOCTL to enable a socket to receive all IPv4 or IPv6 packets passing through a network interface.</span></span> <span data-ttu-id="d9de0-180">Weitere Informationen finden Sie in der Referenz zu " [**SIO \_ rcvall**](/previous-versions/windows/desktop/legacy/ee309610(v=vs.85)) ".</span><span class="sxs-lookup"><span data-stu-id="d9de0-180">For more information, see the [**SIO\_RCVALL**](/previous-versions/windows/desktop/legacy/ee309610(v=vs.85)) reference.</span></span>

## <a name="limitations-on-raw-sockets"></a><span data-ttu-id="d9de0-181">Einschränkungen bei rohsockets</span><span class="sxs-lookup"><span data-stu-id="d9de0-181">Limitations on Raw Sockets</span></span>

<span data-ttu-id="d9de0-182">Unter Windows 7, Windows Vista, Windows XP mit Service Pack 2 (SP2) und Windows XP mit Service Pack 3 (SP3) wurde die Möglichkeit zum Senden von Datenverkehr über Raw Sockets auf verschiedene Weise eingeschränkt:</span><span class="sxs-lookup"><span data-stu-id="d9de0-182">On Windows 7, Windows Vista, Windows XP with Service Pack 2 (SP2), and Windows XP with Service Pack 3 (SP3), the ability to send traffic over raw sockets has been restricted in several ways:</span></span>

-   <span data-ttu-id="d9de0-183">TCP-Daten können nicht über Unformatierte Sockets gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="d9de0-183">TCP data cannot be sent over raw sockets.</span></span>
-   <span data-ttu-id="d9de0-184">UDP-Datagramme mit einer ungültigen Quelladresse können nicht über Unformatierte Sockets gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="d9de0-184">UDP datagrams with an invalid source address cannot be sent over raw sockets.</span></span> <span data-ttu-id="d9de0-185">Die IP-Quelladresse für alle ausgehenden UDP-Datagramm muss in einer Netzwerkschnittstelle vorhanden sein, oder das Datagramm wird gelöscht.</span><span class="sxs-lookup"><span data-stu-id="d9de0-185">The IP source address for any outgoing UDP datagram must exist on a network interface or the datagram is dropped.</span></span> <span data-ttu-id="d9de0-186">Diese Änderung wurde vorgenommen, um die Fähigkeit von schädlichem Code zum Erstellen verteilter Denial-of-Service-Angriffe einzuschränken und die Möglichkeit einzuschränken, gefälschte Pakete (TCP/IP-Pakete mit einer gefälschten Quell-IP-Adresse) zu senden.</span><span class="sxs-lookup"><span data-stu-id="d9de0-186">This change was made to limit the ability of malicious code to create distributed denial-of-service attacks and limits the ability to send spoofed packets (TCP/IP packets with a forged source IP address).</span></span>
-   <span data-ttu-id="d9de0-187">Ein Aufrufe der [**Bind**](/windows/desktop/api/winsock/nf-winsock-bind) -Funktion mit einem unformatierten Socket für das ipproto \_ TCP-Protokoll ist nicht zulässig.</span><span class="sxs-lookup"><span data-stu-id="d9de0-187">A call to the [**bind**](/windows/desktop/api/winsock/nf-winsock-bind) function with a raw socket for the IPPROTO\_TCP protocol is not allowed.</span></span>
    > [!Note]  
    > <span data-ttu-id="d9de0-188">Die [**Bind**](/windows/desktop/api/winsock/nf-winsock-bind) -Funktion mit einem RAW-Socket ist beispielsweise für andere Protokolle zulässig ( \_ z. b. ipproto IP, ipproto \_ UDP oder ipproto \_ SCTP).</span><span class="sxs-lookup"><span data-stu-id="d9de0-188">The [**bind**](/windows/desktop/api/winsock/nf-winsock-bind) function with a raw socket is allowed for other protocols (IPPROTO\_IP, IPPROTO\_UDP, or IPPROTO\_SCTP, for example).</span></span>

     

<span data-ttu-id="d9de0-189">Diese Einschränkungen gelten nicht für Windows Server 2008 R2, Windows Server 2008, Windows Server 2003 oder Versionen des Betriebssystems vor Windows XP mit SP2.</span><span class="sxs-lookup"><span data-stu-id="d9de0-189">These above restrictions do not apply to Windows Server 2008 R2, Windows Server 2008 , Windows Server 2003, or to versions of the operating system earlier than Windows XP with SP2.</span></span>

> [!Note]  
> <span data-ttu-id="d9de0-190">Die Microsoft-Implementierung von TCP/IP unter Windows ist in der Lage, einen unformatierten UDP-oder TCP-Socket basierend auf den oben genannten Einschränkungen zu öffnen.</span><span class="sxs-lookup"><span data-stu-id="d9de0-190">The Microsoft implementation of TCP/IP on Windows is capable of opening a raw UDP or TCP socket based on the above restrictions.</span></span> <span data-ttu-id="d9de0-191">Andere Winsock-Anbieter unterstützen möglicherweise nicht die Verwendung von rohsockets.</span><span class="sxs-lookup"><span data-stu-id="d9de0-191">Other Winsock providers may not support the use of raw sockets.</span></span>

 

<span data-ttu-id="d9de0-192">Für Anwendungen, die einen Socket vom Typ " **Sock \_ RAW**" verwenden, gibt es weitere Einschränkungen.</span><span class="sxs-lookup"><span data-stu-id="d9de0-192">There are further limitations for applications that use a socket of type **SOCK\_RAW**.</span></span> <span data-ttu-id="d9de0-193">Beispielsweise erhalten alle Anwendungen, die ein bestimmtes Protokoll überwachen, alle Pakete, die für dieses Protokoll empfangen werden.</span><span class="sxs-lookup"><span data-stu-id="d9de0-193">For example, all applications listening for a specific protocol will receive all packets received for this protocol.</span></span> <span data-ttu-id="d9de0-194">Dies ist möglicherweise nicht das, was für mehrere Anwendungen mit einem Protokoll gewünscht ist.</span><span class="sxs-lookup"><span data-stu-id="d9de0-194">This may not be what is desired for multiple applications using a protocol.</span></span> <span data-ttu-id="d9de0-195">Dies ist auch für Hochleistungsanwendungen nicht geeignet.</span><span class="sxs-lookup"><span data-stu-id="d9de0-195">This is also not suitable for high-performance applications.</span></span> <span data-ttu-id="d9de0-196">Um diese Probleme zu umgehen, kann es erforderlich sein, einen Windows-Netzwerkprotokoll Treiber (Gerätetreiber) für das jeweilige Netzwerkprotokoll zu schreiben.</span><span class="sxs-lookup"><span data-stu-id="d9de0-196">To get around these issues, it may be required to write a Windows network protocol driver (device driver) for the specific network protocol.</span></span> <span data-ttu-id="d9de0-197">Unter Windows Vista und höher, Winsock Kernel (WSK), kann eine neue Transport unabhängige kernelmodusschnittstelle zum Schreiben eines Netzwerkprotokoll Treibers verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="d9de0-197">On Windows Vista and later, Winsock Kernel (WSK), a new transport-independent kernel mode Network Programming Interface can be used to write a network protocol driver.</span></span> <span data-ttu-id="d9de0-198">Unter Windows Server 2003 und früheren Versionen können ein Transport Driver Interface (TDI)-Anbieter und eine Winsock Helper-DLL geschrieben werden, um das Netzwerkprotokoll zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="d9de0-198">On Windows Server 2003 and earlier, a Transport Driver Interface (TDI) provider and a Winsock helper DLL can be written to support the network protocol.</span></span> <span data-ttu-id="d9de0-199">Das Netzwerkprotokoll wird dann dem Winsock-Katalog als unterstütztes Protokoll hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="d9de0-199">The network protocol would then be added to the Winsock catalog as a supported protocol.</span></span> <span data-ttu-id="d9de0-200">Dadurch können mehrere Anwendungen Sockets für dieses bestimmte Protokoll öffnen, und der Gerätetreiber kann verfolgen, welcher Socket bestimmte Pakete und Fehler empfängt.</span><span class="sxs-lookup"><span data-stu-id="d9de0-200">This allows multiple applications to open sockets for this specific protocol and the device driver can keep track of which socket receives specific packets and errors.</span></span> <span data-ttu-id="d9de0-201">Weitere Informationen zum Schreiben eines Netzwerkprotokoll Anbieters finden Sie in den Abschnitten zu WSK und TDI im Windows-Treiberkit (WDK).</span><span class="sxs-lookup"><span data-stu-id="d9de0-201">For information on writing a network protocol provider, see the sections on WSK and TDI in the Windows Driver Kit (WDK).</span></span>

<span data-ttu-id="d9de0-202">Anwendungen müssen auch wissen, welche Auswirkungen Firewalleinstellungen auf das Senden und empfangen von Paketen mithilfe von rohsockets haben können.</span><span class="sxs-lookup"><span data-stu-id="d9de0-202">Applications also need to be aware of the impact that firewall settings may have on sending and receiving packets using raw sockets.</span></span>

 

 
