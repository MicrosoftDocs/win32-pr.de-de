---
description: Das folgende Material wird als Erläuterung für das Herunterfahren von Socketverbindungen zur Schließung der Sockets bereitgestellt. Es ist wichtig, den Unterschied zwischen dem Herunterfahren einer Socketverbindung und dem Schließen eines Sockets zu unterscheiden.
ms.assetid: 383747c3-dd3d-4a18-b4e8-2815d5e5c0c7
title: Ordnungsgemäßes Herunterfahren, Linger Optionen und Socket-Schließung
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 59f6791eaa803da561fc9f3c175b5270950cbec3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "104214596"
---
# <a name="graceful-shutdown-linger-options-and-socket-closure"></a><span data-ttu-id="d5785-104">Ordnungsgemäßes Herunterfahren, Linger Optionen und Socket-Schließung</span><span class="sxs-lookup"><span data-stu-id="d5785-104">Graceful Shutdown, Linger Options, and Socket Closure</span></span>

<span data-ttu-id="d5785-105">Das folgende Material wird als Erläuterung für das Herunterfahren von Socketverbindungen zur Schließung der Sockets bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="d5785-105">The following material is provided as clarification for the subject of shutting down socket connections closing the sockets.</span></span> <span data-ttu-id="d5785-106">Es ist wichtig, den Unterschied zwischen dem Herunterfahren einer Socketverbindung und dem Schließen eines Sockets zu unterscheiden.</span><span class="sxs-lookup"><span data-stu-id="d5785-106">It is important to distinguish the difference between shutting down a socket connection and closing a socket.</span></span>

<span data-ttu-id="d5785-107">Das Herunterfahren einer Socketverbindung umfasst einen Austausch der Protokollmeldungen zwischen den beiden Endpunkten, die im folgenden als eine Shutdown-Sequenz bezeichnet werden.</span><span class="sxs-lookup"><span data-stu-id="d5785-107">Shutting down a socket connection involves an exchange of protocol messages between the two endpoints, hereafter referred to as a shutdown sequence.</span></span> <span data-ttu-id="d5785-108">Zwei allgemeine Klassen von Shutdown-Sequenzen werden definiert: ordnungsgemäß und abgebrochen (auch als hart bezeichnet).</span><span class="sxs-lookup"><span data-stu-id="d5785-108">Two general classes of shutdown sequences are defined: graceful and abortive (also called hard).</span></span> <span data-ttu-id="d5785-109">In einer ordnungsgemäßen Shutdown-Sequenz können alle Daten, die in die Warteschlange eingereiht, aber noch nicht übertragen wurden, vor dem Schließen der Verbindung gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="d5785-109">In a graceful shutdown sequence, any data that has been queued, but not yet transmitted can be sent prior to the connection being closed.</span></span> <span data-ttu-id="d5785-110">Bei einem Abbruch werden alle nicht gesendeten Daten verloren gehen.</span><span class="sxs-lookup"><span data-stu-id="d5785-110">In an abortive shutdown, any unsent data is lost.</span></span> <span data-ttu-id="d5785-111">Das Vorkommen einer Sequenz zum Herunterfahren (ordnungsgemäß oder abgebrochen) kann auch verwendet werden, um \_ die zugeordneten Anwendungen mit dem Hinweis zu versehen, dass ein Herunterfahren ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="d5785-111">The occurrence of a shutdown sequence (graceful or abortive) can also be used to provide an FD\_CLOSE indication to the associated applications signifying that a shutdown is in progress.</span></span>

<span data-ttu-id="d5785-112">Das Schließen eines Sockets hingegen bewirkt, dass das Sockethandle freigegeben wird, sodass die Anwendung nicht mehr auf den Socket verweisen oder Sie verwenden kann.</span><span class="sxs-lookup"><span data-stu-id="d5785-112">Closing a socket, on the other hand, causes the socket handle to become deallocated so that the application can no longer reference or use the socket in any manner.</span></span>

<span data-ttu-id="d5785-113">In Windows Sockets können sowohl die [**Shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown) -Funktion als auch die [**wsasenddisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) -Funktion verwendet werden, um eine Sequenz für das Herunterfahren zu initiieren, während die [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) -Funktion verwendet wird, um die Zuordnung von Sockethandles freizugeben und alle zugeordneten Ressourcen freizugeben.</span><span class="sxs-lookup"><span data-stu-id="d5785-113">In Windows Sockets, both the [**shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown) function, and the [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) function can be used to initiate a shutdown sequence, while the [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) function is used to deallocate socket handles and free up any associated resources.</span></span> <span data-ttu-id="d5785-114">Eine gewisse Verwirrung ergibt sich jedoch aus der Tatsache, dass die **closesocket** -Funktion implizit bewirkt, dass eine Shutdown-Sequenz auftritt, wenn Sie nicht bereits geschehen ist.</span><span class="sxs-lookup"><span data-stu-id="d5785-114">Some amount of confusion arises, however, from the fact that the **closesocket** function implicitly causes a shutdown sequence to occur if it has not already happened.</span></span> <span data-ttu-id="d5785-115">Tatsächlich wurde sie zu einem eher gängigen Programmierverfahren, das sich auf dieses Feature verlassen und **closesocket** verwendet, um die Shutdown-Sequenz zu initiieren und das Sockethandle freizugeben.</span><span class="sxs-lookup"><span data-stu-id="d5785-115">In fact, it has become a rather common programming practice to rely on this feature and to use **closesocket** to both initiate the shutdown sequence and deallocate the socket handle.</span></span>

<span data-ttu-id="d5785-116">Um diese Verwendung zu vereinfachen, stellt die Sockets-Schnittstelle für Steuerelemente über den socketoptions-Mechanismus bereit, mit dem der Programmierer angeben kann, ob die implizite Beendigungs Sequenz ordnungsgemäß oder abgebrochen werden soll, und ob die [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) -Funktion gestellend sein soll (der nicht sofort beendet wird), um Zeit für eine ordnungsgemäße Herunterfahr Sequenz zu ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="d5785-116">To facilitate this usage, the sockets interface provides for controls by way of the socket option mechanism that allow the programmer to indicate whether the implicit shutdown sequence should be graceful or abortive, and also whether the [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) function should linger (that is not complete immediately) to allow time for a graceful shutdown sequence to complete.</span></span> <span data-ttu-id="d5785-117">Diese wichtigen Unterschiede und die Auswirkungen der Verwendung von **closesocket** auf diese Weise sind immer noch nicht bekannt.</span><span class="sxs-lookup"><span data-stu-id="d5785-117">These important distinctions and the ramifications of using **closesocket** in this manner are still not widely understood.</span></span>

<span data-ttu-id="d5785-118">Wenn Sie geeignete Werte für die Socketoptionen für " \_ LINGER" und " \_ DontLinger" festlegen, können die folgenden Verhaltenstypen mit der [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) -Funktion abgerufen werden:</span><span class="sxs-lookup"><span data-stu-id="d5785-118">By establishing appropriate values for the socket options SO\_LINGER and SO\_DONTLINGER, the following types of behavior can be obtained with the [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) function:</span></span>

-   <span data-ttu-id="d5785-119">Abbruch Sequenz, sofortige Rückgabe von [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span><span class="sxs-lookup"><span data-stu-id="d5785-119">Abortive shutdown sequence, immediate return from [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span></span>
-   <span data-ttu-id="d5785-120">Ordnungsgemäßes Herunterfahren, verzögern der Rückgabe, bis das Herunterfahren entweder abgeschlossen oder ein angegebenes Zeitintervall abläuft.</span><span class="sxs-lookup"><span data-stu-id="d5785-120">Graceful shutdown, delaying return until either shutdown sequence completes or a specified time interval elapses.</span></span> <span data-ttu-id="d5785-121">Wenn das Zeitintervall abläuft, bevor die ordnungsgemäße Herunterfahr Sequenz abgeschlossen ist, tritt eine Abbruch Sequenz auf, und [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) gibt zurück.</span><span class="sxs-lookup"><span data-stu-id="d5785-121">If the time interval expires before the graceful shutdown sequence completes, an abortive shutdown sequence occurs, and [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) returns.</span></span>
-   <span data-ttu-id="d5785-122">Ordnungsgemäßes Herunterfahren, sofortige Rückgabe – ermöglicht das Beenden der Sequenz im Hintergrund.</span><span class="sxs-lookup"><span data-stu-id="d5785-122">Graceful shutdown, immediate return—allowing the shutdown sequence to complete in the background.</span></span> <span data-ttu-id="d5785-123">Obwohl dies das Standardverhalten ist, kann die Anwendung nicht wissen, wann (oder ob) die ordnungsgemäße Herunterfahr Sequenz tatsächlich abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="d5785-123">Although this is the default behavior, the application has no way of knowing when (or whether) the graceful shutdown sequence actually completes.</span></span>

<span data-ttu-id="d5785-124">Die Verwendung der Optionen "so \_ LINGER" und "so \_ DontLinger Socket" und der zugeordneten [**Linger**](/windows/desktop/api/winsock/ns-winsock-linger) -Struktur wird in den Referenz Abschnitten zu den Optionen für den [**Sol- \_ socketsocket**](sol-socket-socket-options.md) und der **Linger** -Struktur ausführlicher erläutert.</span><span class="sxs-lookup"><span data-stu-id="d5785-124">The use of the SO\_LINGER and SO\_DONTLINGER socket options and the associated [**linger**](/windows/desktop/api/winsock/ns-winsock-linger) structure is discussed in more detail in the reference sections on [**SOL\_SOCKET Socket Options**](sol-socket-socket-options.md) and the **linger** structure.</span></span>

<span data-ttu-id="d5785-125">Eine Technik, die verwendet werden kann, um die Wahrscheinlichkeit zu minimieren, dass Probleme während der Verbindungs Löschung auftreten, besteht darin, zu verhindern, dass ein implizites Herunterfahren von [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket)initiiert wird.</span><span class="sxs-lookup"><span data-stu-id="d5785-125">One technique that can be used to minimize the chance of problems occurring during connection teardown is to avoid relying on an implicit shutdown being initiated by [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span></span> <span data-ttu-id="d5785-126">Verwenden Sie stattdessen eine der beiden expliziten Funktionen zum Herunterfahren, [**herunter**](/windows/desktop/api/winsock/nf-winsock-shutdown) fahren oder [**wsasenddisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect).</span><span class="sxs-lookup"><span data-stu-id="d5785-126">Instead, use one of the two explicit shutdown functions, [**shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown) or [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect).</span></span> <span data-ttu-id="d5785-127">Dies bewirkt wiederum \_ , dass die Peer Anwendung einen "FD Close"-Hinweis erhält, der anzeigt, dass alle ausstehenden Daten empfangen wurden.</span><span class="sxs-lookup"><span data-stu-id="d5785-127">This in turn causes an FD\_CLOSE indication to be received by the peer application indicating that all pending data has been received.</span></span> <span data-ttu-id="d5785-128">Um dies zu veranschaulichen, zeigt die folgende Tabelle die Funktionen, die von den Client-und Serverkomponenten einer Anwendung aufgerufen werden, wobei der Client dafür verantwortlich ist, ein ordnungsgemäßes Herunterfahren zu initiieren.</span><span class="sxs-lookup"><span data-stu-id="d5785-128">To illustrate this, the following table shows the functions that would be invoked by the client and server components of an application, where the client is responsible for initiating a graceful shutdown.</span></span>

| <span data-ttu-id="d5785-129">Clientseitig</span><span class="sxs-lookup"><span data-stu-id="d5785-129">Client side</span></span>                                                                                                                | <span data-ttu-id="d5785-130">Serverseitig</span><span class="sxs-lookup"><span data-stu-id="d5785-130">Server side</span></span>                                                                                           |
|----------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="d5785-131">(1) ruft [**Shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown)(s, SD \_ Send) auf, um das Ende der Sitzung zu signalisieren, und der Client hat keine weiteren Daten zum Senden.</span><span class="sxs-lookup"><span data-stu-id="d5785-131">(1) Invokes [**shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown)(s, SD\_SEND) to signal end of session and that client has no more data to send.</span></span> |                                                                                                       |
|                                                                                                                            | <span data-ttu-id="d5785-132">(2) empfängt FD, was bedeutet, dass ein ordnungsgemäßes Herunterfahren ausgeführt \_ wird und alle Daten empfangen wurden.</span><span class="sxs-lookup"><span data-stu-id="d5785-132">(2) Receives FD\_CLOSE, indicating graceful shutdown in progress and that all data has been received.</span></span> |
|                                                                                                                            | <span data-ttu-id="d5785-133">(3) sendet alle verbleibenden Antwortdaten.</span><span class="sxs-lookup"><span data-stu-id="d5785-133">(3) Sends any remaining response data.</span></span>                                                                |
| <span data-ttu-id="d5785-134">(nur lokale Zeit Steuerungs Bedeutung) \_Ruft den FD-Lesevorgang ab und ruft [**empfangener**](/windows/desktop/api/winsock/nf-winsock-recv) auf, um vom Server gesendete Antwortdaten zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="d5785-134">(local timing significance only) Gets FD\_READ and calls [**recv**](/windows/desktop/api/winsock/nf-winsock-recv) to get any response data sent by server .</span></span>  | <span data-ttu-id="d5785-135">(4) ruft [**Shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown)(s, SD \_ Send) auf, um anzugeben, dass der Server keine weiteren Daten zum Senden hat.</span><span class="sxs-lookup"><span data-stu-id="d5785-135">(4) Invokes [**shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown)(s, SD\_SEND) to indicate server has no more data to send.</span></span>  |
| <span data-ttu-id="d5785-136">(5) empfängt die \_ Bestätigung von FD.</span><span class="sxs-lookup"><span data-stu-id="d5785-136">(5) Receives FD\_CLOSE indication.</span></span>                                                                                         | <span data-ttu-id="d5785-137">(nur lokale Zeit Steuerungs Bedeutung) Ruft [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) auf.</span><span class="sxs-lookup"><span data-stu-id="d5785-137">(local timing significance only) Invokes [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) .</span></span>                       |
| <span data-ttu-id="d5785-138">(6) ruft [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket)auf.</span><span class="sxs-lookup"><span data-stu-id="d5785-138">(6) Invokes [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span></span>                                                                          |                                                                                                       |



 

 

 



