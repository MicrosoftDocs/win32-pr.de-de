---
description: Der Ws2 \_ -32.dll lädt die Schnittstellen-DLL des Dienstanbieters in das System, indem er die standardmäßigen Methoden zum Laden der dynamischen Microsoft Windows-Bibliothek verwendet, und initialisiert sie durch Aufrufen von WSPStartup.
ms.assetid: 6df28d93-8757-45b3-8f05-86381c3be64e
title: Initialisierung
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 84d6ef10db421ef15f2bb94eb67e96fc2cfc5924
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "106343296"
---
# <a name="initialization"></a><span data-ttu-id="b27b9-103">Initialisierung</span><span class="sxs-lookup"><span data-stu-id="b27b9-103">Initialization</span></span>

<span data-ttu-id="b27b9-104">Der *Ws2- \_32.dll* lädt die Schnittstellen-DLL des Dienstanbieters in das System, indem er die standardmäßigen Methoden zum Laden der dynamischen Microsoft Windows-Bibliothek verwendet, und initialisiert sie durch Aufrufen von [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup).</span><span class="sxs-lookup"><span data-stu-id="b27b9-104">The *Ws2\_32.dll* loads the service provider's interface DLL into the system by using the standard Microsoft Windows dynamic library loading mechanisms, and initializes it by calling [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup).</span></span> <span data-ttu-id="b27b9-105">Dies wird in der Regel von einer Anwendung ausgelöst, die entweder [**Socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) oder [**wsasocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) aufruft, um einen neuen Socket zu erstellen, der einem Dienstanbieter zugeordnet wird, dessen Schnittstellen-DLL zurzeit nicht in den Arbeitsspeicher geladen wird.</span><span class="sxs-lookup"><span data-stu-id="b27b9-105">This is typically triggered by an application calling either [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) or [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) to create a new socket to be associated with a service provider whose interface DLL is not currently loaded into memory.</span></span> <span data-ttu-id="b27b9-106">Der Pfad zur Schnittstellen-DLL jedes Dienstanbieters wird vom Ws2- *\_32.dll* zu dem Zeitpunkt gespeichert, an dem der Dienstanbieter installiert wird.</span><span class="sxs-lookup"><span data-stu-id="b27b9-106">The path to each service provider's interface DLL is stored by the *Ws2\_32.dll* at the time the service provider is being installed.</span></span> <span data-ttu-id="b27b9-107">Weitere Informationen finden Sie unter [Installations-und Konfigurationsfunktionen](installation-and-configuration-functions-2.md) .</span><span class="sxs-lookup"><span data-stu-id="b27b9-107">See [Installation and Configuration Functions](installation-and-configuration-functions-2.md) for more information.</span></span>

<span data-ttu-id="b27b9-108">Im Laufe der Zeit sind möglicherweise verschiedene Versionen für die Winsock-DLLs,-Anwendungen und-Dienstanbieter vorhanden.</span><span class="sxs-lookup"><span data-stu-id="b27b9-108">Over time, different versions may exist for the Winsock DLLs, applications, and service providers.</span></span> <span data-ttu-id="b27b9-109">Neue Versionen definieren möglicherweise neue Features und neue Parameter für Datenstrukturen und bitparameter usw. Versionsnummern geben daher an, wie verschiedene Datenstrukturen interpretiert werden.</span><span class="sxs-lookup"><span data-stu-id="b27b9-109">New versions may define new features and new parameters to data structures and bit parameters, etc. Version numbers therefore indicate how to interpret various data structures.</span></span>

<span data-ttu-id="b27b9-110">Um eine optimale Mischung und eine Übereinstimmung verschiedener Versionen von Anwendungen, Versionen der Ws2 \_32.dll und Versionen von Dienstanbietern durch unterschiedliche Anbieter zu ermöglichen, stellt der SPI einen Versions Aushandlungs Mechanismus zur Verwendung zwischen dem *Ws2- \_32.dll* und den Dienstanbietern bereit.</span><span class="sxs-lookup"><span data-stu-id="b27b9-110">To allow optimal mixing and matching of different versions of applications, versions of the Ws2\_32.dll itself, and versions of service providers by different vendors, the SPI provides a version negotiation mechanism for use between the *Ws2\_32.dll* and the service providers.</span></span> <span data-ttu-id="b27b9-111">Diese Versions Aushandlung wird von [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup)behandelt.</span><span class="sxs-lookup"><span data-stu-id="b27b9-111">This version negotiation is handled by [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup).</span></span> <span data-ttu-id="b27b9-112">Im Grunde übergibt der *Ws2- \_32.dll* an den Dienstanbieter die höchsten Versionsnummern, mit denen er kompatibel ist.</span><span class="sxs-lookup"><span data-stu-id="b27b9-112">Basically, the *Ws2\_32.dll* passes to the service provider the highest version numbers with which it is compatible.</span></span> <span data-ttu-id="b27b9-113">Der Dienstanbieter vergleicht diese mit einem eigenen unterstützten Bereich von Versionsnummern.</span><span class="sxs-lookup"><span data-stu-id="b27b9-113">The service provider compares this with its own supported range of version numbers.</span></span> <span data-ttu-id="b27b9-114">Wenn sich diese Bereiche überschneiden, gibt der Dienstanbieter einen Wert im überlappenden Bereich des Bereichs als Ergebnis der Aushandlung zurück.</span><span class="sxs-lookup"><span data-stu-id="b27b9-114">If these ranges overlap, the service provider returns a value within the overlapping portion of the range as the result of the negotiation.</span></span> <span data-ttu-id="b27b9-115">In der Regel sollte dies der höchstmögliche Wert sein.</span><span class="sxs-lookup"><span data-stu-id="b27b9-115">Usually, this should be the highest possible value.</span></span> <span data-ttu-id="b27b9-116">Wenn sich die Bereiche nicht überlappen, sind die beiden Parteien nicht kompatibel, und die Funktion gibt einen Fehler zurück.</span><span class="sxs-lookup"><span data-stu-id="b27b9-116">If the ranges do not overlap, the two parties are incompatible and the function returns an error.</span></span>

<span data-ttu-id="b27b9-117">[**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup) muss von jedem Client Prozess mindestens einmal aufgerufen werden und kann durch Ws2 \_32.dll oder andere Entitäten mehrmals aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="b27b9-117">[**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup) must be called at least once by each client process, and may be called multiple times by Ws2\_32.dll or other entities.</span></span> <span data-ttu-id="b27b9-118">Für jeden erfolgreichen **WSPStartup** -Aufruf muss ein entsprechendes [**wspcleanup**](/previous-versions/windows/hardware/network/ff566270(v=vs.85)) aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="b27b9-118">A matching [**WSPCleanup**](/previous-versions/windows/hardware/network/ff566270(v=vs.85)) must be called for each successful **WSPStartup** call.</span></span> <span data-ttu-id="b27b9-119">Der Dienstanbieter sollte einen Verweis Zähler pro Prozess beibehalten.</span><span class="sxs-lookup"><span data-stu-id="b27b9-119">The service provider should maintain a reference count on a per-process basis.</span></span> <span data-ttu-id="b27b9-120">Bei jedem **WSPStartup** -Aufruf kann der Aufrufer eine beliebige Versionsnummer angeben, die von der SP-dll unterstützt wird.</span><span class="sxs-lookup"><span data-stu-id="b27b9-120">On each **WSPStartup** call, the caller may specify any version number supported by the SP DLL.</span></span>

<span data-ttu-id="b27b9-121">Ein Dienstanbieter muss den Zeiger auf die upsend-Verteilungs Tabelle des Clients speichern, die als [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup) -Parameter pro Prozess empfangen wird.</span><span class="sxs-lookup"><span data-stu-id="b27b9-121">A service provider must store the pointer to the client's upcall dispatch table that is received as a [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup) parameter on a per-process basis.</span></span> <span data-ttu-id="b27b9-122">Wenn ein bestimmter Prozess **WSPStartup** mehrmals aufruft, darf der Dienstanbieter nur den zuletzt angegebenen dispatchtabellenzeiger verwenden.</span><span class="sxs-lookup"><span data-stu-id="b27b9-122">If a given process calls **WSPStartup** multiple times, the service provider must use only the most recently supplied dispatch table pointer.</span></span>

<span data-ttu-id="b27b9-123">Im Rahmen des Initialisierungs Vorgangs des Dienstanbieters ruft der Ws2 \_ -32.dll die dispatchtabelle des Dienstanbieters über den *lpproctable* -Parameter ab, um Einstiegspunkte für die restlichen SPI-Funktionen zu erhalten, die in diesem Dokument angegeben sind.</span><span class="sxs-lookup"><span data-stu-id="b27b9-123">As part of the service provider initialization process The Ws2\_32.dll retrieves the service provider's dispatch table through the *lpProcTable* parameter in order to obtain entry points to the rest of the SPI functions specified in this document.</span></span>

<span data-ttu-id="b27b9-124">Die Verwendung einer dispatchtabelle (im Gegensatz zu den üblichen dll-Mechanismen für den Zugriff auf Einstiegspunkte) dient zwei Zwecken:</span><span class="sxs-lookup"><span data-stu-id="b27b9-124">Using a dispatch table (as opposed to the usual DLL mechanisms for accessing entry points) serves two purposes:</span></span>

-   <span data-ttu-id="b27b9-125">Es ist für die Ws2- \_32.dll bequemer, da ein einzelner-Vorgang zum Ermitteln des gesamten Satzes von Einstiegspunkten durchgeführt werden kann.</span><span class="sxs-lookup"><span data-stu-id="b27b9-125">It is more convenient for the Ws2\_32.dll since a single call can be made to discover the entire set of entry points.</span></span>
-   <span data-ttu-id="b27b9-126">Dadurch können mehrstufige Dienstanbieter, die in Protokoll Ketten gebildet werden, effizienter arbeiten.</span><span class="sxs-lookup"><span data-stu-id="b27b9-126">It enables layered service providers formed into protocol chains to operate more efficiently.</span></span>

## <a name="initializing-protocol-chains"></a><span data-ttu-id="b27b9-127">Protokoll Ketten werden initialisiert.</span><span class="sxs-lookup"><span data-stu-id="b27b9-127">Initializing Protocol Chains</span></span>

<span data-ttu-id="b27b9-128">Zum Zeitpunkt der Installation der [**wsaprotocol- \_ Informations**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) Struktur für eine Protokoll Kette wird auch der Pfad zum ersten geschichteten Anbieter in der Kette angegeben.</span><span class="sxs-lookup"><span data-stu-id="b27b9-128">At the time the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure for a protocol chain is installed, the path to the first layered provider in the chain is also specified.</span></span> <span data-ttu-id="b27b9-129">Wenn eine Protokoll Kette initialisiert wird, verwendet der Ws2 \_ -32.dll diesen Pfad zum Laden der Anbieter-DLL und ruft dann [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup)auf.</span><span class="sxs-lookup"><span data-stu-id="b27b9-129">When a protocol chain is initialized, the Ws2\_32.dll uses this path to load the provider DLL and then invokes [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup).</span></span> <span data-ttu-id="b27b9-130">Da **WSPStartup** einen Zeiger auf die **wsaprotocol- \_ Informations** Struktur der Kette als einen seiner Parameter enthält, können überlagerte Anbieter ermitteln, in welchen Typ von Kette Sie initialisiert werden, und die Identität der nächst niedrigeren Ebene in der Kette.</span><span class="sxs-lookup"><span data-stu-id="b27b9-130">Since **WSPStartup** includes a pointer to the chain's **WSAPROTOCOL\_INFO** structure as one of its parameters, layered providers can determine what type of chain they are being initialized into, and the identity of the next lower layer in the chain.</span></span> <span data-ttu-id="b27b9-131">Ein mehrstufiger Anbieter lädt dann wiederum den nächsten Protokoll Anbieter in der Kette und initialisiert ihn mit einem **WSPStartup**-Aufrufvorgang usw.</span><span class="sxs-lookup"><span data-stu-id="b27b9-131">A layered provider would then in turn load the next protocol provider in the chain and initialize it with a call to **WSPStartup**, and so forth.</span></span> <span data-ttu-id="b27b9-132">Wenn die nächste untere Ebene ein weiterer mehrstufiger Anbieter ist, muss im **WSPStartup** -Aufruf auf die **wsaprotocol- \_ Informations** Struktur der Kette verwiesen werden.</span><span class="sxs-lookup"><span data-stu-id="b27b9-132">Whenever the next lower layer is another layered provider, the chain's **WSAPROTOCOL\_INFO** structure must be referenced in the **WSPStartup** call.</span></span> <span data-ttu-id="b27b9-133">Wenn es sich bei der nächsten niedrigeren Ebene um ein Basisprotokoll handelt (das das Ende der Kette bezeichnet), wird die **wsaprotocol- \_ Informations** Struktur der Kette nicht mehr nach unten weitergegeben.</span><span class="sxs-lookup"><span data-stu-id="b27b9-133">When the next lower layer is a base protocol (signifying the end of the chain), the chain's **WSAPROTOCOL\_INFO** structure is no longer propagated downward.</span></span> <span data-ttu-id="b27b9-134">Stattdessen muss die aktuelle Ebene auf eine **wsaprotocol- \_ Informations** Struktur verweisen, die dem Protokoll entspricht, das der Basis Anbieter verwenden soll.</span><span class="sxs-lookup"><span data-stu-id="b27b9-134">Instead, the current layer must reference a **WSAPROTOCOL\_INFO** structure that corresponds to the protocol that the base provider should use.</span></span> <span data-ttu-id="b27b9-135">Folglich hat der Basis Anbieter keine Ahnung, dass er an einer Protokoll Kette beteiligt ist.</span><span class="sxs-lookup"><span data-stu-id="b27b9-135">Thus, the base provider has no notion of being involved in a protocol chain.</span></span>

<span data-ttu-id="b27b9-136">Die Verteilungs Tabelle, die von einem bestimmten geschichteten Anbieter bereitgestellt wird, wird in vielen Fällen die Einstiegspunkte eines zugrunde liegenden Anbieters duplizieren.</span><span class="sxs-lookup"><span data-stu-id="b27b9-136">The dispatch table provided by any given layered provider will, in many instances, duplicate the entry points of an underlying provider.</span></span> <span data-ttu-id="b27b9-137">Der überlappende Anbieter fügt nur seine eigenen Einstiegspunkte für Funktionen ein, an die er direkt beteiligt sein musste.</span><span class="sxs-lookup"><span data-stu-id="b27b9-137">The layered provider would only insert its own entry points for functions that it needed to be directly involved in.</span></span> <span data-ttu-id="b27b9-138">Beachten Sie jedoch, dass es zwingend erforderlich ist, dass ein mehrstufiger Anbieter den Inhalt der Upcall-Tabelle, die er empfangen hat, beim Aufrufen von [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup) auf der nächst niedrigeren Ebene in einer Protokoll Kette nicht ändert.</span><span class="sxs-lookup"><span data-stu-id="b27b9-138">Note, however, that it is imperative that a layered provider not modify the contents of the upcall table that it received when calling [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup) on the next lower layer in a protocol chain.</span></span> <span data-ttu-id="b27b9-139">Diese upcalls müssen direkt an die Windows Sockets 2-dll vorgenommen werden.</span><span class="sxs-lookup"><span data-stu-id="b27b9-139">These upcalls must be made directly to the Windows Sockets 2 DLL.</span></span>

 

 
