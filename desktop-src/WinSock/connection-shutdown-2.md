---
description: Im folgenden wird beschrieben, wie ein Incident eine etablierte Socketverbindung herunterfährt.
ms.assetid: 052e04a4-5290-4dca-af7a-cd590ebfbe15
title: Herunterfahren der Verbindung
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bbde0cfe4c3a97435c2412d28970107f830308fd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "103862580"
---
# <a name="connection-shutdown"></a><span data-ttu-id="8490c-103">Herunterfahren der Verbindung</span><span class="sxs-lookup"><span data-stu-id="8490c-103">Connection Shutdown</span></span>

<span data-ttu-id="8490c-104">Im folgenden wird beschrieben, wie ein Incident eine etablierte Socketverbindung herunterfährt.</span><span class="sxs-lookup"><span data-stu-id="8490c-104">The following describes operations incident to shutting down an established socket connection.</span></span>

## <a name="initiating-shutdown-sequence"></a><span data-ttu-id="8490c-105">Initiierungs Sequenz wird initiiert</span><span class="sxs-lookup"><span data-stu-id="8490c-105">Initiating Shutdown Sequence</span></span>

<span data-ttu-id="8490c-106">Eine Socketverbindung kann auf verschiedene Arten heruntergefahren werden.</span><span class="sxs-lookup"><span data-stu-id="8490c-106">A socket connection can be taken down in one of several ways.</span></span> <span data-ttu-id="8490c-107">[**Wspshutdown**](/previous-versions/windows/desktop/legacy/ms742294(v=vs.85)) (mit der gleichwertigen *Verwendung* von SD \_ Send oder SD \_ ) und [**wspsenddisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) können verwendet werden, um eine ordnungsgemäße Verbindung mit dem Herunterfahren zu initiieren.</span><span class="sxs-lookup"><span data-stu-id="8490c-107">[**WSPShutdown**](/previous-versions/windows/desktop/legacy/ms742294(v=vs.85)) (with *how* equal to SD\_SEND or SD\_BOTH), and [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) may be used to initiate a graceful connection shutdown.</span></span> <span data-ttu-id="8490c-108">[**Wspclosesocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85)) kann verwendet werden, um ein ordnungsgemäßes oder abgerufenes Herunterfahren zu initiieren, je nach den vom schließenden Socket aufgerufenen Linger-Optionen.</span><span class="sxs-lookup"><span data-stu-id="8490c-108">[**WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85)) can be used to initiate either a graceful or abortive shutdown, depending on the linger options invoked by the closing a socket.</span></span> <span data-ttu-id="8490c-109">Weitere Informationen zu ordnungsgemäßen und Abbruch Optionen finden Sie unten.</span><span class="sxs-lookup"><span data-stu-id="8490c-109">See below for more information about graceful and abortive shutdowns, and linger options.</span></span>

## <a name="indicating-remote-shutdown"></a><span data-ttu-id="8490c-110">Angeben des Remote herunter Fahrens</span><span class="sxs-lookup"><span data-stu-id="8490c-110">Indicating Remote Shutdown</span></span>

<span data-ttu-id="8490c-111">Dienstanbieter geben an, dass die Verbindung von der Remote Partei über das FD- \_ Netzwerk Ereignis initiiert wurde.</span><span class="sxs-lookup"><span data-stu-id="8490c-111">Service providers indicate connection teardown that is initiated by the remote party through the FD\_CLOSE network event.</span></span> <span data-ttu-id="8490c-112">Ordnungsgemäßes Herunterfahren wird auch durch [**wsprecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) angegeben, wenn die Anzahl der gelesenen Bytes 0 für bytestreamprotokolle ist, oder durch einen Rückgabe Fehlercode von wsaediscon für Nachrichten orientierte Protokolle.</span><span class="sxs-lookup"><span data-stu-id="8490c-112">Graceful shutdown is also be indicated through [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) when the number of bytes read is 0 for byte-stream protocols, or through a return error code of WSAEDISCON for message-oriented protocols.</span></span> <span data-ttu-id="8490c-113">In jedem Fall gibt der **wsprecv** -Rückgabe Fehlercode von WSAECONNRESET an, dass ein Abbruch abgebrochen wurde.</span><span class="sxs-lookup"><span data-stu-id="8490c-113">In any case, a **WSPRecv** return error code of WSAECONNRESET indicates an abortive shutdown.</span></span>

## <a name="exchanging-user-data-at-shutdown-time"></a><span data-ttu-id="8490c-114">Austauschen von Benutzerdaten beim Herunterfahren</span><span class="sxs-lookup"><span data-stu-id="8490c-114">Exchanging User Data at Shutdown Time</span></span>

<span data-ttu-id="8490c-115">Zum Austauschen von Benutzerdaten zwischen den Endpunkten ist es auch möglich, die Verbindung zwischen den Endpunkten zu unterstützen</span><span class="sxs-lookup"><span data-stu-id="8490c-115">At connection teardown time, it is also possible (for protocols that support this) to exchange user data between the endpoints.</span></span> <span data-ttu-id="8490c-116">Das Ende, das "Beendigungs" initiiert, kann [**wspsenddisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) anrufen, um anzugeben, dass keine weiteren Daten gesendet werden sollen, und die Initiierung der verbindungsendesequenz auslösen soll.</span><span class="sxs-lookup"><span data-stu-id="8490c-116">The end that initiates the teardown can call [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) to indicate that no more data is to be sent and cause the connection teardown sequence to be initiated.</span></span> <span data-ttu-id="8490c-117">Bei bestimmten Protokollen ist ein Teil dieser Beendigungs-Sequenz die Übermittlung von Trennungs Daten vom Beendigungs-Initiator.</span><span class="sxs-lookup"><span data-stu-id="8490c-117">For certain protocols, part of this teardown sequence is the delivery of disconnect data from the teardown initiator.</span></span> <span data-ttu-id="8490c-118">Nachdem Sie festgestellt haben, dass das Remote Ende die Beendigungs-Sequenz initiiert hat (in der Regel über die \_ Bestätigung der Bestätigung von FD), kann die [**wsprecvdisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) -Funktion aufgerufen werden, um die Trennungs Daten zu empfangen (sofern vorhanden).</span><span class="sxs-lookup"><span data-stu-id="8490c-118">After receiving notice that the remote end has initiated the teardown sequence (typically through the FD\_CLOSE indication), the [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) function may be called to receive the disconnect data (if any).</span></span>

<span data-ttu-id="8490c-119">Beachten Sie das folgende Szenario, um zu veranschaulichen, wie die Trennung von Daten möglicherweise verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="8490c-119">To illustrate how disconnect data might be used, consider the following scenario.</span></span> <span data-ttu-id="8490c-120">Die Client Hälfte einer Client/Server-Anwendung ist für das Beenden einer Socketverbindung verantwortlich.</span><span class="sxs-lookup"><span data-stu-id="8490c-120">The client half of a client/server application is responsible for terminating a socket connection.</span></span> <span data-ttu-id="8490c-121">Koincident mit der von ihm bereitgestellten Beendigung (Durchtrennen von Daten) der Gesamtzahl der Transaktionen, die mit dem Server verarbeitet wurden.</span><span class="sxs-lookup"><span data-stu-id="8490c-121">Coincident with the termination it provides (through disconnect data) the total number of transactions it processed with the server.</span></span> <span data-ttu-id="8490c-122">Der Server antwortet wiederum mit der kumulativen Gesamtsumme von Transaktionen, die er mit allen Clients verarbeitet hat.</span><span class="sxs-lookup"><span data-stu-id="8490c-122">The server in turn responds with the cumulative grand total of transactions that it has processed with all clients.</span></span> <span data-ttu-id="8490c-123">Die Reihenfolge der Aufrufe und Anzeichen können wie in der folgenden Tabelle gezeigt auftreten.</span><span class="sxs-lookup"><span data-stu-id="8490c-123">The sequence of calls and indications might occur as shown in the following table.</span></span>

| <span data-ttu-id="8490c-124">Clientseitig</span><span class="sxs-lookup"><span data-stu-id="8490c-124">Client side</span></span>                                                                                                               | <span data-ttu-id="8490c-125">Serverseitig</span><span class="sxs-lookup"><span data-stu-id="8490c-125">Server side</span></span>                                                                                                                             |
|---------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="8490c-126">(1) ruft [**wspsenddisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) auf, um die Sitzung zu beenden und die Transaktions Summe zu liefern.</span><span class="sxs-lookup"><span data-stu-id="8490c-126">(1) Invokes [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) to conclude session and supply transaction total.</span></span>            |                                                                                                                                         |
|                                                                                                                           | <span data-ttu-id="8490c-127">(2) ruft "FD \_ Close" oder " [**wsprecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) " mit dem Rückgabewert "Null" oder "wsaediscon" ab, was das ordnungsgemäße Herunterfahren anzeigt.</span><span class="sxs-lookup"><span data-stu-id="8490c-127">(2) Gets FD\_CLOSE, or [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) with a return value of zero or WSAEDISCON indicating graceful shutdown in progress.</span></span> |
|                                                                                                                           | <span data-ttu-id="8490c-128">(3) ruft [**wsprecvdisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) auf, um die Transaktions Summe des Clients zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="8490c-128">(3) Invokes [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) to get client's transaction total.</span></span>                                         |
|                                                                                                                           | <span data-ttu-id="8490c-129">(4) berechnet das kumulative Gesamtergebnis aller Transaktionen.</span><span class="sxs-lookup"><span data-stu-id="8490c-129">(4) Computes cumulative grand total of all transactions.</span></span>                                                                                |
|                                                                                                                           | <span data-ttu-id="8490c-130">(5) ruft [**wspsenddisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) auf, um das Gesamtergebnis zu übertragen.</span><span class="sxs-lookup"><span data-stu-id="8490c-130">(5) Invokes [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) to transmit grand total.</span></span>                                                   |
| <span data-ttu-id="8490c-131">(6) empfängt die \_ Bestätigung von FD.</span><span class="sxs-lookup"><span data-stu-id="8490c-131">(6) Receives FD\_CLOSE indication.</span></span>                                                                                        | <span data-ttu-id="8490c-132">(5 ') ruft [ **wspclosesocket** auf](/previous-versions/windows/hardware/network/ff566273(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="8490c-132">(5') Invokes [**WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85))</span></span>                                                                                 |
| <span data-ttu-id="8490c-133">(7) ruft [**wsprecvdisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) auf, um eine kumulative Gesamtsumme von Transaktionen zu empfangen und zu speichern.</span><span class="sxs-lookup"><span data-stu-id="8490c-133">(7) Invokes [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) to receive and store cumulative grand total of transactions.</span></span> |                                                                                                                                         |
|                                                                                                                           | <span data-ttu-id="8490c-134">(8) ruft [ **wspclosesocket** auf.](/previous-versions/windows/hardware/network/ff566273(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="8490c-134">(8) Invokes [**WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85))</span></span>                                                                                  |



 

<span data-ttu-id="8490c-135">Der Schritt (5) muss Schritt (5) entsprechen, hat jedoch keine zeitliche Beziehungs Beziehung mit Schritten (6), (7) oder (8).</span><span class="sxs-lookup"><span data-stu-id="8490c-135">Step (5') must follow step (5), but has no timing relationship with steps (6), (7), or (8).</span></span>

 

 
