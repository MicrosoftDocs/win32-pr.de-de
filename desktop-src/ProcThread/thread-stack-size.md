---
description: Jeder neue Thread oder diese Fiber erhält einen eigenen Stapelbereich, der aus reserviertem und anfänglich zugespeichertem Arbeitsspeicher besteht.
ms.assetid: abb2d5c1-040b-4c36-aae5-3517b6a8c540
title: Thread Stapelgröße
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f4204e0bffa13fb43b6ea9520b60c0505372bad6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/08/2021
ms.locfileid: "103959923"
---
# <a name="thread-stack-size"></a><span data-ttu-id="57aea-103">Thread Stapelgröße</span><span class="sxs-lookup"><span data-stu-id="57aea-103">Thread Stack Size</span></span>

<span data-ttu-id="57aea-104">Jeder neue Thread oder diese Fiber erhält einen eigenen Stapelbereich, der aus reserviertem und anfänglich zugespeichertem Arbeitsspeicher besteht.</span><span class="sxs-lookup"><span data-stu-id="57aea-104">Each new thread or fiber receives its own stack space consisting of both reserved and initially committed memory.</span></span> <span data-ttu-id="57aea-105">Die reservierte Arbeitsspeicher Größe stellt die gesamte Stapel Zuordnung im virtuellen Arbeitsspeicher dar.</span><span class="sxs-lookup"><span data-stu-id="57aea-105">The reserved memory size represents the total stack allocation in virtual memory.</span></span> <span data-ttu-id="57aea-106">Daher ist die reservierte Größe auf den virtuellen Adressbereich beschränkt.</span><span class="sxs-lookup"><span data-stu-id="57aea-106">As such, the reserved size is limited to the virtual address range.</span></span> <span data-ttu-id="57aea-107">Die anfänglich zugesicherte Seiten verbrauchen keinen physischen Speicher, bis auf Sie verwiesen wird. Allerdings entfernen Sie Seiten aus dem gesamten commitlimit des Systems, d. h. die Größe der Auslagerungs Datei zuzüglich der Größe des physischen Speichers.</span><span class="sxs-lookup"><span data-stu-id="57aea-107">The initially committed pages do not utilize physical memory until they are referenced; however, they do remove pages from the system total commit limit, which is the size of the page file plus the size of the physical memory.</span></span> <span data-ttu-id="57aea-108">Das System führt einen Commit für zusätzliche Seiten aus dem reservierten Stapel Speicher aus, wenn Sie benötigt werden, bis der Stapel die reservierte Größe minus eine Seite erreicht (die als Wächter Seite verwendet wird, um Stapelüberlauf zu verhindern) oder das System so wenig Arbeitsspeicher hat, dass der Vorgang nicht ausgeführt werden kann.</span><span class="sxs-lookup"><span data-stu-id="57aea-108">The system commits additional pages from the reserved stack memory as they are needed, until either the stack reaches the reserved size minus one page (which is used as a guard page to prevent stack overflow) or the system is so low on memory that the operation fails.</span></span>

<span data-ttu-id="57aea-109">Es empfiehlt sich, möglichst wenig Stapelgröße auszuwählen und den Stapel zu commitden, der für die zuverlässige Ausführung des Threads oder der Fiber benötigt wird.</span><span class="sxs-lookup"><span data-stu-id="57aea-109">It is best to choose as small a stack size as possible and commit the stack that is needed for the thread or fiber to run reliably.</span></span> <span data-ttu-id="57aea-110">Jede Seite, die für den Stapel reserviert ist, kann nicht für andere Zwecke verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="57aea-110">Every page that is reserved for the stack cannot be used for any other purpose.</span></span>

<span data-ttu-id="57aea-111">Ein Stapel wird freigegeben, wenn der Thread beendet wird.</span><span class="sxs-lookup"><span data-stu-id="57aea-111">A stack is freed when its thread exits.</span></span> <span data-ttu-id="57aea-112">Er wird nicht freigegeben, wenn der Thread von einem anderen Thread beendet wird.</span><span class="sxs-lookup"><span data-stu-id="57aea-112">It is not freed if the thread is terminated by another thread.</span></span>

<span data-ttu-id="57aea-113">Die Standardgröße für den reservierten und anfänglich zugesicherte Stapel Speicher wird im Header der ausführbaren Datei angegeben.</span><span class="sxs-lookup"><span data-stu-id="57aea-113">The default size for the reserved and initially committed stack memory is specified in the executable file header.</span></span> <span data-ttu-id="57aea-114">Die Thread-oder Fiber Erstellung schlägt fehl, wenn nicht genügend Arbeitsspeicher zur Reservierung oder zum Commit der Anzahl der angeforderten Bytes vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="57aea-114">Thread or fiber creation fails if there is not enough memory to reserve or commit the number of bytes requested.</span></span> <span data-ttu-id="57aea-115">Die vom Linker verwendete standardmäßige Stapel Reservierungs Größe beträgt 1 MB.</span><span class="sxs-lookup"><span data-stu-id="57aea-115">The default stack reservation size used by the linker is 1 MB.</span></span> <span data-ttu-id="57aea-116">Um eine andere standardmäßige Stapel Reservierungs Größe für alle Threads und Fibers anzugeben, verwenden Sie die STACKSIZE-Anweisung in der Modul Definitionsdatei (. def).</span><span class="sxs-lookup"><span data-stu-id="57aea-116">To specify a different default stack reservation size for all threads and fibers, use the STACKSIZE statement in the module definition (.def) file.</span></span> <span data-ttu-id="57aea-117">Das Betriebssystem rundet die angegebene Größe auf das nächste Vielfache der Zuordnungs Granularität des Systems (in der Regel 64 KB) ab.</span><span class="sxs-lookup"><span data-stu-id="57aea-117">The operating system rounds up the specified size to the nearest multiple of the system's allocation granularity (typically 64 KB).</span></span> <span data-ttu-id="57aea-118">Um die Zuordnungs Granularität des aktuellen Systems abzurufen, verwenden Sie die [**GetSystemInfo**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsysteminfo) -Funktion.</span><span class="sxs-lookup"><span data-stu-id="57aea-118">To retrieve the allocation granularity of the current system, use the [**GetSystemInfo**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsysteminfo) function.</span></span>

<span data-ttu-id="57aea-119">Verwenden Sie den *dwstacksize* -Parameter der Funktion " [**foratethread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread)", " [**forateremotethread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread)" oder " [**foratefiber**](/windows/desktop/api/WinBase/nf-winbase-createfiber) ", um den anfänglich zugegebenen Stapel Speicher zu ändern.</span><span class="sxs-lookup"><span data-stu-id="57aea-119">To change the initially committed stack space, use the *dwStackSize* parameter of the [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread), [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread), or [**CreateFiber**](/windows/desktop/api/WinBase/nf-winbase-createfiber) function.</span></span> <span data-ttu-id="57aea-120">Dieser Wert wird auf die nächste Seite aufgerundet.</span><span class="sxs-lookup"><span data-stu-id="57aea-120">This value is rounded up to the nearest page.</span></span> <span data-ttu-id="57aea-121">Im Allgemeinen ist die Reserve Größe die Standard Reserve Größe, die im Header der ausführbaren Datei angegeben ist.</span><span class="sxs-lookup"><span data-stu-id="57aea-121">Generally, the reserve size is the default reserve size specified in the executable header.</span></span> <span data-ttu-id="57aea-122">Wenn jedoch die von *dwstacksize* angegebene anfängliche Zugesicherte Größe größer oder gleich der Standard Reserve Größe ist, wird diese neue Commitgröße auf das nächste Vielfache von 1 MB aufgerundet.</span><span class="sxs-lookup"><span data-stu-id="57aea-122">However, if the initially committed size specified by *dwStackSize* is larger than or equal to the default reserve size, the reserve size is this new commit size rounded up to the nearest multiple of 1 MB.</span></span>

<span data-ttu-id="57aea-123">Legen Sie zum Ändern der reservierten Stapelgröße den *dwupationflags* -Parameter von " [**foratethread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread) " oder " [**forateremotethread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread) " auf "Stack \_ size \_ Param" \_ ist \_ eine Reservierung fest, \_ und verwenden Sie den Parameter " *dwstacksize* ".</span><span class="sxs-lookup"><span data-stu-id="57aea-123">To change the reserved stack size, set the *dwCreationFlags* parameter of [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread) or [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread) to STACK\_SIZE\_PARAM\_IS\_A\_RESERVATION and use the *dwStackSize* parameter.</span></span> <span data-ttu-id="57aea-124">In diesem Fall ist die anfängliche Zugesicherte Größe die im ausführbaren Header angegebene Standardgröße.</span><span class="sxs-lookup"><span data-stu-id="57aea-124">In this case, the initially committed size is the default size specified in the executable header.</span></span> <span data-ttu-id="57aea-125">Verwenden Sie für Fibers den *dwstackreservesize* -Parameter von " [**kreatefiberex**](/windows/desktop/api/WinBase/nf-winbase-createfiberex)".</span><span class="sxs-lookup"><span data-stu-id="57aea-125">For fibers, use the *dwStackReserveSize* parameter of [**CreateFiberEx**](/windows/desktop/api/WinBase/nf-winbase-createfiberex).</span></span> <span data-ttu-id="57aea-126">Die Zugesicherte Größe wird im *dwstackcommitsize* -Parameter angegeben.</span><span class="sxs-lookup"><span data-stu-id="57aea-126">The committed size is specified in the *dwStackCommitSize* parameter.</span></span>

<span data-ttu-id="57aea-127">Die [**setthreadstackguarantee**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadstackguarantee) -Funktion legt die minimale Größe des Stapels fest, der dem aufrufenden Thread oder der Fiber zugeordnet ist, der während der Stapelüberlauf Ausnahmen verfügbar sein wird.</span><span class="sxs-lookup"><span data-stu-id="57aea-127">The [**SetThreadStackGuarantee**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadstackguarantee) function sets the minimum size of the stack associated with the calling thread or fiber that will be available during any stack overflow exceptions.</span></span>

 

 
