---
description: Eine Fiber ist eine Ausführungs Einheit, die manuell von der Anwendung geplant werden muss.
ms.assetid: 6283f56b-23ae-4840-abd0-2478a50c670c
title: STAP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4ea0383e6d207a77c621f00f358c72bb8873ecb5
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/07/2021
ms.locfileid: "103756559"
---
# <a name="fibers"></a><span data-ttu-id="15e01-103">STAP</span><span class="sxs-lookup"><span data-stu-id="15e01-103">Fibers</span></span>

<span data-ttu-id="15e01-104">Eine *Fiber* ist eine Ausführungs Einheit, die manuell von der Anwendung geplant werden muss.</span><span class="sxs-lookup"><span data-stu-id="15e01-104">A *fiber* is a unit of execution that must be manually scheduled by the application.</span></span> <span data-ttu-id="15e01-105">Fibers werden im Kontext der Threads ausgeführt, die Sie planen.</span><span class="sxs-lookup"><span data-stu-id="15e01-105">Fibers run in the context of the threads that schedule them.</span></span> <span data-ttu-id="15e01-106">Jeder Thread kann mehrere Fibers planen.</span><span class="sxs-lookup"><span data-stu-id="15e01-106">Each thread can schedule multiple fibers.</span></span> <span data-ttu-id="15e01-107">Im Allgemeinen bieten Fibers keine Vorteile gegenüber einer gut entworfenen Multithread-Anwendung.</span><span class="sxs-lookup"><span data-stu-id="15e01-107">In general, fibers do not provide advantages over a well-designed multithreaded application.</span></span> <span data-ttu-id="15e01-108">Die Verwendung von Fibers kann jedoch das Portieren von Anwendungen erleichtern, die zum Planen Ihrer eigenen Threads entworfen wurden.</span><span class="sxs-lookup"><span data-stu-id="15e01-108">However, using fibers can make it easier to port applications that were designed to schedule their own threads.</span></span>

<span data-ttu-id="15e01-109">Aus Sicht des Systems geht eine Fiber von der Identität des Threads aus, von dem Sie ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="15e01-109">From a system standpoint, a fiber assumes the identity of the thread that runs it.</span></span> <span data-ttu-id="15e01-110">Wenn eine Fiber z. b. auf den [lokalen Thread Speicher](thread-local-storage.md) (TLS) zugreift, greift Sie auf den lokalen Thread Speicher des Threads zu, auf dem Sie ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="15e01-110">For example, if a fiber accesses [thread local storage](thread-local-storage.md) (TLS), it is accessing the thread local storage of the thread that is running it.</span></span> <span data-ttu-id="15e01-111">Wenn außerdem eine Fiber die [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) -Funktion aufruft, wird der Thread, der ausgeführt wird, beendet.</span><span class="sxs-lookup"><span data-stu-id="15e01-111">In addition, if a fiber calls the [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) function, the thread that is running it exits.</span></span> <span data-ttu-id="15e01-112">Eine Fiber verfügt jedoch nicht über die gleichen Zustandsinformationen wie die, die mit einem Thread verknüpft sind.</span><span class="sxs-lookup"><span data-stu-id="15e01-112">However, a fiber does not have all the same state information associated with it as that associated with a thread.</span></span> <span data-ttu-id="15e01-113">Die einzigen Zustandsinformationen, die für eine Fiber aufbewahrt werden, sind der Stapel, eine Teilmenge der Register und die Fiber Daten, die während der Fiber Erstellung bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="15e01-113">The only state information maintained for a fiber is its stack, a subset of its registers, and the fiber data provided during fiber creation.</span></span> <span data-ttu-id="15e01-114">Die gespeicherten Register sind der Satz von Registern, der in der Regel über einen Funktionsbefehl hinweg beibehalten wird.</span><span class="sxs-lookup"><span data-stu-id="15e01-114">The saved registers are the set of registers typically preserved across a function call.</span></span>

<span data-ttu-id="15e01-115">Fibers sind nicht voremptiv geplant.</span><span class="sxs-lookup"><span data-stu-id="15e01-115">Fibers are not preemptively scheduled.</span></span> <span data-ttu-id="15e01-116">Sie können eine Fiber planen, indem Sie von einer anderen Fiber darauf wechseln.</span><span class="sxs-lookup"><span data-stu-id="15e01-116">You schedule a fiber by switching to it from another fiber.</span></span> <span data-ttu-id="15e01-117">Das System plant nach wie vor die Durchführung von Threads.</span><span class="sxs-lookup"><span data-stu-id="15e01-117">The system still schedules threads to run.</span></span> <span data-ttu-id="15e01-118">Wenn ein Thread, der Fibers ausgeführt wird, vorzeitig entfernt wird, wird seine derzeit ausgelaufende Fiber vorzeitig entfernt, bleibt aber erhalten.</span><span class="sxs-lookup"><span data-stu-id="15e01-118">When a thread running fibers is preempted, its currently running fiber is preempted but remains selected.</span></span> <span data-ttu-id="15e01-119">Die ausgewählte Fiber wird ausgeführt, wenn der Thread ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="15e01-119">The selected fiber runs when its thread runs.</span></span>

<span data-ttu-id="15e01-120">Bevor Sie die erste Fiber planen, rufen Sie die [**convertthreadesfiber**](/windows/desktop/api/WinBase/nf-winbase-convertthreadtofiber) -Funktion auf, um einen Bereich zu erstellen, in dem die Fiber Zustandsinformationen gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="15e01-120">Before scheduling the first fiber, call the [**ConvertThreadToFiber**](/windows/desktop/api/WinBase/nf-winbase-convertthreadtofiber) function to create an area in which to save fiber state information.</span></span> <span data-ttu-id="15e01-121">Der aufrufende Thread ist nun die derzeit ausgeführte Fiber.</span><span class="sxs-lookup"><span data-stu-id="15e01-121">The calling thread is now the currently executing fiber.</span></span> <span data-ttu-id="15e01-122">Die gespeicherten Zustandsinformationen für diese Fiber enthalten die Fiber-Daten, die als Argument an **convertthreaddefiber** übermittelt werden.</span><span class="sxs-lookup"><span data-stu-id="15e01-122">The stored state information for this fiber includes the fiber data passed as an argument to **ConvertThreadToFiber**.</span></span>

<span data-ttu-id="15e01-123">Die Funktion "-Funktion" [**wird zum Erstellen**](/windows/desktop/api/WinBase/nf-winbase-createfiber) einer neuen Fiber aus einer vorhandenen Fiber verwendet. der-Befehl erfordert die Stapelgröße, die Startadresse und die Fiber-Daten.</span><span class="sxs-lookup"><span data-stu-id="15e01-123">The [**CreateFiber**](/windows/desktop/api/WinBase/nf-winbase-createfiber) function is used to create a new fiber from an existing fiber; the call requires the stack size, the starting address, and the fiber data.</span></span> <span data-ttu-id="15e01-124">Die Startadresse ist in der Regel eine vom Benutzer bereitgestellte Funktion, die als Fiber Funktion bezeichnet wird, die einen Parameter annimmt (die Fiber Daten) und keinen Wert zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="15e01-124">The starting address is typically a user-supplied function, called the fiber function, that takes one parameter (the fiber data) and does not return a value.</span></span> <span data-ttu-id="15e01-125">Wenn Ihre Fiber Funktion zurückgibt, wird der Thread beendet, der die Fiber durchläuft.</span><span class="sxs-lookup"><span data-stu-id="15e01-125">If your fiber function returns, the thread running the fiber exits.</span></span> <span data-ttu-id="15e01-126">Um eine mit " **kreatefiber**" erstellte Fiber auszuführen, müssen Sie die [**switchtoken**](/windows/desktop/api/WinBase/nf-winbase-switchtofiber) -Funktion aufrufen.</span><span class="sxs-lookup"><span data-stu-id="15e01-126">To execute any fiber created with **CreateFiber**, call the [**SwitchToFiber**](/windows/desktop/api/WinBase/nf-winbase-switchtofiber) function.</span></span> <span data-ttu-id="15e01-127">Sie können **switchdefiber** mit der Adresse einer Fiber aufzurufen, die von einem anderen Thread erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="15e01-127">You can call **SwitchToFiber** with the address of a fiber created by a different thread.</span></span> <span data-ttu-id="15e01-128">Zu diesem Zweck müssen Sie die Adresse an den anderen Thread zurückgegeben haben, wenn Sie " **kreatefiber** " aufgerufen hat, und Sie müssen die ordnungsgemäße Synchronisierung verwenden.</span><span class="sxs-lookup"><span data-stu-id="15e01-128">To do this, you must have the address returned to the other thread when it called **CreateFiber** and you must use proper synchronization.</span></span>

<span data-ttu-id="15e01-129">Eine Fiber kann die Fiber Daten abrufen, indem das [**getfiberdata**](/windows/win32/api/winnt/nf-winnt-getfiberdata) -Makro aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="15e01-129">A fiber can retrieve the fiber data by calling the [**GetFiberData**](/windows/win32/api/winnt/nf-winnt-getfiberdata) macro.</span></span> <span data-ttu-id="15e01-130">Eine Fiber kann die Fiber Adresse jederzeit abrufen, indem das [**getcurrentfiber**](/windows/win32/api/winnt/nf-winnt-getcurrentfiber) -Makro aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="15e01-130">A fiber can retrieve the fiber address at any time by calling the [**GetCurrentFiber**](/windows/win32/api/winnt/nf-winnt-getcurrentfiber) macro.</span></span>

## <a name="fiber-local-storage"></a><span data-ttu-id="15e01-131">Fiber-lokaler Speicher</span><span class="sxs-lookup"><span data-stu-id="15e01-131">Fiber Local Storage</span></span>

<span data-ttu-id="15e01-132">Eine Fiber kann *Fiber Local Storage* (FLS) verwenden, um eine eindeutige Kopie einer Variablen für jede Fiber zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="15e01-132">A fiber can use *fiber local storage* (FLS) to create a unique copy of a variable for each fiber.</span></span> <span data-ttu-id="15e01-133">Wenn kein Fiber Wechsel erfolgt, verhält sich FLS genauso wie der [lokale Thread Speicher](thread-local-storage.md).</span><span class="sxs-lookup"><span data-stu-id="15e01-133">If no fiber switching occurs, FLS acts exactly the same as [thread local storage](thread-local-storage.md).</span></span> <span data-ttu-id="15e01-134">Die FLS-Funktionen ([**flsalloc**](/windows/win32/api/fibersapi/nf-fibersapi-flsalloc), [**flsfree**](/windows/win32/api/fibersapi/nf-fibersapi-flsfree), [**flsgetvalue**](/windows/win32/api/fibersapi/nf-fibersapi-flsgetvalue)und [**flssetvalue**](/windows/win32/api/fibersapi/nf-fibersapi-flssetvalue)) bearbeiten die FLS, die dem aktuellen Thread zugeordnet sind.</span><span class="sxs-lookup"><span data-stu-id="15e01-134">The FLS functions ([**FlsAlloc**](/windows/win32/api/fibersapi/nf-fibersapi-flsalloc), [**FlsFree**](/windows/win32/api/fibersapi/nf-fibersapi-flsfree), [**FlsGetValue**](/windows/win32/api/fibersapi/nf-fibersapi-flsgetvalue), and [**FlsSetValue**](/windows/win32/api/fibersapi/nf-fibersapi-flssetvalue)) manipulate the FLS associated with the current thread.</span></span> <span data-ttu-id="15e01-135">Wenn der Thread eine Fiber ausführt und die Fiber gewechselt wird, wird auch die FLS gewechselt.</span><span class="sxs-lookup"><span data-stu-id="15e01-135">If the thread is executing a fiber and the fiber is switched, the FLS is also switched.</span></span>

<span data-ttu-id="15e01-136">Um die einer Fiber zugeordneten Daten zu bereinigen, müssen Sie die [**deletefiber**](/windows/desktop/api/WinBase/nf-winbase-deletefiber) -Funktion aufrufen.</span><span class="sxs-lookup"><span data-stu-id="15e01-136">To clean up the data associated with a fiber, call the [**DeleteFiber**](/windows/desktop/api/WinBase/nf-winbase-deletefiber) function.</span></span> <span data-ttu-id="15e01-137">Diese Daten umfassen den Stapel, eine Teilmenge der Register und die Fiber-Daten.</span><span class="sxs-lookup"><span data-stu-id="15e01-137">This data includes the stack, a subset of the registers, and the fiber data.</span></span> <span data-ttu-id="15e01-138">Wenn die derzeit ausgelaufende Fiber **deletefiber** aufruft, ruft der zugehörige Thread [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) auf und wird beendet.</span><span class="sxs-lookup"><span data-stu-id="15e01-138">If the currently running fiber calls **DeleteFiber**, its thread calls [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) and terminates.</span></span> <span data-ttu-id="15e01-139">Wenn die ausgewählte Fiber eines Threads jedoch durch eine Fiber gelöscht wird, die in einem anderen Thread ausgeführt wird, wird der Thread mit der gelöschten Fiber wahrscheinlich nicht ordnungsgemäß beendet, da der Fiber Stapel freigegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="15e01-139">However, if the selected fiber of a thread is deleted by a fiber running in another thread, the thread with the deleted fiber is likely to terminate abnormally because the fiber stack has been freed.</span></span>

## <a name="related-topics"></a><span data-ttu-id="15e01-140">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="15e01-140">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="15e01-141">Verwenden von Fibers</span><span class="sxs-lookup"><span data-stu-id="15e01-141">Using Fibers</span></span>](using-fibers.md)
</dt> </dl>

 

 
