---
title: Aushandlung des Video Formats im Beispiel-Video-DSP-Plug-in
description: Aushandlung des Video Formats im Beispiel-Video-DSP-Plug-in
ms.assetid: 3e92ce10-2b9b-4689-a181-f56c33472fea
keywords:
- Windows Media Player-Plug-ins, videodsp
- Plug-ins, videodsp
- Plug-Ins für die digitale Signalverarbeitung, Video formataushandlung
- DSP-Plug-ins, Videoformat Aushandlung
- Video DSP-Plug-ins, Format Aushandlung
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c287a38fbfcf11f1b9d74087a91c5825b22f1243
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/16/2019
ms.locfileid: "104310164"
---
# <a name="video-format-negotiation-in-the-sample-video-dsp-plug-in"></a><span data-ttu-id="24799-108">Aushandlung des Video Formats im Beispiel-Video-DSP-Plug-in</span><span class="sxs-lookup"><span data-stu-id="24799-108">Video Format Negotiation in the Sample Video DSP Plug-in</span></span>

<span data-ttu-id="24799-109">Bevor Windows Media Player ein Video-DSP-Plug-in in die Signalkette einfügt, muss der Spieler ermitteln, ob das Plug-in das Video verarbeiten kann, das abgespielt wird.</span><span class="sxs-lookup"><span data-stu-id="24799-109">Before Windows Media Player inserts a video DSP plug-in into the signal chain, the Player must determine whether the plug-in can process the video being played.</span></span> <span data-ttu-id="24799-110">Der Prozess, mit dem das Plug-in und der Spieler mit unterstützten Videoformaten kommunizieren, wird als formataushandlung bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="24799-110">The process by which the plug-in and the Player communicate about supported video formats is called format negotiation.</span></span>

## <a name="providing-the-supported-input-and-output-types"></a><span data-ttu-id="24799-111">Bereitstellen der unterstützten Eingabe-und Ausgabetypen</span><span class="sxs-lookup"><span data-stu-id="24799-111">Providing the Supported Input and Output Types</span></span>

<span data-ttu-id="24799-112">Wenn das DSP-Plug-in als DirectX Media Object (DMO) fungiert, fragt der Player das Plug-in über die unterstützten Formate ab, indem er eine Sequenz von Aufrufen an **imediaobject:: getinputtype** und **imediaobject:: getoutputtype** sendet.</span><span class="sxs-lookup"><span data-stu-id="24799-112">If the DSP plug-in is acting as a DirectX Media Object (DMO), the Player queries the plug-in about its supported formats by making a sequence of calls to **IMediaObject::GetInputType** and **IMediaObject::GetOutputType**.</span></span>

<span data-ttu-id="24799-113">Wenn das DSP-Plug-in als Media Foundation Transformation (MFT) fungiert, fragt der Spieler das Plug-in über die unterstützten Formate ab, indem es eine Sequenz von Aufrufen von **imftransform:: getinputavailabletype** und **imftransform:: getoutputavailabletype** ausführt.</span><span class="sxs-lookup"><span data-stu-id="24799-113">If the DSP plug-in is acting as a Media Foundation Transform (MFT), the Player queries the plug-in about its supported formats by making a sequence of calls to **IMFTransform::GetInputAvailableType** and **IMFTransform::GetOutputAvailableType**.</span></span>

<span data-ttu-id="24799-114">Das Beispiel-Video-Plug-in, das vom Windows Media Player-Plug-in-Assistenten generiert wird, speichert die Liste der unterstützten Videoformate als Array von GUIDs.</span><span class="sxs-lookup"><span data-stu-id="24799-114">The sample video plug-in generated by the Windows Media Player Plug-in Wizard stores the list of supported video formats as an array of GUIDs.</span></span> <span data-ttu-id="24799-115">Der folgende Code wird aus der Datei "Main. cpp" abgeleitet:</span><span class="sxs-lookup"><span data-stu-id="24799-115">The following code is from the main .cpp file:</span></span>


```C++
static const GUID*    k_guidValidSubtypes[] = {
    &MEDIASUBTYPE_NV12,
    &MEDIASUBTYPE_YV12,
    &MEDIASUBTYPE_YUY2,
    &MEDIASUBTYPE_UYVY,
    &MEDIASUBTYPE_RGB32,
    &MEDIASUBTYPE_RGB24,
    &MEDIASUBTYPE RGB555,
    &MEDIASUBTYPE RGB565
};

```



<span data-ttu-id="24799-116">Der Player kann **imediaobject:: getinputtype** und **imediaobject:: getoutputtype** in beliebiger Reihenfolge aufrufen, sodass der Plug-in-Code dies vorhersehen muss.</span><span class="sxs-lookup"><span data-stu-id="24799-116">The Player can call **IMediaObject::GetInputType** and **IMediaObject::GetOutputType** in any order, so the plug-in code must anticipate this.</span></span> <span data-ttu-id="24799-117">Der Spieler kann in beliebiger Reihenfolge **imftransform:: getinputavailabletype** und **imftransform:: getoutputavailabletype** aufrufen.</span><span class="sxs-lookup"><span data-stu-id="24799-117">Similary, the Player can call **IMFTransform::GetInputAvailableType** and **IMFTransform::GetOutputAvailableType** in any order.</span></span> <span data-ttu-id="24799-118">Die Beispiel Implementierungen von **getoutputtype** und **getoutputavailabletype** testen, ob der Eingabetyp bereits definiert wurde.</span><span class="sxs-lookup"><span data-stu-id="24799-118">The sample implementations of **GetOutputType** and **GetOutputAvailableType** test whether the input type has already been defined.</span></span> <span data-ttu-id="24799-119">Wenn dies der Fall ist, antwortet das Plug-in, dass es nur diesen Typ unterstützt.</span><span class="sxs-lookup"><span data-stu-id="24799-119">If it has, the plug-in responds that it supports only that type.</span></span> <span data-ttu-id="24799-120">Andernfalls gibt das Plug-in den Typ zurück, der dem angegebenen Index entspricht, wie im folgenden Code veranschaulicht:</span><span class="sxs-lookup"><span data-stu-id="24799-120">Otherwise, the plug-in returns the type that corresponds to the supplied index, as the following code demonstrates:</span></span>


```C++
// If input type has been defined, then use that as output type.
if (GUID_NULL != m_mtInput.majortype)
{
    hr = ::MoCopyMediaType( pmt, &m_mtInput );
}
else // Otherwise use default for this plug-in.
{
    ::ZeroMemory( pmt, sizeof( DMO_MEDIA_TYPE ) );
    pmt->majortype = MEDIATYPE_Video;
    pmt->subtype = *k_guidValidSubtypes[dwTypeIndex];     
}

```



## <a name="setting-the-input-and-output-types"></a><span data-ttu-id="24799-121">Festlegen der Eingabe-und Ausgabetypen</span><span class="sxs-lookup"><span data-stu-id="24799-121">Setting the Input and Output Types</span></span>

<span data-ttu-id="24799-122">Wenn das DSP-Plug-in als DMO fungiert, legt Windows Media Player den Medientyp durch Aufrufen von **imediaobject:: setinputtype** und **imediaobject:: setoutputtype** fest und übergibt an jede Funktion einen Zeiger auf eine **DMO- \_ \_ Medientyp** Struktur, die den angeforderten Medientyp darstellt.</span><span class="sxs-lookup"><span data-stu-id="24799-122">If the DSP plug-in is acting as a DMO, Windows Media Player sets the media type by calling **IMediaObject::SetInputType** and **IMediaObject::SetOutputType**, passing to each function a pointer to a **DMO\_MEDIA\_TYPE** structure that represents the requested media type.</span></span>

<span data-ttu-id="24799-123">Wenn das DSP-Plug-in als MFT fungiert, legt Windows Media Player den Medientyp durch Aufrufen von **imftransform:: setinputtype** und **imftransform:: setoutputtype** fest und übergibt an jede Funktion einen Zeiger auf eine **imfmediatype** -Schnittstelle, die den angeforderten Medientyp darstellt.</span><span class="sxs-lookup"><span data-stu-id="24799-123">If the DSP plug-in is acting as an MFT, Windows Media Player sets the media type by calling **IMFTransform::SetInputType** and **IMFTransform::SetOutputType**, passing to each function a pointer to an **IMFMediaType** interface that represents the requested media type.</span></span>

<span data-ttu-id="24799-124">Es gibt keine Garantie, dass der Spieler formataushandlungs Methoden in einer bestimmten Reihenfolge aufruft, sodass der Plug-in-Code jeden Fall verarbeiten muss.</span><span class="sxs-lookup"><span data-stu-id="24799-124">There is no guarantee that the Player will call format negotiation methods in any particular order, so plug-in code must handle any case.</span></span> <span data-ttu-id="24799-125">Wenn der Player beispielsweise **setoutputtype** aufruft, bevor **setinputtype** aufgerufen wird, ist es eine gültige Vorgehensweise, mit der das Plug-in den vorgeschlagenen Ausgabe Medientyp ablehnen kann.</span><span class="sxs-lookup"><span data-stu-id="24799-125">For instance, if the Player calls **SetOutputType** before calling **SetInputType**, it is a valid course of action for the plug-in to reject the proposed output media type.</span></span> <span data-ttu-id="24799-126">Der folgende Code aus der Beispiel Implementierung von **imediaobject:: setoutputtype** veranschaulicht dies:</span><span class="sxs-lookup"><span data-stu-id="24799-126">The following code from the sample implementation of **IMediaObject::SetOutputType** demonstrates this:</span></span>


```C++
if( GUID_NULL != m_mtInput.majortype )
{
    // Validate that the output media type matches our requirements 
    // and matches our input type (if set).
    hr = ValidateMediaType(pmt, &m_mtInput);
}
else
{
    hr = DMO_E_TYPE_NOT_ACCEPTED;
}

```



<span data-ttu-id="24799-127">Die Plug-in-Beispiel Implementierungen von **setinputtype** und **setoutputtype** aufrufen die benutzerdefinierte Funktion mit dem Namen **validatemediatype**.</span><span class="sxs-lookup"><span data-stu-id="24799-127">The sample plug-in implementations of **SetInputType** and **SetOutputType** call the custom function named **ValidateMediaType**.</span></span> <span data-ttu-id="24799-128">Diese Plug-in-Funktion führt eine Reihe von Tests für den vorgeschlagenen Medientyp aus, um sicherzustellen, dass der Medientyp wohl geformt und vom Plug-in unterstützt wird.</span><span class="sxs-lookup"><span data-stu-id="24799-128">This plug-in function performs a series of tests on the proposed media type designed to ensure that the media type is well-formed and supported by the plug-in.</span></span> <span data-ttu-id="24799-129">**Validatemediatype** führt die folgenden Tests aus:</span><span class="sxs-lookup"><span data-stu-id="24799-129">**ValidateMediaType** performs the following tests:</span></span>

-   <span data-ttu-id="24799-130">Überprüft, ob die Member **majortype** und **Format Type** die korrekten Werte enthalten.</span><span class="sxs-lookup"><span data-stu-id="24799-130">Verifies that the **majortype** and **formattype** members contain the correct values.</span></span>
-   <span data-ttu-id="24799-131">Überprüft, ob der **Untertyp** Member mit einem der unterstützten Formate übereinstimmt.</span><span class="sxs-lookup"><span data-stu-id="24799-131">Verifies that the **subtype** member matches one of the supported formats.</span></span>
-   <span data-ttu-id="24799-132">Überprüft, ob die Informationen in den Strukturen **BITMAPINFOHEADER** und **videoinfoheader** bzw. **VIDEOINFOHEADER2** gültige Werte enthalten.</span><span class="sxs-lookup"><span data-stu-id="24799-132">Verifies that the information in the **BITMAPINFOHEADER** and **VIDEOINFOHEADER** or **VIDEOINFOHEADER2** structures contain valid values.</span></span>
-   <span data-ttu-id="24799-133">Testet, ob die Eingabe-und Ausgabemedien Typen Stimmen, da das Plug-in keine Formate von der Eingabe in die Ausgabe konvertiert.</span><span class="sxs-lookup"><span data-stu-id="24799-133">Tests whether the input and output media types match because the plug-in does not convert formats from input to output.</span></span>

<span data-ttu-id="24799-134">Wenn der vorgeschlagene Medientyp die Validierungstests besteht, wird er in einer Mitgliedsvariablen gespeichert: **m \_ mtinput** für den Eingabe Medientyp, **m \_ mtoutput** für den Ausgabe Medientyp.</span><span class="sxs-lookup"><span data-stu-id="24799-134">If the proposed media type passes the validation tests, it is stored in a member variable: **m\_mtInput** for the input media type, **m\_mtOutput** for the output media type.</span></span>

## <a name="related-topics"></a><span data-ttu-id="24799-135">Zugehörige Themen</span><span class="sxs-lookup"><span data-stu-id="24799-135">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="24799-136">**Implementieren eines Video DSP-Plug-ins**</span><span class="sxs-lookup"><span data-stu-id="24799-136">**Implementing a Video DSP Plug-in**</span></span>](implementing-a-video-dsp-plug-in.md)
</dt> </dl>

 

 




